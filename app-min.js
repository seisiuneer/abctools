var pdf,gShowAdvancedControls=!1,gStripAnnotations=!1,gStripTextAnnotations=!1,gStripChords=!1,STAFFSPACEMIN=0,STAFFSPACEDEFAULT=10,STAFFSPACEMAX=200,STAFFSPACEOFFSET=40,gStaffSpacing=STAFFSPACEOFFSET+STAFFSPACEDEFAULT,gIsIOS=!1,gIsIPad=!1,gIsIPhone=!1,gIsSafari=!1,gIsAndroid=!1,gRenderingPDF=!1,gTheQRCode=null,MAXQRCODEURLLENGTH=2300,ALLTITLESMAXLENGTH=70,HEADERFOOTERFONTSIZE=12,QRCODECAPTIONPDFFONTSIZE=12,gShowShareControls=!1,gAllowSave=!1,gAllowURLSave=!1,gAllowQRCodeSave=!1,gShowAllControls=!1,gAllowControlToggle=!1,gAllowFilterAnnotations=!1,gAllowFilterText=!1,gAllowFilterChords=!1,gCapo=0,gIsMaximized=!1,gABCFromFile=!1,gAllowCopy=!1,gAllowPDF=!1,gDisplayedName="",gShowTabNames=!0,gAllowShowTabNames=!1,gWhistleFontPrepared=!1,DEBOUNCEMS=280,AUTOSCROLLDEBOUNCEMS=250,gLastAutoScrolledTune=-1,gTopBarShowing=!0,gCurrentTune=0,gTotalTunes=0,gCurrentTab="noten",gForceFullRender=!1,gIsOneColumn=!0,gGotRenderDivClick=!1,gRenderDivClickOffset=-1,gLocalStorageAvailable=!1,gPDFQuality=.75,gIncludePageLinks=!0,gDoForcePDFFilename=!1,gForcePDFFilename="",gAddTOCLinkback=!1,gAddIndexLinkback=!1,gTuneHyperlinks=[],gAddTheSessionHyperlinks=!1,gAddPlaybackHyperlinks=!1,gPlaybackHyperlinkMelodyProgram="",gPlaybackHyperlinkBassChordProgram="",gAppendXValuesToTuneNames=!1,gTheABC=document.getElementById("abc");function findTuneOffsetByIndex(e){if(0==e)return 0;for(var t=gTheABC.value.split(/^X:/gm),n=t[0].length,o=1;o<=e;++o)n+=t[o].length+2;return n}function findTuneByOffset(e){var t=gTheABC.value.split(/^X:/gm),n=t.length,o=0;for(i=1,o=t[0].length;i<n;++i)if(e<(o+=t[i].length+2))return i-1;return n-2}function getTuneByIndex(e){return"X:"+gTheABC.value.split(/^X:/gm)[e+1]}function getSelectedText(e){var t=document.getElementById(e),n=t.selectionStart,o=t.selectionEnd;return t.value.substring(n,o)}function findSelectedTune(){var e=gTheABC.value,t=gTheABC.selectionStart;if(0==t&&(t=e.indexOf("X:")+2),0==t)return"";var n=e.split(/^X:/gm),o=n.length,a=0;for(i=1,a=n[0].length;i<o;++i)if(t<(a+=n[i].length+2)){var r="X:"+n[i];return r.trimEnd()}return""}function GetFirstTuneTitle(){var e="",t=gTheABC.value,n=(t=escape(t)).split("%0A");for(i=0;i<n.length;++i){n[i]=unescape(n[i]);var o=n[i].split("");if("T"==o[0]&&":"==o[1]){e=(e=(e=(e=(e=n[i].slice(2)).trim()).replace(/[^a-zA-Z0-9_\-. ]+/ig,"")).replace(/\s/g,"_")).replace(/\'/g,"_");break}}return e}function CountTunes(){var e=gTheABC.value.split(/^X:.*$/gm).length-1;return gTotalTunes=e,e}function GetAllTuneTitles(){var e=[],t=escape(gTheABC.value),n=t.split("%0D%0A");for(i=0,n=t.split("%0A");i<n.length;++i){n[i]=unescape(n[i]);var o=n[i].split("");if("T"==o[0]&&":"==o[1]){var a=n[i].slice(2);a=a.trim(),e.push(a)}}var r=e.length,l="";if(r>0)for(i=0;i<r;++i){if((l+=e[i]).length>ALLTITLESMAXLENGTH){var s=r-i-1;s>0&&(l=l+" + "+s+" more");break}i!=r-1&&(l+=" / ")}return l}function getTuneRangeForTranspose(){var e=gTheABC.value,t=gTheABC,n=t.selectionStart;0==n&&(n=e.indexOf("X:")+2);var o=t.selectionEnd;0==o&&(o=e.indexOf("X:")+2);var a=findTuneByOffset(n),r=findTuneByOffset(o);return{start:a,end:r}}function resetSelectionAfterTranspose(e,t){var n=findTuneOffsetByIndex(e),o=getTuneByIndex(t),a=findTuneOffsetByIndex(t)+(o.length-1);gTheABC.selectionStart=n,gTheABC.selectionEnd=a,gIsIOS||gIsAndroid?gTheABC.blur():gTheABC.focus()}function Transpose(e){if(!gRenderingPDF){var t=CountTunes(),n=getTuneRangeForTranspose();document.getElementById("loading-bar-spinner").style.display="block",setTimeout(function(){for(var o,a=gTheABC.value,r=GetABCJSParams(),l=a.split(/^X:/gm),s=[],d=0;d<t;++d)o="notation"+d,s.push(o),document.getElementById(o).style.opacity=0;for(var A="",d=1;d<=t;++d){l[d]="X:"+l[d];var g=null;if(d-1>=n.start&&d-1<=n.end)try{g=ABCJS.renderAbc(s[d-1],l[d],r),A+=ABCJS.strTranspose(l[d],g,e)}catch(c){DayPilot.Modal.alert("Unable to tranpose one or more tunes.",{theme:"modal_flat",top:50}),A+=l[d]}else A+=l[d]}gTheABC.value=A,resetSelectionAfterTranspose(n.start,n.end),RenderAsync(!0,null,function(){setTimeout(function(){for(var e=0;e<t;++e)document.getElementById(o).style.opacity=1},100)})},100)}}function TransposeUp(e){var t=1;e.shiftKey&&(t=2),e.altKey&&(t=12),Transpose(t)}function TransposeDown(e){var t=-1;e.shiftKey&&(t=-2),e.altKey&&(t=-12),Transpose(t)}function SortTunes(e){var t,n,o=gTheABC.value,a=o.split(/(^X:.*$)/gm),r=(a.length-1)/2;if(!(r<2)){var l=a[0];totalTunes=r;var s=GetTunebookIndexTitles(),d=[],A=0;for(t=0;t<r;++t)void 0!=a[2*t+1]&&(0==(n=s[A]).indexOf("The ")&&(n=n.substring(4,n.length)+", The"),e&&(0==n.indexOf("An ")&&(n=n.substring(3,n.length)+", An"),0==n.indexOf("A ")&&(n=n.substring(2,n.length)+", A")),A++,d.push({title:n,tune:a[2*t+1]+a[2*t+2]}));for(d.sort((e,t)=>{let n=e.title.toUpperCase(),o=t.title.toUpperCase();return n<o?-1:n>o?1:0}),o="",o+=l,t=0;t<A;++t)o+=d[t].tune;gTheABC.value=o,gTheABC.selectionStart=0,gTheABC.selectionEnd=0,gTheABC.focus()}}function SortABC(e){if(!gRenderingPDF){var t=!1;e.shiftKey&&(t=!0),document.getElementById("sortbutton").value="  Sorting  ",setTimeout(function(){SortTunes(t),document.getElementById("sortbutton").value="Rendering",RenderAsync(!0,null,function(){document.getElementById("sortbutton").value="  Sorted!  ",setTimeout(function(){document.getElementById("sortbutton").value="Sort ABC"},1500)})},750)}}function Clear(){!gRenderingPDF&&(ClearNoRender(),RenderAsync(!0,null),gTheABC.focus())}function ClearNoRender(){gTheABC.value="",gDisplayedName="No ABC file selected",gABCFromFile=!1,RestoreDefaults(),HideAllControls()}var PAGENUMBERTOP=296,PAGENUMBERTOPA4=313,PAGETOPOFFSET=32,PAGEBOTTOMOFFSET=32,PAGELEFTOFFSET=37,PAGELEFTOFFSETA4=29,PAGEHEIGHTLETTER=792,PAGEHEIGHTA4=842,BETWEENTUNESPACE=20,running_height=PAGETOPOFFSET,column_number=0,theCurrentPageNumber=1,isFirstPage=!0,tunesProcessed=0,totalTunes=0,thePageHeader="",thePageFooter="",thePageHeaderURL="",thePageFooterURL="",theRenderTime="",theHeaderFooterTuneNames="",thePageNumberVerticalOffset=0,gQRCodeRequested=!1,gQRCodeURLOverride="",gDoForceQRCodeURLOverride=!1,gQRCodeCaptionOverride="",gDoForceQRCodeCaptionOverride=!1,TunebookIndexRequested=!1,theTunebookIndexTitle="",TunebookSortedIndexRequested=!1,theTunebookSortedIndexTitle="",TunebookTOCRequested=!1,theTunebookTOCTitle="",TunebookSortedTOCRequested=!1,theTunebookSortedTOCTitle="",TunebookTPRequested=!1,theTunebookTP="",theTunebookTPURL="",TunebookTPSTRequested=!1,theTunebookTPST="",theTunebookTPSTURL="",theTunePageMap=[],PDFJPGQUALITY=.8,PDFSCALEFACTOR=1.55,theOffscreen=null,gPDFCancelRequested=!1,gPDFTabselected="noten";function GetTunebookIndexTitles(){var e,t=[];for(e=0;e<totalTunes;++e){var n=getTuneByIndex(e),o=escape(n),a=o.split("%0D%0A");for(j=0,a=o.split("%0A");j<a.length;++j){a[j]=unescape(a[j]);var r=a[j].split("");if("T"==r[0]&&":"==r[1]){titel=(titel=a[j].slice(2)).trim(),gAppendXValuesToTuneNames&&(titel=e+1+" - "+titel),t.push(titel);break}}}return t}var TPTITLESIZE=24,TPSTTITLESIZE=16,TPTOPOFFSET=435,TPSTOFFSET=24;function AppendTuneTitlePage(e,t,n,o){var a=0;if("a4"==t&&(a=20),e.setPage(1),""!=n){if(e.setFont("Times","","normal"),e.setFontSize(TPTITLESIZE),theTunebookTPURL&&""!=theTunebookTPURL){var r=e.getTextWidth(n);e.textWithLink(n,e.internal.pageSize.getWidth()/3.1-r/2,TPTOPOFFSET+a,{align:"center",url:theTunebookTPURL})}else e.text(n,e.internal.pageSize.getWidth()/3.1,TPTOPOFFSET+a,{align:"center"})}if(""!=o){if(e.setFont("Times","","normal"),e.setFontSize(TPSTTITLESIZE),theTunebookTPSTURL&&""!=theTunebookTPSTURL){var r=e.getTextWidth(o);e.textWithLink(o,e.internal.pageSize.getWidth()/3.1-r/2,TPTOPOFFSET+TPSTOFFSET+a,{align:"center",url:theTunebookTPSTURL})}else e.text(o,e.internal.pageSize.getWidth()/3.1,TPTOPOFFSET+TPSTOFFSET+a,{align:"center"})}}var TEXTINCIPITTOPOFFSET=330,TEXTINCIPITBOTTOMOFFSET=12,TEXTINCIPITLEFTMARGIN=65,TEXTINCIPITRIGHTMARGIN=190,TEXTINCIPITFONTSIZE=12,TEXTINCIPITLINESPACING=10;function GenerateTextIncipits(e,t,n,o,a,r,l){TEXTINCIPITLEFTMARGIN=65,TEXTINCIPITRIGHTMARGIN=190;var s=0;"a4"==a&&(TEXTINCIPITLEFTMARGIN=61,TEXTINCIPITRIGHTMARGIN=186,s=20);var d=e.internal.pageSize.getHeight(),A=e.internal.pageSize.getWidth()/1.55,g=d-(PAGETOPOFFSET+TEXTINCIPITBOTTOMOFFSET),c=TEXTINCIPITTOPOFFSET+s,T=GetTunebookIndexTitles();e.setFont("Times","","normal"),e.setFontSize(TEXTINCIPITFONTSIZE);var u=[];for(m=0;m<totalTunes;++m){for(h=0,p=getTuneByIndex(m),p=StripChordsOne(p=StripTextAnnotationsOne(p=StripAnnotationsOne(p))),M=/^M:.*[\r\n]*/gm,C=(E=(p=escape(p=p.replace(M,""))).split("%0A")).length,v="";h<C&&-1==(v=unescape(E[h])).indexOf("K:");++h);for(h=0,v=(v=(v=(v=(v=(v=(v=(v=(v=(v=(v=v.replace("K:","")).trim()).replace("Major","maj")).replace("Minor","min")).replace("Dorian","dor")).replace("Mixolydian","mix")).replace("major","maj")).replace("minor","min")).replace("dorian","dor")).replace("mixolydian","mix")).replace(" ","");h<C&&-1==(f=unescape(E[h])).indexOf("|");++h);for(h=0,I=(f=(f=f.replace(":","")).replace("[","")).split("|"),$=[],b=I.length;h<b;++h)""!=I[h]&&$.push(I[h]);for((b=$.length)>3&&(b=3),S="",h=0;h<b;++h)S+=$[h],h!=b-1&&(S+=" | ");0==(f=S).indexOf(" | ")&&(f=f.substring(3,f.length)),(B=T[m]).length>29?(B=(B=B.substring(0,29)).trim(),B+="..."):B=B.trim(),l&&0==B.indexOf("The ")&&(B=B.substring(4,B.length)+", The"),""!=v&&(B+=" ("+v+")"),u.push({title:B,incipit:f})}if(l){var m,h,p,f,I,$,M,E,C,b,S,B,v,L=[];for(m=0;m<totalTunes;++m)L.push({title:u[m].title,incipit:u[m].incipit});for(L.sort((e,t)=>{var n=e.title.toUpperCase(),o=t.title.toUpperCase();return(gAppendXValuesToTuneNames&&(n=n.substring(n.indexOf("-")+2),o=o.substring(o.indexOf("-")+2)),n<o)?-1:n>o?1:0}),m=0;m<totalTunes;++m)u[m].title=L[m].title,u[m].incipit=L[m].incipit}for(m=0;m<totalTunes;++m)B=u[m].title,f=u[m].incipit,r.push(theCurrentPageNumber),e.text(B,TEXTINCIPITLEFTMARGIN,c,{align:"left"}),e.text(f,A-TEXTINCIPITRIGHTMARGIN,c,{align:"left"}),c+=TEXTINCIPITLINESPACING,m!=totalTunes-1&&c>g&&(theCurrentPageNumber++,e.addPage(a),e.setFont("Times","","normal"),e.setFontSize(TEXTINCIPITFONTSIZE),c=TEXTINCIPITTOPOFFSET+s);return r}var INDEXTOPOFFSET=330,INDEXBOTTOMOFFSET=16,INDEXTITLEOFFSET=35,INDEXLEFTMARGIN=90,INDEXRIGHTMARGIN=105,INDEXTITLESIZE=18,INDEXFONTSIZE=13,INDEXLINESPACING=12;function AppendTunebookIndex(e,t,n,o,a,r,l,s,d,A){var g=0;"a4"==o&&(g=20),e.addPage(o),e.setFont("Times","","normal"),e.setFontSize(INDEXTITLESIZE),""!=r&&e.text(r,e.internal.pageSize.getWidth()/3.1,INDEXTOPOFFSET+g,{align:"center"});var c=GetTunebookIndexTitles(),T=pdf.internal.pageSize.getHeight(),u=pdf.internal.pageSize.getWidth()/1.55,m=T-(PAGETOPOFFSET+INDEXBOTTOMOFFSET),h=INDEXTOPOFFSET+INDEXTITLEOFFSET+g;e.setFont("Times","","normal"),e.setFontSize(INDEXFONTSIZE);var p=[];for(f=0;f<totalTunes;++f)p.push(a[f]);if(l){for(f=0;f<totalTunes;++f)0==($=c[f]).indexOf("The ")&&($=$.substring(4,$.length)+", The",c[f]=$);var f,I,$,M=[];for(f=0;f<totalTunes;++f)M.push({name:c[f],pageNumber:p[f]});for(M.sort((e,t)=>{var n=e.name.toUpperCase(),o=t.name.toUpperCase();return(gAppendXValuesToTuneNames&&(n=n.substring(n.indexOf("-")+2),o=o.substring(o.indexOf("-")+2)),n<o)?-1:n>o?1:0}),f=0;f<totalTunes;++f)c[f]=M[f].name,s||(p[f]=M[f].pageNumber)}for(f=0;f<totalTunes;++f){var E=I=p[f];d&&(E+=A),d?e.textWithLink(c[f],INDEXLEFTMARGIN,h,{align:"left",pageNumber:E}):e.text(c[f],INDEXLEFTMARGIN,h,{align:"left"}),d?e.textWithLink(""+I,u-INDEXRIGHTMARGIN,h,{align:"left",pageNumber:E}):e.text(""+I,u-INDEXRIGHTMARGIN,h,{align:"left"}),h+=INDEXLINESPACING,f!=totalTunes-1&&h>m&&(theCurrentPageNumber++,e.addPage(o),e.setFont("Times","","normal"),e.setFontSize(INDEXFONTSIZE),h=INDEXTOPOFFSET+INDEXTITLEOFFSET+g)}theCurrentPageNumber++}function PostProcessHeadersAndFooters(e,t,n,o,a,r,l){for(var s=n;s<n+o;++s)e.setPage(s),AddPageHeaderFooter(e,t,s-n+1,a,r,l)}function GetAllTuneHyperlinks(e){var t,n=CountTunes();if(t=GetTunebookIndexTitles(),n!=e.length)return!1;for(i=0;i<n;++i){var o=getTuneByIndex(i),a="";if(gAddPlaybackHyperlinks){var r=o,l=/^X:.*[\r\n]*/gm;r=r.replace(l,"");var l=/^X:.*[\r\n]*/gm;r="X:1\n%%MIDI program "+gPlaybackHyperlinkMelodyProgram+"\n%%MIDI chordprog "+gPlaybackHyperlinkBassChordProgram+"\n"+(r=r.replace(l,""));var s=FillUrlBoxWithAbcInLZW(r);s+="&play=1",e[i].url=s}else gAddTheSessionHyperlinks&&(e[i].url="https://thesession.org/tunes/search?q="+encodeURIComponent(t[i]));var l=/^%add_link_to_thesession.*$/m,d=o.match(l);d&&d.length>0&&(e[i].url="https://thesession.org/tunes/search?q="+encodeURIComponent(t[i])),l=/^%add_playback_link.*$/m;var A=o.match(l);if(A&&A.length>0){var r=o,g=A[0].replace("%add_playback_link","").match(/\b(\w+)\b/g),c=gTheMelodyProgram,T=gTheChordProgram;gAddPlaybackHyperlinks&&(c=gPlaybackHyperlinkMelodyProgram,T=gPlaybackHyperlinkBassChordProgram),g&&g.length>0&&(g.length>=1&&(c=(c=g[0]).trim()),g.length>1&&(T=(T=g[1]).trim()));var l=/^X:.*[\r\n]*/gm;r="X:1\n%%MIDI program "+c+"\n%%MIDI chordprog "+T+"\n"+(r=r.replace(l,""));var s=FillUrlBoxWithAbcInLZW(r);s+="&play=1",e[i].url=s}l=/^%hyperlink.*$/m;var u=o.match(l);u&&u.length>0&&(a=(a=u[0].replace("%hyperlink","")).trim(),e[i].url=a)}return!0}function PostProcessTuneHyperlinks(e,t,n,o){if(t){if(GetAllTuneHyperlinks(t)){e.internal.pageSize.getWidth(),e.internal.pageSize.getHeight(),e.setFont("Verdana","","normal"),e.setFontSize(18);for(var a=t.length,r=-1,l=0;l<a;++l){var s=t[l];if(""!=s.url){var d=s.page;d!=r&&(e.setPage(d+o-1),r=d);var A={left:s.x,top:s.y,width:s.width,height:s.height};A=pageRect2LinkRect(e,A,n),e.link(A.left,A.top,A.width,A.height,{url:s.url})}}}}}function PostProcessTOCAndIndexLinks(e,t,n,o,a,r,l){for(var s=t;s<=n;++s){e.setPage(s),e.setFont("Verdana","","normal"),e.setFontSize(18);var d=e.internal.pageSize.getWidth(),A=e.internal.pageSize.getHeight();if(o&&e.textWithLink("<<",5,A/1.55,{align:"left",pageNumber:a}),r){var g=e.getTextWidth(">>");e.textWithLink(">>",d/1.55-(g+5),A/1.55,{align:"left",pageNumber:l})}}}var TOCTOPOFFSET=330,TOCBOTTOMOFFSET=16,TOCTITLEOFFSET=35,TOCLEFTMARGIN=90,TOCRIGHTMARGIN=105,TOCTITLESIZE=18,TOCFONTSIZE=13,TOCLINESPACING=12;function AppendTuneTOC(e,t,n,o,a,r,l,s,d,A,g){var c=g,T=0;"a4"==o&&(T=20),e.setPage(c),e.setFont("Times","","normal"),e.setFontSize(TOCTITLESIZE),""!=r&&e.text(r,e.internal.pageSize.getWidth()/3.1,TOCTOPOFFSET+T,{align:"center"});var u=GetTunebookIndexTitles(),m=pdf.internal.pageSize.getHeight(),h=pdf.internal.pageSize.getWidth()/1.55,p=m-(PAGETOPOFFSET+TOCBOTTOMOFFSET),f=TOCTOPOFFSET+TOCTITLEOFFSET+T;e.setFont("Times","","normal"),e.setFontSize(TOCFONTSIZE);var I=[];for($=0;$<totalTunes;++$)I.push(a[$]);if(l){for($=0;$<totalTunes;++$)0==(E=u[$]).indexOf("The ")&&(E=E.substring(4,E.length)+", The",u[$]=E);var $,M,E,C=[];for($=0;$<totalTunes;++$)C.push({name:u[$],pageNumber:I[$]});for(C.sort((e,t)=>{var n=e.name.toUpperCase(),o=t.name.toUpperCase();return(gAppendXValuesToTuneNames&&(n=n.substring(n.indexOf("-")+2),o=o.substring(o.indexOf("-")+2)),n<o)?-1:n>o?1:0}),$=0;$<totalTunes;++$)u[$]=C[$].name,s||(I[$]=C[$].pageNumber)}for($=0;$<totalTunes;++$)M=I[$],d?e.textWithLink(u[$],TOCLEFTMARGIN,f,{align:"left",pageNumber:M+A}):e.text(u[$],TOCLEFTMARGIN,f,{align:"left"}),d?e.textWithLink(""+M,h-TOCRIGHTMARGIN,f,{align:"left",pageNumber:M+A}):e.text(""+M,h-TOCRIGHTMARGIN,f,{align:"left"}),f+=TOCLINESPACING,$!=totalTunes-1&&f>p&&(c++,e.setPage(c),e.setFont("Times","","normal"),e.setFontSize(TOCFONTSIZE),f=TOCTOPOFFSET+TOCTITLEOFFSET+T)}function DryRunAddTuneTOC(e,t,n,o,a,r,l,s){var d=0;"a4"==o&&(d=20),e.addPage(o);var A=GetTunebookIndexTitles(),g=pdf.internal.pageSize.getHeight();pdf.internal.pageSize.getWidth();var c=g-(PAGETOPOFFSET+TOCBOTTOMOFFSET),T=TOCTOPOFFSET+TOCTITLEOFFSET+d,u=[];for(m=0;m<totalTunes;++m)u.push(a[m]);if(l){for(m=0;m<totalTunes;++m)0==(h=A[m]).indexOf("The ")&&(h=h.substring(4,h.length)+", The",A[m]=h);var m,h,p=[];for(m=0;m<totalTunes;++m)p.push({name:A[m],pageNumber:u[m]});for(p.sort((e,t)=>{var n=e.name.toUpperCase(),o=t.name.toUpperCase();return(gAppendXValuesToTuneNames&&(n=n.substring(n.indexOf("-")+2),o=o.substring(o.indexOf("-")+2)),n<o)?-1:n>o?1:0}),m=0;m<totalTunes;++m)A[m]=p[m].name,s||(u[m]=p[m].pageNumber)}for(m=0;m<totalTunes;++m)T+=TOCLINESPACING,m!=totalTunes-1&&T>c&&(theCurrentPageNumber++,e.movePage(theCurrentPageNumber,1),T=TOCTOPOFFSET+TOCTITLEOFFSET+d,e.addPage(o));theCurrentPageNumber++,e.movePage(theCurrentPageNumber,1)}function pageRect2LinkRect(e,t,n){var o=26;return"a4"==n&&(o=27),t.left=t.left/1.55,t.top=e.internal.pageSize.getHeight()/3.1+o+t.top/1.55,t.width=t.width/1.55,t.height=t.height/1.55,t}function pageVOffset2LinkVOffset(e,t,n){var o=26;return"a4"==n&&(o=27),e.internal.pageSize.getHeight()/3.1+o+t/1.55}function linkVOffset2PageVOffset(e,t,n){var o=26;return"a4"==n&&(o=27),t-=e.internal.pageSize.getHeight()/3.1+o,t*=1.55}function AppendQRCode(e,t,n){var o;if(gDoForceQRCodeURLOverride)o=gQRCodeURLOverride;else if(FillUrlBoxWithAbcInLZW(null),o=document.getElementById("urltextbox").value,!gAllowQRCodeSave){n(!1);return}null==gTheQRCode?gTheQRCode=new QRCode(document.getElementById("qrcode"),{text:o,width:548,height:548,colorDark:"#000000",colorLight:"#ffffff",border:16,correctLevel:QRCode.CorrectLevel.M}):(gTheQRCode.clear(),gTheQRCode.makeCode(o)),setTimeout(function(){var a=document.querySelectorAll('div[id="qrcode"] > img');if(a&&a[0]){e.addPage(t);var r=e.internal.pageSize.getWidth()/3.1-18,l=(a=a[0]).src;e.addImage(l,"PNG",r,150,256,256);var s={left:r,top:150,width:256,height:256};s=pageRect2LinkRect(e,s,t),e.link(s.left,s.top,s.width,s.height,{url:o}),e.setFont("Times","","normal"),e.setFontSize(QRCODECAPTIONPDFFONTSIZE);var d=558;"a4"==t&&(d=575);var A=theHeaderFooterTuneNames;gDoForceQRCodeCaptionOverride&&(A=gQRCodeCaptionOverride);var g=e.internal.pageSize.getWidth(),c=e.getTextWidth(A);e.textWithLink(A,g/3.1-c/2,d,{align:"left",url:o}),gTheQRCode.clear(),n(!0)}else gTheQRCode.clear(),n(!1)},1e3)}function getDescriptiveFileName(e,t){var n="";if(gABCFromFile?n=(n=(n=(n=(n=gDisplayedName).trim()).replace(/[^a-zA-Z0-9_\-. ]+/ig,"")).replace(/\s/g,"_")).replace(/\..+$/,""):(n=GetFirstTuneTitle(),e>1&&(n+="_Set")),t){var o=GetRadioValue("notenodertab"),a="";switch(o){case"noten":a="";break;case"notenames":a="_Note_Names";break;case"mandolin":a="_Mandolin";break;case"gdad":a="_GDAD";break;case"mandola":a="_Mandola";break;case"guitare":a="_Guitar";break;case"guitard":a="_DADGAD";break;case"whistle":a="_Whistle";break;case"bc":a="_BC";break;case"cd":a="_CD"}switch(n+=a,a="",o){case"noten":case"notenames":case"whistle":case"bc":case"cd":break;case"mandolin":case"gdad":case"mandola":case"guitare":case"guitard":gCapo>0&&(a="_Capo_"+gCapo)}n+=a}return n}function ProcessTunesForContinuousLayout(e,t,n){var o=e.length;if(o<=1)return e;var a=[];for(r=0;r<o;++r){d=(s=document.getElementById("notation"+r)).offsetHeight/PDFSCALEFACTOR;var r,l,s,d,A,g,c=[],T=s.children,u=T.length,m=1;n&&(u>2&&(u=2),m=2);var h=0;for(l=0;l<u;++l)A=(g=T.item(l)).offsetHeight/PDFSCALEFACTOR,c.push(A/=m),h+=A;n&&(d=h);var p={theElement:s,height:d,staffHeights:c};a.push(p)}var f=t-(PAGETOPOFFSET+PAGEBOTTOMOFFSET),I=f,$=!0;for(r=0;r<o;++r)if(!e[r]){var M=a[r].height+a[r].staffHeights.length/m;if(M>I){if(0!=r&&(e[r-1]=!0),I=f,M>f){var M,E,C,b=a[r].staffHeights.length;for(l=0;l<b;++l)(E=I-(C=a[r].staffHeights[l]+1))<0&&(I=f),I-=C;I-=BETWEENTUNESPACE/m,$=!1}else I=f,I-=M,I-=BETWEENTUNESPACE/m,$=!0}else $&&($=!1),I-=M,I-=BETWEENTUNESPACE/m}return e}function scanTunesForPageBreaks(e,t,n){var o=PAGEHEIGHTLETTER;"a4"==t&&(o=PAGEHEIGHTA4);var a=[],r=gTheABC.value.split(/^X:.*$/gm),l=r.length-1;if(0==l)return a;if(n)for(var s=1;s<=l;++s)a.push(!1);else for(var s=1;s<=l;++s)-1!=r[s].indexOf("%%newpage")?a.push(!0):a.push(!1);return ProcessTunesForContinuousLayout(a,o,n)}function formatDate(e){var t=new Date,n=""+(t.getMonth()+1),o=""+t.getDate(),a=t.getFullYear();return(n.length<2&&(n="0"+n),o.length<2&&(o="0"+o),0==e)?[n,o,a].join("-"):[a,n,o].join("-")}function formatTime(){if(""!=theRenderTime)return theRenderTime;var e=new Date,t=e.getHours(),n=e.getMinutes(),o=" AM";0==t&&(t=12),t>12&&(t-=12,o=" PM"),t=""+t,(n=""+n).length<2&&(n="0"+n);var a=[t,n].join(":");return a+=o,theRenderTime=a,a}function ParseCommentCommands(e){thePageHeader="",thePageFooter="";var t=/^%pageheader.*$/m,n=e.match(t);n&&n.length>0&&(thePageHeader=(thePageHeader=n[0].replace("%pageheader","")).trim()),t=/^%pagefooter.*$/m;var o=e.match(t);o&&o.length>0&&(thePageFooter=(thePageFooter=o[0].replace("%pagefooter","")).trim()),gQRCodeRequested=!1,gDoForceQRCodeURLOverride=!1,gQRCodeURLOverride="",t=/^%qrcode.*$/m;var a=e.match(t);a&&a.length>0&&(gQRCodeRequested=!0,""!=(gQRCodeURLOverride=(gQRCodeURLOverride=a[0].replace("%qrcode","")).trim())&&(gDoForceQRCodeURLOverride=!0)),gDoForceQRCodeCaptionOverride=!1,gQRCodeCaptionOverride="",t=/^%caption_for_qrcode.*$/m;var r=e.match(t);r&&r.length>0&&""!=(gQRCodeCaptionOverride=(gQRCodeCaptionOverride=r[0].replace("%caption_for_qrcode","")).trim())&&(gDoForceQRCodeCaptionOverride=!0),theTunebookIndexTitle="",TunebookIndexRequested=!1,t=/^%addindex.*$/m;var l=e.match(t);l&&l.length>0&&(TunebookIndexRequested=!0,theTunebookIndexTitle=(theTunebookIndexTitle=l[0].replace("%addindex","")).trim()),theTunebookSortedIndexTitle="",TunebookSortedIndexRequested=!1,t=/^%addsortedindex.*$/m;var s=e.match(t);s&&s.length>0&&(TunebookSortedIndexRequested=!0,theTunebookSortedIndexTitle=(theTunebookSortedIndexTitle=s[0].replace("%addsortedindex","")).trim()),theTunebookTOCTitle="",TunebookTOCRequested=!1,t=/^%addtoc.*$/m;var d=e.match(t);d&&d.length>0&&(TunebookTOCRequested=!0,theTunebookTOCTitle=(theTunebookTOCTitle=d[0].replace("%addtoc","")).trim()),theTunebookSortedTOCTitle="",TunebookSortedTOCRequested=!1,t=/^%addsortedtoc.*$/m;var A=e.match(t);A&&A.length>0&&(TunebookSortedTOCRequested=!0,theTunebookSortedTOCTitle=(theTunebookSortedTOCTitle=A[0].replace("%addsortedtoc","")).trim()),theTunebookTP="",TunebookTPRequested=!1,t=/^%addtitle.*$/m;var g=e.match(t);g&&g.length>0&&(TunebookTPRequested=!0,theTunebookTP=(theTunebookTP=g[0].replace("%addtitle","")).trim()),theTunebookTPST="",TunebookTPSTRequested=!1,t=/^%addsubtitle.*$/m;var c=e.match(t);c&&c.length>0&&(TunebookTPSTRequested=!0,theTunebookTPST=(theTunebookTPST=c[0].replace("%addsubtitle","")).trim()),INDEXFONTSIZE=13,t=/^%indexfontsize.*$/m;var T=e.match(t);if(T&&T.length>0){var u=T[0].replace("%indexfontsize",""),m=parseInt(u=u.trim());!isNaN(m)&&m>0&&(INDEXFONTSIZE=m)}INDEXLINESPACING=12,t=/^%indexlinespacing.*$/m;var h=e.match(t);if(h&&h.length>0){var p=h[0].replace("%indexlinespacing",""),f=parseInt(p=p.trim());!isNaN(f)&&f>=0&&(INDEXLINESPACING=f)}INDEXTITLESIZE=18,t=/^%indextitlefontsize.*$/m;var I=e.match(t);if(I&&I.length>0){var u=I[0].replace("%indextitlefontsize",""),m=parseInt(u=u.trim());!isNaN(m)&&m>0&&(INDEXTITLESIZE=m)}INDEXTITLEOFFSET=35,t=/^%indextitleoffset.*$/m;var $=e.match(t);if($&&$.length>0){var M=$[0].replace("%indextitleoffset",""),E=parseInt(M=M.trim());!isNaN(E)&&E>=0&&(INDEXTITLEOFFSET=E)}INDEXTOPOFFSET=330,t=/^%indextopoffset.*$/m;var C=e.match(t);if(C&&C.length>0){var b=C[0].replace("%indextopoffset",""),S=parseInt(b=b.trim());!isNaN(S)&&S>=0&&(INDEXTOPOFFSET=S+300)}TOCFONTSIZE=13,t=/^%tocfontsize.*$/m;var B=e.match(t);if(B&&B.length>0){var u=B[0].replace("%tocfontsize",""),m=parseInt(u=u.trim());!isNaN(m)&&m>0&&(TOCFONTSIZE=m)}TOCLINESPACING=12,t=/^%toclinespacing.*$/m;var v=e.match(t);if(v&&v.length>0){var p=v[0].replace("%toclinespacing",""),f=parseInt(p=p.trim());!isNaN(f)&&f>=0&&(TOCLINESPACING=f)}TOCTITLESIZE=18,t=/^%toctitlefontsize.*$/m;var L=e.match(t);if(L&&L.length>0){var u=L[0].replace("%toctitlefontsize",""),m=parseInt(u=u.trim());!isNaN(m)&&m>0&&(TOCTITLESIZE=m)}TOCTITLEOFFSET=35,t=/^%toctitleoffset.*$/m;var R=e.match(t);if(R&&R.length>0){var M=R[0].replace("%toctitleoffset",""),E=parseInt(M=M.trim());!isNaN(E)&&E>=0&&(TOCTITLEOFFSET=E)}TOCTOPOFFSET=330,t=/^%toctopoffset.*$/m;var H=e.match(t);if(H&&H.length>0){var b=H[0].replace("%toctopoffset",""),S=parseInt(b=b.trim());!isNaN(S)&&S>=0&&(TOCTOPOFFSET=S+300)}gPDFQuality=.75,t=/^%pdfquality.*$/m;var F=e.match(t);if(F&&F.length>0){var N=F[0].replace("%pdfquality",""),P=parseFloat(N=N.trim());!isNaN(P)&&P>=0&&(gPDFQuality=P)}gIncludePageLinks=!0,t=/^%no_toc_or_index_links.*$/m;var _=e.match(t);_&&_.length>0&&(gIncludePageLinks=!1),gForcePDFFilename="",gDoForcePDFFilename=!1,t=/^%pdfname.*$/m;var D=e.match(t);D&&D.length>0&&(gDoForcePDFFilename=!0,""==(gForcePDFFilename=(gForcePDFFilename=D[0].replace("%pdfname","")).trim())&&(gDoForcePDFFilename=!1)),thePageHeaderURL="",thePageFooterURL="",t=/^%urlpageheader.*$/m;var w=e.match(t);if(w&&w.length>0){var k=w[0].replace("%urlpageheader ",""),z=(k=k.trim()).split(" ");z.length>1&&(thePageHeaderURL=z[0],thePageHeader=(thePageHeader=k.replace(thePageHeaderURL,"")).trim())}t=/^%urlpagefooter.*$/m;var O=e.match(t);if(O&&O.length>0){var U=O[0].replace("%urlpagefooter ",""),z=(U=U.trim()).split(" ");z.length>1&&(thePageFooterURL=z[0],thePageFooter=(thePageFooter=U.replace(thePageFooterURL,"")).trim())}theTunebookTPURL="",theTunebookTPSTURL="",t=/^%urladdtitle.*$/m;var Y=e.match(t);if(Y&&Y.length>0){var Q=Y[0].replace("%urladdtitle ","");theTunebookTP=Q.trim();var z=Q.split(" ");z.length>1&&(theTunebookTPURL=z[0],theTunebookTP=(theTunebookTP=Q.replace(theTunebookTPURL,"")).trim(),TunebookTPRequested=!0)}t=/^%urladdsubtitle.*$/m;var G=e.match(t);if(G&&G.length>0){var J=G[0].replace("%urladdsubtitle ","");theTunebookTPST=J.trim();var z=J.split(" ");z.length>1&&(theTunebookTPSTURL=z[0],theTunebookTPST=(theTunebookTPST=J.replace(theTunebookTPSTURL,"")).trim(),TunebookTPSTRequested=!0)}gAddTOCLinkback=!1,t=/^%addlinkbacktotoc.*$/m;var V=e.match(t);V&&V.length>0&&(gAddTOCLinkback=!0),gAddIndexLinkback=!1,t=/^%addlinkbacktoindex.*$/m;var W=e.match(t);W&&W.length>0&&(gAddIndexLinkback=!0),gAddTheSessionHyperlinks=!1,t=/^%add_all_links_to_thesession.*$/m;var X=e.match(t);X&&X.length>0&&(gAddTheSessionHyperlinks=!0),t=/^%addlinkstothesession.*$/m,(X=e.match(t))&&X.length>0&&(gAddTheSessionHyperlinks=!0),gAddPlaybackHyperlinks=!1,t=/^%add_all_playback_links.*$/m;var Z=e.match(t);if(Z&&Z.length>0){gAddPlaybackHyperlinks=!0;var q=Z[0].replace("%add_all_playback_links",""),K=(q=q.trim()).match(/\b(\w+)\b/g);gPlaybackHyperlinkMelodyProgram=gTheMelodyProgram,gPlaybackHyperlinkBassChordProgram=gTheChordProgram,K&&K.length>0&&(K.length>=1&&(gPlaybackHyperlinkMelodyProgram=(gPlaybackHyperlinkMelodyProgram=K[0]).trim()),K.length>1&&(gPlaybackHyperlinkBassChordProgram=(gPlaybackHyperlinkBassChordProgram=K[1]).trim()))}gAppendXValuesToTuneNames=!1,t=/^%append_x_values_to_names.*$/m;var ee=e.match(t);ee&&ee.length>0&&(gAppendXValuesToTuneNames=!0)}function ProcessHeaderFooter(e,t,n){var o=getDescriptiveFileName(n,!0);if(gDoForcePDFFilename){var a=o;""==(o=(o=(o=gForcePDFFilename).trim()).replace(".pdf",""))&&(o=a)}var r=e.replace("$PDFNAME",o+".pdf");r=(r=(r=r.replace("$PAGENUMBER",t)).replace("$TUNECOUNT",totalTunes)).replace("$TUNENAMES",theHeaderFooterTuneNames);var l=formatDate(0),s=formatDate(1);r=(r=r.replace("$DATEMDY",l)).replace("$DATEYMD",s);var d=formatTime();return r.replace("$TIME",d)}function calcPageNumberVerticalOffset(e){thePageNumberVerticalOffset=e.internal.pageSize.getHeight()-9}function AddPageHeaderFooter(e,t,n,o,a,r){var l=PAGENUMBERTOP;l="letter"==r?PAGENUMBERTOP:PAGENUMBERTOPA4,e.setFont("Times","","normal"),e.setFontSize(HEADERFOOTERFONTSIZE);var s=!1;if(thePageHeader&&""!=thePageHeader){var d=ProcessHeaderFooter(thePageHeader,n,totalTunes);if(thePageHeaderURL&&""!=thePageHeaderURL){var A=e.getTextWidth(d);e.textWithLink(d,e.internal.pageSize.getWidth()/3.1-A/2,l,{align:"left",url:thePageHeaderURL})}else e.text(d,e.internal.pageSize.getWidth()/3.1,l,{align:"center"});s=!0}var g=!1;if(thePageFooter&&""!=thePageFooter){var c=ProcessHeaderFooter(thePageFooter,n,totalTunes);if(thePageFooterURL&&""!=thePageFooterURL){var A=e.getTextWidth(c);e.textWithLink(c,e.internal.pageSize.getWidth()/3.1-A/2,thePageNumberVerticalOffset,{align:"center",url:thePageFooterURL})}else e.text(c,e.internal.pageSize.getWidth()/3.1,thePageNumberVerticalOffset,{align:"center"});g=!0}if(t&&(!a||1!=n)){e.setFont("Times","","normal"),e.setFontSize(HEADERFOOTERFONTSIZE);var T=""+n;switch(o){case"tl":e.text(T,13,l,{align:"center"});break;case"tc":s||e.text(T,e.internal.pageSize.getWidth()/3.1,l,{align:"center"});break;case"tr":e.text(T,e.internal.pageSize.getWidth()/1.55-12,l,{align:"center"});break;case"bl":e.text(T,13,thePageNumberVerticalOffset,{align:"center"});break;case"bc":g||e.text(T,e.internal.pageSize.getWidth()/3.1,thePageNumberVerticalOffset,{align:"center"});break;case"br":e.text(T,e.internal.pageSize.getWidth()/1.55-12,thePageNumberVerticalOffset,{align:"center"});break;case"tlr":n%2==1?e.text(T,13,l,{align:"center"}):e.text(T,e.internal.pageSize.getWidth()/1.55-12,l,{align:"center"});break;case"trl":n%2==1?e.text(T,e.internal.pageSize.getWidth()/1.55-12,l,{align:"center"}):e.text(T,13,l,{align:"center"});break;case"blr":n%2==1?e.text(T,13,thePageNumberVerticalOffset,{align:"center"}):e.text(T,e.internal.pageSize.getWidth()/1.55-12,thePageNumberVerticalOffset,{align:"center"});break;case"brl":n%2==1?e.text(T,e.internal.pageSize.getWidth()/1.55-12,thePageNumberVerticalOffset,{align:"center"}):e.text(T,13,thePageNumberVerticalOffset,{align:"center"})}}}function PrimeWhistleRender(e,t){if(e.length<2){t();return}qualitaet=1200;var n=e[0].querySelector("svg");theOffscreen.innerHTML="<div>"+n.outerHTML+"</div>",(n=theOffscreen.querySelector("svg")).setAttribute("width",qualitaet),htmlToImage.toCanvas(n,{backgroundColor:"white",style:{background:"white"},pixelRatio:2*gPDFQuality}).then(function(n){var o=e[1].querySelector("svg");theOffscreen.innerHTML="<div>"+o.outerHTML+"</div>",(o=theOffscreen.querySelector("svg")).setAttribute("width",qualitaet),htmlToImage.toCanvas(o,{backgroundColor:"white",style:{background:"white"},pixelRatio:2*gPDFQuality}).then(function(n){var o,a=(o=e.length<3?e[1]:e[2]).querySelector("svg");theOffscreen.innerHTML="<div>"+a.outerHTML+"</div>",(a=theOffscreen.querySelector("svg")).setAttribute("width",qualitaet),htmlToImage.toCanvas(a,{backgroundColor:"white",style:{background:"white"},pixelRatio:2*gPDFQuality}).then(function(e){t()})})})}function RenderPDFBlock(e,t,n,o,a,r,l,s,d,A){if(null!=e&&void 0!=e){var g=1;if(d){var c=e.id+".block";if(-1==c.indexOf("_0.block")&&-1==c.indexOf("_1.block")){A();return}g=2}var T=e.querySelector("svg");theOffscreen.innerHTML="<div>"+T.outerHTML+"</div>",(T=theOffscreen.querySelector("svg")).setAttribute("width",qualitaet),htmlToImage.toCanvas(T,{backgroundColor:"white",style:{background:"white"},pixelRatio:2*gPDFQuality}).then(function(t){var a=PAGELEFTOFFSET;"a4"==s&&(a=PAGELEFTOFFSETA4);var r=a,l=a+267.5;1==column_number&&(a=l);var c=PAGEHEIGHTLETTER;"a4"==s&&(c=PAGEHEIGHTA4),pdf.internal.scaleFactor=PDFSCALEFACTOR;var T=t.toDataURL("image/jpeg",PDFJPGQUALITY),u=e.id+".block",m=!1;-1!=u.indexOf("_0.block")&&(m=!0,isFirstPage?(isFirstPage=!1,calcPageNumberVerticalOffset(pdf)):n?(running_height=PAGETOPOFFSET,theCurrentPageNumber++,pdf.addPage(s),document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"):o[tunesProcessed-1]?d?0==column_number?(running_height=PAGETOPOFFSET,column_number=1,a=l):(running_height=PAGETOPOFFSET,theCurrentPageNumber++,pdf.addPage(s),document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages",column_number=0,a=r):(running_height=PAGETOPOFFSET,theCurrentPageNumber++,pdf.addPage(s),document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"):running_height+=BETWEENTUNESPACE/g,theTunePageMap[tunesProcessed]=theCurrentPageNumber,++tunesProcessed<totalTunes&&(document.getElementById("statustunecount").innerHTML='Rendering tune <font color="red">'+(tunesProcessed+1)+'</font> of  <font color="red">'+totalTunes+"</font>")),height=parseInt(535*t.height/t.width),running_height+(height/=g)<=c-PAGEBOTTOMOFFSET?(m&&gTuneHyperlinks.push({page:theCurrentPageNumber,x:a,y:running_height,width:535/g,height:height,url:""}),pdf.addImage(T,"JPG",a,running_height,535/g,height)):(running_height=PAGETOPOFFSET,theCurrentPageNumber++,m&&(gTuneHyperlinks.push({page:theCurrentPageNumber,x:a,y:running_height,width:535/g,height:height,url:""}),theTunePageMap[tunesProcessed-1]=theCurrentPageNumber),pdf.addPage(s),pdf.addImage(T,"JPG",a,running_height,535/g,height),document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),running_height=running_height+height+1/g,A(!0)})}}function promptForPDFFilename(e,t){if(ParseCommentCommands(gTheABC.value),gDoForcePDFFilename){var n=e;""==(e=(e=(e=gForcePDFFilename).trim()).replace(".pdf",""))&&(e=n)}DayPilot.Modal.prompt("Please enter a filename for your PDF file:",e+".pdf",{theme:"modal_flat",top:194,autoFocus:!1}).then(function(e){var n=e.result;null==n||(0!=(n=n.replace(/[^a-zA-Z0-9_\-. ]+/ig,"")).length?gIsAndroid||gIsIOS?(n=n.replace(/\..+$/,""),n+=".pdf"):n.endsWith(".pdf")||(n=n.replace(/\..+$/,""),n+=".pdf"):n=null),t(n)})}function ExportPDF(){if(!gRenderingPDF&&gAllowPDF){var e=document.getElementById("pdfformat"),t=e.options[e.selectedIndex].value;totalTunes=CountTunes();var n=getDescriptiveFileName(totalTunes,!0);if("incipits_abc"==t||"incipits_a4_abc"==t||"incipits_abc_sort"==t||"incipits_a4_abc_sort"==t)promptForPDFFilename(n+="_Incipits",function(e){e?ExportTextIncipitsPDF(e):gAppendXValuesToTuneNames=!1});else{var e=document.getElementById("pdfformat"),t=e.options[e.selectedIndex].value;("incipits"==t||"incipits_a4"==t)&&(n+="_Incipits"),promptForPDFFilename(n,function(e){e&&ExportNotationPDF(e)})}}}function ExportTextIncipitsPDF(e){gPDFCancelRequested=!1;var t=document.getElementById("pdfformat"),n=t.options[t.selectedIndex].value;document.getElementById("pdf-controls").style.display="block";var o=(t=document.getElementById("pagenumbers")).options[t.selectedIndex].value,a="none"!=o,r="letter";("incipits_a4_abc"==n||"incipits_a4_abc_sort"==n)&&(r="a4");var l=!1;("incipits_abc_sort"==n||"incipits_a4_abc_sort"==n)&&(l=!0);var s=!1;"no"==(t=document.getElementById("firstpage")).options[t.selectedIndex].value&&(s=!0),ParseCommentCommands(gTheABC.value),theRenderTime="",theHeaderFooterTuneNames=GetAllTuneTitles(),theCurrentPageNumber=1,totalTunes=CountTunes(),isFirstPage=!0,document.getElementById("statuspdfname").innerHTML='Generating <font color="red">'+e+"</font>",document.getElementById("statustunecount").innerHTML="",document.getElementById("pagestatustext").innerHTML="&nbsp;",gRenderingPDF=!0,(pdf=new jsPDF("p","pt",r)).setDisplayMode("fullpage","single","UseNone"),pdf.internal.scaleFactor=PDFSCALEFACTOR,calcPageNumberVerticalOffset(pdf),setTimeout(function(){var t=[];t=GenerateTextIncipits(pdf,a,o,s,r,t,l),document.getElementById("statustunecount").innerHTML="ABC Incipits Added!";var n=theCurrentPageNumber;TunebookTPRequested&&(pdf.addPage(r),theCurrentPageNumber++,pdf.movePage(theCurrentPageNumber,1));var d=theCurrentPageNumber,A=1,g=1;TunebookTOCRequested&&DryRunAddTuneTOC(pdf,o,s,r,t,theTunebookSortedTOCTitle,!1,l),g=theCurrentPageNumber-d,g++,TunebookSortedTOCRequested&&DryRunAddTuneTOC(pdf,o,s,r,t,theTunebookSortedTOCTitle,!0,l),theTOCDelta=theCurrentPageNumber-d,theCurrentPageNumber=d,TunebookTPRequested&&(A++,g++,theTOCDelta++),TunebookTOCRequested&&(document.getElementById("statustunecount").innerHTML="Adding Table of Contents",AppendTuneTOC(pdf,o,s,r,t,theTunebookTOCTitle,l,l,gIncludePageLinks,theTOCDelta,A),document.getElementById("statustunecount").innerHTML="Table of Contents Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),TunebookSortedTOCRequested&&(document.getElementById("statustunecount").innerHTML="Adding Sorted Table of Contents",AppendTuneTOC(pdf,o,s,r,t,theTunebookSortedTOCTitle,!0,l,gIncludePageLinks,theTOCDelta,g),document.getElementById("statustunecount").innerHTML="Sorted Table of Contents Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),TunebookTPRequested&&(document.getElementById("statustunecount").innerHTML="Adding Title Page",AppendTuneTitlePage(pdf,r,theTunebookTP,theTunebookTPST),document.getElementById("statustunecount").innerHTML="Title Page Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),d=theCurrentPageNumber-d,TunebookTPRequested&&d++,(TunebookTOCRequested||TunebookSortedTOCRequested)&&(d=theTOCDelta),PostProcessHeadersAndFooters(pdf,a,d+1,n,o,s,r),TunebookIndexRequested&&(document.getElementById("statustunecount").innerHTML="Adding Tunebook Index",AppendTunebookIndex(pdf,o,s,r,t,theTunebookIndexTitle,l,l,gIncludePageLinks,d),document.getElementById("statustunecount").innerHTML="Tunebook Index Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),TunebookSortedIndexRequested&&(document.getElementById("statustunecount").innerHTML="Adding Tunebook Sorted Index",AppendTunebookIndex(pdf,o,s,r,t,theTunebookSortedIndexTitle,!0,l,gIncludePageLinks,d),document.getElementById("statustunecount").innerHTML="Tunebook Sorted Index Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages");var c=!1,T=1,u=!1,m=1,h=theTOCDelta+1,p=theTOCDelta+n;if(gAddTOCLinkback&&(TunebookTOCRequested||TunebookSortedTOCRequested)&&(c=!0,TunebookTPRequested&&(T=2)),gAddIndexLinkback&&(TunebookIndexRequested||TunebookSortedIndexRequested)&&(u=!0,m=n+theTOCDelta+1),(c||u)&&PostProcessTOCAndIndexLinks(pdf,h,p,c,T,u,m),gQRCodeRequested)document.getElementById("statustunecount").innerHTML="Adding QR Code",AppendQRCode(pdf,r,function e(t){t?(theCurrentPageNumber++,document.getElementById("statustunecount").innerHTML="QR Code Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"):document.getElementById("statustunecount").innerHTML="Share URL too long for QR Code, try sharing fewer tunes";var n=1e3;t||(n=4e3),setTimeout(function(){document.getElementById("statustunecount").innerHTML="&nbsp;",f()},n)});else{f();return}function f(){document.getElementById("statuspdfname").innerHTML='<font color="red">Rendering Complete!</font>',setTimeout(function(){document.getElementById("statuspdfname").innerHTML='Saving <font color="red">'+e+"</font>",setTimeout(function(){if(gIsAndroid||gIsIOS){var t=pdf.output("blob",{filename:e}),n=new Blob([t],{type:"application/octet-stream"}),o=document.createElement("a");document.body.appendChild(o),o.style="display: none",url=window.URL.createObjectURL(n),o.href=url,o.download=e,o.click(),document.body.removeChild(o),setTimeout(function(){window.URL.revokeObjectURL(url)},1e3)}else pdf.save(e);document.getElementById("statuspdfname").innerHTML="&nbsp;",document.getElementById("statustunecount").innerHTML="&nbsp;",document.getElementById("pagestatustext").innerHTML="&nbsp;",document.getElementById("pdf-controls").style.display="none",gAppendXValuesToTuneNames=!1,gRenderingPDF=!1},1500)},2e3)}},250)}function ExportNotationPDF(e){gPDFCancelRequested=!1,gPDFTabselected=GetRadioValue("notenodertab"),document.getElementById("pdf-controls").style.display="block";var t=document.getElementById("pdfformat"),n=t.options[t.selectedIndex].value,o=(t=document.getElementById("pagenumbers")).options[t.selectedIndex].value,a="one"==n||"one_a4"==n,r="none"!=o,l="letter";("one_a4"==n||"multi_a4"==n||"incipits_a4"==n)&&(l="a4");var s="incipits"==n||"incipits_a4"==n,d=!1;"no"==(t=document.getElementById("firstpage")).options[t.selectedIndex].value&&(d=!0),ParseCommentCommands(gTheABC.value),theRenderTime="",theHeaderFooterTuneNames=GetAllTuneTitles(),theCurrentPageNumber=1,tunesProcessed=0,column_number=0,theTunePageMap=[],totalTunes=CountTunes(),isFirstPage=!0;var A=0,g=[],c=null,T=0,u=null,m=!1;function h(){running_height=PAGETOPOFFSET,qualitaet=1200,document.getElementById("statuspdfname").innerHTML='Generating <font color="red">'+e+"</font>",document.getElementById("statustunecount").innerHTML="Processing notation for PDF generation",document.getElementById("pagestatustext").innerHTML="&nbsp;",theOffscreen=document.getElementById("offscreenrender"),PrepareSVGDivsForRasterization(),document.getElementById("statustunecount").innerHTML='Rendering tune <font color="red">1</font> of  <font color="red">'+totalTunes+"</font>",theTunePageMap[0]=theCurrentPageNumber,gRenderingPDF=!0,(pdf=new jsPDF("p","pt",l)).setDisplayMode("fullpage","single","UseNone"),g=[],a||(g=scanTunesForPageBreaks(pdf,l,s)),T=(c=document.querySelectorAll('div[class="block"]')).length,u=c[0],"whistle"==gPDFTabselected?PrimeWhistleRender(c,p):p()}function p(){setTimeout(function(){RenderPDFBlock(u,0,a,g,r,o,d,l,s,t);function t(){if(gPDFCancelRequested){(gRenderingPDF=!1,pdf=null,c=null,m)?(document.getElementById("statuspdfname").innerHTML='<font color="red">Cleaning up incipit generation</font>',gAppendXValuesToTuneNames=!1,RenderAsync(!0,null,function(){document.getElementById("pdf-controls").style.display="none",document.getElementById("offscreenrender").innerHTML=""})):(document.getElementById("pdf-controls").style.display="none",RestoreSVGDivsAfterRasterization());return}if(++A==T){var n=theCurrentPageNumber;TunebookTPRequested&&(pdf.addPage(l),theCurrentPageNumber++,pdf.movePage(theCurrentPageNumber,1));var h=theCurrentPageNumber,p=1,f=1;TunebookTOCRequested&&DryRunAddTuneTOC(pdf,o,d,l,theTunePageMap,theTunebookTOCTitle,!1,!1),f=theCurrentPageNumber-h,f++,TunebookSortedTOCRequested&&DryRunAddTuneTOC(pdf,o,d,l,theTunePageMap,theTunebookSortedTOCTitle,!0,!1),theTOCDelta=theCurrentPageNumber-h,theCurrentPageNumber=h,TunebookTPRequested&&(p++,f++,theTOCDelta++),TunebookTOCRequested&&(document.getElementById("statustunecount").innerHTML="Adding Table of Contents",AppendTuneTOC(pdf,o,d,l,theTunePageMap,theTunebookTOCTitle,!1,!1,gIncludePageLinks,theTOCDelta,p),document.getElementById("statustunecount").innerHTML="Table of Contents Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),TunebookSortedTOCRequested&&(document.getElementById("statustunecount").innerHTML="Adding Sorted Table of Contents",AppendTuneTOC(pdf,o,d,l,theTunePageMap,theTunebookSortedTOCTitle,!0,!1,gIncludePageLinks,theTOCDelta,f),document.getElementById("statustunecount").innerHTML="Sorted Table of Contents Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),TunebookTPRequested&&(document.getElementById("statustunecount").innerHTML="Adding Title Page",AppendTuneTitlePage(pdf,l,theTunebookTP,theTunebookTPST),document.getElementById("statustunecount").innerHTML="Title Page Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),h=theCurrentPageNumber-h,TunebookTPRequested&&h++,(TunebookTOCRequested||TunebookSortedTOCRequested)&&(h=theTOCDelta),PostProcessHeadersAndFooters(pdf,r,h+1,n,o,d,l),TunebookIndexRequested&&(document.getElementById("statustunecount").innerHTML="Adding Tunebook Index",AppendTunebookIndex(pdf,o,d,l,theTunePageMap,theTunebookIndexTitle,!1,!1,gIncludePageLinks,h),document.getElementById("statustunecount").innerHTML="Tunebook Index Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),TunebookSortedIndexRequested&&(document.getElementById("statustunecount").innerHTML="Adding Tunebook Sorted Index",AppendTunebookIndex(pdf,o,d,l,theTunePageMap,theTunebookSortedIndexTitle,!0,!1,gIncludePageLinks,h),document.getElementById("statustunecount").innerHTML="Tunebook Sorted Index Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages");var I=!1,$=1,M=!1,E=1,C=theTOCDelta+1,b=theTOCDelta+n;if(gAddTOCLinkback&&(TunebookTOCRequested||TunebookSortedTOCRequested)&&(I=!0,TunebookTPRequested&&($=2)),gAddIndexLinkback&&(TunebookIndexRequested||TunebookSortedIndexRequested)&&(M=!0,E=n+theTOCDelta+1),(I||M)&&PostProcessTOCAndIndexLinks(pdf,C,b,I,$,M,E),gTuneHyperlinks.length>0&&PostProcessTuneHyperlinks(pdf,gTuneHyperlinks,l,C),gQRCodeRequested)document.getElementById("statustunecount").innerHTML="Adding QR Code",AppendQRCode(pdf,l,function e(t){t?(theCurrentPageNumber++,document.getElementById("statustunecount").innerHTML="QR Code Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"):document.getElementById("statustunecount").innerHTML="Share URL too long for QR Code, try sharing fewer tunes";var n=1e3;t||(n=4e3),setTimeout(function(){document.getElementById("statustunecount").innerHTML="&nbsp;",S()},n)});else{S();return}function S(){document.getElementById("statuspdfname").innerHTML='<font color="red">Rendering Complete!</font>',setTimeout(function(){e&&(document.getElementById("statuspdfname").innerHTML='Saving <font color="red">'+e+"</font>"),setTimeout(function(){if(gIsAndroid||gIsIOS){var t=pdf.output("blob",{filename:e}),n=new Blob([t],{type:"application/octet-stream"}),o=document.createElement("a");document.body.appendChild(o),o.style="display: none",url=window.URL.createObjectURL(n),o.href=url,o.download=e,o.click(),document.body.removeChild(o),setTimeout(function(){window.URL.revokeObjectURL(url)},1e3)}else pdf.save(e);function a(){document.getElementById("statuspdfname").innerHTML="&nbsp;",document.getElementById("statustunecount").innerHTML="&nbsp;",document.getElementById("pagestatustext").innerHTML="&nbsp;",document.getElementById("pdf-controls").style.display="none"}m?(document.getElementById("statuspdfname").innerHTML='<font color="red">Cleaning up after incipit generation</font>',setTimeout(function(){gRenderingPDF=!1,gAppendXValuesToTuneNames=!1,Render(!0,null),document.getElementById("offscreenrender").innerHTML="",a()},100)):(RestoreSVGDivsAfterRasterization(),a(),gRenderingPDF=!1)},1500)},2e3)}}else{if(A>c.length)return;A>0&&(c[A-1]=null),(u=c[A])&&RenderPDFBlock(u,A,a,g,r,o,d,l,s,t)}}},250)}gTuneHyperlinks=[],BETWEENTUNESPACE=20,s?(BETWEENTUNESPACE=0,IdleAdvancedControls(!0),gAllowFilterAnnotations&&!gStripAnnotations||gAllowFilterText&&!gStripTextAnnotations||gAllowShowTabNames&&gShowTabNames?(document.getElementById("statuspdfname").innerHTML='Generating <font color="red">'+e+"</font>",document.getElementById("statustunecount").innerHTML="Processing incipits for PDF generation",document.getElementById("pagestatustext").innerHTML="&nbsp;",setTimeout(function(){var e=gStripAnnotations;gStripAnnotations=!0;var t=gStripTextAnnotations;gStripTextAnnotations=!0;var n=gShowTabNames;gAllowShowTabNames&&(gShowTabNames=!1),Render(!0,null),gStripAnnotations=e,gStripTextAnnotations=t,gAllowShowTabNames&&(gShowTabNames=n),m=!0,h()},100)):h()):gAppendXValuesToTuneNames?(document.getElementById("statuspdfname").innerHTML='Generating <font color="red">'+e+"</font>",document.getElementById("statustunecount").innerHTML="Processing tune numbering for PDF generation",document.getElementById("pagestatustext").innerHTML="&nbsp;",setTimeout(function(){var e,t=gTheABC.value;t=processXTuneNameValues(t),RenderTheNotes(t,GetRadioValue("notenodertab"),!0,0),m=!0,h()},100)):h()}function CancelPDF(){gPDFCancelRequested=!0}function getNextSiblings(e,t){for(var n=[];e=e.nextSibling;)(!t||t(e))&&n.push(e);return n}function getStyleProp(e,t){return window.getComputedStyle?window.getComputedStyle(e,null).getPropertyValue(t):e.currentStyle?e.currentStyle[t]:void 0}function GetABCJSParams(e){var t,n="",o="";if(e&&gShowTabNames)switch(gCapo>0&&(n=" (Capo "+gCapo+")"),e){case"noten":break;case"notenames":case"whistle":case"bc":case"cd":o=" ";break;case"mandolin":o="Mandolin"+n;break;case"gdad":o="GDAD"+n;break;case"mandola":o="GCDA"+n;break;case"guitare":o="Guitar"+n;break;case"guitard":o="DADGAD"+n}var a="Times-Roman 18",r="Times-Roman 13.5",l={titlefont:a,subtitlefont:r,infofont:r,partsfont:r,tempofont:r,textfont:r,composerfont:r,annotationfont:r,partsfont:r,gchordfont:"Verdana 12",vocalfont:r,wordsfont:r,tabnumberfont:"Arial 12"},s={titlefont:a,subtitlefont:r,infofont:r,partsfont:r,tempofont:r,textfont:r,composerfont:r,annotationfont:r,partsfont:r,gchordfont:"Verdana 12",vocalfont:r,wordsfont:r,tabnumberfont:"Arial"+gBoxTabFontSize};return e?"noten"==e?t={responsive:"resize",oneSvgPerLine:"true",selectTypes:!1,format:l}:"mandolin"==e?t={tablature:[{instrument:"violin",label:o,tuning:["G,","D","A","e"],highestNote:"f'",capo:gCapo}],responsive:"resize",oneSvgPerLine:"true",selectTypes:!1,format:l}:"gdad"==e?t={tablature:[{instrument:"violin",label:o,tuning:["G,","D","A","d"],highestNote:"f'",capo:gCapo}],responsive:"resize",oneSvgPerLine:"true",selectTypes:!1,format:l}:"mandola"==e?t={tablature:[{instrument:"violin",label:o,tuning:["C","G","d","a"],highestNote:"f'",capo:gCapo}],responsive:"resize",oneSvgPerLine:"true",selectTypes:!1,format:l}:"guitare"==e?t={tablature:[{instrument:"guitar",label:o,tuning:["E,","A,","D","G","B","e"],highestNote:"f'",capo:gCapo}],responsive:"resize",oneSvgPerLine:"true",selectTypes:!1,format:l}:"guitard"==e?t={tablature:[{instrument:"guitar",label:o,tuning:["D,","A,","D","G","A","d"],highestNote:"f'",capo:gCapo}],responsive:"resize",oneSvgPerLine:"true",selectTypes:!1,format:l}:"notenames"==e?(l.tabnumberfont="Arial 12",t={tablature:[{instrument:"violin",label:o,tuning:["G,,,","G,,","G,"],highestNote:"b'"}],responsive:"resize",oneSvgPerLine:"true",selectTypes:!1,format:l}):"whistle"==e?t={tablature:[{instrument:"violin",label:o,tuning:["G,"],highestNote:"^a'"}],responsive:"resize",oneSvgPerLine:"true",selectTypes:!1,format:l}:"bc"==e?t={tablature:[{instrument:"violin",label:o,tuning:["^D,,,","^D,,","^D,"],highestNote:"^a'"}],responsive:"resize",oneSvgPerLine:"true",selectTypes:!1,format:s}:"cd"==e&&(t={tablature:[{instrument:"violin",label:o,tuning:["F,,,","F,,","F,"],highestNote:"^a'"}],responsive:"resize",oneSvgPerLine:"true",selectTypes:!1,format:s}):(t={responsive:"resize",oneSvgPerLine:"true",selectTypes:!1,format:l},e=""),t}function UpdateLocalStorage(){if(gLocalStorageAvailable){var e=GetRadioValue("notenodertab");localStorage.abcTab=e;var t=document.getElementById("capo").value;localStorage.abcCapo=t;var n=document.getElementById("staff-spacing").value;localStorage.abcStaffSpacing=n;var o=document.getElementById("pdfformat").value;localStorage.abcTunesPerPage=o;var a=document.getElementById("pagenumbers").value;localStorage.abcPageNumberLocation=a;var r=document.getElementById("firstpage").value;localStorage.abcPageNumberOnPageOne=r,gTopBarShowing?localStorage.abcHideTopBar="false":localStorage.abcHideTopBar="true",gShowTabNames?localStorage.abcShowTabNames="true":localStorage.abcShowTabNames="false"}}function RecalcShareURLPDF(){UpdateLocalStorage(),"none"!=document.getElementById("urlarea").style.display&&FillUrlBoxWithAbcInLZW(null)}function PrepareSVGDivsForRasterization(){document.getElementById("offscreenrender").innerHTML="";for(var e=CountTunes(),t=0;t<e;++t){var n,o,a="notation"+t,r=document.querySelectorAll('div[id="'+a+'"] > div'),l=r.length;for(n=0;n<l;++n)(o=r.item(n)).classList.add("block"),o.id="block_"+t+"_"+n}}function RestoreSVGDivsAfterRasterization(){document.getElementById("offscreenrender").innerHTML="";for(var e=CountTunes(),t=0;t<e;++t){var n,o,a="notation"+t,r=document.querySelectorAll('div[id="'+a+'"] > div'),l=r.length;for(n=0;n<l;++n)(o=r.item(n)).removeAttribute("class"),o.removeAttribute("id")}}function RenderTheNotes(e,t,n,o){var a=GetABCJSParams(t),r=[],l=0,s=0,d=0;if(n){d=l=CountTunes();for(var A=0;A<l;++A)r.push("notation"+A)}else l=1,s=o,d=o+1,r.push("notation"+o);if(0!=l){ABCJS.renderAbc(r,e,a);for(var g=s;g<d;++g){var c="notation"+g;if("whistle"==t){var T=document.querySelectorAll('div[id="'+c+'"] > div > svg > g > g > [class="abcjs-top-line"]');for(x=0;x<T.length;x++)if(x%2!=0){T[x].setAttribute("class","tabstrich");var u=getNextSiblings(T[x]);for(y=0;y<u.length;y++)u[y].setAttribute("class","tabstrich")}var m=document.querySelectorAll('div[id="'+c+'"] > div > svg > g > g[data-name="tabNumber"] > text > tspan');for(x=0;x<m.length;x++)m[x].setAttribute("class","whistle"),"0"==m[x].innerHTML?m[x].innerHTML="g":"1"==m[x].innerHTML?m[x].innerHTML="m":"2"==m[x].innerHTML?m[x].innerHTML="a":"3"==m[x].innerHTML?m[x].innerHTML="i":"4"==m[x].innerHTML?m[x].innerHTML="b":"5"==m[x].innerHTML?m[x].innerHTML="c":"6"==m[x].innerHTML?m[x].innerHTML="j":"7"==m[x].innerHTML?m[x].innerHTML="d":"8"==m[x].innerHTML?m[x].innerHTML="k":"9"==m[x].innerHTML?m[x].innerHTML="e":"10"==m[x].innerHTML?m[x].innerHTML="f":"11"==m[x].innerHTML?m[x].innerHTML="l":"12"==m[x].innerHTML?m[x].innerHTML="g":"13"==m[x].innerHTML?m[x].innerHTML="m":"14"==m[x].innerHTML?m[x].innerHTML="a":"15"==m[x].innerHTML?m[x].innerHTML="i":"16"==m[x].innerHTML?m[x].innerHTML="b":"17"==m[x].innerHTML?m[x].innerHTML="c":"18"==m[x].innerHTML?m[x].innerHTML="j":"19"==m[x].innerHTML?m[x].innerHTML="D":"20"==m[x].innerHTML?m[x].innerHTML="K":"21"==m[x].innerHTML?m[x].innerHTML="E":"22"==m[x].innerHTML?m[x].innerHTML="F":"23"==m[x].innerHTML?m[x].innerHTML="L":"24"==m[x].innerHTML?m[x].innerHTML="G":"25"==m[x].innerHTML?m[x].innerHTML="M":"26"==m[x].innerHTML?m[x].innerHTML="A":"27"==m[x].innerHTML?m[x].innerHTML="I":"28"==m[x].innerHTML?m[x].innerHTML="B":"29"==m[x].innerHTML?m[x].innerHTML="C":"30"==m[x].innerHTML?m[x].innerHTML="J":"31"==m[x].innerHTML?m[x].innerHTML="D":"32"==m[x].innerHTML?m[x].innerHTML="K":"33"==m[x].innerHTML?m[x].innerHTML="E":"34"==m[x].innerHTML?m[x].innerHTML="F":"35"==m[x].innerHTML?m[x].innerHTML="L":"36"==m[x].innerHTML?m[x].innerHTML="G":"37"==m[x].innerHTML?m[x].innerHTML="M":"38"==m[x].innerHTML&&(m[x].innerHTML="A")}if("bc"==t||"cd"==t){var T=document.querySelectorAll('div[id="'+c+'"] > div > svg > g > g > [class="abcjs-top-line"]');for(x=0;x<T.length;x++)if(x%2!=0){T[x].setAttribute("class","tabstrich");var u=getNextSiblings(T[x]);for(y=0;y<u.length;y++)u[y].setAttribute("class","tabstrich")}var m=document.querySelectorAll('div[id="'+c+'"] > div > svg > g > g[data-name="tabNumber"] > text > tspan');for(x=0;x<m.length;x++)"0"==m[x].innerHTML?m[x].innerHTML="":"1"==m[x].innerHTML?m[x].innerHTML="1":"2"==m[x].innerHTML?m[x].innerHTML="x":"3"==m[x].innerHTML?m[x].innerHTML="":"4"==m[x].innerHTML?m[x].innerHTML="2":"5"==m[x].innerHTML?m[x].innerHTML="":"6"==m[x].innerHTML?m[x].innerHTML="1":"7"==m[x].innerHTML?m[x].innerHTML="":"8"==m[x].innerHTML?m[x].innerHTML="2":"9"==m[x].innerHTML?m[x].innerHTML="3":"10"==m[x].innerHTML?m[x].innerHTML="":"11"==m[x].innerHTML?m[x].innerHTML="3":"12"==m[x].innerHTML?m[x].innerHTML="":"13"==m[x].innerHTML?m[x].innerHTML="4":"14"==m[x].innerHTML?m[x].innerHTML="4":"15"==m[x].innerHTML?m[x].innerHTML="":"16"==m[x].innerHTML?m[x].innerHTML="5":"17"==m[x].innerHTML?m[x].innerHTML="":"18"==m[x].innerHTML?m[x].innerHTML="5":"19"==m[x].innerHTML?m[x].innerHTML="":"20"==m[x].innerHTML?m[x].innerHTML="6":"21"==m[x].innerHTML?m[x].innerHTML="6":"22"==m[x].innerHTML?m[x].innerHTML="":"23"==m[x].innerHTML?m[x].innerHTML="7":"24"==m[x].innerHTML?m[x].innerHTML="":"25"==m[x].innerHTML?m[x].innerHTML="7":"26"==m[x].innerHTML?m[x].innerHTML="8":"27"==m[x].innerHTML?m[x].innerHTML="":"28"==m[x].innerHTML?m[x].innerHTML="8":"29"==m[x].innerHTML?m[x].innerHTML="":"30"==m[x].innerHTML?m[x].innerHTML="9":"31"==m[x].innerHTML?m[x].innerHTML="":"32"==m[x].innerHTML?m[x].innerHTML="10":"33"==m[x].innerHTML?m[x].innerHTML="9":"34"==m[x].innerHTML?m[x].innerHTML=" ":"35"==m[x].innerHTML?m[x].innerHTML="x":"36"==m[x].innerHTML?m[x].innerHTML="":"37"==m[x].innerHTML?m[x].innerHTML="10":m[x].innerHTML="x"}if("notenames"==t){var h=!0,T=document.querySelectorAll('div[id="'+c+'"] > div > svg > g > g > [class="abcjs-top-line"]');for(x=0;x<T.length;x++)if(x%2!=0){T[x].setAttribute("class","tabstrich");var u=getNextSiblings(T[x]);for(y=0;y<u.length;y++)u[y].setAttribute("class","tabstrich")}var p=document.querySelectorAll('div[id="'+c+'"] > div > svg');if(p&&p.length>1)for(var A=1;A<p.length;++A){h=!0;var f=p[A],I=f.querySelectorAll('g[data-name="staff-extra key-signature"]');I&&I.length>=1&&-1!=I[0].innerHTML.indexOf("accidentals.flat")&&(h=!1);var m=f.querySelectorAll('g[data-name="tabNumber"] > text > tspan');if(h)for(x=0;x<m.length;x++)"0"==m[x].innerHTML?m[x].innerHTML="G,":"1"==m[x].innerHTML?m[x].innerHTML="G,":"2"==m[x].innerHTML?m[x].innerHTML="A,":"3"==m[x].innerHTML?m[x].innerHTML="A,":"4"==m[x].innerHTML?m[x].innerHTML="B,":"5"==m[x].innerHTML?m[x].innerHTML="C":"6"==m[x].innerHTML?m[x].innerHTML="C":"7"==m[x].innerHTML?m[x].innerHTML="D":"8"==m[x].innerHTML?m[x].innerHTML="D":"9"==m[x].innerHTML?m[x].innerHTML="E":"10"==m[x].innerHTML?m[x].innerHTML="F":"11"==m[x].innerHTML?m[x].innerHTML="F":"12"==m[x].innerHTML?m[x].innerHTML="G":"13"==m[x].innerHTML?m[x].innerHTML="G":"14"==m[x].innerHTML?m[x].innerHTML="A":"15"==m[x].innerHTML?m[x].innerHTML="A":"16"==m[x].innerHTML?m[x].innerHTML="B":"17"==m[x].innerHTML?m[x].innerHTML="c":"18"==m[x].innerHTML?m[x].innerHTML="c":"19"==m[x].innerHTML?m[x].innerHTML="d":"20"==m[x].innerHTML?m[x].innerHTML="d":"21"==m[x].innerHTML?m[x].innerHTML="e":"22"==m[x].innerHTML?m[x].innerHTML="f":"23"==m[x].innerHTML?m[x].innerHTML="f":"24"==m[x].innerHTML?m[x].innerHTML="g":"25"==m[x].innerHTML?m[x].innerHTML="g":"26"==m[x].innerHTML?m[x].innerHTML="a":"27"==m[x].innerHTML?m[x].innerHTML="a":"28"==m[x].innerHTML?m[x].innerHTML="b":"29"==m[x].innerHTML?m[x].innerHTML="c'":"30"==m[x].innerHTML?m[x].innerHTML="c'":"31"==m[x].innerHTML?m[x].innerHTML="d'":"32"==m[x].innerHTML?m[x].innerHTML="d'":"33"==m[x].innerHTML?m[x].innerHTML="e'":"34"==m[x].innerHTML?m[x].innerHTML="f'":"35"==m[x].innerHTML?m[x].innerHTML="f'":"36"==m[x].innerHTML?m[x].innerHTML="g'":"37"==m[x].innerHTML?m[x].innerHTML="g'":"38"==m[x].innerHTML?m[x].innerHTML="a'":"39"==m[x].innerHTML?m[x].innerHTML="a'":"40"==m[x].innerHTML?m[x].innerHTML="b'":m[x].innerHTML="?";else for(x=0;x<m.length;x++)"0"==m[x].innerHTML?m[x].innerHTML="G,":"1"==m[x].innerHTML?m[x].innerHTML="A,":"2"==m[x].innerHTML?m[x].innerHTML="A,":"3"==m[x].innerHTML?m[x].innerHTML="B,":"4"==m[x].innerHTML?m[x].innerHTML="B,":"5"==m[x].innerHTML?m[x].innerHTML="C":"6"==m[x].innerHTML?m[x].innerHTML="D":"7"==m[x].innerHTML?m[x].innerHTML="D":"8"==m[x].innerHTML?m[x].innerHTML="E":"9"==m[x].innerHTML?m[x].innerHTML="E":"10"==m[x].innerHTML?m[x].innerHTML="F":"11"==m[x].innerHTML?m[x].innerHTML="G":"12"==m[x].innerHTML?m[x].innerHTML="G":"13"==m[x].innerHTML?m[x].innerHTML="A":"14"==m[x].innerHTML?m[x].innerHTML="A":"15"==m[x].innerHTML?m[x].innerHTML="B":"16"==m[x].innerHTML?m[x].innerHTML="B":"17"==m[x].innerHTML?m[x].innerHTML="c":"18"==m[x].innerHTML?m[x].innerHTML="d":"19"==m[x].innerHTML?m[x].innerHTML="d":"20"==m[x].innerHTML?m[x].innerHTML="e":"21"==m[x].innerHTML?m[x].innerHTML="e":"22"==m[x].innerHTML?m[x].innerHTML="f":"23"==m[x].innerHTML?m[x].innerHTML="g":"24"==m[x].innerHTML?m[x].innerHTML="g":"25"==m[x].innerHTML?m[x].innerHTML="a":"26"==m[x].innerHTML?m[x].innerHTML="a":"27"==m[x].innerHTML?m[x].innerHTML="b":"28"==m[x].innerHTML?m[x].innerHTML="b":"29"==m[x].innerHTML?m[x].innerHTML="c'":"30"==m[x].innerHTML?m[x].innerHTML="d'":"31"==m[x].innerHTML?m[x].innerHTML="d'":"32"==m[x].innerHTML?m[x].innerHTML="e'":"33"==m[x].innerHTML?m[x].innerHTML="e'":"34"==m[x].innerHTML?m[x].innerHTML="f'":"35"==m[x].innerHTML?m[x].innerHTML="g'":"36"==m[x].innerHTML?m[x].innerHTML="g'":"37"==m[x].innerHTML?m[x].innerHTML="a'":"38"==m[x].innerHTML?m[x].innerHTML="a'":"39"==m[x].innerHTML?m[x].innerHTML="b'":"40"==m[x].innerHTML?m[x].innerHTML="b'":m[x].innerHTML="?"}}}}}function SetRadioValue(e,t){let n=document.querySelectorAll('input[name="'+e+'"]');for(let o of n)o.value==t?o.checked=!0:o.checked=!1}function GetRadioValue(e){let t=document.querySelectorAll('input[name="'+e+'"]'),n;for(let o of t)if(o.checked){n=o.value;break}return n}function StripAnnotations(){var e=gTheABC.value;e=StripAnnotationsOne(e),gTheABC.value=e}function StripAnnotationsOne(e){var t=/^Q:.*[\r\n]*/gm;return e=e.replace(t,""),t=/^Z:.*[\r\n]*/gm,e=e.replace(t,""),t=/^R:.*[\r\n]*/gm,e=e.replace(t,""),t=/^S:.*[\r\n]*/gm,e=e.replace(t,""),t=/^N:.*[\r\n]*/gm,e=e.replace(t,""),t=/^D:.*[\r\n]*/gm,e=e.replace(t,""),t=/^H:.*[\r\n]*/gm,e=e.replace(t,""),t=/^B:.*[\r\n]*/gm,e=e.replace(t,""),t=/^C:.*[\r\n]*/gm,e=e.replace(t,""),t=/^O:.*[\r\n]*/gm,e=e.replace(t,"")}function StripTextAnnotations(){var e=gTheABC.value;e=StripTextAnnotationsOne(e),gTheABC.value=e}function StripTextAnnotationsOne(e){var t=/%%text.*[\r\n]*/gm;return e=e.replace(t,""),t=/%%center.*[\r\n]*/gm,e=e.replace(t,"")}function StripChords(){var e=gTheABC.value;e=StripChordsOne(e),gTheABC.value=e}function StripChordsOne(e){return e=e.replace(/"[^"]*"/gm,"")}function processXTuneNameValues(e){for(var t="",n=e.split(/^X:.*$/gm),o=n.length-1,n=e.split(/^X:/gm),a="",r="",l=0;l<o;++l)t+=a="X:"+(r=(r=n[l+1]).replace("T:","T:"+(l+1)+". "));return t}function RenderAsync(e,t,n){!gRenderingPDF&&(document.getElementById("loading-bar-spinner").style.display="none",e?(document.getElementById("loading-bar-spinner").style.display="block",setTimeout(function(){Render(e,t),document.getElementById("loading-bar-spinner").style.display="none",MakeTuneVisible(!0),n&&void 0!=n&&n()},100)):(Render(e,t),n&&void 0!=n&&n()))}function Render(e,t){if(!gRenderingPDF){var n=CountTunes();if(""!=gTheABC.value&&n>0){var o,a=document.getElementById("abc-selected");1==n?a.innerText=gDisplayedName+"  ("+n+" Tune)":a.innerText=gDisplayedName+"  ("+n+" Tunes)";var r=window.pageYOffset;UpdateLocalStorage(),"none"!=document.getElementById("urlarea").style.display&&FillUrlBoxWithAbcInLZW(null),document.getElementById("notation-placeholder").style.display="none",gIsIOS||gIsAndroid?gIsMaximized?document.getElementById("notation-holder").style.display="flex":document.getElementById("notation-holder").style.display="block":gIsMaximized?document.getElementById("notation-holder").style.display="flex":document.getElementById("notation-holder").style.display="inline",document.getElementById("zoombutton").style.display="block",gShowAllControls?document.getElementById("notenrechts").style.display="inline-block":document.getElementById("notenrechts").style.display="none",document.getElementById("saveabcfile").classList.remove("saveabcfiledisabled"),document.getElementById("saveabcfile").classList.add("saveabcfile"),gAllowSave=!0,document.getElementById("toggleallcontrols").classList.remove("toggleallcontrolsdisabled"),document.getElementById("toggleallcontrols").classList.add("toggleallcontrols"),gAllowControlToggle=!0,document.getElementById("saveaspdf").classList.remove("saveaspdfdisabled"),document.getElementById("saveaspdf").classList.add("saveaspdf"),gAllowPDF=!0,document.getElementById("copybutton").classList.remove("copybuttondisabled"),document.getElementById("copybutton").classList.add("copybutton"),document.getElementById("playbutton").classList.remove("playbuttondisabled"),document.getElementById("playbutton").classList.add("playbutton"),gAllowCopy=!0,IdleAdvancedControls(!1),IdleCapoControl(),IdleShowTabNamesControl();var l=GetRadioValue("notenodertab");e?(GenerateRenderingDivs(n),o=gTheABC.value):o=getTuneByIndex(t);var s="";gStripAnnotations&&(s=/^Q:.*$/gm,o=o.replace(s,"% comment"),s=/^Z:.*$/gm,o=o.replace(s,"% comment"),s=/^R:.*$/gm,o=o.replace(s,"% comment"),s=/^S:.*$/gm,o=o.replace(s,"% comment"),s=/^N:.*$/gm,o=o.replace(s,"% comment"),s=/^D:.*$/gm,o=o.replace(s,"% comment"),s=/^H:.*$/gm,o=o.replace(s,"% comment"),s=/^B:.*$/gm,o=o.replace(s,"% comment"),s=/^C:.*$/gm,o=o.replace(s,"% comment"),s=/^O:.*$/gm,o=o.replace(s,"% comment")),gStripTextAnnotations&&(s=/%%text.*$/gm,o=o.replace(s,"% comment"),s=/%%center.*$/gm,o=o.replace(s,"% comment")),gStripChords&&(s=/"[^"]*"/gm,o=o.replace(s,"")),s=/%%center$/gm,o=o.replace(s,"%%vskip 12\n%%center"),s=/^X:.*$/gm,o=o.replace(s,"X:1\n%%musicspace 10\n%%staffsep "+gStaffSpacing),gAppendXValuesToTuneNames&&(o=processXTuneNameValues(o)),RenderTheNotes(o,l,e,t),window.scrollTo(0,r)}else{document.getElementById("notenrechts").style.display="none",document.getElementById("notation-holder").style.display="none",document.getElementById("saveabcfile").classList.remove("saveabcfile"),document.getElementById("saveabcfile").classList.add("saveabcfiledisabled"),gAllowSave=!1,document.getElementById("saveaspdf").classList.remove("saveaspdf"),document.getElementById("saveaspdf").classList.add("saveaspdfdisabled"),gAllowPDF=!1,document.getElementById("toggleallcontrols").classList.remove("toggleallcontrols"),document.getElementById("toggleallcontrols").classList.add("toggleallcontrolsdisabled"),gAllowControlToggle=!1,document.getElementById("copybutton").classList.remove("copybutton"),document.getElementById("copybutton").classList.add("copybuttondisabled"),document.getElementById("playbutton").classList.remove("playbutton"),document.getElementById("playbutton").classList.add("playbuttondisabled"),gAllowCopy=!1,document.getElementById("notation-placeholder").style.display="block",document.getElementById("zoombutton").style.display="none",document.getElementById("loading-bar-spinner").style.display="none";var a=document.getElementById("abc-selected");a.innerText="No ABC file selected",gDisplayedName="No ABC file selected",gABCFromFile=!1,UpdateNotationTopPosition()}}}function ensureABCFile(e){var t="";return e.lastIndexOf(".")>0&&(t=e.substring(e.lastIndexOf(".")+1,e.length)),"abc"==t.toLowerCase()||"txt"==t.toLowerCase()||(DayPilot.Modal.alert("You must select a .abc or .txt file for upload.",{theme:"modal_flat",top:50}),!1)}function HideAdvancedControls(){document.getElementById("toggleadvancedcontrols").value="Show Advanced",document.getElementById("advanced-controls").style.display="none"}function ShowAdvancedControls(){document.getElementById("toggleadvancedcontrols").value="Hide Advanced",document.getElementById("advanced-controls").style.display="flex",IdleAdvancedControls(!1)}function IdleAdvancedControls(e){if(gShowAllControls&&gShowAdvancedControls||e){var t=gTheABC.value,n="",o=!1,a=!1,r=!1,l=!1;n=/^Q:.*$/gm,(l=-1!=t.search(n))||(n=/^Z:.*$/gm,l=-1!=t.search(n)),l||(n=/^R:.*$/gm,l=-1!=t.search(n)),l||(n=/^S:.*$/gm,l=-1!=t.search(n)),l||(n=/^N:.*$/gm,l=-1!=t.search(n)),l||(n=/^D:.*$/gm,l=-1!=t.search(n)),l||(n=/^H:.*$/gm,l=-1!=t.search(n)),l||(n=/^B:.*$/gm,l=-1!=t.search(n)),l||(n=/^C:.*$/gm,l=-1!=t.search(n)),l||(n=/^O:.*$/gm,l=-1!=t.search(n)),o=l,l=!1,n=/%%text.*$/gm,(l=-1!=t.search(n))||(n=/%%center.*$/gm,l=-1!=t.search(n)),a=l,l=!1,n=/"[^"]*"/gm,r=l=-1!=t.search(n),o?(gAllowFilterAnnotations=!0,document.getElementById("toggleannotations").classList.remove("advancedcontrolsdisabled"),document.getElementById("toggleannotations").classList.add("advancedcontrols")):(gAllowFilterAnnotations=!1,document.getElementById("toggleannotations").classList.remove("advancedcontrols"),document.getElementById("toggleannotations").classList.add("advancedcontrolsdisabled")),a?(gAllowFilterText=!0,document.getElementById("toggletext").classList.remove("advancedcontrolsdisabled"),document.getElementById("toggletext").classList.add("advancedcontrols")):(gAllowFilterText=!1,document.getElementById("toggletext").classList.remove("advancedcontrols"),document.getElementById("toggletext").classList.add("advancedcontrolsdisabled")),r?(gAllowFilterChords=!0,document.getElementById("togglechords").classList.remove("advancedcontrolsdisabled"),document.getElementById("togglechords").classList.add("advancedcontrols")):(gAllowFilterChords=!1,document.getElementById("togglechords").classList.remove("advancedcontrols"),document.getElementById("togglechords").classList.add("advancedcontrolsdisabled")),gStripAnnotations?document.getElementById("toggleannotations").value="Show Annotations":document.getElementById("toggleannotations").value="Hide Annotations",gStripTextAnnotations?document.getElementById("toggletext").value="Show Text":document.getElementById("toggletext").value="Hide Text",gStripChords?document.getElementById("togglechords").value="Show Chords":document.getElementById("togglechords").value="Hide Chords"}}function ToggleAdvancedControls(){(gShowAdvancedControls=!gShowAdvancedControls)?ShowAdvancedControls():HideAdvancedControls(),UpdateNotationTopPosition(),gIsOneColumn&&MakeTuneVisible(!0)}function HideShareControls(){document.getElementById("togglesharecontrols").value="Show Sharing",document.getElementById("urlarea").style.display="none"}function ShowShareControls(){document.getElementById("togglesharecontrols").value="Hide Sharing",CreateURLfromHTML()}function ToggleShareControls(){(gShowShareControls=!gShowShareControls)?ShowShareControls():HideShareControls(),UpdateNotationTopPosition(),gIsOneColumn&&MakeTuneVisible(!0)}function SetStaffSpacing(){var e=document.getElementById("staff-spacing").value;gStaffSpacing=(e=parseInt(e))+STAFFSPACEOFFSET,RenderAsync(!0,null)}function SetCapo(){gCapo=document.getElementById("capo").value,RenderAsync(!0,null)}function IdleCapoControl(){var e=GetRadioValue("notenodertab"),t=!1;switch(e){case"noten":case"notenames":case"whistle":case"bc":case"cd":break;case"mandolin":case"gdad":case"mandola":case"guitare":case"guitard":t=!0}t?document.getElementById("capo").disabled=!1:document.getElementById("capo").disabled=!0}function UpdateNotationTopPosition(){var e=document.getElementById("noscroller").offsetHeight;document.getElementById("notation-spacer").style.height=e+"px"}function RestoreDefaults(){gStripAnnotations=!1,gStripTextAnnotations=!1,gStripChords=!1,gTotalTunes=0,gCurrentTune=0,gForceFullRender=!1,gLastAutoScrolledTune=-1;document.getElementById("selectabcfile").value="",clearQRCode(),IdleAdvancedControls(!1),UpdateNotationTopPosition()}function ToggleAnnotations(e){if(gAllowFilterAnnotations){if(e.shiftKey){StripAnnotations(),RenderAsync(!0,null);return}gStripAnnotations=!gStripAnnotations,RenderAsync(!0,null)}}function ToggleTextAnnotations(e){if(gAllowFilterText){if(e.shiftKey){StripTextAnnotations(),RenderAsync(!0,null);return}gStripTextAnnotations=!gStripTextAnnotations,RenderAsync(!0,null)}}function ToggleChords(e){if(gAllowFilterChords){if(e.shiftKey){StripChords(),RenderAsync(!0,null);return}gStripChords=!gStripChords,RenderAsync(!0,null)}}function NewABC(){theValue="% Each tune in the tunebook must start with an X: tag:\n",theValue+="%\n",theValue+="X: 1\n",theValue+="T: Cooley's\n",theValue+="R: Reel\n",theValue+="M: 4/4\n",theValue+="L: 1/8\n",theValue+="K: Edor\n",theValue+="C: Traditional\n",theValue+="%\n",theValue+="% Use an Accordion sound when playing the melody:\n",theValue+="%%MIDI program 21\n",theValue+="%\n",theValue+="% Use an Accordion sound when playing the chords:\n",theValue+="%%MIDI chordprog 21\n",theValue+="%\n",theValue+="% ABC for the tune, both melody and chords:\n",theValue+="%\n",theValue+='|:"Em"EBBA B2 EB|"Em"B2 AB dBAG|"D"F/E/D AD BDAD|"D"F/E/D AD BAGF|\n',theValue+='"Em"EBBA B2 EB|"Em"B2 AB defg|"D"afec dBAF|1 "D"DEFD "Em"E3D:|2 "D"DEFD "Em"E2gf||\n',theValue+='|:"Em"eB (3BBB eBgf|"Em"eBB2 gedB|"D"A/A/A FA DAFA|"D"A/A/A FA defg|\n',theValue+='"Em"eB (3BBB eBgf|"Em"eBBB defg|"D"afec dBAF|1 "D"DEFD "Em"E2gf:|2 "D"DEFD "Em"E4|]\n',theValue+="\n",theValue+="% To choose the instrument used when playing a tune, try changing the MIDI programs above to:\n",theValue+="%\n",theValue+="% Melody:\n",theValue+="% Piano: 0, Accordion: 21, Fingered Bass: 33, Whistle: 78, Fiddle: 110, Melodica: 134, Cajun Accordion: 135\n",theValue+="%\n",theValue+="% Chords:\n",theValue+="% Piano: 0, Electric Piano: 5, Guitar: 25, Bass: 34, Synth Bass: 38\n",theValue+="%\n",theValue+="% Click the MIDI link at the top of the page to see a full list of available instruments.\n",theValue+="%\n",theValue+="% If program or chordprog is not specified and you haven't set default MIDI instruments in the settings, both default to Piano.\n",theValue+="\n",theValue+="% PDF Tunebook Annotations:\n",theValue+="%\n",theValue+="% Try these custom PDF tunebook annotations by removing the extra % and space at the beginning of the line:\n",theValue+="%\n",theValue+="% Before the tunes, add a title page with a title:\n",theValue+="%\n",theValue+="% %addtitle My Tunebook Title Page Title\n",theValue+="%\n",theValue+="% Optional subtitle for the title page:\n",theValue+="%\n",theValue+="% %addsubtitle My Tunebook Title Page Subtitle\n",theValue+="%\n",theValue+="% Before the tunes, add a table of contents with a title:\n",theValue+="%\n",theValue+="% %addtoc My Tunebook Table of Contents\n",theValue+="%\n",theValue+="% Add a << link on each page back to the Table of Contents:\n",theValue+="%\n",theValue+="% %addlinkbacktotoc\n",theValue+="%\n",theValue+="% After the tunes, add a sorted tunebook index with a title:\n",theValue+="%\n",theValue+="% %addsortedindex My Tunebook Index Sorted by Tune Name\n",theValue+="%\n",theValue+="% Add a << link on each page back to the Index:\n",theValue+="%\n",theValue+="% %addlinkbacktoindex\n",theValue+="%\n",theValue+="% Add a PDF page header or footer:\n",theValue+="%\n",theValue+="% %pageheader My Tunebook Page Header\n",theValue+="% %pagefooter My Tunebook Page Footer\n",theValue+="%\n",theValue+="% Clicking on tune titles in the PDF will launch playback in the tool using specific MIDI instrument program number for the melody and bass/chord:\n",theValue+="%\n",theValue+="% %add_all_playback_links 0 0\n",theValue+="%\n",theValue+="% After the tunes, add a sharing QR code on a new page in the PDF:\n",theValue+="%\n",theValue+="% %qrcode\n",theValue+="%\n",gTheABC.value=theValue,FocusABC(),gDisplayedName="No ABC file selected",gABCFromFile=!1,RenderAsync(!0,null,function(){UpdateNotationTopPosition()})}function RenderDivClickHandler(e){if(!gRenderingPDF){var t=this.id;if(t&&""!=t&&0==t.indexOf("notation")){var n=this.id.replace("notation","");if(""!=n){var o=parseInt(n),a=findTuneOffsetByIndex(o),r=getTuneByIndex(o);a+=r.length/2,gIsMaximized?(gGotRenderDivClick=!0,gRenderDivClickOffset=a):(gTheABC.selectionEnd=gTheABC.selectionStart=a,gTheABC.blur(),gTheABC.focus())}}}}function GenerateRenderingDivs(e){var t=document.getElementById("notation-holder");t.innerHTML="";for(var n=0;n<e;++n){var o=document.createElement("div");o.id="notation"+n,o.classList.add("tunespacer"),o.classList.add("pagebreak"),gIsIOS||gIsAndroid||(o.onclick=RenderDivClickHandler),t.appendChild(o)}}function getUrlWithoutParams(){return window.location.protocol+"//"+window.location.host+window.location.pathname}function FillUrlBoxWithAbcInLZW(e){var t="";t=e||gTheABC.value;var n=LZString.compressToEncodedURIComponent(t),o=GetRadioValue("notenodertab"),a=document.getElementById("capo").value,r=document.getElementById("staff-spacing").value,l=document.getElementById("pdfformat").value,s=document.getElementById("pagenumbers").value,d=document.getElementById("firstpage").value,A=getUrlWithoutParams()+"?lzw="+n+"&format="+o+"&ssp="+r+"&pdf="+l+"&pn="+s+"&fp="+d;gTopBarShowing||(A+="&hide=1");var g="";switch(o){case"noten":case"notenames":case"whistle":case"bc":case"cd":break;case"mandolin":case"gdad":case"mandola":case"guitare":case"guitard":g="&capo="+a,gShowTabNames?g+="&stn=true":g+="&stn=false"}if(A+=g,A+="&btfs="+gBoxTabFontSize,e)return A;var c=CountTunes(),T=getDescriptiveFileName(c,!1);A+="&name="+T;var u=document.getElementById("urltextbox");(gAllowURLSave=!1,gAllowQRCodeSave=!1,A.length>8100)?(A="     The URL link would be too long to share. Please try sharing fewer tunes.",document.getElementById("generateqrcode").classList.remove("urlcontrols"),document.getElementById("generateqrcode").classList.add("urlcontrolsdisabled"),document.getElementById("shortenurl").classList.remove("urlcontrols"),document.getElementById("shortenurl").classList.add("urlcontrolsdisabled"),document.getElementById("testurl").classList.remove("urlcontrols"),document.getElementById("testurl").classList.add("urlcontrolsdisabled"),document.getElementById("copyurl").classList.remove("urlcontrols"),document.getElementById("copyurl").classList.add("urlcontrolsdisabled"),document.getElementById("saveurl").classList.remove("urlcontrols"),document.getElementById("saveurl").classList.add("urlcontrolsdisabled"),gAllowURLSave=!1):(document.getElementById("testurl").classList.remove("urlcontrolsdisabled"),document.getElementById("testurl").classList.add("urlcontrols"),document.getElementById("saveurl").classList.remove("urlcontrolsdisabled"),document.getElementById("saveurl").classList.add("urlcontrols"),document.getElementById("copyurl").classList.remove("urlcontrolsdisabled"),document.getElementById("copyurl").classList.add("urlcontrols"),document.getElementById("shortenurl").classList.remove("urlcontrolsdisabled"),document.getElementById("shortenurl").classList.add("urlcontrols"),gAllowURLSave=!0,A.length<MAXQRCODEURLLENGTH?(gAllowQRCodeSave=!0,document.getElementById("generateqrcode").classList.remove("urlcontrolsdisabled"),document.getElementById("generateqrcode").classList.add("urlcontrols")):(gAllowQRCodeSave=!1,document.getElementById("generateqrcode").classList.remove("urlcontrols"),document.getElementById("generateqrcode").classList.add("urlcontrolsdisabled"))),document.getElementById("qrcode").style.display="none",u.value=A;var m=A.length/80+1;m>8&&(m=8),u.rows=m,setTimeout(function(){u.scrollTo(0,0)},100)}function CreateURLfromHTML(){FillUrlBoxWithAbcInLZW(null),(urlarea=document.getElementById("urlarea")).style.display="inline-block",(urltextbox=document.getElementById("urltextbox")).focus(),urltextbox.setSelectionRange(0,0),clearQRCode()}function clearQRCode(){gTheQRCode&&gTheQRCode.clear()}function GenerateQRCode(e){var t=!1,n=document.getElementById("urltextbox").value;if(e.shiftKey){if(n.length>MAXQRCODEURLLENGTH){DayPilot.Modal.alert('<p style="text-align:center;font-family:helvetica;font-size:14pt;">Share URL text is too long to generate a QR Code</p>',{theme:"modal_flat",top:50});return}t=!0}else if(!gAllowQRCodeSave)return;null==gTheQRCode?gTheQRCode=new QRCode(document.getElementById("qrcode"),{text:n,width:548,height:548,colorDark:"#000000",colorLight:"#ffffff",border:16,correctLevel:QRCode.CorrectLevel.M}):(gTheQRCode.clear(),gTheQRCode.makeCode(n)),document.getElementById("qrcode").style.display="inline-block";var o="Custom QR Code",a="custom_qr_code";if((theQRCodeImage=document.querySelectorAll('div[id="qrcode"] > img'))&&theQRCodeImage.length>0){if(!t){o=GetAllTuneTitles();var r=GetRadioValue("notenodertab"),l="";switch(r){case"noten":l="<br/><br/>(Standard Notation)";break;case"notenames":l="<br/><br/>(Note Names Tab)";break;case"mandolin":l="<br/><br/>(Mandolin Tab",0!=gCapo&&(l+=" - Capo on "+gCapo),l+=")";break;case"gdad":l="<br/><br/>(Bouzouki GDAD Tab",0!=gCapo&&(l+=" - Capo on "+gCapo),l+=")";break;case"mandola":l="<br/><br/>(Mandola Tab",0!=gCapo&&(l+=" - Capo on "+gCapo),l+=")";break;case"guitare":l="<br/><br/>(Standard Guitar Tab",0!=gCapo&&(l+=" - Capo on "+gCapo),l+=")";break;case"guitard":l="<br/><br/>(DADGAD Guitar Tab",0!=gCapo&&(l+=" - Capo on "+gCapo),l+=")";break;case"whistle":l="<br/><br/>(Whistle Tab)";break;case"bc":l="<br/><br/>(B/C Box Tab)";break;case"cd":l="<br/><br/>(C#/D Box Tab)"}o+=l;var s=CountTunes();a=getDescriptiveFileName(s,!0)}theQRCodeImage=theQRCodeImage[0];var d=window.open("");setTimeout(function(){var e=theQRCodeImage.src,t=theQRCodeImage.outerHTML.replace("display: block;",""),n='<div style="text-align:center;padding:24px;margin-top:0px;margin-bottom:0px;">';n+=t,n+='<p style="font-family:times;font-size:15pt;margin-top:18px;margin-bottom:0px;">'+o+"</p>",n+='<p style="font-family:times;font-size:16pt;margin-top:32px;margin-bottom:0px;"><strong>Get Your QR Code</strong></p>',n+='<p style="font-family:times;font-size:16pt;margin-top:32px;margin-bottom:0px;"><a href="'+e+'" download="'+a+'.png" style="text-decoration:none;color:darkblue">Click here to download&nbsp;'+a+".png&nbsp;to your system.</a></p>",n+='<p style="font-family:times;font-size:16pt;margin-top:32px;margin-bottom:0px;"><strong>Use Your QR Code</strong></p>',n+='<p style="font-family:times;font-size:15pt;margin-top:30px;margin-bottom:0px;">Share QR Codes on social media or email them to friends like any other photo.</p>',n+='<p style="font-family:times;font-size:15pt;margin-top:24px;margin-bottom:0px;">Scanning the code with the Camera app on any iOS or Android phone will load the</p>',n+='<p style="font-family:times;font-size:15pt;margin-top:6px;margin-bottom:0px;">ABC Transcription Tool with your tune set into the browser on the device.</p>',n+="</div>",d.document.write(n),setTimeout(function(){d.document.title="ABC Tools Tune Sharing QR Code"},100)},1e3)}}function saveABCFile(e,t,n){DayPilot.Modal.prompt(e,t,{theme:"modal_flat",top:194,autoFocus:!1}).then(function(e){var t=e.result;if(null==t||0==(t=t.replace(/[^a-zA-Z0-9_\-. ]+/ig,"")).length)return null;gIsAndroid||gIsIOS?(t=t.replace(/\..+$/,""),t+=".txt"):t.endsWith(".abc")||t.endsWith(".txt")||t.endsWith(".ABC")||t.endsWith(".TXT")||(t=t.replace(/\..+$/,""),t+=".abc");var o=document.createElement("a");document.body.appendChild(o),o.style="display: none";var a=new Blob([n],{type:"text/plain"}),r=window.URL.createObjectURL(a);o.href=r,o.download=t,o.click(),document.body.removeChild(o),setTimeout(function(){window.URL.revokeObjectURL(r)},1e3),gDisplayedName=t,gABCFromFile=!0,document.getElementById("abc-selected").innerText=t})}function saveShareURLFile(e,t,n){DayPilot.Modal.prompt(e,t,{theme:"modal_flat",top:194,autoFocus:!1}).then(function(e){var t=e.result;if(null==t||0==(t=t.replace(/[^a-zA-Z0-9_\-. ]+/ig,"")).length)return null;gIsAndroid||gIsIOS?(t=t.replace(/\..+$/,""),t+=".txt"):t.endsWith(".txt")||t.endsWith(".TXT")||(t=t.replace(/\..+$/,""),t+=".txt");var o=document.createElement("a");document.body.appendChild(o),o.style="display: none";var a=new Blob([n],{type:"text/plain"}),r=window.URL.createObjectURL(a);o.href=r,o.download=t,o.click(),document.body.removeChild(o),setTimeout(function(){window.URL.revokeObjectURL(r)},1e3)})}function CopyToClipboard(e){try{if(navigator.clipboard&&window.isSecureContext)return navigator.clipboard.writeText(e);{let t=document.createElement("textarea");return t.value=e,t.style.position="fixed",t.style.left="-999999px",t.style.top="-999999px",document.body.appendChild(t),t.focus(),t.select(),new Promise((e,n)=>{document.execCommand("copy")?e():n(),t.remove()})}}catch(n){console.log("CopyToClipboard error: "+n)}}function InjectOneTuneMIDIProgram(e,t,n){var o=escape(e).split("%0A"),a="",r="";for(i=0;i<o.length;++i){var l=(r=unescape(o[i])).split("");"|"!=l[0]&&"["!=l[0]&&":"==l[1]?(a+=r+"\n","X"==l[0]&&(n?a+="%%MIDI chordprog "+t+"\n":a+="%%MIDI program "+t+"\n")):(a+=r,i!=o.length-1&&(a+="\n"))}return a}function OverrideOneTuneMIDIParams(e,t,n,o,a){var r=e,l=/^%%MIDI program.*$/gm,s=e.match(l);if(s&&s.length>0)for(var d=0;d<s.length;++d)r=r.replace(s[0],"%%MIDI program "+t);l=/^%%MIDI chordprog.*$/gm;var A=e.match(l);if(A&&A.length>0)for(var d=0;d<A.length;++d)r=r.replace(A[d],"%%MIDI chordprog "+n);l=/^%%MIDI bassvol.*$/gm;var g=e.match(l);if(g&&g.length>0)for(var d=0;d<g.length;++d)r=r.replace(g[d],"%%MIDI bassvol "+o);l=/^%%MIDI chordvol.*$/gm;var c=e.match(l);if(c&&c.length>0)for(var d=0;d<c.length;++d)r=r.replace(c[d],"%%MIDI chordvol "+a);return r}function InjectOneTuneMIDIVolume(e,t,n){var o=escape(e).split("%0A"),a="",r="";for(i=0;i<o.length;++i){var l=(r=unescape(o[i])).split("");"|"!=l[0]&&"["!=l[0]&&":"==l[1]?(a+=r+"\n","X"==l[0]&&(n?a+="%%MIDI chordvol "+t+"\n":a+="%%MIDI bassvol "+t+"\n")):(a+=r,i!=o.length-1&&(a+="\n"))}return a}function InjectMIDIInstrument(e){if(!gRenderingPDF){var t=" melody",n="21";e&&(t=" chords",n="34");var o='<p style="font-size:14pt;line-height:19pt;font-family:helvetica"><strong>MIDI instrument program number to inject for the'+t+'?</strong></p><p style="font-size:14pt;font-family:helvetica">Suggested values:</p><p style="font-size:14pt;line-height:19pt;font-family:helvetica">Piano: 0,  Hammered Dulcimer: 15,  Accordion: 21, Fingered Bass: 33,  Flute: 73,  Whistle: 78,  Fiddle: 110,  Uilleann Pipes: 129,  Scottish Smallpipes (D): 130,  Scottish Smallpipes (A): 131,  S\xe4ckpipa: 132,  Concertina: 133,  Melodica: 134, Cajun Accordion: 135</p><p style="font-size:14pt;line-height:19pt;font-family:helvetica;margin-bottom:30px"><strong>Shortcut:</strong> Entering a negative value will inject the same value for both the melody and chord instrument program numbers.</p><p style="font-size:14pt;line-height:19pt;font-family:helvetica;margin-bottom:30px;text-align:center;"><a href="http://michaeleskin.com/documents/general_midi_extended.pdf" target="_blank">General MIDI Instrument Program Numbers</a></p>';e&&(o='<p style="font-size:14pt;line-height:19pt;font-family:helvetica"><strong>MIDI instrument program number to inject for the'+t+'?</strong></p><p style="font-size:14pt;font-family:helvetica">Suggested values:</p><p style="font-size:14pt;line-height:19pt;font-family:helvetica">Piano: 0,  Electric Piano: 5,  Organ: 19,  Accordion: 21,  Guitar: 25,  Bass: 34,  Synth Bass: 38</p><p style="font-size:14pt;line-height:19pt;font-family:helvetica;margin-bottom:30px"><strong>Shortcut:</strong> Entering a negative value will inject the same value for both the melody and chord instrument program numbers.</p><p style="font-size:14pt;line-height:19pt;font-family:helvetica;margin-bottom:30px;text-align:center;"><a href="http://michaeleskin.com/documents/general_midi_extended.pdf" target="_blank">General MIDI Instrument Program Numbers</a></p>'),DayPilot.Modal.prompt(o,n,{theme:"modal_flat",top:194,autoFocus:!1}).then(function(t){var n=t.result;if(null!=n){var o=parseInt(n);if(!isNaN(o)&&void 0!=o){var a=!1;if(o<0&&(a=!0,o=-o),!(o<0)&&!(o>135)){var r=CountTunes();if(a){for(var l=gTheABC.value,s=l.split(/^X:/gm),d="",A=1;A<=r;++A)s[A]="X:"+s[A],d+=InjectOneTuneMIDIProgram(s[A],o,!0);s=d.split(/^X:/gm);for(var d="",A=1;A<=r;++A)s[A]="X:"+s[A],d+=InjectOneTuneMIDIProgram(s[A],o,!1)}else for(var l=gTheABC.value,s=l.split(/^X:/gm),d="",A=1;A<=r;++A)s[A]="X:"+s[A],d+=InjectOneTuneMIDIProgram(s[A],o,e);gTheABC.value=d,gTheABC.selectionStart=0,gTheABC.selectionEnd=0,gTheABC.focus()}}}})}}function PlayABC(e){if(gAllowCopy){if(e&&e.altKey&&e.shiftKey){var t=getSelectedText("abc");if(0==t.length){if(""==(t=findSelectedTune()))return;var n=gTheABC.value;gTheABC.focus();var o=n.indexOf(t),a=o+t.length;gTheABC.selectionStart=o,gTheABC.selectionEnd=a}CopyToClipboard(t);var r=encodeURIComponent(t);window.open("https://editor.drawthedots.com?t="+r),document.getElementById("playbutton").value="Sent!",setTimeout(function(){document.getElementById("playbutton").value="Play",gTheABC.focus()},750);return}if(e&&e.shiftKey){InjectMIDIInstrument(!1);return}if(e&&e.altKey){InjectMIDIInstrument(!0);return}var t=findSelectedTune();""!=t&&(t=PreProcessLocalPlayABC(t),LocalPlayABC(t))}}function CopyABC(e){gAllowCopy&&(CopyToClipboard(gTheABC.value),document.getElementById("copybutton").value="Copied!",setTimeout(function(){document.getElementById("copybutton").value="Copy All"},750))}function ShortenURLFallback(){gAllowURLSave&&(CopyToClipboard(document.getElementById("urltextbox").value),document.getElementById("shortenurl").value="Share URL Copied!",setTimeout(function(){document.getElementById("shortenurl").value="Launching TinyURL",setTimeout(function(){window.open("https://tinyurl.com"),document.getElementById("shortenurl").value="Shorten URL"},1e3)},2e3))}function ShortenURL(){if(gAllowURLSave){var e;fetch("https://api.tinyurl.com/create",{method:"POST",headers:{accept:"application/json",authorization:gTinyURLAPIKey,"content-type":"application/json"},body:JSON.stringify({url:document.getElementById("urltextbox").value})}).then(e=>{if(200!=e.status){ShortenURLFallback();return}return e.json()}).then(e=>{CopyToClipboard(e.data.tiny_url);var t='<p style="text-align:center;font-size:16pt;font-family:helvetica">Shortened URL Copied to the Clipboard</p>';t+='<p style="text-align:center;font-size:14pt;line-height:19pt;font-family:helvetica">Short URL:</p>',t+='<p style="text-align:center;font-size:14pt;line-height:19pt;font-family:helvetica"><a href="'+e.data.tiny_url+'" target="_blank">'+e.data.tiny_url+"</a></p>",DayPilot.Modal.alert(t,{theme:"modal_flat",top:50})}).catch(e=>{ShortenURLFallback()})}}function CopyShareURL(){gAllowURLSave&&(CopyToClipboard(document.getElementById("urltextbox").value),document.getElementById("copyurl").value="Share URL Copied!",setTimeout(function(){document.getElementById("copyurl").value="Copy Share URL"},750))}function SaveABC(){if(gAllowSave){var e=gTheABC.value;if(0!=e.length){var t=CountTunes(),n=getDescriptiveFileName(t,!1);gIsAndroid||gIsIOS?saveABCFile("Please enter a filename for your ABC file:",n+=".txt",e):saveABCFile("Please enter a filename for your ABC file:",n+=".abc",e)}}}function SaveShareURL(){if(gAllowURLSave){var e=urltextbox.value;if(0!=e.length){var t=CountTunes(),n=getDescriptiveFileName(t,!1);saveShareURLFile("Please enter a filename for your Share URL file:",n+"_Share_URL.txt",e)}}}function TestShareURL(){if(gAllowURLSave){var e=document.getElementById("urltextbox").value;window.open(e)}}function SetAbcText(e){gTheABC.value=e}function ShowAllControls(){document.getElementById("notenrechts").style.display="inline-block",document.getElementById("toggleallcontrols").value="Hide Controls",gShowAllControls=!0}function HideAllControls(){document.getElementById("notenrechts").style.display="none",document.getElementById("toggleallcontrols").value="Show Controls",gShowAllControls=!1}function ToggleAllControls(){gAllowControlToggle&&(gShowAllControls?HideAllControls():ShowAllControls(),UpdateNotationTopPosition(),gIsOneColumn&&MakeTuneVisible(!0))}function ShowMaximizeButton(){document.getElementById("zoombutton").style.display="block"}function HideMaximizeButton(){document.getElementById("zoombutton").style.display="none"}function DoMaximize(){document.getElementById("noscroller").style.display="none",document.getElementById("notation-spacer").style.display="none",document.getElementById("notation-holder").style.display="flex",document.getElementById("notation-holder").style.float="none",document.getElementById("zoombutton").src="img/zoomin.png",gIsMaximized=!0,HandleWindowResize(),gIsIOS||gIsAndroid||(gGotRenderDivClick=!1,gRenderDivClickOffset=-1)}function DoMinimize(){document.getElementById("noscroller").style.display="block",document.getElementById("notation-spacer").style.display="block",document.getElementById("zoombutton").src="img/zoomout.png",gIsIOS||gIsAndroid||(document.getElementById("notation-holder").style.display="inline",document.getElementById("notation-holder").style.float="left"),gIsMaximized=!1,HandleWindowResize(),!(gIsIOS||gIsAndroid)&&gGotRenderDivClick&&(-1!=gRenderDivClickOffset&&(gTheABC.selectionEnd=gTheABC.selectionStart=gRenderDivClickOffset,gTheABC.blur(),gTheABC.focus()),gGotRenderDivClick=!1,gRenderDivClickOffset=-1)}function ToggleMaximize(){gIsMaximized?DoMinimize():DoMaximize()}function IdleShowTabNamesControl(){var e=GetRadioValue("notenodertab"),t=!1;switch(e){case"noten":case"notenames":case"whistle":case"bc":case"cd":break;case"mandolin":case"gdad":case"mandola":case"guitare":case"guitard":t=!0}t?(document.getElementById("toggletabnames").classList.remove("toggletabnamesdisabled"),document.getElementById("toggletabnames").classList.add("toggletabnames"),gAllowShowTabNames=!0):(document.getElementById("toggletabnames").classList.remove("toggletabnames"),document.getElementById("toggletabnames").classList.add("toggletabnamesdisabled"),gAllowShowTabNames=!1)}function ToggleTabNames(){gAllowShowTabNames&&(gShowTabNames?(gShowTabNames=!1,document.getElementById("toggletabnames").value="Show Tab Names"):(gShowTabNames=!0,document.getElementById("toggletabnames").value="Hide Tab Names"),RenderAsync(!0,null))}function utf8tob64(e){var t;try{t=btoa(escape(e))}catch(n){t=""}return t}function b64toutf8(e){var t;try{t=unescape(atob(e))}catch(n){t=""}return t}function processShareLink(){var e=!1;let t=new URLSearchParams(window.location.search);if(t.has("base64")){let n=t.get("base64"),o=b64toutf8(n);o.length>0&&(SetAbcText(o),RestoreDefaults(),e=!0)}if(t.has("lzw")){var a=t.get("lzw");a=LZString.decompressFromEncodedURIComponent(a);let r=a;r.length>0&&(SetAbcText(r),RestoreDefaults(),e=!0)}if(t.has("format")){var l=t.get("format");SetRadioValue("notenodertab",l),IdleCapoControl(),"whistle"==l&&PrepareWhistleFont(),gCurrentTab=l}if(t.has("capo")){var s=t.get("capo");document.getElementById("capo").value=s,gCapo=parseInt(s)}else gCapo=0;if(t.has("ssp")){var d=t.get("ssp");document.getElementById("staff-spacing").value=d,gStaffSpacing=STAFFSPACEOFFSET+parseInt(d)}else document.getElementById("staff-spacing").value=STAFFSPACEDEFAULT,gStaffSpacing=STAFFSPACEOFFSET+STAFFSPACEDEFAULT;if(t.has("showtabnames")){var A=t.get("showtabnames");"true"==A?(gShowTabNames=!0,document.getElementById("toggletabnames").value="Hide Tab Names"):(gShowTabNames=!1,document.getElementById("toggletabnames").value="Show Tab Names"),IdleShowTabNamesControl()}else gShowTabNames=!0,document.getElementById("toggletabnames").value="Hide Tab Names";if(t.has("stn")){var A=t.get("stn");"true"==A?(gShowTabNames=!0,document.getElementById("toggletabnames").value="Hide Tab Names"):(gShowTabNames=!1,document.getElementById("toggletabnames").value="Show Tab Names"),IdleShowTabNamesControl()}else gShowTabNames=!0,document.getElementById("toggletabnames").value="Hide Tab Names";if(t.has("pdf")){var g=t.get("pdf");document.getElementById("pdfformat").value=g}else document.getElementById("pdfformat").value="one";if(t.has("pn")){var c=t.get("pn");document.getElementById("pagenumbers").value=c}else document.getElementById("pagenumbers").value="none";if(t.has("fp")){var T=t.get("fp");document.getElementById("firstpage").value=T}else document.getElementById("firstpage").value="yes";t.has("hide")&&"1"==t.get("hide")&&HideTopBar(),t.has("btfs")&&(gBoxTabFontSize=t.get("btfs"));var u=!1;if(t.has("play")&&"1"==t.get("play")&&(u=!0),e){var m="";if(t.has("name"))m=t.get("name");else{var h=CountTunes();m=getDescriptiveFileName(h,!1)}return gABCFromFile=!0,gDisplayedName=m,document.getElementById("notenrechts").style.display="none",document.getElementById("toggleallcontrols").value="Show Controls",UpdateNotationTopPosition(),gShowAllControls=!1,FocusABC(),RenderAsync(!0,null,function(){if(u){var e=PreProcessLocalPlayABC(gTheABC.value);LocalPlayABC(e)}}),!0}return!1}function TextBoxResizeHandler(){UpdateNotationTopPosition(),gIsOneColumn&&MakeTuneVisible(!0)}function findSelectedTuneIndex(){var e=gTheABC.value,t=e.split(/^X:/gm),n=CountTunes();if(n<2)return 0;var o=gTheABC.selectionStart;if(0==o&&(o=e.indexOf("X:")+2),0==o)return -1;var a=0;for(i=1,a=t[0].length;i<=n;++i)if(o<(a+=t[i].length+2))return i-1;return -1}function MakeTuneVisible(e){if(gAllowCopy){var t=findSelectedTuneIndex();if(gCurrentTune=t,(e||!gIsIOS&&!gIsAndroid)&&-1!=t){var n=document.getElementById("notation"+t),o=n.offsetTop,a=n.offsetHeight,r=document.getElementById("notation-spacer").offsetHeight;gIsOneColumn?o+=r:r=0;var l=window.innerHeight,s=window.scrollY,d=l-r,A=o-s-r,g=A+a;if(t!=gLastAutoScrolledTune||e){var c=o-r;window.scrollTo(0,c),gLastAutoScrolledTune=t}else if(!(A>=0&&A<d||g>0&&g<d||A<0&&A+a>d)){var c=o-r;window.scrollTo(0,c),gLastAutoScrolledTune=t}}}}function debounce(e,t){let n;return(...o)=>{clearTimeout(n),n=setTimeout(function(){e.apply(this,o)},t)}}function OnABCTextChange(){var e=gTotalTunes,t=CountTunes();e!=t?RenderAsync(!0,null):Render(!1,gCurrentTune)}function PrepareWhistleFont(){if(!gWhistleFontPrepared){var e=document.querySelectorAll('div[id="fontholder"] > svg > style');e[0].innerHTML+="@font-face { font-family: 'TinWhistleFingering'; src: url(data:font/truetype;charset=utf-8;base64,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) format('truetype'); font-weight: normal; font-style: normal; }",gWhistleFontPrepared=!0}}function InjectPDFHeaders(e){if(!gRenderingPDF){if(e.shiftKey){var t=gTheABC.value,n="";n+="%\n",n+="% Here are all available custom annotations:\n",n+="%\n",n+="%addtitle Title Page Title\n",n+="%addsubtitle Title Page Subtitle\n",n+="%urladdtitle http://michaeleskin.com Title Page Title as Hyperlink\n",n+="%urladdsubtitle http://michaeleskin.com Title Page Subtitle as Hyperlink\n",n+="%addtoc Table of Contents\n",n+="%addsortedtoc Table of Contents Sorted by Tune Name\n",n+="%addlinkbacktotoc\n",n+="%toctopoffset 30\n",n+="%toctitleoffset 35\n",n+="%toctitlefontsize 18\n",n+="%tocfontsize 13\n",n+="%toclinespacing 12\n",n+="%addindex Unsorted Index\n",n+="%addsortedindex Index Sorted by Tune Name\n",n+="%addlinkbacktoindex\n",n+="%indextopoffset 30\n",n+="%indextitleoffset 35\n",n+="%indextitlefontsize 18\n",n+="%indexfontsize 13\n",n+="%indexlinespacing 12\n",n+="%no_toc_or_index_links\n",n+="%pageheader Page Header\n",n+="%pagefooter Page Footer\n",n+="%urlpageheader http://michaeleskin.com Page Header as Hyperlink\n",n+="%urlpagefooter http://michaeleskin.com Page Footer as Hyperlink\n",n+="%add_all_links_to_thesession\n",n+="%add_all_playback_links 0 0\n",n+="%pdfname your_pdf_filename\n",n+="%qrcode\n",n+="%qrcode http://michaeleskin.com\n",n+="%caption_for_qrcode Caption for the QR code\n",n+="%pdfquality .75\n",n+="%\n",n+="% These directives can be added to each tune:\n",n+="%hyperlink http://michaeleskin.com\n",n+="%add_link_to_thesession\n",n+="%add_playback_link 0 0\n",n+="\n",n+=t,gTheABC.value=n,gTheABC.selectionStart=0,gTheABC.selectionEnd=0,gTheABC.focus();return}if(e.altKey){if(gRenderingPDF)return;var t=gTheABC.value,n="";n+="%\n",n+="% Here is a starting template of annotations for a PDF tunebook:\n",n+="%\n",n+="%addtitle Tunebook Title\n",n+="%addsubtitle Tunebook Subtitle\n",n+="%addtoc Table of Contents\n",n+="%addlinkbacktotoc\n",n+="%addsortedindex Index\n",n+="%addlinkbacktoindex\n",n+="%urlpageheader http://michaeleskin.com This is the Page Header with Hyperlink\n",n+="%pagefooter This is the Page Footer\n",n+="%add_all_playback_links 0 0\n",n+="%qrcode http://michaeleskin.com\n",n+="%caption_for_qrcode Click or Scan to Visit my Home Page\n",n+="\n",n+=t,gTheABC.value=n,gTheABC.selectionStart=0,gTheABC.selectionEnd=0,gTheABC.focus();return}}}function InjectOneTuneABCNoteNameLyrics(e){var t=escape(e).split("%0A"),n="",o="";for(i=0;i<t.length;++i){var a=(o=unescape(t[i])).split("");if("|"!=a[0]&&"["!=a[0]&&":"==a[1])n+=o+"\n","X"==a[0]&&(n+="%%vocalfont Times-Roman 13.5\n");else if("%"==a[0])n+=o+"\n";else if(""!=(o=o.trim())){n+=o+"\n";var r=/"[^"]*"/gm;o=o.replace(r,"");var r=/{[^{]*}/gm;o=o.replace(r,""),r=/[^ABCDEFGabcdefg|]*/gm,o=(a=(o=o.replace(r,"")).split("")).join(" "),r=/\| \|/gm,n+="w: "+(o=o.replace(r,"|"))+"\n"}else n+=o}return n+"\n"}function InjectABCNoteNameLyrics(){if(!gRenderingPDF){for(var e=CountTunes(),t=gTheABC.value.split(/^X:/gm),n="",o=1;o<=e;++o)t[o]="X:"+t[o],n+=InjectOneTuneABCNoteNameLyrics(t[o]);gTheABC.value=n,RenderAsync(!0,null),gTheABC.selectionStart=0,gTheABC.selectionEnd=0,gTheABC.focus()}}function DoInjectABCNoteNameLyrics(e){e.shiftKey&&(e.preventDefault(),e.stopPropagation(),InjectABCNoteNameLyrics(),RenderAsync(!0,null))}function ChangeTab(){var e=GetRadioValue("notenodertab");"whistle"==e&&PrepareWhistleFont(),e!=gCurrentTab&&RenderAsync(!0,null),gCurrentTab=e}function FocusABC(){gTheABC.focus(),gTheABC.selectionStart=0,gTheABC.selectionEnd=0,gTheABC.scrollTo(0,0)}function fadeOutAndHide(e,t){var n=setInterval(function(){e.style.opacity||(e.style.opacity=1),e.style.opacity>0?e.style.opacity-=.1:(clearInterval(n),e.style.display="none",t())},100)}function ShowTopBar(){var e=document.getElementById("topbar");e.style.display="block",e.style.opacity=1,gTopBarShowing=!0;var e=document.getElementById("abc-selected");e.style.marginTop="15px",e.style.marginBottom="1px",(e=document.getElementById("toggletopbar")).value=""}function HideTopBar(){var e=document.getElementById("topbar");e.style.display="none",gTopBarShowing=!1;var e=document.getElementById("abc-selected");gIsIPhone||gIsAndroid?(e.style.marginTop="18px",e.style.marginBottom="38px"):e.style.marginTop="4px",(e=document.getElementById("toggletopbar")).value=""}function ToggleTopBar(){gTopBarShowing?HideTopBar():ShowTopBar(),UpdateNotationTopPosition(),gIsOneColumn&&MakeTuneVisible(!0),UpdateLocalStorage(),gAllowCopy&&FillUrlBoxWithAbcInLZW(null)}function HandleWindowResize(){if(!(gIsIOS||gIsAndroid)){if(gIsMaximized){var e=document.getElementById("app-container");e.style.marginLeft="0px"}else{var t=window.innerWidth;if(t<1798){var n=(t-850)/2,e=document.getElementById("app-container");e.style.marginLeft=n+"px",gTheABC.rows=12,gIsOneColumn=!0}else{var e=document.getElementById("app-container"),n=(t-1700)/2;e.style.marginLeft=n+"px";var o=window.innerHeight,a=(o-=540)/30;a<12&&(a=12),gTheABC.rows=a,gIsOneColumn=!1}}}}function isIOS(){return!!/iPad|iPhone|iPod/.test(navigator.platform)||navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform)}function isIPhone(){return!!/iPad|iPhone|iPod/.test(navigator.platform)}function isIPad(){return navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform)}function isAndroid(){return!!/Android/i.test(navigator.userAgent)}function isSafari(){return!!(/Safari/i.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor))}function isFirstRun(){return!localStorage.abcTab&&!localStorage.abcTunesPerPage&&!localStorage.abcPageNumberLocation&&!localStorage.abcPageNumberOnPageOne&&!localStorage.abcCapo&&!localStorage.abcStaffSpacing&&!localStorage.abcHideTopBar&&!localStorage.abcShowTabNames}function restoreStateFromLocalStorage(){var e=isFirstRun(),t=localStorage.abcTab;t&&(SetRadioValue("notenodertab",t),IdleCapoControl(),"whistle"==t&&PrepareWhistleFont(),gCurrentTab=t);var n=localStorage.abcTunesPerPage;n&&(document.getElementById("pdfformat").value=n);var o=localStorage.abcPageNumberLocation;o&&(document.getElementById("pagenumbers").value=o);var a=localStorage.abcPageNumberOnPageOne;a&&(document.getElementById("firstpage").value=a);var r=localStorage.abcCapo;r&&(document.getElementById("capo").value=r,gCapo=parseInt(r));var l=localStorage.abcStaffSpacing;l&&(document.getElementById("staff-spacing").value=l,gStaffSpacing=STAFFSPACEOFFSET+parseInt(l));var s=localStorage.abcHideTopBar;s&&"true"==s&&HideTopBar();var d=localStorage.abcShowTabNames;d&&("true"==d?(gShowTabNames=!0,document.getElementById("toggletabnames").value="Hide Tab Names"):(gShowTabNames=!1,document.getElementById("toggletabnames").value="Show Tab Names"),IdleShowTabNamesControl()),e&&(UpdateLocalStorage(),showWelcomeScreen())}function showWelcomeScreen(){var e='<p style="text-align:center;font-size:18pt;font-family:helvetica">Welcome to My ABC Transcription Tools!</p>';e+='<p style="font-size:12pt;line-height:19pt;font-family:helvetica"><strong>Read the <a href="userguide.html" target="_blank">User Guide</a> for complete documentation and demo videos.</strong></p>',e+='<p style="font-size:12pt;line-height:19pt;font-family:helvetica">To begin, type or paste tunes in ABC format into the text area.</p>',e+='<p style="font-size:12pt;line-height:19pt;font-family:helvetica">Each ABC tune <strong>must</strong> begin with an X: tag.</p>',e+='<p style="font-size:12pt;line-height:19pt;font-family:helvetica">Notation updates instantly as you make changes.</p>',e+='<p style="font-size:12pt;line-height:19pt;font-family:helvetica">Click the Zoom-Out arrows at the upper-right to view notation fullscreen.</p>',e+='<p style="font-size:12pt;line-height:19pt;font-family:helvetica">Click "New" to generate a sample tune with examples of some of the available PDF tunebook annotations.</p>',e+='<p style="font-size:12pt;line-height:19pt;font-family:helvetica">Click "Open" to open and import an ABC text file from your system.</p>',e+='<p style="font-size:12pt;line-height:19pt;font-family:helvetica"><strong>Once ABC has been entered and notation is displayed:</strong></p>',e+='<p style="font-size:12pt;line-height:19pt;font-family:helvetica"> Click "Save" to save all the ABC text to an ABC text file.</p>',e+='<p style="font-size:12pt;line-height:19pt;font-family:helvetica"> Click "Export PDF" to export your tunebook in PDF format.</p>',e+='<p style="font-size:12pt;line-height:19pt;font-family:helvetica"> Click "Copy All" to copy all the ABC text to the clipboard.</p>',e+='<p style="font-size:12pt;line-height:19pt;font-family:helvetica"> Click "Play" to play the tune currently being edited.</p>',e+='<p style="font-size:12pt;line-height:19pt;font-family:helvetica"> Click "Show Controls" for tablature options, PDF tunebook settings (paper size, tunes-per-page, page numbers), sharing features, etc.</p>',e+='<p style="font-size:12pt;line-height:19pt;font-family:helvetica"> Click "Settings" to select the default instrument sounds and volumes to use when playing tunes.</p>',e+='<p style="font-size:12pt;line-height:19pt;font-family:helvetica"><strong>If you find this tool useful, please consider <a href="donate.html" target="_blank">buying me a beer!</a></strong></p>',DayPilot.Modal.alert(e,{theme:"modal_flat",top:50})}function showZoomInstructionsScreen(){var e='<p style="text-align:center;font-size:18pt;font-family:helvetica">Welcome to My ABC Transcription Tools!</p>';e+='<p style="font-size:12pt;line-height:19pt;font-family:helvetica">Since this is your first time using the tool, here is some useful information:</p>',e+='<p style="font-size:12pt;line-height:19pt;font-family:helvetica">In this view, you may scroll through the tune notation.</p>',e+='<p style="font-size:12pt;line-height:19pt;font-family:helvetica">If you would like to edit or create a PDF tunebook from the notation:</p>',e+='<p style="font-size:12pt;line-height:19pt;font-family:helvetica">Click the Zoom-In arrows at the upper-right to open the ABC editor.</p>',e+='<p style="font-size:12pt;line-height:19pt;font-family:helvetica">In the ABC editor, click the Zoom-Out arrows to view notation fullscreen.</p>',e+='<p style="font-size:12pt;line-height:19pt;font-family:helvetica">All controls in the ABC editor have helpful tooltips.</p>',e+='<p style="font-size:12pt;line-height:19pt;font-family:helvetica">Read the <a href="userguide.html" target="_blank">User Guide</a> for complete documentation and demo videos.</p>',DayPilot.Modal.alert(e,{theme:"modal_flat",top:50})}function LocalPlayABC(e){var t,n={add_classes:!0,responsive:"resize"};function o(){t&&(t.destroy(),t=null)}var a=new function e(){var t=this;t.onReady=function(){},t.onStart=function(){var e=document.querySelector("#playback-paper svg"),t=document.createElementNS("http://www.w3.org/2000/svg","line");t.setAttribute("class","abcjs-cursor"),t.setAttributeNS(null,"x1",0),t.setAttributeNS(null,"y1",0),t.setAttributeNS(null,"x2",0),t.setAttributeNS(null,"y2",0),e.appendChild(t)},t.beatSubdivisions=2,t.onBeat=function(e,t,n){},t.onEvent=function(e){if(!e.measureStart||null!==e.left){for(var t=document.querySelectorAll("#playback-paper svg .highlight"),n=0;n<t.length;n++)t[n].classList.remove("highlight");for(var o=0;o<e.elements.length;o++)for(var a=e.elements[o],r=0;r<a.length;r++)a[r].classList.add("highlight");var l=document.querySelector("#playback-paper svg .abcjs-cursor");l&&(l.setAttribute("x1",e.left-2),l.setAttribute("x2",e.left-2),l.setAttribute("y1",e.top),l.setAttribute("y2",e.top+e.height))}},t.onFinished=function(){for(var e=document.querySelectorAll("svg .highlight"),t=0;t<e.length;t++)e[t].classList.remove("highlight");var n=document.querySelector("#playback-paper svg .abcjs-cursor");n&&(n.setAttribute("x1",0),n.setAttribute("x2",0),n.setAttribute("y1",0),n.setAttribute("y2",0))}};!function r(){var l='<div id="abcplayer">';l+='<div id="playback-paper"></div>',l+='<div id="playback-audio"></div>',l+="</div>",DayPilot.Modal.alert(l,{theme:"modal_flat",top:50,width:850,okText:"Close"});var s=document.getElementsByClassName("modal_flat_ok"),d=null;for(i=0;i<s.length;++i)if("Close"==(d=s[i]).innerText){var A=d.onclick;d.onclick=function(){A(),o(),gTheABC.focus()};break}ABCJS.synth.supportsAudio()?(t=new ABCJS.synth.SynthController).load("#playback-audio",a,{displayLoop:!0,displayRestart:!0,displayPlay:!0,displayProgress:!0,displayWarp:!0}):document.querySelector("#playback-audio").innerHTML="<div class='audio-error'>Audio is not supported in this browser.</div>",function o(a){t.disable(!0);var r=ABCJS.renderAbc("playback-paper",e,n)[0];new ABCJS.synth.CreateSynth().init({visualObj:r}).then(function(n){if(console.log(n),t){var o=function e(t){var n=200,o=/^%%MIDI program.*$/m,a=t.match(o);if(a&&a.length>0){var r=a[0].replace("%%MIDI program",""),l=(r=r.trim()).split(" ");if(l&&l.length>0){var s=l[0];switch(s){case"15":n=4e3;break;case"21":case"73":case"78":case"129":case"130":case"131":case"132":case"133":case"134":case"135":n=100}}}o=/^%%MIDI chordprog.*$/m;var d=t.match(o);if(d&&d.length>0){var r=d[0].replace("%%MIDI chordprog",""),l=(r=r.trim()).split(" ");if(l&&l.length>0){var s=l[0];"15"===s&&(n=4e3)}}return n}(e);t.setTune(r,a,{fadeLength:o}).then(function(e){console.log("Audio successfully loaded.")}).catch(function(e){console.warn("Audio problem:",e)})}}).catch(function(e){console.warn("Audio problem:",e)})}(!1)}()}function PreProcessLocalPlayABC(e){if(gOverridePlayMIDIParams&&(e=OverrideOneTuneMIDIParams(e,gTheMelodyProgram,gTheChordProgram,gTheBassVolume,gTheChordVolume)),gAlwaysInjectPrograms){var t=/^%%MIDI chordprog.*$/m,n=e.match(t);n&&n.length>0||(e=InjectOneTuneMIDIProgram(e,gTheChordProgram,!0)),t=/^%%MIDI program.*$/m;var o=e.match(t);o&&o.length>0||(e=InjectOneTuneMIDIProgram(e,gTheMelodyProgram,!1))}if(gAlwaysInjectVolumes){var t=/^%%MIDI bassvol.*$/m,a=e.match(t);a&&a.length>0||(e=InjectOneTuneMIDIVolume(e,gTheBassVolume,!1));var t=/^%%MIDI chordvol.*$/m,r=e.match(t);r&&r.length>0||(e=InjectOneTuneMIDIVolume(e,gTheChordVolume,!0))}return e}var gAlwaysInjectPrograms=!0,gTheMelodyProgram=0,gTheChordProgram=0,gAlwaysInjectVolumes=!0,gTheBassVolume=32,gTheChordVolume=32,gOverridePlayMIDIParams=!1,gBoxTabFontSize="10";function GetInitialConfigurationSettings(){var e=localStorage.AlwaysInjectPrograms;gAlwaysInjectPrograms=!e||"true"==e,gTheMelodyProgram=(e=localStorage.TheMelodyProgram)?e:0,gTheChordProgram=(e=localStorage.TheChordProgram)?e:0,gAlwaysInjectVolumes=!(e=localStorage.AlwaysInjectVolumes)||"true"==e,gTheBassVolume=(e=localStorage.TheBassVolume)?e:32,gTheChordVolume=(e=localStorage.TheChordVolume)?e:32,gBoxTabFontSize=(e=localStorage.BoxTabFontSize)?e:10,gOverridePlayMIDIParams=!!(e=localStorage.OverridePlayMIDIParams)&&"true"==e,SaveConfigurationSettings()}function SaveConfigurationSettings(){gLocalStorageAvailable&&(localStorage.AlwaysInjectPrograms=gAlwaysInjectPrograms,localStorage.TheMelodyProgram=gTheMelodyProgram,localStorage.TheChordProgram=gTheChordProgram,localStorage.AlwaysInjectVolumes=gAlwaysInjectVolumes,localStorage.TheBassVolume=gTheBassVolume,localStorage.TheChordVolume=gTheChordVolume,localStorage.BoxTabFontSize=gBoxTabFontSize,localStorage.OverridePlayMIDIParams=gOverridePlayMIDIParams)}function ConfigureToolSettings(){var e=gAlwaysInjectPrograms,t=gTheMelodyProgram,n=gTheChordProgram,o=gAlwaysInjectVolumes,a=gTheBassVolume,r=gTheChordVolume,l=gBoxTabFontSize,s=gOverridePlayMIDIParams;DayPilot.Modal.form([{html:'<p style="text-align:center;font-size:16pt;font-family:helvetica">ABC Transcription Tools Settings</p>'},{html:'<p style="margin-top:10px;font-size:14pt;line-height:16pt;font-family:helvetica">Enabling these options will always use your selected MIDI instrument programs and volumes as the defaults when playing tunes.</p>'},{name:"            Use Default Melody and Bass/Chord programs when playing tunes",id:"configure_inject_programs",type:"checkbox",cssClass:"configure_settings_form_text"},{name:"Default Melody MIDI program (0-135):",id:"configure_melody_program",type:"number",cssClass:"configure_settings_form_text"},{name:"Default Bass/Chords MIDI program (0-135):",id:"configure_chord_program",type:"number",cssClass:"configure_settings_form_text"},{html:'<p style="margin-top:12px;font-size:14pt;line-height:16pt;font-family:helvetica">If there is already a %%MIDI program or %%MIDI chordprog directive in the ABC, the value in the ABC will override the default value.</p>'},{html:'<p style="font-size:14pt;font-family:helvetica;margin-bottom:20px;margin-top:20px;text-align:center"><a href="http://michaeleskin.com/documents/general_midi_extended.pdf" target="_blank">General MIDI Instrument Program Numbers</a></p>'},{name:"            Use Default Bass/Chord volumes when playing tunes",id:"configure_inject_volumes",type:"checkbox",cssClass:"configure_settings_form_text"},{name:"Default Bass MIDI volume (0-127):",id:"configure_bass_volume",type:"number",cssClass:"configure_settings_form_text"},{name:"Default Chords MIDI volume (0-127):",id:"configure_chord_volume",type:"number",cssClass:"configure_settings_form_text"},{html:'<p style="margin-top:12px;margin-bottom:0px;font-size:14pt;line-height:16pt;font-family:helvetica">If there are already a %%MIDI bassvol or %%MIDI chordvol directive in the ABC, the value in the ABC will override the default value.</p>'},{name:"            Override all MIDI programs and volumes in the ABC when playing tunes",id:"configure_override_play_midi_params",type:"checkbox",cssClass:"configure_settings_form_text"},{html:'<p style="margin-top:16px;font-size:14pt;line-height:16pt;font-family:helvetica">To change the Melody volume, add a dynamics indication such as !ppp!, !pp!, !p!, !mp!, !mf!, !f!, or !ff! immediately before the first note in the ABC.</p>'},{name:"Box Tablature Font Size:",id:"configure_box_tab_fontsize",type:"number",cssClass:"configure_settings_form_text"},],{configure_inject_programs:e,configure_melody_program:t,configure_chord_program:n,configure_inject_volumes:o,configure_bass_volume:a,configure_chord_volume:r,configure_box_tab_fontsize:l,configure_override_play_midi_params:s},{theme:"modal_flat",top:20,width:680}).then(function(e){if(!e.canceled){gAlwaysInjectPrograms=e.result.configure_inject_programs,gTheMelodyProgram=e.result.configure_melody_program,gTheChordProgram=e.result.configure_chord_program,gAlwaysInjectVolumes=e.result.configure_inject_volumes,gTheBassVolume=e.result.configure_bass_volume,gTheChordVolume=e.result.configure_chord_volume,gOverridePlayMIDIParams=e.result.configure_override_play_midi_params;var t=e.result.configure_box_tab_fontsize;t=(t=t.replace("pt","")).trim();var n=gBoxTabFontSize;if(isNaN(parseFloat(t))||(gBoxTabFontSize=t),isNaN(parseInt(gTheMelodyProgram))&&(gTheMelodyProgram=0),gTheMelodyProgram<0&&(gTheMelodyProgram=0),gTheMelodyProgram>135&&(gTheMelodyProgram=135),isNaN(parseInt(gTheChordProgram))&&(gTheChordProgram=0),gTheChordProgram<0&&(gTheChordProgram=0),gTheChordProgram>135&&(gTheChordProgram=135),isNaN(parseInt(gTheBassVolume))&&(gTheBassVolume=0),gTheBassVolume<0&&(gTheBassVolume=0),gTheBassVolume>127&&(gTheBassVolume=127),isNaN(parseInt(gTheChordVolume))&&(gTheChordVolume=0),gTheChordVolume<0&&(gTheChordVolume=0),gTheChordVolume>127&&(gTheChordVolume=127),(gAlwaysInjectPrograms||gOverridePlayMIDIParams)&&("15"==gTheMelodyProgram||"15"==gTheChordProgram)){var o='<p style="text-align:center;font-size:16pt;font-family:helvetica">Special Note on the Dulcimer (15) Instrument</p>';o+='<p style="font-size:14pt;line-height:18pt;font-family:helvetica">Selecting the Dulcimer (15) program for either the melody or chords automatically sets all note release times to 4 seconds to allow the notes to ring.</p>',o+='<p style="font-size:14pt;line-height:18pt;font-family:helvetica">This can be useful for tunes using solo melody instruments with long release times like Orchestral Harp (46) or Koto (107).</p>',o+='<p style="font-size:14pt;line-height:18pt;font-family:helvetica">For those instruments played solo, set the melody instrument program as desired and the chord instrument program to Dulcimer (15).</p>',o+='<p style="font-size:14pt;line-height:18pt;font-family:helvetica">In this case, you may not want to include any chords in the ABC, as they will be played using the Dulcimer (15) instrument.</p>',DayPilot.Modal.alert(o,{theme:"modal_flat",top:50,width:600}).then(function(){gTheABC.focus()})}if(SaveConfigurationSettings(),n!=gBoxTabFontSize){var a=GetRadioValue("notenodertab");"bc"==a||(a="cd"),RenderAsync(!0,null)}}gTheABC.focus()})}function DoStartup(){if(gShowAdvancedControls=!1,gShowShareControls=!1,gStripAnnotations=!1,gStripTextAnnotations=!1,gStripChords=!1,gRenderingPDF=!1,gAllowSave=!1,gAllowURLSave=!1,gShowAllControls=!1,gAllowControlToggle=!1,gAllowFilterAnnotations=!1,gAllowFilterText=!1,gAllowFilterChords=!1,gIsMaximized=!1,gCapo=0,gABCFromFile=!1,gAllowCopy=!1,gAllowPDF=!1,gShowTabNames=!0,gAllowShowTabNames=!1,gLastAutoScrolledTune=-1,gTopBarShowing=!0,gCurrentTune=0,gTotalTunes=0,gCurrentTab="noten",gForceFullRender=!1,gIsOneColumn=!0,gLocalStorageAvailable=!1,gPDFQuality=.75,gIncludePageLinks=!0,gDoForcePDFFilename=!1,gForcePDFFilename="",HideMaximizeButton(),DoMaximize(),gIsSafari=!1,isSafari()&&(gIsSafari=!0),gIsIOS=!1,isIOS()&&(gIsIOS=!0),gIsIPad=!1,isIPad()&&(gIsIPad=!0),gIsIPhone=!1,isIPhone()&&(gIsIPhone=!0),gIsAndroid=!1,isAndroid()&&(gIsAndroid=!0),gIsIOS&&document.getElementById("selectabcfile").removeAttribute("accept"),gIsIOS||gIsAndroid){var e=document.getElementById("toolpagetitle");e.size=4,e.style.fontFamily="Helvetica",(e=document.getElementById("notenlinks")).style.paddingTop="20px",(e=gTheABC).cols=74,e.style.fontSize="13pt",e.style.lineHeight="15pt",(e=document.getElementById("app-container")).style.width="860px",e.style.display="block",e.style.marginLeft="0px",(e=document.getElementById("notation-placeholder")).style.width="860px",e.style.display="none",(e=document.getElementById("noscroller")).style.width="860px",e.style.display="none",(e=document.getElementById("notation-holder")).style.width="820px",e.style.display="block",e.style.marginLeft="20px",e.style.marginRight="0px",e.style.overflow="hidden",(e=document.getElementById("notation-spacer")).style.width="860px",e.style.display="block",e.style.marginRight="0px",(e=document.getElementById("uioverlay")).style.width="860px",e.style.display="block",(e=document.getElementById("loading-bar-spinner")).style.top="36px",e.style.left="36px",e.style.marginLeft="-16px",e.style.marginTop="-16px",(e=document.getElementById("spinner-icon")).style.width="32px",e.style.height="32px"}(gIsIPhone||gIsAndroid)&&(document.getElementById("zoombutton").style.right="36px"),gIsIPad&&(document.getElementById("zoombutton").style.width="36px",document.getElementById("zoombutton").style.height="36px",document.getElementById("zoombutton").style.top="8px",document.getElementById("zoombutton").style.right="8px"),document.getElementById("abc").oninput=debounce(()=>{gForceFullRender?RenderAsync(!0,null):OnABCTextChange(),gForceFullRender=!1},DEBOUNCEMS),document.getElementById("abc").onclick=debounce(()=>{MakeTuneVisible(!1)},AUTOSCROLLDEBOUNCEMS),document.getElementById("selectabcfile").onchange=()=>{let e=document.getElementById("selectabcfile");if(0===e.files.length){DayPilot.Modal.alert("Please select an ABC file",{theme:"modal_flat",top:50});return}let t=e.files[0];if(ensureABCFile(t.name)){gTheABC.value="",Render(!0,null),document.getElementById("abc-selected").innerText="Loading: "+t.name,gDisplayedName=t.name;let n=new FileReader;n.addEventListener("load",e=>{gTheABC.value=e.target.result,FocusABC(),setTimeout(function(){RestoreDefaults(),window.scrollTo({top:0}),gABCFromFile=!0,RenderAsync(!0,null,function(){UpdateNotationTopPosition()})},100)}),n.readAsText(t)}},SetRadioValue("notenodertab","noten"),document.getElementById("pdfformat").value="one",document.getElementById("pagenumbers").value="none",document.getElementById("firstpage").value="yes",document.getElementById("zoombutton").onclick=function(){ToggleMaximize()},document.getElementById("staff-spacing").value=STAFFSPACEDEFAULT,gStaffSpacing=STAFFSPACEOFFSET+STAFFSPACEDEFAULT,document.getElementById("capo").value=0,ClearNoRender(),window.localStorage&&(gLocalStorageAvailable=!0,GetInitialConfigurationSettings()),processShareLink()?(isFirstRun()&&showZoomInstructionsScreen(),UpdateLocalStorage()):(DoMinimize(),document.getElementById("notation-placeholder").style.display="block",restoreStateFromLocalStorage()),UpdateNotationTopPosition(),new ResizeObserver(TextBoxResizeHandler).observe(gTheABC),gIsIOS||gIsAndroid||(window.onresize=function(){HandleWindowResize()}),HandleWindowResize(),HideAllControls(),gTheABC.focus()}function WaitForReady(e){if("loading"!==document.readyState){e();return}document.addEventListener("DOMContentLoaded",e)}WaitForReady(DoStartup);var gTinyURLAPIKey="Bearer <YOUR_TINYURL_API_KEY_HERE>";
