var gVersionNumber="3032_112425_1800",gMIDIInitStillWaiting=!1,gShowAdvancedControls=!1,gStripAnnotations=!1,gStripQPTags=!1,gStripTextAnnotations=!1,gStripChords=!1,gStripTab=!1,gStripOrnaments=!1,STAFFSPACEMIN=0,STAFFSPACEDEFAULT=10,STAFFSPACEMAX=200,STAFFSPACEOFFSET=40,gStaffSpacing=STAFFSPACEOFFSET+STAFFSPACEDEFAULT,gIsIOS=!1,gIsIPad=!1,giPadTwoColumn=!1,gIsIPhone=!1,gIsSafari=!1,gIsChrome=!1,gIsAndroid=!1,gUIHidden=!1,gUIHiddenPlayerEnabled=!1,gUIHiddenAllowPlay=!0,gUIHiddenClickTimeout=null,gUIHiddenTuneIndex=0;const UIHiddenTimerDelay=300;var gUIEmbeddedPressTimer=null;const gUIEmbeddedPressTimerDelay=500;var gPlayerClickTimeout=null;const PlayerTimerDelay=300;var gPlayerPressTimer=null;const gPlayerPressTimerDelay=500;var gPlayerTouchStartX=0,gPlayerTouchStartY=0,gPlayerTouchStartTime=0;const gPlayerSwipeThreshold=50;var gPDFHiddenTextX,gInitialTextBoxWidth,gInitialTextBoxContainerWidth,gInitialTextBoxContainerLeft,gPlayerScaling=50,gRenderingPDF=!1,gTheQRCode=null,MAXQRCODEURLLENGTH=2300,ALLTITLESMAXLENGTH=70,HEADERFOOTERFONTSIZE=12,QRCODECAPTIONPDFFONTSIZE=12,gShowShareControls=!1,gAllowSave=!1,gAllowURLSave=!1,gAllowQRCodeSave=!1,gShowAllControls=!1,gAllowControlToggle=!1,gAllowFilterAnnotations=!1,gAllowFilterText=!1,gAllowFilterChords=!1,gAllowFilterTab=!1,gAllowFilterOrnaments=!1,gCapo=0,gIsMaximized=!1,gABCFromFile=!1,gAllowCopy=!1,gAllowPDF=!1,gAllowWebExport=!1,gDisplayedName="",gShowTabNames=!0,gAllowShowTabNames=!1,gWhistleFontPrepared=!1,gRecorderFontPrepared=!1,gRecorderFingeringGerman=!1,DEBOUNCEMS=280,AUTOSCROLLDEBOUNCEMS=200,gLastAutoScrolledTune=-1,gLastClickedTune=-1,gTopBarShowing=!0,gCurrentTune=0,gTotalTunes=0,gCurrentTab="noten",gForceFullRender=!1,gIsFirstRender=!0,gIsOneColumn=!0,gGotRenderDivClick=!1,gRenderDivClickOffset=-1,gLocalStorageAvailable=!1,gPDFQuality=.75,gQualitaet=1200,gPDFPageNumberHOffset=0,gPDFPageNumberVOffset=0,gPDFPageHeaderVOffset=0,gPDFPageFooterVOffset=0,gPDFTitleSpacing=1,gPDFSubTitleSpacing=1,gPDFFont="Times",gPDFFontStyle="",gPDFOrientation="portrait",gPDFPaperSize="letter",gPageWidth=535,gRenderPixelRatio=2,gPDFIncludeHiddenTitles=!0,gPDFAutoPageNumbers=!1,gPDFFileName="",HIDDENPDFTEXTSIZE=18,gIncludePageLinks=!0,gDoForcePDFFilename=!1,gForcePDFFilename="",gAddTOCLinkback=!1,gAddIndexLinkback=!1,gTuneHyperlinks=[],gAddTheSessionHyperlinks=!1,gAddPlaybackHyperlinks=!1,gAddPlaybackHyperlinksIncludePrograms=!1,gPlaybackHyperlinkMelodyProgram="",gPlaybackHyperlinkBassProgram="",gPlaybackHyperlinkChordProgram="",gAddPlaybackHyperlinkVolumes=!1,gPlaybackHyperlinkBassVolume="",gPlaybackHyperlinkChordVolume="",gPlaybackHyperlinkSoundFont="",gAddTunebookPlaybackHyperlinks=!1,gAddAllFonts=!1,gInjectEditDisabled=!1,gDisableEditFromPlayLink=!1,gFullScreenScaling=50,gAngloButtonNames=[],gRenderingFonts={titlefont:"Palatino 18",subtitlefont:"Palatino 13",infofont:"Palatino 13",partsfont:"Palatino 13",tempofont:"Palatino 13",textfont:"Palatino 13",composerfont:"Palatino 13",annotationfont:"Palatino 13",gchordfont:"Verdana 12",vocalfont:"Palatino 13",wordsfont:"Palatino 13",tablabelfont:"Trebuchet MS 14",tabnumberfont:"Arial 12",tabgracefont:"Arial 8",historyfont:"Times New Roman 14",voicefont:"Times New Roman 13"},gMP3Bitrate=224,gDefaultSoundFont="https://paulrosen.github.io/midi-js-soundfonts/FluidR3_GM/",gTheActiveSoundFont=gDefaultSoundFont,gDefaultBodhranPitch="a",gTheActiveBodhranPitch=gDefaultBodhranPitch,gDefaultBanjoStyle="2",gTheActiveBanjoStyle=gDefaultBanjoStyle,gOnlyHighlightV1=!1,gDisablePlayHighlight=!1,gVoiceTuning=null,gAutoscrollPlayer=!0,gAutoscrollSmooth=!0,gAutoSwingHornpipes=!0,gAutoSwingFactor=.25,gAllSwingHornpipesRequested=!1,gAllSwingHornpipesSwingFactor=.25,gAllNoSwingHornpipesRequested=!1,gUseCustomGMSounds=!0,gOverrideCustomGMSounds=!1,gCustomGMSoundsOverride=!1,gTipJarCount=0,gSaveLastAutoSnapShot=!1,gIncipitsColumns=1,gUseComhaltasABC=!1,gForceComhaltasABC=!1,gZoomBannerHidden=!1,gZoomBannerAlwaysHidden=!1,gForceInitialTextBoxRecalc=!1,gGotWindowResizeWhileMaximized=!1,gNotationLeftMarginBeforeMaximize="auto",gTheNotation=document.getElementById("notation-holder"),gAllowMIDIInput=!1,gMIDIChromatic=!1,gIsFromShare=!1,gIsDirty=!1,gIsFirstRun=!1,gAllowRawMode=!1,gRawMode=!1,gRawVisual=null,gRawIsDragging=!1,gRawLastIndex=-1,gRawFirstTime=!0,gRawHighlightColor="#F00000",gPlayerStatusOnLeft=!1,gRoll2DefaultParams="0.95 0.8 1.0 0.75 0.9 1.0 0.75 1.0",gRoll3DefaultParams="1.45 0.6 1.0 0.75 0.9 1.0 0.75 1.0",gDisableNotationRendering=!1,gDisableSelectedPlay=!1,gMixedNotationAndQRCode=!1,gFeaturesShowSearch=!0,gFeaturesShowExamples=!0,gFeaturesShowTemplates=!0,gFeaturesShowTablatures=!0,gFeaturesShowExplorers=!0,gFeaturesShowTabButtons=!0,gFeaturesShowBagpipeDrones=!0,gForceTabSave=!1,gABCEditorFontsize=13,gShowDiagnostics=!1,gShowABCJSRenderProgress=!1,gReverbString="chamber 0.95 0.05",gDoTinyURLAPIKeyOverride=!1,gTinyURLAPIKeyOverride="",gTinyURLCount=0,gMIDIImportWarned=!1,gShowDGDAETab=!1,gShowCGDATab=!1,gShowRecorderTab=!1,gConfirmClear=!0,gOpenInEditor=!1,gCleanSmartQuotes=!0,gAutoscrollTarget=66,gSuppressQuickPlayer=!1,gUpdateAvailable=!1,gUpdateVersion=gVersionNumber,gSpinnerDelay=25,gForceAndroid=!1,gDisableAndroid=!1,gNotoSansLoaded=!1,gNotoSerifLoaded=!1,gInPresentationMode=!1,gMIDIMute=!1,gLastWarp=100,gLastPlayerRepeat=!1,gUseWidePlayCursor=!0,gImportRunning=!1,gImportAccumulator=[],gImportCancelRequested=!1,gJumpToTuneAutoscroll=!0,gCustomInstrumentShowStatus=!0,gLightModeColor="#FDFDFD",gDarkModeColor="#E7E7E7",gEnableSyntax=!1,gSyntaxDarkMode=!1,gSyntaxViewportMargin=20,gEnableSyntaxMessageDelivered=!1,gAlwaysFlattenParts=!1,gTheABC=document.getElementById("abc"),gPDFFormat="one",gPageNumbers="none",gFirstPage="yes";function setPDFFormat(e){gPDFFormat=e}function getPDFFormat(){return gPDFFormat}function setPageNumbers(e){gPageNumbers=e}function getPageNumbers(){return gPageNumbers}function setFirstPage(e){gFirstPage=e}function getFirstPage(){return gFirstPage}function buildABCIncipitsSingleTune(e,t,n={}){const o=/^\s*[A-Za-z]\s*:\s*/,a=/[\|\[\]:]|["'][^"']*["']|[A-Ga-gzxy]/;function l(e,t,n){return e.slice(t,t+Number(n)).join(" | ")}function r(e,t){const n=e.trim();return n?`"^${t}" ${n}`:n}const i=e=>e.replace(/[ \t]+/g," ").replace(/\s*\|\s*/g," | ").replace(/\s+\n/g,"\n").trim();function s(e){return e.replace(/^\s*:+/,"").replace(/^\s*\|+/,"").trim()}function c(e){const t=e.replace(/^\s+/,"");if(!t.startsWith("^"))return e;if(/^\s*"/.test(e))return e;const n=t.slice(1);return/^[A-Ga-g][,']*(?:\d+(?:\/\d*)?)?(?=$|[\s\|\]\)-]|-)/.test(n)?e:'"'+e}const{headerText:g,bodyText:d}=function(e){const t=e.replace(/\r/g,"").split("\n"),n=[];let l=0;for(let e=0;e<t.length;e++){const r=t[e],i=/^\s*$/.test(r),s=/^\s*%/.test(r),c=o.test(r),g=a.test(r);if(!i&&!s&&!c&&g){l=e;break}n.push(r),l=e+1}return{headerText:n.join("\n"),bodyText:t.slice(l).join("\n")}}(e),u=function(e,t){if(!/\nV\s*:/i.test("\n"+e))return e;const n=e.split(/\n(?=V\s*:[^\n]*\n?)/i),o=new Map,a=e=>e.replace(/^V\s*:\s*/i,"").trim().split(/\s+/)[0];for(const e of n){if(!/^\s*V\s*:/i.test(e)){o.set("_PRE_",(o.get("_PRE_")||"")+e);continue}const t=e.split("\n"),n=a(t[0]),l=t.slice(1).join("\n");o.set(n,(o.get(n)||"")+l)}const l=t||[...o.keys()].find(e=>"_PRE_"!==e);let r=(o.get(l)||"").trim();return o.has("_PRE_")&&(r=(o.get("_PRE_")+"\n"+r).trim()),r}(d,n?.voice),{measures:m,anchors:p,barTypes:h}=function(e){let t=e.replace(/\r/g,"");t=t.replace(/\n(?:[A-Za-z]\s*:[^\n]*)/g,"\n"),t=t.replace(/[!\\]+\s*(?=\n|$)/g,"");const n=[],o=[],a=[];let l="";const r=(e=null)=>{const t=l.trim();t&&(n.push(t),a.push(e)),l=""},i=e=>" "===e||"\t"===e||"\n"===e;for(let e=0;e<t.length;e++){if("|"===t[e]&&/[0-9]/.test(t[e+1]||"")){for(r("volta"),e+=1;/[0-9]/.test(t[e+1]||"");)e+=1;for(;" "===t[e+1];)e+=1;continue}if("["===t[e]&&/[0-9]/.test(t[e+1]||"")){for(r("volta"),e+=1;/[0-9]/.test(t[e+1]||"");)e+=1;for(;" "===t[e+1];)e+=1;continue}const a=t.slice(e,e+3),s=t.slice(e,e+2);let c=null;if("[|]"===a||"|||"===a?c=a:"|:"===s||":|"===s||"::"===s||"||"===s||"|]"===s||"[|"===s?c=s:"|"===t[e]&&(c="|"),c){let a="other";if("|:"===c?a="start_repeat":":|"===c?a="end_repeat":"||"===c||"|||"===c||"|]"===c||"[|]"===c?a="double":"|"===c&&(a="single"),r(a),"|:"===c)o.push(n.length);else if(":|"===c){let a=e+2;for(;i(t[a]);)a++;if("["===t[a])for(a++;i(t[a]);)a++;let l=!1;if(/[0-9]/.test(t[a]||"")){for("2"===t[a]&&(l=!0);/[0-9]/.test(t[a]||"");)a++;for(;i(t[a]);)a++}l||o.push(n.length),e=a-1}else"double"===a&&o.push(n.length);e+=c.length-1;continue}l+=t[e]}const s=l.trim();s&&(n.push(s),a.push(null));const c=[];for(const e of o)(!c.length||e>c[c.length-1])&&c.push(e);return{measures:n,anchors:c,barTypes:a}}(u);let f=0;p.length&&1===p[0]&&"start_repeat"===h[0]?f=1:h.length>=2&&"single"===h[0]&&"start_repeat"===h[1]&&p.length?f=p[0]:p.length&&0===p[0]&&(f=0);const b=[f];for(const e of p)e>f&&b.push(e);const y=Number(t),T=[];for(let e=0;e<b.length;e++){const t=Math.min(b[e],m.length);if(t>=m.length)break;let n=l(m,t,y);if(n=i(n),n=s(n),n=c(n),!n)continue;const o=A(e)+" Part";T.push(r(n,`${o}`))}if(!T.length)return e;let I=!!n.partsOnNewLines?T.join(" ||\n"):T.join(" || ");return I=I.replace(/\s+$/g,""),/\|\|\s*$/.test(I)||(I+=" ||"),g.replace(/\s+$/g,"")+"\n"+I+"\n";function A(e){let t=e+1,n="";for(;t>0;){const e=(t-1)%26;n=String.fromCharCode(65+e)+n,t=Math.floor((t-1)/26)}return n}}function hasStaffSep(e){return e.split(/\r?\n/).some(e=>e.trim().toLowerCase().startsWith("%%staffsep"))}function ensureMoreToolsVisible(){if(AllowDialogsToScroll()){var e=document.querySelector("#injectheaderstring");e&&e.scrollIntoView({behavior:"instant",block:"center"})}}function ensureDialogVisible(e){if(AllowDialogsToScroll()){var t=document.querySelector(e);t&&t.scrollIntoView({behavior:"instant",block:"center"})}}function loadScript(e,t){const n=document.createElement("script");n.src=e,n.type="text/javascript",n.onload=()=>{console.log(`${e} loaded successfully`),t&&t()},n.onerror=()=>{console.error(`Failed to load script: ${e}`),t&&t()},document.head.appendChild(n)}function replaceEscapedDiacriticals(e){const t={"\\'A":"Á","\\'E":"É","\\'I":"Í","\\'O":"Ó","\\'U":"Ú","\\'a":"á","\\'e":"é","\\'i":"í","\\'o":"ó","\\'u":"ú","\\`A":"À","\\`E":"È","\\`I":"Ì","\\`O":"Ò","\\`U":"Ù","\\`a":"à","\\`e":"è","\\`i":"ì","\\`o":"ò","\\`u":"ù",'\\"A':"Ä",'\\"E':"Ë",'\\"I':"Ï",'\\"O':"Ö",'\\"U':"Ü",'\\"a':"ä",'\\"e':"ë",'\\"i':"ï",'\\"o':"ö",'\\"u':"ü","\\~N":"Ñ","\\~n":"ñ","\\^A":"Â","\\^E":"Ê","\\^I":"Î","\\^O":"Ô","\\^U":"Û","\\^a":"â","\\^e":"ê","\\^i":"î","\\^o":"ô","\\^u":"û","\\cC":"Ç","\\cc":"ç"};return e.replace(/\\['"`~^c]["A-Za-z]/g,e=>t[e]||e)}function escapeDiacriticals(e){const t={"Á":"\\'A","É":"\\'E","Í":"\\'I","Ó":"\\'O","Ú":"\\'U","á":"\\'a","é":"\\'e","í":"\\'i","ó":"\\'o","ú":"\\'u","À":"\\`A","È":"\\`E","Ì":"\\`I","Ò":"\\`O","Ù":"\\`U","à":"\\`a","è":"\\`e","ì":"\\`i","ò":"\\`o","ù":"\\`u","Ä":'\\"A',"Ë":'\\"E',"Ï":'\\"I',"Ö":'\\"O',"Ü":'\\"U',"ä":'\\"a',"ë":'\\"e',"ï":'\\"i',"ö":'\\"o',"ü":'\\"u',"Ñ":"\\~N","ñ":"\\~n","Â":"\\^A","Ê":"\\^E","Î":"\\^I","Ô":"\\^O","Û":"\\^U","â":"\\^a","ê":"\\^e","î":"\\^i","ô":"\\^o","û":"\\^u","Ç":"\\cC","ç":"\\cc"};return e.replace(/[\u00C0-\u00FF]/g,e=>t[e]||e)}function customSortTagWithDiacriticals(e,t){const n=e.tag.localeCompare(t.tag,"en",{sensitivity:"base"});if(0!==n)return n;return e.tag.localeCompare(t.tag,"en",{sensitivity:"variant",caseFirst:"lower"})}function customSortNameWithDiacriticals(e,t){const n=e=>{const t=e.match(/^(\d+)\.\s*/);return t?parseInt(t[1],10):null},o=n(e.name),a=n(t.name);if(null!==o&&null!==a){if(o!==a)return o-a}else{if(null!==o)return-1;if(null!==a)return 1}const l=e.name.localeCompare(t.name,"en",{sensitivity:"base"});if(0!==l)return l;return e.name.localeCompare(t.name,"en",{sensitivity:"variant",caseFirst:"lower"})}function customSortTitleWithDiacriticals(e,t){const n=e=>{const t=e.match(/^(\d+)\.\s*/);return t?parseInt(t[1],10):null},o=n(e.title),a=n(t.title);if(null!==o&&null!==a){if(o!==a)return o-a}else{if(null!==o)return-1;if(null!==a)return 1}const l=e.title.localeCompare(t.title,"en",{sensitivity:"base"});if(0!==l)return l;return e.title.localeCompare(t.title,"en",{sensitivity:"variant",caseFirst:"lower"})}function adjustWarningLineNumbers(e){if(!e||0==e.length)return e;function t(e,t){return e.replace(/^"([^"]+)"(\s*-\s*)(\d+)(?=:\d+)/,(e,n,o,a)=>{const l=Number(a)-t;if(l<t){return`ABC Header${o}${Math.max(0,l+t)}`}return`"${n}"${o}${l-1}`})}var n=0,o=GetABCFileHeader();o&&o.length&&(n=o.split(/\r\n|\r|\n/).filter(e=>""!==e.trim()).length);for(var a=e.length,l=0;l<a;++l)e[l]=t(e[l],n);return e}function SetupEmbeddedMobileEventHanders(e){e.addEventListener("touchstart",e=>{gUIEmbeddedPressTimer=setTimeout(()=>{if(gUIHiddenPlayerEnabled){const e=document.querySelector("button.abcjs-midi-reset");e&&e.click()}gUIEmbeddedPressTimer=null},500)});["touchend","touchmove","touchcancel"].forEach(t=>{e.addEventListener(t,e=>{clearTimeout(gUIEmbeddedPressTimer),gUIEmbeddedPressTimer=null})}),e.addEventListener("contextmenu",e=>{e.preventDefault()})}function SetupPlayerEventHandlers(){var e=document.getElementById("playerholder");e&&(isPureDesktopBrowser()?e.title="Double-click to play/pause. Shift-click to rewind playback.":(e.addEventListener("touchstart",e=>{const t=e.touches[0];gPlayerTouchStartX=t.clientX,gPlayerTouchStartY=t.clientY,gPlayerTouchStartTime=Date.now(),gPlayerPressTimer=setTimeout(()=>{const e=document.querySelector("button.abcjs-midi-reset");e&&e.click(),gPlayerPressTimer=null},500)}),e.addEventListener("touchmove",e=>{clearTimeout(gPlayerPressTimer),gPlayerPressTimer=null}),e.addEventListener("touchend",e=>{const t=e.changedTouches[0],n=t.clientX-gPlayerTouchStartX,o=t.clientY-gPlayerTouchStartY,a=Date.now()-gPlayerTouchStartTime;if(clearTimeout(gPlayerPressTimer),gPlayerPressTimer=null,Math.abs(n)>Math.abs(o)&&Math.abs(n)>50&&a<1e3)if(n>0){const e=document.getElementById("abcplayer_previousbutton");e&&e.click()}else{const e=document.getElementById("abcplayer_nextbutton");e&&e.click()}}),e.addEventListener("touchcancel",e=>{clearTimeout(gPlayerPressTimer),gPlayerPressTimer=null}),e.addEventListener("contextmenu",e=>{e.preventDefault()})),gPlayerClickTimeout=null,e.onclick=function(e){if(gPlayerClickTimeout){clearTimeout(gPlayerClickTimeout),gPlayerClickTimeout=null;const e=document.querySelector("button.abcjs-midi-start");e&&e.click()}else gPlayerClickTimeout=setTimeout(()=>{if(isPureDesktopBrowser()&&e.shiftKey){const e=document.querySelector("button.abcjs-midi-reset");e&&e.click()}gPlayerClickTimeout=null},300)})}function normalizeBlankLines(e){return e.replace(/\n{3,}/g,"\n\n").trim()}function setABCEditorText(e){clearGetTuneByIndexCache(),gEnableSyntax?"undefined"!=typeof gTheCM&&gTheCM.setValue(e):gTheABC.value=e}function getABCEditorText(){var e="",t="";return"undefined"!=typeof gTheCM&&gTheCM&&"function"==typeof gTheCM.getValue&&(e=gTheCM.getValue()),void 0!==gTheABC&&gTheABC&&(t=gTheABC.value),gEnableSyntax?e||t:t||e}function showTheSpinner(e){var t=document.getElementById("spinnerLabel");e&&(t.innerText=e);var n=(t=document.getElementById("spinnerOverlay")).style.display;"block"!=n&&(t.style.display="block"),"inline-block"!=(n=(t=document.getElementById("loading-bar-spinner")).style.display)&&(t.style.display="inline-block")}function hideTheSpinner(){var e=document.getElementById("spinnerLabel");e.innerText="Rendering ABC";var t=(e=document.getElementById("spinnerOverlay")).style.display;"none"!=t&&(e.style.display="none"),"none"!=(t=(e=document.getElementById("loading-bar-spinner")).style.display)&&(e.style.display="none")}function cleanFileName(e){var t=e.replace(/[^a-zA-Z'áÁóÓúÚíÍéÉäÄöÖüÜÀàÈèÌìÒòÙù0-9_\-. ]+/gi,"");return t=t.replace(/\s+/g," ")}function isMultiVoiceTune(e){const t=e.split("\n"),n=new Set,o=/^V:\s*(\S+)/;for(const e of t){const t=e.match(o);t&&n.add(t[1])}return n.size>1}function getTuneTitle(e){for(var t=e.split("\n"),n=0;n<t.length;++n){var o=t[n].trim();if(o.startsWith("T:"))return o.slice(2).trim()}return"No Title"}function stripAllABCTuneHeaders(e){return e.replace(/^(X:|T:|M:|K:|L:|Q:|W:|Z:|R:|C:|A:|O:|P:|N:|G:|H:|B:|D:|F:|S:|I:|:[A-Za-z]:)[^\r\n]*\r?\n?/gm,"")}function removeABCTuneHeaders(e){for(var t="XTMKLQWZRCAOPNGHBDFSI",n="",o=e.split("\n"),a=!1,l=!1,r=!0,i=0;i<o.length;++i){var s=o[i].trim(),c=s.split(""),g=!1;if(r){if(""==s)continue;if(s.startsWith("%%begintext")){a=!0;continue}if(s.startsWith("%%endtext")){a=!1;continue}if(a)continue;if(s.startsWith("%%begincss")){l=!0;continue}if(s.startsWith("%%endcss")){l=!1;continue}if(l)continue;"%"===c[0]&&(g=!0);for(var d=0;d<21;++d)if(c[0]===t[d]&&":"===c[1]){g=!0;break}}g||(r=!1,n+=o[i],i!==o.length-1&&(n+="\n"))}return n}function isSectionHeader(e){var t=e.match(/^T:\s*\*.*$/m);return!!(t&&t.length>0)}function findTuneOffsetByIndex(e){var t=getABCEditorText();if(0==e){var n=t.search(/^X:.*[\r\n]*/m);return-1==n?0:n}for(var o=t.split(/^X:/gm),a=o[0].length,l=1;l<=e;++l)a+=o[l].length+2;return a}function findTuneByOffset(e){var t=getABCEditorText().split(/^X:/gm),n=t.length,o=0;o=t[0].length;for(var a=1;a<n;++a)if(e<(o+=t[a].length+2))return a-1;return n-2}var gGetTuneByIndexCache=null;function clearGetTuneByIndexCache(){gGetTuneByIndexCache=null}function getTuneByIndex(e){if(null==gGetTuneByIndexCache){var t=getABCEditorText();gGetTuneByIndexCache=t.split(/^X:/gm)}const n=("X:"+gGetTuneByIndexCache[e+1]).split("\n");let o=[];for(let e of n){if(""===e.trim())break;o.push(e)}return o.join("\n")}function getSelectedText(e){var t=document.getElementById(e),n=t.selectionStart,o=t.selectionEnd;return t.value.substring(n,o)}function findSelectedTune(){var e=getABCEditorText(),t=(gEnableSyntax?gTheCM:gTheABC).selectionStart;if(0==t&&(t=e.indexOf("X:")+2),0==t)return"";var n=e.length;t==n&&(t=n-1);var o=e.split(/^X:/gm),a=o.length,l=0;l=o[0].length;for(var r=1;r<a;++r)if(t<(l+=o[r].length+2)){var i="X:"+o[r];return i=i.trimEnd()}return""}function GetFirstTuneTitle(e){for(var t=getABCEditorText().split("\n"),n="",o=0;o<t.length;++o){var a=t[o].trim();if(a.startsWith("T:")){n=(n=a.slice(2)).trim(),n=e?(n=cleanFileName(n)).replace(/\s/g," "):(n=cleanFileName(n)).replace(/\s/g,"_");break}}return n}function CountTunes(){var e=getABCEditorText();if(0===(e=e.trim()).length)return gTotalTunes=0,0;var t=e.split(/^X:.*$/gm).length-1;return 0===t&&e.length>0&&e.match(/^[A-Z]:|^[|\[\(]/m)&&(t=1),gTotalTunes=t,t}function CountTunesInBuffer(e){var t=e.split(/^X:.*$/gm).length-1;return gTotalTunes=t,t}function GetAllTuneTitles(){for(var e=[],t=getABCEditorText().split("\n"),n="",o=0;o<t.length;++o){var a=t[o].trim();a.startsWith("T:")&&(n=a.slice(2).trim(),e.push(n))}var l=e.length,r="";if(l>0)for(var i=0;i<l;++i){if((r+=e[i]).length>ALLTITLESMAXLENGTH){var s=l-i-1;return s>0&&(r=r+" + "+s+" more"),r}i!=l-1&&(r+=" / ")}return r}function SetupRawModeUI(){var e;(gRawMode=!1,gRawLastIndex=-1,gAllowRawMode)?((e=document.getElementById("rawmodebutton")).value="Highlighting",gEnableSyntax?setCMDarkMode(gDarkModeColor,gLightModeColor):gTheABC.style.backgroundColor=gLightModeColor,e.classList.remove("rawmodebutton"),e.classList.add("rawmodebuttondisabled"),e.classList.add("btn-rawmode-off"),e.classList.remove("btn-rawmode-on")):((e=document.getElementById("rawmodebutton")).value="Highlighting",e.classList.remove("rawmodebutton"),e.classList.add("rawmodebuttondisabled"),e.classList.add("btn-rawmode-off"),e.classList.remove("btn-rawmode-on"),gEnableSyntax?setCMDarkMode(gDarkModeColor,gLightModeColor):gTheABC.style.backgroundColor=gLightModeColor);gEnableSyntax&&gTheCM.refresh()}function ShowHighlightingExplanation(){sendGoogleAnalytics("dialog","ShowHighlightingExplanation");DayPilot.Modal.alert('<p style="text-align:center;font-size:18pt;font-family:helvetica">About Highlighting</p><p style="font-size:14pt;line-height:22pt;font-family:helvetica">Since this is your first time using Highlighting, here is some important information:</p><p style="font-size:14pt;line-height:22pt;font-family:helvetica">When Highlighting is turned on:</p><p style="font-size:14pt;line-height:22pt;font-family:helvetica">Select ABC text to highlight the corresponding notes in red in the notation.</p><p style="font-size:14pt;line-height:22pt;font-family:helvetica">Click any element in the notation to select the corresponding ABC text in the editor.</p><p style="font-size:14pt;line-height:22pt;font-family:helvetica">Highlighting requires redrawing all tunes on each change to the ABC.</p><p style="font-size:14pt;line-height:22pt;font-family:helvetica">This may be slow on large numbers of tunes.</p><p style="font-size:14pt;line-height:22pt;font-family:helvetica">All pre-processing of the ABC at notation drawing time is turned off. Any hiding of Annotations/Text/Chords selected in the Advanced dialog as well as automatic injection of staff separation space will be disabled. Your settings will be restored when you turn highlighting off.</p>',{theme:"modal_flat",top:50,scrollWithPage:AllowDialogsToScroll()})}function ToggleRawMode(){if(gDisableNotationRendering){var e="Highlighting not possible with rendering disabled.";return e=makeCenteredPromptString(e),void DayPilot.Modal.alert(e,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})}if(!(gIsQuickEditor&&-1==gCurrentTune||isMobileBrowser()||0==CountTunes())){gRawMode=!gRawMode;var t=document.getElementById("rawmodebutton");gRawLastIndex=-1,gRawMode?(gRawFirstTime&&(ShowHighlightingExplanation(),gRawFirstTime=!1,SaveConfigurationSettings()),t.value="Highlighting",t.classList.add("btn-rawmode-on"),t.classList.remove("btn-rawmode-off"),gEnableSyntax?setCMDarkMode("#ffe0ff","#F8FDF8"):gTheABC.style.backgroundColor="#F8FDF8"):(t.value="Highlighting",t.classList.add("btn-rawmode-off"),t.classList.remove("btn-rawmode-on"),gEnableSyntax?setCMDarkMode(gDarkModeColor,gLightModeColor):gTheABC.style.backgroundColor=gLightModeColor),gEnableSyntax&&gTheCM.refresh(),gIsQuickEditor?Render(!0,null):RenderAsync(!0,null),gIsQuickEditor&&(gRawMode?(document.getElementById("playbutton").classList.remove("playbutton"),document.getElementById("playbutton").classList.add("playbuttondisabled")):(document.getElementById("playbutton").classList.remove("playbuttondisabled"),document.getElementById("playbutton").classList.add("playbutton")))}}function transposeSingleTune(e,t,n){var o=(e=e.replace(/"([^"]*)\(\s*([^"]*)\)"/g,'"$1"x"($2)"')).split("\n"),a=o.map(e=>(e.match(/"([^"]*)"/g)||[]).map(e=>e.slice(1,-1)));const l=a.map(e=>e.map(e=>e.startsWith("(")&&e.endsWith(")")));if(l.some(e=>e.includes(!0))){const e=a.map(e=>e.map(e=>e.startsWith("(")&&e.endsWith(")")?e.replace(/\(|\)/g,""):e));var r=o.map((t,n)=>{let o=t;return e[n].forEach((e,t)=>{o=o.replace(a[n][t],e)}),o}).join("\n");r=(r=r.replace(/^%abcjs_render_params/gm,"%foo_abcjs_render_params")).replace(/^%%visualtranspose/gm,"%%foo_visualtranspose");var i=ABCJS.renderAbc("*",r,n),s=ABCJS.strTranspose(r,i,t);o=s.split("\n"),a=o.map(e=>(e.match(/"([^"]*)"/g)||[]).map(e=>e.slice(1,-1)));var c=s.split("\n").map((e,t)=>{const n=e.split(/("[^"]*")/);let o=0;return n.map(e=>{if(e.startsWith('"')&&e.endsWith('"')){const e=a[t][o];return l[t][o]?(o++,`"(${e})"`):(o++,`"${e}"`)}return e}).join("")}).join("\n");return c=(c=(c=c.replaceAll('"x"',"")).replace(/^%%foo_visualtranspose/gm,"%%visualtranspose")).replace(/^%foo_abcjs_render_params/gm,"%abcjs_render_params")}e=(e=e.replace(/^%abcjs_render_params/gm,"%foo_abcjs_render_params")).replace(/^%%visualtranspose/gm,"%%foo_visualtranspose");i=ABCJS.renderAbc("*",e,n);return e=(e=(e=ABCJS.strTranspose(e,i,t)).replace(/^%%foo_visualtranspose/gm,"%%visualtranspose")).replace(/^%foo_abcjs_render_params/gm,"%abcjs_render_params")}function getTuneRangeForTranspose(){var e,t=getABCEditorText(),n=(e=gEnableSyntax?gTheCM:gTheABC).selectionStart;0==n&&(n=t.indexOf("X:")+2);var o=e.selectionEnd;return 0==o&&(o=t.indexOf("X:")+2),{start:findTuneByOffset(n),end:findTuneByOffset(o)}}function resetSelectionAfterTranspose(e,t){clearGetTuneByIndexCache();var n=findTuneOffsetByIndex(e),o=getTuneByIndex(t),a=findTuneOffsetByIndex(t)+(o.length-1);gEnableSyntax?(gTheCM.selectionStart=n,gTheCM.selectionEnd=a):(gTheABC.selectionStart=n,gTheABC.selectionEnd=a),FocusAfterOperation()}function ShowTransposeWarningDialog(e){sendGoogleAnalytics("dialog","ShowTransposeWarningDialog");var t='<p style="text-align:center;font-size:18pt;font-family:helvetica;">Some Tunes Were Not Tranposed</p>';t+='<p style="font-size:12pt;line-height:18pt;margin-top:36px;">During the operation some tunes were not able to be transposed:</p>';for(var n=e.length,o=0;o<n;++o)t+='<p style="font-size:12pt;line-height:12pt;">',t+=e[o],t+="</p>";DayPilot.Modal.alert(t,{theme:"modal_flat",top:100,width:630,scrollWithPage:AllowDialogsToScroll()})}function Transpose(e){if(gDisableNotationRendering){var t="Transpose not possible with rendering disabled.";return t=makeCenteredPromptString(t),void DayPilot.Modal.alert(t,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})}if(!gRenderingPDF){sendGoogleAnalytics("action","Transpose");var n=CountTunes(),o=getTuneRangeForTranspose(),a=o.end-o.start+1;a<=0||(a>5&&showTheSpinner("Transposing ABC"),setTimeout(function(){for(var t=getABCEditorText(),a=GetABCJSParams(),l=t.split(/^X:/gm),r=FindPreTuneHeader(t),i=!1,s=[],c=1;c<=n;++c){l[c]="X:"+l[c];var g=getTuneTitle(l[c]);if(c-1>=o.start&&c-1<=o.end)try{r+=transposeSingleTune(l[c],e,a)}catch(e){i=!0,r+=l[c],s.push(g),gShowABCJSRenderProgress&&console.log("Transpose failed: "+g)}else r+=l[c]}setABCEditorText(r),gIsDirty=!0,resetSelectionAfterTranspose(o.start,o.end),setTimeout(function(){gRawMode?RenderAsync(!0,null,function(){i&&ShowTransposeWarningDialog(s)}):RenderRangeAsync(o.start,o.end,function(){i&&ShowTransposeWarningDialog(s)})},0)},gSpinnerDelay))}}function TransposeUp(e){var t=1;e.shiftKey&&(t=2),e.altKey&&(t=12),Transpose(t)}function TransposeDown(e){var t=-1;e.shiftKey&&(t=-2),e.altKey&&(t=-12),Transpose(t)}function getTuneRootKey(e){for(var t=e.split("\n"),n=t.length,o="",a=!1,l=0;l<n;++l)if(-1!=(o=t[l]).trim().indexOf("K:")){a=!0;break}if(!a)return"C";var r=(o=(o=o.replace("K:","")).trim())[0].toUpperCase();return o.length>1&&("#"!=o[1]&&"b"!=o[1]||(r=o.substring(0,2))),r}var gLastTransposeToKey="A";function TransposeToKeyDialog(){const e={transposekey:gLastTransposeToKey,transposeall:!1},t=[{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Transpose to Key&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#advanced_transposetokey" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="margin-top:36px;margin-bottom:12px;font-size:12pt;line-height:18pt;font-family:helvetica">This will transpose the current tune or all the tunes to the specified root key.</p>'},{html:'<p style="margin-bottom:12px;font-size:12pt;line-height:18pt;font-family:helvetica">Any modes specified in the tune keys will be preserved.</p>'},{html:'<p style="margin-top:12px;margin-bottom:42px;font-size:12pt;line-height:18pt;font-family:helvetica"><strong>If the Transpose to Key results are too high or too low:</strong><br/>Click in a single tune or select across one or more tunes in the ABC editor then <strong>Alt-click</strong> the lower toolbar <strong>Transpose Up</strong> or <strong>Transpose Down</strong> buttons to transpose the tune(s) down or up an octave.</p>'},{name:"Root key:",id:"transposekey",type:"select",options:[{name:"C",id:"C"},{name:"C#",id:"C#"},{name:"D♭",id:"Db"},{name:"D",id:"D"},{name:"D#",id:"D#"},{name:"E♭",id:"Eb"},{name:"E",id:"E"},{name:"F",id:"F"},{name:"F#",id:"F#"},{name:"G♭",id:"Gb"},{name:"G",id:"G"},{name:"G#",id:"G#"},{name:"A♭",id:"Ab"},{name:"A",id:"A"},{name:"A#",id:"A#"},{name:"B♭",id:"Bb"},{name:"B",id:"B"}],cssClass:"configure_transpose_settings_select"},{name:"          Transpose all tunes",id:"transposeall",type:"checkbox",cssClass:"configure_transposetokey_text"},{html:'<p style="font-size:12pt;font-family:helvetica">&nbsp;</p>'}];DayPilot.Modal.form(t,e,{theme:"modal_flat_wide",top:200,width:600,scrollWithPage:AllowDialogsToScroll(),okText:"Transpose",autoFocus:!1}).then(function(e){e.canceled||DoTransposeToKey(gLastTransposeToKey=e.result.transposekey,e.result.transposeall)})}function DoTransposeToKey(e,t){function n(e){const t=[{name:"C",degree:0},{name:"C#",degree:1},{name:"Db",degree:1},{name:"D",degree:2},{name:"D#",degree:3},{name:"Eb",degree:3},{name:"E",degree:4},{name:"F",degree:5},{name:"F#",degree:6},{name:"Gb",degree:6},{name:"G",degree:7},{name:"G#",degree:8},{name:"Ab",degree:8},{name:"A",degree:9},{name:"A#",degree:10},{name:"Bb",degree:10},{name:"B",degree:11}];for(var n=t.length,o=0;o<n;++o)if(t[o].name==e)return t[o].degree;return 0}var o=n(e);if(gDisableNotationRendering){var a="Transpose not possible with rendering disabled.";return a=makeCenteredPromptString(a),void DayPilot.Modal.alert(a,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})}gRenderingPDF||(sendGoogleAnalytics("dialog","TransposeToKey"),showTheSpinner("Transposing ABC"),setTimeout(function(){var e=GetABCJSParams(),a=CountTunes(),l=0;t||(l=findSelectedTuneIndex());var r,i=FindPreTuneHeader(getABCEditorText()),s=!1,c=[];clearGetTuneByIndexCache();for(var g=0;g<a;++g){var d=getTuneByIndex(g);if(isSectionHeader(d))i+=d,i+="\n\n";else try{var u=n(getTuneRootKey(d));if(o<=u){var m=h=-1*(u-o);h<0&&(h*=-1);var p=f=o+12-u;f<0&&(f*=-1),transposeAmount=h<=f?m:p}else{var h,f;m=h=o-u;h<0&&(h*=-1),(f=u+12-o)>12&&(f-=12);p=f*=-1;f<0&&(f*=-1),transposeAmount=h<=f?m:p}if(t)if(0!=transposeAmount)r=getTuneTitle(d),i+=transposeSingleTune(d,transposeAmount,e),i+="\n\n";else i+=d,i+="\n\n";else if(0!=transposeAmount)if(g==l)r=getTuneTitle(d),i+=transposeSingleTune(d,transposeAmount,e),i+="\n\n";else i+=d,i+="\n\n";else i+=d,i+="\n\n"}catch(e){s=!0,c.push(r),gShowABCJSRenderProgress&&console.log("Transpose failed: "+r),i+=d,i+="\n\n"}}setABCEditorText(i),gIsDirty=!0;var b=t,y=l;gRawMode&&(b=!0),b&&(y=null),setTimeout(function(){RenderAsync(b,y,function(){gRawLastIndex=-1,DayPilot.Modal.alert('<p style="text-align:center;font-size:14pt;font-family:helvetica;">Transpose to Key Complete!</p>',{theme:"modal_flat",top:300,width:500,scrollWithPage:AllowDialogsToScroll()}).then(function(){gEnableSyntax?gTheCM.selectionStart:gTheABC.selectionStart,t?(gEnableSyntax?(gTheCM.selectionStart=0,gTheCM.selectionEnd=0):(gTheABC.selectionStart=0,gTheABC.selectionEnd=0),gCurrentTune=0):(gCurrentTune=l,resetSelectionAfterTranspose(l,l)),FocusAfterOperation(),s&&ShowTransposeWarningDialog(c)})})},0)},gSpinnerDelay))}function GetAllTuneTags(e,t){var n,o=[],a=e+":";for(n=0;n<t;++n){for(var l=getTuneByIndex(n).split("\n"),r=!1,i=0;i<l.length;++i)if(0==l[i].trim().indexOf(a)){var s=l[i].slice(2);s=s.trim(),o.push(s),r=!0;break}r||o.push(" ")}return o}function SortTunesByTag(e,t){const n=[{name:"C|",weight:1},{name:"C",weight:2},{name:"2/2",weight:10},{name:"3/2",weight:11},{name:"2/4",weight:7},{name:"3/4",weight:8},{name:"4/4",weight:3},{name:"5/4",weight:12},{name:"6/4",weight:9},{name:"7/4",weight:13},{name:"2/8",weight:14},{name:"3/8",weight:15},{name:"5/8",weight:16},{name:"6/8",weight:4},{name:"7/8",weight:17},{name:"9/8",weight:5},{name:"10/8",weight:18},{name:"11/8",weight:19},{name:"12/8",weight:6}];var o=getABCEditorText(),a=o.split(/(^X:.*$)/gm),l=(a.length-1)/2;if(!(l<2)){var r=a[0],i=GetAllTuneTags(e,a.length-1),s=i.length;if("M"==e){for(var c=[],g=0;g<s;++g){for(var d=i[g],u=19,m=0;m<n.length;++m)if(d==n[m].name){u=n[m].weight;break}c.push(u)}i=c}var p=[],h=0;for(g=0;g<l;++g)null!=a[2*g+1]&&(thisTag=i[h],t&&(thisTag=thisTag.toLowerCase()),h++,p.push({tag:thisTag,tune:a[2*g+1]+a[2*g+2]}));for("X"!=e&&"M"!=e?p.sort(customSortTagWithDiacriticals):p.sort((e,t)=>{const n=parseInt(e.tag);isNaN(n)&&(n=0);const o=parseInt(t.tag);return isNaN(o)&&(o=0),n<o?-1:n>o?1:0}),o="",o+=r,g=0;g<h;++g){var f=p[g].tune;o+=f=f.replace(/\n*$/,"")+"\n\n"}setABCEditorText(o=o.replace(/\n*$/,"")+"\n"),gIsDirty=!0,gEnableSyntax?(gTheCM.selectionStart=0,gTheCM.selectionEnd=0):(gTheABC.selectionStart=0,gTheABC.selectionEnd=0),FocusAfterOperation()}}function DoSortTunesByMeter(){if(!gRenderingPDF){var e=document.getElementById("sortbutton");e&&(e.value="Sorting..."),setTimeout(function(){SortTunes(),SortTunesByTag("M",!1);const e=window.scrollY||document.documentElement.scrollTop;var t="Tunes sorted by Meter!";t=makeCenteredPromptString(t),DayPilot.Modal.alert(t,{theme:"modal_flat",top:300,scrollWithPage:AllowDialogsToScroll()}).then(function(){RenderAsync(!0,null,function(){AllowDialogsToScroll()&&window.scrollTo(0,e),ensureMoreToolsVisible();var t=document.getElementById("sortbutton");t&&(t.value="   Sorted!   "),setTimeout(function(){var e=document.getElementById("sortbutton");e&&(e.value="Sort by Tag")},500)})})},250)}}function DoSortTunesByKey(){if(!gRenderingPDF){var e=document.getElementById("sortbutton");e&&(e.value="Sorting..."),setTimeout(function(){SortTunes(),SortTunesByTag("K",!1);const e=window.scrollY||document.documentElement.scrollTop;var t="Tunes sorted by Key!";t=makeCenteredPromptString(t),DayPilot.Modal.alert(t,{theme:"modal_flat",top:300,scrollWithPage:AllowDialogsToScroll()}).then(function(){RenderAsync(!0,null,function(){AllowDialogsToScroll()&&window.scrollTo(0,e),ensureMoreToolsVisible();var t=document.getElementById("sortbutton");t&&(t.value="   Sorted!   "),setTimeout(function(){var e=document.getElementById("sortbutton");e&&(e.value="Sort by Tag")},500)})})},250)}}function processTitleForSorting(e){const t={"The ":", The","Da ":", Da","An ":", An","A ":", A","Le ":", Le","La ":", La","Ye ":", Ye","Les ":", Les","an ":", an","Der ":", Der","Die ":", Die","Das ":", Das","Ein ":", Ein","Eine ":", Eine"};for(const[n,o]of Object.entries(t))if(e.startsWith(n))return e.slice(n.length)+o;return e}function SortTunes(){var e=getABCEditorText(),t=e.split(/(^X:.*$)/gm),n=(t.length-1)/2;if(!(n<2)){var o=t[0];totalTunes=n;var a,l,r=GetTunebookIndexTitles(),i=[],s=0;for(a=0;a<n;++a)null!=t[2*a+1]&&(l=processTitleForSorting(l=r[s]),s++,i.push({title:l,tune:t[2*a+1]+t[2*a+2]}));for(i.sort(customSortTitleWithDiacriticals),e="",e+=o,a=0;a<s;++a){var c=i[a].tune;e+=c=c.replace(/\n*$/,"")+"\n\n"}setABCEditorText(e=e.replace(/\n*$/,"")+"\n"),gIsDirty=!0,gEnableSyntax?(gTheCM.selectionStart=0,gTheCM.selectionEnd=0):(gTheABC.selectionStart=0,gTheABC.selectionEnd=0),FocusAfterOperation()}}function DoSortTunesByName(){if(!gRenderingPDF){var e=document.getElementById("sortbutton");e&&(e.value="Sorting..."),setTimeout(function(){SortTunes();const e=window.scrollY||document.documentElement.scrollTop;var t="Tunes sorted by Title!";t=makeCenteredPromptString(t),DayPilot.Modal.alert(t,{theme:"modal_flat",top:300,scrollWithPage:AllowDialogsToScroll()}).then(function(){RenderAsync(!0,null,function(){AllowDialogsToScroll()&&window.scrollTo(0,e),ensureMoreToolsVisible();var t=document.getElementById("sortbutton");t&&(t.value="   Sorted!   "),setTimeout(function(){var e=document.getElementById("sortbutton");e&&(e.value="Sort by Tag")},500)})})},250)}}function DoSortTunesByRhythm(){if(!gRenderingPDF){var e=document.getElementById("sortbutton");e&&(e.value="Sorting..."),setTimeout(function(){SortTunes(),SortTunesByTag("R",!0);const e=window.scrollY||document.documentElement.scrollTop;var t="Tunes sorted by Rhythm!";t=makeCenteredPromptString(t),DayPilot.Modal.alert(t,{theme:"modal_flat",top:300,scrollWithPage:AllowDialogsToScroll()}).then(function(){RenderAsync(!0,null,function(){AllowDialogsToScroll()&&window.scrollTo(0,e),ensureMoreToolsVisible();var t=document.getElementById("sortbutton");t&&(t.value="   Sorted!   "),setTimeout(function(){var e=document.getElementById("sortbutton");e&&(e.value="Sort by Tag")},500)})})},250)}}function DoSortTunesByCTag(){if(!gRenderingPDF){var e=document.getElementById("sortbutton");e&&(e.value="Sorting..."),setTimeout(function(){SortTunes(),SortTunesByTag("C",!0);const e=window.scrollY||document.documentElement.scrollTop;var t="Tunes sorted by Composer!";t=makeCenteredPromptString(t),DayPilot.Modal.alert(t,{theme:"modal_flat",top:300,scrollWithPage:AllowDialogsToScroll()}).then(function(){RenderAsync(!0,null,function(){AllowDialogsToScroll()&&window.scrollTo(0,e),ensureMoreToolsVisible();var t=document.getElementById("sortbutton");t&&(t.value="   Sorted!   "),setTimeout(function(){var e=document.getElementById("sortbutton");e&&(e.value="Sort by Tag")},500)})})},250)}}function DoSortTunesByNTag(){if(!gRenderingPDF){var e=document.getElementById("sortbutton");e&&(e.value="Sorting..."),setTimeout(function(){SortTunes(),SortTunesByTag("N",!0);const e=window.scrollY||document.documentElement.scrollTop;var t="Tunes sorted by Notes!";t=makeCenteredPromptString(t),DayPilot.Modal.alert(t,{theme:"modal_flat",top:300,scrollWithPage:AllowDialogsToScroll()}).then(function(){RenderAsync(!0,null,function(){AllowDialogsToScroll()&&window.scrollTo(0,e),ensureMoreToolsVisible();var t=document.getElementById("sortbutton");t&&(t.value="   Sorted!   "),setTimeout(function(){var e=document.getElementById("sortbutton");e&&(e.value="Sort by Tag")},500)})})},250)}}function DoSortTunesByOTag(){if(!gRenderingPDF){var e=document.getElementById("sortbutton");e&&(e.value="Sorting..."),setTimeout(function(){SortTunes(),SortTunesByTag("O",!0);const e=window.scrollY||document.documentElement.scrollTop;var t="Tunes sorted by Origin!";t=makeCenteredPromptString(t),DayPilot.Modal.alert(t,{theme:"modal_flat",top:300,scrollWithPage:AllowDialogsToScroll()}).then(function(){RenderAsync(!0,null,function(){AllowDialogsToScroll()&&window.scrollTo(0,e),ensureMoreToolsVisible();var t=document.getElementById("sortbutton");t&&(t.value="   Sorted!   "),setTimeout(function(){var e=document.getElementById("sortbutton");e&&(e.value="Sort by Tag")},500)})})},250)}}function DoSortTunesByID(){if(!gRenderingPDF){var e=document.getElementById("sortbutton");e&&(e.value="Sorting..."),setTimeout(function(){SortTunes(),SortTunesByTag("X",!1);const e=window.scrollY||document.documentElement.scrollTop;var t="Tunes sorted by ID!";t=makeCenteredPromptString(t),DayPilot.Modal.alert(t,{theme:"modal_flat",top:300,scrollWithPage:AllowDialogsToScroll()}).then(function(){RenderAsync(!0,null,function(){AllowDialogsToScroll()&&window.scrollTo(0,e),ensureMoreToolsVisible();var t=document.getElementById("sortbutton");t&&(t.value="   Sorted!   "),setTimeout(function(){var e=document.getElementById("sortbutton");e&&(e.value="Sort by Tag")},500)})})},250)}}function RenumberXTags(){var e=getABCEditorText(),t=e.split(/(^X:.*$)/gm),n=t.length;e="",e+=t[0];var o=1;for(i=1;i<n;++i)i%2?(e+="X:"+o,o++):e+=t[i];setABCEditorText(e),gIsDirty=!0,gEnableSyntax?(gTheCM.selectionStart=0,gTheCM.selectionEnd=0):(gTheABC.selectionStart=0,gTheABC.selectionEnd=0),FocusAfterOperation();var a="X: tags renumbered!";a=makeCenteredPromptString(a),DayPilot.Modal.alert(a,{theme:"modal_flat",top:300,scrollWithPage:AllowDialogsToScroll()})}var gLastSortOrder="0";function SortDialog(){if(totalTunes=CountTunes(),0==GetTunebookIndexTitles().length){var e="No tunes to sort.";return e=makeCenteredPromptString(e),void DayPilot.Modal.alert(e,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})}sendGoogleAnalytics("dialog","SortDialog");const t={configure_sort:gLastSortOrder},n=[{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Sort by Specific Tag&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#sort_dialog" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="margin-top:36px;margin-bottom:36px;font-size:12pt;line-height:18pt;font-family:helvetica">This will sort the tunes based on the ABC tag you select:</p>'},{name:"Tag to sort by:",id:"configure_sort",type:"select",options:[{name:"  Sort by Title (T:)",id:"0"},{name:"  Sort by Key (K:)",id:"1"},{name:"  Sort by Meter (M:)",id:"2"},{name:"  Sort by Rhythm (R:)",id:"3"},{name:"  Sort by Composer (C:)",id:"4"},{name:"  Sort by Notes (N:)",id:"5"},{name:"  Sort by Origin (O:)",id:"6"},{name:"  Sort by ID (X:)",id:"7"},{name:"  Renumber all X: Tags",id:"8"}],cssClass:"configure_sort_settings_select"},{html:'<p style="font-size:12pt;font-family:helvetica">&nbsp;</p>'}];DayPilot.Modal.form(n,t,{theme:"modal_flat",top:200,width:500,scrollWithPage:AllowDialogsToScroll(),okText:"Sort",autoFocus:!1}).then(function(e){if(!e.canceled)switch(gLastSortOrder=e.result.configure_sort,e.result.configure_sort){case"0":default:DoSortTunesByName();break;case"1":DoSortTunesByKey();break;case"2":DoSortTunesByMeter();break;case"3":DoSortTunesByRhythm();break;case"4":DoSortTunesByCTag();break;case"5":DoSortTunesByNTag();break;case"6":DoSortTunesByOTag();break;case"7":DoSortTunesByID();break;case"8":RenumberXTags()}})}function Clear(){function e(){gIsFromShare=!1,gIsDirty=!1;var e=document.getElementById("rawmodebutton");e.value="Highlighting",e.classList.remove("rawmodebutton"),e.classList.add("rawmodebuttondisabled"),e.classList.add("btn-rawmode-off"),e.classList.remove("btn-rawmode-on"),gEnableSyntax?(setCMDarkMode(gDarkModeColor,gLightModeColor),gTheCM.refresh()):gTheABC.style.backgroundColor=gLightModeColor,gRawMode=!1,gRawLastIndex=-1,RestoreSavedStaffSpacing(),ClearNoRender(),RenderAsync(!0,null),gEnableSyntax?gTheCM.focus():gTheABC.focus(),(e=document.getElementById("diagnostics")).innerHTML="",gIsQuickEditor&&(gMIDIbuffer=null,gIsIOS&&gTheMuteHandle&&(gTheMuteHandle.dispose(),gTheMuteHandle=null),gSynthControl&&(gSynthControl.destroy(),gSynthControl=null))}if(!gRenderingPDF)if(sendGoogleAnalytics("action","Clear"),gConfirmClear){var t="Are you sure you want to erase all the ABC and start over?";t=makeCenteredPromptString(t),DayPilot.Modal.confirm(t,{top:200,theme:"modal_flat",scrollWithPage:AllowDialogsToScroll()}).then(function(t){t.canceled||e()})}else e()}function ClearNoRender(){setABCEditorText(""),gDisplayedName="No ABC file selected",gABCFromFile=!1,RestoreDefaults()}function RestoreSavedStaffSpacing(){if(gLocalStorageAvailable){var e=localStorage.abcStaffSpacing;e=parseInt(e),gStaffSpacing=isNaN(e)?STAFFSPACEOFFSET+STAFFSPACEDEFAULT:STAFFSPACEOFFSET+e}}function DoSaveLastAutoSnapShot(){if(gLocalStorageAvailable){var e=getABCEditorText();localStorage.LastAutoSnapShot=e}}function SaveSnapshot(e){if(gLocalStorageAvailable){sendGoogleAnalytics("action","SaveSnapshot");var t,n=getABCEditorText();e&&e.shiftKey&&e.altKey?(t="4",localStorage.SavedSnapshot4=n):e&&e.altKey?(t="3",localStorage.SavedSnapshot3=n):e&&e.shiftKey?(t="2",localStorage.SavedSnapshot2=n):(t="1",localStorage.SavedSnapshot=n),document.getElementById("snapshotbutton").value="Saved #"+t,setTimeout(function(){document.getElementById("snapshotbutton").value="Snapshot"},500)}else{sendGoogleAnalytics("action","SaveSnapshot_Fail");var o="Snapshot storage not available on this browser.";o=makeCenteredPromptString(o),DayPilot.Modal.alert(o,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})}}function RestoreSnapshot(e,t,n){if(gLocalStorageAvailable){sendGoogleAnalytics("action","RestoreSnapshot");var o,a,l,r,i,s;getABCEditorText();if(t)o=localStorage.LastAutoSnapShot,d="Replace the contents of the ABC editor with the Auto-Snapshot?",s="No saved Auto-Snapshot available to restore.";else{var c,g=!0;a=localStorage.SavedSnapshot,l=localStorage.SavedSnapshot2,r=localStorage.SavedSnapshot3,i=localStorage.SavedSnapshot4,e&&e.shiftKey&&e.altKey?(o=i,c="4"):e&&e.altKey?(o=r,c="3"):e&&e.shiftKey?(o=l,c="2"):(o=a,g=!1,c="1"),n&&(g||(a&&""!=a?(o=a,c="1"):l&&""!=l?(o=l,c="2"):r&&""!=r?(o=r,c="3"):i&&""!=i&&(o=i,c="4"))),d="Replace the contents of the ABC editor with Snapshot #"+c+"?",s="No saved Snapshot #"+c+" available to restore."}d=makeCenteredPromptString(d),o&&""!=o?DayPilot.Modal.confirm(d,{top:200,theme:"modal_flat",scrollWithPage:AllowDialogsToScroll()}).then(function(e){var a;e.canceled||(n?(t?(a=document.getElementById("dialogrestoreautobutton"))&&(a.value="Restoring from Auto-Snapshot"):(a=document.getElementById("dialogrestorebutton"))&&(a.value="Restoring from Snapshot"),setTimeout(function(){setABCEditorText(o),gIsFromShare=!1,gIsDirty=!0,RestoreSavedStaffSpacing(),RenderAsync(!0,null,function(){var e;t?(e=document.getElementById("dialogrestoreautobutton"))&&(e.value="Restored from Auto-Snapshot"):(e=document.getElementById("dialogrestorebutton"))&&(e.value="Restored from Snapshot"),setTimeout(function(){var e;t?(e=document.getElementById("dialogrestoreautobutton"))&&(e.value="Restore from Auto-Snapshot"):(e=document.getElementById("dialogrestorebutton"))&&(e.value="Restore from Snapshot")},500),gRawLastIndex=-1,gCurrentTune=0})},250)):(document.getElementById("restorebutton").value="Restoring",setTimeout(function(){setABCEditorText(o),gIsFromShare=!1,RestoreSavedStaffSpacing(),gIsDirty=!0,RenderAsync(!0,null,function(){document.getElementById("restorebutton").value="Restored",setTimeout(function(){document.getElementById("restorebutton").value="Restore"},500),gRawLastIndex=-1,gCurrentTune=0})},250)))}):(sendGoogleAnalytics("action","RestoreSnapshot_Fail_1"),DayPilot.Modal.alert('<p style="text-align:center;font-size:18px;">'+s+"</p>",{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()}))}else{var d;sendGoogleAnalytics("action","RestoreSnapshot_Fail_2"),d=makeCenteredPromptString(d="Snapshot storage not available on this browser."),DayPilot.Modal.alert(d,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})}}var pdf,gPAGENUMBERTOP=296,PAGETOPOFFSET=32,PAGEBOTTOMOFFSET=24,PAGELEFTOFFSET=37,PAGELEFTOFFSETA4=29,PAGEHEIGHTLETTER=792,PAGEHEIGHTA4=842,PAGEHEIGHTLETTER_LANDSCAPE=580,PAGEHEIGHTA4_LANDSCAPE=565,BETWEENTUNESPACE=20,gPDFLeftMarginOverride=0,gPDFLeftMarginOverrideRequested=!1,gPDFNotationWidthOverride=0,gPDFNotationWidthOverrideRequested=!1,gPDFNotationWidthAutoOverride=0,gPDFNotationWidthAutoOverrideRequested=!1,gPDFTOCIndexPercent=.5,gPDFTOCIndexPercentRequested=!1,gBetweenTuneSpace=20,gGotBetweenTuneSpace=!1,running_height=PAGETOPOFFSET,column_number=0,theCurrentPageNumber=1,isFirstPage=!0,tunesProcessed=0,totalTunes=0,thePageHeader="",thePageFooter="",thePageHeaderURL="",thePageFooterURL="",theRenderTime="",theHeaderFooterTuneNames="",thePageNumberVerticalOffset=0,gQRCodeRequested=!1,gQRCodeURLOverride="",gDoForceQRCodeURLOverride=!1,gQRCodeCaptionOverride="",gDoForceQRCodeCaptionOverride=!1,TunebookIndexRequested=!1,theTunebookIndexTitle="",TunebookSortedIndexRequested=!1,theTunebookSortedIndexTitle="",TunebookIndexHeaderRequested=!1,theTunebookIndexHeader="",TunebookTOCRequested=!1,theTunebookTOCTitle="",TunebookSortedTOCRequested=!1,theTunebookSortedTOCTitle="",TunebookTOCHeaderRequested=!1,theTunebookTOCHeader="",TunebookTPRequested=!1,theTunebookTP="",theTunebookTPURL="",TunebookTPSTRequested=!1,theTunebookTPST="",theTunebookTPSTURL="",TunebookBookmarksAdded=!1,TunebookTOCWithNoPageNumbers=!1,TunebookIndexWithNoPageNumbers=!1,TunebookFirstPageNumber=0,TunebookFirstPageAuto=!1,theTunePageMap=[],PDFJPGQUALITY=.8,PDFSCALEFACTOR=1.55,theOffscreen=null,gPDFCancelRequested=!1,gPDFTabselected="noten";function GetTunebookIndexTitles(){var e,t=[];for(e=0;e<totalTunes;++e){for(var n=getTuneByIndex(e).split("\n"),o=!1,a=0;a<n.length;++a){var l=n[a].trim();if(l.startsWith("T:")){var r=l.slice(2).trim();t.push(r),o=!0;break}}o||t.push("No Title")}return t}var TPTITLESIZE=24,TPSTTITLESIZE=16,gTPTOPOFFSET=435,TPSTOFFSET=24;function AppendTuneTitlePage(e,t,n,o){function a(t,n,o,a,l){let r=n;return t.forEach(t=>{if(""!==t.trim())if(a&&""!==a){const n=e.getTextWidth(t);e.textWithLink(t,e.internal.pageSize.getWidth()/3.1-n/2,r,{align:"center",url:a})}else e.text(t,e.internal.pageSize.getWidth()/3.1,r,{align:"center"});r+=o*l}),r-n}e.setPage(1);let l=0;if(""!==n){e.setFont(gPDFFont,gPDFFontStyle,"normal"),e.setFontSize(TPTITLESIZE);const t=n.split(/<br\s*\/?>/gi),o=t[0].trim();if(""!==o)if(theTunebookTPURL&&""!==theTunebookTPURL){const t=e.getTextWidth(o);e.textWithLink(o,e.internal.pageSize.getWidth()/3.1-t/2,gTPTOPOFFSET,{align:"center",url:theTunebookTPURL})}else e.text(o,e.internal.pageSize.getWidth()/3.1,gTPTOPOFFSET,{align:"center"});if(t.length>1){l=a(t.slice(1),gTPTOPOFFSET+TPTITLESIZE*gPDFTitleSpacing,TPTITLESIZE,theTunebookTPURL,gPDFTitleSpacing)}}if(""!==o){e.setFont(gPDFFont,gPDFFontStyle,"normal"),e.setFontSize(TPSTTITLESIZE);a(o.split(/<br\s*\/?>/gi),gTPTOPOFFSET+TPSTOFFSET+l,TPSTTITLESIZE,theTunebookTPSTURL,gPDFSubTitleSpacing)}}var gTEXTINCIPITTOPOFFSET=330,TEXTINCIPITBOTTOMOFFSET=12,gTEXTINCIPITLEFTMARGIN=65,gTEXTINCIPITRIGHTMARGIN=190,TEXTINCIPITFONTSIZE=12,TEXTINCIPITLINESPACING=12,TEXTINCIPITGUTTER=5;function fitIncipitsTitle(e,t,n,o){var a=t;if(""==t)return a="No title",""!=n&&(a+=" ("+n+")"),a;a=a.trim(),""!=n&&(a+=" ("+n+")"),e.setFont(gPDFFont,gPDFFontStyle,"normal"),e.setFontSize(TEXTINCIPITFONTSIZE);var l=e.getTextWidth(a);if(""==t)return a;if(l<=o)return a;var r="...";""!=n&&(r+=" ("+n+")"),o-=e.getTextWidth(r),o-=e.getTextWidth("W");for(var i="",s=a.length,c=0;c<s&&(i+=a[c],!(e.getTextWidth(i)>o));++c);return i+r}function cleanIncipitLine(e){return searchRegExp=/\[V:\s*\d+\]/gm,e=e.replace(searchRegExp,""),searchRegExp=/V:\s+\S+\s/gm,e=e.replace(searchRegExp,""),searchRegExp=/V:[^ ]+ /gm,e=e.replace(searchRegExp,""),searchRegExp=/![^!\n]*!/gm,e=(e=(e=(e=(e=e.replace(searchRegExp,"")).replaceAll(":","")).replaceAll("[","")).replaceAll("]","")).replaceAll("\\","")}function GenerateTextIncipits(e,t,n,o,a,l,r){var i,s,c,g,d,u,m,p,h,f,b,y,T=e.internal.pageSize.getHeight(),I=e.internal.pageSize.getWidth()/1.55,A=T-(PAGETOPOFFSET+TEXTINCIPITBOTTOMOFFSET),S=gTEXTINCIPITTOPOFFSET,C=GetTunebookIndexTitles();e.setFont(gPDFFont,gPDFFontStyle,"normal"),e.setFontSize(TEXTINCIPITFONTSIZE);var v=[];for(i=0;i<totalTunes;++i){for(b=/^M:.*[\r\n]*/gm,p=(m=StripTabOne(StripChordsOne(StripTextAnnotationsOne(StripAnnotationsOneForIncipits(getTuneByIndex(i))))).replace(b,"").split("\n")).length,y="",s=0;s<p&&-1==(y=m[s]).indexOf("K:");++s);for(y=(y=(y=(y=(y=(y=(y=(y=(y=(y=(y=y.replace("K:","")).trim()).replace("Major","maj")).replace("Minor","min")).replace("Dorian","dor")).replace("Mixolydian","mix")).replace("major","maj")).replace("minor","min")).replace("dorian","dor")).replace("mixolydian","mix")).replace(" ",""),s=0;s<p;++s)if(-1==(g=m[s]).indexOf("%%score")&&-1!=g.indexOf("|")){if(s<=p-2)for(c=s+1;c<p;++c){var x=m[c];if(-1!=x.indexOf("|")){g+=x;break}}break}for(u=[],h=(d=(g=cleanIncipitLine(g)).split("|")).length,s=0;s<h;++s)""!=d[s]&&u.push(d[s]);for((h=u.length)>3&&(h=3),f="",s=0;s<h;++s)u[s]=u[s].trim(),f+=u[s],s!=h-1&&(f+=" | ");0==(g=f).indexOf(" | ")&&(g=g.substring(3,g.length)),g=g.replaceAll("  "," "),_=C[i],g=g.length>40?(g=g.substring(0,40)).trim():g.trim(),r&&(_=processTitleForSorting(_)),_=fitIncipitsTitle(e,_,y,I-gTEXTINCIPITRIGHTMARGIN-gTEXTINCIPITLEFTMARGIN-TEXTINCIPITGUTTER),v.push({title:_,incipit:g,index:i})}if(r){var _,B=[];for(i=0;i<totalTunes;++i)B.push({title:v[i].title,incipit:v[i].incipit,index:v[i].index});for(B.sort(customSortTitleWithDiacriticals),i=0;i<totalTunes;++i)v[i].title=B[i].title,v[i].incipit=B[i].incipit,v[i].index=B[i].index}for(i=0;i<totalTunes;++i){var P=!1;0==(_=v[i].title).indexOf("*")&&(_=(_=_.replaceAll("*","")).trim(),P=!0,S+=TEXTINCIPITLINESPACING),g=v[i].incipit,e.setFont(gPDFFont,gPDFFontStyle,"normal"),e.setFontSize(TEXTINCIPITFONTSIZE);var D,w=e.getTextWidth(_);P?(0!=i&&(theCurrentPageNumber++,e.addPage(a,gPDFOrientation),e.setFont(gPDFFont,gPDFFontStyle,"normal"),e.setFontSize(TEXTINCIPITFONTSIZE),S=gTEXTINCIPITTOPOFFSET),e.setFont(gPDFFont,"bold","normal"),e.setFontSize(TEXTINCIPITFONTSIZE),w=e.getTextWidth(_),e.text(_,e.internal.pageSize.getWidth()/3.1-w/2,S,{align:"left"})):(e.text(_,gTEXTINCIPITLEFTMARGIN,S,{align:"left"}),e.setFont("Courier","normal","normal"),e.setFontSize(TEXTINCIPITFONTSIZE),e.text(g,I-gTEXTINCIPITRIGHTMARGIN,S,{align:"left"})),l.push(theCurrentPageNumber),"portrait"==gPDFOrientation?(D=119,"a4"==a&&(D=125),gTuneHyperlinks.push({page:theCurrentPageNumber,x:1.55*gTEXTINCIPITLEFTMARGIN,y:1.55*S-(gTEXTINCIPITTOPOFFSET+D),width:1.55*w,height:1.55*TEXTINCIPITLINESPACING,url:""})):(D=78,"a4"==a&&(D=82),gTuneHyperlinks.push({page:theCurrentPageNumber,x:1.55*gTEXTINCIPITLEFTMARGIN,y:1.55*(S-TEXTINCIPITLINESPACING)-(gTEXTINCIPITTOPOFFSET+D),width:1.55*w,height:1.55*TEXTINCIPITLINESPACING,url:""})),S+=TEXTINCIPITLINESPACING,P&&(S+=TEXTINCIPITLINESPACING),i!=totalTunes-1&&S>A&&(theCurrentPageNumber++,e.addPage(a,gPDFOrientation),e.setFont(gPDFFont,gPDFFontStyle,"normal"),e.setFontSize(TEXTINCIPITFONTSIZE),S=gTEXTINCIPITTOPOFFSET)}if(r){var E=[];for(i=0;i<totalTunes;++i)for(s=0;s<totalTunes;++s)if(v[s].index==i){E.push(gTuneHyperlinks[s]);break}gTuneHyperlinks=E}return l}var FULLTEXTINCIPITFONTSIZE=11,FULLTEXTINCIPITLINESPACING=9,FULLTEXTINCIPITLEFTMARGIN=45;function GenerateFullTextIncipits(e,t,n,o,a,l,r,i){var s=e.internal.pageSize.getHeight(),c=(e.internal.pageSize.getWidth(),s-(PAGETOPOFFSET+TEXTINCIPITBOTTOMOFFSET)),g=gTEXTINCIPITTOPOFFSET;FULLTEXTINCIPITFONTSIZE=11,FULLTEXTINCIPITLINESPACING=9,FULLTEXTINCIPITLEFTMARGIN=35,i&&(FULLTEXTINCIPITFONTSIZE=10,FULLTEXTINCIPITLINESPACING=8,FULLTEXTINCIPITLEFTMARGIN=30);var d,u,m,p,h,f,b,y,T,I,A,S=GetTunebookIndexTitles();e.setFont(gPDFFont,gPDFFontStyle,"normal"),e.setFontSize(FULLTEXTINCIPITFONTSIZE);var C=[];for(d=0;d<totalTunes;++d){for(m=getTuneByIndex(d),i&&0!=S[d].indexOf("*")&&(m=ceoltasABCTransformer(m,!1,!0)),I=/^M:.*[\r\n]*/gm,_=(f=(m=(m=StripTabOne(m=StripChordsOne(m=StripTextAnnotationsOne(m=StripAnnotationsOneForIncipits(m))))).replace(I,"")).split("\n")).length,A="",w=0;w<_&&-1==(A=f[w]).indexOf("K:");++w);A=(A=(A=(A=(A=(A=(A=(A=(A=(A=(A=A.replace("K:","")).trim()).replace("Major","maj")).replace("Minor","min")).replace("Dorian","dor")).replace("Mixolydian","mix")).replace("major","maj")).replace("minor","min")).replace("dorian","dor")).replace("mixolydian","mix")).replace(" ","");var v=[];for(u=0;u<_;++u)if(-1!=(E=f[u]).indexOf("|")){for(h=[],b=(p=(E=cleanIncipitLine(E)).split("|")).length,w=0;w<b;++w)""!=p[w]&&h.push(p[w]);for(b=h.length,y="",w=0;w<b;++w)h[w]=h[w].trim(),y+=h[w],w!=b-1&&(y+=" | ");0==(E=y).indexOf(" | ")&&(E=E.substring(3,E.length)),v.push(E)}T=(T=S[d]).trim(),""!=A&&(T+=" ("+A+")"),C.push({title:T,incipits:v})}for(d=0;d<totalTunes;++d){var x=!1;0==(T=C[d].title).indexOf("*")&&(T=(T=T.replaceAll("*","")).trim(),x=!0,0!=d&&(theCurrentPageNumber++,e.addPage(a,gPDFOrientation),g=gTEXTINCIPITTOPOFFSET));var _=(v=C[d].incipits).length,B=1.5*FULLTEXTINCIPITLINESPACING;_>0&&(B+=(_-1)*FULLTEXTINCIPITLINESPACING),g+B>c&&(theCurrentPageNumber++,e.addPage(a,gPDFOrientation),e.setFont("Courier","normal","normal"),e.setFontSize(FULLTEXTINCIPITFONTSIZE),g=gTEXTINCIPITTOPOFFSET),l.push(theCurrentPageNumber),e.setFont(gPDFFont,"bold","normal"),e.setFontSize(1.1*FULLTEXTINCIPITFONTSIZE),e.text(T,FULLTEXTINCIPITLEFTMARGIN,g,{align:"left"});var P,D=e.getTextWidth(T);"portrait"==gPDFOrientation?(P=117,"a4"==a&&(P=124),gTuneHyperlinks.push({page:theCurrentPageNumber,x:1.55*FULLTEXTINCIPITLEFTMARGIN,y:1.55*g-(gTEXTINCIPITTOPOFFSET+P),width:1.55*D,height:1.5*FULLTEXTINCIPITLINESPACING*1.55,url:""})):(P=83,"a4"==a&&(P=83),gTuneHyperlinks.push({page:theCurrentPageNumber,x:1.55*FULLTEXTINCIPITLEFTMARGIN,y:1.55*(g-FULLTEXTINCIPITLINESPACING)-(gTEXTINCIPITTOPOFFSET+P),width:1.55*D,height:1.8*FULLTEXTINCIPITLINESPACING*1.55,url:""})),g+=1.5*FULLTEXTINCIPITLINESPACING;for(var w=0;w<_;++w){var E=v[w];e.setFont("Courier","normal","normal"),e.setFontSize(FULLTEXTINCIPITFONTSIZE),e.text(E,FULLTEXTINCIPITLEFTMARGIN,g,{align:"left"}),w==_-1&&d!=totalTunes-1&&(g+=FULLTEXTINCIPITLINESPACING),g+=FULLTEXTINCIPITLINESPACING,d!=totalTunes-1&&g>c&&(theCurrentPageNumber++,e.addPage(a,gPDFOrientation),e.setFont("Courier","normal","normal"),e.setFontSize(FULLTEXTINCIPITFONTSIZE),g=gTEXTINCIPITTOPOFFSET)}x&&(g+=FULLTEXTINCIPITLINESPACING),d!=totalTunes-1&&g>c&&(theCurrentPageNumber++,e.addPage(a,gPDFOrientation),e.setFont("Courier","normal","normal"),e.setFontSize(FULLTEXTINCIPITFONTSIZE),g=gTEXTINCIPITTOPOFFSET)}return l}function processSingleTunePlaybackInjectsQR(e){if(gAllNoSwingHornpipesRequested){if(tuneIsHornpipe(e)&&-1==e.indexOf("%swing")){t=/^X:.*[\r\n]*/gm;e="X:1\n%noswing\n"+(e=e.replace(t,""))}}else if(gAllSwingHornpipesRequested&&tuneIsHornpipe(e)&&-1==e.indexOf("%noswing")){var t=/^X:.*[\r\n]*/gm;e=e.replace(t,""),e="X:1\n%swing "+gAllSwingHornpipesSwingFactor+"\n"+e}if(gAddPlaybackHyperlinksIncludePrograms){t=/^X:.*[\r\n]*/gm;e=e.replace(t,""),e=gAddPlaybackHyperlinkVolumes?"X:1\n%abcjs_soundfont "+gPlaybackHyperlinkSoundFont+"\n%%MIDI program "+gPlaybackHyperlinkMelodyProgram+"\n%%MIDI bassprog "+gPlaybackHyperlinkBassProgram+"\n%%MIDI bassvol "+gPlaybackHyperlinkBassVolume+"\n%%MIDI chordprog "+gPlaybackHyperlinkChordProgram+"\n%%MIDI chordvol "+gPlaybackHyperlinkChordVolume+"\n%add_all_playback_links\n"+e:"X:1\n%abcjs_soundfont "+gPlaybackHyperlinkSoundFont+"\n%%MIDI program "+gPlaybackHyperlinkMelodyProgram+"\n%%MIDI bassprog "+gPlaybackHyperlinkBassProgram+"\n%%MIDI chordprog "+gPlaybackHyperlinkChordProgram+"\n%add_all_playback_links\n"+e}gAddAllFonts&&(e=injectAllFonts(e));var n=e.indexOf("%incipits_inject_start");if(-1!=n){var o=e.substring(0,n),a="%incipits_inject_end",l=e.indexOf(a);l+=21,o+=e.substring(l,e.length),e=o}return e}function PostProcessMixedNotationAndQRCode(e,t,n,o,a,l,r){IntermixTuneQRCodes(e,o,a,l,function(){r()})}function IntermixTuneQRCodes(e,t,n,o,a){if(0!=totalTunes){var l,r=GetTunebookIndexTitles();gTuneHyperlinks=[];!function i(s){gPDFCancelRequested?a():s!=totalTunes?(document.getElementById("statustunecount").innerHTML="Adding Tune QR Code "+(s+1)+" of "+totalTunes,l=getTuneByIndex(s),gAddPlaybackHyperlinks&&(l=processSingleTunePlaybackInjectsQR(l)),theCurrentPageNumber=s!=totalTunes-1?n[s+1]-1:o,e.setPage(theCurrentPageNumber),AppendPDFTuneQRCode(pdf,t,l,r[s],function(){i(++s)})):a()}(0)}else a()}function GenerateFullTuneQRCodes(e,t,n,o,a,l,r){if(0!=totalTunes){var i,s=GetTunebookIndexTitles();!function t(n){gPDFCancelRequested?r(l):n!=totalTunes?(document.getElementById("statustunecount").innerHTML="Adding Tune QR Code "+(n+1)+" of "+totalTunes,n>0&&e.addPage(a,gPDFOrientation),i=getTuneByIndex(n),gAddPlaybackHyperlinks&&(i=processSingleTunePlaybackInjectsQR(i)),AppendPDFTuneQRCode(pdf,a,i,s[n],function(){l.push(theCurrentPageNumber),n!=totalTunes-1&&theCurrentPageNumber++;t(++n)})):r(l)}(0)}else r([])}var gINDEXTOPOFFSET=330,INDEXBOTTOMOFFSET=16,INDEXTITLEOFFSET=35,INDEXLEFTMARGIN=90,INDEXRIGHTMARGIN=105,INDEXTITLESIZE=18,INDEXFONTSIZE=13,INDEXLINESPACING=12,gINDEXLEFTOFFSET=0,gINDEXRIGHTOFFSET=0;function AppendTunebookIndex(e,t,n,o,a,l,r,i,s,c){e.addPage(o,gPDFOrientation),TunebookIndexHeaderRequested&&AddPageTextHeader(e,o,theTunebookIndexHeader),e.setFont(gPDFFont,gPDFFontStyle,"normal"),e.setFontSize(INDEXTITLESIZE),""!=l&&e.text(l,e.internal.pageSize.getWidth()/3.1,gINDEXTOPOFFSET,{align:"center"});var g,d,u=GetTunebookIndexTitles(),m=pdf.internal.pageSize.getHeight(),p=pdf.internal.pageSize.getWidth()/1.55,h=m-(PAGETOPOFFSET+INDEXBOTTOMOFFSET),f=gINDEXTOPOFFSET+INDEXTITLEOFFSET;e.setFont(gPDFFont,gPDFFontStyle,"normal"),e.setFontSize(INDEXFONTSIZE);var b=[];for(g=0;g<totalTunes;++g)b.push(a[g]);if(r){var y;for(g=0;g<totalTunes;++g)y=processTitleForSorting(y=u[g]),u[g]=y;var T=[];for(g=0;g<totalTunes;++g)T.push({name:u[g],pageNumber:b[g]});for(T.sort(customSortNameWithDiacriticals),g=0;g<totalTunes;++g)u[g]=T[g].name,i||(b[g]=T[g].pageNumber)}var I=!0;for(g=0;g<totalTunes;++g){var A=d=b[g];if(s&&(A+=c),0!=u[g].indexOf("*")){if(TunebookIndexWithNoPageNumbers){var S=e.getTextWidth(u[g]);s?(e.textWithLink(u[g],e.internal.pageSize.getWidth()/3.1-S/2,f,{align:"left",pageNumber:A}),TunebookBookmarksAdded||e.outline.add(null,u[g],{pageNumber:A})):e.text(u[g],e.internal.pageSize.getWidth()/3.1-S/2,f,{align:"left"})}else s?(e.textWithLink(u[g],INDEXLEFTMARGIN-gINDEXLEFTOFFSET,f,{align:"left",pageNumber:A}),TunebookBookmarksAdded||e.outline.add(null,u[g],{pageNumber:A})):e.text(u[g],INDEXLEFTMARGIN-gINDEXLEFTOFFSET,f,{align:"left"}),s?e.textWithLink(""+(d+TunebookFirstPageNumber-1),p-INDEXRIGHTMARGIN+gINDEXRIGHTOFFSET,f,{align:"left",pageNumber:A}):e.text(""+(d+TunebookFirstPageNumber-1),p-INDEXRIGHTMARGIN+gINDEXRIGHTOFFSET,f,{align:"left"});f+=INDEXLINESPACING}else{var C=u[g];C=(C=C.replaceAll("*","")).trim();S=e.getTextWidth(C);r||(I||(f+=INDEXLINESPACING,I=!0),I&&(I=!1)),s?(e.textWithLink(C,e.internal.pageSize.getWidth()/3.1-S/2,f,{align:"left",pageNumber:A}),TunebookBookmarksAdded||e.outline.add(null,C,{pageNumber:A})):e.text(C,e.internal.pageSize.getWidth()/3.1-S/2,f,{align:"left"}),f+=r?INDEXLINESPACING:2*INDEXLINESPACING}g!=totalTunes-1&&f>h&&(theCurrentPageNumber++,e.addPage(o,gPDFOrientation),TunebookIndexHeaderRequested&&AddPageTextHeader(e,o,theTunebookIndexHeader),e.setFont(gPDFFont,gPDFFontStyle,"normal"),e.setFontSize(INDEXFONTSIZE),f=gINDEXTOPOFFSET+INDEXTITLEOFFSET),I=!1}theCurrentPageNumber++}function PostProcessHeadersAndFooters(e,t,n,o,a,l,r){for(var i=n;i<n+o;++i)e.setPage(i),AddPageHeaderFooter(e,t,i-n+1,a,l,r)}var gAcrobatURLLimitExceeded=[],ACROBATMAXURLLENGTH=2076,gGotURLLengthWarning=!1;function injectAllFonts(e){var t="";t+="%%titlefont "+gRenderingFonts.titlefont+"\n",t+="%%subtitlefont "+gRenderingFonts.subtitlefont+"\n",t+="%%infofont "+gRenderingFonts.infofont+"\n",t+="%%tempofont "+gRenderingFonts.tempofont+"\n",t+="%%gchordfont "+gRenderingFonts.gchordfont+"\n",t+="%%annotationfont "+gRenderingFonts.annotationfont+"\n",t+="%%textfont "+gRenderingFonts.textfont+"\n",-1!=e.indexOf("C:")&&(t+="%%composerfont "+gRenderingFonts.composerfont+"\n"),-1!=e.indexOf("H:")&&(t+="%%historyfont "+gRenderingFonts.historyfont+"\n"),-1!=e.indexOf("V:")&&(t+="%%voicefont "+gRenderingFonts.voicefont+"\n"),-1!=e.indexOf("P:")&&(t+="%%partsfont "+gRenderingFonts.partsfont+"\n"),-1!=e.indexOf("w:")&&(t+="%%vocalfont "+gRenderingFonts.vocalfont+"\n"),-1!=e.indexOf("W:")&&(t+="%%wordsfont "+gRenderingFonts.wordsfont+"\n"),"noten"!=GetRadioValue("notenodertab")&&(t+="%%tablabelfont "+gRenderingFonts.tablabelfont+"\n",t+="%%tabnumberfont "+gRenderingFonts.tabnumberfont+"\n",t+="%%tabgracefont "+gRenderingFonts.tabgracefont+"\n");return e="X:1\n"+t+(e=e.replace(/^X:.*[\r\n]*/gm,""))}function GetAllTuneHyperlinks(e){function t(e){if(gAllNoSwingHornpipesRequested){if(tuneIsHornpipe(e)&&-1==e.indexOf("%swing")){t=/^X:.*[\r\n]*/gm;e="X:1\n%noswing\n"+(e=e.replace(t,""))}}else if(gAllSwingHornpipesRequested&&tuneIsHornpipe(e)&&-1==e.indexOf("%noswing")){var t=/^X:.*[\r\n]*/gm;e=e.replace(t,""),e="X:1\n%swing "+gAllSwingHornpipesSwingFactor+"\n"+e}if(gAddPlaybackHyperlinksIncludePrograms){t=/^X:.*[\r\n]*/gm;e=e.replace(t,""),e=gAddPlaybackHyperlinkVolumes?"X:1\n%abcjs_soundfont "+gPlaybackHyperlinkSoundFont+"\n%%MIDI program "+gPlaybackHyperlinkMelodyProgram+"\n%%MIDI bassprog "+gPlaybackHyperlinkBassProgram+"\n%%MIDI bassvol "+gPlaybackHyperlinkBassVolume+"\n%%MIDI chordprog "+gPlaybackHyperlinkChordProgram+"\n%%MIDI chordvol "+gPlaybackHyperlinkChordVolume+"\n%add_all_playback_links\n"+e:"X:1\n%abcjs_soundfont "+gPlaybackHyperlinkSoundFont+"\n%%MIDI program "+gPlaybackHyperlinkMelodyProgram+"\n%%MIDI bassprog "+gPlaybackHyperlinkBassProgram+"\n%%MIDI chordprog "+gPlaybackHyperlinkChordProgram+"\n%add_all_playback_links\n"+e}gAddAllFonts&&(e=injectAllFonts(e));var n=e.indexOf("%incipits_inject_start");if(-1!=n){var o=e.substring(0,n),a="%incipits_inject_end",l=e.indexOf(a);l+=21,o+=e.substring(l,e.length),e=o}return e}function n(){for(var e=CountTunes(),n=FindPreTuneHeader(getABCEditorText()),a=0;a<e;++a){var l=getTuneByIndex(a);0==o[a].indexOf("*")?n+=l:n+=l=t(l)}return n}gGotURLLengthWarning=!1,gAcrobatURLLimitExceeded=[];var o,a=CountTunes();if(o=GetTunebookIndexTitles(),a!=e.length)return!1;for(var l=0;l<a;++l){var r=getTuneByIndex(l);if(0!=o[l].indexOf("*")){var i="";if(gAddPlaybackHyperlinks){var s=r;s=gAddTunebookPlaybackHyperlinks?n():t(s),(y=FillUrlBoxWithAbcInLZW(s=GetABCFileHeader()+s,!1)).length>=8100?gGotURLLengthWarning||(gGotURLLengthWarning=!0,gAddTunebookPlaybackHyperlinks&&DayPilot.Modal.alert('<p style="text-align:center;font-family:helvetica;font-size:12pt;">Share URL for entire tunebook is too long to add to the tunes.</p>',{theme:"modal_flat",top:230,scrollWithPage:AllowDialogsToScroll()})):gOpenInEditor?((y+="&editor=1").length>ACROBATMAXURLLENGTH&&gAcrobatURLLimitExceeded.push({name:o[l],urllength:y.length}),e[l].url=y):(y+="&play=1",gAddTunebookPlaybackHyperlinks&&(y+="&index="+l),gInjectEditDisabled&&(y+="&dx=1"),y.length>ACROBATMAXURLLENGTH&&gAcrobatURLLimitExceeded.push({name:o[l],urllength:y.length}),e[l].url=y)}else gAddTheSessionHyperlinks&&(e[l].url="https://thesession.org/tunes/search?q="+encodeURIComponent(o[l]));var c=/^%add_link_to_thesession.*$/m,g=r.match(c);g&&g.length>0&&(e[l].url="https://thesession.org/tunes/search?q="+encodeURIComponent(o[l])),c=/^%add_playback_link.*$/m;var d=r.match(c);if(d&&d.length>0){s=r;var u=d[0].replace("%add_playback_link","").match(/\b(\w+)\b/g),m=gTheMelodyProgram,p=gTheBassProgram,h=gTheChordProgram,f="fluid";-1!=gDefaultSoundFont.indexOf("FluidR3_GM")?f="fluid":-1!=gDefaultSoundFont.indexOf("Musyng")?f="musyng":-1!=gDefaultSoundFont.indexOf("fatboy")?f="fatboy":-1!=gDefaultSoundFont.indexOf("canvas")?f="canvas":-1!=gDefaultSoundFont.indexOf("mscore")?f="mscore":-1!=gDefaultSoundFont.indexOf("arachno")?f="arachno":-1!=gDefaultSoundFont.indexOf("fluidhq")&&(f="fluidhq"),gAddPlaybackHyperlinks&&(f=gPlaybackHyperlinkSoundFont,m=gPlaybackHyperlinkMelodyProgram,p=gPlaybackHyperlinkBassProgram,h=gPlaybackHyperlinkChordProgram);var b=!1;if(u&&u.length>0&&(u.length>=1&&(m=(m=u[0]).trim()),u.length>=2&&(p=(p=u[1]).trim()),u.length>=3&&(h=(h=u[2]).trim()),u.length>=4&&(f=(f=u[3]).trim()),b=!0),b){c=/^X:.*[\r\n]*/gm;s="X:1\n%abcjs_soundfont "+f+"\n%%MIDI program "+m+"\n%%MIDI bassprog "+p+"\n%%MIDI chordprog "+h+"\n"+(s=s.replace(c,""))}var y=FillUrlBoxWithAbcInLZW(s=GetABCFileHeader()+s,!1);gOpenInEditor?y+="&editor=1":(y+="&play=1",gInjectEditDisabled&&(y+="&dx=1")),y.length>ACROBATMAXURLLENGTH&&gAcrobatURLLimitExceeded.push({name:o[l],urllength:y.length}),e[l].url=y}c=/^%hyperlink.*$/m;var T=r.match(c);T&&T.length>0&&((i=(i=T[0].replace("%hyperlink","")).trim()).length>ACROBATMAXURLLENGTH&&gAcrobatURLLimitExceeded.push({name:o[l],urllength:i.length}),e[l].url=i)}}return!0}function PostProcessTuneHyperlinks(e,t,n,o){if(t&&GetAllTuneHyperlinks(t)){e.internal.pageSize.getWidth(),e.internal.pageSize.getHeight();e.setFont("Verdana","","normal"),e.setFontSize(18);for(var a=t.length,l=-1,r=0;r<a;++r){var i=t[r];if(""!=i.url){var s=i.page;s!=l&&(e.setPage(s+o-1),l=s);var c={left:i.x,top:i.y,width:i.width,height:i.height};c=pageRect2LinkRect(e,c,n),e.link(c.left,c.top,c.width,c.height,{url:i.url})}}}}function PostProcessTOCAndIndexLinks(e,t,n,o,a,l,r){for(var i=t;i<=n;++i){e.setPage(i),e.setFont("Verdana","","normal"),e.setFontSize(18);var s=e.internal.pageSize.getWidth(),c=e.internal.pageSize.getHeight(),g=c/1.55;if(gPDFTOCIndexPercentRequested&&.5!=gPDFTOCIndexPercent){var d=(1.55*c-c)/1.55;g=d+(d+c/1.55-d)*gPDFTOCIndexPercent}if(o&&e.textWithLink("<<",5,g,{align:"left",pageNumber:a}),l){var u=e.getTextWidth(">>");e.textWithLink(">>",s/1.55-(u+5),g,{align:"left",pageNumber:r})}}}function AddPageTextHeader(e,t,n){var o=gPAGENUMBERTOP;e.setFont(gPDFFont,gPDFFontStyle,"normal"),e.setFontSize(HEADERFOOTERFONTSIZE),e.text(n,e.internal.pageSize.getWidth()/3.1,o,{align:"center"})}var gOriginalWidthBeforePDFExport,gExportPDFTuneTitles,gNSplitPDF,gSplitPDFIndex,gTheSplitPDFTitles,gTOCTOPOFFSET=330,TOCBOTTOMOFFSET=16,TOCTITLEOFFSET=35,TOCLEFTMARGIN=90,TOCRIGHTMARGIN=105,TOCTITLESIZE=18,TOCFONTSIZE=13,TOCLINESPACING=12,gTOCLEFTOFFSET=0,gTOCRIGHTOFFSET=0;function AppendTuneTOC(e,t,n,o,a,l,r,i,s,c,g){var d=g;e.setPage(d),TunebookTOCHeaderRequested&&AddPageTextHeader(e,o,theTunebookTOCHeader),e.setFont(gPDFFont,gPDFFontStyle,"normal"),e.setFontSize(TOCTITLESIZE),""!=l&&e.text(l,e.internal.pageSize.getWidth()/3.1,gTOCTOPOFFSET,{align:"center"});var u,m,p=GetTunebookIndexTitles(),h=pdf.internal.pageSize.getHeight(),f=pdf.internal.pageSize.getWidth()/1.55,b=h-(PAGETOPOFFSET+TOCBOTTOMOFFSET),y=gTOCTOPOFFSET+TOCTITLEOFFSET;e.setFont(gPDFFont,gPDFFontStyle,"normal"),e.setFontSize(TOCFONTSIZE);var T=[];for(u=0;u<totalTunes;++u)T.push(a[u]);if(r){var I;for(u=0;u<totalTunes;++u)I=processTitleForSorting(I=p[u]),p[u]=I;var A=[];for(u=0;u<totalTunes;++u)A.push({name:p[u],pageNumber:T[u]});for(A.sort(customSortNameWithDiacriticals),u=0;u<totalTunes;++u)p[u]=A[u].name,i||(T[u]=A[u].pageNumber)}var S=!0;for(u=0;u<totalTunes;++u){if(m=T[u],0!=p[u].indexOf("*")){if(TunebookTOCWithNoPageNumbers){var C=e.getTextWidth(p[u]);s?(e.textWithLink(p[u],e.internal.pageSize.getWidth()/3.1-C/2,y,{align:"left",pageNumber:m+c}),e.outline.add(null,p[u],{pageNumber:m+c}),TunebookBookmarksAdded=!0):e.text(p[u],e.internal.pageSize.getWidth()/3.1-C/2,y,{align:"left"})}else s?(e.textWithLink(p[u],TOCLEFTMARGIN-gTOCLEFTOFFSET,y,{align:"left",pageNumber:m+c}),e.outline.add(null,p[u],{pageNumber:m+c}),TunebookBookmarksAdded=!0):e.text(p[u],TOCLEFTMARGIN-gTOCLEFTOFFSET,y,{align:"left"}),s?e.textWithLink(""+(m+TunebookFirstPageNumber-1),f-TOCRIGHTMARGIN+gTOCRIGHTOFFSET,y,{align:"left",pageNumber:m+c}):e.text(""+(m+TunebookFirstPageNumber-1),f-TOCRIGHTMARGIN+gTOCRIGHTOFFSET,y,{align:"left"});y+=TOCLINESPACING}else{var v=p[u];v=(v=v.replaceAll("*","")).trim();C=e.getTextWidth(v);r||(S||(y+=TOCLINESPACING,S=!0),S&&(S=!1)),s?(e.textWithLink(v,e.internal.pageSize.getWidth()/3.1-C/2,y,{align:"left",pageNumber:m+c}),e.outline.add(null,v,{pageNumber:m+c}),TunebookBookmarksAdded=!0):e.text(v,e.internal.pageSize.getWidth()/3.1-C/2,y,{align:"left"}),y+=r?TOCLINESPACING:2*TOCLINESPACING}u!=totalTunes-1&&y>b&&(d++,e.setPage(d),TunebookTOCHeaderRequested&&AddPageTextHeader(e,o,theTunebookTOCHeader),e.setFont(gPDFFont,gPDFFontStyle,"normal"),e.setFontSize(TOCFONTSIZE),y=gTOCTOPOFFSET+TOCTITLEOFFSET),S=!1}}function DryRunAddTuneTOC(e,t,n,o,a,l,r,i){e.addPage(o,gPDFOrientation);var s,c=GetTunebookIndexTitles(),g=pdf.internal.pageSize.getHeight(),d=(pdf.internal.pageSize.getWidth(),g-(PAGETOPOFFSET+TOCBOTTOMOFFSET)),u=gTOCTOPOFFSET+TOCTITLEOFFSET,m=[];for(s=0;s<totalTunes;++s)m.push(a[s]);if(r){var p;for(s=0;s<totalTunes;++s)p=processTitleForSorting(p=c[s]),c[s]=p;var h=[];for(s=0;s<totalTunes;++s)h.push({name:c[s],pageNumber:m[s]});for(h.sort(customSortNameWithDiacriticals),s=0;s<totalTunes;++s)c[s]=h[s].name,i||(m[s]=h[s].pageNumber)}var f=!0;for(s=0;s<totalTunes;++s)0!=c[s].indexOf("*")||r?u+=TOCLINESPACING:(u+=f?2*TOCLINESPACING:3*TOCLINESPACING,f&&(f=!1)),s!=totalTunes-1&&u>d&&(theCurrentPageNumber++,e.movePage(theCurrentPageNumber,1),u=gTOCTOPOFFSET+TOCTITLEOFFSET,e.addPage(o,gPDFOrientation));theCurrentPageNumber++,e.movePage(theCurrentPageNumber,1)}function pageRect2LinkRect(e,t,n){var o=26;return"a4"==n&&(o=27),t.left=t.left/1.55,t.top=e.internal.pageSize.getHeight()/3.1+o+t.top/1.55,t.width=t.width/1.55,t.height=t.height/1.55,t}function pageVOffset2LinkVOffset(e,t,n){var o=26;return"a4"==n&&(o=27),e.internal.pageSize.getHeight()/3.1+o+t/1.55}function linkVOffset2PageVOffset(e,t,n){var o=26;return"a4"==n&&(o=27),t-=e.internal.pageSize.getHeight()/3.1+o,t*=1.55}function AppendPDFTuneQRCode(e,t,n,o,a){var l;n=GetABCFileHeader()+n,l=FillUrlBoxWithAbcInLZW(n,!1),gAddPlaybackHyperlinks&&(l+="&play=1");var r=!0;l.length>2300&&(l=FillUrlBoxWithAbcInLZW("X:1\nT:"+o+"\nT:Tune ABC was too long to generate a valid QR Code\n",!1),r=!1),null==gTheQRCode?gTheQRCode=new QRCode(document.getElementById("qrcode"),{text:l,width:548,height:548,colorDark:"#000000",colorLight:"#ffffff",border:16,correctLevel:QRCode.CorrectLevel.M}):(gTheQRCode.clear(),gTheQRCode.makeCode(l)),setTimeout(function(){var n=document.querySelectorAll('div[id="qrcode"] > img');if(n&&n[0]){var i;i="portrait"==gPDFOrientation?"letter"==gPDFPaperSize?e.internal.pageSize.getWidth()/3.1-18:e.internal.pageSize.getWidth()/3.1-22:"letter"==gPDFPaperSize?e.internal.pageSize.getWidth()/3.1+12:e.internal.pageSize.getWidth()/3.1+24;var s,c,g=(n=n[0]).src;i-=64,"portrait"==gPDFOrientation?(e.addImage(g,"PNG",i,150,384,384,void 0,"FAST"),s={left:i,top:150,width:384,height:384}):(e.addImage(g,"PNG",i,86,384,384,void 0,"FAST"),s={left:i,top:75,width:384,height:384}),gTuneHyperlinks.push({page:theCurrentPageNumber,x:s.left,y:s.top,width:s.width,height:s.height,url:l}),e.setFont(gPDFFont,gPDFFontStyle,"normal"),e.setFontSize(QRCODECAPTIONPDFFONTSIZE),"portrait"==gPDFOrientation?(c=558,"a4"==t&&(c=575),c+=80):(c=500,"a4"==t&&(c=500),c+=32);var d=o;r||(d=o+" - Tune is too long to generate a QR Code. Click to open instead.");var u=e.internal.pageSize.getWidth(),m=e.getTextWidth(d);e.text(d,u/3.1-m/2,c,{align:"left"}),gTheQRCode.clear(),a()}else gTheQRCode.clear(),a()},25)}function AppendQRCode(e,t,n){var o;if(gDoForceQRCodeURLOverride)o=gQRCodeURLOverride;else if(o=FillUrlBoxWithAbcInLZW(null,!1),!gAllowQRCodeSave)return void n(!1);null==gTheQRCode?gTheQRCode=new QRCode(document.getElementById("qrcode"),{text:o,width:548,height:548,colorDark:"#000000",colorLight:"#ffffff",border:16,correctLevel:QRCode.CorrectLevel.M}):(gTheQRCode.clear(),gTheQRCode.makeCode(o)),setTimeout(function(){var a=document.querySelectorAll('div[id="qrcode"] > img');if(a&&a[0]){var l;e.addPage(t,gPDFOrientation),l="portrait"==gPDFOrientation?"letter"==gPDFPaperSize?e.internal.pageSize.getWidth()/3.1-18:e.internal.pageSize.getWidth()/3.1-22:"letter"==gPDFPaperSize?e.internal.pageSize.getWidth()/3.1+12:e.internal.pageSize.getWidth()/3.1+24;var r,i,s=(a=a[0]).src;l-=64,"portrait"==gPDFOrientation?(e.addImage(s,"PNG",l,150,384,384,void 0,"FAST"),r={left:l,top:150,width:384,height:384}):(e.addImage(s,"PNG",l,86,384,384,void 0,"FAST"),r={left:l,top:75,width:384,height:384}),r=pageRect2LinkRect(e,r,t),e.link(r.left,r.top,r.width,r.height,{url:o}),e.setFont(gPDFFont,gPDFFontStyle,"normal"),e.setFontSize(QRCODECAPTIONPDFFONTSIZE),"portrait"==gPDFOrientation?(i=558,"a4"==t&&(i=575),i+=80):(i=500,"a4"==t&&(i=500),i+=32);var c=theHeaderFooterTuneNames;gDoForceQRCodeCaptionOverride&&(c=gQRCodeCaptionOverride);var g=e.internal.pageSize.getWidth(),d=e.getTextWidth(c);e.textWithLink(c,g/3.1-d/2,i,{align:"left",url:o}),gTheQRCode.clear(),n(!0)}else gTheQRCode.clear(),n(!1)},1e3)}function getDescriptiveFileName(e,t){var n="";return gABCFromFile?(n=(n=gDisplayedName).trim(),n=(n=t?(n=cleanFileName(n)).replace(/\s/g," "):(n=cleanFileName(n)).replace(/\s/g,"_")).replace(/\..+$/,"")):(n=GetFirstTuneTitle(t),e>1&&(n+=t?" Set":"_Set")),n}function ProcessTunesForContinuousLayout(e,t,n){var o=e.length;if(o<=1)return e;var a,l,r,i,s=[];for(a=0;a<o;++a){i=(r=document.getElementById("notation"+a)).offsetHeight/PDFSCALEFACTOR;var c,g=[],d=r.children,u=d.length,m=1;n&&(u>2&&(u=2),2==gIncipitsColumns&&(m=2));var p=0;for(l=0;l<u;++l)c=d.item(l).offsetHeight/PDFSCALEFACTOR,c/=m,g.push(c),p+=c;n&&(i=p);var h={theElement:r,height:i,staffHeights:g};s.push(h)}var f=t-(PAGETOPOFFSET+PAGEBOTTOMOFFSET),b=f+BETWEENTUNESPACE,y=!0;for(a=0;a<o;++a){0!=a&&e[a-1]&&(b=f+BETWEENTUNESPACE);var T,I=s[a].height;if(!gPDFNotationWidthOverrideRequested&&!gPDFNotationWidthAutoOverrideRequested||n?"landscape"==gPDFOrientation&&(I="letter"==gPDFPaperSize?718*I/535:785*I/535):I=I*gPageWidth/535,(T=I+s[a].staffHeights.length/m)>b)if(0!=a&&(e[a-1]=!0),b=f+BETWEENTUNESPACE,T>f){var A,S=s[a].staffHeights.length;for(l=0;l<S;++l)b-(A=s[a].staffHeights[l]+1)<0&&(b=f),b-=A;b-=BETWEENTUNESPACE/m,y=!1}else b=f+BETWEENTUNESPACE,b-=T,b-=BETWEENTUNESPACE/m,y=!0;else y&&(y=!1),b-=T,b-=BETWEENTUNESPACE/m}return e}function scanTunesForPageBreaks(e,t,n){var o;switch(gPDFOrientation){case"portrait":o=PAGEHEIGHTLETTER,"a4"==t&&(o=PAGEHEIGHTA4);break;case"landscape":o=PAGEHEIGHTLETTER_LANDSCAPE,"a4"==t&&(o=PAGEHEIGHTA4_LANDSCAPE)}var a=[],l=getABCEditorText().split(/^X:.*$/gm),r=l.length-1;if(0==r)return a;if(n)for(i=1;i<=r;++i)a.push(!1);else for(var i=1;i<=r;++i)i>1&&isSectionHeader(l[i])&&(a[i-2]=!0),-1!=l[i].indexOf("%%newpage")?a.push(!0):a.push(!1);return a=ProcessTunesForContinuousLayout(a,o,n)}function formatDate(e){var t=new Date,n=""+(t.getMonth()+1),o=""+t.getDate(),a=t.getFullYear();return n.length<2&&(n="0"+n),o.length<2&&(o="0"+o),0==e?[n,o,a].join("-"):[a,n,o].join("-")}function formatTime(){if(""!=theRenderTime)return theRenderTime;var e=new Date,t=e.getHours(),n=e.getMinutes(),o=" AM";0==t&&(t=12),t>12&&(t-=12,o=" PM"),(n=""+n).length<2&&(n="0"+n);var a=[t=""+t,n].join(":");return theRenderTime=a+=o,a}function ParseCommentCommands(e){thePageHeader="",thePageFooter="";var t=/^%pageheader.*$/m,n=e.match(t);n&&n.length>0&&(thePageHeader=(thePageHeader=n[0].replace("%pageheader","")).trim()),t=/^%pagefooter.*$/m;var o=e.match(t);o&&o.length>0&&(thePageFooter=(thePageFooter=o[0].replace("%pagefooter","")).trim()),gQRCodeRequested=!1,gDoForceQRCodeURLOverride=!1,gQRCodeURLOverride="",t=/^%qrcode.*$/m;var a=e.match(t);a&&a.length>0&&(gQRCodeRequested=!0,""!=(gQRCodeURLOverride=(gQRCodeURLOverride=a[0].replace("%qrcode","")).trim())&&(gDoForceQRCodeURLOverride=!0)),gDoForceQRCodeCaptionOverride=!1,gQRCodeCaptionOverride="",t=/^%caption_for_qrcode.*$/m;var l=e.match(t);l&&l.length>0&&""!=(gQRCodeCaptionOverride=(gQRCodeCaptionOverride=l[0].replace("%caption_for_qrcode","")).trim())&&(gDoForceQRCodeCaptionOverride=!0),theTunebookIndexTitle="",TunebookIndexRequested=!1,t=/^%addindex.*$/m;var r=e.match(t);r&&r.length>0&&(TunebookIndexRequested=!0,theTunebookIndexTitle=(theTunebookIndexTitle=r[0].replace("%addindex","")).trim()),theTunebookSortedIndexTitle="",TunebookSortedIndexRequested=!1,t=/^%addsortedindex.*$/m;var i=e.match(t);i&&i.length>0&&(TunebookSortedIndexRequested=!0,theTunebookSortedIndexTitle=(theTunebookSortedIndexTitle=i[0].replace("%addsortedindex","")).trim()),TunebookBookmarksAdded=!1,theTunebookTOCTitle="",TunebookTOCRequested=!1,t=/^%addtoc.*$/m;var s=e.match(t);s&&s.length>0&&(TunebookTOCRequested=!0,theTunebookTOCTitle=(theTunebookTOCTitle=s[0].replace("%addtoc","")).trim()),theTunebookSortedTOCTitle="",TunebookSortedTOCRequested=!1,t=/^%addsortedtoc.*$/m;var c=e.match(t);c&&c.length>0&&(TunebookSortedTOCRequested=!0,theTunebookSortedTOCTitle=(theTunebookSortedTOCTitle=c[0].replace("%addsortedtoc","")).trim()),theTunebookTP="",TunebookTPRequested=!1,t=/^%addtitle.*$/m;var g=e.match(t);g&&g.length>0&&(TunebookTPRequested=!0,theTunebookTP=(theTunebookTP=g[0].replace("%addtitle","")).trim()),theTunebookTPST="",TunebookTPSTRequested=!1,t=/^%addsubtitle.*$/m;var d=e.match(t);d&&d.length>0&&(TunebookTPSTRequested=!0,theTunebookTPST=(theTunebookTPST=d[0].replace("%addsubtitle","")).trim()),INDEXFONTSIZE=13,t=/^%indexfontsize.*$/m;var u=e.match(t);if(u&&u.length>0){Q=(Q=u[0].replace("%indexfontsize","")).trim();var m=parseInt(Q);!isNaN(m)&&m>0&&(INDEXFONTSIZE=m)}INDEXLINESPACING=12,t=/^%indexlinespacing.*$/m;var p=e.match(t);if(p&&p.length>0){C=(C=p[0].replace("%indexlinespacing","")).trim();var h=parseInt(C);!isNaN(h)&&h>=0&&(INDEXLINESPACING=h)}INDEXTITLESIZE=18,t=/^%indextitlefontsize.*$/m;var f=e.match(t);if(f&&f.length>0){Q=(Q=f[0].replace("%indextitlefontsize","")).trim();m=parseInt(Q);!isNaN(m)&&m>0&&(INDEXTITLESIZE=m)}INDEXTITLEOFFSET=35,t=/^%indextitleoffset.*$/m;var b=e.match(t);if(b&&b.length>0){_=(_=b[0].replace("%indextitleoffset","")).trim();var y=parseInt(_);!isNaN(y)&&y>=0&&(INDEXTITLEOFFSET=y)}t=/^%indextopoffset.*$/m;var T=e.match(t);if(T&&T.length>0){P=(P=T[0].replace("%indextopoffset","")).trim();var I=parseInt(P);!isNaN(I)&&I>=0&&(gINDEXTOPOFFSET=I+300)}TOCFONTSIZE=13,t=/^%tocfontsize.*$/m;var A=e.match(t);if(A&&A.length>0){Q=(Q=A[0].replace("%tocfontsize","")).trim();m=parseInt(Q);!isNaN(m)&&m>0&&(TOCFONTSIZE=m)}TOCLINESPACING=12,t=/^%toclinespacing.*$/m;var S=e.match(t);if(S&&S.length>0){var C;C=(C=S[0].replace("%toclinespacing","")).trim();h=parseInt(C);!isNaN(h)&&h>=0&&(TOCLINESPACING=h)}TOCTITLESIZE=18,t=/^%toctitlefontsize.*$/m;var v=e.match(t);if(v&&v.length>0){Q=(Q=v[0].replace("%toctitlefontsize","")).trim();m=parseInt(Q);!isNaN(m)&&m>0&&(TOCTITLESIZE=m)}TOCTITLEOFFSET=35,t=/^%toctitleoffset.*$/m;var x=e.match(t);if(x&&x.length>0){var _;_=(_=x[0].replace("%toctitleoffset","")).trim();y=parseInt(_);!isNaN(y)&&y>=0&&(TOCTITLEOFFSET=y)}t=/^%toctopoffset.*$/m;var B=e.match(t);if(B&&B.length>0){var P;P=(P=B[0].replace("%toctopoffset","")).trim();I=parseInt(P);!isNaN(I)&&I>=0&&(gTOCTOPOFFSET=I+300)}gTOCLEFTOFFSET=0,t=/^%tocleftoffset.*$/m;var D=e.match(t);if(D&&D.length>0){var w=D[0].replace("%tocleftoffset","");w=w.trim();var E=parseInt(w);isNaN(E)||(gTOCLEFTOFFSET=E)}gINDEXLEFTOFFSET=0,t=/^%indexleftoffset.*$/m;var F=e.match(t);if(F&&F.length>0){var M=F[0].replace("%indexleftoffset","");M=M.trim();var k=parseInt(M);isNaN(k)||(gINDEXLEFTOFFSET=k)}gTOCRIGHTOFFSET=0,t=/^%tocrightoffset.*$/m;var R=e.match(t);if(R&&R.length>0){var L=R[0].replace("%tocrightoffset","");L=L.trim();var N=parseInt(L);isNaN(N)||(gTOCRIGHTOFFSET=N)}gINDEXRIGHTOFFSET=0,t=/^%indexrightoffset.*$/m;var j=e.match(t);if(j&&j.length>0){var O=j[0].replace("%indexrightoffset","");O=O.trim();var H=parseInt(O);isNaN(H)||(gINDEXRIGHTOFFSET=H)}HEADERFOOTERFONTSIZE=12,t=/^%headerfooterfontsize.*$/m;var G=e.match(t);if(G&&G.length>0){Q=(Q=G[0].replace("%headerfooterfontsize","")).trim();m=parseInt(Q);!isNaN(m)&&m>0&&(HEADERFOOTERFONTSIZE=m)}TEXTINCIPITFONTSIZE=12,t=/^%textincipitsfontsize.*$/m;var z=e.match(t);if(z&&z.length>0){Q=(Q=z[0].replace("%textincipitsfontsize","")).trim();m=parseInt(Q);!isNaN(m)&&m>0&&(TEXTINCIPITFONTSIZE=m)}TEXTINCIPITLINESPACING=12,t=/^%textincipitslinespacing.*$/m;var W=e.match(t);if(W&&W.length>0){Q=(Q=W[0].replace("%textincipitslinespacing","")).trim();m=parseInt(Q);!isNaN(m)&&m>0&&(TEXTINCIPITLINESPACING=m)}TPTITLESIZE=24,t=/^%titlefontsize.*$/m;var U=e.match(t);if(U&&U.length>0){Q=(Q=U[0].replace("%titlefontsize","")).trim();m=parseInt(Q);!isNaN(m)&&m>0&&(TPTITLESIZE=m)}TPSTTITLESIZE=16,t=/^%subtitlefontsize.*$/m;var V=e.match(t);if(V&&V.length>0){var Q;Q=(Q=V[0].replace("%subtitlefontsize","")).trim();m=parseInt(Q);!isNaN(m)&&m>0&&(TPSTTITLESIZE=m)}gPDFQuality=.75,t=/^%pdfquality.*$/m;var X=e.match(t);if(X&&X.length>0){var J=X[0].replace("%pdfquality","");J=J.trim();var q=parseFloat(J);!isNaN(q)&&q>=0&&(gPDFQuality=q)}gPDFTitleSpacing=1,t=/^%titlelinespacing.*$/m;var Y=e.match(t);if(Y&&Y.length>0){var Z=Y[0].replace("%titlelinespacing","");Z=Z.trim();var K=parseFloat(Z);isNaN(K)||(gPDFTitleSpacing=K)}gPDFSubTitleSpacing=1,t=/^%subtitlelinespacing.*$/m;var $=e.match(t);if($&&$.length>0){var ee=$[0].replace("%subtitlelinespacing","");ee=ee.trim();var te=parseFloat(ee);isNaN(te)||(gPDFSubTitleSpacing=te)}gPDFPageNumberHOffset=0,t=/^%pagenumberhoffset.*$/m;var ne=e.match(t);if(ne&&ne.length>0){var oe=ne[0].replace("%pagenumberhoffset","");oe=oe.trim();var ae=parseFloat(oe);isNaN(ae)||(gPDFPageNumberHOffset=ae/1.5)}gPDFPageNumberVOffset=0,t=/^%pagenumbervoffset.*$/m;var le=e.match(t);if(le&&le.length>0){var re=le[0].replace("%pagenumbervoffset","");re=re.trim();var ie=parseFloat(re);isNaN(ie)||(gPDFPageNumberVOffset=ie/1.5)}gPDFPageHeaderVOffset=0,t=/^%headervoffset.*$/m;var se=e.match(t);if(se&&se.length>0){var ce=se[0].replace("%headervoffset","");ce=ce.trim();var ge=parseFloat(ce);isNaN(ge)||(gPDFPageHeaderVOffset=ge/1.5)}gPDFPageFooterVOffset=0,t=/^%footervoffset.*$/m;var de=e.match(t);if(de&&de.length>0){var ue=de[0].replace("%footervoffset","");ue=ue.trim();var me=parseFloat(ue);isNaN(me)||(gPDFPageFooterVOffset=me/1.5)}gIncludePageLinks=!0,t=/^%no_toc_or_index_links.*$/m;var pe=e.match(t);pe&&pe.length>0&&(gIncludePageLinks=!1),gForcePDFFilename="",gDoForcePDFFilename=!1,t=/^%pdfname.*$/m;var he=e.match(t);he&&he.length>0&&(gDoForcePDFFilename=!0,""==(gForcePDFFilename=(gForcePDFFilename=he[0].replace("%pdfname","")).trim())&&(gDoForcePDFFilename=!1)),thePageHeaderURL="",thePageFooterURL="",t=/^%urlpageheader.*$/m;var fe=e.match(t);if(fe&&fe.length>0){var be=fe[0].replace("%urlpageheader ","");(_e=(be=be.trim()).split(" ")).length>1&&(thePageHeaderURL=_e[0],thePageHeader=(thePageHeader=be.replace(thePageHeaderURL,"")).trim())}t=/^%urlpagefooter.*$/m;var ye=e.match(t);if(ye&&ye.length>0){var Te=ye[0].replace("%urlpagefooter ","");(_e=(Te=Te.trim()).split(" ")).length>1&&(thePageFooterURL=_e[0],thePageFooter=(thePageFooter=Te.replace(thePageFooterURL,"")).trim())}TunebookFirstPageNumber=1,TunebookFirstPageAuto=!1,t=/^%firstpagenumber.*$/m;var Ie=e.match(t);if(Ie&&Ie.length>0){var Ae=Ie[0].replace("%firstpagenumber","");if("auto"==(Ae=Ae.trim()))TunebookFirstPageAuto=!0;else{var Se=parseInt(Ae);!isNaN(Se)&&Se>0&&(TunebookFirstPageNumber=Se)}}theTunebookTPURL="",theTunebookTPSTURL="",t=/^%urladdtitle.*$/m;var Ce=e.match(t);if(Ce&&Ce.length>0){var ve=Ce[0].replace("%urladdtitle ","");theTunebookTP=ve.trim(),(_e=ve.split(" ")).length>1&&(theTunebookTPURL=_e[0],theTunebookTP=(theTunebookTP=ve.replace(theTunebookTPURL,"")).trim(),TunebookTPRequested=!0)}t=/^%urladdsubtitle.*$/m;var xe=e.match(t);if(xe&&xe.length>0){var _e,Be=xe[0].replace("%urladdsubtitle ","");theTunebookTPST=Be.trim(),(_e=Be.split(" ")).length>1&&(theTunebookTPSTURL=_e[0],theTunebookTPST=(theTunebookTPST=Be.replace(theTunebookTPSTURL,"")).trim(),TunebookTPSTRequested=!0)}gAddTOCLinkback=!1,t=/^%addlinkbacktotoc.*$/m;var Pe=e.match(t);Pe&&Pe.length>0&&(gAddTOCLinkback=!0),gAddIndexLinkback=!1,t=/^%addlinkbacktoindex.*$/m;var De=e.match(t);De&&De.length>0&&(gAddIndexLinkback=!0),gAddTheSessionHyperlinks=!1,t=/^%add_all_links_to_thesession.*$/m;var we=e.match(t);we&&we.length>0&&(gAddTheSessionHyperlinks=!0),t=/^%addlinkstothesession.*$/m,(we=e.match(t))&&we.length>0&&(gAddTheSessionHyperlinks=!0),gInjectEditDisabled=!1,t=/^%no_edit_allowed.*$/m;var Ee=e.match(t);Ee&&Ee.length>0&&(gInjectEditDisabled=!0),gAllSwingHornpipesRequested=!1,gAllSwingHornpipesSwingFactor=gAutoSwingFactor,t=/^%swing_all_hornpipes.*$/m;var Fe=e.match(t);if(Fe&&Fe.length>0){gAllSwingHornpipesRequested=!0;var Me=Fe[0].replace("%swing_all_hornpipes","");if(""!=(Me=Me.trim())){var ke=parseFloat(Me);isNaN(ke)||ke>=-.9&&ke<=.9&&(gAllSwingHornpipesSwingFactor=ke)}}gAllNoSwingHornpipesRequested=!1,t=/^%noswing_all_hornpipes.*$/m;var Re=e.match(t);Re&&Re.length>0&&(gAllNoSwingHornpipesRequested=!0),gAddPlaybackHyperlinks=!1,gAddPlaybackHyperlinksIncludePrograms=!1,t=/^%add_all_playback_links.*$/m;var Le=e.match(t);if(Le&&Le.length>0){gAddPlaybackHyperlinks=!0;var Ne=Le[0].replace("%add_all_playback_links","").trim().match(/\b(\w+)\b/g);gPlaybackHyperlinkMelodyProgram=gTheMelodyProgram,gPlaybackHyperlinkBassProgram=gTheBassProgram,gPlaybackHyperlinkChordProgram=gTheChordProgram,gPlaybackHyperlinkSoundFont="fluid",-1!=gDefaultSoundFont.indexOf("FluidR3_GM")?gPlaybackHyperlinkSoundFont="fluid":-1!=gDefaultSoundFont.indexOf("Musyng")?gPlaybackHyperlinkSoundFont="musyng":-1!=gDefaultSoundFont.indexOf("fatboy")?gPlaybackHyperlinkSoundFont="fatboy":-1!=gDefaultSoundFont.indexOf("canvas")?gPlaybackHyperlinkSoundFont="canvas":-1!=gDefaultSoundFont.indexOf("mscore")?gPlaybackHyperlinkSoundFont="mscore":-1!=gDefaultSoundFont.indexOf("arachno")?gPlaybackHyperlinkSoundFont="arachno":-1!=gDefaultSoundFont.indexOf("fluidhq")&&(theSoundFont="fluidhq"),Ne&&Ne.length>0?(gAddPlaybackHyperlinksIncludePrograms=!0,Ne.length>=1&&(gPlaybackHyperlinkMelodyProgram=(gPlaybackHyperlinkMelodyProgram=Ne[0]).trim()),Ne.length>=2&&(gPlaybackHyperlinkBassProgram=(gPlaybackHyperlinkBassProgram=Ne[1]).trim()),Ne.length>=3&&(gPlaybackHyperlinkChordProgram=(gPlaybackHyperlinkChordProgram=Ne[2]).trim()),Ne.length>=4&&(gPlaybackHyperlinkSoundFont=(gPlaybackHyperlinkSoundFont=Ne[3]).trim())):gAddPlaybackHyperlinksIncludePrograms=!1}if(gOpenInEditor=!1,!gInjectEditDisabled){t=/^%links_open_in_editor.*$/m;var je=e.match(t);je&&je.length>0&&(gOpenInEditor=!0,gAddPlaybackHyperlinks=!0,gAddPlaybackHyperlinksIncludePrograms=!1)}gAddAllFonts=!1,t=/^%add_all_fonts.*$/m;var Oe=e.match(t);Oe&&Oe.length>0&&(gAddAllFonts=!0),gAddPlaybackHyperlinkVolumes=!1,t=/^%add_all_playback_volumes.*$/m;var He=e.match(t);He&&He.length>0&&(gPlaybackHyperlinkBassVolume=gTheBassVolume,gPlaybackHyperlinkChordVolume=gTheChordVolume,(Ne=He[0].replace("%add_all_playback_volumes","").trim().match(/\b(\w+)\b/g))&&Ne.length>0&&(gAddPlaybackHyperlinkVolumes=!0,Ne.length>=1&&(gPlaybackHyperlinkBassVolume=(gPlaybackHyperlinkBassVolume=Ne[0]).trim()),Ne.length>=2&&(gPlaybackHyperlinkChordVolume=(gPlaybackHyperlinkChordVolume=Ne[1]).trim())));gAddTunebookPlaybackHyperlinks=!1,t=/^%playback_links_are_complete_tunebook.*$/m;var Ge=e.match(t);Ge&&Ge.length>0&&(gAddTunebookPlaybackHyperlinks=!0),theTunebookTOCHeader="",TunebookTOCHeaderRequested=!1,t=/^%tocheader.*$/m;var ze=e.match(t);ze&&ze.length>0&&(TunebookTOCHeaderRequested=!0,theTunebookTOCHeader=(theTunebookTOCHeader=ze[0].replace("%tocheader","")).trim()),theTunebookIndexHeader="",TunebookTOCIndexHeaderRequested=!1,t=/^%indexheader.*$/m;var We=e.match(t);if(We&&We.length>0&&(TunebookIndexHeaderRequested=!0,theTunebookIndexHeader=(theTunebookIndexHeader=We[0].replace("%indexheader","")).trim()),t=/^%pdf_between_tune_space.*$/m,gBetweenTuneSpace=20,gGotBetweenTuneSpace=!1,(Ue=e.match(t))&&Ue.length>0){var Ue;Ue=(Ue=Ue[0].replace("%pdf_between_tune_space","")).trim();var Ve=parseInt(Ue);!isNaN(Ve)&&Ve>=0&&(gBetweenTuneSpace=Ve,gGotBetweenTuneSpace=!0)}t=/^%pdffont.*$/m;var Qe=e.match(t);if(Qe&&Qe.length>0){var Xe=(Qe=(Qe=Qe[0].replace("%pdffont","")).trim()).split(" ");switch(Xe&&Xe.length>1?(gPDFFont=Xe[0],gPDFFontStyle=Xe[1]):(gPDFFont=Qe,gPDFFontStyle=""),"normal"==gPDFFontStyle.toLowerCase()&&(gPDFFontStyle=""),gPDFFont.toLowerCase()){case"times":"oblique"==gPDFFontStyle.toLowerCase()?gPDFFontStyle="Italic":"boldoblique"==gPDFFontStyle.toLowerCase()&&(gPDFFontStyle="BoldItalic");break;case"helvetica":case"courier":case"noto-sans":case"noto-serif":break;default:gPDFFont="Times",gPDFFontStyle=""}var Je=gPDFFontStyle.toLowerCase();if(""!=Je)switch(Je){case"normal":case"bold":case"oblique":case"boldoblique":case"italic":case"bolditalic":break;default:gPDFFontStyle=""}}TunebookTOCWithNoPageNumbers=!1,t=/^%toc_no_page_numbers.*$/m;var qe=e.match(t);qe&&qe.length>0&&(TunebookTOCWithNoPageNumbers=!0),TunebookIndexWithNoPageNumbers=!1,t=/^%index_no_page_numbers.*$/m;var Ye=e.match(t);Ye&&Ye.length>0&&(TunebookIndexWithNoPageNumbers=!0),gPDFLeftMarginOverrideRequested=!1,t=/^%pdf_left_margin.*$/m;var Ze=e.match(t);if(Ze&&Ze.length>0){var Ke=Ze[0].replace("%pdf_left_margin","");Ke=Ke.trim();var $e=parseFloat(Ke);isNaN($e)||(gPDFLeftMarginOverride=$e,gPDFLeftMarginOverrideRequested=!0)}gPDFNotationWidthOverrideRequested=!1,t=/^%pdf_notation_width.*$/m;var et=e.match(t);if(et&&et.length>0){var tt=et[0].replace("%pdf_notation_width","");tt=tt.trim();var nt=parseFloat(tt);isNaN(nt)||(gPDFNotationWidthOverride=nt,gPDFNotationWidthOverrideRequested=!0)}gPDFNotationWidthAutoOverrideRequested=!1,t=/^%pdf_notation_percent_width.*$/m;var ot=e.match(t);if(ot&&ot.length>0){var at=ot[0].replace("%pdf_notation_percent_width","");at=at.trim();var lt=parseFloat(at);isNaN(lt)||(gPDFNotationWidthAutoOverride=lt/100,gPDFNotationWidthAutoOverrideRequested=!0)}gPDFTOCIndexPercent=.5,gPDFTOCIndexPercentRequested=!1,t=/^%toc_index_backlink_vpos.*$/m;var rt=e.match(t);if(rt&&rt.length>0){var it=rt[0].replace("%toc_index_backlink_vpos","");it=it.trim();var st=parseFloat(it);isNaN(st)||(gPDFTOCIndexPercent=st/100,gPDFTOCIndexPercentRequested=!0)}}function ProcessHeaderFooter(e,t,n){var o=getDescriptiveFileName(n,!0);if(gDoForcePDFFilename){var a=o;""==(o=(o=(o=gForcePDFFilename).trim()).replace(".pdf",""))&&(o=a)}var l=e.replace("$PDFNAME",o+".pdf");l=(l=(l=l.replace("$PAGENUMBER",t+TunebookFirstPageNumber-1)).replace("$TUNECOUNT",totalTunes)).replace("$TUNENAMES",theHeaderFooterTuneNames);var r=formatDate(0),i=formatDate(1);l=(l=l.replace("$DATEMDY",r)).replace("$DATEYMD",i);var s=formatTime();return l=l.replace("$TIME",s)}function calcPageNumberVerticalOffset(e){thePageNumberVerticalOffset=e.internal.pageSize.getHeight()-9}function AddPageHeaderFooter(e,t,n,o,a,l){var r=gPAGENUMBERTOP;e.setFont(gPDFFont,gPDFFontStyle,"normal"),e.setFontSize(HEADERFOOTERFONTSIZE);if(thePageHeader&&""!=thePageHeader){var i=ProcessHeaderFooter(thePageHeader,n,totalTunes);if(thePageHeaderURL&&""!=thePageHeaderURL){var s=e.getTextWidth(i);e.textWithLink(i,e.internal.pageSize.getWidth()/3.1-s/2,r+gPDFPageHeaderVOffset,{align:"left",url:thePageHeaderURL})}else e.text(i,e.internal.pageSize.getWidth()/3.1,r+gPDFPageHeaderVOffset,{align:"center"});0}if(thePageFooter&&""!=thePageFooter){var c=ProcessHeaderFooter(thePageFooter,n,totalTunes);if(thePageFooterURL&&""!=thePageFooterURL){s=e.getTextWidth(c);e.textWithLink(c,e.internal.pageSize.getWidth()/3.1-s/2,thePageNumberVerticalOffset-gPDFPageFooterVOffset,{align:"center",url:thePageFooterURL})}else e.text(c,e.internal.pageSize.getWidth()/3.1,thePageNumberVerticalOffset-gPDFPageFooterVOffset,{align:"center"});0}if(t&&(!a||1!=n)){e.setFont(gPDFFont,gPDFFontStyle,"normal"),e.setFontSize(HEADERFOOTERFONTSIZE);var g=""+(n+TunebookFirstPageNumber-1);switch(o){case"tl":e.text(g,13+gPDFPageNumberHOffset,r+gPDFPageNumberVOffset,{align:"center"});break;case"tc":e.text(g,e.internal.pageSize.getWidth()/3.1,r+gPDFPageNumberVOffset,{align:"center"});break;case"tr":e.text(g,e.internal.pageSize.getWidth()/1.55-(12+gPDFPageNumberHOffset),r+gPDFPageNumberVOffset,{align:"center"});break;case"bl":e.text(g,13+gPDFPageNumberHOffset,thePageNumberVerticalOffset-gPDFPageNumberVOffset,{align:"center"});break;case"bc":e.text(g,e.internal.pageSize.getWidth()/3.1,thePageNumberVerticalOffset-gPDFPageNumberVOffset,{align:"center"});break;case"br":e.text(g,e.internal.pageSize.getWidth()/1.55-(12+gPDFPageNumberHOffset),thePageNumberVerticalOffset-gPDFPageNumberVOffset,{align:"center"});break;case"tlr":n%2==1?e.text(g,13+gPDFPageNumberHOffset,r+gPDFPageNumberVOffset,{align:"center"}):e.text(g,e.internal.pageSize.getWidth()/1.55-(12+gPDFPageNumberHOffset),r+gPDFPageNumberVOffset,{align:"center"});break;case"trl":n%2==1?e.text(g,e.internal.pageSize.getWidth()/1.55-(12+gPDFPageNumberHOffset),r+gPDFPageNumberVOffset,{align:"center"}):e.text(g,13+gPDFPageNumberHOffset,r+gPDFPageNumberVOffset,{align:"center"});break;case"blr":n%2==1?e.text(g,13+gPDFPageNumberHOffset,thePageNumberVerticalOffset-gPDFPageNumberVOffset,{align:"center"}):e.text(g,e.internal.pageSize.getWidth()/1.55-(12+gPDFPageNumberHOffset),thePageNumberVerticalOffset-gPDFPageNumberVOffset,{align:"center"});break;case"brl":n%2==1?e.text(g,e.internal.pageSize.getWidth()/1.55-(12+gPDFPageNumberHOffset),thePageNumberVerticalOffset-gPDFPageNumberVOffset,{align:"center"}):e.text(g,13+gPDFPageNumberHOffset,thePageNumberVerticalOffset-gPDFPageNumberVOffset,{align:"center"})}}}function PrimeWhistleRender(e,t){if(e.length<2)t();else{var n=e[0].querySelector("svg");theOffscreen.innerHTML="<div>"+n.outerHTML+"</div>",(n=theOffscreen.querySelector("svg")).setAttribute("width",gQualitaet),htmlToImage.toCanvas(n,{backgroundColor:"white",style:{background:"white"},pixelRatio:gPDFQuality*gRenderPixelRatio}).then(function(n){var o=e[1].querySelector("svg");theOffscreen.innerHTML="<div>"+o.outerHTML+"</div>",(o=theOffscreen.querySelector("svg")).setAttribute("width",gQualitaet),htmlToImage.toCanvas(o,{backgroundColor:"white",style:{background:"white"},pixelRatio:gPDFQuality*gRenderPixelRatio}).then(function(n){var o=(e.length<3?e[1]:e[2]).querySelector("svg");theOffscreen.innerHTML="<div>"+o.outerHTML+"</div>",(o=theOffscreen.querySelector("svg")).setAttribute("width",gQualitaet),htmlToImage.toCanvas(o,{backgroundColor:"white",style:{background:"white"},pixelRatio:gPDFQuality*gRenderPixelRatio}).then(function(e){t()})})})}}function injectHiddenSearchText(e,t,n,o){if(gPDFIncludeHiddenTitles){pdf.setFont(gPDFFont,gPDFFontStyle,"normal"),pdf.setFontSize(HIDDENPDFTEXTSIZE),pdf.setTextColor("#FFFFFF");var a=gPDFHiddenTextX;t&&2==n&&(0==o?a/=2:a=a/2*3),pdf.text(gExportPDFTuneTitles[tunesProcessed],a,e/1.55+gPAGENUMBERTOP+HIDDENPDFTEXTSIZE/3.1,{align:"center"}),pdf.setTextColor("#000000")}}function RenderPDFBlock(e,t,n,o,a,l,r,i,s,c){if(null!=e&&null!=e){var g=1;if(s){var d=e.id+".block";if(-1==d.indexOf("_0.block")&&-1==d.indexOf("_1.block"))return void c();2==gIncipitsColumns&&(g=2)}var u=e.querySelector("svg");theOffscreen.innerHTML="<div>"+u.outerHTML+"</div>",(u=theOffscreen.querySelector("svg")).setAttribute("width",gQualitaet),htmlToImage.toCanvas(u,{backgroundColor:"white",style:{background:"white"},pixelRatio:gPDFQuality*gRenderPixelRatio}).then(function(t){var a=PAGELEFTOFFSET;"a4"==i&&(a=PAGELEFTOFFSETA4),s||((gPDFNotationWidthOverrideRequested||gPDFNotationWidthAutoOverrideRequested)&&(a="letter"==i?"portrait"==gPDFOrientation?(612-gPageWidth)/2:(792-gPageWidth)/2:"portrait"==gPDFOrientation?(595-gPageWidth)/2:(842-gPageWidth)/2),gPDFLeftMarginOverrideRequested&&(a=gPDFLeftMarginOverride));var l,r=a,d=a+gPageWidth/2;switch(1==column_number&&(a=d),gPDFOrientation){case"portrait":l=PAGEHEIGHTLETTER,"a4"==i&&(l=PAGEHEIGHTA4);break;case"landscape":l=PAGEHEIGHTLETTER_LANDSCAPE,"a4"==i&&(l=PAGEHEIGHTA4_LANDSCAPE)}pdf.internal.scaleFactor=PDFSCALEFACTOR;var u=t.toDataURL("image/jpeg",PDFJPGQUALITY),m=!1;-1!=(e.id+".block").indexOf("_0.block")&&(m=!0,isFirstPage?(isFirstPage=!1,calcPageNumberVerticalOffset(pdf),injectHiddenSearchText(running_height,s,gIncipitsColumns,column_number)):n?(gMixedNotationAndQRCode&&(theCurrentPageNumber++,pdf.addPage(i,gPDFOrientation)),running_height=PAGETOPOFFSET,theCurrentPageNumber++,pdf.addPage(i,gPDFOrientation),document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages",injectHiddenSearchText(running_height,s,gIncipitsColumns,column_number)):o[tunesProcessed-1]?s?2==gIncipitsColumns&&0==column_number?(a=d,injectHiddenSearchText(running_height=PAGETOPOFFSET,s,gIncipitsColumns,column_number=1)):(running_height=PAGETOPOFFSET,theCurrentPageNumber++,pdf.addPage(i,gPDFOrientation),document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages",a=r,injectHiddenSearchText(running_height,s,gIncipitsColumns,column_number=0)):(running_height=PAGETOPOFFSET,theCurrentPageNumber++,pdf.addPage(i,gPDFOrientation),document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages",injectHiddenSearchText(running_height,s,gIncipitsColumns,column_number)):injectHiddenSearchText(running_height+=BETWEENTUNESPACE/g,s,gIncipitsColumns,column_number),theTunePageMap[tunesProcessed]=theCurrentPageNumber,++tunesProcessed<totalTunes&&(document.getElementById("statustunecount").innerHTML='Rendering tune <font color="red">'+(tunesProcessed+1)+'</font> of  <font color="red">'+totalTunes+"</font>")),height=parseInt(t.height*gPageWidth/t.width),height/=g,running_height+height<=l-PAGEBOTTOMOFFSET?(m&&gTuneHyperlinks.push({page:theCurrentPageNumber,x:a,y:running_height,width:gPageWidth/g,height:height,url:""}),pdf.addImage(u,"JPG",a,running_height,gPageWidth/g,height)):(running_height=PAGETOPOFFSET,theCurrentPageNumber++,m&&(gTuneHyperlinks.push({page:theCurrentPageNumber,x:a,y:running_height,width:gPageWidth/g,height:height,url:""}),theTunePageMap[tunesProcessed-1]=theCurrentPageNumber),pdf.addPage(i,gPDFOrientation),pdf.addImage(u,"JPG",a,running_height,gPageWidth/g,height),document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),running_height=running_height+height+1/g,c(!0)})}}function promptForPDFFilename(e,t){if(ParseCommentCommands(getABCEditorText()),gDoForcePDFFilename){var n=e;""==(e=(e=(e=gForcePDFFilename).trim()).replace(".pdf",""))&&(e=n)}e=(e=(e=e.replace(/[.]+/gi,"")).trim()).replace(/^[_]+/,""),gDoForcePDFFilename||""!=gPDFFileName&&(e=(e=gPDFFileName).replace(".pdf","")),DayPilot.Modal.prompt("Please enter a filename for your PDF file:",e+".pdf",{theme:"modal_flat",top:200,autoFocus:!1,scrollWithPage:AllowDialogsToScroll()}).then(function(e){var n=e.result;null!=n&&(0!=(n=cleanFileName(n)).length?(isPureDesktopBrowser()&&n.endsWith(".pdf")||(n=n.replace(/\..+$/,""),n+=".pdf"),gPDFFileName=n):n=null),t(n)})}function ShowAcrobatHyperlinkLengthWarning(){sendGoogleAnalytics("dialog","ShowAcrobatHyperlinkLengthWarning");DayPilot.Modal.alert('<p style="text-align:center;font-size:18pt;font-family:helvetica;">Adobe Acrobat Hyperlink Length Warning</p><p style="font-size:12pt;line-height:18pt;margin-top:36px;">Adobe Acrobat limits the length of clicked hyperlinks to 2076 characters.</p><p style="font-size:12pt;line-height:18pt;">Some very complex tune Share URLs used in tunebooks generated with this tool may exceed this limit.</p><p style="font-size:12pt;line-height:18pt;">If you are using Adobe Acrobat as your PDF reader, and you are seeing this message after clicking a complex tune link, try instead simply dragging the PDF of the tunebook to your browser to read it.</p><p style="font-size:12pt;line-height:18pt;">The PDF readers built into most modern browsers do not have this hyperlink length limitation and will properly open the tune hyperlink when clicked.</p>',{theme:"modal_flat",top:100,width:700,scrollWithPage:AllowDialogsToScroll()})}function ShowHyperlinkBadDecodeAlert(){sendGoogleAnalytics("dialog","ShowHyperlinkBadDecodeAlert");DayPilot.Modal.alert('<p style="text-align:center;font-size:18pt;font-family:helvetica;">Problem Decoding Tune Share URL</p><p style="font-size:12pt;line-height:18pt;margin-top:36px;text-align:center;">An unrecoverable error occured when decoding this tune ShareURL.</p>',{theme:"modal_flat",top:100,width:700,scrollWithPage:AllowDialogsToScroll()})}function ShowAcrobatURLSizeWarningDialog(){sendGoogleAnalytics("dialog","ShowAcrobatURLSizeWarningDialog");var e='<p style="text-align:center;font-size:18pt;font-family:helvetica;">Adobe Acrobat Maximum URL Length Warning</p>';if(gAddTunebookPlaybackHyperlinks)e+='<p style="font-size:12pt;line-height:18pt;margin-top:36px;">During PDF export play hyperlink embedding, the entire tunebook play hyperlink length of '+gAcrobatURLLimitExceeded[0].urllength+" characters exceeded the Adobe Acrobat maximum URL length of 2076 characters.</p>",e+='<p style="font-size:12pt;line-height:18pt;">These play links will work with the built-in PDF reader on most web browsers and online PDF readers, many non-Adobe desktop and mobile PDF readers, but will not open correctly if the tune title is clicked when the PDF is viewed using Adobe Acrobat:</p>',e+='<p style="font-size:12pt;line-height:18pt;margin-top:24px">If Adobe Acrobat is your target PDF reader, your best option is to use the per-tune %hyperlink directive in these tunes with a shortened play Share URL to the entire tunebook manually generated using the Sharing dialog.</p>';else{e+='<p style="font-size:12pt;line-height:18pt;margin-top:36px;">During PDF export play hyperlink embedding, some very long and complex tunes had play hyperlinks that exceeded the Adobe Acrobat maximum URL length of 2076 characters.</p>',e+='<p style="font-size:12pt;line-height:18pt;">These play links will work with the built-in PDF reader on most web browsers and online PDF readers, many non-Adobe desktop and mobile PDF readers, but will not open correctly if the tune title is clicked when the PDF is viewed using Adobe Acrobat:</p>';for(var t=gAcrobatURLLimitExceeded.length,n=0;n<t;++n)e+='<p style="font-size:12pt;line-height:10pt;">"'+gAcrobatURLLimitExceeded[n].name+'"&nbsp;-&nbsp;URL length: '+gAcrobatURLLimitExceeded[n].urllength+"</p>";e+='<p style="font-size:12pt;line-height:18pt;margin-top:24px">If Adobe Acrobat is your target PDF reader, your best option is to use the per-tune %hyperlink directive in these tunes with a shortened play Share URL manually generated using the Sharing dialog.</p>'}DayPilot.Modal.alert(e,{theme:"modal_flat",top:75,width:700,scrollWithPage:AllowDialogsToScroll()}).then(function(){gAcrobatURLLimitExceeded=[]})}function ExportPDF(){if(!gRenderingPDF&&gAllowPDF){var e="incipits_abc"==(r=getPDFFormat())||"incipits_a4_abc"==r||"incipits_abc_sort"==r||"incipits_a4_abc_sort"==r||"incipits_abc_full"==r||"incipits_a4_abc_full"==r||"incipits_abc_full_cce"==r||"incipits_a4_abc_full_cce"==r,t="all_qr_codes"==r||"all_qr_codes_a4"==r,n="incipits_abc_full"==r||"incipits_a4_abc_full"==r||"incipits_abc_full_cce"==r||"incipits_a4_abc_full_cce"==r,o="incipits_abc_full_cce"==r||"incipits_a4_abc_full_cce"==r;(gMixedNotationAndQRCode="mixed_notation_qr"==r||"mixed_notation_qr_a4"==r)&&setPDFFormat(r="mixed_notation_qr"==r?"one":"one_a4");var a=getDescriptiveFileName(totalTunes=CountTunes(),!0);if(t)promptForPDFFilename(a+=" QR Codes",function(e){e&&ExportTextIncipitsPDF(e,n,o,!0)});else if(e)promptForPDFFilename(a+=n?o?" Comhaltas":" ABC":" Incipits",function(e){e&&ExportTextIncipitsPDF(e,n,o,!1)});else{if(gDisableNotationRendering){var l="Notation PDF export not possible with rendering disabled.";return l=makeCenteredPromptString(l),void DayPilot.Modal.alert(l,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})}var r;("incipits"==(r=getPDFFormat())||"incipits_a4"==r)&&(a+=" Incipits"),gMixedNotationAndQRCode&&(a+=" Notation QR"),"pdf_per_tune"==r||"pdf_per_tune_a4"==r?(gOriginalWidthBeforePDFExport=gTheNotation.style.width,gTheNotation.style.width="850px",ExportNotationPDF("an Individual PDF File for Each Tune")):promptForPDFFilename(a,function(e){e&&(gOriginalWidthBeforePDFExport=gTheNotation.style.width,gTheNotation.style.width="850px",ExportNotationPDF(e))})}}}function ExportTextIncipitsPDF(e,t,n,o){gPDFCancelRequested=!1;var a=getPDFFormat();document.getElementById("pdf-controls").style.display="block";var l=getPageNumbers(),r="none"!=l,i="letter";"incipits_a4_abc"!=a&&"incipits_a4_abc_sort"!=a&&"incipits_a4_abc_full"!=a&&"incipits_a4_abc_full_cce"!=a&&"all_qr_codes_a4"!=a||(i="a4");var s=!1;"incipits_abc_sort"!=a&&"incipits_a4_abc_sort"!=a||(s=!0);var c=!1;function g(){document.getElementById("statuspdfname").innerHTML='Generating <font color="blue">'+e+"</font>",document.getElementById("statustunecount").innerHTML="",document.getElementById("pagestatustext").innerHTML="&nbsp;",(pdf=new jsPDF(gPDFOrientation,"pt",i)).setDisplayMode("fullpage","single","UseNone"),pdf.internal.scaleFactor=PDFSCALEFACTOR,calcPageNumberVerticalOffset(pdf),gTuneHyperlinks=[],setTimeout(function(){var a=[];if(o){sendGoogleAnalytics("export","PDFQRCodes"),a=GenerateFullTuneQRCodes(pdf,r,l,c,i,a,function(e){a=e,document.getElementById("statustunecount").innerHTML="All QR Codes Added!",g()})}else t?(sendGoogleAnalytics("export","PDFFullText"),a=GenerateFullTextIncipits(pdf,r,l,c,i,a,!1,n),document.getElementById("statustunecount").innerHTML="Full ABC Text Added!",g()):(sendGoogleAnalytics("export","PDFTextIncipits"),a=GenerateTextIncipits(pdf,r,l,c,i,a,s),document.getElementById("statustunecount").innerHTML="ABC Incipits Added!",g());function g(){if(gPDFCancelRequested)return gRenderingPDF=!1,clearGetTuneByIndexCache(),void(document.getElementById("pdf-controls").style.display="none");var t=theCurrentPageNumber;TunebookTPRequested&&(pdf.addPage(i,gPDFOrientation),theCurrentPageNumber++,pdf.movePage(theCurrentPageNumber,1));var n=theCurrentPageNumber,o=1,g=1;TunebookTOCRequested&&DryRunAddTuneTOC(pdf,l,c,i,a,theTunebookSortedTOCTitle,!1,s),g=theCurrentPageNumber-n,g++,TunebookSortedTOCRequested&&DryRunAddTuneTOC(pdf,l,c,i,a,theTunebookSortedTOCTitle,!0,s),theTOCDelta=theCurrentPageNumber-n,theCurrentPageNumber=n,TunebookTPRequested&&(o++,g++,theTOCDelta++),(TunebookFirstPageAuto||gPDFAutoPageNumbers)&&(TunebookFirstPageNumber=theTOCDelta+1),TunebookTOCRequested&&(document.getElementById("statustunecount").innerHTML="Adding Table of Contents",AppendTuneTOC(pdf,l,c,i,a,theTunebookTOCTitle,s,s,gIncludePageLinks,theTOCDelta,o),document.getElementById("statustunecount").innerHTML="Table of Contents Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),TunebookSortedTOCRequested&&(document.getElementById("statustunecount").innerHTML="Adding Sorted Table of Contents",AppendTuneTOC(pdf,l,c,i,a,theTunebookSortedTOCTitle,!0,s,gIncludePageLinks,theTOCDelta,g),document.getElementById("statustunecount").innerHTML="Sorted Table of Contents Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),TunebookTPRequested&&(document.getElementById("statustunecount").innerHTML="Adding Title Page",AppendTuneTitlePage(pdf,i,theTunebookTP,theTunebookTPST),document.getElementById("statustunecount").innerHTML="Title Page Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),n=theCurrentPageNumber-n,TunebookTPRequested&&n++,(TunebookTOCRequested||TunebookSortedTOCRequested)&&(n=theTOCDelta),PostProcessHeadersAndFooters(pdf,r,n+1,t,l,c,i),TunebookIndexRequested&&(document.getElementById("statustunecount").innerHTML="Adding Tunebook Index",AppendTunebookIndex(pdf,l,c,i,a,theTunebookIndexTitle,s,s,gIncludePageLinks,n),document.getElementById("statustunecount").innerHTML="Tunebook Index Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),TunebookSortedIndexRequested&&(document.getElementById("statustunecount").innerHTML="Adding Tunebook Sorted Index",AppendTunebookIndex(pdf,l,c,i,a,theTunebookSortedIndexTitle,!0,s,gIncludePageLinks,n),document.getElementById("statustunecount").innerHTML="Tunebook Sorted Index Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages");var d=!1,u=1,m=!1,p=1,h=theTOCDelta+1,f=theTOCDelta+t;if(gAddTOCLinkback&&(TunebookTOCRequested||TunebookSortedTOCRequested)&&(d=!0,TunebookTPRequested&&(u=2)),gAddIndexLinkback&&(TunebookIndexRequested||TunebookSortedIndexRequested)&&(m=!0,p=t+theTOCDelta+1),(d||m)&&PostProcessTOCAndIndexLinks(pdf,h,f,d,u,m,p),gTuneHyperlinks.length>0&&PostProcessTuneHyperlinks(pdf,gTuneHyperlinks,i,h),gQRCodeRequested){document.getElementById("statustunecount").innerHTML="Adding Tunebook QR Code",AppendQRCode(pdf,i,function(e){e?(theCurrentPageNumber++,document.getElementById("statustunecount").innerHTML="Tunebook QR Code Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"):document.getElementById("statustunecount").innerHTML="Share URL too long for QR Code, try sharing fewer tunes";var t=1e3;e||(t=4e3);return void setTimeout(function(){document.getElementById("statustunecount").innerHTML="&nbsp;",b()},t)})}else b();function b(){document.getElementById("statuspdfname").innerHTML='<font color="darkgreen">Rendering Complete!</font>',setTimeout(function(){document.getElementById("statuspdfname").innerHTML='Saving <font color="blue">'+e+"</font>",setTimeout(function(){if(isMobileBrowser()){var t=pdf.output("blob",{filename:e}),n=new Blob([t],{type:"application/octet-stream"}),o=document.createElement("a");document.body.appendChild(o),o.style="display: none",url=window.URL.createObjectURL(n),o.href=url,o.download=e,o.click(),document.body.removeChild(o),setTimeout(function(){window.URL.revokeObjectURL(url)},1e3)}else pdf.save(e);document.getElementById("statuspdfname").innerHTML="&nbsp;",document.getElementById("statustunecount").innerHTML="&nbsp;",document.getElementById("pagestatustext").innerHTML="&nbsp;",document.getElementById("pdf-controls").style.display="none",gRenderingPDF=!1,clearGetTuneByIndexCache()},500)},500)}}},250)}"no"==getFirstPage()&&(c=!0),ParseCommentCommands(getABCEditorText()),theRenderTime="",theHeaderFooterTuneNames=GetAllTuneTitles(),theCurrentPageNumber=1,totalTunes=CountTunes(),isFirstPage=!0,gRenderingPDF=!0,"Noto-Sans"==gPDFFont||"Noto-Serif"==gPDFFont?(document.getElementById("statustunecount").innerHTML="",document.getElementById("pagestatustext").innerHTML="&nbsp;","Noto-Sans"==gPDFFont?gNotoSansLoaded?(gPDFFontStyle="Normal",g()):(document.getElementById("statuspdfname").innerHTML="Loading Noto-Sans Font",loadScript("./notosans-regular.js",function(){gNotoSansLoaded=!0,gPDFFontStyle="Normal",g()})):"Noto-Serif"==gPDFFont&&(gNotoSerifLoaded?(gPDFFontStyle="Normal",g()):(document.getElementById("statuspdfname").innerHTML="Loading Noto-Serif Font",loadScript("./notoserif-regular.js",function(){gNotoSerifLoaded=!0,gPDFFontStyle="Normal",g()})))):g()}function ExportNotationPDF(e){gPDFCancelRequested=!1,gPDFTabselected=GetRadioValue("notenodertab"),document.getElementById("pdf-controls").style.display="block";var t=getPDFFormat();!isMobileBrowser()||"pdf_per_tune"!=t&&"pdf_per_tune_a4"!=t||(t="one");var n=getPageNumbers(),o="pdf_per_tune"==t||"pdf_per_tune_a4"==t,a="one"==t||"one_a4"==t||o,l="none"!=n,r="letter";"one_a4"!=t&&"multi_a4"!=t&&"incipits_a4"!=t&&"pdf_per_tune_a4"!=t||(r="a4");var i="incipits"==t||"incipits_a4"==t,s=!1;"no"==getFirstPage()&&(s=!0),ParseCommentCommands(getABCEditorText()),i||(gPDFNotationWidthOverrideRequested&&(gPageWidth=gPDFNotationWidthOverride),gPDFNotationWidthAutoOverrideRequested&&(gPageWidth="letter"==r?"portrait"==gPDFOrientation?612*gPDFNotationWidthAutoOverride:792*gPDFNotationWidthAutoOverride:"portrait"==gPDFOrientation?595*gPDFNotationWidthAutoOverride:842*gPDFNotationWidthAutoOverride)),o&&(TunebookTOCRequested=!0,gAddTOCLinkback=!1,gAddIndexLinkback=!1),theRenderTime="",theHeaderFooterTuneNames=GetAllTuneTitles(),gExportPDFTuneTitles=GetTunebookIndexTitles(),theCurrentPageNumber=1,tunesProcessed=0,column_number=0,theTunePageMap=[],totalTunes=CountTunes(),isFirstPage=!0;var c=0,g=[],d=null,u=0,m=null,p=!1;if(gTuneHyperlinks=[],BETWEENTUNESPACE=gBetweenTuneSpace,i){sendGoogleAnalytics("export","PDFIncipits"),1!=gIncipitsColumns||gGotBetweenTuneSpace||(BETWEENTUNESPACE=0),IdleAdvancedControls(!1),IdleAllowShowTabNames();var h=!1,f=getABCEditorText(),b=/^Q:.*$/gm;(h=-1!=f.search(b))||(b=/^P:.*$/gm,h=-1!=f.search(b)),gRawMode||h||gAllowFilterAnnotations&&!gStripAnnotations||gAllowFilterText&&!gStripTextAnnotations||gAllowShowTabNames&&gShowTabNames?(document.getElementById("statuspdfname").innerHTML='Generating <font color="blue">'+e+"</font>",document.getElementById("statustunecount").innerHTML="Processing Incipits for PDF generation",document.getElementById("pagestatustext").innerHTML="&nbsp;",setTimeout(function(){var e=gStripAnnotations;gStripAnnotations=!0,gStripQPTags=!0;var t=gStripTextAnnotations;gStripTextAnnotations=!0;var n=gShowTabNames;gAllowShowTabNames&&(gShowTabNames=!1);var o=gRawMode;gRawMode=!1,Render(!0,null),gRawMode=o,gStripAnnotations=e,gStripQPTags=!1,gStripTextAnnotations=t,gAllowShowTabNames&&(gShowTabNames=n),p=!0,y()},100)):y()}else gRawMode?(document.getElementById("statuspdfname").innerHTML='Generating <font color="blue">'+e+"</font>",document.getElementById("statustunecount").innerHTML="Processing ABC for PDF generation",document.getElementById("pagestatustext").innerHTML="&nbsp;",setTimeout(function(){gRawMode=!1,Render(!0,null),gRawMode=!0,p=!0,y()},100)):y();function y(){"Noto-Sans"==gPDFFont||"Noto-Serif"==gPDFFont?(document.getElementById("statustunecount").innerHTML="",document.getElementById("pagestatustext").innerHTML="&nbsp;","Noto-Sans"==gPDFFont?gNotoSansLoaded?(gPDFFontStyle="Normal",T()):(document.getElementById("statuspdfname").innerHTML="Loading Noto-Sans Font",loadScript("./notosans-regular.js",function(){gNotoSansLoaded=!0,gPDFFontStyle="Normal",T()})):"Noto-Serif"==gPDFFont&&(gNotoSerifLoaded?(gPDFFontStyle="Normal",T()):(document.getElementById("statuspdfname").innerHTML="Loading Noto-Serif Font",loadScript("./notoserif-regular.js",function(){gNotoSerifLoaded=!0,gPDFFontStyle="Normal",T()})))):T()}function T(){sendGoogleAnalytics("export","PDFFull"),running_height=PAGETOPOFFSET,document.getElementById("statuspdfname").innerHTML='Generating <font color="blue">'+e+"</font>",document.getElementById("statustunecount").innerHTML="Processing notation for PDF generation",document.getElementById("pagestatustext").innerHTML="&nbsp;",theOffscreen=document.getElementById("offscreenrender"),PrepareSVGDivsForRasterization(),document.getElementById("statustunecount").innerHTML='Rendering tune <font color="red">1</font> of  <font color="red">'+totalTunes+"</font>",theTunePageMap[0]=theCurrentPageNumber,gRenderingPDF=!0,(pdf=new jsPDF(gPDFOrientation,"pt",r)).setDisplayMode("fullpage","single","UseNone"),gPDFHiddenTextX=pdf.internal.pageSize.getWidth()/3.1,g=[],a||(g=scanTunesForPageBreaks(pdf,r,i)),d=document.querySelectorAll('div[class="block"]'),u=d.length,m=d[0],"whistle"==gPDFTabselected||"recorder"==gPDFTabselected?PrimeWhistleRender(d,I):I()}function I(){setTimeout(function(){RenderPDFBlock(m,0,a,g,l,n,s,r,i,function t(){if(gPDFCancelRequested){if(gRenderingPDF=!1,clearGetTuneByIndexCache(),gTheNotation.style.width=gOriginalWidthBeforePDFExport,pdf=null,d=null,p)document.getElementById("statuspdfname").innerHTML='<font color="red">Cleaning up after PDF generation</font>',RenderAsync(!0,null,function(){document.getElementById("pdf-controls").style.display="none",document.getElementById("offscreenrender").innerHTML=""});else document.getElementById("pdf-controls").style.display="none",RestoreSVGDivsAfterRasterization();return void(gMixedNotationAndQRCode&&(setPDFFormat("a4"==r?"mixed_notation_qr_a4":"mixed_notation_qr"),SavePDFSettings()))}if(++c==u){gMixedNotationAndQRCode&&(theCurrentPageNumber++,pdf.addPage(r,gPDFOrientation));var h=theCurrentPageNumber;function f(){TunebookTPRequested&&(pdf.addPage(r,gPDFOrientation),theCurrentPageNumber++,pdf.movePage(theCurrentPageNumber,1));var t=theCurrentPageNumber,a=1,i=1;TunebookTOCRequested&&DryRunAddTuneTOC(pdf,n,s,r,theTunePageMap,theTunebookTOCTitle,!1,!1),i=theCurrentPageNumber-t,i++,TunebookSortedTOCRequested&&DryRunAddTuneTOC(pdf,n,s,r,theTunePageMap,theTunebookSortedTOCTitle,!0,!1),theTOCDelta=theCurrentPageNumber-t,theCurrentPageNumber=t,TunebookTPRequested&&(a++,i++,theTOCDelta++),(TunebookFirstPageAuto||gPDFAutoPageNumbers)&&(TunebookFirstPageNumber=theTOCDelta+1),TunebookTOCRequested&&(o||(document.getElementById("statustunecount").innerHTML="Adding Table of Contents"),AppendTuneTOC(pdf,n,s,r,theTunePageMap,theTunebookTOCTitle,!1,!1,gIncludePageLinks,theTOCDelta,a),o||(document.getElementById("statustunecount").innerHTML="Table of Contents Added!"),document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),o||(TunebookSortedTOCRequested&&(document.getElementById("statustunecount").innerHTML="Adding Sorted Table of Contents",AppendTuneTOC(pdf,n,s,r,theTunePageMap,theTunebookSortedTOCTitle,!0,!1,gIncludePageLinks,theTOCDelta,i),document.getElementById("statustunecount").innerHTML="Sorted Table of Contents Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),TunebookTPRequested&&(document.getElementById("statustunecount").innerHTML="Adding Title Page",AppendTuneTitlePage(pdf,r,theTunebookTP,theTunebookTPST),document.getElementById("statustunecount").innerHTML="Title Page Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages")),t=theCurrentPageNumber-t,TunebookTPRequested&&t++,(TunebookTOCRequested||TunebookSortedTOCRequested)&&(t=theTOCDelta),PostProcessHeadersAndFooters(pdf,l,t+1,h,n,s,r),o||(TunebookIndexRequested&&(document.getElementById("statustunecount").innerHTML="Adding Tunebook Index",AppendTunebookIndex(pdf,n,s,r,theTunePageMap,theTunebookIndexTitle,!1,!1,gIncludePageLinks,t),document.getElementById("statustunecount").innerHTML="Tunebook Index Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),TunebookSortedIndexRequested&&(document.getElementById("statustunecount").innerHTML="Adding Tunebook Sorted Index",AppendTunebookIndex(pdf,n,s,r,theTunePageMap,theTunebookSortedIndexTitle,!0,!1,gIncludePageLinks,t),document.getElementById("statustunecount").innerHTML="Tunebook Sorted Index Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"));var c=!1,g=1,d=!1,u=1,m=theTOCDelta+1,f=theTOCDelta+h;if(gAddTOCLinkback&&(TunebookTOCRequested||TunebookSortedTOCRequested)&&(c=!0,TunebookTPRequested&&(g=2)),gAddIndexLinkback&&(TunebookIndexRequested||TunebookSortedIndexRequested)&&(d=!0,u=h+theTOCDelta+1),(c||d)&&PostProcessTOCAndIndexLinks(pdf,m,f,c,g,d,u),gTuneHyperlinks.length>0&&PostProcessTuneHyperlinks(pdf,gTuneHyperlinks,r,m),gQRCodeRequested&&!o){document.getElementById("statustunecount").innerHTML="Adding Tunebook QR Code",AppendQRCode(pdf,r,function(e){e?(theCurrentPageNumber++,document.getElementById("statustunecount").innerHTML="Tunebook QR Code Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"):document.getElementById("statustunecount").innerHTML="Share URL too long for QR Code, try sharing fewer tunes";var t=500;e||(t=3e3);return void setTimeout(function(){document.getElementById("statustunecount").innerHTML="&nbsp;",b()},t)})}else b();function b(){document.getElementById("statuspdfname").innerHTML='<font color="darkgreen">Rendering Complete!</font>',setTimeout(function(){function t(){p?(document.getElementById("statuspdfname").innerHTML='<font color="red">Cleaning up after PDF generation</font>',setTimeout(function(){gRenderingPDF=!1,clearGetTuneByIndexCache(),gTheNotation.style.width=gOriginalWidthBeforePDFExport,Render(!0,null),document.getElementById("offscreenrender").innerHTML="",n()},100)):(RestoreSVGDivsAfterRasterization(),n(),gRenderingPDF=!1,clearGetTuneByIndexCache(),gTheNotation.style.width=gOriginalWidthBeforePDFExport)}function n(){document.getElementById("statuspdfname").innerHTML="&nbsp;",document.getElementById("statustunecount").innerHTML="&nbsp;",document.getElementById("pagestatustext").innerHTML="&nbsp;",document.getElementById("pdf-controls").style.display="none",gAcrobatURLLimitExceeded.length>0&&ShowAcrobatURLSizeWarningDialog(),gMixedNotationAndQRCode&&(setPDFFormat("a4"==r?"mixed_notation_qr_a4":"mixed_notation_qr"),SavePDFSettings())}e&&(document.getElementById("statuspdfname").innerHTML='Saving <font color="blue">'+e+"</font>"),o?createSplitPDFs(pdf,theTunePageMap,h,theTOCDelta,t):setTimeout(function(){if(isMobileBrowser()){var n=pdf.output("blob",{filename:e}),o=new Blob([n],{type:"application/octet-stream"}),a=document.createElement("a");document.body.appendChild(a),a.style="display: none",url=window.URL.createObjectURL(o),a.href=url,a.download=e,a.click(),document.body.removeChild(a),setTimeout(function(){window.URL.revokeObjectURL(url)},1e3)}else pdf.save(e);t()},500)},500)}}gMixedNotationAndQRCode?PostProcessMixedNotationAndQRCode(pdf,n,s,r,theTunePageMap,h,f):f()}else{if(c>d.length)return;c>0&&(d[c-1]=null),(m=d[c])&&RenderPDFBlock(m,c,a,g,l,n,s,r,i,t)}})},250)}}function CancelPDF(){gPDFCancelRequested=!0}async function createSplitPDFs(e,t,n,o,a){gTheSplitPDFTitles=GetTunebookIndexTitles(),o--;const l=e.output("blob"),r=await(i=l,new Promise((e,t)=>{const n=new FileReader;n.onloadend=()=>e(n.result),n.onerror=t,n.readAsArrayBuffer(i)}));var i;function s(e){const t=Array.from(e.dict.entries());for(var n=0,o=t.length,a=0;a<o;++a){-1!=t[a][0].encodedName.indexOf("/I")&&n++}return n}const c=(e,t)=>{const n=Array.from(t.dict.entries());for(var o=null,a=n.length,l=0;l<a;++l){var r=n[l];if(r[0].encodedName==e){o=r;break}}if(o)return o[0]};function g(e){var t=e.node.Contents();const n=new TextDecoder("utf-8").decode(t.contents).split("\n").filter(e=>e.startsWith("/I"));for(var o=n.length,a=[],l=0;l<o;++l){var r=n[l];r=(r=(r=r.replace(" Do","")).replace("/I","")).trim(),a.push(parseInt(r))}return a}async function d(e,t){const{PDFDocument:n,PDFName:o,PDFDict:a}=PDFLib,l=await n.create();var r=0;for(let n=t.start;n<=t.end;n++){const[t]=await l.copyPages(e,[n]);l.addPage(t),r++}for(let e=0;e<r;++e){const t=l.getPages()[e],n=t.node.Resources().lookup(o.of("XObject"),a);for(var i=s(n),d=g(t),u=0;u<i;++u)if(!d.includes(u)){const e=c("/I"+u,n),t=n.get(e);t&&l.context.delete(t)}}return newPdfBytes=await l.save(),newPdfBytes}var u=t.length;0!=u&&(document.getElementById("statuspdfname").innerHTML="Splitting PDF Tunebook Into Individual Tune PDFs",document.getElementById("statustunecount").innerHTML="&nbsp;",document.getElementById("pagestatustext").innerHTML="&nbsp;",setTimeout(async function(){const{PDFDocument:e}=PDFLib;var l,i=await e.load(r);function s(e,t,n){document.getElementById("statustunecount").innerHTML='Saving tune <font color="red">'+(gSplitPDFIndex+1)+'</font> of <font color="red">'+gNSplitPDF+"</font>",document.getElementById("pagestatustext").innerHTML='<font color="blue">'+t+"</font>";const o=new Blob([e],{type:"application/pdf"}),a=document.createElement("a");var l=URL.createObjectURL(o);a.href=l,a.download=`${t}.pdf`,document.body.appendChild(a),a.click(),document.body.removeChild(a),setTimeout(function(){window.URL.revokeObjectURL(l)},1e3),n()}if(gSplitPDFIndex=0,(gNSplitPDF=u)>0){if(gSplitPDFIndex!=gNSplitPDF-1){var c=t[gSplitPDFIndex+1]-t[gSplitPDFIndex];c--,l={start:t[gSplitPDFIndex]+o,end:t[gSplitPDFIndex]+c+o}}else{c=n-t[gSplitPDFIndex];l={start:t[gSplitPDFIndex]+o,end:t[gSplitPDFIndex]+c+o}}s(await d(i,l),gTheSplitPDFTitles[0],async function e(){var l;if(gPDFCancelRequested)return document.getElementById("statuspdfname").innerHTML="&nbsp;",document.getElementById("statustunecount").innerHTML="Operation Cancelled",document.getElementById("pagestatustext").innerHTML="&nbsp;",void setTimeout(function(){a()},500);if(++gSplitPDFIndex<gNSplitPDF){if(gSplitPDFIndex!=gNSplitPDF-1){var r=t[gSplitPDFIndex+1]-t[gSplitPDFIndex];r--,l={start:t[gSplitPDFIndex]+o,end:t[gSplitPDFIndex]+r+o}}else r=n-t[gSplitPDFIndex],l={start:t[gSplitPDFIndex]+o,end:t[gSplitPDFIndex]+r+o};var c=await d(i,l);setTimeout(function(){s(c,gTheSplitPDFTitles[gSplitPDFIndex],e)},100)}else a()})}},500))}function getNextSiblings(e,t){for(var n=[];e=e.nextSibling;)t&&!t(e)||n.push(e);return n}function getStyleProp(e,t){return window.getComputedStyle?window.getComputedStyle(e,null).getPropertyValue(t):e.currentStyle?e.currentStyle[t]:void 0}function GetABCJSParams(e){var t="",n="";if(e&&(gAllowWhistleTabTranspose="whistle"==e,gAllowRecorderTabTranspose="recorder"==e,gShowTabNames))switch(gCapo>0&&(t=" (Capo "+gCapo+")"),e){case"noten":break;case"notenames":case"whistle":case"recorder":n=" ";break;case"mandolin":n="Mandolin"+t;break;case"gdad":n="GDAD"+t;break;case"cgda":n="CGDA"+t;break;case"cgdae":n="CGDAE"+t;break;case"dgdae":n="DGDAE"+t;break;case"guitare":n="Guitar"+t;break;case"guitard":n="DADGAD"+t;break;case"uke":n="Ukulele"+t}var o;gDrawTabSymbol=!0;var a=!0;if(e?"noten"==e?(a=!1,o={responsive:"resize",oneSvgPerLine:"true",expandToWidest:"true",selectTypes:!1,format:gRenderingFonts}):"mandolin"==e?o={tablature:[{instrument:"violin",label:n,tuning:["G,","D","A","e"],highestNote:"f'",capo:gCapo}],responsive:"resize",oneSvgPerLine:"true",expandToWidest:"true",selectTypes:!1,format:gRenderingFonts}:"gdad"==e?o={tablature:[{instrument:"violin",label:n,tuning:["G,","D","A","d"],highestNote:"f'",capo:gCapo}],responsive:"resize",oneSvgPerLine:"true",expandToWidest:"true",selectTypes:!1,format:gRenderingFonts}:"cgda"==e?o={tablature:[{instrument:"violin",label:n,tuning:["C,","G,","D","A"],highestNote:"f'",capo:gCapo}],responsive:"resize",oneSvgPerLine:"true",expandToWidest:"true",selectTypes:!1,format:gRenderingFonts}:"cgdae"==e?o={tablature:[{instrument:"fivestring",label:n,tuning:["C,","G,","D","A","e"],highestNote:"f'",capo:gCapo}],responsive:"resize",oneSvgPerLine:"true",expandToWidest:"true",selectTypes:!1,format:gRenderingFonts}:"dgdae"==e?o={tablature:[{instrument:"fivestring",label:n,tuning:["D,","G,","D","A","e"],highestNote:"f'",capo:gCapo}],responsive:"resize",oneSvgPerLine:"true",expandToWidest:"true",selectTypes:!1,format:gRenderingFonts}:"guitare"==e?o={tablature:[{instrument:"guitar",label:n,tuning:["E,","A,","D","G","B","e"],highestNote:"f'",capo:gCapo}],responsive:"resize",oneSvgPerLine:"true",expandToWidest:"true",selectTypes:!1,format:gRenderingFonts}:"guitard"==e?o={tablature:[{instrument:"guitar",label:n,tuning:["D,","A,","D","G","A","d"],highestNote:"f'",capo:gCapo}],responsive:"resize",oneSvgPerLine:"true",expandToWidest:"true",selectTypes:!1,format:gRenderingFonts}:"uke"==e?o={tablature:[{instrument:"violin",label:n,tuning:["G,","C","E","A"],highestNote:"f'",capo:gCapo}],responsive:"resize",oneSvgPerLine:"true",expandToWidest:"true",selectTypes:!1,format:gRenderingFonts}:"notenames"==e?(gDrawTabSymbol=!1,o={tablature:[{instrument:"violin",label:n,tuning:["G,,,","G,,","G,"],highestNote:"b'",hideTabSymbol:!0,linePitch:2}],responsive:"resize",oneSvgPerLine:"true",expandToWidest:"true",selectTypes:!1,format:gRenderingFonts}):"whistle"==e?(gDrawTabSymbol=!1,o={tablature:[{instrument:"violin",label:n,tuning:["G,,,"],highestNote:"^a'",hideTabSymbol:!0}],responsive:"resize",oneSvgPerLine:"true",expandToWidest:"true",selectTypes:!1,format:gRenderingFonts}):"recorder"==e?(gDrawTabSymbol=!1,o={tablature:[{instrument:"violin",label:n,tuning:["C,,"],highestNote:"^a'",hideTabSymbol:!0}],responsive:"resize",oneSvgPerLine:"true",expandToWidest:"true",selectTypes:!1,format:gRenderingFonts}):(a=!1,o={responsive:"resize",oneSvgPerLine:"true",selectTypes:!1,format:gRenderingFonts}):(a=!1,o={responsive:"resize",oneSvgPerLine:"true",expandToWidest:"true",selectTypes:!1,format:gRenderingFonts},e=""),a&&o.tablature&&o.tablature.length>0)for(var l=o.tablature[0],r=0;r<7;++r)o.tablature.push(l);return gOnlyHighlightV1&&(o.add_classes=!0),o}function UpdateLocalStorage(){if(gLocalStorageAvailable){if(!gIsFromShare||gForceTabSave){var e=GetRadioValue("notenodertab");localStorage.abcTab=e,gForceTabSave=!1}var t=gCapo;if(localStorage.abcCapo=t,!gIsFromShare){var n=gStaffSpacing-STAFFSPACEOFFSET;localStorage.abcStaffSpacing=n}var o=getPDFFormat();localStorage.abcTunesPerPage=o;var a=getPageNumbers();localStorage.abcPageNumberLocation=a;var l=getFirstPage();localStorage.abcPageNumberOnPageOne=l;var r=gTopBarShowing;localStorage.abcHideTopBar=r?"false":"true";var i=gShowTabNames;localStorage.abcShowTabNames=i?"true":"false",localStorage.PDFFont=gPDFFont,localStorage.PDFFontStyle=gPDFFontStyle,localStorage.PDFOrientation=gPDFOrientation,localStorage.PDFIncludeHiddenTitles=gPDFIncludeHiddenTitles,localStorage.PDFAutoPageNumbers=gPDFAutoPageNumbers}}function SavePDFSettings(){UpdateLocalStorage()}function PrepareSVGDivsForRasterization(){document.getElementById("offscreenrender").innerHTML="";for(var e=CountTunes(),t=0;t<e;++t){var n,o,a="notation"+t,l=document.querySelectorAll('div[id="'+a+'"] > div'),r=l.length;for(n=0;n<r;++n)(o=l.item(n)).classList.add("block"),o.id="block_"+t+"_"+n}}function RestoreSVGDivsAfterRasterization(){document.getElementById("offscreenrender").innerHTML="";for(var e=CountTunes(),t=0;t<e;++t){var n,o,a="notation"+t,l=document.querySelectorAll('div[id="'+a+'"] > div'),r=l.length;for(n=0;n<r;++n)(o=l.item(n)).removeAttribute("class"),o.removeAttribute("id")}}function NoteClickListener(e,t,n,o,a,l){var r=window.scrollY;setTimeout(function(){window.scrollTo(0,r),gEnableSyntax?gTheCM.focus():gTheABC.focus();var t=e.startChar,n=e.endChar;ScrollABCTextIntoView(gEnableSyntax?gTheCM:gTheABC,t,n,2)},10)}function fireSelectionChanged(){if(gRawMode&&CountTunes()>0&&gRawVisual){if(gCurrentTune!=gRawLastIndex){for(var e=gRawVisual.length,t=0;t<e;++t){(n=gRawVisual[t].engraver).rangeHighlight(0,0)}gRawLastIndex=gCurrentTune}var n;(n=gRawVisual[gRawLastIndex].engraver)&&(gEnableSyntax?n.rangeHighlight(gTheCM.selectionStart,gTheCM.selectionEnd):n.rangeHighlight(gTheABC.selectionStart,gTheABC.selectionEnd))}}function RenderTheNotes(e,t,n,o){if(gIsQuickEditor&&(document.querySelectorAll('style[data-aggregate-css="true"]').forEach(e=>e.remove()),n=!1,o=0),!gDisableNotationRendering){var a=GetABCJSParams(t);gIsQuickEditor&&(a.oneSvgPerLine=!1);var l=[],r=0,i=0,s=0;if(n){document.querySelectorAll('style[data-aggregate-css="true"]').forEach(e=>e.remove()),s=r=CountTunes();for(var c=0;c<r;++c)l.push("notation"+c)}else r=1,i=o,s=o+1,l.push("notation"+o);if(0!=r){gRawMode&&isDesktopBrowser()&&(a.clickListener=NoteClickListener,a.selectTypes=!0,a.selectionColor=gRawHighlightColor),gTabFirstStaffOnly=ScanTuneForTabFirstStaffOnly(e,t),gTabSecondStaffOnly=!1,gTabFirstStaffOnly||(gTabSecondStaffOnly=ScanTuneForTabSecondStaffOnly(e,t));try{var g=ABCJS.renderAbc(l,e,a)}catch(e){var d='<p style="text-align:center;font-size:18pt;font-family:helvetica;">Tune Rendering Issue</p>';d+='<p style="font-size:12pt;line-height:18pt;margin-top:36px;text-align:center;">During rendering, the following tune caused the tool to crash:</p>',d+='<p style="font-size:12pt;line-height:18pt;margin-top:20px;text-align:center;"><strong>'+gLastRenderedTuneName+"</strong></p>",d+='<p style="font-size:12pt;line-height:18pt;margin-top:20px;text-align:center;">Try isolating this one tune to determine the issue.</p>',d+='<p style="font-size:3pt;line-height:3pt;text-align:center;">&nbsp;</p>',DayPilot.Modal.alert(d,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})}if(gShowDiagnostics&&gRawMode&&n&&r>1)(m=document.getElementById("diagnostics")).innerHTML='<p class="diagnostics_message">Diagnostics are not available if Highlighting is on and there are multiple tunes in the ABC editor.</p>';else if(gShowDiagnostics&&(!n||1==r)&&g&&g[0]){var u=g[0].warnings;u=adjustWarningLineNumbers(u);var m=document.getElementById("diagnostics");if(u){var p="",h=u.length;for(c=0;c<h;++c)p+='<p class="diagnostics_message">'+u[c]+"</p>";m.innerHTML=p}else m.innerHTML='<p class="diagnostics_message">"'+gLastRenderedTuneName+'" - No issues found</p>'}gRawVisual=gRawMode?g:null;for(var f=i;f<s;++f){postProcessTab(g,"notation"+f,t,!1)}gIsQuickEditor||(g=null)}}}function SetRadioValue(e,t){const n=document.querySelectorAll(`input[name="${e}"]`);for(const e of n)e.checked=e.value===t}function GetRadioValue(e){const t=document.querySelector(`input[name="${e}"]:checked`);return t?t.value:void 0}function StripAnnotations(){var e=getABCEditorText();setABCEditorText(e=StripAnnotationsOne(e)),gIsDirty=!0}function StripAnnotationsOne(e){var t=/^Z:.*[\r\n]*/gm;return e=e.replace(t,""),t=/^R:.*[\r\n]*/gm,e=e.replace(t,""),t=/^S:.*[\r\n]*/gm,e=e.replace(t,""),t=/^N:.*[\r\n]*/gm,e=e.replace(t,""),t=/^D:.*[\r\n]*/gm,e=e.replace(t,""),t=/^H:.*[\r\n]*/gm,e=e.replace(t,""),t=/^B:.*[\r\n]*/gm,e=e.replace(t,""),t=/^C:.*[\r\n]*/gm,e=e.replace(t,""),t=/^O:.*[\r\n]*/gm,e=e.replace(t,""),t=/^A:.*[\r\n]*/gm,e=e.replace(t,"")}function StripAnnotationsOneForIncipits(e){var t=/^Q:.*[\r\n]*/gm;return e=e.replace(t,""),t=/^Z:.*[\r\n]*/gm,e=e.replace(t,""),t=/^R:.*[\r\n]*/gm,e=e.replace(t,""),t=/^S:.*[\r\n]*/gm,e=e.replace(t,""),t=/^N:.*[\r\n]*/gm,e=e.replace(t,""),t=/^D:.*[\r\n]*/gm,e=e.replace(t,""),t=/^H:.*[\r\n]*/gm,e=e.replace(t,""),t=/^B:.*[\r\n]*/gm,e=e.replace(t,""),t=/^C:.*[\r\n]*/gm,e=e.replace(t,""),t=/^O:.*[\r\n]*/gm,e=e.replace(t,""),t=/^A:.*[\r\n]*/gm,e=e.replace(t,""),t=/^P:.*[\r\n]*/gm,e=e.replace(t,"")}function StripTextAnnotations(){var e=getABCEditorText();setABCEditorText(e=StripTextAnnotationsOne(e)),gIsDirty=!0}function StripTextAnnotationsOne(e){var t=/%%text .*[\r\n]*/gm;return e=e.replace(t,""),t=/%%text[\r\n]/gm,e=e.replace(t,""),t=/%%center.*[\r\n]*/gm,e=e.replace(t,""),t=/%%right.*[\r\n]*/gm,e=(e=e.replace(t,"")).replace(/^%%begintext[\s\S]*?^%%endtext.*(\r?\n)?/gm,"")}function commentBeginEndTextBlocks(e){return e.replace(/^%%begintext[\s\S]*?^%%endtext.*$/gm,e=>e.split(/\r?\n/).map(e=>"% comment").join("\n"))}function StripChords(){var e=getABCEditorText();setABCEditorText(e=StripChordsOne(e)),gIsDirty=!0}function StripChordsOne(e){function t(e){return-1==e.indexOf('"_')&&-1==e.indexOf('"^')?e.length>9||-1!=e.indexOf(" ")?e:"":e}var n=/"[^"]*"/gm;return e.split("\n").map(e=>/^[XTMKLQWZRCAOPNGHBDFSIV]:/.test(e)||/^%/.test(e)?e:e.replace(n,t)).join("\n")}function AreChordsInMatch(e){if(!e)return!1;for(var t=e.length,n=0;n<t;++n){var o=e[n];if(-1==o.indexOf('"_')&&-1==o.indexOf('"^')){if(o.length>9)continue;if(-1!=o.indexOf(" "))continue;return!0}}return!1}function AreChordsInABC(e){var t=!1,n=/"[^"]*"/gm;e.split("\n").map(e=>{t||(/^[XTMKLQWZRCAOPNGHBDFSIV]:/.test(e)||/^%/.test(e)||AreChordsInMatch(e.match(n))&&(t=!0))});return t}function IsTabInMatch(e){if(!e)return!1;for(var t=e.length,n=0;n<t;++n)if(0==e[n].indexOf('"_')||0==e[n].indexOf('"^'))return!0;return!1}function IsTabInABC(e){var t=!1,n=/"[^"]*"/gm;e.split("\n").map(e=>{t||(/^[XTMKLQWZRCAOPNGHBDFSIV]:/.test(e)||/^%/.test(e)||IsTabInMatch(e.match(n))&&(t=!0))});return t||/!(0|1|2|3|4)!/.test(e)&&(t=!0),t}function StripTab(){var e=getABCEditorText();setABCEditorText(e=StripTabOne(e)),gIsDirty=!0}function StripTabOne(e){function t(e){return 0==e.indexOf('"_')||0==e.indexOf('"^')?"":e}var n=/"[^"]*"/gm;return e.split("\n").map(e=>/^[XTMKLQWZRCAOPNGHBDFSIV]:/.test(e)||/^%/.test(e)?e:(e=(e=(e=(e=(e=(e=(e=e.replaceAll("!push!","")).replaceAll("!draw!","")).replaceAll("!0!","")).replaceAll("!1!","")).replaceAll("!2!","")).replaceAll("!3!","")).replaceAll("!4!","")).replace(n,t)).join("\n")}function StripOrnaments(e){setABCEditorText(StripOrnamentsOne(getABCEditorText(),!0)),gIsDirty=!0}function StripOrnamentsOne(e,t){var n,o;return n=/%%score \{[^}]*\}|\{[^}]*\}/gm,o="",e=e.replace(n,e=>e.startsWith("%%score")?e:o),t&&(e=e.replaceAll("~","")),e}function processAllStripping(e){var t="";return gStripAnnotations&&(gStripQPTags&&(t=/^Q:.*$/gm,e=e.replace(t,"% comment")),t=/^Z:.*$/gm,e=e.replace(t,"% comment"),t=/^R:.*$/gm,e=e.replace(t,"% comment"),t=/^S:.*$/gm,e=e.replace(t,"% comment"),t=/^N:.*$/gm,e=e.replace(t,"% comment"),t=/^D:.*$/gm,e=e.replace(t,"% comment"),t=/^H:.*$/gm,e=e.replace(t,"% comment"),t=/^B:.*$/gm,e=e.replace(t,"% comment"),t=/^C:.*$/gm,e=e.replace(t,"% comment"),t=/^O:.*$/gm,e=e.replace(t,"% comment"),t=/^A:.*$/gm,e=e.replace(t,"% comment"),gStripQPTags&&(t=/^P:.*$/gm,e=e.replace(t,"% comment"))),gStripTextAnnotations&&(t=/%%text .*$/gm,e=e.replace(t,"% comment"),t=/%%text[\r\n]/gm,e=e.replace(t,"% comment\n"),t=/%%center.*$/gm,e=e.replace(t,"% comment"),t=/%%right.*$/gm,e=commentBeginEndTextBlocks(e=e.replace(t,"% comment"))),gStripChords&&(e=StripChordsOne(e)),gStripTab&&(e=StripTabOne(e)),gStripOrnaments&&(e=StripOrnamentsOne(e,!0)),e}function RenderRangeAsync(e,t,n){if(gRenderingPDF)n&&null!=n&&n();else{var o=t-e+1;if(o<=0)n&&null!=n&&n();else{gIsQuickEditor&&(t=e),hideTheSpinner();var a=!1;o>5&&(a=!0),a&&showTheSpinner(),setTimeout(function(){for(var o=e;o<=t;++o)Render(!1,o);hideTheSpinner(),n&&null!=n&&n()},gSpinnerDelay)}}}function RenderAsync(e,t,n){(gIsQuickEditor&&(e=!1,t=0),gRenderingPDF)?n&&null!=n&&n():(clearGetTuneByIndexCache(),hideTheSpinner(),e?(CountTunes()>50&&showTheSpinner(),setTimeout(function(){Render(e,t),hideTheSpinner(),MakeTuneVisible(!0),n&&null!=n&&n()},gSpinnerDelay)):(Render(e,t),n&&null!=n&&n()))}function Render(e,t){if(!gRenderingPDF){clearGetTuneByIndexCache();var n=CountTunes();if(""!=getABCEditorText()&&n>0){document.getElementById("abc-selected").innerText=1==n?gDisplayedName+"  ("+n+" Tune)":gDisplayedName+"  ("+n+" Tunes)";var o=window.pageYOffset;UpdateLocalStorage(),document.getElementById("notation-placeholder").style.display="none",isDesktopBrowser()?gTheNotation.style.display=gIsMaximized?"flex":"inline":gTheNotation.style.display=gIsMaximized?"flex":"block",gDisableEditFromPlayLink?HideMaximizeButton():ShowMaximizeButton(),(isDesktopBrowser()||gIsMaximized)&&ShowPlayButton(),gIsQuickEditor?(isMobileBrowser()&&gIsMaximized||isDesktopBrowser())&&ShowQEFSPlayerButtons():(isDesktopBrowser()||gIsMaximized)&&ShowPDFButton(),n>1?ShowJumpButton():HideJumpButton(),gShowAllControls&&gTopBarShowing?(document.getElementById("notenrechts").style.display="inline-block",gIsFirstRender&&(UpdateNotationTopPosition(),gIsFirstRender=!1)):document.getElementById("notenrechts").style.display="none",document.getElementById("saveabcfile").classList.remove("saveabcfiledisabled"),document.getElementById("saveabcfile").classList.add("saveabcfile"),gAllowSave=!0,gAllowControlToggle=!0,gIsQuickEditor||(document.getElementById("saveaspdf").classList.remove("saveaspdfdisabled"),document.getElementById("saveaspdf").classList.add("saveaspdf"),gAllowPDF=!0),document.getElementById("saveaswebsite").classList.remove("saveaswebsitedisabled"),document.getElementById("saveaswebsite").classList.add("saveaswebsite"),gAllowWebExport=!0,document.getElementById("copybutton").classList.remove("copybuttondisabled"),document.getElementById("copybutton").classList.add("copybutton"),gIsQuickEditor&&gRawMode||(document.getElementById("playbutton").classList.remove("playbuttondisabled"),document.getElementById("playbutton").classList.add("playbutton")),isPureDesktopBrowser()&&(document.getElementById("rawmodebutton").classList.remove("rawmodebuttondisabled"),document.getElementById("rawmodebutton").classList.add("rawmodebutton")),gAllowCopy=!0;var a,l=GetRadioValue("notenodertab"),r=GetABCFileHeader();if(e?gIsQuickEditor?(GenerateRenderingDivs(1),a=gRawMode?getABCEditorText():r+getTuneByIndex(t)):(GenerateRenderingDivs(n),a=getABCEditorText()):gIsQuickEditor?(GenerateRenderingDivs(1),a=gRawMode?getABCEditorText():r+getTuneByIndex(gCurrentTune)):a=r+getTuneByIndex(t),gIsQuickEditor&&n>1&&(gRawMode=!1,document.getElementById("rawmodebutton").classList.remove("rawmodebutton"),document.getElementById("rawmodebutton").classList.add("rawmodebuttondisabled"),document.getElementById("rawmodebutton").classList.add("btn-rawmode-off"),document.getElementById("rawmodebutton").classList.remove("btn-rawmode-on"),document.getElementById("rawmodebutton").value="Highlighting",gEnableSyntax?(setCMDarkMode(gDarkModeColor,gLightModeColor),gTheCM.refresh()):gTheABC.style.backgroundColor=gLightModeColor,gRawMode=!1,gRawLastIndex=-1),!gRawMode&&(a=processAllStripping(a),!hasStaffSep(r))){a=a.replace(/^X:.*$/gm,"X:1\n%%staffsep "+gStaffSpacing)}gIsQuickEditor?RenderTheNotes(a,l,!1,0):RenderTheNotes(a,l,e,t),window.scrollTo(0,o),gIsQuickEditor&&(gSuppressQuickPlayer||inlinePlayback())}else{document.getElementById("notenrechts").style.display="none",gTheNotation.style.display="none",document.getElementById("saveabcfile").classList.remove("saveabcfile"),document.getElementById("saveabcfile").classList.add("saveabcfiledisabled"),gAllowSave=!1,gIsQuickEditor||(document.getElementById("saveaspdf").classList.remove("saveaspdf"),document.getElementById("saveaspdf").classList.add("saveaspdfdisabled"),gAllowPDF=!1),document.getElementById("saveaswebsite").classList.remove("saveaswebsite"),document.getElementById("saveaswebsite").classList.add("saveaswebsitedisabled"),gAllowWebExport=!1,gAllowControlToggle=!1,document.getElementById("copybutton").classList.remove("copybutton"),document.getElementById("copybutton").classList.add("copybuttondisabled"),document.getElementById("playbutton").classList.remove("playbutton"),document.getElementById("playbutton").classList.add("playbuttondisabled"),document.getElementById("rawmodebutton").classList.remove("rawmodebutton"),document.getElementById("rawmodebutton").classList.add("rawmodebuttondisabled"),document.getElementById("rawmodebutton").classList.add("btn-rawmode-off"),document.getElementById("rawmodebutton").classList.remove("btn-rawmode-on"),document.getElementById("rawmodebutton").value="Highlighting",gEnableSyntax?(setCMDarkMode(gDarkModeColor,gLightModeColor),gTheCM.refresh()):gTheABC.style.backgroundColor=gLightModeColor,gRawMode=!1,gRawLastIndex=-1,gLastClickedTune=-1,gAllowCopy=!1,document.getElementById("notation-placeholder").style.display="block",document.getElementById("zoombutton").style.display="none",document.getElementById("jumpbutton").style.display="none",gIsQuickEditor?(HidePlayButton(),HideQEFSPlayerButtons()):(HidePlayButton(),HidePDFButton()),hideTheSpinner(),document.getElementById("abc-selected").innerText="No ABC file selected",gDisplayedName="No ABC file selected",gABCFromFile=!1,gIsFirstRender=!0,elem=document.getElementById("diagnostics"),elem.innerHTML="",UpdateNotationTopPosition(),gIsQuickEditor&&(document.getElementById("playback-audio-inline").innerHTML=""),document.querySelectorAll('style[data-aggregate-css="true"]').forEach(e=>e.remove())}}}function ensureABCFile(e){var t="";return e.lastIndexOf(".")>0&&(t=e.substring(e.lastIndexOf(".")+1,e.length)),"abc"==t.toLowerCase()||"txt"==t.toLowerCase()||"xml"==t.toLowerCase()||"musicxml"==t.toLowerCase()||"mxl"==t.toLowerCase()||"mid"==t.toLowerCase()||"midi"==t.toLowerCase()||"bww"==t.toLowerCase()||"BWW"==t.toLowerCase()}function IdleAdvancedControls(e){var t,n,o,a,l=getABCEditorText(),r="",i=!1;if(r=/^Z:.*$/gm,(i=-1!=l.search(r))||(r=/^R:.*$/gm,i=-1!=l.search(r)),i||(r=/^S:.*$/gm,i=-1!=l.search(r)),i||(r=/^N:.*$/gm,i=-1!=l.search(r)),i||(r=/^D:.*$/gm,i=-1!=l.search(r)),i||(r=/^H:.*$/gm,i=-1!=l.search(r)),i||(r=/^B:.*$/gm,i=-1!=l.search(r)),i||(r=/^C:.*$/gm,i=-1!=l.search(r)),i||(r=/^O:.*$/gm,i=-1!=l.search(r)),i||(r=/^A:.*$/gm,i=-1!=l.search(r)),t=i,i=!1,r=/%%text .*$/gm,(i=-1!=l.search(r))||(r=/%%text[\r\n]/gm,i=-1!=l.search(r)),i||(r=/%%center.*$/gm,i=-1!=l.search(r)),i||(r=/%%right.*$/gm,i=-1!=l.search(r)),i||(r=/%%begintext.*$/gm,i=-1!=l.search(r)),n=i,i=!1,r=/"[^"]*"/gm,o=i=AreChordsInABC(l),i=IsTabInABC(l),EnableTab=i,i=!1,-1!=l.indexOf("~")&&(i=!0),!i&&(r=/%%score \{[^}]*\}|\{[^}]*\}/gm,theMatch=l.match(r),theMatch&&theMatch.length))for(var s=theMatch.length,c=0;c<s;++c)if(0==theMatch[c].indexOf("{")){i=!0;break}a=i,t?(gAllowFilterAnnotations=!0,e&&(document.getElementById("toggleannotations").classList.remove("advancedcontrolsdisabled"),document.getElementById("toggleannotations").classList.add("advancedcontrols"),document.getElementById("stripannotations").classList.remove("advancedcontrolsdisabled"),document.getElementById("stripannotations").classList.add("advancedcontrols"))):(gAllowFilterAnnotations=!1,e&&(document.getElementById("toggleannotations").classList.remove("advancedcontrols"),document.getElementById("toggleannotations").classList.add("advancedcontrolsdisabled"),document.getElementById("stripannotations").classList.remove("advancedcontrols"),document.getElementById("stripannotations").classList.add("advancedcontrolsdisabled"))),n?(gAllowFilterText=!0,e&&(document.getElementById("toggletext").classList.remove("advancedcontrolsdisabled"),document.getElementById("toggletext").classList.add("advancedcontrols"),document.getElementById("striptext").classList.remove("advancedcontrolsdisabled"),document.getElementById("striptext").classList.add("advancedcontrols"))):(gAllowFilterText=!1,e&&(document.getElementById("toggletext").classList.remove("advancedcontrols"),document.getElementById("toggletext").classList.add("advancedcontrolsdisabled"),document.getElementById("striptext").classList.remove("advancedcontrols"),document.getElementById("striptext").classList.add("advancedcontrolsdisabled"))),o?(gAllowFilterChords=!0,e&&(document.getElementById("togglechords").classList.remove("advancedcontrolsdisabled"),document.getElementById("togglechords").classList.add("advancedcontrols"),document.getElementById("stripchords").classList.remove("advancedcontrolsdisabled"),document.getElementById("stripchords").classList.add("advancedcontrols"))):(gAllowFilterChords=!1,e&&(document.getElementById("togglechords").classList.remove("advancedcontrols"),document.getElementById("togglechords").classList.add("advancedcontrolsdisabled"),document.getElementById("stripchords").classList.remove("advancedcontrols"),document.getElementById("stripchords").classList.add("advancedcontrolsdisabled"))),EnableTab?(gAllowFilterTab=!0,e&&(document.getElementById("toggletab").classList.remove("advancedcontrolsdisabled"),document.getElementById("toggletab").classList.add("advancedcontrols"),document.getElementById("striptab").classList.remove("advancedcontrolsdisabled"),document.getElementById("striptab").classList.add("advancedcontrols"))):(gAllowFilterTab=!1,e&&(document.getElementById("toggletab").classList.remove("advancedcontrols"),document.getElementById("toggletab").classList.add("advancedcontrolsdisabled"),document.getElementById("striptab").classList.remove("advancedcontrols"),document.getElementById("striptab").classList.add("advancedcontrolsdisabled"))),a?(gAllowFilterOrnaments=!0,e&&(document.getElementById("toggleornaments").classList.remove("advancedcontrolsdisabled"),document.getElementById("toggleornaments").classList.add("advancedcontrols"),document.getElementById("stripornaments").classList.remove("advancedcontrolsdisabled"),document.getElementById("stripornaments").classList.add("advancedcontrols"))):(gAllowFilterOrnaments=!1,e&&(document.getElementById("toggleornaments").classList.remove("advancedcontrols"),document.getElementById("toggleornaments").classList.add("advancedcontrolsdisabled"),document.getElementById("stripornaments").classList.remove("advancedcontrols"),document.getElementById("stripornaments").classList.add("advancedcontrolsdisabled"))),e&&(document.getElementById("toggleannotations").value=gStripAnnotations?"Show Annotations":"Hide Annotations",document.getElementById("toggletext").value=gStripTextAnnotations?"Show Text":"Hide Text",document.getElementById("togglechords").value=gStripChords?"Show Chords":"Hide Chords",document.getElementById("toggletab").value=gStripTab?"Show Injected Tab":"Hide Injected Tab",document.getElementById("toggleornaments").value=gStripOrnaments?"Show Ornaments":"Hide Ornaments")}function UpdateNotationTopPosition(){var e=document.getElementById("noscroller").offsetHeight;document.getElementById("notation-spacer").style.height=e+"px"}function RestoreDefaults(){gStripAnnotations=!1,gStripQPTags=!1,gStripTextAnnotations=!1,gStripChords=!1,gStripTab=!1,gStripOrnaments=!1,gAllowFilterAnnotations=!1,gAllowFilterText=!1,gAllowFilterChords=!1,gAllowFilterTab=!1,gAllowFilterOrnaments=!1,gTotalTunes=0,gCurrentTune=0,gRawLastIndex=-1,gForceFullRender=!1,gIsFirstRender=!0,gLastAutoScrolledTune=-1,gLastClickedTune=-1,gPDFFileName="",gWebsiteFilename="",gSuppressQuickPlayer=!1,document.getElementById("selectabcfile").value="",clearQRCode(),clearGetTuneByIndexCache(),UpdateNotationTopPosition()}function ToggleAnnotations(e){if(gAllowFilterAnnotations){if(e)return StripAnnotations(),RenderAsync(!0,null,function(){ensureMoreToolsVisible()}),void IdleAdvancedControls(!0);gStripAnnotations=!gStripAnnotations,gStripQPTags=!1,RenderAsync(!0,null),IdleAdvancedControls(!0)}}function ToggleTextAnnotations(e){if(gAllowFilterText){if(e)return StripTextAnnotations(),RenderAsync(!0,null,function(){ensureMoreToolsVisible()}),void IdleAdvancedControls(!0);gStripTextAnnotations=!gStripTextAnnotations,RenderAsync(!0,null),IdleAdvancedControls(!0)}}function ToggleChords(e){if(gAllowFilterChords){if(e)return StripChords(),RenderAsync(!0,null,function(){ensureMoreToolsVisible()}),void IdleAdvancedControls(!0);gStripChords=!gStripChords,RenderAsync(!0,null,function(){ensureMoreToolsVisible()}),IdleAdvancedControls(!0)}}function ToggleTab(e){if(gAllowFilterTab){if(e)return StripTab(),RenderAsync(!0,null,function(){ensureMoreToolsVisible()}),void IdleAdvancedControls(!0);gStripTab=!gStripTab,RenderAsync(!0,null,function(){ensureMoreToolsVisible()}),IdleAdvancedControls(!0)}}function ToggleOrnaments(e){if(gAllowFilterOrnaments){if(e)return StripOrnaments(),RenderAsync(!0,null,function(){ensureMoreToolsVisible()}),void IdleAdvancedControls(!0);gStripOrnaments=!gStripOrnaments,RenderAsync(!0,null,function(){ensureMoreToolsVisible()}),IdleAdvancedControls(!0)}}function idleAddABC(){gIsIOS&&document.getElementById("addabcfilebutton").removeAttribute("accept"),document.getElementById("addabcfilebutton").onchange=()=>{let e=document.getElementById("addabcfilebutton");if(0===e.files.length){var t="Please select an ABC, MusicXML, or MIDI file";return t=makeCenteredPromptString(t),void DayPilot.Modal.alert(t,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})}DoMultiReadCommon(Array.from(e.files),e)};var e=document.getElementById("dialogrestorebutton");e.style.display="none";var t=document.getElementById("dialogrestoreautobutton");if(t.style.display="none",gLocalStorageAvailable){var n=localStorage.SavedSnapshot,o=localStorage.SavedSnapshot2,a=localStorage.SavedSnapshot3,l=localStorage.SavedSnapshot4,r=n&&""!=n||o&&""!=o||a&&""!=a||l&&""!=l,i=localStorage.LastAutoSnapShot,s=i&&""!=i;r&&(e.style.display="inline"),s&&(t.style.display="inline")}var c=document.getElementsByClassName("modal_flat_ok"),g=null;gAddABCOKButton=null;for(var d=0;d<c.length;++d)if("OK"==(g=c[d]).innerText){gAddABCOKButton=g;break}}var gPDFTunebookConfig={pdfquality:.75,pdf_between_tune_space:20,addtitle:"Tunebook Title",addsubtitle:"Tunebook Subtitle",addtoc:"Table of Contents",addindex:"Index",pageheader:"This is the Page Header",pagefooter:"This is the Page Footer",bAdd_add_all_playback_links:!0,bAdd_add_full_tunebook:!1,bInjectInstruments:!0,sound_font:"fluid",melody_instrument:1,bass_instrument:1,bass_volume:64,chord_instrument:1,chord_volume:64,bAdd_add_fonts:!1,bAdd_QRCode:!0,qrcode_link:"https://michaeleskin.com/abc",caption_for_qrcode:"Created using Michael Eskin's ABC Transcription Tools"};function resetPDFTunebookConfig(){gPDFTunebookConfig={pdfquality:.75,pdf_between_tune_space:20,addtitle:"Tunebook Title",addsubtitle:"Tunebook Subtitle",addtoc:"Table of Contents",addindex:"Index",pageheader:"This is the Page Header",pagefooter:"This is the Page Footer",bAdd_add_all_playback_links:!0,bAdd_add_full_tunebook:!1,bInjectInstruments:!0,sound_font:"fluid",melody_instrument:1,bass_instrument:1,bass_volume:64,chord_instrument:1,chord_volume:64,bAdd_add_fonts:!1,bAdd_QRCode:!0,qrcode_link:"https://michaeleskin.com/abc",caption_for_qrcode:"Created using Michael Eskin's ABC Transcription Tools"}}function parsePlaybackProgramFromDirective(e){if("mute"===e)return 0;var t=parseInt(e,10);return isNaN(t)?0:(void 0!==MIDI_PATCH_COUNT&&(t<0&&(t=0),t>MIDI_PATCH_COUNT&&(t=MIDI_PATCH_COUNT)),t+1)}function mapPdfQualityToClosest(e){const t=[.4,.5,.75];let n=t[0],o=Math.abs(e-n);for(let a=1;a<t.length;a++){const l=Math.abs(e-t[a]);l<o&&(o=l,n=t[a])}return n}function parsePDFTunebookFeaturesBlock(e){if(e){gPDFTunebookConfig.addtitle="",gPDFTunebookConfig.addsubtitle="",gPDFTunebookConfig.addtoc="",gPDFTunebookConfig.addindex="",gPDFTunebookConfig.pageheader="",gPDFTunebookConfig.pagefooter="",gPDFTunebookConfig.qrcode_link="",gPDFTunebookConfig.caption_for_qrcode="",gPDFTunebookConfig.bAdd_add_all_playback_links=!1,gPDFTunebookConfig.bAdd_add_full_tunebook=!1,gPDFTunebookConfig.bAdd_add_fonts=!1,gPDFTunebookConfig.bInjectInstruments=!1,gPDFTunebookConfig.bAdd_QRCode=!1;for(var t=e.split(/\r?\n/),n=0;n<t.length;n++){var o=t[n].trim();if(o&&"%"===o.charAt(0)&&(o=o.substring(1).trim())){var a=o.split(/\s+/),l=a[0],r=o.substring(l.length).trim();switch(l){case"pdfquality":if(a.length>1){var i=parseFloat(a[1]);isNaN(i)||(gPDFTunebookConfig.pdfquality=mapPdfQualityToClosest(i))}break;case"pdf_between_tune_space":if(a.length>1){var s=parseInt(a[1],10);isNaN(s)||(gPDFTunebookConfig.pdf_between_tune_space=s)}break;case"addtitle":gPDFTunebookConfig.addtitle=r;break;case"addsubtitle":gPDFTunebookConfig.addsubtitle=r;break;case"addtoc":gPDFTunebookConfig.addtoc=r;break;case"addsortedindex":gPDFTunebookConfig.addindex=r;break;case"pageheader":gPDFTunebookConfig.pageheader=r;break;case"pagefooter":gPDFTunebookConfig.pagefooter=r;break;case"add_all_playback_links":a.length>=5&&(gPDFTunebookConfig.bAdd_add_all_playback_links=!0,gPDFTunebookConfig.bInjectInstruments=!0,gPDFTunebookConfig.melody_instrument=parsePlaybackProgramFromDirective(a[1]),gPDFTunebookConfig.bass_instrument=parsePlaybackProgramFromDirective(a[2]),gPDFTunebookConfig.chord_instrument=parsePlaybackProgramFromDirective(a[3]),gPDFTunebookConfig.sound_font=a[4]);break;case"add_all_playback_volumes":if(a.length>=3){var c=parseInt(a[1],10);isNaN(c)||(gPDFTunebookConfig.bass_volume=c);var g=parseInt(a[2],10);isNaN(g)||(gPDFTunebookConfig.chord_volume=g)}break;case"playback_links_are_complete_tunebook":gPDFTunebookConfig.bAdd_add_full_tunebook=!0;break;case"add_all_fonts":gPDFTunebookConfig.bAdd_add_fonts=!0;break;case"qrcode":gPDFTunebookConfig.bAdd_QRCode=!0,gPDFTunebookConfig.qrcode_link=r;break;case"caption_for_qrcode":gPDFTunebookConfig.caption_for_qrcode=r}}}}}function loadPDFTunebookConfigFromABC(){var e=getABCEditorText();if(e){var t="% Start of PDF Tunebook Features",n=e.indexOf(t);if(-1!==n){var o=e.indexOf("% End of PDF Tunebook Features",n+32);if(-1!==o)parsePDFTunebookFeaturesBlock(e.substring(n+32,o))}}}function idlePDFTunebookBuilder(){$('[name="addtitle"]').attr("placeholder","No Title Page will be included"),$('[name="addsubtitle"]').attr("placeholder","No Title Page subtitle will be included"),$('[name="addtoc"]').attr("placeholder","No Table of Contents will be included"),$('[name="addindex"]').attr("placeholder","No Index will be included"),$('[name="pageheader"]').attr("placeholder","No Page Header will be included"),$('[name="pagefooter"]').attr("placeholder","No Page Footer will be included"),$('[name="qrcode_link"]').attr("placeholder","QR Code will use default Share URL"),$('[name="caption_for_qrcode"]').attr("placeholder","No QR Code caption will be included")}function PDFTunebookBuilder(){if(gRenderingPDF)return;sendGoogleAnalytics("dialog","PDFTunebookBuilder"),loadPDFTunebookConfigFromABC(),gPDFTunebookConfig.sound_font&&""!=gPDFTunebookConfig.sound_font||(gPDFTunebookConfig.sound_font="fluid"),void 0!==gPDFTunebookConfig.bass_instrument&&null!==gPDFTunebookConfig.bass_instrument&&""!==gPDFTunebookConfig.bass_instrument||(gPDFTunebookConfig.bass_instrument=1),gPDFTunebookConfig.bass_volume&&""!=gPDFTunebookConfig.bass_volume||(gPDFTunebookConfig.bass_volume="64"),gPDFTunebookConfig.chord_volume&&""!=gPDFTunebookConfig.chord_volume||(gPDFTunebookConfig.chord_volume="64");for(var e=[],t=0;t<=MIDI_PATCH_COUNT;++t)e.push({name:"  "+generalMIDISoundNames[t],id:t});for(t=0;t<=MIDI_PATCH_COUNT;++t)e.push({name:"  "+generalMIDISoundNames[t],id:t});var n=[{html:'<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;margin-bottom:18px">Inject All PDF Tunebook Features&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#inject_pdf_tunebook_features" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="margin-top:12px;margin-bottom:12px;font-size:12pt;line-height:14pt;font-family:helvetica">Clicking "Inject" will inject PDF tunebook feature commands at the top of your ABC.</p>'},{html:'<p style="margin-top:12px;margin-bottom:12px;font-size:12pt;line-height:14pt;font-family:helvetica">Leave any text fields blank for features you don\'t want in your PDF tunebook.</p>'},{name:"PDF quality:",id:"pdfquality",type:"select",options:[{name:"  Draft",id:.4},{name:"  Good",id:.5},{name:"  High",id:.75}],cssClass:"configure_pdfquality_select"},{name:'Space between tunes (in 1/72"):',id:"pdf_between_tune_space",type:"number",cssClass:"configure_setuppdftunebook_form_text3"},{name:"Title Page title:",id:"addtitle",type:"text",cssClass:"configure_setuppdftunebook_form_text_wide2"},{name:"Title Page subtitle:",id:"addsubtitle",type:"text",cssClass:"configure_setuppdftunebook_form_text_wide"},{name:"Table of Contents title:",id:"addtoc",type:"text",cssClass:"configure_setuppdftunebook_form_text_wide"},{name:"Index title:",id:"addindex",type:"text",cssClass:"configure_setuppdftunebook_form_text_wide"},{name:"Page Header:",id:"pageheader",type:"text",cssClass:"configure_setuppdftunebook_form_text_wide"},{name:"Page Footer:",id:"pagefooter",type:"text",cssClass:"configure_setuppdftunebook_form_text_wide"},{name:"          Add playback links to each tune to allow playing the tune by clicking the tune title",id:"bAdd_add_all_playback_links",type:"checkbox",cssClass:"configure_setuppdftunebook_form_text2"},{name:"          Playback links contain entire tunebook",id:"bAdd_add_full_tunebook",type:"checkbox",cssClass:"configure_setuppdftunebook_form_text"},{name:"Soundfont for playback links:",id:"sound_font",type:"select",options:[{name:"  Fluid",id:"fluid"},{name:"  Musyng Kite",id:"musyng"},{name:"  FatBoy",id:"fatboy"},{name:"  Canvas",id:"canvas"},{name:"  MScore",id:"mscore"},{name:"  Arachno",id:"arachno"},{name:"  FluidHQ",id:"fluidhq"}],cssClass:"configure_setuppdftunebook_midi_program_select"},{name:"Melody instrument for playback links:",id:"melody_instrument",type:"select",options:e,cssClass:"configure_setuppdftunebook_midi_program_select"},{name:"Bass instrument for playback links:",id:"bass_instrument",type:"select",options:e,cssClass:"configure_setuppdftunebook_midi_program_select"},{name:"Bass volume (0-127):",id:"bass_volume",type:"number",cssClass:"configure_setuppdftunebook_form_text"},{name:"Chord instrument for playback links:",id:"chord_instrument",type:"select",options:e,cssClass:"configure_setuppdftunebook_midi_program_select"},{name:"Chord volume (0-127):",id:"chord_volume",type:"number",cssClass:"configure_setuppdftunebook_form_text"},{name:"          Inject all required fonts into the ABC in the playback links",id:"bAdd_add_fonts",type:"checkbox",cssClass:"configure_setuppdftunebook_form_text"},{name:"          Add a QR Code to the end of the PDF",id:"bAdd_QRCode",type:"checkbox",cssClass:"configure_setuppdftunebook_form_text"},{html:'<p style="margin-top:18px;margin-bottom:16px;font-size:12pt;line-height:10pt;font-family:helvetica">To override the default Share URL QR Code, enter your own URL below:</p>'},{name:"Custom URL:",id:"qrcode_link",type:"text",cssClass:"configure_setuppdftunebook_form_text_wide"},{name:"QR Code caption:",id:"caption_for_qrcode",type:"text",cssClass:"configure_setuppdftunebook_form_text_wide"}];setTimeout(function(){idlePDFTunebookBuilder()},150);DayPilot.Modal.form(n,gPDFTunebookConfig,{theme:"modal_flat",top:10,width:690,scrollWithPage:AllowDialogsToScroll(),okText:"Inject",autoFocus:!1}).then(function(e){if(!e.canceled){var t="% Start of PDF Tunebook Features\n";if(t+="%\n",gPDFTunebookConfig.pdfquality=e.result.pdfquality,t+="%pdfquality "+gPDFTunebookConfig.pdfquality+"\n",gPDFTunebookConfig.pdf_between_tune_space=e.result.pdf_between_tune_space,""!=gPDFTunebookConfig.pdf_between_tune_space&&(t+="%pdf_between_tune_space "+gPDFTunebookConfig.pdf_between_tune_space+"\n"),gPDFTunebookConfig.addtitle=e.result.addtitle,gPDFTunebookConfig.addsubtitle=e.result.addsubtitle,""!=gPDFTunebookConfig.addtitle&&(t+="%addtitle "+gPDFTunebookConfig.addtitle+"\n",t+="%titlefontsize 24\n",""!=gPDFTunebookConfig.addsubtitle&&(t+="%addsubtitle "+gPDFTunebookConfig.addsubtitle+"\n",t+="%subtitlefontsize 16\n")),gPDFTunebookConfig.addtoc=e.result.addtoc,""!=gPDFTunebookConfig.addtoc&&(t+="%addtoc "+gPDFTunebookConfig.addtoc+"\n",t+="%addlinkbacktotoc\n",t+="%tocleftoffset 0\n",t+="%tocrightoffset 0\n"),gPDFTunebookConfig.addindex=e.result.addindex,""!=gPDFTunebookConfig.addindex&&(t+="%addsortedindex "+gPDFTunebookConfig.addindex+"\n",t+="%addlinkbacktoindex\n",t+="%indexleftoffset 0\n",t+="%indexrightoffset 0\n"),gPDFTunebookConfig.pageheader=e.result.pageheader,""!=gPDFTunebookConfig.pageheader&&(t+="%pageheader "+gPDFTunebookConfig.pageheader+"\n"),gPDFTunebookConfig.pagefooter=e.result.pagefooter,""!=gPDFTunebookConfig.pagefooter&&(t+="%pagefooter "+gPDFTunebookConfig.pagefooter+"\n"),gPDFTunebookConfig.bAdd_add_all_playback_links=e.result.bAdd_add_all_playback_links,gPDFTunebookConfig.bAdd_add_full_tunebook=e.result.bAdd_add_full_tunebook,gPDFTunebookConfig.bInjectInstruments=e.result.bInjectInstruments,gPDFTunebookConfig.sound_font=e.result.sound_font,gPDFTunebookConfig.melody_instrument=e.result.melody_instrument,gPDFTunebookConfig.bass_instrument=e.result.bass_instrument,gPDFTunebookConfig.bass_volume=e.result.bass_volume,gPDFTunebookConfig.chord_instrument=e.result.chord_instrument,gPDFTunebookConfig.chord_volume=e.result.chord_volume,gPDFTunebookConfig.bAdd_add_all_playback_links){var n=gPDFTunebookConfig.sound_font,o=gPDFTunebookConfig.melody_instrument,a=gPDFTunebookConfig.bass_instrument,l=gPDFTunebookConfig.chord_instrument;0==o?o="mute":((o-=1)<0||o>MIDI_PATCH_COUNT)&&(o=0),0==a?a="mute":((a-=1)<0||a>MIDI_PATCH_COUNT)&&(a=0),0==l?l="mute":((l-=1)<0||l>MIDI_PATCH_COUNT)&&(l=0),t+="%add_all_playback_links "+o+" "+a+" "+l+" "+n+"\n",t+="%add_all_playback_volumes "+gPDFTunebookConfig.bass_volume+" "+gPDFTunebookConfig.chord_volume+"\n",gPDFTunebookConfig.bAdd_add_full_tunebook&&(t+="%playback_links_are_complete_tunebook\n"),gPDFTunebookConfig.bAdd_add_fonts=e.result.bAdd_add_fonts,gPDFTunebookConfig.bAdd_add_fonts&&(t+="%add_all_fonts\n")}gPDFTunebookConfig.bAdd_QRCode=e.result.bAdd_QRCode,gPDFTunebookConfig.qrcode_link=e.result.qrcode_link,gPDFTunebookConfig.caption_for_qrcode=e.result.caption_for_qrcode,gPDFTunebookConfig.bAdd_QRCode&&(""!=gPDFTunebookConfig.qrcode_link?t+="%qrcode "+gPDFTunebookConfig.qrcode_link+"\n":t+="%qrcode\n",""!=gPDFTunebookConfig.caption_for_qrcode&&(t+="%caption_for_qrcode "+gPDFTunebookConfig.caption_for_qrcode+"\n")),t+="%\n",t+="% End of PDF Tunebook Features\n",t+="\n",SaveConfigurationSettings();var r=getABCEditorText(),i="% End of PDF Tunebook Features\n\n",s=r.indexOf(i);-1!=s&&(s+=32,r=r.substring(s)),setABCEditorText(t+=r),gIsDirty=!0,gRawMode&&RenderAsync(!0,null)}})}function PDFTunebookBuilderPlayOnly(){if(gRenderingPDF)return;sendGoogleAnalytics("dialog","PDFTunebookBuilderPlayOnly"),loadPDFTunebookConfigFromABC(),gPDFTunebookConfig.sound_font&&""!=gPDFTunebookConfig.sound_font||(gPDFTunebookConfig.sound_font="fluid"),void 0!==gPDFTunebookConfig.bass_instrument&&null!==gPDFTunebookConfig.bass_instrument&&""!==gPDFTunebookConfig.bass_instrument||(gPDFTunebookConfig.bass_instrument=1),gPDFTunebookConfig.bass_volume&&""!=gPDFTunebookConfig.bass_volume||(gPDFTunebookConfig.bass_volume="64"),gPDFTunebookConfig.chord_volume&&""!=gPDFTunebookConfig.chord_volume||(gPDFTunebookConfig.chord_volume="64");for(var e=[],t=0;t<=MIDI_PATCH_COUNT;++t)e.push({name:"  "+generalMIDISoundNames[t],id:t});for(t=0;t<=MIDI_PATCH_COUNT;++t)e.push({name:"  "+generalMIDISoundNames[t],id:t});var n=[{html:'<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;margin-bottom:18px">Inject Only PDF Tunebook Play Features&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#inject_pdf_tunebook_features_play" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="margin-top:12px;margin-bottom:12px;font-size:12pt;line-height:20pt;font-family:helvetica">Clicking "Inject" will inject PDF playback enabling commands at the top of your ABC.</p>'},{html:'<p style="margin-top:12px;margin-bottom:24px;font-size:12pt;line-height:20pt;font-family:helvetica">With these injected commands in place, in an exported PDF file, clicking the title of the tunes will open them in the Player in a new browser tab.</p>'},{name:"Soundfont for playback links:",id:"sound_font",type:"select",options:[{name:"  Fluid",id:"fluid"},{name:"  Musyng Kite",id:"musyng"},{name:"  FatBoy",id:"fatboy"},{name:"  Canvas",id:"canvas"},{name:"  MScore",id:"mscore"},{name:"  Arachno",id:"arachno"},{name:"  FluidHQ",id:"fluidhq"}],cssClass:"configure_setuppdftunebook_midi_program_select_play"},{name:"Melody instrument for playback links:",id:"melody_instrument",type:"select",options:e,cssClass:"configure_setuppdftunebook_midi_program_select_play"},{name:"Bass instrument for playback links:",id:"bass_instrument",type:"select",options:e,cssClass:"configure_setuppdftunebook_midi_program_select_play"},{name:"Bass volume (0-127):",id:"bass_volume",type:"number",cssClass:"configure_setuppdftunebook_form_text_play"},{name:"Chord instrument for playback links:",id:"chord_instrument",type:"select",options:e,cssClass:"configure_setuppdftunebook_midi_program_select_play"},{name:"Chord volume (0-127):",id:"chord_volume",type:"number",cssClass:"configure_setuppdftunebook_form_text_play"}];DayPilot.Modal.form(n,gPDFTunebookConfig,{theme:"modal_flat",top:100,width:690,scrollWithPage:AllowDialogsToScroll(),okText:"Inject",autoFocus:!1}).then(function(e){if(!e.canceled){var t="% Start of PDF Tunebook Features\n";t+="%\n",gPDFTunebookConfig.sound_font=e.result.sound_font,gPDFTunebookConfig.melody_instrument=e.result.melody_instrument,gPDFTunebookConfig.bass_instrument=e.result.bass_instrument,gPDFTunebookConfig.bass_volume=e.result.bass_volume,gPDFTunebookConfig.chord_instrument=e.result.chord_instrument,gPDFTunebookConfig.chord_volume=e.result.chord_volume;var n=gPDFTunebookConfig.sound_font,o=gPDFTunebookConfig.melody_instrument,a=gPDFTunebookConfig.bass_instrument,l=gPDFTunebookConfig.chord_instrument;0==o?o="mute":((o-=1)<0||o>MIDI_PATCH_COUNT)&&(o=0),0==a?a="mute":((a-=1)<0||a>MIDI_PATCH_COUNT)&&(a=0),0==l?l="mute":((l-=1)<0||l>MIDI_PATCH_COUNT)&&(l=0),t+="%pdfquality 0.6\n",t+="%pdf_between_tune_space 20\n",t+="%\n",t+="%pageheader Click the tune title to play\n",t+="%\n",t+="%add_all_playback_links "+o+" "+a+" "+l+" "+n+"\n",t+="%add_all_playback_volumes "+gPDFTunebookConfig.bass_volume+" "+gPDFTunebookConfig.chord_volume+"\n",t+="%\n",t+="% End of PDF Tunebook Features\n",t+="\n",SaveConfigurationSettings();var r=getABCEditorText(),i="% End of PDF Tunebook Features\n\n",s=r.indexOf(i);-1!=s&&(s+=i.length,r=r.substring(s)),i="% End of PDF Tunebook Features\n",-1!=(s=r.indexOf(i))&&(s+=i.length,r=r.substring(s)),setABCEditorText(t+=r),gIsDirty=!0,gRawMode&&RenderAsync(!0,null)}})}function capitalizeSongName(e){const t=["the","of","and","for","a","an"];return e.split(" ").map((e,n)=>t.includes(e.toLowerCase())&&0!==n?e.toLowerCase():e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}function capitalizeAfterO(e){return e.replace(/(O')([a-z])/g,function(e,t,n){return t+n.toUpperCase()})}function SortTuneSearchResults(e){function t(t){return"X:"+e.split(/^X:/gm)[t+1]}var n=e.split(/(^X:.*$)/gm),o=(n.length-1)/2;if(o<2)return e;var a,l=n[0],r=[];for(a=0;a<o;++a){for(var i=t(a).split("\n"),s=!1,c=0;c<i.length;++c){var g=i[c].trim();if(g.startsWith("T:")){var d=g.slice(2).trim();r.push(d),s=!0;break}}s||r.push("No Title")}var u,m=[],p=0;for(a=0;a<o;++a)null!=n[2*a+1]&&(u=processTitleForSorting(u=r[p]),p++,m.push({title:u,tune:n[2*a+1]+n[2*a+2]}));for(m.sort(customSortTitleWithDiacriticals),e="",e+=l,a=0;a<p;++a)e+=m[a].tune;o=(n=e.split(/(^X:.*$)/gm)).length,l=n[0],e="",e+=l;var h=1;for(a=1;a<o;++a)a%2?(e+="X:"+h,h++):e+=n[a];return e}function searchForTunes(){var e=gTheCurrentTuneDatabase;if(0==e){if(!gTheParsedTuneDatabase){var t=makeCenteredPromptString("Gavin Heneghan tune database still loading...");return void DayPilot.Modal.alert(t,{theme:"modal_flat",top:200})}}else if(!gTheFolkFriendDatabase){t=makeCenteredPromptString("FolkFriend tune database still loading...");return void DayPilot.Modal.alert(t,{theme:"modal_flat",top:200})}var n=document.getElementById("tuneNameToSearch").value;if(gLastTuneSearchValue=n,gLocalStorageAvailable&&(localStorage.LastTuneSearchValue=gLastTuneSearchValue),""!=n){if(n=(n=(n=n.toLowerCase()).replace("'","")).replace('"',""),document.getElementById("search_results").value="",0==e)for(var o=document.getElementById("chords_only").checked,a=document.getElementById("match_title_start").checked,l=document.getElementById("only_first_variation").checked,r=gTheParsedTuneDatabase.length,i="",s=0,c=!1,g=0;g<r&&!c;++g){var d=gTheParsedTuneDatabase[g].info;if(""!=gTheTuneSearchStyle){if(!(D=d.R))continue;if((D=D.toLowerCase())!=gTheTuneSearchStyle)continue}if(x=(x=(x=(x=d.T).toLowerCase()).replace("'","")).replace('"',""),!a&&-1!=x.indexOf(n)||a&&0==x.indexOf(n)){var u=gTheParsedTuneDatabase[g].variations;Object.entries(u).length;for(const[e,t]of Object.entries(u))if(""==gTheTuneSearchKey||-1!=t.indexOf("K: "+gTheTuneSearchKey))if(o){var m=/"[^"]*"/gm;if((k=t.match(m))&&k.length>0){for(const[e,t]of Object.entries(d))i+="X"==e?e+": "+(s+1)+"\n":e+": "+t+"\n";if(i+=t+"\n\n",++s==gTheMaxDatabaseResults){c=!0;break}if(l)break}}else{for(const[e,t]of Object.entries(d))i+="X"==e?e+": "+(s+1)+"\n":e+": "+t+"\n";if(i+=t+"\n\n",++s==gTheMaxDatabaseResults){c=!0;break}if(l)break}}}else{o=document.getElementById("chords_only").checked,a=document.getElementById("match_title_start").checked,l=document.getElementById("only_first_variation").checked;var p=gTheFolkFriendDatabase.settings,h=[];for(let e in p)p.hasOwnProperty(e)&&h.push(e);var f=h.length,b=gTheFolkFriendDatabase.aliases,y=[];for(let e in b)b.hasOwnProperty(e)&&y.push(e);var T=y.length,I=(i="",s=0,c=!1,[]);for(g=0;g<T&&!c;++g){var A=gTheFolkFriendDatabase.aliases[y[g]],S=[];for(let e in A)A.hasOwnProperty(e)&&S.push(e);for(var C=S.length,v=0;v<C&&!c;++v){var x,_=x=A[S[v]];if(x=(x=(x=x.toLowerCase()).replace("'","")).replace('"',""),!a&&-1!=x.indexOf(n)||a&&0==x.indexOf(n)){x=_;for(var B=0;B<f&&!c;++B){var P=gTheFolkFriendDatabase.settings[h[B]];if(""!=gTheTuneSearchStyle){var D;if(!(D=P.dance))continue;if((D=D.toLowerCase())!=gTheTuneSearchStyle)continue}if(P.tune_id==y[g]){if(""!=gTheTuneSearchKey){var w=P.mode;if(!w)continue;if(w!=gTheTuneSearchKey)continue}var E=!0;if(l){for(var F=I.length,M=0;M<F;++M)I[M]==P.tune_id&&(E=!1);I.push(P.tune_id)}if(E)if(o){var k;m=/"[^"]*"/gm;if((k=P.abc.match(m))&&k.length>0){i+="X: "+ ++s+"\n",i+="T: "+capitalizeAfterO(capitalizeSongName(x))+"\n",i+="S: https://thesession.org/tunes/"+P.tune_id+"\n";var R=!1;P.dance&&(i+="R: "+P.dance+"\n","polka"==P.dance&&(R=!0)),P.meter&&(i+="M: "+P.meter+"\n",R&&"2/4"==P.meter&&(i+="L: 1/8\n")),P.mode&&(i+="K: "+P.mode+"\n"),i+=P.abc+"\n\n",s==gTheMaxDatabaseResults&&(c=!0)}}else{i+="X: "+ ++s+"\n",i+="T: "+capitalizeAfterO(capitalizeSongName(x))+"\n",i+="S: https://thesession.org/tunes/"+P.tune_id+"\n";R=!1;P.dance&&(i+="R: "+P.dance+"\n","polka"==P.dance&&(R=!0)),P.meter&&(i+="M: "+P.meter+"\n",R&&"2/4"==P.meter&&(i+="L: 1/8\n")),P.mode&&(i+="K: "+P.mode+"\n"),i+=P.abc+"\n\n",s==gTheMaxDatabaseResults&&(c=!0)}}}}}}}var L=document.getElementById("search_result");L.innerHTML="Search Results:&nbsp;&nbsp;"+s+" found",i=SortTuneSearchResults(i),document.getElementById("search_results").value=i,(L=document.getElementById("search_results")).selectionStart=0,L.selectionEnd=0,isPureDesktopBrowser()?L.focus():L.blur(),L=document.getElementById("add-search-results"),s>0?(L.classList.remove("add-search-results-disabled"),L.classList.add("add-search-results"),L.disabled=!1):(L.classList.remove("add-search-results"),L.classList.add("add-search-results-disabled"),L.disabled=!0)}else{t=makeCenteredPromptString("No Text Entered in the Search Field");DayPilot.Modal.alert(t,{theme:"modal_flat",top:200})}}function addSearchResults(){var e=document.getElementById("search_results"),t=e.selectionStart,n=e.selectionEnd;if(t==n?theSearchResults=e.value:(theSearchResults=e.value.substring(t,n),0==getABCEditorText().length?theSearchResults+="\n":theSearchResults="\n"+theSearchResults+"\n"),theSearchResults&&0!=theSearchResults.length){ProcessAddTune(theSearchResults);var o=document.getElementById("add-search-results");if(o&&(o.value="Results Added to Tunebook!",setTimeout(function(){(o=document.getElementById("add-search-results"))&&(o.value="Add Results to Tunebook")},500)),gIsIOS){const o=document.createElement("input");o.setAttribute("type","text"),o.style.position="absolute",o.style.opacity=0,o.style.height=0,o.style.fontSize="16px",document.body.prepend(o),o.focus(),setTimeout(function(){e.focus(),e.selectionStart=t,e.selectionEnd=n,o.remove()},100)}else setTimeout(function(){e.focus(),e.selectionStart=t,e.selectionEnd=n},100)}else{DayPilot.Modal.alert('<p style="text-align:center;font-size:14pt;font-family:helvetica;">Nothing to Add!</p>',{theme:"modal_flat",top:300,width:700,scrollWithPage:AllowDialogsToScroll()})}}function idleSearchResults(){var e=document.getElementById("search_results").value,t=document.getElementById("add-search-results");e&&e.length>0?(t.classList.remove("add-search-results-disabled"),t.classList.add("add-search-results"),t.disabled=!1):(t.classList.remove("add-search-results"),t.classList.add("add-search-results-disabled"),t.disabled=!0)}function SetTuneSearchMaxResults(){var e=document.getElementById("maxtunesearchresults").value;gTheMaxDatabaseResults=parseInt(e),isNaN(gTheMaxDatabaseResults)&&(gTheMaxDatabaseResults=25)}function SetTuneSearchStyle(){gTheTuneSearchStyle=document.getElementById("tunesearchstyle").value}function SetTuneSearchKey(){gTheTuneSearchKey=document.getElementById("tunesearchkey").value}function wait_for_retry(e){return new Promise(t=>setTimeout(t,e))}function fetchWithRetry(e,t,n,o={}){return fetch(e,o).catch(function(a){if(triesLeft=n-1,!triesLeft)throw a;return wait_for_retry(t).then(()=>fetchWithRetry(e,t,triesLeft,o))})}function SwitchTuneDatabase(){switch(document.getElementById("databaseselect").value){case"0":gTheCurrentTuneDatabase=0,gTheParsedTuneDatabase?document.getElementById("status").innerHTML="&nbsp;&nbsp;&nbsp;Ready to search":(document.getElementById("status").innerHTML="&nbsp;&nbsp;&nbsp;Waiting for tune collection to load...",getTuneDatabase_DB(!1,function(e){e&&e.length>0?(document.getElementById("status")&&(document.getElementById("status").innerHTML="&nbsp;&nbsp;&nbsp;Ready to search"),gTheParsedTuneDatabase=e[0]):fetchWithRetry("https://michaeleskin.com/abctools/abctunes_gavin_heneghan_10nov2023.json",gTuneDatabaseRetryTimeMS,gTuneDatabaseRetryCount).then(e=>e.json()).then(e=>{document.getElementById("status")&&0==gTheCurrentTuneDatabase&&(document.getElementById("status").innerHTML="&nbsp;&nbsp;&nbsp;Ready to search"),gTheParsedTuneDatabase=e,saveTuneDatabase_DB(e,!1)}).catch(function(e){document.getElementById("status")&&0==gTheCurrentTuneDatabase&&(document.getElementById("status").innerHTML="&nbsp;&nbsp;&nbsp;Unable to load tune collection, please retry later...")})})),document.getElementById("search_results").value="",document.getElementById("search_result").innerHTML="Search Results:",idleSearchResults();break;case"1":gTheCurrentTuneDatabase=1,gTheFolkFriendDatabase?document.getElementById("status").innerHTML="&nbsp;&nbsp;&nbsp;Ready to search":(document.getElementById("status").innerHTML="&nbsp;&nbsp;&nbsp;Waiting for tune collection to load...",getTuneDatabase_DB(!0,function(e){e&&e.length>0?(document.getElementById("status")&&(document.getElementById("status").innerHTML="&nbsp;&nbsp;&nbsp;Ready to search"),gTheFolkFriendDatabase=e[0]):fetchWithRetry("https://michaeleskin.com/abctools/folkfriend-non-user-data_22dec2023.json",gTuneDatabaseRetryTimeMS,gTuneDatabaseRetryCount).then(e=>e.json()).then(e=>{document.getElementById("status")&&1==gTheCurrentTuneDatabase&&(document.getElementById("status").innerHTML="&nbsp;&nbsp;&nbsp;Ready to search"),gTheFolkFriendDatabase=e,saveTuneDatabase_DB(e,!0)}).catch(function(e){document.getElementById("status")&&1==gTheCurrentTuneDatabase&&(document.getElementById("status").innerHTML="&nbsp;&nbsp;&nbsp;Unable to load tune collection, please retry later...")})})),document.getElementById("search_results").value="",document.getElementById("search_result").innerHTML="Search Results:",idleSearchResults()}gDefaultTuneDatabase=gTheCurrentTuneDatabase,SaveConfigurationSettings()}var gTheParsedTuneDatabase=null,gTheFolkFriendDatabase=null,gTheCurrentTuneDatabase=0,gTheMaxDatabaseResults=25,gDefaultSearchCollection=0,gTheTuneSearchStyle="",gTheTuneSearchKey="",gLastTuneSearchValue="",gTuneDatabaseRetryTimeMS=3e3,gTuneDatabaseRetryCount=10;function AddFromSearch(e,t){sendGoogleAnalytics("dialog","AddFromSearch"),e&&e.preventDefault(),gTheCurrentTuneDatabase=gDefaultTuneDatabase;var n=window.innerHeight-680;isMobileBrowser()&&(n=window.innerHeight-705);var o='<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">Tune Search Engine&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#tune_search_engine" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>';o+='<p style="font-size:12pt;line-height:24pt;margin-top:20px;margin-bottom:12px;" class="switchtunedatabase">Tune Collection to Search: <select id="databaseselect" onchange="SwitchTuneDatabase();" title="Select your tune search database"><option value="0">Gavin Heneghan\'s Collection (20,000+ Tune Settings)</option><option value="1">FolkFriend.app Collection (45,000+ Tune Settings)</option></select></p>',o+='<p style="font-size:12pt;line-height:24pt;margin-top:0px;margin-bottom:18px;">Search for text in the tune name:&nbsp;&nbsp;<input style="width:100%;font-size:12pt;line-height:18px;padding:6px;" id="tuneNameToSearch" title="Enter your search text here" autocomplete="off" autocorrect="off" placeholder="Enter your search text here"/> </p>',o+='<p class="tunesearchoptions">Only return first variation found?&nbsp;<input id="only_first_variation" type="checkbox" style="margin-top:-5px;margin-bottom:0px;" checked/>&nbsp;&nbsp;&nbsp;Match start of title?&nbsp;<input id="match_title_start" type="checkbox" style="margin-top:-5px;margin-bottom:0px;"/>&nbsp;&nbsp;&nbsp;Only return tunes with chords?&nbsp;<input id="chords_only" type="checkbox" style="margin-top:-5px;margin-bottom:0px;"/></p>',o+='<p class="tunesearchoptionsmax">Tune style:<select id="tunesearchstyle" onchange="SetTuneSearchStyle();" title="Tune style to search" style="margin-top:-7px;width:130px"><option value="">All Tunes</option> <option value="jig">Jigs</option> <option value="reel">Reels</option> <option value="slip jig">Slip Jigs</option> <option value="hornpipe">Hornpipes</option> <option value="polka">Polkas</option> <option value="slide">Slides</option> <option value="waltz">Waltzes</option> <option value="barndance">Barndances</option> <option value="strathspey">Strathspeys</option> <option value="three-two">Three-Twos</option> <option value="mazurka">Mazurkas</option> <option value="march">Marches</option></select>&nbsp;&nbsp;&nbsp;&nbsp;Key:<select id="tunesearchkey" onchange="SetTuneSearchKey();" title="Filter by Key/Mode" style="margin-top:-7px;width:130px;"><option value="">All Keys</option> <option value="Cmajor">C Major</option> <option value="Cdorian">C Dorian</option> <option value="Dmajor">D Major</option> <option value="Dmixolydian">D Mixolydian</option> <option value="Dminor">D Minor</option> <option value="Ddorian">D Dorian</option> <option value="Emajor">E Major</option> <option value="Emixolydian">E Mixolydian</option> <option value="Eminor">E Minor</option> <option value="Edorian">E Dorian</option> <option value="Fmajor">F Major</option> <option value="Fdorian">F Dorian</option> <option value="Gmajor">G Major</option> <option value="Gmixolydian">G Mixolydian</option> <option value="Gminor">G Minor</option> <option value="Gdorian">G Dorian</option> <option value="Amajor">A Major</option> <option value="Amixolydian">A Mixolydian</option> <option value="Aminor">A Minor</option> <option value="Adorian">A Dorian</option> <option value="Bminor">B Minor</option> <option value="Bmixolydian">B Mixolydian</option> <option value="Bdorian">B Dorian</option> </select>&nbsp;&nbsp;&nbsp;&nbsp;Maximum number of results:<select id="maxtunesearchresults" onchange="SetTuneSearchMaxResults();" title="Maximum number of results" style="margin-top:-7px;"><option value="10">10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option></select></p>',o+='<p style="margin-top:10px;font-size:12pt;"> <input class="btn btn-start-search start-search" id="start-search" onclick="searchForTunes();" type="button" value="Search" title="Start search"><span id="status">&nbsp;&nbsp;&nbsp;Waiting for tune collection to load...</span></p>',o+='<div style="margin-bottom: 18px;">',o+='<h4 id="search_result">Search Results:</h4>',o+='<textarea id="search_results" style="font-family:Courier;font-size:13pt;line-height:16pt;width:724px;height:'+n+'px;padding:6px" placeholder="Search results will appear here" spellcheck="false" autocorrect="off" autocapitalize="none" spellcheck="false" oninput="idleSearchResults()"></textarea>',o+='<p style="margin-top:20px;text-align: center;">',isPureDesktopBrowser()?o+="Select text to add or add all text if no selection.&nbsp;&nbsp;Triple-click or Alt-click to select an entire tune.<br/><br/>":o+="Select text to add or add all text if no selection.&nbsp;&nbsp;Click once in a tune to select it.<br/><br/>",o+='<input class="btn btn-add-search-results add-search-results-disabled" id="add-search-results" onclick="addSearchResults();" type="button" value="Add Results to Tunebook" title="Add Results to Tunebook.&nbsp;&nbsp;If there is a text selection, only the selected text will be added, otherwise all the text will be added.">',o+="</p>";var a=800;giPadTwoColumn&&(a=900),DayPilot.Modal.alert(o,{theme:"modal_flat",top:25,width:a,scrollWithPage:AllowDialogsToScroll()}).then(function(){t&&t()}),document.getElementById("maxtunesearchresults").value="25",gTheMaxDatabaseResults=25,document.getElementById("tunesearchstyle").value="",gTheTuneSearchStyle="",document.getElementById("tunesearchkey").value="",gTheTuneSearchKey="",document.getElementById("add-search-results").disabled=!0,document.getElementById("tuneNameToSearch").addEventListener("keydown",function(e){"Enter"===e.key&&(e.stopPropagation(),e.preventDefault(),searchForTunes())}),isPureDesktopBrowser()?document.getElementById("search_results").addEventListener("click",function(e){if(3===e.detail||e.altKey){const o=e.target,a=o.value,l=o.selectionStart;let r=a.lastIndexOf("\nX:",l);-1===r?r=a.indexOf("X:",0):r++;var t=a.indexOf("\n\n",l),n=a.indexOf("X:",l);-1===t&&-1===n?t=a.length:(-1===t||t>=n)&&(t=n),o.setSelectionRange(r,t)}}):document.getElementById("search_results").addEventListener("click",function(e){const t=e.target,n=t.value,o=t.selectionStart;let a=n.lastIndexOf("\nX:",o);-1===a?a=n.indexOf("X:",0):a++;let l=n.indexOf("\n\n",o);-1===l&&(l=n.length),t.setSelectionRange(a,l)}),document.getElementById("databaseselect").value=0==gTheCurrentTuneDatabase?"0":"1",document.getElementById("tuneNameToSearch").value=gLastTuneSearchValue,SwitchTuneDatabase()}function ChangeTuneOrderMobileSelect(e){ChangeTuneOrderCurrent&&ChangeTuneOrderCurrent.classList.remove("draggable_tune_mobile_selected"),ChangeTuneOrderCurrent=e,e.classList.add("draggable_tune_mobile_selected")}function ChangeTuneOrderMobileUp(){if(null==ChangeTuneOrderCurrent)return;var e=ChangeTuneOrderCurrent.previousElementSibling;if(null==e)return;document.getElementById("sortable-tune-list-mobile").insertBefore(ChangeTuneOrderCurrent,e);const t=document.querySelectorAll("#sortable-tune-list-mobile .draggable_tune_mobile");ChangeTuneOrderNewOrder=Array.from(t).map(e=>e.getAttribute("data_tune_index"))}function ChangeTuneOrderMobileDown(){if(null==ChangeTuneOrderCurrent)return;var e=ChangeTuneOrderCurrent.nextElementSibling;if(null==e)return;var t=e;e=e.nextElementSibling;const n=document.getElementById("sortable-tune-list-mobile");null==e?n.insertBefore(t,ChangeTuneOrderCurrent):n.insertBefore(ChangeTuneOrderCurrent,e);const o=document.querySelectorAll("#sortable-tune-list-mobile .draggable_tune_mobile");ChangeTuneOrderNewOrder=Array.from(o).map(e=>e.getAttribute("data_tune_index"))}var ChangeTuneOrderCurrent=null,ChangeTuneOrderOriginalOrder=[],ChangeTuneOrderNewOrder=[];function ChangeTuneOrderMobile(){var e,t=[];ChangeTuneOrderNewOrder=[],ChangeTuneOrderCurrent=null,totalTunes=CountTunes();var n=GetTunebookIndexTitles(),o=n.length;if(0==o){var a="No tunes to reorder.";return a=makeCenteredPromptString(a),void DayPilot.Modal.alert(a,{theme:"modal_flat",top:200,scrollWithPage:!1})}var l='<div id="sortable-tune-list-mobile" style="overflow:auto;height:'+(window.innerHeight-430)+'px;margin-top:18px">';for(e=0;e<o;++e)l+='<div class="draggable_tune_mobile" data_tune_index="'+e+'" onclick="ChangeTuneOrderMobileSelect(this)">'+n[e]+"</div>";var r=[{html:'<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">Change the Order of the Tunes&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#change_tune_order" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:l+="</div>"},{html:'<p style="text-align:center;margin-top:36px;"><input id="mobile_tune_order_up" class="advancedcontrols btn btn-injectcontrols-headers" onclick="ChangeTuneOrderMobileUp(this);" type="button" value="Move Up" title="Moves the currently selected tune up one position"><input id="mobile_tune_order_down" class="advancedcontrols btn btn-injectcontrols-headers" onclick="ChangeTuneOrderMobileDown(this);" type="button" value="Move Down" title="Moves the currently selected tune down one position"></p>'}];setTimeout(function(){const e=document.querySelectorAll("#sortable-tune-list-mobile .draggable_tune_mobile");ChangeTuneOrderNewOrder=Array.from(e).map(e=>e.getAttribute("data_tune_index")),t=ChangeTuneOrderNewOrder.slice()},100);DayPilot.Modal.form(r,{},{theme:"modal_flat",top:25,width:650,scrollWithPage:!1,autoFocus:!1}).then(function(n){if(!n.canceled){var o=!1;for(e=0;e<totalTunes;++e)if(ChangeTuneOrderNewOrder[e]!=t[e]){o=!0;break}if(!o)return;var a="Are you sure you want to change the order of the tunes in your tunebook?";a=makeCenteredPromptString(a),DayPilot.Modal.confirm(a,{top:200,theme:"modal_flat",scrollWithPage:AllowDialogsToScroll()}).then(function(t){if(!t.canceled){var n=FindPreTuneHeader(getABCEditorText());for(e=0;e<totalTunes;++e){var o=getTuneByIndex(parseInt(ChangeTuneOrderNewOrder[e]));o=o.trim(),n+=o+="\n\n"}setABCEditorText(n),gIsDirty=!0,RenderAsync(!0,null,function(){gEnableSyntax?(gTheCM.selectionStart=0,gTheCM.selectionEnd=0,gTheCM.focus()):(gTheABC.selectionStart=0,gTheABC.selectionEnd=0,gTheABC.focus()),MakeTuneVisible(!0)})}})}})}function ChangeTuneOrder(){var e,t=[],n=[];ChangeTuneOrderCurrent=null,totalTunes=CountTunes();var o=GetTunebookIndexTitles(),a=o.length;if(0==a){var l="No tunes to reorder.";return l=makeCenteredPromptString(l),void DayPilot.Modal.alert(l,{theme:"modal_flat",top:200,scrollWithPage:!1})}var r='<div id="sortable-tune-list" style="overflow:auto;height:'+(window.innerHeight-380)+'px;margin-top:18px">';for(e=0;e<a;++e)r+='<div class="draggable_tune" draggable="true" data_tune_index="'+e+'">'+o[e]+"</div>";var i=[{html:'<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">Change the Order of the Tunes&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#change_tune_order" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="margin-top:18px;font-size:12pt;">Drag and drop the tune names to change the order of the tunes in the tunebook:</p>'},{html:r+="</div>"}];setTimeout(function(){const e=document.querySelectorAll("#sortable-tune-list .draggable_tune");n=Array.from(e).map(e=>e.getAttribute("data_tune_index")),t=n.slice()},100);DayPilot.Modal.form(i,{},{theme:"modal_flat",top:25,width:650,scrollWithPage:!1,autoFocus:!1}).then(function(o){if(!o.canceled){var a=!1;for(e=0;e<totalTunes;++e)if(n[e]!=t[e]){a=!0;break}if(!a)return;var l="Are you sure you want to change the order of the tunes in your tunebook?";l=makeCenteredPromptString(l),DayPilot.Modal.confirm(l,{top:200,theme:"modal_flat",scrollWithPage:!1}).then(function(t){if(!t.canceled){var o=FindPreTuneHeader(getABCEditorText());for(e=0;e<totalTunes;++e){var a=getTuneByIndex(parseInt(n[e]));a=a.trim(),o+=a+="\n\n"}setABCEditorText(o),gIsDirty=!0,RenderAsync(!0,null,function(){gEnableSyntax?(gTheCM.selectionStart=0,gTheCM.selectionEnd=0,gTheCM.focus()):(gTheABC.selectionStart=0,gTheABC.selectionEnd=0,gTheABC.focus()),MakeTuneVisible(!0)})}})}});const s=document.getElementById("sortable-tune-list");let c=null;s.addEventListener("click",function(e){var t=e.target;t.classList&&t.classList.contains("draggable_tune")&&(c=t,ChangeTuneOrderCurrent&&ChangeTuneOrderCurrent.classList.remove("draggable_tune_selected"),ChangeTuneOrderCurrent=c,c.classList.add("draggable_tune_selected"))}),s.addEventListener("dragstart",function(e){c=e.target,e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",c.innerHTML),ChangeTuneOrderCurrent&&ChangeTuneOrderCurrent.classList.remove("draggable_tune_selected"),ChangeTuneOrderCurrent=c,c.classList.add("draggable_tune_selected")}),s.addEventListener("dragover",function(e){e.preventDefault();const t=e.target;if(t&&t!==c&&t.classList.contains("draggable_tune")){const o=t.getBoundingClientRect(),a=(e.clientY-o.top)/(o.bottom-o.top)>.5;s.insertBefore(c,a?t.nextElementSibling:t);const l=document.querySelectorAll("#sortable-tune-list .draggable_tune");n=Array.from(l).map(e=>e.getAttribute("data_tune_index"))}}),s.addEventListener("dragend",function(){c=null})}function CullTunesUpdateKeepList(){CullTunesKeepList=[];const e=document.querySelectorAll("#cullable-tune-list .cullable_tune");Array.from(e).map(e=>{e.classList.contains("cull_selected")?CullTunesKeepList.push(0):CullTunesKeepList.push(1)})}function CullToggleSelection(e){e.classList.toggle("cull_selected"),CullTunesUpdateKeepList()}function CullSelectAll(){const e=document.querySelectorAll("#cullable-tune-list .cullable_tune");Array.from(e).map(e=>e.classList.add("cull_selected")),CullTunesUpdateKeepList()}function CullClearSelection(){const e=document.querySelectorAll("#cullable-tune-list .cullable_tune");Array.from(e).map(e=>e.classList.remove("cull_selected")),CullTunesUpdateKeepList()}var CullTunesKeepList=[];function CullTunes(){var e;CullTunesKeepList=[],totalTunes=CountTunes();var t=GetTunebookIndexTitles(),n=t.length;if(0==n){var o="No tunes to delete.";return o=makeCenteredPromptString(o),void DayPilot.Modal.alert(o,{theme:"modal_flat",top:200,scrollWithPage:!1})}var a='<div id="cullable-tune-list" style="overflow:auto;height:'+(window.innerHeight-410)+'px;margin-top:18px">';for(e=0;e<n;++e)a+='<div class="cullable_tune" onclick="CullToggleSelection(this)">'+t[e]+"</div>";var l=[{html:'<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">Delete Selected Tunes&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#delete_selected_tunes" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:a+="</div>"},{html:'<p style="text-align:center;margin-top:36px;"><input id="cull_select_all" class="advancedcontrols btn btn-injectcontrols-headers" onclick="CullSelectAll();" type="button" value="Select All" title="Selects all the tunes for deletion"><input id="cull_clear_selection" class="advancedcontrols btn btn-injectcontrols-headers" onclick="CullClearSelection();" type="button" value="Clear Selection" title="Unselects all the tunes for deletion"></p>'}];DayPilot.Modal.form(l,{},{theme:"modal_flat",top:25,width:650,scrollWithPage:!1,autoFocus:!1,okText:"Delete"}).then(function(t){if(!t.canceled){var n=CullTunesKeepList.length,o=0;for(e=0;e<n;++e)0==CullTunesKeepList[e]&&(bGotChange=!0,o++);if(o){var a="Are you sure you want to delete "+o;a=makeCenteredPromptString(a+=1==o?" tune from your tunebook?":" tunes from your tunebook?"),DayPilot.Modal.confirm(a,{top:200,theme:"modal_flat",scrollWithPage:!1}).then(function(t){if(!t.canceled){var n=FindPreTuneHeader(getABCEditorText());for(e=0;e<totalTunes;++e)if(1==CullTunesKeepList[e]){var o=getTuneByIndex(e);o=o.trim(),n+=o+="\n\n"}setABCEditorText(n),gIsDirty=!0,RenderAsync(!0,null,function(){gEnableSyntax?(gTheCM.selectionStart=0,gTheCM.selectionEnd=0,gTheCM.focus()):(gTheABC.selectionStart=0,gTheABC.selectionEnd=0,gTheABC.focus()),MakeTuneVisible(!0)})}})}}})}function removeExtraTags(e,t){let n=e.split("\n"),o=!1;return t+=":",n=n.filter(e=>e.startsWith(t)?!o&&(o=!0,!0):""!==e.trim()),n.join("\n")}function removeAllTags(e,t){let n=e.split("\n");return t+=":",n=n.filter(e=>!e.startsWith(t)&&""!==e.trim()),n.join("\n")}function generateIndexedRepeatedString(e,t,n){let o=[];for(let a=0;a<t&&a<e.length;a++)o.push(`${e[a].repeat(n)}`);return o.join("")}function processTuneSet(e,t,n,o,a){var l=t.join(" / "),r=e.split(/\r?\n/).filter(e=>""!==e.trim()),i=!1,s="ABCDEFGHIJKLMNOPQRSTUVWXYZ",c=1;if(n)var g=generateIndexedRepeatedString(s,t.length,o);return e=removeAllTags(e=r.map(e=>e.startsWith("X:")?i?n?a?"%\n% Put some space before the next tune\n%%text\n%\nP:"+s[c++]+"\n%":"%\n%%text\n%\nP:"+s[c++]+"\n%":a?"%\n% Put some space before the next tune\n%%text\n%":"%\n%%text\n%":(i=!0,a?(e=e+"\n%\n% Title and subtitle fonts\n%%titlefont "+gRenderingFonts.titlefont+"\n%%subtitlefont "+gRenderingFonts.titlefont+"\n%\n% Tune set title\nT:"+l+"\n%\n% If you delete the tune set title T tag, delete the next line\n%hide_first_title_on_play\n%\n% Hide the rhythm tag\n%hide_rhythm_tag\n%\n% Hide cautionary key signatures\n%hide_cautionary_ks\n%\n% Hide any vskip space in the Player\n%hide_vskip_on_play\n%\n% To fit the set on a PDF page, increase the staffwidth value.\n% 850 often works for a set of three four-stave tunes.\n%\n%%staffwidth 556\n%\n% Last measure fills the staff width\n%%stretchlast true\n%\n",n&&(e=e+"% Expand the parts in the Player\n%play_flatten_parts\n%\n% Remove the x from the start of the next line to always hide all\n% P tag text in the notation and the Player.\n% Even if the P tags are hidden, the tunes will play multiple times.\n%xhide_part_tags\n%\n% Delete the next line to show the P tag text in the Player.\n% If %hide_parts_tags is present above, it takes precedence.\n%hide_player_part_tags\n%\n% Parts play order\nP:"+g+"\n%\nP:A\n%")):(e=e+"\n%\n%%titlefont "+gRenderingFonts.titlefont+"\n%%subtitlefont "+gRenderingFonts.titlefont+"\n%\nT:"+l+"\n%\n%hide_first_title_on_play\n%hide_rhythm_tag\n%hide_cautionary_ks\n%hide_vskip_on_play\n%%staffwidth 556\n%%stretchlast true\n%\n",n&&(e=e+"%play_flatten_parts\n%xhide_part_tags\n%hide_player_part_tags\n%\nP:"+g+"\n%\nP:A\n%")),e):e).join("\n"),"C"),e=removeAllTags(e,"A"),e=removeAllTags(e,"O"),e=removeAllTags(e,"Z"),e=removeAllTags(e,"N"),e=removeAllTags(e,"B"),e=removeAllTags(e,"S"),e=removeAllTags(e,"I"),e=removeAllTags(e,"D"),e=removeAllTags(e,"W"),e=removeAllTags(e,"w"),e+=a?"\n%\n% Put some space before the next tune\n%%text\n\n":"\n%\n%%text\n\n"}function BuildTuneSetToggleSelection(e){e.classList.toggle("tuneset_selected");const t=BuildTuneSetSelectionOrder.indexOf(e);e.classList.contains("tuneset_selected")?-1===t&&BuildTuneSetSelectionOrder.push(e):-1!==t&&BuildTuneSetSelectionOrder.splice(t,1),updateTuneSelectionNumbers()}function updateTuneSelectionNumbers(){document.querySelectorAll("#tuneset-tune-list .tuneset_tune").forEach(e=>{const t=e.querySelector(".tuneset-selection-number");t&&e.removeChild(t)}),BuildTuneSetSelectionOrder.forEach((e,t)=>{let n=document.createElement("span");n.className="tuneset-selection-number",n.textContent=` ${t+1}`,e.appendChild(n)})}function BuildTuneSetSelectAll(){const e=document.querySelectorAll("#tuneset-tune-list .tuneset_tune");BuildTuneSetSelectionOrder=[],Array.from(e).forEach(e=>{e.classList.add("tuneset_selected"),BuildTuneSetSelectionOrder.push(e)}),updateTuneSelectionNumbers()}function BuildTuneSetOpen(e){var t=!1,n=1,o=!0,a=document.querySelector("input[name=repeat_enable]");a&&(t=a.checked),BuildTuneSetRepeat=t,(a=document.querySelector("input[name=repeat_count]"))&&(n=a.value),n=parseInt(n),isNaN(n)&&(n=1),n<1&&(n=1),BuildTuneSetRepeatCount=n,(a=document.querySelector("input[name=is_verbose]"))&&(o=a.checked),BuildTuneSetVerbose=o,SaveConfigurationSettings(),1==n&&(t=!1);var l=BuildTuneSetSelectionOrder.length;if(0===l){var r="No tunes selected for the set.";return r=makeCenteredPromptString(r),void DayPilot.Modal.alert(r,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})}var s=getABCEditorText(),c="",g=[];for(i=0;i<BuildTuneSetSelectionOrder.length;++i){const e=BuildTuneSetSelectionOrder[i].textContent.trim().replace(/\s+\d+$/,""),t=GetTunebookIndexTitles().indexOf(e);if(-1!==t){c+=getTuneByIndex(t).trim()+"\n\n",g.push(e)}}c=processTuneSet(c,g,t,n,o);g.join(" / ");if(l){sendGoogleAnalytics("action","TuneSetNewTab");var d=FindPreTuneHeader(s);(d=d.trim()).length>0&&(d+="\n\n"),c=c.trim();var u=FillUrlBoxWithAbcInLZW(d+=c+="\n",!1);if((u+=e?"&editor=1":"&play=1").length>=8100)return void DayPilot.Modal.alert('<p style="text-align:center;font-family:helvetica;font-size:12pt;">The Share URL for the tune set is too long to open in a new tab.</p>',{theme:"modal_flat",top:230,scrollWithPage:AllowDialogsToScroll()});window.open(u)}else;}function BuildTuneSetAppend(){var e=!1,t=1,n=!0,o=document.querySelector("input[name=repeat_enable]");o&&(e=o.checked),BuildTuneSetRepeat=e,(o=document.querySelector("input[name=repeat_count]"))&&(t=o.value),t=parseInt(t),isNaN(t)&&(t=1),t<1&&(t=1),BuildTuneSetRepeatCount=t,(o=document.querySelector("input[name=is_verbose]"))&&(n=o.checked),BuildTuneSetVerbose=n,SaveConfigurationSettings(),1==t&&(e=!1);var a=BuildTuneSetSelectionOrder.length;if(0===a)return g=makeCenteredPromptString(g="No tunes selected for the set."),void DayPilot.Modal.alert(g,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});var l=getABCEditorText(),r="",s=[];for(i=0;i<BuildTuneSetSelectionOrder.length;++i){const e=BuildTuneSetSelectionOrder[i].textContent.trim().replace(/\s+\d+$/,""),t=GetTunebookIndexTitles().indexOf(e);if(-1!==t){const n=getTuneByIndex(t).trim()+"\n\n";r+=n,s.push(e)}}r=processTuneSet(r,s,e,t,n);var c=s.join(" / ");if(a){var g="Are you sure you want to create a set:<br/><br/>"+c+"<br/><br/>";g+=1==a?" from the 1 tune in your tunebook<br/><br/>":" from the "+a+" tunes in your tunebook?<br/><br/>",g=makeCenteredPromptString(g+="The set will be added to the end of the ABC."),DayPilot.Modal.confirm(g,{top:200,theme:"modal_flat",scrollWithPage:AllowDialogsToScroll()}).then(function(e){if(!e.canceled){sendGoogleAnalytics("action","TuneSetAppend"),setABCEditorText(l=l.trim()+"\n\n"+r);const e=window.scrollY||document.documentElement.scrollTop;gIsDirty=!0,RenderAsync(!0,null,function(){AllowDialogsToScroll()&&window.scrollTo(0,e);getTuneByIndex(totalTunes);var t=l.length-r.length;if(gIsMaximized){if(ScrollABCTextIntoView(gTheABC,t,t,10),isMobileBrowser())return void gTheABC.blur();gTheABC.blur(),gTheABC.focus()}else if(gEnableSyntax){if(ScrollABCTextIntoView(gTheCM,t,t,10),isMobileBrowser())return void gTheCM.getInputField().blur();gTheCM.getInputField().blur(),gTheCM.focus()}AllowDialogsToScroll()||MakeTuneVisible(!0)})}})}}function BuildTuneSetClearSelection(){const e=document.querySelectorAll("#tuneset-tune-list .tuneset_tune");Array.from(e).map(e=>e.classList.remove("tuneset_selected")),BuildTuneSetSelectionOrder=[],updateTuneSelectionNumbers()}function filterTuneSetList(){const e=document.getElementById("tuneset-search").value.toLowerCase(),t=document.querySelectorAll("#tuneset-tune-list .tuneset_tune"),n=document.getElementById("tuneset-search-clear");t.forEach(t=>{const n=t.textContent.toLowerCase();t.style.display=n.includes(e)?"":"none"}),n&&(n.style.display=e?"block":"none")}var BuildTuneSetSelectionOrder=[],BuildTuneSetRepeat=!1,BuildTuneSetRepeatCount=1,BuildTuneSetVerbose=!0;function BuildTuneSet(){var e;BuildTuneSetSelectionOrder=[],totalTunes=CountTunes();var t=GetTunebookIndexTitles(),n=t.length;if(0==n){var o="No tunes to create a set from.";return o=makeCenteredPromptString(o),void DayPilot.Modal.alert(o,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})}var a={repeat_enable:BuildTuneSetRepeat,repeat_count:BuildTuneSetRepeatCount,is_verbose:BuildTuneSetVerbose},l='<div style="margin-bottom:10px;text-align:center;position:relative;width:90%;margin-left:auto;margin-right:auto;"> <input id="tuneset-search" type="text" placeholder="Filter by text..." style="width:100%;padding:6px 28px 6px 6px;font-size:12pt;"> <span id="tuneset-search-clear" style="position:absolute;right:8px;top:50%;transform:translateY(-50%);cursor:pointer;font-size:14pt;color:#888;display:none;" title="Clear filter and show all tunes"> ❌ </span> </div><div id="tuneset-tune-list" style="overflow:auto;height:'+(window.innerHeight-670)+'px;margin-top:12px;margin-bottom:18px;">';for(e=0;e<n;++e)l+='<div class="tuneset_tune" onclick="BuildTuneSetToggleSelection(this)">'+t[e]+"</div>";var r=[{html:'<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">Create Tune Set&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#hamburger_create_tune_set" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="margin-top:8px;margin-bottom:12px;font-size:12pt;line-height:18pt;font-family:helvetica">Select the tunes you want in a tune set, then choose one of the three actions below:</p>'},{html:'<p style="text-align:center;margin-top:14px;"><input id="tuneset_select_all" class="advancedcontrols btn btn-injectcontrols-headers" onclick="BuildTuneSetSelectAll();" type="button" value="Select All" title="Selects all the tunes for set creation"><input id="tuneset_clear_selection" class="advancedcontrols btn btn-injectcontrols-headers" onclick="BuildTuneSetClearSelection();" type="button" value="Clear Selection" title="Unselects all the tunes for set creation"></p>'},{html:l+="</div>"},{name:"          Include verbose annotation descriptions",id:"is_verbose",type:"checkbox",cssClass:"create_tune_set_text_checkbox"},{name:"          Repeat each tune in the set when played",id:"repeat_enable",type:"checkbox",cssClass:"create_tune_set_text_checkbox"},{name:"Repeat count:",id:"repeat_count",type:"number",cssClass:"create_tune_set_text"},{html:'<p style="text-align:center;margin-top:18px;margin-bottom:20px"><input id="tuneset_open_in_player" style="margin-right:18px;" class="advancedcontrols btn btn-tuneset-inject" onclick="BuildTuneSetOpen(false);" type="button" value="Open in New Tab in Player" title="Opens the tune set in a new tab in the Player"><input id="tuneset_open_in_editor" style="margin-right:18px;" class="advancedcontrols btn btn-tuneset-inject" onclick="BuildTuneSetOpen(true);" type="button" value="Open in New Tab in Editor" title="Opens the tune set in a new tab in the Editor"><input id="tuneset_append_to_abc" class="advancedcontrols btn btn-tuneset-inject" onclick="BuildTuneSetAppend();" type="button" value="Append to ABC" title="Appends the tune set to the current ABC"></p>'}];setTimeout(()=>{const e=document.getElementById("tuneset-search"),t=document.getElementById("tuneset-search-clear");e&&(e.addEventListener("input",filterTuneSetList),e.focus()),t&&t.addEventListener("click",()=>{e.value="",filterTuneSetList(),e.focus()})},200);DayPilot.Modal.form(r,a,{theme:"modal_flat",top:25,width:700,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(e){if(!e.canceled){var t=e.result.repeat_enable;BuildTuneSetRepeat=t;var n=e.result.is_verbose;BuildTuneSetVerbose=n;var o=e.result.repeat_count;return o=parseInt(o),isNaN(o)&&(o=1),o<1&&(o=1),BuildTuneSetRepeatCount=o,void SaveConfigurationSettings()}})}var gAddABCOKButton=null;function Configure_AddABC_UI(){var e=gFeaturesShowSearch,t=gFeaturesShowExamples,n=gFeaturesShowTemplates;const o={showsearch:gFeaturesShowSearch,showexampletunes:gFeaturesShowExamples,showexampletemplates:gFeaturesShowTemplates};DayPilot.Modal.form([{html:'<p style="text-align:center;font-size:14pt;font-family:helvetica;margin-left:15px;">Select Add ABC Feature Options</p>'},{name:"          Show Search and Add Tunes",id:"showsearch",type:"checkbox",cssClass:"configure_ui_options_form_text"},{name:"          Show Example Tunes",id:"showexampletunes",type:"checkbox",cssClass:"configure_ui_options_form_text"},{name:"          Show Example Templates",id:"showexampletemplates",type:"checkbox",cssClass:"configure_ui_options_form_text"}],o,{theme:"modal_flat",top:100,width:500,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(o){if(!o.canceled){if(gFeaturesShowSearch=o.result.showsearch,gFeaturesShowExamples=o.result.showexampletunes,gFeaturesShowTemplates=o.result.showexampletemplates,gFeaturesShowSearch==e&&gFeaturesShowExamples==t&&gFeaturesShowTemplates==n)return;SaveConfigurationSettings(),gAddABCOKButton.click(),setTimeout(function(){AddABC()},250)}})}function AddABCCallback(){gAddABCOKButton&&gAddABCOKButton.click()}function AddABC(){sendGoogleAnalytics("dialog","AddABC");var e='<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">Add ABC Tunes, Templates, and PDF Features&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#add_templates_dialog" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span><img id="moreaddabcsettings" class="moreaddabcsettings moresettingsbutton" src="img/settings.png" title="Add ABC Settings" onclick="Configure_AddABC_UI()"></img></p>';e+='<div id="add-new-tune-dialog">',e+='<p style="text-align:center;margin-top:28px;font-size:18px;">Add Your Own Tunes from ABC, MusicXML, BWW, or MIDI Files</p>',e+='<p style="text-align:center;margin-top:16px;">',e+='<label class="abcuploaddialog btn btn-top" for="addabcfilebutton" title="Adds tunes from an existing ABC, MusicXML, BWW, or MIDI file to the end of the ABC">Choose Files to Add <input type="file" id="addabcfilebutton" accept=".abc,.txt,.ABC,.TXT,.xml,.XML,.musicxml,.mxl,.MXL,.mid,.MID,.midi,.MIDI,.bww,.BWW" hidden multiple/></label>',e+='<input class="dialogrestorebutton btn btn-restorebutton" id="dialogrestorebutton" onclick="RestoreSnapshot(event,false,true);" type="button" value="Restore from Snapshot" title="Replaces the contents of the ABC editor with a Snapshot saved in browser storage.&nbsp;&nbsp;Click for Snapshot #1, Shift-click for Snapshot #2, Alt-click for Snapshot #3, Shift-Alt-click for Snapshot #4." style="display:none;">',e+='<input class="dialogrestoreautobutton btn btn-restorebutton" id="dialogrestoreautobutton" onclick="RestoreSnapshot(event,true,true);" type="button" value="Restore from Auto-Snapshot" title="Replaces the contents of the ABC editor with an Auto-Snapshot saved in browser storage" style="display:none;">',e+="</p>",gFeaturesShowSearch&&(e+='<p style="text-align:center;font-size:18px;margin-top:24px;">Search and Add Tunes (Over 65,000 Tunes Available)</p>',e+='<p style="text-align:center;margin-top:16px;">',e+='<input id="searchandaddtunes" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AddFromSearch(null,AddABCCallback);" type="button" value="Tune Search Engine" title="Search for tunes to add to your tunebook.&nbsp;&nbsp;Over 65,000 tunes available.">'),e+='<p style="text-align:center;font-size:18px;margin-top:24px;">Change the Order or Delete Tunes</p>',e+='<p style="text-align:center;margin-top:16px;">',isPureDesktopBrowser()?e+='<input id="changetuneorder" class="advancedcontrols btn btn-injectcontrols-headers" onclick="ChangeTuneOrder();" type="button" value="Change the Order of the Tunes" title="Change the order of the tunes">':e+='<input id="changetuneorder" class="advancedcontrols btn btn-injectcontrols-headers" onclick="ChangeTuneOrderMobile();" type="button" value="Change the Order of the Tunes" title="Change the order of the tunes">',e+='<input id="culltunes" class="advancedcontrols btn btn-injectcontrols-headers" onclick="CullTunes();" type="button" value="Delete Tunes from the Tunebook" title="Delete selected tunes from the tunebook">',e+="</p>",gFeaturesShowExamples&&(e+='<p style="text-align:center;font-size:18px;margin-top:24px;">Add an Example ABC Tune</p>',e+='<p style="text-align:center;margin-top:16px;">',e+='<input id="addnewreel" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AppendSampleReel();" type="button" value="Cooley\'s (reel)" title="Adds an example reel (Cooley\'s) to the end of the ABC">',e+='<input id="addnewjig" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AppendSampleJig();" type="button" value="The Kesh (jig)" title="Adds an example jig (The Kesh) to the end of the ABC">',e+='<input id="addnewhornpipe" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AppendSampleHornpipe();" type="button" value="Alexander\'s (hornpipe)" title="Adds an example Hornpipe (Alexander\'s) to the end of the ABC">',e+="</p>"),gFeaturesShowTemplates&&(e+='<p style="text-align:center;margin-top:24px;font-size:18px;">Add an ABC Template</p>',e+='<p style="text-align:center;margin-top:16px;">',e+='<input id="addnewtunetemplate" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AppendTuneTempate();" type="button" value="Add a Tune Template" title="Adds a tune template to the end of the ABC">',e+='<input id="addsongtemplate" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AppendSongTemplate();" type="button" value="Add a Song Template" title="Adds a minimal song template to the end of the ABC">',e+='<input id="addnewsong" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AppendSampleSong();" type="button" value="Add an Example Song" title="Adds an example song to the end of the ABC">',e+="</p>",e+='<p style="text-align:center;margin-top:16px;">',e+='<input id="addbodhrantemplate" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AddBodhranTemplate();" type="button" value="Add Bodhran Backing Track Template" title="Opens a dialog where you can choose a bodhran backing track template of common tune styles to add to the end of the ABC">',e+='<input id="addpdfannotationstemplate" class="advancedcontrols btn btn-injectcontrols-headers" style="margin-right:24px;" onclick="AddPDFAnnotationsTemplate(event);" type="button" value="Add PDF Tunebook Features Template" title="Adds a template that contains the most common PDF tunebook export feature annotations">',e+="</p>"),e+='<p style="text-align:center;margin-top:24px;font-size:18px;">Inject PDF Tunebook Features</p>',e+='<p style="text-align:center;margin-top:24px;"><input id="tunebookbuilder-add-play" class="advancedcontrols btn btn-injectcontrols-tunebookbuilder-play" onclick="PDFTunebookBuilderPlayOnly();" type="button" value="Inject Only PDF Tunebook Play Features" title="Inject only minimal playback-related instrument and volume commands at the top of your tunebook ABC"><input id="tunebookbuilder_add" class="advancedcontrols btn btn-injectcontrols-tunebookbuilder" onclick="PDFTunebookBuilder();" type="button" value="Inject All PDF Tunebook Features" title="Inject commands at the top of your tunebook ABC for adding a Title Page, Table of Contents, Index, Page Headers, Page Footers, instruments and volumes for Playback Links, and Custom QR Code"></p>',e+='<p style="text-align:center;margin-top:24px;">',e+="</p>",e+="</div>",setTimeout(function(){idleAddABC()},25),DayPilot.Modal.alert(e,{theme:"modal_flat",top:25,width:730,scrollWithPage:!1}).then(function(){})}function AddBodhranTemplate(){DayPilot.Modal.alert('<p style="text-align:center;margin-bottom:36px;font-size:16pt;font-family:helvetica;margin-left:15px;">Add Bodhran Backing Track Tune Template&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#bodhran_map" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p><p style="text-align:center;"><input id="bodhranreel" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AddBodhranReelTemplate()" type="button" value="Add Reel Template" title="Adds a reel bodhran template to the end of the ABC"><input id="bodhranjig" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AddBodhranJigTemplate()" type="button" value="Add Jig Template" title="Adds a jig bodhran template to the end of the ABC"></p><p style="text-align:center;margin-top:24px;"><input id="bodhranslipjig" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AddBodhranSlipJigTemplate()" type="button" value="Add Slip Jig Template" title="Adds a slip jig bodhran template to the end of the ABC"><input id="bodhranslide" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AddBodhranSlideTemplate()" type="button" value="Add Slide Template" title="Adds a slide bodhran template to the end of the ABC"></p><p style="text-align:center;margin-top:24px;"><input id="bodhranhornpipe" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AddBodhranHornpipeTemplate()" type="button" value="Add Hornpipe Template" title="Adds a hornpipe bodhran template to the end of the ABC"><input id="bodhranpolka" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AddBodhranPolkaTemplate()" type="button" value="Add Polka Template" title="Adds a polka bodhran template to the end of the ABC"></p>',{theme:"modal_flat",top:200,width:650,scrollWithPage:AllowDialogsToScroll()})}function AddBodhranReelTemplate(){sendGoogleAnalytics("action","AddBodhranReelTemplate");var e="";CountTunes()>0&&(e+="\n"),e+="X:1\n",e+="T:Reel Bodhran Template\n",e+="R:Reel\n",e+="M:4/4\n",e+="L:1/8\n",e+="Q:1/2=90\n",e+="% Change this to match the key of the tune:\n",e+="K:C\n",e+="%%staffsep 50\n",e+="%soundfont fatboy\n",e+="%swing 0.15\n",e+="%\n",e+="% This template uses two voices:\n",e+="% Voice 1 - Melody\n",e+="% Voice 2 - Bodhran backing track\n",e+="%\n",e+="% Melody voice definition:\n",e+="%\n",e+="V:1\n",e+="%%MIDI program 0\n",e+="%\n",e+="% Bodhran voice definition:\n",e+="%\n",e+="V:2 transpose=-24\n",e+="%%MIDI program 117\n",e+="%\n",e+="% Set the Bodhran tuning\n",e+="% Valid values are:\n",e+="% C, C#, Db, D, D#, Eb, E, F, F#, Gb, G, G#, Ab, A, A#, Bb, or B.\n",e+="%\n",e+="%bodhran_tuning A\n",e+="%\n",e+="% Voice 1 - Replace this with your Reel melody:\n",e+="%\n",e+="V:1\n",e+="|: z8 | z8 | z8 | z8 |\n",e+="   z8 | z8 | z8 | z8 :|\n",e+="|: z8 | z8 | z8 | z8 |\n",e+="   z8 | z8 | z8 | z8 :|\n",e+="|: z8 | z8 | z8 | z8 |\n",e+="   z8 | z8 | z8 | z8 :|\n",e+="|: z8 | z8 | z8 | z8 |\n",e+="   z8 | z8 | z8 | z8 :|\n",e+="%\n",e+="% Voice 2 - Bodhran backing patterns:\n",e+="%\n",e+="V:2\n",e+="|: =C,C,=F,C,  C,C,F,C, | =C,C,=F,C, C,C,F,C, | =C,C,=F,C, C,C,F,C, | =C,C,=F,C, C,C,F,C, |\n",e+="   =C,C,=F,C,  C,C,F,C, | =C,C,=F,C, C,C,F,C, | =C,C,=F,C, C,C,F,C, | =C,C,!>!=F,/E,/D, !>!F,4 :|\n",e+="|: ^d2AA ^F=G^GA | ^A2=AA ^A2=AA | ^A=CCC CCA2 | ^A=CCC ^A2=AA |\n",e+="   ^d2AA ^F=G^GA | ^A2=AA ^A2=AA | ^A=CCC CCA2 | ^A=CCC ^A2=AA :|\n",e+="|: ^d2AA B2AA | ^A=C=FC ACFC | =G/G/G GA ^G2^AA | ^d^A=AA =G2AA |\n",e+="   ^d2AA B2AA | ^A=C=FC ACFC | =G/G/G GA ^G2^AA | ^d^A=AA =G2AA :| \n",e+="|: ^d=CCe DD=f^D | ^A=C=FC ^A2=AA | A3d =c2AA | =G^GAA e2GG |\n",ProcessAddTune(e+="   ^d=CCe DD=f^D | ^A=C=FC ^A2=AA | A3d =c2AA | =G^GAA e2GG :|\n")}function AddBodhranJigTemplate(){sendGoogleAnalytics("action","AddBodhranJigTemplate");var e="";CountTunes()>0&&(e+="\n"),e+="X:1\n",e+="T:Jig Bodhran Template\n",e+="R:Jig\n",e+="M:6/8\n",e+="L:1/8\n",e+="Q:3/8=120\n",e+="% Change this to match the key of the tune:\n",e+="K:C\n",e+="%%staffsep 50\n",e+="%soundfont fatboy\n",e+="%swing 0.25\n",e+="%\n",e+="% This template uses two voices:\n",e+="% Voice 1 - Melody\n",e+="% Voice 2 - Bodhran backing track\n",e+="%\n",e+="% Melody voice definition:\n",e+="%\n",e+="V:1\n",e+="%%MIDI program 0\n",e+="%\n",e+="% Bodhran voice definition:\n",e+="%\n",e+="V:2 transpose=-24\n",e+="%%MIDI program 117\n",e+="%\n",e+="% Set the Bodhran tuning\n",e+="% Valid values are:\n",e+="% C, C#, Db, D, D#, Eb, E, F, F#, Gb, G, G#, Ab, A, A#, Bb, or B.\n",e+="%\n",e+="%bodhran_tuning A\n",e+="%\n",e+="% Voice 1 - Replace this with your Jig melody:\n",e+="%\n",e+="V:1\n",e+="|: z6 | z6 | z6 | z6 |\n",e+="   z6 | z6 | z6 | z6 :|\n",e+="|: z6 | z6 | z6 | z6 |\n",e+="   z6 | z6 | z6 | z6 :|\n",e+="|: z6 | z6 | z6 | z6 |\n",e+="   z6 | z6 | z6 | z6 :|\n",e+="%\n",e+="% Voice 2 - Bodhran backing patterns:\n",e+="%\n",e+="V:2\n",e+="|: =F,zD, F,=C,C, | =F,zD, F,=C,C, | =F,zD, F,=C,C, | =F,zD, F,=C,C, |\n",e+="   =F,zD, F,=C,C, | =F,zD, F,=C,C, | =F,zD, F,=C,C, | =F,=C,C, !>!F,3 :|\n",e+="|: ^d=CC =FCC | ^d2=C AEA | ^A2=C =FCC|^d=CC AEA |\n",e+="   ^d=CC =FCC | ^d2=C AEA | ^A2=C =FCC|^d=CC AEA :|\n",e+="|: ^d=CC =F/F/FC | ^A2d =F=C=A | d=c/=B/^A ^d=C=F | AEE d3 |\n",ProcessAddTune(e+="   ^d=CC =F/F/FC | ^A2d =F=C=A | d=c/=B/^A ^d=C=F | AEE d3 :| \n")}function AddBodhranSlipJigTemplate(){sendGoogleAnalytics("action","AddBodhranSlipJigTemplate");var e="";CountTunes()>0&&(e+="\n"),e+="X:1\n",e+="T:Slip Jig Bodhran Template\n",e+="R:Slip Jig\n",e+="M:9/8\n",e+="L:1/8\n",e+="Q:3/8=120\n",e+="% Change this to match the key of the tune:\n",e+="K:C\n",e+="%%staffsep 50\n",e+="%soundfont fatboy\n",e+="%swing 0.25\n",e+="%\n",e+="% This template uses two voices:\n",e+="% Voice 1 - Melody\n",e+="% Voice 2 - Bodhran backing track\n",e+="%\n",e+="% Melody voice definition:\n",e+="%\n",e+="V:1\n",e+="%%MIDI program 0\n",e+="%\n",e+="% Bodhran voice definition:\n",e+="%\n",e+="V:2 transpose=-24\n",e+="%%MIDI program 117\n",e+="%\n",e+="% Set the Bodhran tuning\n",e+="% Valid values are:\n",e+="% C, C#, Db, D, D#, Eb, E, F, F#, Gb, G, G#, Ab, A, A#, Bb, or B.\n",e+="%\n",e+="%bodhran_tuning A\n",e+="%\n",e+="% Voice 1 - Replace this with your Slip Jig melody:\n",e+="%\n",e+="V:1\n",e+="|: z9 | z9 | z9 | z9 |\n",e+="   z9 | z9 | z9 | z9 :|\n",e+="|: z9 | z9 | z9 | z9 |\n",e+="   z9 | z9 | z9 | z9 :|\n",e+="%\n",e+="% Voice 2 - Bodhran backing patterns:\n",e+="%\n",e+="V:2\n",e+="|: =F,zD, F,=C,C, !>!=F,3 | =F,zD, F,=C,C, F,C,C, | =F,zD, F,=C,C, !>!F,3 | =F,zD, F,=C,C, F,C,C, |\n",e+="   =F,zD, F,=C,C, !>!=F,3 | =F,zD, F,=C,C, F,C,C, | =F,zD, F,=C,C, !>!F,3 | =F,zD, F,=C,C, F,C,C, :|\n",e+="|: ^d=CC =FCC FCC | ^d2=C =FCC AEA | ^A2=C =FCC A2A | ^d=CC =FCF A3 |\n",ProcessAddTune(e+="   ^d=CC =FCC FCC | ^d2=C =FCC AEA | ^A2=C =FCC A2A | ^d=CC =FCF A3 :|\n")}function AddBodhranSlideTemplate(){sendGoogleAnalytics("action","AddBodhranSlideTemplate");var e="";CountTunes()>0&&(e+="\n"),e+="X:1\n",e+="T:Slide Bodhran Template\n",e+="R:Slide\n",e+="M:12/8\n",e+="L:1/8\n",e+="Q:3/8=130\n",e+="% Change this to match the key of the tune:\n",e+="K:C\n",e+="%%staffsep 50\n",e+="%soundfont fatboy\n",e+="%swing 0.25\n",e+="%\n",e+="% This template uses two voices:\n",e+="% Voice 1 - Melody\n",e+="% Voice 2 - Bodhran backing track\n",e+="%\n",e+="% Melody voice definition:\n",e+="%\n",e+="V:1\n",e+="%%MIDI program 0\n",e+="%\n",e+="% Bodhran voice definition:\n",e+="%\n",e+="V:2 transpose=-24\n",e+="%%MIDI program 117\n",e+="%\n",e+="% Set the Bodhran tuning\n",e+="% Valid values are:\n",e+="% C, C#, Db, D, D#, Eb, E, F, F#, Gb, G, G#, Ab, A, A#, Bb, or B.\n",e+="%\n",e+="%bodhran_tuning A\n",e+="%\n",e+="% Voice 1 - Replace this with your Slide melody:\n",e+="%\n",e+="V:1\n",e+="|: z12 | z12 |\n",e+="   z12 | z12 :|\n",e+="|: z12 | z12 |\n",e+="   z12 | z12 :|\n",e+="%\n",e+="% Voice 2 - Bodhran backing patterns:\n",e+="%\n",e+="V:2\n",e+="|: =F,zD, F,=C,C, F,C,C, !>!F,3 | =F,zD, F,=C,C, F,C,C, !>!F,3 |\n",e+="   =F,zD, F,=C,C, F,C,C, !>!F,3 | =F,zD, F,=C,C, F,C,C, !>!F,3 :|\n",e+="|: ^A2=F ^dF^A =d2=A ^c2^G | ^A2=F ^dF^A =B3 B2^F |\n",ProcessAddTune(e+="   ^A2=F ^dF^A =d2=A ^c2^G | ^A=C=F ^dF^A F3 ^A3 :|\n")}function AddBodhranPolkaTemplate(){sendGoogleAnalytics("action","AddBodhranPolkaTemplate");var e="";CountTunes()>0&&(e+="\n"),e+="X:1\n",e+="T:Polka Bodhran Template\n",e+="R:Polka\n",e+="M:2/4\n",e+="L:1/8\n",e+="Q:1/4=130\n",e+="% Change this to match the key of the tune:\n",e+="K:C\n",e+="%%staffsep 50\n",e+="%soundfont fatboy\n",e+="%\n",e+="% This template uses two voices:\n",e+="% Voice 1 - Melody\n",e+="% Voice 2 - Bodhran backing track\n",e+="%\n",e+="% Melody voice definition:\n",e+="%\n",e+="V:1\n",e+="%%MIDI program 0\n",e+="%\n",e+="% Bodhran voice definition:\n",e+="%\n",e+="V:2 transpose=-24\n",e+="%%MIDI program 117\n",e+="%\n",e+="% Set the Bodhran tuning\n",e+="% Valid values are:\n",e+="% C, C#, Db, D, D#, Eb, E, F, F#, Gb, G, G#, Ab, A, A#, Bb, or B.\n",e+="%\n",e+="%bodhran_tuning A\n",e+="%\n",e+="% Voice 1 - Replace this with your Polka melody:\n",e+="%\n",e+="V:1\n",e+="|: z4 | z4 | z4 | z4 |\n",e+="   z4 | z4 | z4 | z4 :|\n",e+="|: z4 | z4 | z4 | z4 |\n",e+="   z4 | z4 | z4 | z4 :|\n",e+="%\n",e+="% Voice 2 - Bodhran backing patterns:\n",e+="%\n",e+="V:2\n",e+="|: =C,2 C,=F, | =C,=F, C,F, | =C,=F, C,F, | =C,2 =F,2 |\n",e+="   =C,2 C,=F, | =C,=F, C,F, | =C,=F, C,F, | =C,2 =F,2 :|\n",e+="|: ^A/A/A =C^A | ^F^A =CA | ^A=A/A/ =FA | ^A2E^c |\n",ProcessAddTune(e+="   ^A/A/A =C^A | ^F^A =CA | ^A=A/A/ =FA | ^A2E^c :|\n")}function AddBodhranHornpipeTemplate(){sendGoogleAnalytics("action","AddBodhranHornpipeTemplate");var e="";CountTunes()>0&&(e+="\n"),e+="X:1\n",e+="T:Hornpipe Bodhran Template\n",e+="R:Hornpipe\n",e+="M:4/4\n",e+="L:1/8\n",e+="Q:1/2=80\n",e+="% Change this to match the key of the tune:\n",e+="K:C\n",e+="%%staffsep 50\n",e+="%soundfont fatboy\n",e+="%swing 0.25\n",e+="%\n",e+="% This template uses two voices:\n",e+="% Voice 1 - Melody\n",e+="% Voice 2 - Bodhran backing track\n",e+="%\n",e+="% Melody voice definition:\n",e+="%\n",e+="V:1\n",e+="%%MIDI program 0\n",e+="%\n",e+="% Bodhran voice definition:\n",e+="%\n",e+="V:2 transpose=-24\n",e+="%%MIDI program 117\n",e+="%\n",e+="% Set the Bodhran tuning\n",e+="% Valid values are:\n",e+="% C, C#, Db, D, D#, Eb, E, F, F#, Gb, G, G#, Ab, A, A#, Bb, or B.\n",e+="%\n",e+="%bodhran_tuning A\n",e+="%\n",e+="% Voice 1 - Replace this with your Hornpipe melody:\n",e+="%\n",e+="V:1\n",e+="|: z8 | z8 | z8 | z8 |\n",e+="   z8 | z8 | z8 | z8 :|\n",e+="|: z8 | z8 | z8 | z8 |\n",e+="   z8 | z8 | z8 | z8 :|\n",e+="%\n",e+="% Voice 2 - Bodhran backing patterns:\n",e+="%\n",e+="V:2\n",e+="|: =F,=C, F,C, F,C, F,C, | =F,=C, (3!>!F,C,C, !>!F,z F,C, | =F,=C, F,C, F,C, F,C, |=F,=C, (3F,C,C, !>!F,z F,C, |\n",e+="   =F,=C, F,C, F,C, F,C, | =F,=C, (3!>!F,C,C, !>!F,z F,C, | =F,=C, F,C, F,C, F,C, | =F,=C, (3F,C,C, !>!F,z F,C, :|\n",e+="|: =F,=C, F,C, F,C, F,C, | =F,=C, F,C, F,C, F,C, | =F,=C, F,C, F,C, F,C, | =F,=C, (3!>!F,C,C, !>!F,z F,C, |\n",ProcessAddTune(e+="   =F,=C, F,C, F,C, F,C, | =F,=C, F,C, F,C, F,C, | =F,=C, F,C, F,C, F,C, | =F,=C, (3!>!F,C,C, !>!F,z F,C, :|\n")}function AppendSampleReel(){sendGoogleAnalytics("action","AppendSampleReel");var e="";CountTunes()>0&&(e+="\n"),e+="X: 1\n",e+="T: Cooley's\n",e+="C: Traditional\n",e+="R: Reel\n",e+="M: 4/4\n",e+="L: 1/8\n",e+="Q: 1/2=90\n",e+="K: Edor\n",e+="%\n",e+="% Use the fluid soundfont:\n",e+="%soundfont fluid\n",e+="%\n",e+="% Use an Acoustic Grand Piano sound for the melody:\n",e+="%%MIDI program 0\n",e+="%\n",e+="% Use an Acoustic Grand Piano sound for the chords:\n",e+="%%MIDI chordprog 0\n",e+="%\n",e+="% Use an Synth Bass sound for the bass:\n",e+="%%MIDI bassprog 38\n",e+="%\n",e+="% Set a specific amount of swing:\n",e+="%swing 0.15\n",e+="%\n",e+='|:"Em"EBBA B2 EB|B2 AB dBAG|"D"F/E/D AD BDAD|F/E/D AD BAGF|\n',e+='"Em"EBBA B2 EB|B2 AB defg|"D"afge dBAF|1 DEFD "Em"E3D:|2 DEFD "Em"E2gf||\n',e+='|:"Em"eB (3BBB eBgf|eBB2 gedB|"D"A/A/A FA DAFA|A/A/A FA defg|\n',ProcessAddTune(e+='"Em"eB (3BBB eBgf|eBBB defg|"D"afge dBAF|1 DEFD "Em"E2gf:|2 DEFD "Em"E4|]\n')}function AppendSampleJig(){sendGoogleAnalytics("action","AppendSampleJig");var e="";CountTunes()>0&&(e+="\n"),e+="X: 1\n",e+="T: The Kesh\n",e+="C: Traditional\n",e+="R: Jig\n",e+="M: 6/8\n",e+="L: 1/8\n",e+="Q: 3/8=120\n",e+="K: Gmaj\n",e+="%\n",e+="% Use the fluid soundfont:\n",e+="%soundfont fluid\n",e+="%\n",e+="% Use an Acoustic Grand Piano sound for the melody:\n",e+="%%MIDI program 0\n",e+="%\n",e+="% Use an Acoustic Grand Piano for the chords:\n",e+="%%MIDI chordprog 0\n",e+="%\n",e+="% Use an Synth Bass sound for the bass:\n",e+="%%MIDI bassprog 38\n",e+="%\n",e+="% Set a specific amount of swing:\n",e+="%swing 0.25\n",e+="%\n",e+='|:"G"GAG GAB|"D"ABA ABd|"G"edd gdd|"C"edB "D"dBA|\n',e+='"G"GAG GAB|"D"ABA ABd|"G"edd gdB|"D"AGF "G"G3:|\n',e+='|:"G"BAB dBd|"C"ege "D"dBA|"G"BAB dBG|"D"ABA AGA|\n',ProcessAddTune(e+='"G"BAB dBd|"C"ege "G"dBd|"C"gfg "D"aga|"G"bgf g3:|\n')}function AppendSampleHornpipe(){sendGoogleAnalytics("action","AppendSampleHornpipe");var e="";CountTunes()>0&&(e+="\n"),e+="X: 1\n",e+="T: Alexander's\n",e+="C: Traditional\n",e+="R: Hornpipe\n",e+="M: 4/4\n",e+="L: 1/8\n",e+="Q: 1/2=80\n",e+="K: Dmaj\n",e+="%\n",e+="% Use the fluid soundfont:\n",e+="%soundfont fluid\n",e+="%\n",e+="% Use an Acoustic Grand Piano sound for the melody:\n",e+="%%MIDI program 0\n",e+="%\n",e+="% Use an Acoustic Grand Piano for the chords:\n",e+="%%MIDI chordprog 0\n",e+="%\n",e+="% Use an Synth Bass sound for the bass:\n",e+="%%MIDI bassprog 38\n",e+="%\n",e+="% Set a specific amount of swing:\n",e+="%swing 0.25\n",e+="%\n",e+='|:(3gfe|"D"dAFA DFAd|fdcd Adef|"G"g2 ge "D"fdcd|"A"(3efe (3dcB A2 (3gfe|\n',e+='"D"dAFA DFAd|fdcd Adef|"G"g2 ge "D"fdcd|"A"(3efe dc"D"d2:|\n',e+='|:AG|"D"FAdA FAdA|"G"GBdB GBdB|"A"Acec Acec|"D"dfaf "A"(3gfe (3dAG|\n',ProcessAddTune(e+='"D"FAdA FAdA|"G"GBdB GBdB|"A"Acef gecd|(3efe dc"D"d2:|\n')}function AppendTuneTempate(){sendGoogleAnalytics("action","AppendTuneTemplate");var e="";CountTunes()>0&&(e+="\n"),e+="X: 1\n",e+="T: Tune Title\n",e+="C: Composer\n",e+="R: Tune style (Reel, Jig, Hornpipe, etc.)\n",e+="%\n",e+="% Meter:\n",e+="M: 4/4\n",e+="%\n",e+="% Beat unit:\n",e+="L: 1/8\n",e+="%\n",e+="% Tempo:\n",e+="Q: 1/4=120\n",e+="%\n",e+="% Key:\n",e+="K: C\n",e+="%\n",e+="% Soundfont\n",e+="% Available soundfonts are:\n",e+="% fluid, fluidhq, musyng, fatboy, canvas, mscore, arachno:\n",e+="%soundfont fluid\n",e+="%\n",e+="% Use an Acoustic Grand Piano sound for the melody:\n",e+="%%MIDI program 0\n",e+="%\n",e+="% Use an Acoustic Grand Piano for the chords:\n",e+="%%MIDI chordprog 0\n",e+="%\n",e+="% Use an Synth Bass sound for the bass:\n",e+="%%MIDI bassprog 38\n",e+="%\n",e+="% Add your tune's ABC below:\n",ProcessAddTune(e+='"C"C2 D2 E2 F2| G2 A2 B2 c2|]\n')}function AppendSongTemplate(){sendGoogleAnalytics("action","AppendSongTemplate");var e="";CountTunes()>0&&(e+="\n"),e+="% Stripped-down self-documenting song in ABC, by Linda Eskin\n",e+="% Replace the WORDS IN UPPER-CASE with your own information.\n",e+="% You can remove all these comments with single % signs.\n",e+="%\n",e+="X: 1\n",e+="%\n",e+="% *** THIS HEADER CONVEYS INFORMATION ABOUT THE SONG ***\n",e+="%\n",e+="% These text elements appear above the music:\n",e+="T: TITLE OF THE SONG\n",e+="T: ALTERNATE TITLE\n",e+="C: COMPOSER/SONGWRITER\n",e+="O: ORIGIN/GEOGRAPHIC\n",e+="%%text GENERAL PURPOSE TEXT\n",e+="%\n",e+="% These appear below the music and lyrics:\n",e+="S: SOURCE OF THE SONG\n",e+="D: DISCOGRAPHY - CD, LP, ETC.\n",e+="N: NOTES (TEXT)\n",e+="Z: TRANSCRIBER, COPYRIGHT, PERMISSIONS\n",e+="H: HISTORY OF THE SONG\n",e+="H: This self-documenting ABC song template was created by Linda Eskin.\n",e+="%\n",e+="% This appears in your ABC file only, for reference.\n",e+="F: FILE URL - WHERE TO FIND THIS ONLINE\n",e+="%\n",e+="% These appear above the music AND control how it is played:\n",e+="R: RHYTHM, E.G. JIG, WALTZ\n",e+="M: 4/4\n",e+="L: 1/4\n",e+="Q: 1/4=120\n",e+="K: C\n",e+="% The K (key) tag should be the last thing in the header.\n",e+="%\n",e+="% *** THE SONG ITSELF STARTS HERE - REPLACE THIS WITH YOUR SONG ***\n",e+="%\n",e+="P: PART - VERSE, CHORUS, ETC.\n",e+='"C"C D2 E|"F"F G3|"Am"A B2 c|"E7"d e3|\n',e+="w: The words to the act-u-al tune go here\n",e+="w: You can put more ver-ses here is you like\n",e+="%\n",e+='"C"C D2 E|"F"F G3|"Am"A B2 c|"E7"d e3|]\n',e+="w: This tune is a scale. See how the notes work!\n",e+="w: This line is for the se-cond verse. Ta-da!\n",e+="%\n",e+="% *** YOU CAN PUT MORE LYRICS AFTER THE TUNE, TOO. ***\n",e+="%\n",e+="W: Write your extra verses here, verses here, verses here.\n",e+="W: Write your extra verses here, or the whole song if you like.\n",e+="W:\n",e+="W: --- This is where the chorus goes, chorus goes, chorus goes.\n",e+="W: --- Indent it with dashes if you like, but spaces will not work.\n",e+="W:\n",e+="W: Here we have another verse, another verse, another verse.\n",e+="W: Now we have reached the end - this is the last verse of this song.\n",e+="%\n",ProcessAddTune(e+="% That should get you started. Go play!\n")}function AppendSampleSong(){sendGoogleAnalytics("action","AppendSampleSong");var e="";CountTunes()>0&&(e+="\n"),e+="% A simple, self-documenting song in ABC, by Linda Eskin\n",e+="%\n",e+="% ABC is a plain-text format for conveying musical information.\n",e+="% Use this as an example to learn how ABC is written.\n",e+="% You can use it as a template to create your own ABC song.\n",e+="% Examples are in UPPER-CASE so you can see and replace them easily.\n",e+="%\n",e+="% Comments (like this one) start with a single percent symbol.\n",e+="%\n",e+="X: 1 \n",e+="% Each tune must start with an X: tag, and a number.\n",e+="%\n",e+="% *** THIS IS THE HEADER - INFO ABOUT THE TUNE/SONG ***\n",e+="%\n",e+="% These text elements appear above the music:\n",e+="%\n",e+="T: TITLE OF THE SONG\n",e+="T: ALTERNATE TITLE\n",e+="%\n",e+="C: COMPOSER\n",e+='% Songwriter, source, "Traditional", "Child Ballad," etc.\n',e+="%\n",e+="O: ORIGIN\n",e+="% Where is the tune from? Country, culture, ...\n",e+="%\n",e+="%%text GENERAL PURPOSE TEXT\n",e+="% There are many more options that use the double percentage symbols.\n",e+="% Note that lines starting with %% are *not* comments.\n",e+="%\n",e+="% These text elements appear below the music and lyrics:\n",e+="%\n",e+="% For S:, D:, H:, N:, and Z: the first line with the tag adds a label.\n",e+="% Additional lines with the same tag do not.\n",e+="%\n",e+="% S:, D:, H:, N:, and Z: lines do not word wrap.\n",e+="% Add more lines if you have more than will fit across the page.\n",e+="%\n",e+="S: SOURCE\n",e+='% "Learned from Morgan at Folk Festival," "Child Ballad," etc.\n',e+="%\n",e+="D: DISCOGRAPHY\n",e+="% On which CD/LP? Appears at the bottom of the page.\n",e+="%\n",e+="N: THESE NOTES APPEAR NEAR THE BOTTOM OF THE PAGE.\n",e+="%\n",e+="Z: TRANSCRIBER, COPYRIGHT, PERMISSIONS.\n",e+="% Transcriber info appears at the bottom, right below the Notes.\n",e+="%\n",e+="H: HISTORY OF THE SONG\n",e+="H: This self-documenting ABC example song was created by Linda Eskin.\n",e+="% Real-life event? Written for a movie? Appears at the bottom of the page.\n",e+="%\n",e+="F: FILE URL\n",e+="% If you want people to find your file online, put the URL here.\n",e+="%\n",e+="% These appear above the music AND control how it is played:\n",e+="%\n",e+="R: RHYTHM\n",e+="% Reel, Waltz, Jig, Hornpipe, etc.\n",e+="%\n",e+="M: 4/4\n",e+="% Meter, such as 3/4, 4/4, 9/8. Appears in the key signature.\n",e+="%\n",e+="L: 1/4\n",e+="% Length of base note unit. Here a 1/4 note = 1.\n",e+="% Use multiplier numbers to get longer notes: C2, a3, F4\n",e+="%\n",e+="Q: 1/4=120\n",e+="% Tempo. e.g. 120 beats per minute (BPM). (Mnemonic: Q=Quickness.)\n",e+="%\n",e+="%%staffsep 80\n",e+="% Sets the spacing between the staffs. Bigger numbers = more space.\n",e+="%\n",e+="K: C\n",e+="% Key signature - G, D, Edor, Amix, etc.\n",e+="% The K (key) tag should be the last thing in the header.\n",e+="%\n",e+="% *** THE TUNE ITSELF STARTS HERE ***\n",e+="%\n",e+="P: PART GOES HERE\n",e+="% Intro, Verse, Chorus, Refrain, etc.\n",e+="%\n",e+="% This is the actual music and words.\n",e+="% ABC apps *play* the music you write. Don't just make stuff up!\n",e+="% Follow the ABC standard so your tune and chords play correctly:\n",e+="% http://abcnotation.com/wiki/abc:standard:v2.1\n",e+="%\n",e+='"C"C D2 E|"F"F G3|"Am"A B2 c|"E7"d e3|\n',e+="w: The words to the act-u-al tune go here\n",e+="w: You can put more ver-ses here is you like\n",e+="%\n",e+='"C"C D2 E|"F"F G3|"Am"A B2 c|"E7"d e3|]\n',e+="w: This tune is a scale. See how the notes work!\n",e+="w: This line is for the se-cond verse. Ta-da!\n",e+="%\n",e+="% Chord names, in quotes, appear above the black-dots notation.\n",e+="%\n",e+="% The other letters are the notes. Lower-case for higher octave.\n",e+='% The base unit note length ("L", above) is assumed to equal 1.\n',e+="% For longer notes use a multiplier: G3, e2, C4 etc.\n",e+="%\n",e+='% w (lower-case "w") = words, or inline lyrics - the lyrics that appear right in the sheet music, below the black-dots notation.\n',e+="%\n",e+="% *** YOU CAN PUT MORE LYRICS AFTER THE TUNE, TOO. ***\n",e+="%\n",e+="% W = Words. More lyrics, if you want them.\n",e+='% Note upper-case "W:" used below:\n',e+="%\n",e+="W: Write your extra verses here, verses here, verses here.\n",e+="W: Write your extra verses here, or the whole song if you like.\n",e+="W:\n",e+='% You can leave a "W" line blank, to leave some space.\n',e+="W: --- This is where the chorus goes, chorus goes, chorus goes.\n",e+="W: --- Indent it with dashes if you like, but spaces won't work.\n",e+="W:\n",e+="W: Here we have another verse, another verse, another verse.\n",e+="W: Now we have reached the end - this is the last verse of this song.\n",e+="%\n",ProcessAddTune(e+="% That should get you started. Go play!\n")}function AddPDFAnnotationsTemplate(e){if(e.shiftKey&&e.altKey)AddDatabaseTemplate();else{sendGoogleAnalytics("action","AddPDFAnnotationsTemplate");setABCEditorText("% Start of PDF Tunebook Features\n%\n%pdfquality 0.75\n%pdf_between_tune_space 20\n%addtitle Title Page\n%titlefontsize 24\n%addsubtitle This is the Subtitle\n%subtitlefontsize 16\n%addtoc Table of Contents\n%addlinkbacktotoc\n%tocleftoffset 0\n%tocrightoffset 0\n%addsortedindex Index\n%addlinkbacktoindex\n%indexleftoffset 0\n%indexrightoffset 0\n%pageheader This is the Page Header\n%pagefooter This is the Page Footer\n%add_all_playback_links 0 0 0 fatboy\n%add_all_playback_volumes 64 64\n%\n% End of PDF Tunebook Features\n\n"+getABCEditorText())}}function AddDatabaseTemplate(){sendGoogleAnalytics("action","AddDatabaseTemplate");var e="";CountTunes()>0&&(e+="\n"),e+="X:1\n",e+="T: Single Soundfont Instrument Notes + Reverb Setting Database Loader\n",e+="M: 4/4\n",e+="L: 1/8\n",e+="K: C\n",e+="Q: 1/4=400\n",e+="%\n",e+="% 1) Select the soundfont:\n",e+="%\n",e+="% Available soundfonts are:\n",e+="% fluid, musyng, fatboy, canvas, mscore, arachno, and fluidhq\n",e+="%\n",e+="%soundfont fluid\n",e+="%\n",e+="% 2) Select the MIDI instrument program you want to use\n",e+="% in the soundfont and have all the notes stored in the database:\n",e+="%\n",e+="% Example: Acoustic Grand Piano\n",e+="%%MIDI program 0\n",e+="%\n",e+="% 3) Select the reverb environment you want to have stored in the database\n",e+="%\n",e+="% Available reverb environments are:\n",e+="% off, room1, room2, room3, chamber1, chamber2, chamber3,\n",e+="% hall1, hall2, hall3, church1,\n",e+="% room (same as room3), chamber (same as chamber2),\n",e+="% hall (same as hall2), and church (same as church1)\n",e+="%\n",e+="% chamber is the default reverb, so probably already stored:\n",e+="%\n",e+="%reverb chamber 0.9 0.1\n",e+="%\n",e+='% 4) While online, click "Play" to load the ABC into the player.\n',e+="%\n",e+="% You do not need to actually play the tune, just loading the template\n",e+="% into the player is enough to save the notes and reverb setting in\n",e+="% the instrument notes and reverb database.\n",e+="%\n",e+="[|C,,,4 ^C,,,4 D,,,4 ^D,,,4 E,,,4 F,,,4 ^F,,,4 G,,,4 ^G,,,4 A,,,4 ^A,,,4 B,,,4 |\n",e+="C,,4 ^C,,4 D,,4 ^D,,4 E,,4 F,,4 ^F,,4 G,,4 ^G,,4 A,,4 ^A,,4 B,,4 |\n",e+="C,4 ^C,4 D,4, ^D,4 E,4 F,4 ^F,4 G,4 ^G,4 A,4 ^A,4 B,4 |\n",e+="C4 ^C4 D4 ^D4 E4 F4 ^F4 G4 ^G4 A4 ^A4 B4 |\n",e+="c4 ^c4 d4 ^d4 e4 f4 ^f4 g4 ^g4 a4 ^a4 b4 |\n",e+="c'4 ^c'4 d'4 ^d'4 e'4 f'4 ^f'4 g'4 ^g'4 a'4 ^a'4 b'4|\n",e+="c''4 ^c''4 d''4 ^d''4 e''4 f''4 ^f''4 g''4 ^g''4 a''4 ^a''4 b''4|]\n\n",e+="X: 2\n",e+="T: All Soundfont Instruments Notes Database Primer Loader\n",e+="M: 4/4\n",e+="L: 1/8\n",e+="K: C\n",e+="Q: 1/8=400\n",e+="%\n",e+="% Loads one note for each MIDI instrument in an entire soundfont\n",e+="% into the instrument notes database to allow you to easily\n",e+="% load the rest of the notes for all the instruments.\n",e+="%\n",e+="% 1) Select the soundfont you want to load:\n",e+="%\n",e+="% Available soundfonts are:\n",e+="% fluid, musyng, fatboy, canvas, mscore, arachno, and fluidhq\n",e+="%\n",e+="%soundfont fluid\n",e+="%\n",e+='% 2) While online, click "Play" to load the ABC into the player.\n',e+="%\n",e+="% You don't need to actually play the file, just loading the template\n",e+="% into the player is enough to create single note placeholder\n",e+="% entries in the instrument notes database.\n",e+="%\n",e+="% 3) Once the player load is complete, you can close the player.\n",e+="%\n",e+='% 4) Open "Settings"/"Manage Notes, Reverb, and Tune Search Databases"\n',e+="%\n",e+='% 5) Click "Instrument Notes Database"\n',e+="%\n",e+='% 6) Click "Load All Notes for All Instruments"\n',e+="%\n",e+="% 7) The tool will download all the notes for all the instruments.\n",e+="%\n",e+="% This is a very aggressive use of the database loader feature.\n",e+="%\n",e+="% While I do not expect there to be any issues, use at your own risk.\n",e+="%\n",e+='[I:MIDI= program 0] "_0" G4 |[I:MIDI= program 1] "_1" G4 |[I:MIDI= program 2] "_2" G4 |[I:MIDI= program 3] "_3" G4 |[I:MIDI= program 4] "_4" G4 |[I:MIDI= program 5] "_5" G4 |[I:MIDI= program 6] "_6" G4 |[I:MIDI= program 7] "_7" G4 |\n',e+='[I:MIDI= program 8] "_8" G4 |[I:MIDI= program 9] "_9" G4 |[I:MIDI= program 10] "_10" G4 |[I:MIDI= program 11] "_11" G4 |[I:MIDI= program 12] "_12" G4 |[I:MIDI= program 13] "_13" G4 |[I:MIDI= program 14] "_14" G4 |[I:MIDI= program 15] "_15" G4 |\n',e+='[I:MIDI= program 16] "_16" G4 |[I:MIDI= program 17] "_17" G4 |[I:MIDI= program 18] "_18" G4 |[I:MIDI= program 19] "_19" G4 |[I:MIDI= program 20] "_20" G4 |[I:MIDI= program 21] "_21" G4 |[I:MIDI= program 22] "_22" G4 |[I:MIDI= program 23] "_23" G4 |\n',e+='[I:MIDI= program 24] "_24" G4 |[I:MIDI= program 25] "_25" G4 |[I:MIDI= program 26] "_26" G4 |[I:MIDI= program 27] "_27" G4 |[I:MIDI= program 28] "_28" G4 |[I:MIDI= program 29] "_29" G4 |[I:MIDI= program 30] "_30" G4 |[I:MIDI= program 31] "_31" G4 |\n',e+='[I:MIDI= program 32] "_32" G4 |[I:MIDI= program 33] "_33" G4 |[I:MIDI= program 34] "_34" G4 |[I:MIDI= program 35] "_35" G4 |[I:MIDI= program 36] "_36" G4 |[I:MIDI= program 37] "_37" G4 |[I:MIDI= program 38] "_38" G4 |[I:MIDI= program 39] "_39" G4 |\n',e+='[I:MIDI= program 40] "_40" G4 |[I:MIDI= program 41] "_41" G4 |[I:MIDI= program 42] "_42" G4 |[I:MIDI= program 43] "_43" G4 |[I:MIDI= program 44] "_44" G4 |[I:MIDI= program 45] "_45" G4 |[I:MIDI= program 46] "_46" G4 |[I:MIDI= program 47] "_47" G4 |\n',e+='[I:MIDI= program 48] "_48" G4 |[I:MIDI= program 49] "_49" G4 |[I:MIDI= program 50] "_50" G4 |[I:MIDI= program 51] "_51" G4 |[I:MIDI= program 52] "_52" G4 |[I:MIDI= program 53] "_53" G4 |[I:MIDI= program 54] "_54" G4 |[I:MIDI= program 55] "_55" G4 |\n',e+='[I:MIDI= program 56] "_56" G4 |[I:MIDI= program 57] "_57" G4 |[I:MIDI= program 58] "_58" G4 |[I:MIDI= program 59] "_59" G4 |[I:MIDI= program 60] "_60" G4 |[I:MIDI= program 61] "_61" G4 |[I:MIDI= program 62] "_62" G4 |[I:MIDI= program 63] "_63" G4 |\n',e+='[I:MIDI= program 64] "_64" G4 |[I:MIDI= program 65] "_65" G4 |[I:MIDI= program 66] "_66" G4 |[I:MIDI= program 67] "_67" G4 |[I:MIDI= program 68] "_68" G4 |[I:MIDI= program 69] "_69" G4 |[I:MIDI= program 70] "_70" G4 |[I:MIDI= program 71] "_71" G4 |\n',e+='[I:MIDI= program 72] "_72" G4 |[I:MIDI= program 73] "_73" G4 |[I:MIDI= program 74] "_74" G4 |[I:MIDI= program 75] "_75" G4 |[I:MIDI= program 76] "_76" G4 |[I:MIDI= program 77] "_77" G4 |[I:MIDI= program 78] "_78" G4 |[I:MIDI= program 79] "_79" G4 |\n',e+='[I:MIDI= program 80] "_80" G4 |[I:MIDI= program 81] "_81" G4 |[I:MIDI= program 82] "_82" G4 |[I:MIDI= program 83] "_83" G4 |[I:MIDI= program 84] "_84" G4 |[I:MIDI= program 85] "_85" G4 |[I:MIDI= program 86] "_86" G4 |[I:MIDI= program 87] "_87" G4 |\n',e+='[I:MIDI= program 88] "_88" G4 |[I:MIDI= program 89] "_89" G4 |[I:MIDI= program 90] "_90" G4 |[I:MIDI= program 91] "_91" G4 |[I:MIDI= program 92] "_92" G4 |[I:MIDI= program 93] "_93" G4 |[I:MIDI= program 94] "_94" G4 |[I:MIDI= program 95] "_95" G4 |\n',e+='[I:MIDI= program 96] "_96" G4 |[I:MIDI= program 97] "_97" G4 |[I:MIDI= program 98] "_98" G4 |[I:MIDI= program 99] "_99" G4 |[I:MIDI= program 100] "_100" G4 |[I:MIDI= program 101] "_101" G4 |[I:MIDI= program 102] "_102" G4 |[I:MIDI= program 103] "_103" G4 |\n',e+='[I:MIDI= program 104] "_104" G4 |[I:MIDI= program 105] "_105" G4 |[I:MIDI= program 106] "_106" G4 |[I:MIDI= program 107] "_107" G4 |[I:MIDI= program 108] "_108" G4 |[I:MIDI= program 109] "_109" G4 |[I:MIDI= program 110] "_110" G4 |[I:MIDI= program 111] "_111" G4 |\n',e+='[I:MIDI= program 112] "_112" G4 |[I:MIDI= program 113] "_113" G4 |[I:MIDI= program 114] "_114" G4 |[I:MIDI= program 115] "_115" G4 |[I:MIDI= program 116] "_116" G4 |[I:MIDI= program 117] "_117" G4 |[I:MIDI= program 118] "_118" G4 |[I:MIDI= program 119] "_119" G4 |\n',e+='[I:MIDI= program 120] "_120" G4 |[I:MIDI= program 121] "_121" G4 |[I:MIDI= program 122] "_122" G4 |[I:MIDI= program 123] "_123" G4 |[I:MIDI= program 124] "_124" G4 |[I:MIDI= program 125] "_125" G4 |[I:MIDI= program 126] "_126" G4 |[I:MIDI= program 127] "_127" G4 |\n',e+='[I:MIDI= program 128] "_128" G4 |[I:MIDI= program 129] "_129" G4 |[I:MIDI= program 130] "_130" G4 |[I:MIDI= program 131] "_131" G4 |[I:MIDI= program 132] "_132" G4 |[I:MIDI= program 133] "_133" G4 |[I:MIDI= program 134] "_134" G4 |[I:MIDI= program 135] "_135" G4 |\n',e+='[I:MIDI= program 136] "_136" G4 |[I:MIDI= program 137] "_137" G4 |[I:MIDI= program 138] "_138" G4 |[I:MIDI= program 139] "_139" G4 |[I:MIDI= program 140] "_140" G4 |[I:MIDI= program 141] "_141" G4 |[I:MIDI= program 142] "_142" G4 |[I:MIDI= program 143] "_143" G4 |[I:MIDI= program 144] "_144" G4 |\n',ProcessAddTune(e+='[I:MIDI= program 145] "_145" G4 |[I:MIDI= program 146] "_146" G4 |[I:MIDI= program 147] "_147" G4 |[I:MIDI= program 148] "_148" G4 |[I:MIDI= program 149] "_149" G4 | [I:MIDI= program 158] "_158" G4 |]\n')}function ProcessAddTune(e){getABCEditorText().length;setABCEditorText(getABCEditorText()+e),gIsDirty=!0,"No ABC file selected"!=gDisplayedName&&-1==gDisplayedName.indexOf("+ added tunes")&&(gDisplayedName+=" + added tunes"),RenderAsync(!0,null,function(){UpdateNotationTopPosition();var e=CountTunes();gIsQuickEditor&&(gCurrentTune=e-1),isMobileBrowser()&&(gCurrentTune=e-1);var t=getTuneByIndex(e-1),n=getABCEditorText().length-t.length;if(!gIsMaximized)if(gEnableSyntax){if(ScrollABCTextIntoView(gTheCM,n,n,10),isMobileBrowser())return void gTheCM.getInputField().blur();gTheCM.getInputField().blur(),gTheCM.focus()}else{if(ScrollABCTextIntoView(gTheABC,n,n,10),isMobileBrowser())return void gTheABC.blur();gTheABC.blur(),gTheABC.focus()}MakeTuneVisible(!0)})}function getTextAreaContentHeight(e,t){const n=document.createElement("div"),o=getComputedStyle(e);Object.assign(n.style,{position:"absolute",whiteSpace:"pre-wrap",visibility:"hidden",overflowWrap:"break-word",top:"0",left:"0",width:e.offsetWidth+"px",font:o.font,padding:o.padding,border:o.border,lineHeight:o.lineHeight});const a=e.value.slice(0,t),l=e.value[t]||" ",r=e.value.slice(t+1);n.innerHTML=a+`<span id="caret-marker">${l}</span>`+r,document.body.appendChild(n);var i=n.querySelector("#caret-marker").offsetTop;return document.body.removeChild(n),i}function ScrollABCTextIntoView(e,t,n,o){if(gEnableSyntax){(!o||o<=0)&&(o=2);const a=e.posFromIndex(t),l=e.posFromIndex(n),r=e.charCoords(l,"local"),i=e.getScrollerElement(),s=i.clientHeight;if(e.getScrollInfo().height<=s)return void e.setSelection(a,l);const c=Math.max(0,r.top-s/o);e.scrollTo(i.scrollLeft,c),e.setSelection(a,l)}else{var a=e;const r=a.value;var l=a.cloneNode();l.style.position="absolute",l.style.visibility="hidden",l.style.height="auto",l.style.overflow="hidden",l.value=r.slice(0,n),document.body.appendChild(l);let i=l.scrollHeight;document.body.removeChild(l),l=null;const s=a.clientHeight;i===s&&(i=getTextAreaContentHeight(a,n)),a.scrollTop=Math.max(0,i-s/o),a.setSelectionRange(t,n)}}function RenderDivClickHandler(e){if(!gRenderingPDF&&!gDisableNotationRendering)if(gUIHidden&&gUIHiddenAllowPlay)if(gUIHiddenClickTimeout)if(clearTimeout(gUIHiddenClickTimeout),gUIHiddenClickTimeout=null,gUIHiddenPlayerEnabled){const e=document.querySelector("button.abcjs-midi-start");e&&e.click()}else gUIHiddenPlayerEnabled=!0,PlayABC(),setTimeout(function(){const e=document.querySelector("button.abcjs-midi-start");e&&e.click()},250);else{var t,n;if((t=this.id)&&""!=t&&0==t.indexOf("notation"))if(""!=(n=this.id.replace("notation","")))if((s=parseInt(n))!=gUIHiddenTuneIndex){gPlayABCTuneIndex=gUIHiddenTuneIndex=s;var o=findTuneOffsetByIndex(gUIHiddenTuneIndex);if(gEnableSyntax?gTheCM.selectionStart=o:gTheABC.selectionStart=o,gUIHiddenPlayerEnabled){for(var a=document.getElementsByClassName("modal_flat_ok"),l=null,r=0;r<a.length;++r)if("Close"==(l=a[r]).innerText){var i=l.onclick;l.onclick=function(){i(),gSynthControl&&(gSynthControl.destroy(),gSynthControl=null),gIsIOS&&gTheMuteHandle&&(gTheMuteHandle.dispose(),gTheMuteHandle=null)};break}l.click(),gUIHiddenPlayerEnabled=!1}}gUIHiddenClickTimeout=setTimeout(()=>{if(isPureDesktopBrowser()&&e.shiftKey){const e=document.querySelector("button.abcjs-midi-reset");e&&e.click()}gUIHiddenClickTimeout=null},300)}else if((t=this.id)&&""!=t&&0==t.indexOf("notation")&&""!=(n=this.id.replace("notation",""))){var s;if((s=parseInt(n))==gLastClickedTune)return;gLastClickedTune=s;var c=findTuneOffsetByIndex(s);if(gIsMaximized)gGotRenderDivClick=!0,gRenderDivClickOffset=c;else if(gEnableSyntax){if(gIsQuickEditor||ScrollABCTextIntoView(gTheCM,c,c,10),isMobileBrowser())return void gTheCM.getInputField().blur();gTheCM.getInputField().blur(),gTheCM.focus()}else{if(gIsQuickEditor||ScrollABCTextIntoView(gTheABC,c,c,10),isMobileBrowser())return void gTheABC.blur();gTheABC.blur(),gTheABC.focus()}}}function GenerateRenderingDivs(e){if(!gDisableNotationRendering){var t=gTheNotation;t.innerHTML="";for(var n=0;n<e;++n){var o=document.createElement("div");o.id="notation"+n,o.classList.add("tunespacer"),o.classList.add("pagebreak"),o.onclick=RenderDivClickHandler,gUIHidden&&gUIHiddenAllowPlay&&(isPureDesktopBrowser()?o.title="Double-click to play/pause. Shift-click to rewind playback.":SetupEmbeddedMobileEventHanders(o)),t.appendChild(o)}}}function getUrlWithoutParams(){return"https://michaeleskin.com/abctools/abctools.html"}function FillUrlBoxWithAbcInLZW(e,t,n){var o="";o=e||getABCEditorText();var a=LZString.compressToEncodedURIComponent(o),l=n;l||(l=GetRadioValue("notenodertab"));var r=gCapo,i=gStaffSpacing-STAFFSPACEOFFSET,s=getUrlWithoutParams()+"?lzw="+a+"&format="+l+"&ssp="+i,c="";switch(l){case"noten":case"notenames":case"whistle":case"recorder":break;case"mandolin":case"gdad":case"cgda":case"cgdae":case"dgdae":case"guitare":case"guitard":case"uke":c="&capo="+r,c+=gShowTabNames?"&stn=true":"&stn=false"}if(s+=c,(gUseComhaltasABC||gForceComhaltasABC)&&(s+="&cce=1"),e)return s;var g=getDescriptiveFileName(CountTunes(),!1);if(s+="&name="+(g=g.replaceAll("#","^")),document.getElementById("qrcode").style.display="none",gAllowURLSave=!1,gAllowQRCodeSave=!1,s.length<8100){gAllowURLSave=!0;var d=MAXQRCODEURLLENGTH;s.length<d&&(gAllowQRCodeSave=!0)}if(t){var u=document.getElementById("urltextbox");gAllowURLSave?(document.getElementById("testurl").classList.remove("urlcontrolsdisabled"),document.getElementById("testurl").classList.add("urlcontrols"),document.getElementById("saveurl").classList.remove("urlcontrolsdisabled"),document.getElementById("saveurl").classList.add("urlcontrols"),document.getElementById("copyurl").classList.remove("urlcontrolsdisabled"),document.getElementById("copyurl").classList.add("urlcontrols"),document.getElementById("shortenurl").classList.remove("urlcontrolsdisabled"),document.getElementById("shortenurl").classList.add("urlcontrols"),gAllowQRCodeSave?(document.getElementById("generateqrcode").classList.remove("urlcontrolsdisabled"),document.getElementById("generateqrcode").classList.add("urlcontrols")):(document.getElementById("generateqrcode").classList.remove("urlcontrols"),document.getElementById("generateqrcode").classList.add("urlcontrolsdisabled"))):(s=" *** The URL link would be too long to share. Please try sharing fewer tunes. ***",document.getElementById("generateqrcode").classList.remove("urlcontrols"),document.getElementById("generateqrcode").classList.add("urlcontrolsdisabled"),document.getElementById("shortenurl").classList.remove("urlcontrols"),document.getElementById("shortenurl").classList.add("urlcontrolsdisabled"),document.getElementById("testurl").classList.remove("urlcontrols"),document.getElementById("testurl").classList.add("urlcontrolsdisabled"),document.getElementById("copyurl").classList.remove("urlcontrols"),document.getElementById("copyurl").classList.add("urlcontrolsdisabled"),document.getElementById("saveurl").classList.remove("urlcontrols"),document.getElementById("saveurl").classList.add("urlcontrolsdisabled")),u.value=s}return s}function CreateURLfromHTML(){FillUrlBoxWithAbcInLZW(null,!0),urltextbox=document.getElementById("urltextbox"),urltextbox.focus(),urltextbox.setSelectionRange(0,0),clearQRCode()}function clearQRCode(){gTheQRCode&&gTheQRCode.clear()}function GenerateQRCode(e){sendGoogleAnalytics("sharing","generate_qr_code");var t=!1,n=document.getElementById("urltextbox").value;if(e.shiftKey){var o=MAXQRCODEURLLENGTH;if(n.length>o)return void DayPilot.Modal.alert('<p style="text-align:center;font-family:helvetica;font-size:14pt;">Share URL is too long to generate a QR Code</p>',{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});t=!0}else if(!gAllowQRCodeSave)return;null==gTheQRCode?gTheQRCode=new QRCode(document.getElementById("qrcode"),{text:n,width:548,height:548,colorDark:"#000000",colorLight:"#ffffff",border:16,correctLevel:QRCode.CorrectLevel.M}):(gTheQRCode.clear(),gTheQRCode.makeCode(n)),document.getElementById("qrcode").style.display="inline-block",theQRCodeImage=document.querySelectorAll('div[id="qrcode"] > img');var a="Custom QR Code",l="custom_qr_code";if(theQRCodeImage&&theQRCodeImage.length>0){if(!t){a=GetAllTuneTitles();var r="";switch(GetRadioValue("notenodertab")){case"noten":r="<br/><br/>(Standard Notation)";break;case"notenames":r="<br/><br/>(Note Names Tab)";break;case"mandolin":r="<br/><br/>(Mandolin Tab",0!=gCapo&&(r+=" - Capo on "+gCapo),r+=")";break;case"gdad":r="<br/><br/>(Bouzouki GDAD Tab",0!=gCapo&&(r+=" - Capo on "+gCapo),r+=")";break;case"cgda":r="<br/><br/>(Mandola CGDA Tab",0!=gCapo&&(r+=" - Capo on "+gCapo),r+=")";break;case"cgdae":r="<br/><br/>(CGDAE Tab",0!=gCapo&&(r+=" - Capo on "+gCapo),r+=")";break;case"dgdae":r="<br/><br/>(DGDAE Tab",0!=gCapo&&(r+=" - Capo on "+gCapo),r+=")";break;case"guitare":r="<br/><br/>(Standard Guitar Tab",0!=gCapo&&(r+=" - Capo on "+gCapo),r+=")";break;case"guitard":r="<br/><br/>(DADGAD Guitar Tab",0!=gCapo&&(r+=" - Capo on "+gCapo),r+=")";break;case"uke":r="<br/><br/>(Ukulele Tab",0!=gCapo&&(r+=" - Capo on "+gCapo),r+=")";break;case"whistle":r="<br/><br/>(Whistle Tab)";break;case"recorder":r="<br/><br/>(Recorder Tab)"}a+=r;var i=CountTunes();l=getDescriptiveFileName(i,!0)}theQRCodeImage=theQRCodeImage[0];var s=window.open("");setTimeout(function(){var e=theQRCodeImage.src,t='<div style="text-align:center;padding:24px;margin-top:0px;margin-bottom:0px;">';t+=theQRCodeImage.outerHTML.replace("display: block;",""),t+='<p style="font-family:times;font-size:15pt;margin-top:18px;margin-bottom:0px;">'+a+"</p>",t+='<p style="font-family:times;font-size:16pt;margin-top:32px;margin-bottom:0px;"><strong>Get Your QR Code</strong></p>',t+='<p style="font-family:times;font-size:16pt;margin-top:32px;margin-bottom:0px;"><a href="'+e+'" download="'+l+'.png" style="text-decoration:none;color:darkblue">Click here to download&nbsp;'+l+".png&nbsp;to your system.</a></p>",t+='<p style="font-family:times;font-size:16pt;margin-top:32px;margin-bottom:0px;"><strong>Use Your QR Code</strong></p>',t+='<p style="font-family:times;font-size:15pt;margin-top:30px;margin-bottom:0px;">Share QR Codes on social media or email them to friends like any other photo.</p>',t+='<p style="font-family:times;font-size:15pt;margin-top:24px;margin-bottom:0px;">Scanning the code with the Camera app on any iOS or Android phone will load the</p>',t+='<p style="font-family:times;font-size:15pt;margin-top:6px;margin-bottom:0px;">ABC Transcription Tool with your tune set into the browser on the device.</p>',t+="</div>",s.document.write(t),setTimeout(function(){s.document.title="ABC Tools Tune Sharing QR Code"},100)},1e3)}}function RoundTripMusicXML(){var e;if(!navigator.onLine)return e=makeCenteredPromptString(e="Reformat Using MusicXML not available while offline."),void DayPilot.Modal.alert(e,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});if(0==CountTunes())return e=makeCenteredPromptString(e="No ABC tunes to reformat."),void DayPilot.Modal.alert(e,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});var t=FindPreTuneHeader(getABCEditorText()),n=getTuneByIndex(0),o=GetFirstTuneTitle(!0);showTheSpinner();try{fetch("https://seisiuneer.pythonanywhere.com/abc2xml",{method:"POST",body:n}).then(e=>e.text()).then(e=>{setABCEditorText(t+importMusicXML(e,o)),RenderAsync(!0,null,function(){hideTheSpinner()})})}catch(e){hideTheSpinner()}}function SaveABCAsMusicXML(e,t){if(!navigator.onLine){var n="Save as MusicXML not available while offline.";return n=makeCenteredPromptString(n),void DayPilot.Modal.alert(n,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})}fetch("https://seisiuneer.pythonanywhere.com/abc2xml",{method:"POST",body:e}).then(e=>e.text()).then(e=>{var n=document.createElement("a");document.body.appendChild(n),n.style="display: none";var o=new Blob([e],{type:"text/plain"}),a=window.URL.createObjectURL(o);n.href=a,n.download=t,n.click(),document.body.removeChild(n),setTimeout(function(){window.URL.revokeObjectURL(a)},1e3),gDisplayedName=t,gABCFromFile=!0,document.getElementById("abc-selected").innerText=t,gIsDirty=!1}).catch(e=>{var t="There was an issue converting the ABC to MusicXML.";t=makeCenteredPromptString(t),DayPilot.Modal.alert(t,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})})}function doSaveABCFile(e,t){if(e.endsWith(".xml")||e.endsWith(".XML"))return sendGoogleAnalytics("export","SaveXML"),void SaveABCAsMusicXML(getTuneByIndex(0),e);sendGoogleAnalytics("export","SaveABC"),isPureDesktopBrowser()?e.endsWith(".abc")||e.endsWith(".txt")||e.endsWith(".ABC")||e.endsWith(".TXT")||(e=e.replace(/\..+$/,""),e+=".abc"):(e=e.replace(/\..+$/,""),e+=".txt");var n=document.createElement("a");document.body.appendChild(n),n.style="display: none";var o=new Blob([t],{type:"text/plain"}),a=window.URL.createObjectURL(o);n.href=a,n.download=e,n.click(),document.body.removeChild(n),setTimeout(function(){window.URL.revokeObjectURL(a)},1e3),gDisplayedName=e,gABCFromFile=!0,document.getElementById("abc-selected").innerText=e,gIsDirty=!1}function saveABCFile(e,t,n){DayPilot.Modal.prompt(e,t,{theme:"modal_flat",top:200,autoFocus:!1,scrollWithPage:AllowDialogsToScroll()}).then(function(e){var t=e.result;return null==t||0==(t=cleanFileName(t)).length?null:void doSaveABCFile(t,n)})}function saveTextFile(e,t,n){DayPilot.Modal.prompt(e,t,{theme:"modal_flat",top:200,autoFocus:!1,scrollWithPage:AllowDialogsToScroll()}).then(function(e){var t=e.result;if(null==t)return null;if(0==(t=cleanFileName(t)).length)return null;isPureDesktopBrowser()&&(t.endsWith(".txt")||t.endsWith(".TXT"))||(t=t.replace(/\..+$/,""),t+=".txt");var o=document.createElement("a");document.body.appendChild(o),o.style="display: none";var a=new Blob([n],{type:"text/plain"}),l=window.URL.createObjectURL(a);o.href=l,o.download=t,o.click(),document.body.removeChild(o),setTimeout(function(){window.URL.revokeObjectURL(l)},1e3)})}function saveTextFileDeveloper(e,t,n){DayPilot.Modal.prompt(e,t,{theme:"modal_flat",top:200,autoFocus:!1,scrollWithPage:AllowDialogsToScroll()}).then(function(e){var t=e.result;if(null==t)return null;if(0==(t=cleanFileName(t)).length)return null;isPureDesktopBrowser()||(t=t.replace(/\..+$/,""),t+=".txt");var o=document.createElement("a");document.body.appendChild(o),o.style="display: none";var a=new Blob([n],{type:"text/plain"}),l=window.URL.createObjectURL(a);o.href=l,o.download=t,o.click(),document.body.removeChild(o),setTimeout(function(){window.URL.revokeObjectURL(l)},1e3)})}function saveCSVFile(e,t,n){DayPilot.Modal.prompt(e,t,{theme:"modal_flat",top:200,autoFocus:!1,scrollWithPage:AllowDialogsToScroll()}).then(function(e){var t=e.result;if(null==t)return null;if(0==(t=cleanFileName(t)).length)return null;t=t.replace(/\..+$/,""),t+=".csv";var o=document.createElement("a");document.body.appendChild(o),o.style="display: none";var a=new Blob([n],{type:"text/csv"}),l=window.URL.createObjectURL(a);o.href=l,o.download=t,o.click(),document.body.removeChild(o),setTimeout(function(){window.URL.revokeObjectURL(l)},1e3)})}function CopyToClipboard(e){try{if(navigator.clipboard&&window.isSecureContext)return navigator.clipboard.writeText(e);{let t=document.createElement("textarea");return t.value=e,t.style.position="fixed",t.style.left="-999999px",t.style.top="-999999px",document.body.appendChild(t),t.focus(),t.select(),new Promise((e,n)=>{document.execCommand("copy")?e():n(),t.remove()})}}catch(e){console.log("CopyToClipboard error: "+e)}}function OverrideOneTuneMIDIParams(e,t,n,o,a,l,r){var i=e,s=gTheActiveSoundFont,c=!1,g="%abcjs_soundfont ",d=/%abcjs_soundfont .+\s*/gm,u=e.match(d);if(u&&u.length>0?c=!0:(d=/%soundfont .+\s*/gm,(u=e.match(d))&&u.length>0&&(c=!0,g="%soundfont ")),c){var m="fluid";-1!=t.indexOf("FluidR3_GM")?m="fluid":-1!=t.indexOf("Musyng")?m="musyng":-1!=t.indexOf("fatboy")?m="fatboy":-1!=t.indexOf("canvas")?m="canvas":-1!=t.indexOf("mscore")?m="mscore":-1!=t.indexOf("arachno")?m="arachno":-1!=t.indexOf("fluidhq")&&(m="fluidhq");for(var p=0;p<u.length;++p)i=i.replace(u[p].trim(),g+m),s!=t&&(gTheActiveSoundFont=t,gSoundsCacheABCJS={})}d=/%%MIDI program \d+\s*/gm;var h=e.match(d);if(h&&h.length>0)for(p=0;p<h.length;++p)i=i.replace(h[p].trim(),"%%MIDI program "+n);d=/%%MIDI bassprog \d+\s*/gm;var f=e.match(d);if(f&&f.length>0)for(p=0;p<f.length;++p)i=i.replace(f[p].trim(),"%%MIDI bassprog "+o);d=/%%MIDI chordprog \d+\s*/gm;var b=e.match(d);if(b&&b.length>0)for(p=0;p<b.length;++p)i=i.replace(b[p].trim(),"%%MIDI chordprog "+a);d=/%%MIDI bassvol \d+\s*/gm;var y=e.match(d);if(y&&y.length>0)for(p=0;p<y.length;++p)i=i.replace(y[p].trim(),"%%MIDI bassvol "+l);d=/%%MIDI chordvol \d+\s*/gm;var T=e.match(d);if(T&&T.length>0)for(p=0;p<T.length;++p)i=i.replace(T[p].trim(),"%%MIDI chordvol "+r);return i}function FindPreTuneHeader(e){var t=e.search(/^X:.*[\r\n]*/m);return-1==t||0==t?"":e.substring(0,t)}function InjectRepeatsAndClickTrackAll(){sendGoogleAnalytics("dialog","InjectRepeatsAndClickTrackAll");var e=CountTunes();if(0==e)return;const t=[{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Inject Repeats and Two-Bar Silence and/or Click Intros&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#injectrepeatsandtwobarclickintros" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="margin-top:24px;margin-bottom:24px;font-size:12pt;line-height:18pt;font-family:helvetica">This will inject repeats into each tune in the ABC area by  appending the entire ABC for each tune to itself multiple times.</p>'},{html:'<p style="margin-top:24px;margin-bottom:24px;font-size:12pt;line-height:18pt;font-family:helvetica">You may also optionally inject two bars of silence and/or a click intro before each tune.</p>'},{name:"How many times through each tune:",id:"configure_repeats",type:"number",cssClass:"configure_repeats_form_text"},{name:"Before each tune:",id:"configure_before_each_tune",type:"select",options:[{name:"Do nothing",id:0},{name:"Inject two bars of silence",id:1},{name:"Inject a two-bar style-appropriate click intro",id:2},{name:"Inject both two bars of silence and click intro",id:3}],cssClass:"configure_mp3_before_tune_select"},{html:'<p style="margin-top:16px;font-size:12pt;line-height:18pt;font-family:helvetica"><strong>To append two-bars of silence and/or a click intro before each tune:</strong></p>'},{html:'<p style="margin-top:16px;font-size:12pt;line-height:18pt;font-family:helvetica">1) Set <strong>How many times through each tune:</strong> to 1</p>'},{html:'<p style="margin-top:16px;font-size:12pt;line-height:18pt;font-family:helvetica">2) Select your option for silence and/or click intro from the <strong>Before each tune:</strong> dropdown.</p>'},{html:'<p style="margin-top:16px;font-size:12pt;line-height:18pt;font-family:helvetica">3) Click <strong>OK</strong>.</p>'},{html:'<p style="margin-top:16px;font-size:12pt;line-height:18pt;font-family:helvetica"><strong>For best results when repeating tunes:<strong></p>'},{html:'<p style="margin-top:16px;font-size:12pt;line-height:18pt;font-family:helvetica">For clean repeats, your tunes must not have extraneous pickup or trailing notes and must have proper and complete timing.</p>'},{html:'<p style="margin-top:16px;font-size:12pt;line-height:18pt;font-family:helvetica">If there is a repeat at the end of the first part of a tune, either standalone or in a first ending, there must be a matching |: bar at the start of the tune for the tune repeats to work properly.</p>'}];DayPilot.Modal.form(t,{configure_repeats:1,configure_before_each_tune:0},{theme:"modal_flat",top:100,width:760,scrollWithPage:AllowDialogsToScroll(),okText:"Inject",autoFocus:!1}).then(function(t){if(!t.canceled){var n=t.result.configure_repeats;if(null==n)return;if(repeatCount=parseInt(n),isNaN(repeatCount)||null==repeatCount)return;if(repeatCount<1)return;var o=!1,a=!1;switch(t.result.configure_before_each_tune){case 0:o=!1,a=!1;break;case 1:o=!1,a=!0;break;case 2:o=!0,a=!1;break;case 3:o=!0,a=!0}var l=FindPreTuneHeader(getABCEditorText());clearGetTuneByIndexCache();for(var r=0;r<e;++r){var i=getTuneByIndex(r);l+=i=AddDuplicatesForMp3(i,getTuneRhythmType(i),repeatCount,o,a),l+="\n\n"}setABCEditorText(l),gIsDirty=!0;var s="Repeats injected!";s=makeCenteredPromptString(s),DayPilot.Modal.alert(s,{theme:"modal_flat",top:300,scrollWithPage:AllowDialogsToScroll()}).then(function(){RenderAsync(!0,null,function(){ensureMoreToolsVisible(),gEnableSyntax?(gTheCM.selectionStart=0,gTheCM.selectionEnd=0):(gTheABC.selectionStart=0,gTheABC.selectionEnd=0),FocusAfterOperation()})})}})}function InjectStringAboveTuneHeaderConditional(e,t){return-1==e.indexOf(t)?InjectStringAboveTuneHeader(e,t):e}function InjectStringAboveTuneHeader(e,t){var n=e.split("\n"),o="",a="";for(i=0;i<n.length;++i){var l=(a=n[i]).split("");"|"!=l[0]&&"["!=l[0]&&":"==l[1]?(o+=a+"\n","X"==l[0]&&(o+=t+"\n")):(o+=a,i!=n.length-1&&(o+="\n"))}return o}function InjectStringBelowTuneHeaderConditional(e,t){return-1==e.indexOf(t)?InjectStringBelowTuneHeader(e,t):e}function InjectStringBelowTuneHeader(e,t){if(isSectionHeader(e))return e;for(var n,o=e,a=removeABCTuneHeaders(e=e.trim()),l=(a=a.trim()).split("\n"),r=l.length,i=!1,s=!1,c=!1,g=0;g<r;++g)if((n=l[g].trim()).startsWith("%%begintext"))s=!0;else if(n.startsWith("%%endtext"))s=!1;else if(n.startsWith("%%begincss"))c=!0;else if(n.startsWith("%%endtext"))c=!1;else if(!(s||c||n.startsWith("%")||""===n||n.startsWith("X:"))){i=!0;var d=a.indexOf(l[g]);a=a.substring(d);break}if(!i)return o;var u=e.indexOf(n);return e=e.substring(0,u),e+=t,e+="\n"+a+"\n\n"}function InjectOneTuneStaffWidth(e,t){return InjectStringBelowTuneHeader(e,"%%staffwidth "+t)}function InjectOneTuneLargePrint(e,t){return InjectStringBelowTuneHeader(e,"%\n% Adjust these values to produce the desired results:\n%\n%%noexpandtowidest\n%%leftmargin 0\n%%rightmargin 0\n%%staffwidth "+t+"\n%")}function InjectOneTuneSoundfont(e,t){return InjectStringBelowTuneHeader(e,"% Soundfont: "+t+"\n%soundfont "+t)}function InjectSectionHeader(){if(gRenderingPDF)return;sendGoogleAnalytics("dialog","InjectSectionHeader");DayPilot.Modal.form([{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Inject PDF Tunebook Section Header&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#pdf_section_headers" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="margin-top:36px;font-size:12pt;line-height:18pt;font-family:helvetica">This will inject a PDF section header placeholder tune into the ABC.</p>'},{html:'<p style="font-size:12pt;line-height:18pt;font-family:helvetica">The section header will be displayed on its own line in the PDF Table of Contents and Index.</p>'},{html:'<p style="font-size:12pt;line-height:18pt;font-family:helvetica">Clicking on the section header in the PDF Table of Contents or Index will jump to the section.</p>'},{html:'<p style="margin-bottom:36px;font-size:12pt;line-height:18pt;font-family:helvetica">The * at the start of the injected tune title marks the tune as a PDF section header.</p>'},{name:"Section name to inject",id:"configure_sectionheader",type:"text",cssClass:"configure_sectionheader_form_text"}],{configure_sectionheader:"Section Name"},{theme:"modal_flat",top:100,width:760,scrollWithPage:AllowDialogsToScroll(),okText:"Inject",autoFocus:!0}).then(function(e){if(!e.canceled){var t,n,o,a=e.result.configure_sectionheader;if(null==a)return;gEnableSyntax?(t=gTheCM.selectionStart,n=getABCEditorText().substring(0,t),o=getABCEditorText().substring(t)):(t=gTheABC.selectionStart,n=getABCEditorText().substring(0,t),o=getABCEditorText().substring(t)),setABCEditorText(n+"\nX:1\nT:*"+a+"\n"+o),gIsDirty=!0;var l="Section header injected!";l=makeCenteredPromptString(l),DayPilot.Modal.alert(l,{theme:"modal_flat",top:300,scrollWithPage:AllowDialogsToScroll()}).then(function(){RenderAsync(!0,null,function(){ensureMoreToolsVisible(),gEnableSyntax?(gTheCM.selectionStart=t,gTheCM.selectionEnd=t):(gTheABC.selectionStart=t,gTheABC.selectionEnd=t),FocusAfterOperation()})})}})}var gIdleHeaderInjectValue="",gFileHeaderDirectives="";function idleHeaderInject(){gIdleHeaderInjectValue=document.getElementById("headers_to_inject").value}function keydownHeaderInject(e){e.stopPropagation()}function GetABCFileHeader(){var e=FindPreTuneHeader(getABCEditorText());if(0==e.length)return"";var t="",n=e.split("\n");const o=[/^%%\S+font.*$/,/^%%\S+margin.*$/,/^%%staffsep.*$/,/^%%staffwidth.*$/,/^%%stretchlast.*$/,/^%%leftmargin.*$/,/^%%rightmargin.*$/,/^%%scale.*$/,/^%%barnumbers.*$/,/^%%barsperstaff.*$/,/^%%\S+space.*$/,/^%%\S+sep.*$/,/^%%measure\S+.*$/,/^%%printtempo.*$/,/^%%titleleft.*$/,/^%%keywarn.*$/,/^%%titlecaps.*$/,/^%%visualtranspose.*$/,/^%%maxstaves.*$/,/^%hide_first_title_on_play.*$/,/^%hide_vskip_on_play.*$/,/^%left_justify_titles.*$/,/^%abcjs_render_params.*$/,/^%hide_information_labels.*$/,/^%hide_rhythm_tag.*$/,/^%hide_composer_tag.*$/,/^%hide_parts_tag.*$/,/^%hide_part_tags.*$/,/^%hide_player_part_tags.*$/,/^%hide_dynamics.*$/,/^%whistle_tab_key.*$/,/^%whistle_tab_octave.*$/,/^%recorder_tab_key.*$/,/^%recorder_tab_octave.*$/,/^%enable_hyperlinks.*$/,/^%disable_hyperlinks.*$/,/^%play_alternate_chords.*$/,/^%hide_cautionary_ks.*$/,/^%no_title_reverser.*$/,/^%force_power_chords.*$/,/^%custom_instrument_volume_scale.*$/,/^%custom_instrument_1_volume_scale.*$/,/^%custom_instrument_2_volume_scale.*$/,/^%custom_instrument_3_volume_scale.*$/,/^%custom_instrument_4_volume_scale.*$/,/^%custom_instrument_5_volume_scale.*$/,/^%custom_instrument_6_volume_scale.*$/,/^%custom_instrument_7_volume_scale.*$/,/^%custom_instrument_8_volume_scale.*$/,/^%custom_instrument_fade.*$/,/^%custom_instrument_1_fade.*$/,/^%custom_instrument_2_fade.*$/,/^%custom_instrument_3_fade.*$/,/^%custom_instrument_4_fade.*$/,/^%custom_instrument_5_fade.*$/,/^%custom_instrument_6_fade.*$/,/^%custom_instrument_7_fade.*$/,/^%custom_instrument_8_fade.*$/,/^%roll_2_params.*$/,/^%roll_3_params.*$/,/^[ABCDFGHILMmNORrSUZ]:/];let a=!1;return n.forEach(function(e){if("%%begincss"===e.trim()&&(a=!0),a)return t+=e+"\n",void("%%endcss"===e.trim()&&(a=!1));for(const n of o)if(n.test(e)){t+=e+"\n";break}}),""!=t&&(t+="\n"),t}function IdleFileHeaderInject(){gFileHeaderDirectives="";var e=document.getElementById("injectheaderstringfh_holder");if(e){e.style.display="none";var t=GetABCFileHeader();""!=t&&(gFileHeaderDirectives=t,(e=document.getElementById("injectheaderstringfh_holder"))&&(e.style.display="block"))}}function InjectABCFileHeaderDirectives(){var e=document.getElementById("headers_to_inject");e&&(e.value+=gFileHeaderDirectives,gIdleHeaderInjectValue=e.value)}function InjectHeaderString(){if(gRenderingPDF)return;var e=findSelectedTuneIndex();var t=[{html:'<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">Inject ABC Header Text&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#advanced_injectabcheader" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="margin-top:24px;margin-bottom:36px;font-size:12pt;line-height:18pt;font-family:helvetica;text-align:center">Clicking "Inject" will inject the text into the header of your ABC tune(s).</p>'},{name:"Header inject location:",id:"injectlocation",type:"select",options:[{name:"  Top",id:0},{name:"  Bottom",id:1}],cssClass:"configure_injectheaderstring_select"},{html:'<p style="font-size:12pt;line-height:18pt;font-family:helvetica;">Header text to inject:</p><textarea id="headers_to_inject" style="font-family:Courier;font-size:13pt;line-height:16pt;width:578px;height:340px;padding:6px" placeholder="Enter header text to inject here" spellcheck="false" autocorrect="off" autocapitalize="none" oninput="idleHeaderInject()" onkeydown="keydownHeaderInject(event)"></textarea>'},{name:"          Inject all tunes",id:"injectalltunes",type:"checkbox",cssClass:"configure_injectheaderstring_form_text"},{html:'<p id="injectheaderstringfh_holder" style="text-align:center;margin-top:24px;display:none;"><input id="injectheaderstringfh" class="advancedcontrols btn btn-injectcontrols-headers" onclick="InjectABCFileHeaderDirectives();" type="button" value="Add ABC File Header Directives" title="Adds any ABC directives found in the file header to the text area above"></p>'}];gIdleHeaderInjectValue="",gFileHeaderDirectives="",setTimeout(function(){IdleFileHeaderInject()},200);DayPilot.Modal.form(t,{injectlocation:1,injectalltunes:!0},{theme:"modal_flat",top:100,width:650,scrollWithPage:AllowDialogsToScroll(),okText:"Inject",autoFocus:!1}).then(function(t){if(sendGoogleAnalytics("action","InjectHeaderString"),!t.canceled){var n=t.result.injectlocation,o=t.result.injectalltunes,a=gIdleHeaderInjectValue;if(""!=(a=a.trim()))if(o){for(var l=CountTunes(),r=getABCEditorText(),i=r.split(/^X:/gm),s=FindPreTuneHeader(r),c=1;c<=l;++c){var g="X:"+i[c];s+=0==n?InjectStringAboveTuneHeader(g,a):InjectStringBelowTuneHeader(g,a)}setABCEditorText(s),gIsDirty=!0,p=makeCenteredPromptString(p="ABC header text injected!"),DayPilot.Modal.alert(p,{theme:"modal_flat",top:300,scrollWithPage:AllowDialogsToScroll()}).then(function(){RenderAsync(!0,null,function(){ensureMoreToolsVisible(),gEnableSyntax?(gTheCM.selectionStart=0,gTheCM.selectionEnd=0):(gTheABC.selectionStart=0,gTheABC.selectionEnd=0),FocusAfterOperation()})})}else{var d=findSelectedTune();if(""==d)return;var u,m=d;m=(m=0==n?InjectStringAboveTuneHeader(m,a):InjectStringBelowTuneHeader(m,a)).replace("\n\n",""),u=gEnableSyntax?gTheCM.selectionStart:gTheABC.selectionStart;var p,h=getABCEditorText();setABCEditorText(h=h.replace(d,m)),gIsDirty=!0,p=makeCenteredPromptString(p="ABC header text injected!"),DayPilot.Modal.alert(p,{theme:"modal_flat",top:300,scrollWithPage:AllowDialogsToScroll()}).then(function(){RenderAsync(!1,e,function(){ensureMoreToolsVisible(),gEnableSyntax?(gTheCM.selectionStart=u,gTheCM.selectionEnd=u):(gTheABC.selectionStart=u,gTheABC.selectionEnd=u),FocusAfterOperation()})})}}})}function abcPitchToRank(e){const t=e.match(/^([_=^]*|_+)([a-gA-G])([,']*)$/);if(!t)return-1;let[,n,o,a]=t,l={C:0,D:2,E:4,F:5,G:7,A:9,B:11}[o.toUpperCase()];if(void 0===l)return-1;let r=0;if(n){r=(n.match(/\^/g)||[]).length-(n.match(/_/g)||[]).length}let i=0;return a.includes(",")?i=-12*a.split(",").length:a.includes("'")&&(i=12*a.split("'").length),o>="a"&&o<="g"&&(i+=12),60+l+r+i}function isStrictlyIncreasingABCNotes(e){const t=e.map(abcPitchToRank);if(t.includes(-1))return!1;if(new Set(t).size!==t.length)return!1;for(let e=1;e<t.length;e++)if(t[e]<=t[e-1])return!1;return!0}var gCustomStringedCount=6,gCustomStringedCapo=0,gCustomStringedString1="D,",gCustomStringedString2="A,",gCustomStringedString3="D",gCustomStringedString4="G",gCustomStringedString5="B",gCustomStringedString6="e",gCustomStringedLabel="Guitar - Drop D";function InjectCustomStringedInstrumentTab(){if(gRenderingPDF)return;sendGoogleAnalytics("dialog","InjectCustomStringedInstrumentTab");const e={custom_string_count:gCustomStringedCount,custom_string_capo:gCustomStringedCapo,custom_string1:gCustomStringedString1,custom_string2:gCustomStringedString2,custom_string3:gCustomStringedString3,custom_string4:gCustomStringedString4,custom_string5:gCustomStringedString5,custom_string6:gCustomStringedString6,custom_string_label:gCustomStringedLabel,configure_inject_all:!0};DayPilot.Modal.form([{html:'<p style="text-align:center;margin-bottom:32px;font-size:16pt;font-family:helvetica;margin-left:15px;">Inject Custom Stringed Instrument Tab Annotation&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#custom_string_tab" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="margin-top:20px;margin-bottom:20px;font-size:12pt;line-height:18pt;font-family:helvetica">This will inject an %abcjs_rendering_params annotation into the ABC tune(s) to generate custom stringed instrument tablature. </p>'},{html:'<p style="margin-top:20px;margin-bottom:20px;font-size:12pt;line-height:18pt;font-family:helvetica">Strings are numbered from low to high and use ABC pitch names.</p>'},{html:'<p style="margin-top:20px;margin-bottom:24px;font-size:12pt;line-height:18pt;font-family:helvetica">Each string must have a different pitch and be higher than the previous one.</p>'},{name:"Label:",id:"custom_string_label",type:"text",cssClass:"configure_customstring_form_text_wide"},{name:"# of strings: (4, 5, or 6)",id:"custom_string_count",type:"number",cssClass:"configure_customstring_form_text"},{name:"String 1 pitch:",id:"custom_string1",type:"text",cssClass:"configure_customstring_form_text"},{name:"String 2 pitch:",id:"custom_string2",type:"text",cssClass:"configure_customstring_form_text"},{name:"String 3 pitch:",id:"custom_string3",type:"text",cssClass:"configure_customstring_form_text"},{name:"String 4 pitch:",id:"custom_string4",type:"text",cssClass:"configure_customstring_form_text"},{name:"String 5 pitch:",id:"custom_string5",type:"text",cssClass:"configure_customstring_form_text"},{name:"String 6 pitch:",id:"custom_string6",type:"text",cssClass:"configure_customstring_form_text"},{name:"Capo position",id:"custom_string_capo",type:"number",cssClass:"configure_customstring_form_text"},{name:"            Inject all tunes",id:"configure_inject_all",type:"checkbox",cssClass:"configure_customstring_form_text_checkbox"}],e,{theme:"modal_flat",top:50,width:650,scrollWithPage:AllowDialogsToScroll(),okText:"Inject",autoFocus:!1}).then(function(e){if(!e.canceled){var t=e.result.custom_string_count;if(t=parseInt(t),isNaN(t))return h=makeCenteredPromptString(h="String count must be a number."),void DayPilot.Modal.alert(h,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});var n=e.result.custom_string_capo;if(n=parseInt(n),isNaN(n))return h=makeCenteredPromptString(h="Capo position must be a number."),void DayPilot.Modal.alert(h,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});if(n<0)return h=makeCenteredPromptString(h="Capo position must be a positive integer."),void DayPilot.Modal.alert(h,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});if(4==t)0;else if(5==t)0;else{if(6!=t)return h=makeCenteredPromptString(h="Only 4, 5, or 6 string custom instrument tablature supported."),void DayPilot.Modal.alert(h,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});0}var o=[];switch(t){case 4:o=[e.result.custom_string1,e.result.custom_string2,e.result.custom_string3,e.result.custom_string4];break;case 5:o=[e.result.custom_string1,e.result.custom_string2,e.result.custom_string3,e.result.custom_string4,e.result.custom_string5];break;case 6:o=[e.result.custom_string1,e.result.custom_string2,e.result.custom_string3,e.result.custom_string4,e.result.custom_string5,e.result.custom_string6]}if(!isStrictlyIncreasingABCNotes(o))return h=makeCenteredPromptString(h="Strings must be in increasing pitch with no duplicates."),void DayPilot.Modal.alert(h,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});gCustomStringedLabel=e.result.custom_string_label,gCustomStringedCount=t,gCustomStringedCapo=n,gCustomStringedString1=e.result.custom_string1,gCustomStringedString2=e.result.custom_string2,gCustomStringedString3=e.result.custom_string3,gCustomStringedString4=e.result.custom_string4,gCustomStringedString5=e.result.custom_string5,gCustomStringedString6=e.result.custom_string6,SaveConfigurationSettings();var a="%\n% Custom stringed instrument tablature definition:\n%\n",l=gCustomStringedLabel;switch(gCustomStringedCount){case 4:a+='%abcjs_render_params {"tablature":[{"instrument":"violin","label":"'+l+'","tuning":["'+gCustomStringedString1+'","'+gCustomStringedString2+'","'+gCustomStringedString3+'","'+gCustomStringedString4+'"],"highestNote":"f\'","capo":'+gCustomStringedCapo+"}]}\n%";break;case 5:a+='%abcjs_render_params {"tablature":[{"instrument":"fivestring","label":"'+l+'","tuning":["'+gCustomStringedString1+'","'+gCustomStringedString2+'","'+gCustomStringedString3+'","'+gCustomStringedString4+'","'+gCustomStringedString5+'"],"highestNote":"f\'","capo":'+gCustomStringedCapo+"}]}\n%";break;case 6:a+='%abcjs_render_params {"tablature":[{"instrument":"guitar","label":"'+l+'","tuning":["'+gCustomStringedString1+'","'+gCustomStringedString2+'","'+gCustomStringedString3+'","'+gCustomStringedString4+'","'+gCustomStringedString5+'","'+gCustomStringedString6+'"],"highestNote":"f\'","capo":'+gCustomStringedCapo+"}]}\n%"}if(e.result.configure_inject_all){for(var r=CountTunes(),i=getABCEditorText(),s=i.split(/^X:/gm),c=FindPreTuneHeader(i),g=1;g<=r;++g)s[g]="X:"+s[g],s[g]=s[g].replace(/^%\s*\n^%\s*Custom stringed instrument tablature definition:[\s\S]*?^%abcjs_render_params[^\n]*\n?(^%\s*\n)?/gm,""),s[g]=s[g].replace(/^%abcjs_render_params[^\n]*\n?/gm,""),c+=InjectStringBelowTuneHeader(s[g],a);setABCEditorText(c),gIsDirty=!0,h=makeCenteredPromptString(h="Custom stringed instrument tablature injected!"),DayPilot.Modal.alert(h,{theme:"modal_flat",top:300,scrollWithPage:AllowDialogsToScroll()}).then(function(){RenderAsync(!0,null,function(){ensureMoreToolsVisible(),gEnableSyntax?(gTheCM.selectionStart=0,gTheCM.selectionEnd=0):(gTheABC.selectionStart=0,gTheABC.selectionEnd=0),FocusAfterOperation()})})}else{var d=findSelectedTune(),u=findSelectedTuneIndex();if(""==d)return;var m,p=d;p=(p=InjectStringBelowTuneHeader(p=(p=p.replace(/^%\s*\n^%\s*Custom stringed instrument tablature definition:[\s\S]*?^%abcjs_render_params[^\n]*\n?(^%\s*\n)?/gm,"")).replace(/^%abcjs_render_params[^\n]*\n?/gm,""),a)).replace("\n\n",""),m=gEnableSyntax?gTheCM.selectionStart:gTheABC.selectionStart;var h,f=getABCEditorText();setABCEditorText(f=f.replace(d,p)),gIsDirty=!0,h=makeCenteredPromptString(h="Custom stringed instrument tablature injected!"),DayPilot.Modal.alert(h,{theme:"modal_flat",top:300,scrollWithPage:AllowDialogsToScroll()}).then(function(){RenderAsync(!1,u,function(){ensureMoreToolsVisible(),gEnableSyntax?(gTheCM.selectionStart=m,gTheCM.selectionEnd=m):(gTheABC.selectionStart=m,gTheABC.selectionEnd=m),FocusAfterOperation()})})}}})}const gTheFontInjectData={configure_injectall:!0,configure_titlefont:!1,configure_subtitlefont:!1,configure_infofont:!1,configure_partsfont:!1,configure_tempofont:!1,configure_textfont:!1,configure_composerfont:!1,configure_annotationfont:!1,configure_gchordfont:!1,configure_vocalfont:!1,configure_wordsfont:!1,configure_tablabelfont:!1,configure_tabnumberfont:!1,configure_tabgracefont:!1,configure_historyfont:!1,configure_voicefont:!1};function InjectFontSettings(){if(gRenderingPDF)return;var e=findSelectedTuneIndex(),t=[{html:'<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">Inject Font Settings&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#advanced_inject_font_settings" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="margin-top:24px;margin-bottom:24px;font-size:12pt;line-height:18pt;font-family:helvetica;text-align:center">Click "Inject" to inject the checked fonts below from your Font Settings into the tunes.</p>'},{name:"Title font: "+gRenderingFonts.titlefont,id:"configure_titlefont",type:"checkbox",cssClass:"configure_injectfontstring_form_text"},{name:"Subtitle font: "+gRenderingFonts.subtitlefont,id:"configure_subtitlefont",type:"checkbox",cssClass:"configure_injectfontstring_form_text"},{name:"Info font: "+gRenderingFonts.infofont,id:"configure_infofont",type:"checkbox",cssClass:"configure_injectfontstring_form_text"},{name:"Parts font: "+gRenderingFonts.partsfont,id:"configure_partsfont",type:"checkbox",cssClass:"configure_injectfontstring_form_text"},{name:"Tempo font: "+gRenderingFonts.tempofont,id:"configure_tempofont",type:"checkbox",cssClass:"configure_injectfontstring_form_text"},{name:"Text font: "+gRenderingFonts.textfont,id:"configure_textfont",type:"checkbox",cssClass:"configure_injectfontstring_form_text"},{name:"Composer font: "+gRenderingFonts.composerfont,id:"configure_composerfont",type:"checkbox",cssClass:"configure_injectfontstring_form_text"},{name:"Annotation font: "+gRenderingFonts.annotationfont,id:"configure_annotationfont",type:"checkbox",cssClass:"configure_injectfontstring_form_text"},{name:"Guitar chord font: "+gRenderingFonts.gchordfont,id:"configure_gchordfont",type:"checkbox",cssClass:"configure_injectfontstring_form_text"},{name:"Vocal font: "+gRenderingFonts.vocalfont,id:"configure_vocalfont",type:"checkbox",cssClass:"configure_injectfontstring_form_text"},{name:"Words font: "+gRenderingFonts.wordsfont,id:"configure_wordsfont",type:"checkbox",cssClass:"configure_injectfontstring_form_text"},{name:"Tab label font: "+gRenderingFonts.tablabelfont,id:"configure_tablabelfont",type:"checkbox",cssClass:"configure_injectfontstring_form_text"},{name:"Tab number font: "+gRenderingFonts.tabnumberfont,id:"configure_tabnumberfont",type:"checkbox",cssClass:"configure_injectfontstring_form_text"},{name:"Tab grace font: "+gRenderingFonts.tabgracefont,id:"configure_tabgracefont",type:"checkbox",cssClass:"configure_injectfontstring_form_text"},{name:"History font: "+gRenderingFonts.historyfont,id:"configure_historyfont",type:"checkbox",cssClass:"configure_injectfontstring_form_text"},{name:"Voice font: "+gRenderingFonts.voicefont,id:"configure_voicefont",type:"checkbox",cssClass:"configure_injectfontstring_form_text"},{html:'<p style="margin-top:0px;font-size:12pt;line-height:18pt;font-family:helvetica;text-align:center">&nbsp;</p>'},{name:"Inject all tunes ",id:"configure_injectall",type:"checkbox",cssClass:"configure_injectfontstring_form_text"}];DayPilot.Modal.form(t,gTheFontInjectData,{theme:"modal_flat",top:75,width:675,scrollWithPage:AllowDialogsToScroll(),okText:"Inject",autoFocus:!1}).then(function(t){if(sendGoogleAnalytics("action","InjectFontSettings"),!t.canceled){gTheFontInjectData.configure_injectall=!1,gTheFontInjectData.configure_titlefont=!1,gTheFontInjectData.configure_subtitlefont=!1,gTheFontInjectData.configure_infofont=!1,gTheFontInjectData.configure_partsfont=!1,gTheFontInjectData.configure_tempofont=!1,gTheFontInjectData.configure_textfont=!1,gTheFontInjectData.configure_composerfont=!1,gTheFontInjectData.configure_annotationfont=!1,gTheFontInjectData.configure_gchordfont=!1,gTheFontInjectData.configure_vocalfont=!1,gTheFontInjectData.configure_wordsfont=!1,gTheFontInjectData.configure_tablabelfont=!1,gTheFontInjectData.configure_tabnumberfont=!1,gTheFontInjectData.configure_tabgracefont=!1,gTheFontInjectData.configure_historyfont=!1,gTheFontInjectData.configure_voicefont=!1;var n=t.result.configure_injectall;n&&(gTheFontInjectData.configure_injectall=!0);var o="";if(t.result.configure_titlefont&&(gTheFontInjectData.configure_titlefont=!0,o+="%%titlefont "+gRenderingFonts.titlefont+"\n"),t.result.configure_subtitlefont&&(gTheFontInjectData.configure_subtitlefont=!0,o+="%%subtitlefont "+gRenderingFonts.subtitlefont+"\n"),t.result.configure_infofont&&(gTheFontInjectData.configure_infofont=!0,o+="%%infofont "+gRenderingFonts.infofont+"\n"),t.result.configure_partsfont&&(gTheFontInjectData.configure_partsfont=!0,o+="%%partsfont "+gRenderingFonts.partsfont+"\n"),t.result.configure_tempofont&&(gTheFontInjectData.configure_tempofont=!0,o+="%%tempofont "+gRenderingFonts.tempofont+"\n"),t.result.configure_textfont&&(gTheFontInjectData.configure_textfont=!0,o+="%%textfont "+gRenderingFonts.textfont+"\n"),t.result.configure_composerfont&&(gTheFontInjectData.configure_composerfont=!0,o+="%%composerfont "+gRenderingFonts.composerfont+"\n"),t.result.configure_annotationfont&&(gTheFontInjectData.configure_annotationfont=!0,o+="%%annotationfont "+gRenderingFonts.annotationfont+"\n"),t.result.configure_gchordfont&&(gTheFontInjectData.configure_gchordfont=!0,o+="%%gchordfont "+gRenderingFonts.gchordfont+"\n"),t.result.configure_vocalfont&&(gTheFontInjectData.configure_vocalfont=!0,o+="%%vocalfont "+gRenderingFonts.vocalfont+"\n"),t.result.configure_wordsfont&&(gTheFontInjectData.configure_wordsfont=!0,o+="%%wordsfont "+gRenderingFonts.wordsfont+"\n"),t.result.configure_tablabelfont&&(gTheFontInjectData.configure_tablabelfont=!0,o+="%%tablabelfont "+gRenderingFonts.tablabelfont+"\n"),t.result.configure_tabnumberfont&&(gTheFontInjectData.configure_tabnumberfont=!0,o+="%%tabnumberfont "+gRenderingFonts.tabnumberfont+"\n"),t.result.configure_tabgracefont&&(gTheFontInjectData.configure_tabgracefont=!0,o+="%%tabgracefont "+gRenderingFonts.tabgracefont+"\n"),t.result.configure_historyfont&&(gTheFontInjectData.configure_historyfont=!0,o+="%%historyfont "+gRenderingFonts.historyfont+"\n"),t.result.configure_voicefont&&(gTheFontInjectData.configure_voicefont=!0,o+="%%voicefont "+gRenderingFonts.voicefont+"\n"),""!=o)if(n){o+="\n";for(var a=CountTunes(),l=getABCEditorText(),r=l.split(/^X:/gm),i=FindPreTuneHeader(l),s=1;s<=a;++s){var c="X:"+r[s];i+=c=(c=InjectStringAboveTuneHeader(c,o)).replace("\n\n","")}setABCEditorText(i),gIsDirty=!0,m=makeCenteredPromptString(m="Fonts injected!"),DayPilot.Modal.alert(m,{theme:"modal_flat",top:300,scrollWithPage:AllowDialogsToScroll()}).then(function(){RenderAsync(!0,null,function(){ensureMoreToolsVisible(),gEnableSyntax?(gTheCM.selectionStart=0,gTheCM.selectionEnd=0):(gTheABC.selectionStart=0,gTheABC.selectionEnd=0),FocusAfterOperation()})})}else{var g=findSelectedTune();if(""==g)return;var d,u=g;u=(u=InjectStringAboveTuneHeader(u,o+="\n")).replace("\n\n",""),d=gEnableSyntax?gTheCM.selectionStart:gTheABC.selectionStart;var m,p=getABCEditorText();setABCEditorText(p=p.replace(g,u)),gIsDirty=!0,m=makeCenteredPromptString(m="Fonts injected!"),DayPilot.Modal.alert(m,{theme:"modal_flat",top:300,scrollWithPage:AllowDialogsToScroll()}).then(function(){RenderAsync(!1,e,function(){ensureMoreToolsVisible(),gEnableSyntax?(gTheCM.selectionStart=d,gTheCM.selectionEnd=d):(gTheABC.selectionStart=d,gTheABC.selectionEnd=d),FocusAfterOperation()})})}}})}var gNotationSpacingLeftMargin=15,gNotationSpacingRightMargin=15,gNotationSpacingStaffWidth=556,gNotationSpacingStaffSep=0,gNotationSpacingNoExpand=!1,gNotationCallback=null;function testSpacingChange(){var e;e=document.getElementById("layout_left_margin").value,isNaN(e)||(gNotationSpacingLeftMargin=e),e=document.getElementById("layout_right_margin").value,isNaN(e)||(gNotationSpacingRightMargin=e),e=document.getElementById("layout_staff_width").value,isNaN(e)||(gNotationSpacingStaffWidth=e),e=document.getElementById("layout_staff_sep").value,isNaN(e)||(gNotationSpacingStaffSep=e),gNotationSpacingNoExpand=document.getElementById("layout_inject_noexpand").checked,gNotationCallback&&gNotationCallback()}function NotationSpacingInject(){if(document.getElementById("layout_inject_all").checked){for(var e=CountTunes(),t=getABCEditorText(),n=t.split(/^X:/gm),o=FindPreTuneHeader(t),a=1;a<=e;++a){o+=InjectOneTuneSpacingHeader("X:"+n[a],gNotationSpacingStaffSep,gNotationSpacingLeftMargin,gNotationSpacingRightMargin,gNotationSpacingStaffWidth,gNotationSpacingNoExpand)}setABCEditorText(o),gIsDirty=!0,RenderAsync(!0,null,function(){DayPilot.Modal.alert('<p style="text-align:center;font-size:14pt;font-family:helvetica;">Spacing Injection Complete!</p>',{theme:"modal_flat",top:300,width:500,scrollWithPage:AllowDialogsToScroll()}).then(function(){ensureMoreToolsVisible(),gEnableSyntax?(gTheCM.selectionStart=0,gTheCM.selectionEnd=0):(gTheABC.selectionStart=0,gTheABC.selectionEnd=0),FocusAfterOperation()})})}else{var l=findSelectedTune();if(""==l)return;var r,i=findSelectedTuneIndex(),s=l;s=(s=InjectOneTuneSpacingHeader(s,gNotationSpacingStaffSep,gNotationSpacingLeftMargin,gNotationSpacingRightMargin,gNotationSpacingStaffWidth,gNotationSpacingNoExpand)).replace("\n\n",""),r=gEnableSyntax?gTheCM.selectionStart:gTheABC.selectionStart;var c=getABCEditorText();setABCEditorText(c=c.replace(l,s)),gIsDirty=!0,RenderAsync(!1,i,function(){DayPilot.Modal.alert('<p style="text-align:center;font-size:14pt;font-family:helvetica;">Spacing Injection Complete!</p>',{theme:"modal_flat",top:300,width:500,scrollWithPage:AllowDialogsToScroll()}).then(function(){ensureMoreToolsVisible(),gEnableSyntax?(gTheCM.selectionStart=r,gTheCM.selectionEnd=r):(gTheABC.selectionStart=r,gTheABC.selectionEnd=r),FocusAfterOperation()})})}}function InjectOneTuneSpacingHeader(e,t,n,o,a,l){var r="%%staffsep "+t+"\n%%leftmargin "+n+"\n%%rightmargin "+o+"\n%%staffwidth "+a+"\n%";return l&&(r="%%noexpandtowidest\n"+r),InjectStringBelowTuneHeader(e,r="%\n% Spacing values injected by the Notation Spacing Explorer:\n%\n"+r)}function NotationSpacingExplorer(){if(gAllowCopy&&!gRenderingPDF){sendGoogleAnalytics("dialog","NotationSpacingExplorer");var e=findSelectedTune();if(""!=e){var t=GetRadioValue("notenodertab"),n=GetABCJSParams(t);n.oneSvgPerLine=!1;var o='<div id="notationspacingexplorerholder" style="height:'+(window.innerHeight-360)+'px;overflow-y:auto;margin-bottom:15px;padding:4px;">';o+='<div id="notationspacingexplorer-paper"></div>',o+="</div>",o+='<p class="configure_layout_text" style="text-align:center;margin:0px;margin-top:12px;margin-bottom:20px">',o+="<span>Mode:</span> ",o+='<select id="layout_mode">',o+='<option value="scale">Scale-based (Auto-calculate margins)</option>',o+='<option value="manual">Manual (enter left and right margins)</option>',o+="</select>",o+='<span id="layout_scale_wrap" style="display:none">',o+="<span>Scale:</span> ",o+='<input style="width:80px;margin-right:14px;" id="layout_scale" type="number" min="0.125" max="1.00" step="0.01" title="Scale" autocomplete="off"/>',o+="</span>",o+="</p>",o+='<p class="configure_layout_text" style="text-align:center;margin:0px;margin-top:12px">',o+='<span>Staff Separation:</span> <input style="width:70px;margin-right:14px;" id="layout_staff_sep" type="number" min="-100" step="1" max="1000" title="Staff separation" autocomplete="off" onchange="testSpacingChange();"/>',o+='<span>Left Margin:</span>  <input style="width:70px;margin-right:14px;" id="layout_left_margin" type="number" min="0" step="1" max="1000" title="Left margin" autocomplete="off" onchange="testSpacingChange();"/>',o+='<span>Right Margin:</span> <input style="width:70px;margin-right:14px;" id="layout_right_margin" type="number" min="0" step="1" max="1000" title="Right margin" autocomplete="off" onchange="testSpacingChange();"/>',o+='<span>Staff Width:</span>  <input style="width:80px;margin-right:0px;"  id="layout_staff_width" type="number" min="0" step="1" max="2000" title="Staff width" autocomplete="off" onchange="testSpacingChange();"/>',o+="</p>",o+='<p class="configure_layout_text" style="text-align:center;margin:0px;margin-top:20px">',o+='<span style="font-size:12pt;font-family:helvetica;">Add %%noexpandtowidest:</span><input style="width:16px;margin-left:8px;margin-right:24px;" id="layout_inject_noexpand" type="checkbox" onchange="testSpacingChange();"/>',o+='<input id="notationspacingexplorertest" style="margin-right:36px;" class="notationspacingexplorerinject button btn btn-notationspacingexplorertest" type="button" value="Test Values" title="Tests the spacing changes ABC">',o+='<span style="font-size:12pt;font-family:helvetica;">Inject all tunes:</span><input style="width:16px;margin-left:8px;margin-right:24px;" id="layout_inject_all" type="checkbox"/>',o+='<input id="notationspacingexplorerinject" class="notationspacingexplorerinject button btn btn-notationspacingexplorerinject" type="button" style="margin-right:0px;" value="Inject Spacing into the ABC" title="Injects the spacing values into the ABC">',o+="</p>",o+='<a id="notationspacingexplorer_help" href="https://michaeleskin.com/abctools/userguide.html#advanced_notationspacingexplorer" target="_blank" style="text-decoration:none;" title="Learn more about the Notation Spacing Explorer" class="dialogcornerbutton">?</a>';var a,l=window.innerWidth,r=GetABCFileHeader();isDesktopBrowser()?(a=giPadTwoColumn?isLandscapeOrientation()?l*(gPlayerScaling/100):.9*l:l*(gPlayerScaling/100))<850&&(a=850):a=800;var i=/^X:.*$/gm;hasStaffSep(r)||(e=e.replace(i,"X:1\n%%staffsep "+gStaffSpacing));var s=e;DayPilot.Modal.alert(o,{theme:"modal_flat",top:20,width:a,okText:"Close",scrollWithPage:isMobileBrowser()}),gNotationSpacingLeftMargin=15,i=/^%%leftmargin.*$/m;var c=e.match(i);if(c&&c.length>0){d=(d=c[0].replace("%%leftmargin","")).trim();var g=parseInt(d);isNaN(g)||(gNotationSpacingLeftMargin=g)}if(gNotationSpacingRightMargin=15,i=/^%%rightmargin.*$/gm,(c=e.match(i))&&c.length>0){d=(d=c[c.length-1].replace("%%rightmargin","")).trim();g=parseInt(d);isNaN(g)||(gNotationSpacingRightMargin=g)}if(gNotationSpacingStaffWidth=556,i=/^%%staffwidth.*$/gm,(c=e.match(i))&&c.length>0){d=(d=c[c.length-1].replace("%%staffwidth","")).trim();g=parseInt(d);isNaN(g)||(gNotationSpacingStaffWidth=g)}if(gNotationSpacingStaffSep=gStaffSpacing,i=/^%%staffsep.*$/gm,(c=e.match(i))&&c.length>0){var d;d=(d=c[c.length-1].replace("%%staffsep","")).trim();g=parseInt(d);isNaN(g)||(gNotationSpacingStaffSep=g)}gNotationSpacingNoExpand=!1,i=/^%%noexpandtowidest.*$/m,(c=e.match(i))&&c.length>0&&(gNotationSpacingNoExpand=!0),document.getElementById("layout_left_margin").value=gNotationSpacingLeftMargin,document.getElementById("layout_right_margin").value=gNotationSpacingRightMargin,document.getElementById("layout_staff_width").value=gNotationSpacingStaffWidth,document.getElementById("layout_staff_sep").value=gNotationSpacingStaffSep,document.getElementById("layout_inject_noexpand").checked=gNotationSpacingNoExpand;var u=document.getElementById("layout_mode"),m=document.getElementById("layout_scale"),p=document.getElementById("notationspacingexplorertest"),h=document.getElementById("notationspacingexplorerinject");u&&(u.value="scale"),m&&(m.value="1.0"),u&&u.addEventListener("change",function(){f(),testSpacingChange()}),m&&m.addEventListener("change",function(){var e=document.getElementById("layout_mode");e&&"scale"===e.value&&(f(),testSpacingChange())}),p&&p.addEventListener("click",testSpacingChange),h&&h.addEventListener("click",NotationSpacingInject),f(),gNotationCallback=function(){e=(e=InjectOneTuneSpacingHeader(s,gNotationSpacingStaffSep,gNotationSpacingLeftMargin,gNotationSpacingRightMargin,gNotationSpacingStaffWidth,gNotationSpacingNoExpand)).replace(/%%titlespace\s.*\r?\n/g,""),e=r+e,postProcessTab([ABCJS.renderAbc("notationspacingexplorer-paper",e,n)[0]],"notationspacingexplorer-paper",t,!0),document.querySelectorAll('div[id="notationspacingexplorer-paper"] > svg')[0].style.boxShadow="inset 0px 0px 0px 1px #b8b8b8"},e=e.replace(/%%titlespace\s.*\r?\n/g,""),e=r+e,postProcessTab([ABCJS.renderAbc("notationspacingexplorer-paper",e,n)[0]],"notationspacingexplorer-paper",t,!0),document.querySelectorAll('div[id="notationspacingexplorer-paper"] > svg')[0].style.boxShadow="inset 0px 0px 0px 1px #b8b8b8",testSpacingChange()}}function f(){var e=document.getElementById("layout_mode"),t=document.getElementById("layout_scale_wrap"),n=document.getElementById("layout_scale"),o=document.getElementById("layout_left_margin"),a=document.getElementById("layout_right_margin"),l=document.getElementById("layout_staff_width");if(e&&o&&a&&l)if("scale"===(e.value||"scale")){t&&(t.style.display="");var r=parseFloat(n&&n.value?n.value:"1");(isNaN(r)||r<=0)&&(r=1);var i=function(e){var t=parseFloat(e);if(isNaN(t)||0===t)return null;var n=function(e){if(e>=1)return 0;if(e<=.125)return 3e3;const t=[{x:1,y:0},{x:.75,y:130},{x:.5,y:400},{x:.25,y:1200},{x:.125,y:3e3}];if(e>.75&&e<1){const n=t[0].x,o=t[0].y;return o+(n-e)/(n-t[1].x)*(t[1].y-o)}function n(e,t,n,o,a){const l=Math.log(o/t)/Math.log(n/e);return t/Math.pow(e,l)*Math.pow(a,l)}return e>.5&&e<=.75?n(.75,130,.5,400,e):e>.25&&e<=.5?n(.5,400,.25,1200,e):n(.25,1200,.125,3e3,e)}(t);return{leftMargin:Math.round(n),rightMargin:Math.round(n)}}(r);o.disabled=!0,a.disabled=!0,i&&(o.value=i.leftMargin,a.value=i.rightMargin,gNotationSpacingLeftMargin=i.leftMargin,gNotationSpacingRightMargin=i.rightMargin,gNotationSpacingStaffWidth=i.staffwidth)}else t&&(t.style.display="none"),o.disabled=!1,a.disabled=!1}}function InjectOneTuneMIDIProgram(e,t){var n;if("mute"==t)n="Mute";else if(n=generalMIDISoundNames[t+1],/^custom([1-8])$/.test(t)){n=`Custom Instrument ${t.match(/^custom([1-8])$/)[1]}`}return InjectStringBelowTuneHeader(e,"% Melody program: "+n+"\n%%MIDI program "+t)}function InjectOneTuneMIDIBassProgramAndVolumes(e,t,n){var o,a="";if("mute"==t)o="Mute";else if(o=generalMIDISoundNames[t+1],/^custom([1-8])$/.test(t)){o=`Custom Instrument ${t.match(/^custom([1-8])$/)[1]}`}return a="% Bass program: "+o+"\n%%MIDI bassprog "+t,InjectStringBelowTuneHeader(e,a+="\n%%MIDI bassvol "+n)}function InjectOneTuneMIDIChordProgramAndVolumes(e,t,n){var o,a="";if("mute"==t)o="Mute";else if(o=generalMIDISoundNames[t+1],/^custom([1-8])$/.test(t)){o=`Custom Instrument ${t.match(/^custom([1-8])$/)[1]}`}return a="% Chords program: "+o+"\n%%MIDI chordprog "+t,InjectStringBelowTuneHeader(e,a+="\n%%MIDI chordvol "+n)}function InjectOneTuneMIDIProgramAboveTune(e,t,n,o){return InjectStringAboveTuneHeader(e,n?"%%MIDI bassprog "+t:o?"%%MIDI chordprog "+t:"%%MIDI program "+t)}function InjectOneTuneMIDIVolume(e,t,n){return InjectStringBelowTuneHeader(e,n?"%%MIDI chordvol "+t:"%%MIDI bassvol "+t)}function InjectOneTuneMIDIVolumeAboveTune(e,t,n){return InjectStringAboveTuneHeader(e,n?"%%MIDI chordvol "+t:"%%MIDI bassvol "+t)}function InjectReverbAboveTune(e,t){return InjectStringAboveTuneHeader(e,"%reverb "+t)}const soundfontNames=["Fluid","Musyng Kite","FatBoy","Canvas","MScore","Arachno","FluidHQ"],generalMIDISoundNames=["Mute","Acoustic Grand Piano","Bright Acoustic Piano","Electric Grand Piano","Honky-tonk Piano","Electric Piano 1","Electric Piano 2","Harpsichord","Clavi","Celesta","Glockenspiel","Music Box","Vibraphone","Marimba","Xylophone","Tubular Bells","Dulcimer","Drawbar Organ","Percussive Organ","Rock Organ","Church Organ","Reed Organ","Accordion","Harmonica","Tango Accordion","Acoustic Guitar (nylon)","Acoustic Guitar (steel)","Electric Guitar (jazz)","Electric Guitar (clean)","Electric Guitar (muted)","Overdriven Guitar","Distortion Guitar","Guitar Harmonics","Acoustic Bass","Electric Bass (finger)","Electric Bass (pick)","Fretless Bass","Slap Bass 1","Slap Bass 2","Synth Bass 1","Synth Bass 2","Violin","Viola","Cello","Contrabass","Tremolo Strings","Pizzicato Strings","Orchestral Harp","Timpani","String Ensemble 1","String Ensemble 2","SynthStrings 1","SynthStrings 2","Choir Aahs","Voice Oohs","Synth Voice","Orchestra Hit","Trumpet","Trombone","Tuba","Muted Trumpet","French Horn","Brass Section","SynthBrass 1","SynthBrass 2","Soprano Sax","Alto Sax","Tenor Sax","Baritone Sax","Oboe","English Horn","Bassoon","Clarinet","Piccolo","Flute","Recorder","Pan Flute","Blown Bottle","Shakuhachi","Tin Whistle","Ocarina","Lead 1 (square)","Lead 2 (sawtooth)","Lead 3 (calliope)","Lead 4 (chiff)","Lead 5 (charang)","Lead 6 (voice)","Lead 7 (fifths)","Lead 8 (bass + lead)","Pad 1 (new age)","Pad 2 (warm)","Pad 3 (polysynth)","Pad 4 (choir)","Pad 5 (bowed)","Pad 6 (metallic)","Pad 7 (halo)","Pad 8 (sweep)","FX 1 (rain)","FX 2 (soundtrack)","FX 3 (crystal)","FX 4 (atmosphere)","FX 5 (brightness)","FX 6 (goblins)","FX 7 (echoes)","FX 8 (sci-fi)","Sitar","Banjo","Shamisen","Koto","Kalimba","Bagpipe","Fiddle","Shanai","Tinkle Bell","Agogo","Steel Drums","Woodblock","Taiko Drum","Bodhran","Synth Drum","Reverse Cymbal","Guitar Fret Noise","Breath Noise","Seashore","Bird Tweet","Telephone Ring","Helicopter","Applause","Gunshot","abcjs Percussion","Uilleann Pipes","Smallpipes (D)","Smallpipes (A)","Säckpipa","Concertina","Melodica","Cajun Accordion","Solfège","Chorused Guitar (nylon)","Chorused Guitar (steel)","Irish Bouzouki","Irish Bouzouki 2","Mandolin","Marching Drums","Border Pipes","Soprano Recorder","Alto Recorder","Tenor Recorder","Bass Recorder","Mountain Dulcimer (Solo)","Mountain Dulcimer (DAD)","Custom Instrument 1","Custom Instrument 2","Custom Instrument 3","Custom Instrument 4","Custom Instrument 5","Custom Instrument 6","Custom Instrument 7","Custom Instrument 8","Silence"];var MIDI_PATCH_COUNT=158,gLastInjectedSoundfont=null,gLastInjectedProgram=1,gLastInjectedBassProgram=1,gLastInjectedChordsProgram=1,gLastInjectedChordVolume=64,gLastInjectedBassVolume=64;function InjectAllMIDIParams(){if(gRenderingPDF)return;sendGoogleAnalytics("dialog","InjectAllMIDIParams");for(var e=[],t=0;t<=MIDI_PATCH_COUNT;++t)e.push({name:"  "+generalMIDISoundNames[t],id:t});null==gLastInjectedSoundfont&&(-1!=gDefaultSoundFont.indexOf("FluidR3_GM")?gLastInjectedSoundfont="0":-1!=gDefaultSoundFont.indexOf("Musyng")?gLastInjectedSoundfont="1":-1!=gDefaultSoundFont.indexOf("fatboy")?gLastInjectedSoundfont="2":-1!=gDefaultSoundFont.indexOf("canvas")?gLastInjectedSoundfont="3":-1!=gDefaultSoundFont.indexOf("mscore")?gLastInjectedSoundfont="4":-1!=gDefaultSoundFont.indexOf("arachno")?gLastInjectedSoundfont="5":-1!=gDefaultSoundFont.indexOf("fluidhq")&&(gLastInjectedSoundfont="6"));const n={configure_soundfont:gLastInjectedSoundfont,configure_inject_soundfont:!1,configure_program:gLastInjectedProgram,configure_inject_melody_program:!1,configure_bassprogram:gLastInjectedBassProgram,configure_chordprogram:gLastInjectedChordsProgram,configure_bassvolume:gLastInjectedBassVolume,configure_chordvolume:gLastInjectedChordVolume,configure_inject_chord_program:!1,configure_inject_bass_program:!1,configure_inject_all:!0};var o=[{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Inject MIDI Soundfont, Melody, Bass, and Chords&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#selecting_the_instruments_for_playback" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="margin-top:24px;margin-bottom:24px;font-size:12pt;line-height:18pt;font-family:helvetica">This will inject a %soundfont directive into the ABC:</p>'},{name:"            Inject MIDI Soundfont",id:"configure_inject_soundfont",type:"checkbox",cssClass:"configure_midi_program_form_text"},{name:"%soundfont value to inject:",id:"configure_soundfont",type:"select",options:[{name:"  Fluid",id:"0"},{name:"  Musyng Kite",id:"1"},{name:"  FatBoy",id:"2"},{name:"  Canvas",id:"3"},{name:"  MScore",id:"4"},{name:"  Arachno",id:"5"},{name:"  FluidHQ",id:"6"}],cssClass:"configure_soundfont_select"},{html:'<p style="margin-top:24px;margin-bottom:24px;font-size:12pt;line-height:18pt;font-family:helvetica">This will inject a %%MIDI program directive into the ABC:</p>'},{name:"            Inject MIDI Melody program",id:"configure_inject_melody_program",type:"checkbox",cssClass:"configure_midi_program_form_text"},{name:"MIDI Melody program to inject:",id:"configure_program",type:"select",options:e,cssClass:"configure_midi_program_select"},{html:'<p style="margin-top:24px;margin-bottom:24px;font-size:12pt;line-height:18pt;font-family:helvetica">This will inject %%MIDI bassprog and %%MIDI bassvol directives into the ABC:</p>'},{name:"            Inject MIDI Bass program and volumes",id:"configure_inject_bass_program",type:"checkbox",cssClass:"configure_midi_program_form_text"},{name:"MIDI Bass program to inject:",id:"configure_bassprogram",type:"select",options:e,cssClass:"configure_midi_program_select"},{name:"MIDI Bass volume (0-127):",id:"configure_bassvolume",type:"text",cssClass:"configure_midi_program_form_number_input"},{html:'<p style="margin-top:24px;margin-bottom:24px;font-size:12pt;line-height:18pt;font-family:helvetica">This will inject %%MIDI chordprog and %%MIDI chordvol directives into the ABC:</p>'},{name:"            Inject MIDI Chord program and volumes",id:"configure_inject_chord_program",type:"checkbox",cssClass:"configure_midi_program_form_text"},{name:"MIDI Chord program to inject:",id:"configure_chordprogram",type:"select",options:e,cssClass:"configure_midi_program_select"},{name:"MIDI Chord volume (0-127):",id:"configure_chordvolume",type:"text",cssClass:"configure_midi_program_form_number_input"},{html:'<p style="font-size:14pt;line-height:19pt;font-family:helvetica;margin-bottom:30px;text-align:center;"><a href="https://michaeleskin.com/documents/general_midi_extended_v10.pdf" target="_blank">General MIDI Instrument Program Numbers</a></p>'},{name:"            Inject all tunes",id:"configure_inject_all",type:"checkbox",cssClass:"configure_midi_program_form_text"}];DayPilot.Modal.form(o,n,{theme:"modal_flat",top:20,width:760,scrollWithPage:AllowDialogsToScroll(),okText:"Inject",autoFocus:!1}).then(function(e){if(!e.canceled){var t=e.result.configure_inject_soundfont,n=e.result.configure_inject_melody_program,o=e.result.configure_inject_bass_program,a=e.result.configure_inject_chord_program;if(!(t||n||o||a))return;var l=e.result.configure_soundfont;gLastInjectedSoundfont=l;var r="fluid";switch(l){case"0":r="fluid";break;case"1":r="musyng";break;case"2":r="fatboy";break;case"3":r="canvas";break;case"4":r="mscore";break;case"5":r="arachno";break;case"6":r="fluidhq"}var i=e.result.configure_program;gLastInjectedProgram=i,0==i?i="mute":(((i-=1)<0||i>MIDI_PATCH_COUNT)&&(i=0),i>=150&&i<=157&&(i="custom"+(i-149)));var s=e.result.configure_bassprogram,c=e.result.configure_chordprogram;gLastInjectedBassProgram=s,gLastInjectedChordsProgram=c,gLastInjectedBassVolume=e.result.configure_bassvolume,gLastInjectedChordVolume=e.result.configure_chordvolume,isNaN(parseInt(gLastInjectedBassVolume))&&(gLastInjectedBassVolume=0),gLastInjectedBassVolume<0&&(gLastInjectedBassVolume=0),gLastInjectedBassVolume>127&&(gLastInjectedBassVolume=127),isNaN(parseInt(gLastInjectedChordVolume))&&(gLastInjectedChordVolume=0),gLastInjectedChordVolume<0&&(gLastInjectedChordVolume=0),gLastInjectedChordVolume>127&&(gLastInjectedChordVolume=127),0==s?s="mute":(((s-=1)<0||s>MIDI_PATCH_COUNT)&&(s=0),s>=150&&s<=157&&(s="custom"+(s-149))),0==c?c="mute":(((c-=1)<0||c>MIDI_PATCH_COUNT)&&(c=0),c>=150&&c<=157&&(c="custom"+(c-149)));var g=e.result.configure_inject_all,d=findTuneByOffset(gEnableSyntax?gTheCM.selectionStart:gTheABC.selectionStart);if(!g&&-1==d)return;for(var u=CountTunes(),m=getABCEditorText(),p=m.split(/^X:/gm),h=FindPreTuneHeader(m),f=1;f<=u;++f)thisTune="X:"+p[f],g||f-1==d?(t&&(thisTune=InjectOneTuneSoundfont(thisTune,r)),n&&(thisTune=InjectOneTuneMIDIProgram(thisTune,i)),o&&(thisTune=InjectOneTuneMIDIBassProgramAndVolumes(thisTune,s,gLastInjectedBassVolume)),a&&(thisTune=InjectOneTuneMIDIChordProgramAndVolumes(thisTune,c,gLastInjectedChordVolume)),h+=thisTune):h+=thisTune;setABCEditorText(h),gIsDirty=!0;var b="MIDI programs and volumes injected!";b=makeCenteredPromptString(b),DayPilot.Modal.alert(b,{theme:"modal_flat",top:300,scrollWithPage:AllowDialogsToScroll()}).then(function(){if(gRawMode)RenderAsync(!0,null,function(){ensureMoreToolsVisible();var e=findTuneOffsetByIndex(d);gEnableSyntax?(ScrollABCTextIntoView(gTheCM,e,e,10),gTheCM.selectionStart=e,gTheCM.selectionEnd=e):(ScrollABCTextIntoView(gTheABC,e,e,10),gTheABC.selectionStart=e,gTheABC.selectionEnd=e),FocusAfterOperation()});else{var e=findTuneOffsetByIndex(d);gEnableSyntax?(ScrollABCTextIntoView(gTheCM,e,e,10),gTheCM.selectionStart=e,gTheCM.selectionEnd=e):(ScrollABCTextIntoView(gTheABC,e,e,10),gTheABC.selectionStart=e,gTheABC.selectionEnd=e),FocusAfterOperation()}})}})}const metronome_list=[{name:"C|",pattern:"dd A B C D"},{name:"C",pattern:"dddd A B B B C D D D"},{name:"2/2",pattern:"dd A B C D"},{name:"3/2",pattern:"ddd A B B C D D"},{name:"2/4",pattern:"dd A B C D"},{name:"3/4",pattern:"ddd A B B C D D"},{name:"4/4",pattern:"dddd A B B B C D D D"},{name:"5/4",pattern:"ddddd A B B B B C D D D D"},{name:"6/4",pattern:"dddddd A B B B B B C D D D D"},{name:"7/4",pattern:"ddddddd A B B B B B B C D D D D D"},{name:"2/8",pattern:"dz A C"},{name:"3/8",pattern:"dzz A C"},{name:"5/8",pattern:"dzzdz A B C D"},{name:"6/8",pattern:"dzzdzz A B C D"},{name:"7/8",pattern:"dzdzdzz A B B C D D"},{name:"9/8",pattern:"dzzdzzdzz A B B C D D"},{name:"10/8",pattern:"dzzdzzdzdz A B B B C D D D"},{name:"11/8",pattern:"dzzdzzdzdzz A B B B C D D D"},{name:"12/8",pattern:"dzzdzzdzzdzz A B B B C D D D"}];var gMetronomeHighSound=76,gMetronomeLowSound=77,gMetronomeHighVolume=64,gMetronomeLowVolume=48;function inject_one_metronome(e,t){var n,o=e.split("\n"),a="",l="";for(n=0;n<o.length;++n){a=o[n],searchRegExp=/^M:.*[\r\n]*/m;var r=a.match(searchRegExp);r&&r.length>0&&""==l&&(l=(l=r[0].replace("M:","")).trim())}if(""==l){if(t)c=makeCenteredPromptString(c="No meter found in the ABC."),DayPilot.Modal.alert(c,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});return null}var i="";for(n=0;n<metronome_list.length;++n)if(l==metronome_list[n].name){var s=metronome_list[n].pattern.replaceAll("A",gMetronomeHighSound);i="%\n% Metronome sounds and volumes\n%\n%%MIDI drum "+(s=(s=(s=s.replaceAll("B",gMetronomeLowSound)).replaceAll("C",gMetronomeHighVolume)).replaceAll("D",gMetronomeLowVolume))+"\n%%MIDI drumon\n%";break}if(""==i){var c;if(t)c=makeCenteredPromptString(c="No metronome pattern available for meter: "+l),DayPilot.Modal.alert(c,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});return null}return e=(e=InjectStringBelowTuneHeader(e,i)).trim()}function InjectMetronome(){if(gRenderingPDF)return;sendGoogleAnalytics("dialog","InjectMetronome");var e=findSelectedTuneIndex();DayPilot.Modal.form([{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Inject Metronome&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#adding_a_metronome" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="margin-top:36px;margin-bottom:36px;font-size:12pt;line-height:18pt;font-family:helvetica">This injects a metronome into the ABC using %%MIDI drum and %%MIDI drumon directives.</p>'},{name:"            Inject metronome into all tunes",id:"configure_inject_all",type:"checkbox",cssClass:"configure_metronome_form_text"}],{configure_inject_all:!1},{theme:"modal_flat",top:200,width:760,scrollWithPage:AllowDialogsToScroll(),okText:"Inject",autoFocus:!1}).then(function(t){if(!t.canceled)if(t.result.configure_inject_all){var n=CountTunes(),o=1==n,a="";clearGetTuneByIndexCache();for(var l=0;l<n;++l){var r=getTuneByIndex(l),i=inject_one_metronome(r,o);i?(a+=i,a+="\n\n"):a+=r}setABCEditorText(a),gIsDirty=!0,d=makeCenteredPromptString(d="Metronome injected!"),DayPilot.Modal.alert(d,{theme:"modal_flat",top:300,scrollWithPage:AllowDialogsToScroll()}).then(function(){RenderAsync(!0,null,function(){ensureMoreToolsVisible(),gEnableSyntax?(gTheCM.selectionStart=0,gTheCM.selectionEnd=0):(gTheABC.selectionStart=0,gTheABC.selectionEnd=0),FocusAfterOperation()})})}else{var s=findSelectedTune();if(""==s)return;var c,g=inject_one_metronome(s,!0);if(!g)return;c=gEnableSyntax?gTheCM.selectionStart:gTheABC.selectionStart;var d,u=getABCEditorText();setABCEditorText(u=u.replace(s,g)),gIsDirty=!0,d=makeCenteredPromptString(d="Metronome injected!"),DayPilot.Modal.alert(d,{theme:"modal_flat",top:300,scrollWithPage:AllowDialogsToScroll()}).then(function(){RenderAsync(!1,e,function(){ensureMoreToolsVisible(),gEnableSyntax?(gTheCM.selectionStart=c,gTheCM.selectionEnd=c):(gTheABC.selectionStart=c,gTheABC.selectionEnd=c),FocusAfterOperation()})})}})}function CopyABC(){gAllowCopy&&(CopyToClipboard(getABCEditorText()),document.getElementById("copybutton").value="Copied!",setTimeout(function(){document.getElementById("copybutton").value="Copy All"},500))}function ShortenURLFallback(){gAllowURLSave&&(CopyToClipboard(document.getElementById("urltextbox").value),document.getElementById("shortenurl").value="Share URL Copied!",setTimeout(function(){document.getElementById("shortenurl").value="Launching TinyURL",setTimeout(function(){window.open("https://tinyurl.com");document.getElementById("shortenurl").value="Shorten URL"},500)},250))}function ShortenURL(e){if(gAllowURLSave){var t;if(!navigator.onLine)return t=makeCenteredPromptString(t="URL shortening not available while offline."),void DayPilot.Modal.alert(t,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});if(gDoTinyURLAPIKeyOverride)n();else t=makeCenteredPromptString(t='<p style="text-align:center;font-size:12pt;line-height:18pt;font-family:helvetica">I get a very few number of free TinyURL shortening sessions per month that are shared across all users of the tool.</p><p style="text-align:center;font-size:12pt;line-height:18pt;font-family:helvetica">Do you absolutely need a shortened URL?</p><p style="text-align:center;font-size:12pt;line-height:18pt;font-family:helvetica">If not, please consider just copy and pasting the full Share URL instead.</p><p style="text-align:center;font-size:12pt;line-height:18pt;font-family:helvetica">If you need to create many shortened URLs, please get your own TinyURL key and enter it in the <strong>Advanced Settings</strong> dialog to avoid this alert.</p><p style="text-align:center;font-size:12pt;line-height:18pt;font-family:helvetica">The process for getting your own TinyURL API key is described here:</p><p style="text-align:center;font-size:12pt;line-height:18pt;font-family:helvetica"><a href="https://michaeleskin.com/abctools/userguide.html#private_tinyurl_token" target="_blank">Private TinyURL API Token</a></p><p style="text-align:center;font-size:12pt;line-height:18pt;font-family:helvetica">Warning: Do not post TinyURL links from this tool on Facebook!</p><p style="text-align:center;font-size:12pt;line-height:18pt;font-family:helvetica">Facebook considers shortened URLs as intellectual property theft since they strip away Facebook\'s added URL tracking parameters and have been known to temporarily suspend the accounts of those using them in posts.</p>'),DayPilot.Modal.confirm(t,{top:100,theme:"modal_flat",okText:"Proceed",scrollWithPage:AllowDialogsToScroll()}).then(function(e){e.canceled||n()})}function n(){var t=!1;e&&e.shiftKey&&e.altKey&&(t=!0),sendGoogleAnalytics("sharing","shorten_share_url");let n={url:document.getElementById("urltextbox").value};var o=gTinyURLAPIKey;gDoTinyURLAPIKeyOverride&&(o="Bearer "+gTinyURLAPIKeyOverride),fetch("https://api.tinyurl.com/create",{method:"POST",headers:{accept:"application/json",authorization:o,"content-type":"application/json"},body:JSON.stringify(n)}).then(e=>{if(200==e.status)return e.json();ShortenURLFallback()}).then(e=>{CopyToClipboard(e.data.tiny_url);var n='<p style="text-align:center;font-size:16pt;font-family:helvetica">Shortened URL Copied to the Clipboard</p>';if(n+='<p style="text-align:center;font-size:14pt;line-height:19pt;font-family:helvetica">Short URL:</p>',n+='<p style="text-align:center;font-size:14pt;line-height:19pt;font-family:helvetica"><a href="'+e.data.tiny_url+'" target="_blank">'+e.data.tiny_url+"</a></p>",DayPilot.Modal.alert(n,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()}),t){for(var o=CountTunes(),a=getABCEditorText(),l=a.split(/^X:/gm),r=FindPreTuneHeader(a),i=1;i<=o;++i){r+=InjectStringBelowTuneHeader("X:"+l[i],"%hyperlink "+e.data.tiny_url)}setABCEditorText(r),gIsDirty=!0,RenderAsync(!0,null,function(){gEnableSyntax?(gTheCM.selectionStart=0,gTheCM.selectionEnd=0):(gTheABC.selectionStart=0,gTheABC.selectionEnd=0),FocusAfterOperation()})}gDoTinyURLAPIKeyOverride||(gTinyURLCount++,gLocalStorageAvailable&&(localStorage.TinyURLCount=gTinyURLCount),5!=gTinyURLCount&&10!=gTinyURLCount||TinyURLReminderDialog())}).catch(e=>{ShortenURLFallback()})}}function CopyShareURL(){gAllowURLSave&&(sendGoogleAnalytics("sharing","copy_share_url"),CopyToClipboard(document.getElementById("urltextbox").value),document.getElementById("copyurl").value="Share URL Copied!",setTimeout(function(){document.getElementById("copyurl").value="Copy Share URL"},500))}function SaveABC(){if(gAllowSave){var e=getABCEditorText();if(0!=e.length){var t=getDescriptiveFileName(CountTunes(),!0),n="Please enter a filename for your ABC file:  ";isPureDesktopBrowser()?saveABCFile(n,t+=".abc",e):saveABCFile(n,t+=".txt",e)}}}function SaveABC_KB(){if(gAllowSave)if(gABCFromFile){var e=getABCEditorText();if(0!=e.length){doSaveABCFile(getDescriptiveFileName(CountTunes(),!0),e);var t=document.getElementById("saveabcfile");t&&(t.value="Saved!"),setTimeout(function(){var e=document.getElementById("saveabcfile");e&&(e.value="Save")},1e3)}}else SaveABC()}function SaveShareURL(){if(gAllowURLSave){sendGoogleAnalytics("sharing","save_share_url");var e=urltextbox.value;if(0!=e.length)saveTextFile("Please enter a filename for your Share URL file:",getDescriptiveFileName(CountTunes(),!0)+" Share URL.txt",e)}}function TestShareURL(){if(gAllowURLSave){sendGoogleAnalytics("sharing","test_share_url");var e=document.getElementById("urltextbox").value;window.open(e)}}function SetAbcText(e){setABCEditorText(e)}function ShowAllControls(){document.getElementById("notenrechts").style.display="inline-block",gShowAllControls=!0,UpdateNotationTopPosition(),gIsOneColumn&&MakeTuneVisible(!0)}function HideAllControls(){document.getElementById("notenrechts").style.display="none",gShowAllControls=!1,UpdateNotationTopPosition(),gIsOneColumn&&MakeTuneVisible(!0)}function ShowMaximizeButton(){document.getElementById("zoombutton").style.display="block",document.getElementById("zoombutton").style.opacity=gInPresentationMode?.005:1}function HideMaximizeButton(){document.getElementById("zoombutton").style.display="none"}function HideHelpButton(){document.getElementById("helpbutton").style.display="none"}function ShowHelpButton(){document.getElementById("helpbutton").style.display="block",document.getElementById("helpbutton").style.opacity=gInPresentationMode?.005:1}function QE_PlayButton_Handler(){const e=document.querySelector("button.abcjs-midi-start");e&&e.click()}function QE_RewindButton_Handler(e){if(e.shiftKey){const e=document.querySelector("button.abcjs-midi-loop");return void(e&&e.click())}const t=document.querySelector("button.abcjs-midi-reset");t&&t.click()}function QE_TempoButton_Handler(e){if(e.shiftKey)!function(e){var t=document.getElementsByClassName("abcjs-midi-tempo");t&&t.length>0&&gSynthControl&&(gSynthControl.pause(),gSynthControl.forceWarp(e),gLastWarp=e,gLocalStorageAvailable&&(localStorage.LastWarp=gLastWarp))}(100);else{var t=document.getElementsByClassName("abcjs-midi-tempo");t&&t.length>0&&SetPlayerTempo()}}function ShowPlayButton(){document.getElementById("playbuttonicon").style.display="block",document.getElementById("playbuttonicon").style.opacity=gInPresentationMode?.005:1}function HidePlayButton(){document.getElementById("playbuttonicon").style.display="none"}function ShowPDFButton(){gIsQuickEditor||(document.getElementById("pdfbuttonicon").style.display="block",document.getElementById("pdfbuttonicon").style.opacity=gInPresentationMode?.005:1)}function HidePDFButton(){gIsQuickEditor||(document.getElementById("pdfbuttonicon").style.display="none")}function ShowJumpButton(){document.getElementById("jumpbutton").style.display="block",document.getElementById("jumpbutton").style.opacity=gInPresentationMode?.005:1}function HideJumpButton(){document.getElementById("jumpbutton").style.display="none"}function ShowQEFSPlayerButtons(){document.getElementById("qerewindbutton").style.display="block",document.getElementById("qerewindbutton").style.opacity=gInPresentationMode?.005:1,document.getElementById("qetempobutton").style.display="block",document.getElementById("qetempobutton").style.opacity=gInPresentationMode?.005:1}function HideQEFSPlayerButtons(){document.getElementById("qerewindbutton").style.display="none",document.getElementById("qetempobutton").style.display="none"}function togglePresentationMode(){gInPresentationMode?(gInPresentationMode=!1,document.getElementById("zoombutton").style.opacity=1,document.getElementById("helpbutton").style.opacity=1,document.getElementById("playbuttonicon").style.opacity=1,document.getElementById("jumpbutton").style.opacity=1,gIsQuickEditor?(document.getElementById("qerewindbutton").style.opacity=1,document.getElementById("qetempobutton").style.opacity=1):document.getElementById("pdfbuttonicon").style.opacity=1):(gInPresentationMode=!0,document.getElementById("zoombutton").style.opacity=.005,document.getElementById("helpbutton").style.opacity=.005,document.getElementById("playbuttonicon").style.opacity=.005,document.getElementById("pdfbuttonicon").style.opacity=.005,document.getElementById("jumpbutton").style.opacity=.005,gIsQuickEditor&&(document.getElementById("qerewindbutton").style.opacity=.005,document.getElementById("qetempobutton").style.opacity=.005))}function DoMaximize(){document.getElementById("noscroller").style.display="none",document.getElementById("notation-spacer").style.display="none",gTheNotation.style.display="flex",gTheNotation.style.float="none",gIsMaximized=!0,gPlayABCGotMaximizedPlay=!1,HandleWindowResize(),isDesktopBrowser()?(isPureDesktopBrowser()&&(gGotRenderDivClick=!1,gRenderDivClickOffset=-1),gNotationLeftMarginBeforeMaximize=gTheNotation.style.marginLeft,gTheNotation.style.marginLeft="auto"):gIsQuickEditor?(ShowPlayButton(),ShowQEFSPlayerButtons()):(ShowPDFButton(),ShowPlayButton()),CountTunes()>1?ShowJumpButton():HideJumpButton()}function DoMinimize(){if(document.getElementById("noscroller").style.display="block",document.getElementById("notation-spacer").style.display="block",document.getElementById("zoombutton").src="img/zoomout.png",giPadTwoColumn)var e=document.getElementById("notation-holder").style.width="850px";if(gIsQuickEditor?isDesktopBrowser()||(HidePlayButton(),HideQEFSPlayerButtons()):isDesktopBrowser()||(HidePlayButton(),HidePDFButton()),isDesktopBrowser()&&(gTheNotation.style.display="inline",gTheNotation.style.float="left",gTheNotation.style.marginLeft=gNotationLeftMarginBeforeMaximize),gIsMaximized=!1,gPlayABCGotMaximizedPlay=!1,HandleWindowResize(),isDesktopBrowser()){if(gForceInitialTextBoxRecalc){if(giPadTwoColumn){if(gEnableSyntax){let e=gTheCM.getWrapperElement();e.style.marginLeft="0px",e.style.width="832px",gTheCM.refresh()}else gTheABC.style.marginLeft="0px",gTheABC.style.width="832px";gInitialTextBoxWidth=832,gInitialTextBoxContainerWidth=832,gInitialTextBoxContainerLeft=0}else{e=document.getElementById("notenlinks");gInitialTextBoxContainerWidth=e.offsetWidth,e=document.getElementById("noscroller"),gInitialTextBoxContainerLeft=e.offsetLeft,gInitialTextBoxWidth=gEnableSyntax?gTheCM.getWrapperElement().offsetWidth:gTheABC.offsetWidth}ResizeTextBox(),gForceInitialTextBoxRecalc=!1}if(gGotWindowResizeWhileMaximized){if(gEnableSyntax){let e=gTheCM.getWrapperElement();e.style.width=gInitialTextBoxWidth+"px",e.style.marginLeft="0px",gTheCM.refresh()}else gTheABC.style.width=gInitialTextBoxWidth+"px",gTheABC.style.marginLeft="0px";e=document.getElementById("notenlinks");gInitialTextBoxContainerWidth=e.offsetWidth,e=document.getElementById("noscroller"),gInitialTextBoxContainerLeft=e.offsetLeft,gTheNotation.style.marginLeft="auto",gGotWindowResizeWhileMaximized=!1}if(gGotRenderDivClick){if(-1!=gRenderDivClickOffset)if(gEnableSyntax){if(gTheCM.selectionEnd=gTheCM.selectionStart=gRenderDivClickOffset,isMobileBrowser())return;gTheCM.getInputField().blur(),gTheCM.focus()}else{if(gTheABC.selectionEnd=gTheABC.selectionStart=gRenderDivClickOffset,isMobileBrowser())return;gTheABC.blur(),gTheABC.focus()}gGotRenderDivClick=!1,gRenderDivClickOffset=-1}}}function ToggleMaximize(){gIsMaximized?(DoMinimize(),isDesktopBrowser()?gTheNotation.style.width="850px":gTheNotation.style.width="820px"):(DoMaximize(),document.getElementById("zoombutton").src="img/zoomin.png",isDesktopBrowser()?giPadTwoColumn?document.getElementById("notation-holder").style.width="80%":window.innerWidth*gFullScreenScaling/100>850&&(gTheNotation.style.width=gFullScreenScaling+"%"):window.innerWidth*gFullScreenScaling/100>820&&(gTheNotation.style.width=gFullScreenScaling+"%"))}function IdleAllowShowTabNames(){var e=!1;switch(GetRadioValue("notenodertab")){case"noten":case"notenames":case"whistle":case"recorder":break;case"mandolin":case"gdad":case"cgda":case"cgdae":case"dgdae":case"guitare":case"guitard":case"uke":e=!0}gAllowShowTabNames=!!e}function utf8tob64(e){var t;try{t=btoa(escape(e))}catch(e){t=""}return t}function b64toutf8(e){var t;try{t=unescape(atob(e))}catch(e){t=""}return t}function isLandscapeOrientation(){return!window.matchMedia("(orientation: portrait)").matches&&!!window.matchMedia("(orientation: landscape)").matches}function processShareLink(){var e=!1;gDisableEditFromPlayLink=!1;var t=window.location.search;t=t.replaceAll("&amp;","&");const n=new URLSearchParams(t);if(n.has("lzw")){var o=n.get("lzw");abcInLZW=LZString.decompressFromEncodedURIComponent(o);const t=abcInLZW;t.length>0?(SetAbcText(t),RestoreDefaults(),e=!0,gIsDirty=!0):o.length>2e3?ShowAcrobatHyperlinkLengthWarning():ShowHyperlinkBadDecodeAlert()}if(n.has("format")){var a=n.get("format");"bc"!=a&&"cd"!=a&&"bass"!=a&&"mandola"!=a||(a="noten"),"cgda"==a&&setupCGDA(),"gdad"==a&&setupGDAD(),"dgdae"==a&&setupDGDAE(),"cgdae"==a&&setupCGDAE(),"whistle"==a&&(setupWhistleTab(),PrepareWhistleFont());var l=!1;"recorder"==a&&(setupRecorderTab(),PrepareRecorderFont()),SetRadioValue("notenodertab",a),gCurrentTab=a}if(n.has("capo")){var r=n.get("capo"),i=parseInt(r);gCapo=isNaN(i)?0:i}if(n.has("ssp")){var s=n.get("ssp"),c=parseInt(s);gStaffSpacing=isNaN(c)?STAFFSPACEOFFSET+STAFFSPACEDEFAULT:STAFFSPACEOFFSET+c}else gStaffSpacing=STAFFSPACEOFFSET+STAFFSPACEDEFAULT;if(n.has("stn")){var g=n.get("stn");gShowTabNames="true"==g}(gForceComhaltasABC=!1,n.has("cce"))&&("1"==n.get("cce")&&(gForceComhaltasABC=!0));var d=!1;n.has("dx")&&("1"==n.get("dx")&&(d=!0));d&&(gDisableEditFromPlayLink=!0),gPlayABCTuneIndex=0;var u=!1;n.has("play")&&("1"==n.get("play")&&(u=!0));var m=!1;d||n.has("editor")&&"1"==n.get("editor")&&(m=!0,u=!1);if(gUIHidden=!1,gUIHiddenPlayerEnabled=!1,gUIHiddenAllowPlay=!0,n.has("noui")){const e=document.querySelector("body");if(e.classList.contains("noui"))return;e.classList.add("noui"),gUIHidden=!0}if(n.has("noui-noclick")&&(gUIHiddenAllowPlay=!1),n.has("flex")){const e=document.querySelector("body");e&&(e.style.display="flex",e.style.justifyContent="center")}var p=!1;if(u&&n.has("index")){var h=n.get("index");tuneIndex=parseInt(h),gPlayABCTuneIndex=tuneIndex,p=!0}if(e){var f="";if(n.has("name"))f=(f=(f=n.get("name")).replaceAll("_"," ")).replaceAll("^","#");else f=getDescriptiveFileName(CountTunes(),!0);if(gABCFromFile=!0,gDisplayedName=f,document.getElementById("notenrechts").style.display="none",UpdateNotationTopPosition(),gShowAllControls=!1,FocusABC(),RenderAsync(!0,null,function(){if(u)if(gOpenLinksInTrainer)sendGoogleAnalytics("show_trainer","from_share"),TuneTrainer(!1);else{sendGoogleAnalytics("show_player","from_share"),gPlayABCTuneCount=CountTunes(),gPlayABCGotMaximizedPlay=!0;getABCEditorText();PlayABCDialog(PreProcessPlayABC(getTuneByIndex(p?gPlayABCTuneIndex:0)),null,null,gPlayMetronome)}else m&&(sendGoogleAnalytics("action","open_in_editor"),ToggleMaximize());if(l){DayPilot.Modal.alert('<p style="text-align:center;font-size:16pt;line-height:24pt;font-family:helvetica">Recorder tablature is not available in Safari or on iOS</p><p style="font-size:14pt;line-height:14pt;margin-top:32px;font-family:helvetica;">Recorder tablature is supported on desktop Chrome and Firefox</p><p style="font-size:14pt;line-height:14pt;margin-top:24px;font-family:helvetica;">Whistle tablature will be used instead on Safari and iOS</p><p style="font-size:14pt;line-height:14pt;margin-top:12px;font-family:helvetica;">&nbsp;</p>',{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})}}),isDesktopBrowser())window.innerWidth*gFullScreenScaling/100>850&&(gTheNotation.style.width=gFullScreenScaling+"%");else window.innerWidth*gFullScreenScaling/100>820&&(gTheNotation.style.width=gFullScreenScaling+"%");return!0}return!1}function TextBoxResizeHandler(){UpdateNotationTopPosition(),gIsOneColumn&&MakeTuneVisible(!0)}function findSelectedTuneIndex(){var e,t=getABCEditorText(),n=t.split(/^X:/gm),o=CountTunes();if(o<2)return 0;if(0==(e=gEnableSyntax?gTheCM.selectionStart:gTheABC.selectionStart)&&(e=t.indexOf("X:")+2),0==e)return-1;var a=0;a=n[0].length;for(var l=1;l<=o;++l)if(e<(a+=n[l].length+2))return l-1;return-1}function MakeTuneVisible(e){if(gIsQuickEditor)gAllowCopy&&(t=findSelectedTuneIndex())!=gCurrentTune&&(gDisableNotationRendering||Render(!1,t),gCurrentTune=t,setTimeout(function(){window.scrollTo(0,0)},100));else if(gAllowCopy){var t=findSelectedTuneIndex();if(gCurrentTune=t,!e&&isMobileBrowser())return;if(gDisableNotationRendering)return;if(-1!=t){var n="notation"+t,o=document.getElementById(n),a=o.offsetTop,l=o.offsetHeight,r=document.getElementById("notation-spacer").offsetHeight;gIsOneColumn?a+=r:r=0;var i=window.innerHeight-r,s=a-window.scrollY-r,c=s>=0&&s<i,g=s+l,d=g>0&&g<i,u=s<0&&s+l>i;if(t!=gLastAutoScrolledTune||e){var m=a-r;window.scrollTo(0,m),gLastAutoScrolledTune=t}else if(!(c||d||u)){m=a-r;window.scrollTo(0,m),gLastAutoScrolledTune=t}}}}function debounce(e,t){let n;return(...o)=>{clearTimeout(n),n=setTimeout(function(){e.apply(this,o)},t)}}function OnABCTextChange(){if(gTotalTunes!=CountTunes())gIsQuickEditor&&(gCurrentTune=0),RenderAsync(!0,null);else if(gRawMode){var e=window.scrollY;RenderAsync(!0,null,function(){fireSelectionChanged(),window.scrollTo(0,e)})}else Render(!1,gCurrentTune)}const gWhistleFont="@font-face { font-family: 'TinWhistleFingering'; src: url(data:font/ttf;base64,AAEAAAANAIAAAwBQRkZUTaP6vdsAACV0AAAAHEdERUYAJQAAAAAlXAAAABhPUy8yaqxjnAAAAVgAAABgY21hcG48QzUAAAH4AAABYmdhc3D//wADAAAlVAAAAAhnbHlmMWL7xAAAA5gAAB28aGVhZCm1Z5sAAADcAAAANmhoZWEECABfAAABFAAAACRobXR4BaADCwAAAbgAAABAbG9jYWduX3YAAANcAAAAOm1heHAAawCfAAABOAAAACBuYW1lKmZ7PgAAIVQAAAOicG9zdAMgAsEAACT4AAAAWgABAAAAAQAAwlliol8PPPUACwPoAAAAAOTTkfUAAAAA5NOR9QA7/4QAtANIAAAACAACAAAAAAAAAAEAAANS/2oAAADwAAAAAAC0AAEAAAAAAAAAAAAAAAAAAAAEAAEAAAAcAJwADQAAAAAAAgAAAAEAAQAAAEAAAAAAAAAAAwDwAfQABQAAAooCuwAAAIwCigK7AAAB3wAxAQIAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAWFhYWABAAEEAbgNS/2oAAANIAHwAAAABAAAAAAGpA0gAAAAgAAEA8AAAAAAAAADwAAAA8AA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA7AAAAAwAAAAMAAAAcAAEAAAAAAFwAAwABAAAAHAAEAEAAAAAMAAgAAgAEAAAARwBNAGcAbv//AAAAAABBAEkAYQBp//8AAP/C/8H/rv+tAAEAAAAAAAAAAAAAAAAAAAEGAAABAAAAAAAAAAECAAAAAgAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMEBQYHCAkACgsMDQ4AAAAAAAAAAAAAAAAAAAAAAAAADxAREhMUFQAWFxgZGhsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAW4CHgKeAx4DqARIBQAFzgZIBtgHgggkCNQJdgnaCkwKyAtaDAQMxA0wDbIOTg7eAAAACwA8/4QAtANIAAsAFwAjAC8AOwBHAFMAXwBrAHcAgwAAFzM1IzUjFSMVMxUzJzI2NTQmIyIGFRQWNzIWFRQGIyImNTQ2NzI2NTQmIyIGFRQWNzIWFRQGIyImNTQ2NzI2NTQmIyIGFRQWNzIWFRQGIyImNTQ2NzI2NTQmIyIGFRQWNzIWFRQGIyImNTQ2NzI2NTQmIyIGFRQWNzI2NTQmIyIGFRQWhygoHigoHg8XJSMZFyUjGRAeHBIQHhwSFyUjGRclIxkQHhwSEB4cEhclIxkXJSMZEB4cEhAeHBIXJSMZFyUjGRAeHBIQHhwSFyUjGRclIxkXJSMZFyUjVB4oKB4ofCMZFyUjGRclahwSEB4cEhAeJiMZFyUjGRclahwSEB4cEhAeJiMZFyUjGRclahwSEB4cEhAeJiMZFyUjGRclahwSEB4cEhAeJiMZFyUjGRclkCMZFyUjGRclAAAAAAwAPP+EALQDSAALABcAIwAvADsARwBTAF8AawB3AIMAjwAAFzM1IzUjFSMVMxUzJzI2NTQmIyIGFRQWNzIWFRQGIyImNTQ2NzI2NTQmIyIGFRQWNzIWFRQGIyImNTQ2NzI2NTQmIyIGFRQWNzIWFRQGIyImNTQ2NzI2NTQmIyIGFRQWNzIWFRQGIyImNTQ2NzI2NTQmIyIGFRQWNzIWFRQGIyImNTQ2NzI2NTQmIyIGFRQWhygoHigoHg8XJSMZFyUjGRAeHBIQHhwSFyUjGRclIxkQHhwSEB4cEhclIxkXJSMZEB4cEhAeHBIXJSMZFyUjGRAeHBIQHhwSFyUjGRclIxkQHhwSEB4cEhclIxkXJSNUHigoHih8IxkXJSMZFyVqHBIQHhwSEB4mIxkXJSMZFyVqHBIQHhwSEB4mIxkXJSMZFyVqHBIQHhwSEB4mIxkXJSMZFyVqHBIQHhwSEB4mIxkXJSMZFyVqHBIQHhwSEB4mIxkXJSMZFyUACwA8/4QAtANIAAsAFwAjAC8AOwBHAFMAXwBrAHcAgwAAFzM1IzUjFSMVMxUzJzI2NTQmIyIGFRQWNzIWFRQGIyImNTQ2NzI2NTQmIyIGFRQWNzIWFRQGIyImNTQ2NzI2NTQmIyIGFRQWNzIWFRQGIyImNTQ2NzI2NTQmIyIGFRQWNzI2NTQmIyIGFRQWNzI2NTQmIyIGFRQWNzIWFRQGIyImNTQ2hygoHigoHg8XJSMZFyUjGRAeHBIQHhwSFyUjGRclIxkQHhwSEB4cEhclIxkXJSMZEB4cEhAeHBIXJSMZFyUjGRclIxkXJSMZFyUjGRclIxkQHhwSEB4cVB4oKB4ofCMZFyUjGRclahwSEB4cEhAeJiMZFyUjGRclahwSEB4cEhAeJiMZFyUjGRclahwSEB4cEhAeJiMZFyUjGRclkCMZFyUjGRclkCMZFyUjGRclahwSEB4cEhAeAAAAAAgAPP+EALQDSAALABcAIwAvADsARwBTAF8AABczNSM1IxUjFTMVMycyNjU0JiMiBhUUFjcyNjU0JiMiBhUUFjcyNjU0JiMiBhUUFjcyNjU0JiMiBhUUFjcyNjU0JiMiBhUUFjcyNjU0JiMiBhUUFjcyFhUUBiMiJjU0NocoKB4oKB4PFyUjGRclIxkXJSMZFyUjGRclIxkXJSMZFyUjGRclIxkXJSMZFyUjGRclIxkXJSMZEB4cEhAeHFQeKCgeKHwjGRclIxkXJZAjGRclIxkXJZAjGRclIxkXJZAjGRclIxkXJZAjGRclIxkXJZAjGRclIxkXJWocEhAeHBIQHgAIADz/hAC0A0gACwAXACMALwA7AEcAUwBfAAAXMzUjNSMVIxUzFTMnMjY1NCYjIgYVFBY3MhYVFAYjIiY1NDY3MjY1NCYjIgYVFBY3MjY1NCYjIgYVFBY3MjY1NCYjIgYVFBY3MjY1NCYjIgYVFBY3MjY1NCYjIgYVFBaHKCgeKCgeDxclIxkXJSMZEB4cEhAeHBIXJSMZFyUjGRclIxkXJSMZFyUjGRclIxkXJSMZFyUjGRclIxkXJSNUHigoHih8IxkXJSMZFyVqHBIQHhwSEB4mIxkXJSMZFyWQIxkXJSMZFyWQIxkXJSMZFyWQIxkXJSMZFyWQIxkXJSMZFyUACQA8/4QAtANIAAsAFwAjAC8ANgBCAE4AWgBmAAAXMzUjNSMVIxUzFTMnMjY1NCYjIgYVFBY3MhYVFAYjIiY1NDY3MjY1NCYjIgYVFBY3FAYjIiY1NzI2NTQmIyIGFRQWNzI2NTQmIyIGFRQWNzI2NTQmIyIGFRQWNzI2NTQmIyIGFRQWhygoHigoHg8XJSMZFyUjGRAeHBIQHhwSFyUjGRclI0ccEhAeLhclIxkXJSMZFyUjGRclIxkXJSMZFyUjGRclIxkXJSNUHigoHih8IxkXJSMZFyVqHBIQHhwSEB4mIxkXJSMZFyU8EB4cElQjGRclIxkXJZAjGRclIxkXJZAjGRclIxkXJZAjGRclIxkXJQAACgA8/4QAtANIAAsAFwAjAC8AOwBHAFMAXwBrAHcAABczNSM1IxUjFTMVMycyNjU0JiMiBhUUFjcyFhUUBiMiJjU0NjcyNjU0JiMiBhUUFjcyFhUUBiMiJjU0NjcyNjU0JiMiBhUUFjcyFhUUBiMiJjU0NjcyNjU0JiMiBhUUFjcyNjU0JiMiBhUUFjcyNjU0JiMiBhUUFocoKB4oKB4PFyUjGRclIxkQHhwSEB4cEhclIxkXJSMZEB4cEhAeHBIXJSMZFyUjGRAeHBIQHhwSFyUjGRclIxkXJSMZFyUjGRclIxkXJSNUHigoHih8IxkXJSMZFyVqHBIQHhwSEB4mIxkXJSMZFyVqHBIQHhwSEB4mIxkXJSMZFyVqHBIQHhwSEB4mIxkXJSMZFyWQIxkXJSMZFyWQIxkXJSMZFyUAAAAMADz/hAC0A0gACwAXACMALwA7AEcAUwBfAGsAdwB+AIoAABczNSM1IxUjFTMVMycyNjU0JiMiBhUUFjcyFhUUBiMiJjU0NjcyNjU0JiMiBhUUFjcyFhUUBiMiJjU0NjcyNjU0JiMiBhUUFjcyFhUUBiMiJjU0NjcyNjU0JiMiBhUUFjcyFhUUBiMiJjU0NjcyNjU0JiMiBhUUFjcUBiMiJjU3MjY1NCYjIgYVFBaHKCgeKCgeDxclIxkXJSMZEB4cEhAeHBIXJSMZFyUjGRAeHBIQHhwSFyUjGRclIxkQHhwSEB4cEhclIxkXJSMZEB4cEhAeHBIXJSMZFyUjRxwSEB4uFyUjGRclI1QeKCgeKHwjGRclIxkXJWocEhAeHBIQHiYjGRclIxkXJWocEhAeHBIQHiYjGRclIxkXJWocEhAeHBIQHiYjGRclIxkXJWocEhAeHBIQHiYjGRclIxkXJTwQHhwSVCMZFyUjGRclAA0APP+EALQDSAALABcAIwAvADsARwBTAF8AawB3AIMAjwCbAAAXMzUjNSMVIxUzFTMnMjY1NCYjIgYVFBY3MhYVFAYjIiY1NDY3MjY1NCYjIgYVFBY3MhYVFAYjIiY1NDY3MjY1NCYjIgYVFBY3MhYVFAYjIiY1NDY3MjY1NCYjIgYVFBY3MhYVFAYjIiY1NDY3MjY1NCYjIgYVFBY3MhYVFAYjIiY1NDY3MjY1NCYjIgYVFBY3MhYVFAYjIiY1NDaHKCgeKCgeDxclIxkXJSMZEB4cEhAeHBIXJSMZFyUjGRAeHBIQHhwSFyUjGRclIxkQHhwSEB4cEhclIxkXJSMZEB4cEhAeHBIXJSMZFyUjGRAeHBIQHhwSFyUjGRclIxkQHhwSEB4cVB4oKB4ofCMZFyUjGRclahwSEB4cEhAeJiMZFyUjGRclahwSEB4cEhAeJiMZFyUjGRclahwSEB4cEhAeJiMZFyUjGRclahwSEB4cEhAeJiMZFyUjGRclahwSEB4cEhAeJiMZFyUjGRclahwSEB4cEhAeAAAIADz/hAC0A0gACwAXAB4AKgA2AEIATgBaAAAXMzUjNSMVIxUzFTMnMjY1NCYjIgYVFBY3FAYjIiY1NzI2NTQmIyIGFRQWNzI2NTQmIyIGFRQWNzI2NTQmIyIGFRQWNzI2NTQmIyIGFRQWNzI2NTQmIyIGFRQWhygoHigoHg8XJSMZFyUjRxwSEB4uFyUjGRclIxkXJSMZFyUjGRclIxkXJSMZFyUjGRclIxkXJSMZFyUjVB4oKB4ofCMZFyUjGRclPBAeHBJUIxkXJSMZFyWQIxkXJSMZFyWQIxkXJSMZFyWQIxkXJSMZFyWQIxkXJSMZFyUACQA8/4QAtANIAAsAFwAjAC8AOwBHAFMAXwBrAAAXMzUjNSMVIxUzFTMnMjY1NCYjIgYVFBY3MhYVFAYjIiY1NDY3MjY1NCYjIgYVFBY3MhYVFAYjIiY1NDY3MjY1NCYjIgYVFBY3MjY1NCYjIgYVFBY3MjY1NCYjIgYVFBY3MjY1NCYjIgYVFBaHKCgeKCgeDxclIxkXJSMZEB4cEhAeHBIXJSMZFyUjGRAeHBIQHhwSFyUjGRclIxkXJSMZFyUjGRclIxkXJSMZFyUjGRclI1QeKCgeKHwjGRclIxkXJWocEhAeHBIQHiYjGRclIxkXJWocEhAeHBIQHiYjGRclIxkXJZAjGRclIxkXJZAjGRclIxkXJZAjGRclIxkXJQAACwA8/4QAtANIAAsAFwAjAC8AOwBHAFMAXwBmAHIAfgAAFzM1IzUjFSMVMxUzJzI2NTQmIyIGFRQWNzIWFRQGIyImNTQ2NzI2NTQmIyIGFRQWNzIWFRQGIyImNTQ2NzI2NTQmIyIGFRQWNzIWFRQGIyImNTQ2NzI2NTQmIyIGFRQWNxQGIyImNTcyNjU0JiMiBhUUFjcyNjU0JiMiBhUUFocoKB4oKB4PFyUjGRclIxkQHhwSEB4cEhclIxkXJSMZEB4cEhAeHBIXJSMZFyUjGRAeHBIQHhwSFyUjGRclI0ccEhAeLhclIxkXJSMZFyUjGRclI1QeKCgeKHwjGRclIxkXJWocEhAeHBIQHiYjGRclIxkXJWocEhAeHBIQHiYjGRclIxkXJWocEhAeHBIQHiYjGRclIxkXJTwQHhwSVCMZFyUjGRclkCMZFyUjGRclAAAAAAoAPAAAALQDSAALABcAIwAvADsARwBTAF8AawB3AAAzMjY1NCYjIgYVFBY3MhYVFAYjIiY1NDY3MjY1NCYjIgYVFBY3MhYVFAYjIiY1NDY3MjY1NCYjIgYVFBY3MhYVFAYjIiY1NDY3MjY1NCYjIgYVFBY3MhYVFAYjIiY1NDY3MjY1NCYjIgYVFBY3MjY1NCYjIgYVFBZ4FyUjGRclIxkQHhwSEB4cEhclIxkXJSMZEB4cEhAeHBIXJSMZFyUjGRAeHBIQHhwSFyUjGRclIxkQHhwSEB4cEhclIxkXJSMZFyUjGRclIyMZFyUjGRclahwSEB4cEhAeJiMZFyUjGRclahwSEB4cEhAeJiMZFyUjGRclahwSEB4cEhAeJiMZFyUjGRclahwSEB4cEhAeJiMZFyUjGRclkCMZFyUjGRclAAAAAAsAPAAAALQDSAALABcAIwAvADsARwBTAF8AawB3AIMAADMyNjU0JiMiBhUUFjcyFhUUBiMiJjU0NjcyNjU0JiMiBhUUFjcyFhUUBiMiJjU0NjcyNjU0JiMiBhUUFjcyFhUUBiMiJjU0NjcyNjU0JiMiBhUUFjcyFhUUBiMiJjU0NjcyNjU0JiMiBhUUFjcyFhUUBiMiJjU0NjcyNjU0JiMiBhUUFngXJSMZFyUjGRAeHBIQHhwSFyUjGRclIxkQHhwSEB4cEhclIxkXJSMZEB4cEhAeHBIXJSMZFyUjGRAeHBIQHhwSFyUjGRclIxkQHhwSEB4cEhclIxkXJSMjGRclIxkXJWocEhAeHBIQHiYjGRclIxkXJWocEhAeHBIQHiYjGRclIxkXJWocEhAeHBIQHiYjGRclIxkXJWocEhAeHBIQHiYjGRclIxkXJWocEhAeHBIQHiYjGRclIxkXJQAKADwAAAC0A0gACwAXACMALwA7AEcAUwBfAGsAdwAAMzI2NTQmIyIGFRQWNzIWFRQGIyImNTQ2NzI2NTQmIyIGFRQWNzIWFRQGIyImNTQ2NzI2NTQmIyIGFRQWNzIWFRQGIyImNTQ2NzI2NTQmIyIGFRQWNzI2NTQmIyIGFRQWNzI2NTQmIyIGFRQWNzIWFRQGIyImNTQ2eBclIxkXJSMZEB4cEhAeHBIXJSMZFyUjGRAeHBIQHhwSFyUjGRclIxkQHhwSEB4cEhclIxkXJSMZFyUjGRclIxkXJSMZFyUjGRAeHBIQHhwjGRclIxkXJWocEhAeHBIQHiYjGRclIxkXJWocEhAeHBIQHiYjGRclIxkXJWocEhAeHBIQHiYjGRclIxkXJZAjGRclIxkXJZAjGRclIxkXJWocEhAeHBIQHgAAAAAGADwAAAC0A0gACwAXACMALwA7AEcAADMyNjU0JiMiBhUUFjcyNjU0JiMiBhUUFjcyNjU0JiMiBhUUFjcyNjU0JiMiBhUUFjcyNjU0JiMiBhUUFjcyNjU0JiMiBhUUFngXJSMZFyUjGRclIxkXJSMZFyUjGRclIxkXJSMZFyUjGRclIxkXJSMZFyUjGRclIyMZFyUjGRclkCMZFyUjGRclkCMZFyUjGRclkCMZFyUjGRclkCMZFyUjGRclkCMZFyUjGRclAAAAAAcAPAAAALQDSAALABcAIwAvADsARwBTAAAzMjY1NCYjIgYVFBY3MhYVFAYjIiY1NDY3MjY1NCYjIgYVFBY3MjY1NCYjIgYVFBY3MjY1NCYjIgYVFBY3MjY1NCYjIgYVFBY3MjY1NCYjIgYVFBZ4FyUjGRclIxkQHhwSEB4cEhclIxkXJSMZFyUjGRclIxkXJSMZFyUjGRclIxkXJSMZFyUjGRclIyMZFyUjGRclahwSEB4cEhAeJiMZFyUjGRclkCMZFyUjGRclkCMZFyUjGRclkCMZFyUjGRclkCMZFyUjGRclAAgAPAAAALQDSAALABcAIwAqADYAQgBOAFoAADMyNjU0JiMiBhUUFjcyFhUUBiMiJjU0NjcyNjU0JiMiBhUUFjcUBiMiJjU3MjY1NCYjIgYVFBY3MjY1NCYjIgYVFBY3MjY1NCYjIgYVFBY3MjY1NCYjIgYVFBZ4FyUjGRclIxkQHhwSEB4cEhclIxkXJSNHHBIQHi4XJSMZFyUjGRclIxkXJSMZFyUjGRclIxkXJSMZFyUjIxkXJSMZFyVqHBIQHhwSEB4mIxkXJSMZFyU8EB4cElQjGRclIxkXJZAjGRclIxkXJZAjGRclIxkXJZAjGRclIxkXJQAACQA8AAAAtANIAAsAFwAjAC8AOwBHAFMAXwBrAAAzMjY1NCYjIgYVFBY3MhYVFAYjIiY1NDY3MjY1NCYjIgYVFBY3MhYVFAYjIiY1NDY3MjY1NCYjIgYVFBY3MhYVFAYjIiY1NDY3MjY1NCYjIgYVFBY3MjY1NCYjIgYVFBY3MjY1NCYjIgYVFBZ4FyUjGRclIxkQHhwSEB4cEhclIxkXJSMZEB4cEhAeHBIXJSMZFyUjGRAeHBIQHhwSFyUjGRclIxkXJSMZFyUjGRclIxkXJSMjGRclIxkXJWocEhAeHBIQHiYjGRclIxkXJWocEhAeHBIQHiYjGRclIxkXJWocEhAeHBIQHiYjGRclIxkXJZAjGRclIxkXJZAjGRclIxkXJQAAAAsAPAAAALQDSAALABcAIwAvADsARwBTAF8AawByAH4AADMyNjU0JiMiBhUUFjcyFhUUBiMiJjU0NjcyNjU0JiMiBhUUFjcyFhUUBiMiJjU0NjcyNjU0JiMiBhUUFjcyFhUUBiMiJjU0NjcyNjU0JiMiBhUUFjcyFhUUBiMiJjU0NjcyNjU0JiMiBhUUFjcUBiMiJjU3MjY1NCYjIgYVFBZ4FyUjGRclIxkQHhwSEB4cEhclIxkXJSMZEB4cEhAeHBIXJSMZFyUjGRAeHBIQHhwSFyUjGRclIxkQHhwSEB4cEhclIxkXJSNHHBIQHi4XJSMZFyUjIxkXJSMZFyVqHBIQHhwSEB4mIxkXJSMZFyVqHBIQHhwSEB4mIxkXJSMZFyVqHBIQHhwSEB4mIxkXJSMZFyVqHBIQHhwSEB4mIxkXJSMZFyU8EB4cElQjGRclIxkXJQAMADwAAAC0A0gACwAXACMALwA7AEcAUwBfAGsAdwCDAI8AADMyNjU0JiMiBhUUFjcyFhUUBiMiJjU0NjcyNjU0JiMiBhUUFjcyFhUUBiMiJjU0NjcyNjU0JiMiBhUUFjcyFhUUBiMiJjU0NjcyNjU0JiMiBhUUFjcyFhUUBiMiJjU0NjcyNjU0JiMiBhUUFjcyFhUUBiMiJjU0NjcyNjU0JiMiBhUUFjcyFhUUBiMiJjU0NngXJSMZFyUjGRAeHBIQHhwSFyUjGRclIxkQHhwSEB4cEhclIxkXJSMZEB4cEhAeHBIXJSMZFyUjGRAeHBIQHhwSFyUjGRclIxkQHhwSEB4cEhclIxkXJSMZEB4cEhAeHCMZFyUjGRclahwSEB4cEhAeJiMZFyUjGRclahwSEB4cEhAeJiMZFyUjGRclahwSEB4cEhAeJiMZFyUjGRclahwSEB4cEhAeJiMZFyUjGRclahwSEB4cEhAeJiMZFyUjGRclahwSEB4cEhAeAAAHADwAAAC0A0gACwASAB4AKgA2AEIATgAAMzI2NTQmIyIGFRQWNxQGIyImNTcyNjU0JiMiBhUUFjcyNjU0JiMiBhUUFjcyNjU0JiMiBhUUFjcyNjU0JiMiBhUUFjcyNjU0JiMiBhUUFngXJSMZFyUjRxwSEB4uFyUjGRclIxkXJSMZFyUjGRclIxkXJSMZFyUjGRclIxkXJSMZFyUjIxkXJSMZFyU8EB4cElQjGRclIxkXJZAjGRclIxkXJZAjGRclIxkXJZAjGRclIxkXJZAjGRclIxkXJQAIADwAAAC0A0gACwAXACMALwA7AEcAUwBfAAAzMjY1NCYjIgYVFBY3MhYVFAYjIiY1NDY3MjY1NCYjIgYVFBY3MhYVFAYjIiY1NDY3MjY1NCYjIgYVFBY3MjY1NCYjIgYVFBY3MjY1NCYjIgYVFBY3MjY1NCYjIgYVFBZ4FyUjGRclIxkQHhwSEB4cEhclIxkXJSMZEB4cEhAeHBIXJSMZFyUjGRclIxkXJSMZFyUjGRclIxkXJSMZFyUjIxkXJSMZFyVqHBIQHhwSEB4mIxkXJSMZFyVqHBIQHhwSEB4mIxkXJSMZFyWQIxkXJSMZFyWQIxkXJSMZFyWQIxkXJSMZFyUAAAoAPAAAALQDSAALABcAIwAvADsARwBTAFoAZgByAAAzMjY1NCYjIgYVFBY3MhYVFAYjIiY1NDY3MjY1NCYjIgYVFBY3MhYVFAYjIiY1NDY3MjY1NCYjIgYVFBY3MhYVFAYjIiY1NDY3MjY1NCYjIgYVFBY3FAYjIiY1NzI2NTQmIyIGFRQWNzI2NTQmIyIGFRQWeBclIxkXJSMZEB4cEhAeHBIXJSMZFyUjGRAeHBIQHhwSFyUjGRclIxkQHhwSEB4cEhclIxkXJSNHHBIQHi4XJSMZFyUjGRclIxkXJSMjGRclIxkXJWocEhAeHBIQHiYjGRclIxkXJWocEhAeHBIQHiYjGRclIxkXJWocEhAeHBIQHiYjGRclIxkXJTwQHhwSVCMZFyUjGRclkCMZFyUjGRclAAAAAAkAO/+EALQDQwALABcAIwAvADsARwBTAF8AawAAMzI2NTQmIyIGFRQWNzI2NTQmIyIGFRQWNzI2NTQmIyIGFRQWEzI2NTQmIyIGFRQWFzI2NTQmIyIGFRQWNzIWFRQGIyImNTQ2NzI2NTQmIyIGFRQWNzIWFRQGIyImNTQ2EzM1IzUjFSMVMxUzeBclIxkXJSMZFyUjGRclIxkXJSMZFyUjGRclIxkXJSMYFyUjGRclIxkQHhwSEB4cExclIxkXJSMZEB4cEhAeHCEoKB4oKB4jGRclIxkXJZAjGRclIxkXJZAjGRclIxkXJQEgIxkXJSMZFyWSIxkXJSMZFyVqHBIQHhwSEB6zIxkXJSMZFyVqHBIQHhwSEB78dx4oKB4oAAAAIgGeAAEAAAAAAAAAAQAEAAEAAAAAAAEAFQAyAAEAAAAAAAIABgBWAAEAAAAAAAMAHwCdAAEAAAAAAAQAHAD3AAEAAAAAAAUACAEmAAEAAAAAAAYAGQFjAAEAAAAAAAcAAQGBAAEAAAAAAAgAAQGHAAEAAAAAAAkAAQGNAAEAAAAAAAoAAQGTAAEAAAAAAAsAAQGZAAEAAAAAAAwAAQGfAAEAAAAAAA0AAQGlAAEAAAAAAA4AAQGrAAEAAAAAABAAFQHZAAEAAAAAABEABgH9AAMAAQQJAAAAAgAAAAMAAQQJAAEAKgAGAAMAAQQJAAIADABIAAMAAQQJAAMAPgBdAAMAAQQJAAQAOAC9AAMAAQQJAAUAEAEUAAMAAQQJAAYAMgEvAAMAAQQJAAcAAgF9AAMAAQQJAAgAAgGDAAMAAQQJAAkAAgGJAAMAAQQJAAoAAgGPAAMAAQQJAAsAAgGVAAMAAQQJAAwAAgGbAAMAAQQJAA0AAgGhAAMAAQQJAA4AAgGnAAMAAQQJABAAKgGtAAMAAQQJABEADAHvACAAACAAAFQAaQBuACAAVwBoAGkAcwB0AGwAZQAgAEYAaQBuAGcAZQByAGkAbgBnAABUaW4gV2hpc3RsZSBGaW5nZXJpbmcAAE0AZQBkAGkAdQBtAABNZWRpdW0AACAAOgAgAFQAaQBuACAAVwBoAGkAcwB0AGwAZQAgAEYAaQBuAGcAZQByAGkAbgBnACAATQBlAGQAaQB1AG0AACA6IFRpbiBXaGlzdGxlIEZpbmdlcmluZyBNZWRpdW0AAFQAaQBuACAAVwBoAGkAcwB0AGwAZQAgAEYAaQBuAGcAZQByAGkAbgBnACAATQBlAGQAaQB1AG0AAFRpbiBXaGlzdGxlIEZpbmdlcmluZyBNZWRpdW0AAFYAZQByAHMAaQBvAG4AIAAAVmVyc2lvbiAAAFQAaQBuAFcAaABpAHMAdABsAGUARgBpAG4AZwBlAHIAaQBuAGcATQBlAGQAaQB1AG0AAFRpbldoaXN0bGVGaW5nZXJpbmdNZWRpdW0AACAAACAAACAAACAAACAAACAAACAAACAAACAAACAAACAAACAAACAAACAAACAAACAAAFQAaQBuACAAVwBoAGkAcwB0AGwAZQAgAEYAaQBuAGcAZQByAGkAbgBnAABUaW4gV2hpc3RsZSBGaW5nZXJpbmcAAE0AZQBkAGkAdQBtAABNZWRpdW0AAAAAAgAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAcAAAAAQACACQAJQAmACcAKAApACoALAAtAC4ALwAwAEQARQBGAEcASABJAEoATABNAE4ATwBQAFEAAAAAAAH//wACAAEAAAAMAAAAEAAAAAIAAAAEAAAAAgAAAAAAAQAAAADaU5nwAAAAAOTTkfUAAAAA5NOR9Q==) format('truetype'); font-weight: normal; font-style: normal; }";function PrepareWhistleFont(){gWhistleFontPrepared||(document.querySelectorAll('div[id="fontholder"] > svg > style')[0].innerHTML+=gWhistleFont,gWhistleFontPrepared=!0)}const gRecorderFont="@font-face { font-family: 'RecorderFingering'; src: url(data:application/font-woff2;charset=utf-8;base64,d09GMgABAAAAADJYAA0AAAABtKAAADH/AAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP0ZGVE0cGhgGYACDJBEICobLeIT+HQuCQgABNgIkA4RkBCAFiwIHg2Nbn0tRd0hhtwNSlIIdLIrKVRz4/z8lsENCRz/Q6VySdLG00hSqpSRt7JYLlt6vpKWPtL9fKd0zSK+WFIfn82uLPUGSv9wqiOGNEOpYh4vwxU2iLVMF2LMVdNxr004aYY7l2OSVfi6hcTh/hMY+yR2guXWLZtvt7pZ3t7htLIDB2IiSFWGAbGMWSkgoRsHAesWnwkYRFROL91F5C/XRxoo3+vX//Te+rOD5f+6/7XPvzB8HZcD/+qOpsOU/SjBveaCBhIm0wh5jwDUYDOtbaxZVYCEzfnsl1yogxf/jcwTZg4V5KdnI/1Hn21Pyj6QCwnoM07EdlwCkVVrR0KRgcwkgac6Z2pAFfo47yjcel16mVO3xtEYZ5uQ/J8CfOd+eprenK9lWqP2yZccpMEuyS8C3ZHpbpiSLAHPfPe7gOdKTLqoezC8lwAxUXJx/m5btjGQ740XbIe+FjiaERbP2AUBRpShHf/Q1Ho1GaJRWC9r1i+FA9jqkkP1Ho5G/NJJ3DBQi8B17N8wdVOkA6fUEvf4fJ08K8utTlFtfmyopq6TouA83ZZo2dRUdQ9RI0HX2X6EANszVUcmKVSIMUFbe5HwZe/Ni9bbV7W8R4RECJJFuDQAApD7gzsb/58k//awisVQOmCzIklXqMJDSy7IILTD0rXoBQBP1kn6YU9NHW9Kp5MXVpVYAGNgRZws2ysBj5F8CAGMVvRRrKPejm25klbJWsJx6AFirkE71VN93yYCbZe/4PJt02Wmv/S57GApJEHgAv671tubZ7ss/6K5vhPHe8+0fRx1x2CG9DuoO+HZdUySLFUzcIo9jsSWWAkgToHotqSzI6IZIAMqIRmd8ono+Wz2/sr6Mht9ottqdbq8/GI7Gk+lsvliu1pvtbn84ns6X6+0OIMKEMi6k0sY6H2LKpbY+5trnfl7wybz5T5U0+VtgUv4VMGPhxMi0IhVgJzun144vbZg19sYV+2fM/g7tf5HUuale51R/X1tXX0NxoBH5SihOGmjvWMeR1hzrMbjkBSvXfzgQyUa9ZBQMb1chERJcxqjM+YBkSZZBJKpnIMkhNbLUssYNPKbaTmE8CJmHNEh5vSAFEsBdIZUFWPWyRFJo82AZCgdbkbbP6HKf0Jzku4CKZDsetRfL2Eb6bw/Z1XdlUSkQEYnYj5NSHFR6KFQmTcuxQE25aNpLtTdQQoDFedDusEaNCpXSZJebRNeVXMBjGTQKjtigJjReyRU8tDwG3UwWfaYthWA4iBFywqWnQrv3aZhGfp4LtBsrSKxzuExOkEWNFunDEQ6ttZJreYDBoaollGak8RAS3BqkjS7T5OLk7gtwCQEyEPrAzTHkwhaaHEYJB8iTMsASkDYjWARABUn7rl2wr3KkFrk563umRXTaw2lT+7rA59SeVeH02ZnpEZ5tSB8EI8kvVFDeSmVVlVAcaPTwE3My9ZbPY6TodVDTmfEpj57adbRHI407RiPr0kiK5KPNXbMgU8bTZRudYJqne732Gpyp15slfTk9tWdn/ewM77jhH4qu0hbVasnfZslLcs9Al0gKdPus5jVtB0ZRTjGnweJXJY2xJDeeHYgaAgNjYNq0ZY0hJGmrmyE4rEjG5sbmbAncdW4Ys1feVXm4Wi+uQStxlSkGjV4EK4g3ZCZJYKwKbNSY4s7Abq/gMiip4ZXlT//SDwrlRFzJhSYjpUGe5iMcXP9W8yQlTHq4Tj2PWCGNyWhGBVA2qJIVFV2g3qDUMTqWiuVbBU/CQ4FlNjg+JR8TJ1drR+vncjO52lyNz/LbrwLKHMkkUK6GGzV4sGxdR6yFRko20twsmYgMHBQzGTj4CoZyAYmeitaQU/kpShRXYehkJeIqN3k1PFStRmK956psyaJbN0JLYwQcsQ30sMmkqnbsrXxwW2uFjg4JhNaLu5F5ACBhuwyYFuShqqjgCigb5khO3wClmGz40KFDJKt+A0JLJo2cCyk2hZUXRYU0ymwpRtjAsuMTLo+RQn76y/rQcJ1aH85x+gfj3DIZzzJHFN2BFnLbbkTbDDEca1SnXJmXPB1pruO3hxwZeoKK4acGWnlFH7ijw04i35wi9/006ofp3JzLx/FmSVhedbICIpvjxZCLOccTs9bJHYajFra3otnNKW7JiGL4WgyM5vKh3VBqnuZAs4KKvCJsjeirsIfxI4Htun38OtFq0yQ1MyJOwE5mR/EBcQWSybbQNZovUlelmmt5mSemixPms6oUABuhBpA56/Uxc0uBGMaeYGYjgEw5Ag5sGQZ1zNxagCv6DKBJDYk80V2NGc3iq6Tnuj8QQuMwXpG/4/dM22KLYrty9Fhy73WAuAlijCMDyXEfhUCghfGHMOuyRSwnVtRaxHRz3sy4LZ6oMi5RQss8NFGJvUpxv70S4zRnHz2EroyUE2rIJXtLQjD+yjpKIv9zeS0T98TZVOuWiLiy4UcF+wZ6Ywr193HK07Mt4LbhnRg3BchWXapv8OLIADO/exXJ/y2jstTi8rZU59Y8bnzPkv6StilibE+zUqJGHc3YlJXE9G/V6d9hRBA6jF5KH5kRGKJ+Xmce9o3oBvYRNdGDFyWddKCNOgEF/teJOfBmtupCuLPIlj6zYsjWkF4xe1lIIUwldRmx0IQ706u8sRLPdwzYsT8ldVaKNj3dcXIeNNc3EIwYZbUKhBBAiK4LoQv9u2i2WU86aJ9lVnM7BPgdfFO0vYGRjyyQFTIKHXnLDTfYSFyxcBq/3krQGclDLUiubnyLqrFdo8vglgrz0BjLxKBQbcHWfiZLY4ZWajAjMjUbKDoaV9/CHh5OvT8csmbuufHOrOOtPOt9aOusNXNRVA7A79sfxYkRbyhv3CPIRTosqAfK1M9NrqjxJjJ8nIWipglrXZTrmFaAZEzqFhUrTtks+ULUpyoPJ+WVGmJtGQqCIPCvRDF37x7oP9L7j2Q3ciNnkn9cPE38qDBByQtAvjcIt2VwQWZDAWxryHBu3ZekVYjV2OscgtuNKyotxfNBKssW0mIGidn36PxEdoOKxUJaLdPrpO8xu/TVqHqLbyMIsxcdlIK1YGXhmC1VBBW9vlXBruMOyA7lsjjzzVmHT3PghLF5QI520Pwr3OJejPksSEDXGd2fGHTOxd8Pu9sePlroOlNvUGGyHLkAPD2IAOaBBbiszyP374miu/oWFXEy0SMg5kLXQSJxC/LIxt9nK3A5/BoFjMKcZAhikfl/ywhvc1wEQdXacpHzBietg+EVrakwr3/4KSqyJPQhngEdaXL49nfdAbldXNZ5YGeKT8X0Je2RZ+DtGRjcHnFa+mbdJX4wy/ZriiBypdi6sRUI4BqDDeorEqX5VZ7mKCB1jLK8UmZg8wmgrePpZcSICGVInYng37H4ytCX+yZc8Oo5PIIqVOB2ENU9F5wUtiKs1myW7gyJvYDf/9OduGj23Ytzo8jH5TiBEel4LoAYOqPge+POYjBWZ/6b5TIwWNBc/ZRwPcpjaxr2WUKqfClWIVO+kRglRMw0hYUhAsKMlggjs4EJlGcR6kmFbQNhSUJR6YYrIoaN/5+avx6h20zqcv6rULHBVLRRWJsyGrhJRbsd05NB9R1RfEqmBh2yMX105BJE7UXJTeoFlZ/+RdviZ7a0elf0egVHmjUe8Rp6aOad2xT0MxUqMo47CehQcqrF+x1FED/0gd7B9uBLMr8Zr9bNzIICr2ydZwbturVpYYmov8jcg4fmMoZeOhQgW86z8m3Yqqd6KxZpFAFmYg3011QKwS2um5HftCCE2AfywpMx55MoHgifYeTnmxJzKWgeBN6CsqJ/IbUW3MFapATOwtUUYQMl1UcJPm3AsjY2dwhhBgGBK2MkAwsWu/Vg9bnH5sJsA6tVtGOzMjlX6wq81ncEVDMKjRz9vQdkFbvXuQatysX4WM2ccQxaikl/MyW67HXEgNkXBKfFrnKOcpLNmdnYvq/UjkqvIfc8x28K2ZTXSAJafCLAQR1Kt+lAnxBY25LgyVZJu7U/xDIUhVoMVMJQQp7W1c94xDJBlGMs8qWUjeModP0jjAzUZRBt+kB0YtFWMqTGjJDRN3WR9Z1T60ON/94Nm9Tz/WHde2+2mXaTZKlNZdbThLntsbbPPH7hdZcZM9uYNHyzdhcCdqUl0t9gZ0QtFwN8tLqLIR5peMK9yYrqIaAzbhsPw0lq0wBoC3HP2UlR0CynvbSJqEmYHR8aRfuWewTOwcCNvKPYGDojuDzdX4IkUUUaHN2UcGno1/BBw88RNuqkrHkVW3u79Myv+nCmx5oKjIWjZrwGP6GNtZv80wWDKtDbdbi10OIOdp9erm99B444neZ2XWV0oodaWYmAfmfn9PpbsDOcmhqd3+mLZLstdAh0KrgyIR/6s6Xc4/4eszJwotJWLgXIZsJXmFzrK4j6q/3Mh5u2tRTa07ITR38nV50cBKXBaK7HF1d0Eo0Lgkqt91dUmRS41DsyxrBUYT829VZpRADqYT5nfSdMrDZOInQtMF2SxCmWD/Go//0Wm5ROapRJyuJCjiojvBJTQl/HyIedTMjg+WLihYmu8i0E4tYrpllI8FS2i4XJJjH0hLZxmEQ0PV6gOku4ajuJokxRErDSKq63pNT81ZxnEWCMCaD7nsD9vJAOhf94vRAhT+LGrcW5LwAx92UZ5xZNvp3Vxt5pjURMOSaWvQ1BuWHQtG//Hf0HFQIy5s5c/VcQQZn+0FHTZbegp7oAt5IJkCx6Di6+KwpEiriHcp/2TXwfNFWbKtjbfTdrm+bMWec21g+3H//cuw0z6/pJuW2PTVxnbqbfObKxXi40NPKMuuoA3aTHG0AEMBDdnUNKVYAZbAwknFDJtpOMlQlvjgpxfEZvqMidDAgQhcQUdrdPVTr630pebHWxSwKLyJpIU9sdCoqlHahKXWtqdqkTg/Y1cLtYFBPkhjC5R19nNzsKFQGTwxEySyP9EdNvIdI5TqJK20oKUc+8pqPrQSnGsm2yXT+Q1CK0cCVpzmP663t2CNsIaDcGRJkMi4Vkw5HQPwLOuKdqjTmzVvZYk7PrN/Zq7tjY2ovx9+Rmvbo6jZmhYQivGvQb7qFdGdZ6wSZ54lZTq0p0ewkU0jk8HLfcz2q06S2p9J/V508Tk24GewsC9Db1Wl0zlXoIlOp0ovmunw+vYGXLnnOT+V9ai+VDYMtRI5yEb+8V86qO8RmAFqGdOGCEEIGOBR9dZrS/uYIMpwGkPXQeQPRlFqLwhfrTpZIx6+JSiSODAQYI+zkVLxoxetZG/bRU8p4gepQmhhP5ygG40wYxoq3PNFzIX0jlLzppyslfqG9XMJ60iQD+Ip2Mf5C2LCXZrOiz0H/0Q/8+F5WI0oY++iNGNn8R+qD/QrN5+Eh3S7a7E5kgZ8exlRClMzGHTfLU0F/hDIBKyDpb9VWaFs5R5a+XQwZwkLp8kuUiICsZhxH5agP9JLwTq4OhJWTRvR13y2O4/efqnr6fK7qtm9uT/Qvbe/2g99rrd6ddFkDT940fuGU04Bi5rEr+swNE8TUfIgQeWxHWa5NPslwN07NG+/hEI4/EySnyS1YnNePTs8jXgC7TQusY4JY8RZibBIg+teefRKbWE/iibiqgZVdSLhpY5rx3jctMvhqd2FS4ok0/dTU5Uue79saE/+FEYpzjfeH4Btbuzxvu+Fm9BquJnvPpDY84tHV/tjd61dFMCWNMJOGnQQz9QQ70sRN6FyMKYToWj0ojTrUAe+sUMPypep3AdY/qeGt3/jtKsOi97E4jn6JX/d4NgJELXr/OAYgrm2sPQhgR9E2cAqp4fNeV7+ZJi/JJVx2noj9MvnaHvNgE+vwv7kv1f4w5mwIpI5tfCifplZGtoU9JgJkM8+fmW29cEb/Ww+cdPVjw3nDBKZfDDcwLE3ESqun3wxXLBa3NkxlzKCZggp4tmEj9FN+/ZSuyGQ8icKaT3530eHvYyAII7lUQkXdtwT7qBnF+taU8Ym1gffl2cGmdAkGkhhGGlYiCgyi4Mfd5bz/xZHPJIDbBTejzMObLrgcgBYgNxVrkRTzmDeMY2tmRmYSI++kcf6XOkBvtXIvFfoztm1bXAoUR6yE/b5phyRXTLc3iLr5CkXelcVMda8TmcNnZPxd2T/2IGpK76kmVwpVvowGTtdW9wlVe74vl5VDNdzEmqncxkJUtycUknSoJ/A75SP20BotnCUH5gu1TQB99MRG5ahVy9tLo0wFZGLBHLchODAWiJk5f4F7XZO+LaIGbQhrEqVu54Xe9yQwvRu8XtD6NAvAfYKw4IrVGIVKqTjcfjxeDOEKcb/JAQvJddInCb0Q/bW7wudkWphyVeMmudEUFOJDLA9WdwL3kpQFy9rmSG0VEXWwWoqlo21Vn+odL03yM4ip08axAwM86xODOhZcdURbLUI2Uqf2VYWaWllsGEm5q28W0mVRZVjFAVCBYy8jX5SYD0sXXagvc7tqqzrJYIYq3tTqN2g3ra2Vv5yf4o21jf//cIQnTtzCxqbiF219TqHNAuAnKVSa704vbV+FHmACPSrQzi//8DWhx8ZHXR4Cfh7Jn1vFUQgkHjp8qNNY4NjhDdqvjW+RMcuS28XvGiVKdZlg3W7bocsHvFAFXJGEbE6K/emRIGxzaGxzPWf/Le1nE1jhEfh8wn6L/d7ZrHV+aLiiNL3yVtJnDnND0UdC7SngMQdvI3bneigkgk+w6hQTGkqlh6ytGvhsLMJdwFIzpxSN4VKHrBEVEDiXTfeHLL5dc3OF3/x7veSLW5DKChjHANXqVszjliYy9vpE5eel1f86O1Q/v9/QzJgmntVQxAvCgjMVUaMS2/bOB6rMzq2DmznNpXDumNLYsrr7O2nPStdGbJ8wiFUcs3J43RVUxJkrxc8fsmU5f/4BNXtbO7Vczcj3VVcnkmSTBd1qUSZv1RATTXcPptFh7wk49g0VAFmjXeoTY1xTJLG68yM+djghJlGgheYadQzONBWjcQ19ihThGpaVQcgEa9+9xCyDqZHlK2IK9XVVba4r+mbboWPfA7RrTyGlGEqAhkcvAJNYTz6PfikddOeH56VNQ1BBTUrlRHWZJD3Z5Jys5WgadGVwB0vi3/xykGS0RUl2UXJDB/fTtzb36dF9UiOnxo/LyuEKnHLU7fIOl8Yrp0OSgQheOJahM/kh5+pUr/GklV4ujBmdRrCxe+eRmYiggsnqKVOpMP6Es8yUXlikh4WOfRuUtc/i9qXihX3Wswe8o274yFUneHC7HCUe0Q3lUHm5BcfjBR4odxxwq/Khzczysd6L4m4bbLRi6tdxxJsL++kiRiii4FuZuVAN63juP4qrOTjuBy7vQjKNUFG6DwF6BuRyG2gRbD4wBSlIJYvvQZ91SytbzwHCQt14WqkCZydztdSRe2yoe3t4mb9tuORLkREAZ03HW2/AwhPvZ9JmHiL5+liL+T8eWf+WfaA9I9hOC/DKlurRaqS4sVROfPRi6HJPbzRhuN8tBtBD9d86k8ImgPrIKO46rHDjqJPBQ82OwDnZA7oM3KbY1fPnZD3hqgLn3w1eB8L5/z8dFwvCvIjFAf5KWiWWV2MHZkQz2pXd84/Byo+H5OVOkd0y6LyY5JnW+AXlcK5d+F2/9BPRbZq68rR3nrWrjkeq2c+XbB+z5wEwLYpFEgdKC33bMylqdSfJw9L0OtRJ1fg9utZB+Zr093kSe8ev3sOUpE6x2YKVOaIFqDR8menJimT35wfTXHlXCWCcHi6iccmrzCSglheqyzRaZlta9MI4tyUqPhYt1fT2FdOsDrE2erH83HZJ99+/PgnQwA8LWIqiaWa1weWQ/ZOBoUjsh6jO+/251/cjni6RsPFegVH1QK8uqlarqMqXmkx3Hwu1TY/cswjzhmILVU6giCkrVqk+Oar8KvmuPJUJw4d2XbkHlnGcHNB8BZSqi1JdcWErwCDnqsURaPKicsMcCmCf1mFm1ooS7xfSX5HfPctOOow57TzjMyUgCAF32H+FUHtTBwPdLF8j4ioMUjOjYNba7PQzy+7lowv0TarJbi+gm4FzLRWubJKEAxnR8fzvYBZebBb0g1AaDbbKRkWFm42biaymgBCTm/zOsgPE8Qz7o1nBF3ddfCo48EAbuk6DeZ21PcGlfp7AqoLNkzSEpCCiHSbCc0sD0pFaJfE6+8QJc6j3+a6E6XfcrGl8mpBqDCUy9MFlZhfKfYNzor5uBMNKlPlOzVSIPR+ySvhBezIpELvqrNz2e1O9O2n1F9f8FogB4knbyJirTGB1iTI1ygk4gCRYDhG3BkTVTJrXl7E1blC4fjeSLs1fHDysV1sY6R/92IzWFzhEKg+ExLiI8gB3A2uP1DLmnHI/7hlxJPfF8r/5f0ycYzBHCJF9HtvvxPasmTJkXFryD/D3KGIlQ1njDS7wkc1lV6iAaK3/ovRFUn3lZcfTavNCmQtd/QxHHpCGsn/ZWOffkHe99ZXaIf+asL/CxUV95vj8SbB5IBcWrEk9/2Y8HbDwAHJTSMvV9iwe8FbFz/R8H7/q+Q2cYRCRb9XJj4BDCSQpA4eE0oYw3HaBzjfGz1WujmUIXbAMY3DFbX9mWhnkzhHRt9WISjSxEM3h9M3I3VVYUUxJsE+esaNtQSaOqLRGkbG3LDiBhelVcBWnQAeAhbnMdCdw5M6LN+kBzwZ6kTW14om+6+f/7q4Bc95G+qOQ46vd8yVE54cAwnVFxZ7dRzb0twlSzqpVlT9iPpOs5RSq1r9RV6lMTpWUqaCNWgmNmO4ZQRMVixfEo/4rqDvS9R71fgk82IEKe/4UwgE9UmkwylOz+Qj9y6gMbHzgO5HlSaVK4gBE+XLWtnSaRDp3+RbTm5mCwBwLiuVMB1iY3ZFa74bIs5M6GsQBdKpXvfVl6s2ZlHcFCbf3LeGZaU6LA0DmiRJMFED1mtNC9zpElC9T5ZyuL8J2Un4A2YmaVHFfZsTIXv5byiMA5Oq1G8LdagAQezz7LAdNnRMUM1eWqMmaMEg0RpYVZdKLUEaoD4fFDW7dIoLUQU1yXYT2RfjdB708oCxnh90qHykfZ+xNEQi35A52WqpWefjiWyNNAiULodgDr8iUGrfjYi0tqb1r1SljQLBC2FSmlmq2pAvbISBanVemxGnaxIUwebFHWHL1zLkUvsJ25KUE6uhGOaMIcdsDECWLD+gVmdWXo5KSEpbECOaFhE5khKJEs5y2sCKzUv6vHMzu3yIiTv4DioWt2Ajk3bxjQSO3tlQzHsRumcCyhaGrKnChTXE7GX7LE8f+8AiUJidoiqMWmskmN383jsC1mzo+ITsi9e3Z4QZg6CGQz2JfGHFMYzw0wG+L/U7v6BHzZtilRa+NbesR8qNt8t2/2xKhwJFLZdEo73cINzs4+clgTfeaXaEWxIUATvbcnVtd37NgTg7iie3FYxdJlbJbLIMGE3X1iaeWSn3ZdSIvf3aOR8ioZ9MHsdjbTMc2tgK8dQ5W/XB+e1H9XH1niDeTP/oVO8wWN6+NAmNwUjs6VbR1oFDhOnZYmr0NQcfFEEetE+iVcoKfWY2MUSVSauhCVIYHzFTq6AM+9f4soW12UliNBkctX87WSyYhjtbMcSM3vtflajkGlgcyaPqBfTH0D851cMm2VPpLA2fdoJmYLmHNNKQmxx6qcGGYn8D6HBcUOZWoE+WWqO5wvuH4vIR5RqA7WKwn/6RWUEcovjj6csGO4QxULis/6fQXmtOJ443hqSD0A8eIBQDp/QXO/FxZcmKGUVYSCUlSulKZxiMTD37qdj897yAHZgfb9XzJELz+LhV+MvK9CEcDSHDAGW3K8HE2yxQPN8lSxaGhJgcSowmRfqT50ZqpVRZmQUqzBDf9ZXaTbXwLgRL5+SHqiRYZlYoh1YpzHulHp3yqlDlldMgMGM+y/slu0YxjBPK3b5tbyguljhB3sX+0ZoPDKz+CmYOCLsZY5m0j2NX4zq4tnI7Qfz9T1j6Y56Tdm1X4CvIDo2DnPay/IswGRVQoAfNx41Kr8fv+x4Y/qf3fJVIN+EU/AwfBgjPR/NEDbRjplp7UjWgsvyYlmdcEF9nKvEnOo/xMfXwQ4al383kNcXu92/r/btil4XdvTNOzyOg77GymXz+QEfDsNdbNQjiCAW7cyIKBuZgYmcboWMHuZUpePyerlUJ7l9gXFytzMKa9ZzxlfzkGLyjkB3y5zn0vC7AV9LnOBL53PL+fJz7aD13tSTnFba48G1DWw0Fl13L6ZDVTXVRwfXaanUK3x+R1lPg1P9ZcUqs1e2g4N6C8CCLHOD2p8pYSqzGsO1QCIXkfKHOvQMhUkn0zEPxrk3Y7LyHB042aHK9drxjHY4INDMeUVHJS6Ike/xZuj136P2iOzmGPNduzBWpUcN1tkjZj/OG9+71OfcCVofUqo3gLKvCpJIioNoP3eoahHOUSwplDbVmGFu/tjk7u20sFu6Sk7zbywxGcHwni4Dh3LHMDYo3yIeyHgtwAiy0IHL8nhAXdXUAEJYav782P6lzVJDjdolsHO+QnvkyZof2VK5Slt6/KvADLXvCOfCEj4a+MSJVPi2yAwnINt1OjHx6I4XNFmHd+JYQ7whATOERGOmPE4Wrda2zBEYqX9Z1C4LFmpRjL36R8l0aQ/aXGvUdAQBiP5XXLjB5oQP6qyIPnCDwJoH5kP3c8klcqji9dI7pJ7z20QuDyybKQJgKXZLxk3OCOdRJyagtaYP75AmfvVBYclOISqcfVBfHRVbkxP4sKf7DWP8OjcqTHhEl342tOGGeNc52R3H9HFnr0djTckJagiY9xx+uPXeq4bB/c4j1vdXpdqkC6wq0+Cfb932e4+d2LPSfW4tB4qI569cZFJM/LlyIljuOrW+8V7zt03xpQWagVZI6gm9PSvfYIxhSlSWb/rRW9qMORaTNspwiUTJolui4zLKs3agtCpmY72BAG4Pj2ELwRVDZLzBYYaPaX3fmHnVkx78rRA5FaXJ6UOFR7dP1rJLaMHWRtRlzzd23IdK4g/uGh/CJwIF34ZHVZxCBA71fLp7zYU5lcV6Hm7emPxQ078sxut1bgyJE2nOJXkjK4YOHDDxsCBVms0cnzJxYtgZJSQc59Dd169vmyvUjM1O0g0q4YG30rImtuxITAFJFmVqZ8YzJRUtYOdGcEpGuRLlhj24IXT9QMDrKIPnW+qTbHG2iIJtBhiknZ4g41hq3UKQ7KLxWzNehChHPT6dShHKkYU9mhQ3t3W9jBQbs4KEpH+qZuQcDA4zlhehAjqBHSkeBxB1e+Ob1gl1iT8bopOKywSvfacEU6bEr5hoFAVkcRkdYZ5rAFRz1BE2NTCDWhpMjY1B0ieZAfFNfTAgmoB4j7chLigrSlqfjuTcdqOF33uIIXdHYdiL14FDtCky23eAYa4O+fUtvEhLzcvTcgJrddhEZrsGQrXEBXfYg/NCk7a/ob4dpOqdye0rQn5PdjoEFchl84bkcRgt9qunzsMTFbYPdHc6zFpazIH6ONXJI47fbFLnKTDAzVjShWONBWoQDwOegQ7O4SwMuwzolNn7vp6ReNOq1kJQU3QR6N2WwpcFdH4fP8n+KImi6J2pfOUQ1w1qTHQI59/wGVxwLAefc9buTjV3x3WUdHdakBcOqBCQv0HqHF7o28V6sxdX8FaA5Ptp6+BHxDwywUScITZU9O3GXbeovqcV6CSBbIDbQreqno+9+xWPmdNEuWVWPj1mxN9eSnKe/VVJDRfcnRj9nBMHhYeG25XxWOubidUsU6r3B3opQJGaO73QoIL5yHBiweA4H7ttyBVylGZIrRCqgyVsaO42w9weVt34AFdbSDPsvelGOHW49fSS5H45VeRkOUa4aTzqmB2M+b4wR6rcuDWaq5ADS4uANDtqxWpjj4p0BvLyfRpinyueThaiO9+6P5KKqD9Pykp1Oh5MC93cMnIcd1Pjz2VCbs77KyQz6C8MWb0ZJn5VE+U6fNzYdBYeXp22t1JXWTFmycyKmqpWwXSu2/LfSCSNUoc8v81RW//qQK1ym9QqFOpqm8iCJ8htN2WgNdirN2BYh5zLHzzO9pPtZ/rNFcBkCf7HdWlBKWHIXs0zzBymKMPXRpr98gwT1g8xzenyRgVgZdhQSbP3qP8mX5Q1gWVjr15UR3Lu/HwsNhwe7Tdie0vJW7Imh7BmgAl5yxPyowExFvhaT6pA/njqTdNa8/PK2fSnTnJZUy6pXCb/8Af2p8Hl0+30GlbiodsfOGk0bfkukqpjKJtXUtzFfanr8evFSpWY584ZiLL5LwozzmFujbA4G5+wZXEMgcsXCblQT9AfOm2KbFMs7zzY1tXEIe6dlAeonANiwdtilfftIlqt9w1wh4sf/FZlTguFKhuTSwUpwhT9XKdeOwcucumAk2ycaoiraBjnQj+hOyi0Ud2/3tP50mrXQlBzZBwe5EK1e4eDHNGDmOyO1XeqAWFYblBItLjrom2E8EDOpu7QnUQTbgINdV4yNbYLlGr7f+FRQ/NLBInP6tCF+VNse4YIlZFRkCdZncUN2N3UVyJHtMP7K+nuX55FhJO2BInl2lsantk6NXjmS9Q89yHf4PSRLMeD0wC49kPH6WSF5VlUGEgFk51Hk3MGXaUB/W7a2niRypPUp+In01NIirJvnkC/Lu9AjVAxW/0/CbbpkZJOUj67Ij040fyOs5LVviRocuedEnarSDwUs3Q5wJGKcQ/5iCjEitRv45XOHLaZfgqZu9knuRPy0t/GPXbA/WPCynUwJNH1LOx6teGUZgJ6d+MkG/sJ3s8k/9o6U381O90V5y9vJbuWr9WVtgp4AuPQRVQ64TXgpQWAadZ/Pm36xXQeii3fTZfeEg530VJpuzf4jDEBZcXiQS1ArgoMz3O2OQS8odFMFmdNreVrVLY3TFc7MWXwAHqNJeER6EPvvOcGFAUwq90E4iIXD+eCr/cNkbFu9q+0KayocbvpgSwLeaANfMR3vn7/XfVBvE/SG+S2LcVYehRub5+5ox6uwE7Za3vzKPElAmJWvyM2hU7b9TH64bGGgNSpz18wGREjqBuu4xa162vI/ScVyEyVWMkFHZ3LOofcuEEQ5wa74viHBMFl8OONlc+0ZUsNm7Ai6ZdIcci/nD6WtXuiyAGsP0q2wMVzOEFTOby+tA4aqNm+vCCFBn/zrb6MKXMo+XRAP/UT4g/GBQ/JPNjOTzTGc/81hHvpwHm9YOE/GEAdFPiHrYnOmaeJvFnGdKxDoHmTpo/I2nkmwOX1c4DqadcSTVsBaA65mnVrs8PfILwC1hV1YqDGtYhKMORpomIZSYuJQHhcNe+AA5OnS9aYninzcvfsgw/3F7BbQCIkAw/lBKdg9pK9p5tR7qETF3WvK7HOJGVLiYjauY0yt1hrOmbxtHSHKwW0uGVprqz62uTxzmZx087p0RK8Lv2ft/QKxpk08yNsvLPw5xEdBQp9W+AmsU4/tY7ZSW8qWzNH0hD+vwN6LQvsxrR8i/0nHmbrF6GflvJEpAjjQFWJds8/7s2jhStzUY9l2reakuvEooAIkGtomunP4xookq7jH7aetLmRGo7t5IPYzH324noKQ+Npxz7ydZWZjSMZHHiEpu1EjbLFLH42sZxHv17h+QT7ey+thVH+vOidnW2MwsBjv2E2CMIIxs9n5PF3eMcAuqxrcUtn+vzENGiHZHwo4lxaVquq59czdN3oFDEcMe4CEg9bJwKzDr+8XWkXrIZwWg7Z/ARBkNyDIFZTj9uhGtX9FMKdAeDYBkWsRKvwaIujosCotSlzYOHtqQ3r2pLa0xrkra3rUK7LWkXl9YoZIRssGlwzZOxfFlj6yy7Y6ZzVmWVo8xePtM+00Gd6Si3OSVYThdBhIr/tLSzbJ9NqckKPLlIgd/HFUU+ufKGnhzcw+JGEqlVWErVumBfUqjT1OM0JYUG+8BfBqHr2fD5LkjQKzD3HoZI989zA7bX/ctva8C5XW080ALsSFT3C5befyDi3WEYBOIIKZ6+/fJVLsaufDj8NxwCTuT+MQ4Ze3YSMu4P1x/Zfzj+eAudmxhhHc+24Oyz2UCNoLfv8Wcuu/I/6y8Y1J6BE2e/nX0k4q8YFA2KCFhCHNCEz39QcZDTC3ogKZEX1VdLehHWkoCePR8WZrDHy+c2cnlzvuNtSWMzc1Zfa5sF8mbPfL2SmZ3GXgE2NAbIplmUsoz8/+R51TELsXLF9XqA3anw3iSCGtstyu2t8ybKVLlDc4Sug/0C9D+K3vBGJjx/biCScdugercGFM35V8wHW/cNLhXNSOqmaU+pO0Y1qBuq+/pOBQb17rAY50yehIV07YiIjfS/xmQIxaCjwDKUAnn2J91WKvKDkN/fFc8NwcXV6ipp9ODqVlDIAwxl357wRZ2nYwYTtbgcjx3n0cv19QI1xRvOYud2AJ8chsEGXUSSw6U3uBwRSTqDYbDDqwssNDziydVK/td//hus/OcRj68k+IqHStXE9SMHJOLa4UVGdONPTIMEl5ZVZ+8/zZc8+qaSP7oshu/0O5qGqI/xYsdS/nv2Fje+4kpkr76hjoH+UqOhtZZApkz79+HSkGFtI/46/qM7QyGRGNf9OGeEybLuR5tdFdRy0mONXPZOJnvPTBnIfCeTPcUWZXq1f38zvJ+gfVHo3SQZEqSx6Wa06OAU8cOfCwtk8Zcue6Z3mZSSSG2wSYjIpFlBhlub93C4pVWR1jqIPvJlkLk+d/n3JeH1+lH//rh58Z/9COfp9DlRuoq2Cl2UbmnbUhPDoDMEfrquu34cSEE0JRj4qXPv0yVjl9axxSvv4ej+/mGuiEtHkstluFA/brYJF4ZbQ7hzdZO4NkFBin9G5bLkgUz+ge3BH6RTx0iWTUp+ZtBUX6Ue0tTqiZque7qawNRnBk1jjWl37QDNjA6dlMWelqteolkinyUCb93KnoLN83LBJ3pt0uGe5nUwyM34LURhNGDlWKPWuMaOc5nl++31wNH4tKkYA7f0y6Qfn4cFaVdrQhcsNikOtc3Plus7UPWJiGWVLZPUusULqGHJiAxFKMGGGCuMGEx3U4w8USvLQJ96HObA5+dQ6Z1+fsCWgnfRI8WTmkH+pO86a/8/DuMiXVdTRCb/bL8IXbmfw0i2btJeu7uJMacZht2L0RB3ntfr1Obh2JwLhDrz4YsRUf+f5ISGHD4Sxe4kW2AM+XinJoFzQYjLAAH2Ojbw+V0ZtMntKOPcqpJugX7PbZ3pe10zEt8eWhUYMGuW9qWSXYnZDNIpkw8eIBQ/7Bg9GYXEz1ZP0VpqTFSpBKYYQ2iITEKhDbt25cYlJe4Ohmjvip3hdOer50miY1qXg0IuTz/9l95PswN0hR+Aik5qBUmeWxdC4dkw45WwDsfaMQcdfGGizhYX+Wi5ghKdobBOPGemExct0i1QGEzTNe+fTc2Wz9U9G0hBfeqq7qgUS4NFv79tmGvCRTXaanFs9P7NfDFPbixfbPKDH3Zh3xg/F6/nyQFdzH3lfw3pHyWBh7VJY4VbQg06w0/2K1Ln/uGYp6l0jE1LZUq6MGJz3YW/gjxG+fITfeH+6WF8Xe32VNGNk5MmgKLz91F3w9H5udM1oY07wq1dXUGGHastrHaAIMmQpdUxjCMUVPJNM1sT71Pw3KXHJMspiOMcrrbz5+7Gt455eU8sVQIy6TfPeTKALoozyJA2sej8vUGRmTPGamQxgzsWCeE1Hambf72G6vafDdK1VrsC777dZ020hd3/W3sEkgt+6s45nX+s73jOj3m78n4+mnP8eE7fsfxdY3ftytmVffDAq8Mr3JkrfCs2b/Iud7eu9LR6N25q9ba6vSs8rRs7M1t9K1rdre51HTHtXbrAHb3p5YH63rND0i3sqMcIWD0pq3PX7pGdAw0xk30xmTHTSzwxvpiYydDaCx9p/Rr94/6Cxhx+/Bsmh1YbaMGz+cr/eosXyYBbCACYyC3dIRIMgl8V3LfRwQmML+nFIMx3hHxc3zC/XsrvKvw8kTYMN2XfQ7GRdpOatZ2J4dGOZINupqjhHuW7eXTnNXj8rWUmPM1RGU7qLdpH/MTivwmyvWaZmRRVU4aX1QcyHKOU0XFIBdlNF1lmTCKv8K/Gayhengr9Smh9BeNGpElitmufdbPDTWTSpsoKILHwGk4t+lgY27tufbqNcAk8b/d10zlGiP7pIHUANl/cQGQtxRPM3edJWC7yZAzPeApdbDyVIE08DTPdPB2YuzwDu8g8E1JRPAuvJvBsKc3iOUjtYwOqs3guSS+UebnqLh7E6mPJAoy+h7JrR6z4bMDAk0AO8mQ8t3iKdP/wVETG8zRg1vJ0yhzgGZC84Jn0xeVZsBrCs7XULJ6D3G42oHo4zxXWY2TerN7Kg6De+ZwW4PWLPoXV0AU6kZhSS3gyDQG9Yx7HJ562pbmFFbSVy6GnRCSmNCc58HsDNbO29m2gK2c1qFGvaCf3AT5e+t0PxNMxpRHoY8/5DNDoOnued2ifJxTV3k1//nk6FlABnvUeqfi4chNurRfJR/c4MKLlaKnQ2R6FAZ2ZtRYKDnlr69GxVsriR2zd/LRaqnVQEnnjCAIDqsU0vZSuHNn/VQv0ZyBt1WVovswEsUiOvWzhN48C+MiSikkc5X4ADK2c7C01RBSgensyZRVed0WwtvdDwV2xXJOnlOrEEyEXVsm4FdnerxJabYAnloMcuOdttBJDHiuHOix+pDDgpJ5u4hAjne9VFTzWU7Evs1zO7TcOwJV6qVpAYBawpwo5Y2wq2fkLheIZL5qD0GsHLTl3R+AUyVomIaWETI3w+0mQLfzrIrzpCfVmFPdZ84oTkYCCiGZYTiyRyuS8QlBRVVPX0NTS1tHV0zcwNDI2MTXzA3m5f21Z29ja2Ts4Ojm7uLq5AyAEIyiGEyRFMyzHC6IkK6qmG6ZlO26P1+dXpdphLRqtsc0mDSotTaX9W6HOA03bvcnHrz/vftDvtJ3GyrdIgXMKnXHWJeddcNGfbhjvuZfqHQyVRCPRga9hkJgkFokNfCMAaUkKIHFJJBKPF8pv2HtbN6+snGSJUbzc2M57IO4quWU/bzZBK29z276zl608vZk+pp9/7+k5r1L1gI5VCuRf21uuXkuPcatgdEUEnkyqXfjwb4IC) format('woff2')}";function PrepareRecorderFont(){gRecorderFontPrepared||(document.querySelectorAll('div[id="fontholder"] > svg > style')[0].innerHTML+=gRecorderFont,gRecorderFontPrepared=!0)}function injectSVGCSS(e,t){var n=Array.from(document.querySelectorAll('style[data-aggregate-css="true"]')).map(e=>e.textContent).join("\n");return e=t?e.replace("<style/>","<style/><style>"+n+"</style>"):e.replace("<style></style>","<style>"+n+"</style>")}function injectWhistleSVGCSS(e,t){var n=Array.from(document.querySelectorAll('style[data-aggregate-css="true"]')).map(e=>e.textContent).join("\n");return e=t?e.replace("<style/>","<style/><style>"+gWhistleFont+".whistle {font-family: 'TinWhistleFingering';font-size: 50px;}.hiddentabline {display:none;}"+n+"</style>"):e.replace("<style></style>","<style>"+gWhistleFont+".whistle {font-family: 'TinWhistleFingering';font-size: 50px;}.hiddentabline {display:none;}"+n+"</style>")}function injectRecorderSVGCSS(e,t){var n=Array.from(document.querySelectorAll('style[data-aggregate-css="true"]')).map(e=>e.textContent).join("\n");return e=t?e.replace("<style/>","<style/><style>"+gRecorderFont+".recorder {font-family: 'RecorderFingering';font-size: 50px;}.hiddentabline {display:none;}"+n+"</style>"):e.replace("<style></style>","<style>"+gRecorderFont+".recorder {font-family: 'RecorderFingering';font-size: 50px;}.hiddentabline {display:none;}"+n+"</style>")}function injectNoteNamesSVGCSS(e,t){var n=Array.from(document.querySelectorAll('style[data-aggregate-css="true"]')).map(e=>e.textContent).join("\n");return e=t?e.replace("<style/>","<style/><style>.hiddentabline {display:none;}"+n+"</style>"):e.replace("<style></style>","<style>.hiddentabline {display:none;}"+n+"</style>")}function DoCeoltasTransform(e){sendGoogleAnalytics("tablature",e?"DoCeoltasTransform_Inverse":"DoCeoltasTransform"),setABCEditorText(ceoltasABCTransformer(getABCEditorText(),e,!1)),gIsDirty=!0;var t="Comhaltas ABC transform complete!";t=makeCenteredPromptString(t),DayPilot.Modal.alert(t,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()}).then(function(){RenderAsync(!0,null,function(){ensureDialogVisible("#ceoltasanchor")}),IdleAdvancedControls(!0),IdleAllowShowTabNames()})}function InjectOneBagpipeDrones(e,t,n,o,a,l){function r(e,t,n){return e.replace(/"[^"]*"|[^"]/g,e=>e.startsWith('"')?e:e.replace(new RegExp(t,"g"),n))}function i(e,t){return e.replace(/([A-Ga-gzZ][',]?[\d*\/]?[',\/>]?)(\d*)/g,(e,n,o)=>{var a=function(e){const t=e.match(/(\d+)/);return t?t[0]:""}(e);return-1!=e.indexOf("/")&&(a+="/"),-1!=e.indexOf(">")&&(a+=">"),`${t}${o||""}${a}-`})}var s,c,g="",d=!1,u="A";t>=6&&19!=t&&(u="D");var m=-1==e.indexOf("% Converted to ABC using bww2abc"),p=0;switch(l&&(p=function(e){switch(getTuneRootKey(e)){case"B#":case"C":return 300;case"C#":case"Db":return 400;case"D":return 500;case"D#":case"Eb":return 600;case"E":case"Fb":return-500;case"E#":case"F":return-400;case"F#":case"Gb":return-300;case"G":return-200;case"G#":case"Ab":return-100;case"A":default:return 0;case"A#":case"Bb":return 100;case"B":case"Cb":return 200}}(e)),t){case 0:c="[A,,,, A,,,]",m?(d=o,p=148+p,g=o?" stems=down transpose=0\n%%MIDI program 143\n%voice_tuning_cents 148 "+p:" stems=down transpose=0\n%%MIDI program 109\n%voice_tuning_cents 148 "+p):g=" transpose=0\n%%MIDI program 109";break;case 1:c="[A,,,, A,,,]",p=100+p,m?(d=o,g=o?" stems=down transpose=0\n%%MIDI program 143\n%voice_tuning_cents 100 "+p:" stems=down transpose=0\n%%MIDI program 109\n%voice_tuning_cents 100 "+p):(e=e.replaceAll("%voice_tuning_cents 48 148","%voice_tuning_cents 0 100"),g=" transpose=0\n%%MIDI program 109");break;case 19:c="[A,,,, A,,,]",m?(d=o,p=54+p,g=o?" stems=down transpose=0\n%%MIDI program 143\n%voice_tuning_cents 54 "+p:" stems=down transpose=0\n%%MIDI program 109\n%voice_tuning_cents 54 "+p):(e=(e=e.replaceAll("transpose=1","transpose=0")).replaceAll("%voice_tuning_cents 48 148","%voice_tuning_cents 54 54"),g=" transpose=0\n%%MIDI program 109");break;case 2:c="[A,,,, A,,,]",m?(d=o,g=o?" stems=down transpose=0\n%%MIDI program 143\n%voice_tuning_cents 0 "+p:" stems=down transpose=0\n%%MIDI program 109\n%voice_tuning_cents 0 "+p):(e=(e=e.replaceAll("transpose=1","transpose=0")).replaceAll("%voice_tuning_cents 48 148","%voice_tuning_cents 0 0"),g=" transpose=0\n%%MIDI program 109");break;case 3:c="[A,,,, A,,,]",m?(d=o,p=500+p,g=o?" stems=down transpose=0\n%%MIDI program 143\n%voice_tuning_cents -700 "+p:" stems=down transpose=0\n%%MIDI program 109\n%voice_tuning_cents -700 "+p):(e=(e=e.replaceAll("transpose=1","transpose=0")).replaceAll("%voice_tuning_cents 48 148","%voice_tuning_cents -700 500"),g=" transpose=0\n%%MIDI program 109");break;case 4:c="D,,",m?(d=o,p<0&&(p+=1200),g=" stems=down transpose=-7\n%%MIDI program 131\n%voice_tuning_cents 0 "+p):e=(e=(e=e.replaceAll("%%MIDI program 109","%%MIDI program 131")).replaceAll("transpose=1","transpose=-7")).replaceAll("%voice_tuning_cents 48 148","%voice_tuning_cents 0 0");break;case 5:c="D,,",m?(d=o,p<0&&(p+=1200),g=" stems=down transpose=-7\n%%MIDI program 130\n%voice_tuning_cents 0 "+p):e=(e=(e=e.replaceAll("%%MIDI program 109","%%MIDI program 130")).replaceAll("transpose=1","transpose=-7")).replaceAll("%voice_tuning_cents 48 148","%voice_tuning_cents 0 0");break;case 6:c="D,,",l&&(p+=700)>500&&(p-=1200),m?(d=o,g=" stems=auto transpose=0\n%%MIDI program 132\n%voice_tuning_cents 0 "+p):e=(e=(e=e.replaceAll("%%MIDI program 109","%%MIDI program 132")).replaceAll("transpose=1","transpose=-7")).replaceAll("%voice_tuning_cents 48 148","%voice_tuning_cents 0 0");break;case 7:c="D,",l&&(p+=700)>500&&(p-=1200),m?g=" stems=auto transpose=0\n%%MIDI program 129\n%voice_tuning_cents 0 "+p:e=(e=(e=e.replaceAll("%%MIDI program 109","%%MIDI program 129")).replaceAll("transpose=1","transpose=-7")).replaceAll("%voice_tuning_cents 48 148","%voice_tuning_cents 0 0");break;case 8:c="E,",l&&(p+=700)>500&&(p-=1200),m?g=" stems=auto transpose=0\n%%MIDI program 129\n%voice_tuning_cents 0 "+p:e=(e=(e=e.replaceAll("%%MIDI program 109","%%MIDI program 129")).replaceAll("transpose=1","transpose=-7")).replaceAll("%voice_tuning_cents 48 148","%voice_tuning_cents 0 0");break;case 9:c="D,",p-=100,l&&(p+=700)>500&&(p-=1200),m?g=" stems=auto transpose=0\n%%MIDI program 129\n%voice_tuning_cents -100 "+p:e=(e=(e=e.replaceAll("%%MIDI program 109","%%MIDI program 129")).replaceAll("transpose=1","transpose=-7")).replaceAll("%voice_tuning_cents 48 148","%voice_tuning_cents -100 -100");break;case 10:c="E,",p-=100,l&&(p+=700)>500&&(p-=1200),m?g=" stems=auto transpose=0\n%%MIDI program 129\n%voice_tuning_cents -100 "+p:e=(e=(e=e.replaceAll("%%MIDI program 109","%%MIDI program 129")).replaceAll("transpose=1","transpose=-7")).replaceAll("%voice_tuning_cents 48 148","%voice_tuning_cents -100 -100");break;case 11:c="D,",p-=200,l&&(p+=700)>500&&(p-=1200),m?g=" stems=auto transpose=0\n%%MIDI program 129\n%voice_tuning_cents -200 "+p:e=(e=(e=e.replaceAll("%%MIDI program 109","%%MIDI program 129")).replaceAll("transpose=1","transpose=-7")).replaceAll("%voice_tuning_cents 48 148","%voice_tuning_cents -200 -200");break;case 12:c="E,",p-=200,l&&(p+=700)>500&&(p-=1200),m?g=" stems=auto transpose=0\n%%MIDI program 129\n%voice_tuning_cents -200 "+p:e=(e=(e=e.replaceAll("%%MIDI program 109","%%MIDI program 129")).replaceAll("transpose=1","transpose=-7")).replaceAll("%voice_tuning_cents 48 148","%voice_tuning_cents -200 -200");break;case 13:c="D,",p-=300,l&&(p+=700)>500&&(p-=1200),m?g=" stems=auto transpose=0\n%%MIDI program 129\n%voice_tuning_cents -300 "+p:e=(e=(e=e.replaceAll("%%MIDI program 109","%%MIDI program 129")).replaceAll("transpose=1","transpose=-7")).replaceAll("%voice_tuning_cents 48 148","%voice_tuning_cents -300 -300");break;case 14:c="E,",p-=300,l&&(p+=700)>500&&(p-=1200),m?g=" stems=auto transpose=0\n%%MIDI program 129\n%voice_tuning_cents -300 "+p:e=(e=(e=e.replaceAll("%%MIDI program 109","%%MIDI program 129")).replaceAll("transpose=1","transpose=-7")).replaceAll("%voice_tuning_cents 48 148","%voice_tuning_cents -300 -300");break;case 15:c="D,",p-=400,l&&(p+=700)>500&&(p-=1200),m?g=" stems=auto transpose=0\n%%MIDI program 129\n%voice_tuning_cents -400 "+p:e=(e=(e=e.replaceAll("%%MIDI program 109","%%MIDI program 129")).replaceAll("transpose=1","transpose=-7")).replaceAll("%voice_tuning_cents 48 148","%voice_tuning_cents -400 -400");break;case 16:c="E,",p-=400,l&&(p+=700)>500&&(p-=1200),m?g=" stems=auto transpose=0\n%%MIDI program 129\n%voice_tuning_cents -400 "+p:e=(e=(e=e.replaceAll("%%MIDI program 109","%%MIDI program 129")).replaceAll("transpose=1","transpose=-7")).replaceAll("%voice_tuning_cents 48 148","%voice_tuning_cents -400 -400");break;case 17:c="D,",p-=500,l&&(p+=700)>500&&(p-=1200),m?g=" stems=auto transpose=0\n%%MIDI program 129\n%voice_tuning_cents -500 "+p:e=(e=(e=e.replaceAll("%%MIDI program 109","%%MIDI program 129")).replaceAll("transpose=1","transpose=-7")).replaceAll("%voice_tuning_cents 48 148","%voice_tuning_cents -500 -500");break;case 18:c="E,",p-=500,l&&(p+=700)>500&&(p-=1200),m?g=" stems=auto transpose=0\n%%MIDI program 129\n%voice_tuning_cents -500 "+p:e=(e=(e=e.replaceAll("%%MIDI program 109","%%MIDI program 129")).replaceAll("transpose=1","transpose=-7")).replaceAll("%voice_tuning_cents 48 148","%voice_tuning_cents -500 -500")}if(s=(s=(s=InjectStringBelowTuneHeader(e,n?"%\n%%score (1 2)\n%\n%play_highlight_v1_only\n%\nV:1"+g:"%\n%%score 1 2\n%\n%play_highlight_v1_only\n%\nV:1"+g)).replace(/^\s*[\r\n]/gm,"")).trim(),d&&(s=function(e,t){for(var n,o=e,a=JustTheNotes(e),l=a.split("\n"),i=l.length,s=!1,c="",g=0;g<i;++g){if(0!=(n=l[g]).indexOf("%")&&-1==n.indexOf("V:"))switch(s=!0,t){case"A":n=r(n=(n=(n=(n=(n=(n=(n=(n=(n=(n=(n=(n=(n=(n=n.replaceAll("C,,","c")).replaceAll("D,,","d")).replaceAll("E,,","e")).replaceAll("F,,","f")).replaceAll("G,,","G")).replaceAll("A,,","A")).replaceAll("B,,","B")).replaceAll("C,","c")).replaceAll("D,","d")).replaceAll("E,","e")).replaceAll("F,","f")).replaceAll("G,","G")).replaceAll("A,","A")).replaceAll("B,","B"),"C","c"),n=r(n,"D","d"),n=r(n,"E","e"),n=(n=(n=(n=(n=(n=(n=(n=(n=r(n,"F","f")).replaceAll("b","B")).replaceAll("c'","c")).replaceAll("d'","d")).replaceAll("e'","e")).replaceAll("f'","f")).replaceAll("g'","g")).replaceAll("a'","a")).replaceAll("b'","b");break;case"D":n=(n=(n=(n=(n=(n=(n=(n=(n=(n=(n=(n=(n=(n=(n=(n=(n=(n=(n=(n=(n=n.replaceAll("C,,","C")).replaceAll("D,,","D")).replaceAll("E,,","E")).replaceAll("F,,","F")).replaceAll("G,,","G")).replaceAll("A,,","A")).replaceAll("B,,","B")).replaceAll("C,","C")).replaceAll("D,","D")).replaceAll("E,","E")).replaceAll("F,","F")).replaceAll("G,","G")).replaceAll("A,","A")).replaceAll("B,","B")).replaceAll("e","E")).replaceAll("f","F")).replaceAll("g","G")).replaceAll("a","A")).replaceAll("b","B")).replaceAll("c'","C")).replaceAll("d'","D")}c+=n+"\n"}return s?(c=c.trim(),o.replace(a,c)):o}(s,u)),a){s+="\n%\n% Injected drones\n%\n";var h=JustTheNotes(e),f=(h=StripOrnamentsOne(h=StripTabOne(h=StripChordsOne(h=StripTextAnnotationsOne(h=h.split("\n").filter(e=>!e.trim().startsWith("%")).join("\n")))),!1)).split("\n"),b=f.length,y="",T="!mf! ";switch(t){case 0:case 1:case 2:case 3:case 19:y+=n?"V:2 stems=down octave=4 transpose=-48\n%%MIDI program 109\n%%MIDI transpose -48\n%%voicecolor transparent\n":"V:2 stems=down octave=4 transpose=-48\n%%MIDI program 109\n%%MIDI transpose -48\n";break;case 4:y+=n?"V:2 stems=down octave=3 transpose=-36\n%%MIDI program 131\n%%MIDI transpose -36\n%%voicecolor transparent\n":"V:2 stems=down octave=3 transpose=-36\n%%MIDI program 131\n%%MIDI transpose -36\n",T="!pp! ";break;case 5:y+=n?"V:2 stems=down octave=3 transpose=-36\n%%MIDI program 130\n%%MIDI transpose -36\n%%voicecolor transparent\n":"V:2 stems=down octave=3 transpose=-36\n%%MIDI program 130\n%%MIDI transpose -36\n",T="!pp! ";break;case 6:y+=n?"V:2 stems=down octave=3 transpose=-36\n%%MIDI program 132\n%%MIDI transpose -36\n%%voicecolor transparent\n":"V:2 stems=down octave=3 transpose=-36\n%%MIDI program 132\n%%MIDI transpose -36\n",T="!pp! ";break;case 7:case 9:case 11:case 13:case 15:case 17:y+=n?"V:2 stems=down octave=2 transpose=-24\n%%MIDI program 129\n%%MIDI transpose -24\n%%voicecolor transparent\n":"V:2 stems=down octave=2 transpose=-24\n%%MIDI program 129\n%%MIDI transpose -24\n",T="!p! ";break;case 8:case 10:case 12:case 14:case 16:case 18:y+=n?"V:2 stems=down octave=2 transpose=-24\n%%MIDI program 129\n%%MIDI transpose -24\n%%voicecolor transparent\n":"V:2 stems=down octave=2 transpose=-24\n%%MIDI program 129\n%%MIDI transpose -24\n",T="!mp! "}for(var I=!1,A=0;A<b;++A){var S=f[A];""!=(S=i(S,c))&&(I||(S=T+S,I=!0)),y+=S,y+="\n"}s+=y}return s.trim()}var gLastInjectedBagpipeSound=0;function InjectBagpipeSounds(){if(gRenderingPDF)return;findSelectedTuneIndex();const e={hidedronevoice:!0,injectalltunes:!0,dronestyle:gLastInjectedBagpipeSound,transposemelody:!1,foldnotes:!0,injectdronevoice:!0,matchtunekey:!1};var t=[{html:'<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">Inject Bagpipe Sounds<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#advanced_injectbagpipesounds" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="margin-top:18px;margin-bottom:18px;font-size:12pt;line-height:16pt;font-family:helvetica;">Clicking "Inject" will change the melody sound to the selected bagpipe instrument and optionally inject drones as a second voice of the tune(s).</p>'},{html:'<p style="margin-top:18px;margin-bottom:18px;font-size:12pt;line-height:16pt;font-family:helvetica;">Bagpipe tunes imported from a BWW files assume the drones are consonant with the note A in the ABC notation for all styles of injected bagpipes.</p>'},{html:'<p style="margin-top:18px;margin-bottom:18px;font-size:12pt;line-height:16pt;font-family:helvetica;">For all other tunes, the Great Highland Bagpipe, Border Pipes, and Smallpipes drones are consonant with the note A in the ABC notation and the Säckpipa, and Uilleann Pipes drones are consonant with the note D in the ABC notation.</p>'},{html:'<p style="margin-top:18px;margin-bottom:18px;font-size:12pt;line-height:16pt;font-family:helvetica;">In these cases, you may need to transpose your tunes before using this feature to sound best with the drones, for example transposing a D Mixolydian tune to A Mixolydian or the inverse.</p>'},{html:'<p style="margin-top:18px;margin-bottom:18px;font-size:12pt;line-height:16pt;font-family:helvetica;">Tunes previously injected with drones will be skipped.</p>'},{name:"Bagpipe style to inject:",id:"dronestyle",type:"select",options:[{name:"  Great Highland Bagpipe - A=480 Hz (Pipe band high pitch)",id:0},{name:"  Great Highland Bagpipe - A=466 Hz (Standard B-flat)",id:1},{name:"  Great Highland Bagpipe - A=454 Hz (Practice chanter)",id:19},{name:"  Border Pipes in A - A=440 Hz",id:2},{name:"  Border Pipes in D",id:3},{name:"  Smallpipes in A",id:4},{name:"  Smallpipes in D",id:5},{name:"  Swedish Säckpipa in D",id:6},{name:"  Uilleann Pipes in D (Crowley-style drones)",id:7},{name:"  Uilleann Pipes in D (Lynch-style drones)",id:8},{name:"  Uilleann Pipes Flat Set in C# (Crowley-style drones)",id:9},{name:"  Uilleann Pipes Flat Set in C# (Lynch-style drones)",id:10},{name:"  Uilleann Pipes Flat Set in C (Crowley-style drones)",id:11},{name:"  Uilleann Pipes Flat Set in C (Lynch-style drones)",id:12},{name:"  Uilleann Pipes Flat Set in B (Crowley-style drones)",id:13},{name:"  Uilleann Pipes Flat Set in B (Lynch-style drones)",id:14},{name:"  Uilleann Pipes Flat Set in Bb (Crowley-style drones)",id:15},{name:"  Uilleann Pipes Flat Set in Bb (Lynch-style drones)",id:16},{name:"  Uilleann Pipes Flat Set in A (Crowley-style drones)",id:17},{name:"  Uilleann Pipes Flat Set in A (Lynch-style drones)",id:18}],cssClass:"configure_drones_select"},{name:"          Fold the displayed and played notes into the chanter range",id:"foldnotes",type:"checkbox",cssClass:"configure_injectdrones_form_text"},{html:'<p style="margin-top:18px;margin-bottom:12px;font-size:12pt;line-height:12pt;font-family:helvetica;">Note: Smallpipes and Säckpipa always fold played notes into the chanter range.</p>'},{name:"          Inject drones",id:"injectdronevoice",type:"checkbox",cssClass:"configure_injectdrones_form_text"},{name:"          Shift drone pitch to match tune key (non-BWW imported tunes only)",id:"matchtunekey",type:"checkbox",cssClass:"configure_injectdrones_form_text"},{name:"          Hide drone voice",id:"hidedronevoice",type:"checkbox",cssClass:"configure_injectdrones_form_text"},{name:"          Inject all tunes",id:"injectalltunes",type:"checkbox",cssClass:"configure_injectdrones_form_text"}];DayPilot.Modal.form(t,e,{theme:"modal_flat",top:75,width:685,scrollWithPage:AllowDialogsToScroll(),okText:"Inject",autoFocus:!1}).then(function(e){if(sendGoogleAnalytics("action","InjectBagpipeSounds"),!e.canceled){var t=e.result.injectalltunes;gLastInjectedBagpipeSound=e.result.dronestyle;var n=!1,o=0;if(t){var a=CountTunes(),l=FindPreTuneHeader(getABCEditorText());clearGetTuneByIndexCache();for(var r=0;r<a;++r){var i=getTuneByIndex(r);-1!=i.indexOf("% Injected drones")||isSectionHeader(i)||isMultiVoiceTune(i)||(i=InjectOneBagpipeDrones(i,e.result.dronestyle,e.result.hidedronevoice,e.result.foldnotes,e.result.injectdronevoice,e.result.matchtunekey),n=!0),l+=(i=i.trim())+"\n\n"}if(clearGetTuneByIndexCache(),n)setABCEditorText(l),gIsDirty=!0,RenderAsync(!0,null,function(){gRawLastIndex=-1;DayPilot.Modal.alert('<p style="text-align:center;font-size:14pt;font-family:helvetica;">Inject Bagpipe Sounds Complete!</p>',{theme:"modal_flat",top:300,width:500,scrollWithPage:AllowDialogsToScroll()}).then(function(){gCurrentTune=0,gEnableSyntax?(gTheCM.selectionStart=0,gTheCM.selectionEnd=0):(gTheABC.selectionStart=0,gTheABC.selectionEnd=0),FocusAfterOperation()})});else{var s='<p style="text-align:center;font-size:14pt;font-family:helvetica;">Inject Bagpipe Sounds Complete!</p>';DayPilot.Modal.alert(s,{theme:"modal_flat",top:300,width:500,scrollWithPage:AllowDialogsToScroll()})}}else{o=findSelectedTuneIndex();var c=findSelectedTune();if(""==c)return;var g=c;if(-1!=g.indexOf("% Injected drones")||isSectionHeader(g)||isMultiVoiceTune(g)||(g=InjectOneBagpipeDrones(g,e.result.dronestyle,e.result.hidedronevoice,e.result.foldnotes,e.result.injectdronevoice,e.result.matchtunekey),n=!0),n){g=g.trim();var d=getABCEditorText();setABCEditorText(d=d.replace(c,g)),gIsDirty=!0,RenderAsync(!0,o,function(){gRawLastIndex=-1;DayPilot.Modal.alert('<p style="text-align:center;font-size:14pt;font-family:helvetica;">Inject Bagpipe Sounds Complete!</p>',{theme:"modal_flat",top:300,width:500,scrollWithPage:AllowDialogsToScroll()}).then(function(){var e;gEnableSyntax?(e=gTheCM.selectionStart,gCurrentTune=o,gTheCM.selectionStart=e,gTheCM.selectionEnd=e):(e=gTheABC.selectionStart,gCurrentTune=o,gTheABC.selectionStart=e,gTheABC.selectionEnd=e),FocusAfterOperation()})})}else{s='<p style="text-align:center;font-size:14pt;font-family:helvetica;">Inject Bagpipe Sounds Complete!</p>';DayPilot.Modal.alert(s,{theme:"modal_flat",top:300,width:500,scrollWithPage:AllowDialogsToScroll()})}}}})}function DoCeoltasTransformDialog(){DayPilot.Modal.alert('<div id="ceoltasanchor"><p style="text-align:center;margin-bottom:36px;font-size:16pt;font-family:helvetica;margin-left:15px;">Comhaltas ABC Transform&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#advanced_comhaltas" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p><p style="text-align:center;"><input id="ceoltasdialog" class="advancedcontrols btn btn-injectcontrols" onclick="DoCeoltasTransform(false)" type="button" value="Standard ABC to Comhaltas ABC" title="Transforms the standard ABC format to Comhaltas format"><input id="ceoltasdialoginverse" class="advancedcontrols btn btn-injectcontrols" onclick="DoCeoltasTransform(true)" type="button" value="Comhaltas ABC to Standard ABC" title="Transforms the Comhaltas format to standard ABC format"></p></div>',{theme:"modal_flat",top:150,width:650,scrollWithPage:AllowDialogsToScroll()}).then(function(){ensureMoreToolsVisible()})}function TuneTitlesNumbersDialog(){DayPilot.Modal.alert('<div id="tunetitlesanchor"><p style="text-align:center;margin-bottom:36px;font-size:16pt;font-family:helvetica;margin-left:15px;">Add/Remove Tune Title Numbers&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#advanced_injecttunetitlenumbers" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p><p style="text-align:center;"><input id="addtunetitlenumbers" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AddTuneTitleNumbers()" type="button" value="Add Numbers to Tune Titles" title="Adds incrementing numbers to the tune titles"><input id="removetunetitlenumbers" class="advancedcontrols btn btn-injectcontrols" onclick="RemoveTuneTitleNumbers(true)" type="button" value="Remove Tune Title Numbers" title="Removes any tune title numbers that were added"></p></div>',{theme:"modal_flat",top:200,width:650,scrollWithPage:AllowDialogsToScroll()}).then(function(){ensureMoreToolsVisible()})}var gIncipitsBuilderBars=3,gIncipitsBuilderWidth=400,gIncipitsBuilderLeftJustify=!0,gIncipitsBuilderInjectNumbers=!1,gIncipitsBuilderStripText=!0,gIncipitsBuilderMultiPart=!0,gIncipitsBuilderOwnLines=!1,gIncipitsTagsToStrip="ABCDINOSWwZ";function IncipitsBuilderDialog(){const e={IncipitsBuilderBars:gIncipitsBuilderBars,IncipitsBuilderWidth:gIncipitsBuilderWidth,IncipitsBuilderLeftJustify:gIncipitsBuilderLeftJustify,IncipitsBuilderInjectNumbers:gIncipitsBuilderInjectNumbers,IncipitsBuilderStripText:gIncipitsBuilderStripText,IncipitsBuilderStripTags:gIncipitsTagsToStrip,IncipitsBuilderMultiPart:gIncipitsBuilderMultiPart,IncipitsBuilderOwnLines:gIncipitsBuilderOwnLines};DayPilot.Modal.form([{html:'<p style="text-align:center;font-size:16pt;font-family:helvetica;margin-bottom:24px;margin-left:15px;">Notes Incipits Builder&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#incipits_builder_pdf" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="font-size:12pt;line-height:18pt;font-family:helvetica;">Clicking "Build" will extensively reformat the ABC, so you may want to grab a Snapshot or save the ABC before using this feature.</p>'},{html:'<p style="font-size:12pt;line-height:18pt;font-family:helvetica;margin-bottom:24px;">The reformatted ABC can be exported as first-line Notes Incipits from the Export PDF dialog.</p>'},{html:'<p style="font-size:12pt;line-height:18pt;font-family:helvetica;margin-bottom:24px;"><strong>Note:</strong> When generating multi-part incipits the staff width is not used and all text blocks are stripped.</p>'},{name:"    Create multi-part incipits (Part A, Part B, etc.)",id:"IncipitsBuilderMultiPart",type:"checkbox",cssClass:"incipits_builder_form_text_checkbox"},{name:"    Multi-part incipits parts on their own staves",id:"IncipitsBuilderOwnLines",type:"checkbox",cssClass:"incipits_builder_form_text_checkbox"},{name:"Number of bars: (Default is 3)",id:"IncipitsBuilderBars",type:"number",cssClass:"incipits_builder_form_text"},{name:"Staff width: (Default is 400, full width is 556)",id:"IncipitsBuilderWidth",type:"number",cssClass:"incipits_builder_form_text"},{name:"    Left justify incipits titles.",id:"IncipitsBuilderLeftJustify",type:"checkbox",cssClass:"incipits_builder_form_text_checkbox"},{name:"    Add numbers before titles",id:"IncipitsBuilderInjectNumbers",type:"checkbox",cssClass:"incipits_builder_form_text_checkbox"},{name:"    Strip all %%text, %%center, %%right, and %%begintext blocks",id:"IncipitsBuilderStripText",type:"checkbox",cssClass:"incipits_builder_form_text_checkbox"},{name:"    Tags to strip (Default is ABCDINOSWwZ):",id:"IncipitsBuilderStripTags",type:"text",cssClass:"incipits_striptags_text"}],e,{theme:"modal_flat",top:100,width:600,scrollWithPage:AllowDialogsToScroll(),okText:"Build",autoFocus:!1}).then(function(e){if(!e.canceled){sendGoogleAnalytics("action","IncipitsBuilder"),gIncipitsBuilderBars=e.result.IncipitsBuilderBars;var t=parseInt(gIncipitsBuilderBars);isNaN(t)&&(t=3,gIncipitsBuilderBars=3),gIncipitsBuilderWidth=e.result.IncipitsBuilderWidth;var n=parseInt(gIncipitsBuilderWidth);isNaN(n)&&(n=400,gIncipitsBuilderWidth=400),gIncipitsBuilderLeftJustify=e.result.IncipitsBuilderLeftJustify,gIncipitsBuilderInjectNumbers=e.result.IncipitsBuilderInjectNumbers,gIncipitsBuilderStripText=e.result.IncipitsBuilderStripText,gIncipitsTagsToStrip=e.result.IncipitsBuilderStripTags,gIncipitsBuilderMultiPart=e.result.IncipitsBuilderMultiPart,gIncipitsBuilderOwnLines=e.result.IncipitsBuilderOwnLines;var o,a=CountTunes();if(0==a)return o=makeCenteredPromptString(o="No tunes for incipits building."),void DayPilot.Modal.alert(o,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});for(var l,r=(l=getABCEditorText()).split(/^X:/gm),i=FindPreTuneHeader(l),s=1;s<=a;++s){var c,g="X:"+r[s];gIncipitsBuilderMultiPart&&(g=StripTextAnnotationsOne(g=StripChordsOne(g)),g=gIncipitsBuilderOwnLines?buildABCIncipitsSingleTune(g,gIncipitsBuilderBars,{partsOnNewLines:!0}):buildABCIncipitsSingleTune(g,gIncipitsBuilderBars)),c=gIncipitsBuilderMultiPart?gIncipitsBuilderOwnLines?"%incipits_inject_start\n%%staffwidth 556\n%%printtempo 0\n%hide_rhythm_tag\n%%stretchlast true\n":"%incipits_inject_start\n%%maxstaves 1\n%%staffwidth 556\n%%printtempo 0\n%hide_rhythm_tag\n":"%incipits_inject_start\n%%maxstaves 1\n%%noexpandtowidest\n%%barsperstaff "+(t+1)+"\n%%staffwidth "+n+"\n%%printtempo 0\n%hide_rhythm_tag\n",c+=gIncipitsBuilderLeftJustify?"%left_justify_titles\n%incipits_inject_end":"%incipits_inject_end",g=InjectStringAboveTuneHeader(g=g.replace(/^%incipits_inject_start[\s\S]*?^%incipits_inject_end.*(\r?\n)?/gm,""),c);for(let e of gIncipitsTagsToStrip)g=removeAllTags(g,e);gIncipitsBuilderStripText&&(g=StripTextAnnotationsOne(g)),i+=g+"\n\n"}if(setABCEditorText(i),gIncipitsBuilderInjectNumbers)setABCEditorText(l=RemoveTuneTitleNumbers(!1)),setABCEditorText(processTuneTitleNumbers(a,l));SaveConfigurationSettings(),o=makeCenteredPromptString(o="Incipits built!"),DayPilot.Modal.alert(o,{theme:"modal_flat",top:300,scrollWithPage:AllowDialogsToScroll()}).then(function(){RenderAsync(!0,null,function(){gEnableSyntax?(gTheCM.selectionStart=0,gTheCM.selectionEnd=0,gTheCM.focus()):(gTheABC.selectionStart=0,gTheABC.selectionEnd=0,gTheABC.focus()),MakeTuneVisible(!0),ensureMoreToolsVisible()})})}})}function cleanTitleNumber(e){return e.replace(/^[0-9.]+/,"")}function processTuneTitleNumbers(e,t){var n=FindPreTuneHeader(t);""!=n&&(n+="\n");var o,a=0;for(o=0;o<e;++o){var l=getTuneByIndex(o);if(isSectionHeader(l)){n+="\n",n+=l,n+="\n";continue}a++;const e=l.split("\n");var r=!1,i="";for(let t=0;t<e.length;t++){let n=e[t];r||(n.startsWith("T: ")&&(n=n.replace("T:",""),n=n.trim(),n="T: "+a+". "+n,r=!0),r||n.startsWith("T:")&&(n=n.replace("T:",""),n=n.trim(),n="T:"+a+". "+n,r=!0)),i+=n,i+="\n"}n+=i,n+="\n"}return n=n.replaceAll("\n\n\n","\n\n")}function AddTuneTitleNumbers(){var e=CountTunes();if(0==e)return n=makeCenteredPromptString(n="No tunes to add tune title numbers."),void DayPilot.Modal.alert(n,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});sendGoogleAnalytics("action","AddTuneTitleNumbers");var t=RemoveTuneTitleNumbers(!1);setABCEditorText(t),result=processTuneTitleNumbers(e,t),setABCEditorText(result),gIsDirty=!0;var n,o=document.getElementById("addtunetitlenumbers");o&&(o.value="Adding Tune Title Numbers"),n=makeCenteredPromptString(n="Tune title numbers added!"),DayPilot.Modal.alert(n,{theme:"modal_flat",top:250,scrollWithPage:AllowDialogsToScroll()}).then(function(){RenderAsync(!0,null,function(){ensureDialogVisible("#tunetitlesanchor");var e=document.getElementById("addtunetitlenumbers");e&&(e.value="Tune Title Numbers Added",setTimeout(function(){var e=document.getElementById("addtunetitlenumbers");e&&(e.value="Add Numbers to Tune Titles")},500))})})}function RemoveTuneTitleNumbers(e){var t=getABCEditorText(),n=CountTunes();if(e){if(0==n)return g=makeCenteredPromptString(g="No tunes with title numbers to remove."),void DayPilot.Modal.alert(g,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});sendGoogleAnalytics("action","RemoveTuneTitleNumbers")}var o,a=FindPreTuneHeader(t);""!=a&&(a+="\n");var l=!1;for(o=0;o<n;++o){var r=getTuneByIndex(o);if(isSectionHeader(r)){a+="\n",a+=r,a+="\n";continue}const e=r.split("\n");var i=!1,s="";for(let t=0;t<e.length;t++){let n=e[t];if(!i){if(n.startsWith("T: ")){var c=n;n=n.replace("T:",""),n=n.trim(),n=cleanTitleNumber(n),n=n.trim(),n="T: "+n,i=!0,c!=n&&(l=!0)}if(!i&&n.startsWith("T:")){c=n;n=n.replace("T:",""),n=n.trim(),n=cleanTitleNumber(n),n=n.trim(),n="T:"+n,i=!0,c!=n&&(l=!0)}}s+=n,s+="\n"}a+=s,a+="\n"}if(a=a.replaceAll("\n\n\n","\n\n"),!e)return a;if(l){setABCEditorText(a),gIsDirty=!0;var g,d=document.getElementById("removetunetitlenumbers");d&&(d.value="Removing Tune Title Numbers"),g=makeCenteredPromptString(g="Tune title numbers removed!"),DayPilot.Modal.alert(g,{theme:"modal_flat",top:250,scrollWithPage:AllowDialogsToScroll()}).then(function(){RenderAsync(!0,null,function(){ensureDialogVisible("#tunetitlesanchor");var e=document.getElementById("removetunetitlenumbers");e&&(e.value="Tune Title Numbers Removed",setTimeout(function(){var e=document.getElementById("removetunetitlenumbers");e&&(e.value="Remove Added Tune Title Numbers")},500))})})}}function saveCustomHarmonica(){sendGoogleAnalytics("action","saveCustomHarmonica");var e=JSON.stringify(gHarmonicaCustom);saveTextFile("Please enter a filename for your custom harmonica tuning:",gHarmonicaCustom.name+".txt",e)}function loadCustomHarmonicaClickHandler(){document.getElementById("load_custom_harmonica_tuning_fs").click()}function loadCustomHarmonica(e){sendGoogleAnalytics("action","loadCustomHarmonica");const t=new FileReader;t.addEventListener("load",e=>{var t=e.target.result;try{var n=JSON.parse(t);if(!n.type||"CustomHarmonica"!=n.type)return a=makeCenteredPromptString(a="This is not a valid custom harmonica tuning file."),void DayPilot.Modal.alert(a,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});if(1==(gHarmonicaCustom=n).version){gHarmonicaCustom.version=3;for(var o=0;o<22;++o)gHarmonicaCustom.noteMap.push("x")}else if(2==gHarmonicaCustom.version){gHarmonicaCustom.version=3;for(o=0;o<12;++o)gHarmonicaCustom.noteMap.push("x")}initCustomHarmonicaSettings()}catch(e){var a;return a=makeCenteredPromptString(a="This is not a valid custom harmonica tuning file."),void DayPilot.Modal.alert(a,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})}}),t.readAsText(e)}function resetHarmonicaCustom(){gHarmonicaCustom=JSON.parse(JSON.stringify(gHarmonicaCustomDefault))}function defaultCustomHarmonica(){sendGoogleAnalytics("action","defaultCustomHarmonica");var e="Are you sure you want to reset the custom harmonica tuning?";e=makeCenteredPromptString(e),DayPilot.Modal.confirm(e,{top:180,theme:"modal_flat",scrollWithPage:AllowDialogsToScroll()}).then(function(e){if(!e.canceled){var t;resetHarmonicaCustom();var n="r0c1";for(document.getElementById(n).value=gHarmonicaCustom.name,t=0;t<12;++t){n="r1c"+(t+1);document.getElementById(n).value=gHarmonicaCustom.noteMap[t]}for(t=0;t<12;++t){n="r2c"+(t+1);document.getElementById(n).value=gHarmonicaCustom.noteMap[t+12]}for(t=0;t<12;++t){n="r3c"+(t+1);document.getElementById(n).value=gHarmonicaCustom.noteMap[t+24]}for(t=0;t<12;++t){n="r4c"+(t+1);document.getElementById(n).value=gHarmonicaCustom.noteMap[t+36]}for(t=0;t<12;++t){n="r5c"+(t+1);document.getElementById(n).value=gHarmonicaCustom.noteMap[t+48]}}})}function customHarmonicaChangeHandler(){var e,t="r0c1";for(gHarmonicaCustom.name=document.getElementById(t).value,e=0;e<12;++e){t="r1c"+(e+1);gHarmonicaCustom.noteMap[e]=document.getElementById(t).value}for(e=0;e<12;++e){t="r2c"+(e+1);gHarmonicaCustom.noteMap[e+12]=document.getElementById(t).value}for(e=0;e<12;++e){t="r3c"+(e+1);gHarmonicaCustom.noteMap[e+24]=document.getElementById(t).value}for(e=0;e<12;++e){t="r4c"+(e+1);gHarmonicaCustom.noteMap[e+36]=document.getElementById(t).value}for(e=0;e<12;++e){t="r5c"+(e+1);gHarmonicaCustom.noteMap[e+48]=document.getElementById(t).value}}function initCustomHarmonicaSettings(){var e,t="r0c1";for(document.getElementById(t).value=gHarmonicaCustom.name,e=0;e<12;++e){t="r1c"+(e+1);document.getElementById(t).value=gHarmonicaCustom.noteMap[e]}for(e=0;e<12;++e){t="r2c"+(e+1);document.getElementById(t).value=gHarmonicaCustom.noteMap[e+12]}for(e=0;e<12;++e){t="r3c"+(e+1);document.getElementById(t).value=gHarmonicaCustom.noteMap[e+24]}for(e=0;e<12;++e){t="r4c"+(e+1);document.getElementById(t).value=gHarmonicaCustom.noteMap[e+36]}for(e=0;e<12;++e){t="r5c"+(e+1);document.getElementById(t).value=gHarmonicaCustom.noteMap[e+48]}}function idleOpenCustomHarmonica(){document.getElementById("load_custom_harmonica_tuning_fs").onchange=()=>{let e=document.getElementById("load_custom_harmonica_tuning_fs");if(0===e.files.length){var t="Please select a custom harmonica tuning file";return t=makeCenteredPromptString(t),void DayPilot.Modal.alert(t,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})}loadCustomHarmonica(e.files[0]),e.value=""}}function EditCustomHarmonica(){sendGoogleAnalytics("dialog","EditCustomHarmonica");var e=JSON.parse(JSON.stringify(gHarmonicaCustom));const t=[{html:'<p style="text-align:center;font-size:16pt;font-family:helvetica;margin-left:15px;margin-bottom:32px">Edit Custom Harmonica Tuning Tab&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#tab_harmonica_custom" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p><div id="harmonica-custom-dialog"><p style="font-size:12pt;font-family:helvetica;"">Custom tuning name:<input class="harmonicacustomlabel" type="text" id="r0c1" onchange="customHarmonicaChangeHandler()"><p>\n<table style="margin-bottom:24px;text-align:center;">\n<tr>\n<td colspan="3" style="text-align: left; font-size:12pt;font-family:helvetica;">Octave 1:</td>\n</tr>\n<tr>\n<td style="text-align: center; font-size:2pt;font-family:helvetica;">&nbsp;</td>\n</tr>\n<tr>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">C</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">C#/Db</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">D</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">D#/Eb</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">E</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">F</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">F#/Gb</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">G</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">G#/Ab</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">A</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">A#/Bb</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">B</td>\n</tr>\n<tr>\n<td><input class="harmonicacustomnames" type="text" id="r1c1" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r1c2" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r1c3" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r1c4" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r1c5" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r1c6" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r1c7" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r1c8" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r1c9" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r1c10" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r1c11" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r1c12" onchange="customHarmonicaChangeHandler()"></td>\n</tr>\n<tr>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">&nbsp;</td>\n</tr>\n<tr>\n<td colspan="3" style="text-align: left; font-size:12pt;font-family:helvetica;">Octave 2:</td>\n</tr>\n<tr>\n<td style="text-align: center; font-size:2pt;font-family:helvetica;">&nbsp;</td>\n</tr>\n<tr>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">C</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">C#/Db</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">D</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">D#/Eb</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">E</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">F</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">F#/Gb</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">G</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">G#/Ab</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">A</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">A#/Bb</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">B</td>\n</tr>\n<tr>\n<td><input class="harmonicacustomnames" type="text" id="r2c1" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r2c2" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r2c3" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r2c4" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r2c5" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r2c6" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r2c7" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r2c8" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r2c9" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r2c10" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r2c11" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r2c12" onchange="customHarmonicaChangeHandler()"></td>\n</tr>\n<tr>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">&nbsp;</td>\n</tr>\n<td colspan="3" style="text-align: left; font-size:12pt;font-family:helvetica;">Octave 3:</td>\n</tr>\n<tr>\n<td style="text-align: center; font-size:2pt;font-family:helvetica;">&nbsp;</td>\n</tr>\n<tr>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">C</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">C#/Db</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">D</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">D#/Eb</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">E</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">F</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">F#/Gb</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">G</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">G#/Ab</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">A</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">A#/Bb</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">B</td>\n</tr>\n<tr>\n<td><input class="harmonicacustomnames" type="text" id="r3c1" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r3c2" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r3c3" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r3c4" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r3c5" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r3c6" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r3c7" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r3c8" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r3c9" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r3c10" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r3c11" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r3c12" onchange="customHarmonicaChangeHandler()"></td>\n</tr>\n<tr>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">&nbsp;</td>\n</tr>\n<tr>\n<td colspan="3" style="text-align: left; font-size:12pt;font-family:helvetica;">Octave 4:</td>\n</tr>\n<tr>\n<td style="text-align: center; font-size:2pt;font-family:helvetica;">&nbsp;</td>\n</tr>\n<tr>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">C</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">C#/Db</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">D</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">D#/Eb</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">E</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">F</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">F#/Gb</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">G</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">G#/Ab</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">A</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">A#/Bb</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">B</td>\n</tr>\n<tr>\n<td><input class="harmonicacustomnames" type="text" id="r4c1" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r4c2" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r4c3" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r4c4" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r4c5" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r4c6" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r4c7" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r4c8" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r4c9" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r4c10" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r4c11" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r4c12" onchange="customHarmonicaChangeHandler()"></td>\n</tr>\n<tr>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">&nbsp;</td>\n</tr>\n<tr>\n<td colspan="3" style="text-align: left; font-size:12pt;font-family:helvetica;">Octave 5:</td>\n</tr>\n<tr>\n<td style="text-align: center; font-size:2pt;font-family:helvetica;">&nbsp;</td>\n</tr>\n<tr>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">C</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">C#/Db</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">D</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">D#/Eb</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">E</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">F</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">F#/Gb</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">G</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">G#/Ab</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">A</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">A#/Bb</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">B</td>\n</tr>\n<tr>\n<td><input class="harmonicacustomnames" type="text" id="r5c1" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r5c2" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r5c3" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r5c4" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r5c5" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r5c6" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r5c7" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r5c8" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r5c9" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r5c10" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r5c11" onchange="customHarmonicaChangeHandler()"></td>\n<td><input class="harmonicacustomnames" type="text" id="r5c12" onchange="customHarmonicaChangeHandler()"></td>\n</tr>\n</table>\n</div>\n<p style="text-align:center;margin-top:22px;"><input type="file" id="load_custom_harmonica_tuning_fs" accept=".txt,.TXT" hidden/><input id="save_custom_harmonica_tuning" class="btn btn-subdialog save_custom_harmonica_tuning" onclick="saveCustomHarmonica()" type="button" value="Save Custom Harmonica Tuning" title="Save a custom harmonica tuning file"><input id="load_custom_harmonica_tuning" class="btn btn-subdialog load_custom_harmonica_tuning" onclick="loadCustomHarmonicaClickHandler()" type="button" value="Load Custom Harmonica Tuning" title="Load a custom harmonica tuning file"></p>\n<p style="text-align:center;margin-top:22px;"><input id="default_anglo_fingerings" class="btn btn-clearbutton default_anglo_fingerings" onclick="defaultCustomHarmonica()" type="button" value="Reset to Default (Standard Richter)" title="Resets the custom tuning to Standard Richter"></p>\n'}];setTimeout(function(){initCustomHarmonicaSettings(),idleOpenCustomHarmonica()},150);DayPilot.Modal.form(t,{},{theme:"modal_flat",top:50,width:800,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(t){if(t.canceled)gHarmonicaCustom=JSON.parse(JSON.stringify(e));else{""==gHarmonicaCustom.name&&(gHarmonicaCustom.name="Custom");for(var n=0;n<60;++n)""==gHarmonicaCustom.noteMap[n]&&(gHarmonicaCustom.noteMap[n]=" "),gHarmonicaCustom.noteMap[n]=gHarmonicaCustom.noteMap[n].replaceAll('"',"''"),""==gHarmonicaCustom.noteMap[n]&&(gHarmonicaCustom.noteMap[n]=" ");gLocalStorageAvailable&&(localStorage.HarmonicaCustom=JSON.stringify(gHarmonicaCustom));let e=document.getElementsByName("configure_harmonica_tuning");if(e){let t=e[0];if(t){const e=t.querySelector('option[value="6"]');e&&(e.text=gHarmonicaCustom.name)}}}})}function DoInjectHarmonicaTab(){sendGoogleAnalytics("tablature","Inject_Harmonica");const e=[{name:"  Standard Richter",id:"0"},{name:"  Paddy Richter",id:"1"},{name:"  Easy Thirds",id:"2"},{name:"  Melody Maker",id:"3"},{name:"  Country (Major 7th)",id:"4"},{name:"  Natural Minor",id:"5"},{name:"  Chromatic (12-Hole)",id:"6"},{name:"  Chromatic (16-Hole)",id:"7"},{name:gHarmonicaCustom.name,id:"8"}],t={configure_harmonica_tuning:gHarmonicaTuning,configure_harmonica_key:gHarmonicaKey,configure_harmonica_octave:gHarmonicaOctave,configure_harmonica_plussign:gHarmonicaPlusSign,configure_harmonica_stacking:gHarmonicaStacking,configure_harmonica_tab_colors:gHarmonicaTabColors},n=[{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Inject Diatonic Harmonica Tablature&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#tab_harmonica" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="margin-top:36px;margin-bottom:36px;font-size:12pt;line-height:18pt;font-family:helvetica">This will inject tablature for a 10-hole diatonic harmonica in the harmonica tuning and key selected below into all of the tunes in the ABC text area:</p>'},{name:"Harmonica tuning:",id:"configure_harmonica_tuning",type:"select",options:e,cssClass:"configure_harmonica_tuning_select"},{name:"Harmonica key:",id:"configure_harmonica_key",type:"select",options:[{name:"  G",id:"G"},{name:"  G#",id:"G#"},{name:"  A",id:"A"},{name:"  Bb",id:"Bb"},{name:"  B",id:"B"},{name:"  C",id:"C"},{name:"  C#",id:"C#"},{name:"  D",id:"D"},{name:"  Eb",id:"Eb"},{name:"  E",id:"E"},{name:"  F",id:"F"},{name:"  F#",id:"F#"}],cssClass:"configure_harmonica_select"},{name:"Octave shift:",id:"configure_harmonica_octave",type:"select",options:[{name:"  -3",id:"-3"},{name:"  -2",id:"-2"},{name:"  -1",id:"-1"},{name:"  0",id:"0"},{name:"  1",id:"1"},{name:"  2",id:"2"},{name:"  3",id:"3"}],cssClass:"configure_harmonica_select"},{name:"    Include + for blow notes in the tablature",id:"configure_harmonica_plussign",type:"checkbox",cssClass:"configure_harmonica_settings_form_text"},{name:"    Blow/Draw indications under the hole number (unchecked is before hole number)",id:"configure_harmonica_stacking",type:"checkbox",cssClass:"configure_harmonica_settings_form_text2"},{name:"    Color-code Blow and Draw",id:"configure_harmonica_tab_colors",type:"checkbox",cssClass:"configure_harmonica_settings_form_text2"},{html:'<p style="text-align: center; font-size:4pt;font-family:helvetica;">&nbsp;</p>'},{html:'<p style="text-align:center;margin-top:18px;"><input id="configure_harmonica_custom" class="btn btn-subdialog configure_harmonica_custom" onclick="EditCustomHarmonica()" type="button" value="Edit Custom Harmonica Tuning Tab" title="Edit the custom harmonica tuning tab symbols for each scale note"></p>'},{html:'<p style="text-align:center;margin-top:18px;"><input id="configure_anglo_fonts" class="btn btn-subdialog configure_anglo_fonts" onclick="ConfigureTablatureSettings()" type="button" value="Tablature Injection Settings" title="Configure the tablature injection settings"></p>'}];DayPilot.Modal.form(n,t,{theme:"modal_flat",top:50,width:700,scrollWithPage:AllowDialogsToScroll(),okText:"Inject",autoFocus:!1}).then(function(e){if(!e.canceled){gHarmonicaTuning=e.result.configure_harmonica_tuning,gHarmonicaKey=e.result.configure_harmonica_key,gHarmonicaOctave=e.result.configure_harmonica_octave,gHarmonicaPlusSign=e.result.configure_harmonica_plussign,gHarmonicaStacking=e.result.configure_harmonica_stacking,gHarmonicaTabColors=e.result.configure_harmonica_tab_colors,SaveConfigurationSettings(),SetRadioValue("notenodertab","noten"),gCurrentTab="noten";var t=getABCEditorText();setABCEditorText(t=(t=(t=t.replace(/^% Begin tab color CSS[\s\S]*?^% End tab color CSS.*(\r?\n)+/gm,"")).replaceAll("!push!","")).replaceAll("!draw!","")),t=HarmonicaTabGenerator(t),setABCEditorText(t=gHarmonicaTabColors?InjectHarmonicaTabColors(t):CleanHarmonicaTab(t)),gIsDirty=!0;var n="Diatonic Harmonica tablature injected!";n=makeCenteredPromptString(n),DayPilot.Modal.alert(n,{theme:"modal_flat",top:300,scrollWithPage:AllowDialogsToScroll()}).then(function(){RenderAsync(!0,null,function(){ensureMoreToolsVisible()}),IdleAdvancedControls(!0)})}})}function saveCustomTab(){sendGoogleAnalytics("action","saveCustomTab");var e=JSON.stringify(gCustomTab);saveTextFile("Please enter a filename for your custom tab:",gCustomTab.name+".txt",e)}function loadCustomTabClickHandler(){document.getElementById("load_custom_tab_fs").click()}function loadCustomTab(e){sendGoogleAnalytics("action","loadCustomTab");const t=new FileReader;t.addEventListener("load",e=>{var t=e.target.result;try{var n=JSON.parse(t);if(!n.type||"CustomTab"!=n.type)return a=makeCenteredPromptString(a="This is not a valid custom tab definition file."),void DayPilot.Modal.alert(a,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});if(1==(gCustomTab=n).version){gCustomTab.version=2;for(var o=0;o<12;++o)gCustomTab.noteMap.push("x")}initCustomTabSettings()}catch(e){var a;return a=makeCenteredPromptString(a="This is not a valid custom tab definition file."),void DayPilot.Modal.alert(a,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})}}),t.readAsText(e)}function resetCustomTab(){gCustomTab=JSON.parse(JSON.stringify(gCustomTabDefault))}function defaultCustomTab(){sendGoogleAnalytics("action","defaultCustomTab");var e="Are you sure you want to reset the custom tab settings?";e=makeCenteredPromptString(e),DayPilot.Modal.confirm(e,{top:180,theme:"modal_flat",scrollWithPage:AllowDialogsToScroll()}).then(function(e){if(!e.canceled){var t;resetCustomTab();var n="r0c1";for(document.getElementById(n).value=gCustomTab.name,t=0;t<12;++t){n="r1c"+(t+1);document.getElementById(n).value=gCustomTab.noteMap[t]}for(t=0;t<12;++t){n="r2c"+(t+1);document.getElementById(n).value=gCustomTab.noteMap[t+12]}for(t=0;t<12;++t){n="r3c"+(t+1);document.getElementById(n).value=gCustomTab.noteMap[t+24]}for(t=0;t<12;++t){n="r4c"+(t+1);document.getElementById(n).value=gCustomTab.noteMap[t+36]}for(t=0;t<12;++t){n="r5c"+(t+1);document.getElementById(n).value=gCustomTab.noteMap[t+48]}}})}function customTabChangeHandler(){var e,t="r0c1";for(gCustomTab.name=document.getElementById(t).value,e=0;e<12;++e){t="r1c"+(e+1);gCustomTab.noteMap[e]=document.getElementById(t).value}for(e=0;e<12;++e){t="r2c"+(e+1);gCustomTab.noteMap[e+12]=document.getElementById(t).value}for(e=0;e<12;++e){t="r3c"+(e+1);gCustomTab.noteMap[e+24]=document.getElementById(t).value}for(e=0;e<12;++e){t="r4c"+(e+1);gCustomTab.noteMap[e+36]=document.getElementById(t).value}for(e=0;e<12;++e){t="r5c"+(e+1);gCustomTab.noteMap[e+48]=document.getElementById(t).value}}function initCustomTabSettings(){var e,t="r0c1";for(document.getElementById(t).value=gCustomTab.name,e=0;e<12;++e){t="r1c"+(e+1);document.getElementById(t).value=gCustomTab.noteMap[e]}for(e=0;e<12;++e){t="r2c"+(e+1);document.getElementById(t).value=gCustomTab.noteMap[e+12]}for(e=0;e<12;++e){t="r3c"+(e+1);document.getElementById(t).value=gCustomTab.noteMap[e+24]}for(e=0;e<12;++e){t="r4c"+(e+1);document.getElementById(t).value=gCustomTab.noteMap[e+36]}for(e=0;e<12;++e){t="r5c"+(e+1);document.getElementById(t).value=gCustomTab.noteMap[e+48]}}function idleOpenCustomTab(){document.getElementById("load_custom_tab_fs").onchange=()=>{let e=document.getElementById("load_custom_tab_fs");if(0===e.files.length){var t="Please select a custom tab settings file";return t=makeCenteredPromptString(t),void DayPilot.Modal.alert(t,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})}loadCustomTab(e.files[0]),e.value=""}}function EditCustomTab(){sendGoogleAnalytics("dialog","EditCustomTab");var e=JSON.parse(JSON.stringify(gCustomTab));const t=[{html:'<p style="text-align:center;font-size:16pt;font-family:helvetica;margin-left:15px;margin-bottom:32px">Edit Custom Tablature Note Names&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#tab_custom_edit" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p><div id="tab-custom-dialog"><p style="font-size:12pt;font-family:helvetica;"">Custom tab name:<input class="customtablabel" type="text" id="r0c1" onchange="customTabChangeHandler()"><p>\n<table style="margin-bottom:24px;text-align:center;">\n<tr>\n<td colspan="3" style="text-align: left; font-size:12pt;font-family:helvetica;">Octave 1:</td>\n</tr>\n<tr>\n<td style="text-align: center; font-size:2pt;font-family:helvetica;">&nbsp;</td>\n</tr>\n<tr>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">C</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">C#/Db</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">D</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">D#/Eb</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">E</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">F</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">F#/Gb</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">G</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">G#/Ab</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">A</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">A#/Bb</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">B</td>\n</tr>\n<tr>\n<td><input class="customtabnames" type="text" id="r1c1" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r1c2" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r1c3" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r1c4" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r1c5" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r1c6" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r1c7" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r1c8" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r1c9" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r1c10" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r1c11" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r1c12" onchange="customTabChangeHandler()"></td>\n</tr>\n<tr>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">&nbsp;</td>\n</tr>\n<tr>\n<td colspan="3" style="text-align: left; font-size:12pt;font-family:helvetica;">Octave 2:</td>\n</tr>\n<tr>\n<td style="text-align: center; font-size:2pt;font-family:helvetica;">&nbsp;</td>\n</tr>\n<tr>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">C</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">C#/Db</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">D</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">D#/Eb</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">E</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">F</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">F#/Gb</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">G</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">G#/Ab</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">A</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">A#/Bb</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">B</td>\n</tr>\n<tr>\n<td><input class="customtabnames" type="text" id="r2c1" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r2c2" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r2c3" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r2c4" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r2c5" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r2c6" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r2c7" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r2c8" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r2c9" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r2c10" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r2c11" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r2c12" onchange="customTabChangeHandler()"></td>\n</tr>\n<tr>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">&nbsp;</td>\n</tr>\n<td colspan="3" style="text-align: left; font-size:12pt;font-family:helvetica;">Octave 3:</td>\n</tr>\n<tr>\n<td style="text-align: center; font-size:2pt;font-family:helvetica;">&nbsp;</td>\n</tr>\n<tr>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">C</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">C#/Db</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">D</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">D#/Eb</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">E</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">F</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">F#/Gb</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">G</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">G#/Ab</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">A</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">A#/Bb</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">B</td>\n</tr>\n<tr>\n<td><input class="customtabnames" type="text" id="r3c1" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r3c2" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r3c3" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r3c4" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r3c5" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r3c6" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r3c7" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r3c8" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r3c9" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r3c10" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r3c11" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r3c12" onchange="customTabChangeHandler()"></td>\n</tr>\n<tr>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">&nbsp;</td>\n</tr>\n<tr>\n<td colspan="3" style="text-align: left; font-size:12pt;font-family:helvetica;">Octave 4:</td>\n</tr>\n<tr>\n<td style="text-align: center; font-size:2pt;font-family:helvetica;">&nbsp;</td>\n</tr>\n<tr>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">C</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">C#/Db</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">D</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">D#/Eb</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">E</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">F</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">F#/Gb</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">G</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">G#/Ab</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">A</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">A#/Bb</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">B</td>\n</tr>\n<tr>\n<td><input class="customtabnames" type="text" id="r4c1" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r4c2" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r4c3" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r4c4" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r4c5" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r4c6" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r4c7" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r4c8" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r4c9" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r4c10" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r4c11" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r4c12" onchange="customTabChangeHandler()"></td>\n</tr>\n<tr>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">&nbsp;</td>\n</tr>\n<tr>\n<td colspan="3" style="text-align: left; font-size:12pt;font-family:helvetica;">Octave 5:</td>\n</tr>\n<tr>\n<td style="text-align: center; font-size:2pt;font-family:helvetica;">&nbsp;</td>\n</tr>\n<tr>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">C</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">C#/Db</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">D</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">D#/Eb</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">E</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">F</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">F#/Gb</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">G</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">G#/Ab</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">A</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">A#/Bb</td>\n<td style="text-align: center; font-size:11pt;font-family:helvetica;">B</td>\n</tr>\n<tr>\n<td><input class="customtabnames" type="text" id="r5c1" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r5c2" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r5c3" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r5c4" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r5c5" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r5c6" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r5c7" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r5c8" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r5c9" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r5c10" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r5c11" onchange="customTabChangeHandler()"></td>\n<td><input class="customtabnames" type="text" id="r5c12" onchange="customTabChangeHandler()"></td>\n</tr>\n</table>\n</div>\n<p style="text-align:center;margin-top:22px;"><input type="file" id="load_custom_tab_fs" accept=".txt,.TXT" hidden/><input id="save_custom_tab" class="btn btn-subdialog save_custom_tab" onclick="saveCustomTab()" type="button" value="Save Custom Tab Settings" title="Save a custom tab settings file"><input id="load_custom_tab" class="btn btn-subdialog load_custom_tab" onclick="loadCustomTabClickHandler()" type="button" value="Load Custom Tab Settings" title="Load a custom tab settings file"></p>\n<p style="text-align:center;margin-top:22px;"><input id="default_anglo_fingerings" class="btn btn-clearbutton default_anglo_fingerings" onclick="defaultCustomTab()" type="button" value="Reset to Default (Scale Semitone Numbers)" title="Resets the custom tab setting to scale semitone numbers"></p>\n'}];setTimeout(function(){initCustomTabSettings(),idleOpenCustomTab()},150);DayPilot.Modal.form(t,{},{theme:"modal_flat",top:50,width:800,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(t){if(t.canceled)gCustomTab=JSON.parse(JSON.stringify(e));else{""==gCustomTab.name&&(gCustomTab.name="Custom");for(var n=0;n<60;++n)""==gCustomTab.noteMap[n]&&(gCustomTab.noteMap[n]=" "),gCustomTab.noteMap[n]=gCustomTab.noteMap[n].replaceAll('"',"''"),""==gCustomTab.noteMap[n]&&(gCustomTab.noteMap[n]=" ");gLocalStorageAvailable&&(localStorage.CustomTab=JSON.stringify(gCustomTab));var o=document.getElementById("currentCustomTab");o&&(o.innerText=gCustomTab.name)}})}function DoInjectCustomTab(){sendGoogleAnalytics("tablature","Inject_Custom_Tab");const e={configure_custom_tab_key:gCustomTabKey,configure_custom_tab_octave:gCustomTabOctave},t=[{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Inject Custom Tablature&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#tab_custom" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="margin-top:36px;margin-bottom:36px;font-size:12pt;line-height:18pt;font-family:helvetica">This will inject custom tablature offset by the octave and semitone values selected below into all of the tunes in the ABC text area:</p>'},{html:'<p style="margin-top:24px;margin-bottom:42px;font-size:12pt;line-height:18pt;font-family:helvetica">Currently loaded custom tab:&nbsp;&nbsp;<span id="currentCustomTab">'+gCustomTab.name+"</span></p>"},{name:"Octave shift:",id:"configure_custom_tab_octave",type:"select",options:[{name:"  -3",id:"-3"},{name:"  -2",id:"-2"},{name:"  -1",id:"-1"},{name:"  0",id:"0"},{name:"  1",id:"1"},{name:"  2",id:"2"},{name:"  3",id:"3"}],cssClass:"configure_custom_tab_select"},{name:"Semitone offset:",id:"configure_custom_tab_key",type:"select",options:[{name:"  -11",id:"-11"},{name:"  -10",id:"-10"},{name:"  -9",id:"-9"},{name:"  -8",id:"-8"},{name:"  -7",id:"-7"},{name:"  -6",id:"-6"},{name:"  -5",id:"-5"},{name:"  -4",id:"-4"},{name:"  -3",id:"-3"},{name:"  -2",id:"-2"},{name:"  -1",id:"-1"},{name:"  0",id:"0"},{name:"  1",id:"1"},{name:"  2",id:"2"},{name:"  3",id:"3"},{name:"  4",id:"4"},{name:"  5",id:"5"},{name:"  6",id:"6"},{name:"  7",id:"7"},{name:"  8",id:"8"},{name:"  9",id:"9"},{name:"  10",id:"10"},{name:"  11",id:"11"}],cssClass:"configure_custom_tab_select"},{html:'<p style="text-align: center; font-size:4pt;font-family:helvetica;">&nbsp;</p>'},{html:'<p style="text-align:center;margin-top:18px;"><input id="configure_custom_tab" class="btn btn-subdialog configure_custom_tab" onclick="EditCustomTab()" type="button" value="Edit Custom Tablature Note Names" title="Edit the custom tab symbols for each scale note"></p>'},{html:'<p style="text-align:center;margin-top:18px;"><input id="configure_anglo_fonts" class="btn btn-subdialog configure_anglo_fonts" onclick="ConfigureTablatureSettings()" type="button" value="Tablature Injection Settings" title="Configure the tablature injection settings"></p>'}];DayPilot.Modal.form(t,e,{theme:"modal_flat",top:100,width:700,scrollWithPage:AllowDialogsToScroll(),okText:"Inject",autoFocus:!1}).then(function(e){if(!e.canceled){gCustomTabKey=e.result.configure_custom_tab_key,gCustomTabOctave=e.result.configure_custom_tab_octave,SaveConfigurationSettings(),SetRadioValue("notenodertab","noten"),gCurrentTab="noten",setABCEditorText(CustomTabGenerator(getABCEditorText())),gIsDirty=!0;var t="Custom tablature injected!";t=makeCenteredPromptString(t),DayPilot.Modal.alert(t,{theme:"modal_flat",top:300,scrollWithPage:AllowDialogsToScroll()}).then(function(){RenderAsync(!0,null,function(){ensureMoreToolsVisible()}),IdleAdvancedControls(!0)})}})}function DoInjectBoxTablature(){DayPilot.Modal.alert('<div id="boxtabanchor"><p style="text-align:center;margin-bottom:36px;font-size:16pt;font-family:helvetica;margin-left:15px;">Inject Irish Button Box Tablature&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#tab_irish_box" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p><p style="text-align:center;"><input id="injectbcbox" class="advancedcontrols btn btn-injectcontrols" onclick="DoInjectTablature_BC()" type="button" value="Inject B/C Box Tab" title="Injects B/C box tablature into the ABC"><input id="injectcsdbox" class="advancedcontrols btn btn-injectcontrols" onclick="DoInjectTablature_CsD()" type="button" value="Inject C#/D Box Tab" title="Injects C#/D box tablature into the ABC"></p><p style="text-align:center;margin-top:18px;"><input id="configure_anglo_fonts" class="btn btn-subdialog configure_anglo_fonts" onclick="ConfigureTablatureSettings()" type="button" value="Tablature Injection Settings" title="Configure the tablature injection settings"></p></div>',{theme:"modal_flat",top:150,width:650,scrollWithPage:AllowDialogsToScroll()}).then(function(){ensureMoreToolsVisible()})}function DoInjectTablature_BC(){sendGoogleAnalytics("tablature","Inject_BC"),SetRadioValue("notenodertab","noten"),gCurrentTab="noten",gInjectTab_BoxStyle="0";var e=getABCEditorText();setABCEditorText(e=(e=(e=e.replace(/^% Begin tab color CSS[\s\S]*?^% End tab color CSS.*(\r?\n)+/gm,"")).replaceAll("!push!","")).replaceAll("!draw!","")),e=boxTabGenerator(e),gInjectTab_Colors&&(e=InjectTabColors(e,1)),setABCEditorText(e),gIsDirty=!0,gStripTab=!1;var t="B/C Box tablature injected!";t=makeCenteredPromptString(t),DayPilot.Modal.alert(t,{theme:"modal_flat",top:300,scrollWithPage:AllowDialogsToScroll()}).then(function(){RenderAsync(!0,null,function(){ensureDialogVisible("#boxtabanchor")}),IdleAdvancedControls(!0),IdleAllowShowTabNames()})}function DoInjectTablature_CsD(){sendGoogleAnalytics("tablature","Inject_CsD"),SetRadioValue("notenodertab","noten"),gCurrentTab="noten",gInjectTab_BoxStyle="1";var e=getABCEditorText();setABCEditorText(e=(e=(e=e.replace(/^% Begin tab color CSS[\s\S]*?^% End tab color CSS.*(\r?\n)+/gm,"")).replaceAll("!push!","")).replaceAll("!draw!","")),e=boxTabGenerator(e),gInjectTab_Colors&&(e=InjectTabColors(e,1)),setABCEditorText(e),gIsDirty=!0,gStripTab=!1;var t="C#/D Box tablature injected!";t=makeCenteredPromptString(t),DayPilot.Modal.alert(t,{theme:"modal_flat",top:300,scrollWithPage:AllowDialogsToScroll()}).then(function(){RenderAsync(!0,null,function(){ensureDialogVisible("#boxtabanchor")}),IdleAdvancedControls(!0),IdleAllowShowTabNames()})}function DoInjectTablature_Anglo(){sendGoogleAnalytics("tablature","Inject_Anglo");const e={configure_concertina_style:parseInt(gInjectTab_ConcertinaStyle),configure_concertina_tuning:parseInt(gInjectTab_ConcertinaTuning),configure_concertina_fingering:parseInt(gInjectTab_ConcertinaFingering),configure_gary_coover:gInjectTab_GaryCoover},t=[{html:'<p style="text-align:center;margin-bottom:36px;font-size:16pt;font-family:helvetica;margin-left:15px;">Inject Anglo Concertina Tablature&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#tab_concertina" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{name:"Concertina tuning:",id:"configure_concertina_tuning",type:"select",options:[{name:"  C/G",id:"0"},{name:"  Bb/F",id:"1"},{name:"  A/E",id:"2"},{name:"  G/D",id:"3"}],cssClass:"configure_concertina_tunings_select"},{name:"Concertina style:",id:"configure_concertina_style",type:"select",options:[{name:"  Jeffries",id:"0"},{name:"  Wheatstone",id:"1"}],cssClass:"configure_tab_settings_select"},{name:"Preferred fingering solution:",id:"configure_concertina_fingering",type:"select",options:[{name:"  On-Row",id:"0"},{name:"  Cross-Row",id:"1"}],cssClass:"configure_tab_settings_select"},{html:'<p style="margin-top:24px;font-size:12pt;line-height:12pt;font-family:helvetica">Fingering solutions referenced to C/G tuning:</p>'},{html:'<p style="margin-top:12px;font-size:12pt;line-height:12pt;font-family:helvetica">On-Row: Favors D5 and E5 on right-side C-row.</p>'},{html:'<p style="margin-top:12px;font-size:12pt;line-height:12pt;font-family:helvetica">Cross-Row: Favors D5 and E5 on the left-side G-row.</p>'},{html:'<p style="margin-top:12px;margin-bottom:24px;font-size:12pt;line-height:12pt;font-family:helvetica">Favors C5 on the left-side G-row draw, B4 on the right-side C-row draw.</p>'},{name:"    Gary Coover style tab (single notes only, overrides button name and direction settings)",id:"configure_gary_coover",type:"checkbox",cssClass:"configure_tab_settings_form_text"},{html:'<p style="text-align:center;margin-top:18px;"><input id="configure_anglo_fingerings" class="btn btn-subdialog configure_anglo_fingerings" onclick="ConfigureAngloFingerings()" type="button" value="Configure Anglo Concertina Tablature Button Names" title="Configure the Anglo Concertina tablature button names"></p>'},{html:'<p style="text-align:center;margin-top:18px;"><input id="configure_anglo_fonts" class="btn btn-subdialog configure_anglo_fonts" onclick="ConfigureTablatureSettings()" type="button" value="Tablature Injection Settings" title="Configure the tablature injection settings"></p>'}];DayPilot.Modal.form(t,e,{theme:"modal_flat",top:100,width:720,scrollWithPage:AllowDialogsToScroll(),okText:"Inject",autoFocus:!1}).then(function(e){if(!e.canceled){gInjectTab_ConcertinaStyle=e.result.configure_concertina_style,gInjectTab_ConcertinaTuning=e.result.configure_concertina_tuning,gInjectTab_ConcertinaFingering=e.result.configure_concertina_fingering,gInjectTab_GaryCoover=e.result.configure_gary_coover,SaveConfigurationSettings();var t=0,n=0,o="C/G";switch(gInjectTab_ConcertinaTuning){case"0":o="C/G";break;case"1":t=2,n=-2,o="Bb/F";break;case"2":t=3,n=-3,o="A/E";break;case"3":t=5,n=-5,o="G/D"}SetRadioValue("notenodertab","noten"),gCurrentTab="noten";var a=CountTunes();setTimeout(function(){if(0!=t){for(var e=getABCEditorText(),l=GetABCJSParams(),r=e.split(/^X:/gm),i=FindPreTuneHeader(e),s=1;s<=a;++s){var c="X:"+r[s],g=getTuneTitle(r[s]);try{i+=c=InjectStringBelowTuneHeader(c=transposeSingleTune(c,t,l),"%\n% "+o+' Anglo Concertina transpose\n%\n%abcjs_render_params {"visualTranspose":'+n+"}\n%%MIDI transpose 0\n%")}catch(e){gShowABCJSRenderProgress&&console.log("Transpose failed: "+g),i+=c}}setABCEditorText(i),gIsDirty=!0}var d=getABCEditorText();setABCEditorText(d=(d=(d=d.replace(/^% Begin tab color CSS[\s\S]*?^% End tab color CSS.*(\r?\n)+/gm,"")).replaceAll("!push!","")).replaceAll("!draw!","")),angloFingeringsGenerator(d,function(e,t,n){if(t)DayPilot.Modal.alert(n,{theme:"modal_flat",top:100,scrollWithPage:!0}).then(function(){gInjectTab_Colors&&(e=InjectTabColors(e,0)),setABCEditorText(e),gIsDirty=!0,gStripTab=!1;var t="Anglo Concertina tablature injected!";t=makeCenteredPromptString(t),DayPilot.Modal.alert(t,{theme:"modal_flat",top:300,scrollWithPage:AllowDialogsToScroll()}).then(function(){RenderAsync(!0,null,function(){hideTheSpinner(),ensureMoreToolsVisible()}),IdleAdvancedControls(!0),IdleAllowShowTabNames()})});else{gInjectTab_Colors&&(e=InjectTabColors(e,0)),setABCEditorText(e),gIsDirty=!0,gStripTab=!1;var o="Anglo Concertina tablature injected!";o=makeCenteredPromptString(o),DayPilot.Modal.alert(o,{theme:"modal_flat",top:300,scrollWithPage:AllowDialogsToScroll()}).then(function(){RenderAsync(!0,null,function(){hideTheSpinner(),ensureMoreToolsVisible()}),IdleAdvancedControls(!0),IdleAllowShowTabNames()})}})},gSpinnerDelay)}})}function DoInjectTablature_Bamboo_Flute(){sendGoogleAnalytics("tablature","Inject_Bamboo_Flute");const e={configure_bamboo_flute_key:gBambooFluteKey},t=[{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Inject Bamboo Flute Tablature&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://en.m.wikipedia.org/wiki/Numbered_musical_notation" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="margin-top:36px;margin-bottom:36px;font-size:12pt;line-height:18pt;font-family:helvetica">This will inject numeric notation tablature for a bamboo flute in the key selected below into all of the tunes in the ABC text area:</p>'},{name:"Bamboo flute key:",id:"configure_bamboo_flute_key",type:"select",options:[{name:"  C",id:"0"},{name:"  D",id:"1"},{name:"  G",id:"2"},{name:"  A",id:"3"}],cssClass:"configure_box_settings_select"},{html:'<p style="text-align:center;margin-top:18px;"><input id="configure_anglo_fonts" class="btn btn-subdialog configure_anglo_fonts" onclick="ConfigureTablatureSettings()" type="button" value="Tablature Injection Settings" title="Configure the tablature injection settings"></p>'}];DayPilot.Modal.form(t,e,{theme:"modal_flat",top:150,width:500,scrollWithPage:AllowDialogsToScroll(),okText:"Inject",autoFocus:!1}).then(function(e){if(!e.canceled){gBambooFluteKey=e.result.configure_bamboo_flute_key,SaveConfigurationSettings(),SetRadioValue("notenodertab","noten"),gCurrentTab="noten",setABCEditorText(bambooFluteTabGenerator(getABCEditorText())),gIsDirty=!0,gStripTab=!1;var t="Bamboo flute tablature injected!";t=makeCenteredPromptString(t),DayPilot.Modal.alert(t,{theme:"modal_flat",top:300,scrollWithPage:AllowDialogsToScroll()}).then(function(){RenderAsync(!0,null,function(){ensureMoreToolsVisible()}),IdleAdvancedControls(!0),IdleAllowShowTabNames()})}})}function DoInjectTablature_Fiddle_Fingerings_Dialog(){DayPilot.Modal.alert('<div id="fiddlefingeringsanchor"><p style="text-align:center;margin-bottom:36px;font-size:16pt;font-family:helvetica;margin-left:15px;">Inject Fiddle Fingerings&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#tab_fiddle" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p><p style="text-align:center;"><input id="fiddlefingeringsdialog0" class="advancedcontrols btn btn-injectcontrols" onclick="DoInjectTablature_Fiddle_Fingerings(0)" type="button" value="Finger Number Only (Using !0!, !1!, !2!, !3!, !4! Annotations)" title="Injects finger number (!0!, !1!, !2!, !3!, !4!) only.&nbsp;&nbsp;!0! is an open string."></p><p style="text-align:center;"><input id="fiddlefingeringsdialog1" class="advancedcontrols btn btn-injectcontrols" onclick="DoInjectTablature_Fiddle_Fingerings(1)" type="button" value="Finger Number Only (Using Text Annotations)" title="Injects finger number (0, 1, 2, 3, 4) only.&nbsp;&nbsp;0 is an open string."></p><p style="text-align:center;"><input id="fiddlefingeringsdialog2" class="advancedcontrols btn btn-injectcontrols" onclick="DoInjectTablature_Fiddle_Fingerings(2)" type="button" value="String Name + Finger Number (Inline)" title="Injects string name (G, D, A, E) + finger number (0, 1, 2, 3, 4) together on one line.&nbsp;&nbsp;0 is an open string."></p><p style="text-align:center;"><input id="fiddlefingeringsdialog3" class="advancedcontrols btn btn-injectcontrols" onclick="DoInjectTablature_Fiddle_Fingerings(3)" type="button" value="String Name + Finger Number (Name over Number)" title="Injects string name (G, D, A, E) + finger number (0, 1, 2, 3, 4) stacked vertically Name over Number.&nbsp;&nbsp;0 is an open string."></p><p style="text-align:center;"><input id="fiddlefingeringsdialog4" class="advancedcontrols btn btn-injectcontrols" onclick="DoInjectTablature_Fiddle_Fingerings(4)" type="button" value="String Name + Finger Number (Number over Name)" title="Injects string name (G, D, A, E) + finger number (0, 1, 2, 3, 4) stacked vertically Number over Name.&nbsp;&nbsp;0 is an open string."></p><p style="text-align:center;margin-top:24px;"><input id="configure_anglo_fonts" class="btn btn-subdialog configure_anglo_fonts" onclick="ConfigureTablatureSettings()" type="button" value="Tablature Injection Settings" title="Configure the tablature injection settings"></p></div>',{theme:"modal_flat",top:100,width:650,scrollWithPage:AllowDialogsToScroll()}).then(function(){ensureMoreToolsVisible()})}function DoInjectTablature_Fiddle_Fingerings(e){sendGoogleAnalytics("tablature","Inject_Fiddle_Fingerings"),SetRadioValue("notenodertab","noten"),gCurrentTab="noten",setABCEditorText(fiddleFingeringsGenerator(getABCEditorText(),e)),gIsDirty=!0,gStripTab=!1;var t="Fiddle fingerings injected!";t=makeCenteredPromptString(t),DayPilot.Modal.alert(t,{theme:"modal_flat",top:300,scrollWithPage:AllowDialogsToScroll()}).then(function(){RenderAsync(!0,null,function(){ensureDialogVisible("#fiddlefingeringsanchor")}),IdleAdvancedControls(!0),IdleAllowShowTabNames()})}function ShowMDTabWarningDialog(){sendGoogleAnalytics("dialog","ShowMDTabWarningDialog");var e='<div id="mdsomebadtunes"><p style="text-align:center;font-size:18pt;font-family:helvetica;">Some Tunes Did Not Have Complete Tab Solutions</p>';e+='<p style="font-size:12pt;line-height:18pt;margin-top:36px;">During the tablature generation the following tunes did not have complete tablature solutions and as requested were excluded from the result:</p>';var t=gExcludedFromMDSolution.length;e+='<p style="font-size:12pt;line-height:18pt;">';for(var n=0;n<t-1;++n)e+=gExcludedFromMDSolution[n]+", ";e+=gExcludedFromMDSolution[t-1],e+="</p></div>",ensureDialogVisible("#mdsomebadtunes"),DayPilot.Modal.alert(e,{theme:"modal_flat",top:100,width:630,scrollWithPage:AllowDialogsToScroll()}).then(function(){gExcludedFromMDSolution=[],ensureMoreToolsVisible()})}var gExcludedFromMDSolution=[];function DoInjectTablature_MD(){sendGoogleAnalytics("tablature","Inject_MD");const e={configure_dulcimer_style:gMDulcimerStyle,open_string_symbol:gMDulcimerUseDashForOpenString,strip_bad_tunes:gMDulcimerStripBadTunes},t=[{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Inject Mountain Dulcimer Tablature&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#tab_dulcimer" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="margin-top:36px;margin-bottom:36px;font-size:12pt;line-height:18pt;font-family:helvetica">This will inject tablature for a DAD, DGD, or DAA-tuned Mountain Dulcimer in the style selected below into all of the tunes in the ABC text area:</p>'},{name:"Style:",id:"configure_dulcimer_style",type:"select",options:[{name:"  DAD - Along High-D String",id:"0"},{name:"  DAD - Cross-String",id:"1"},{name:"  DGD - Along High-D String",id:"2"},{name:"  DGD - Cross-String",id:"3"},{name:"  DAA - Along A String",id:"4"},{name:"  Blank Tablature",id:"5"}],cssClass:"configure_md_settings_select"},{name:"          Use - for open strings (default is leave blank using a space)",id:"open_string_symbol",type:"checkbox",cssClass:"configure_md_settings_form_text"},{name:"          Strip tunes from the result that have no complete tablature solution",id:"strip_bad_tunes",type:"checkbox",cssClass:"configure_md_settings_form_text"},{html:'<p style="text-align:center;margin-top:36px;"><input id="configure_anglo_fonts" class="btn btn-subdialog configure_anglo_fonts" onclick="ConfigureTablatureSettings()" type="button" value="Tablature Injection Settings" title="Configure the tablature injection settings"></p>'}];DayPilot.Modal.form(t,e,{theme:"modal_flat",top:100,width:600,scrollWithPage:AllowDialogsToScroll(),okText:"Inject",autoFocus:!1}).then(function(e){if(!e.canceled){gMDulcimerStyle=e.result.configure_dulcimer_style,gMDulcimerUseDashForOpenString=e.result.open_string_symbol,gMDulcimerStripBadTunes=e.result.strip_bad_tunes,SaveConfigurationSettings(),SetRadioValue("notenodertab","noten"),gCurrentTab="noten",gExcludedFromMDSolution=[],setABCEditorText(MDTablatureGenerator(getABCEditorText())),gIsDirty=!0,gStripTab=!1;var t="Mountain Dulcimer tablature injected!";t=makeCenteredPromptString(t),DayPilot.Modal.alert(t,{theme:"modal_flat",top:300,scrollWithPage:AllowDialogsToScroll()}).then(function(){RenderAsync(!0,null,function(){gExcludedFromMDSolution.length>0&&ShowMDTabWarningDialog(),IdleAdvancedControls(!0),IdleAllowShowTabNames(),ensureMoreToolsVisible()})})}})}var gShapeNoteStyle=0;function DoInjectTablature_ShapeNotes(){const e={shape_note_style:gShapeNoteStyle},t=[{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Inject Note Names&nbsp;/&nbsp;Shape Note&nbsp;/&nbsp;Solfège<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#advanced_shapenoteshapes" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="margin-top:36px;margin-bottom:24px;font-size:12pt;line-height:18pt;font-family:helvetica">This will inject Pitch Names, ABC Note Names (Standard ABC or Comhaltas ABC), Shape Note shapes, or Solfège note names into all the tunes in the ABC text area.</p>'},{name:"Style to inject:",id:"shape_note_style",type:"select",options:[{name:"  Pitch Names (No octave indication)",id:"6"},{name:"  ABC Note Names",id:"11"},{name:"  ABC Note Names (Comhaltas ABC)",id:"12"},{name:"  4-Shape",id:"0"},{name:"  4-Shape - Include fa/sol/la note names below",id:"1"},{name:"  4-Shape - No shapes, only fa/sol/la note names below",id:"2"},{name:"  7-Shape",id:"3"},{name:"  7-Shape - Include do/re/mi note names below",id:"4"},{name:"  7-Shape - No shapes, only do/re/mi note names below",id:"5"},{name:"  Fixed (Do=C) Solfège - No chromatics",id:"7"},{name:"  Fixed (Do=C) Solfège - Include chromatics",id:"8"},{name:"  Movable Solfège Do-based Minor",id:"9"},{name:"  Movable Solfège La-based Minor",id:"10"}],cssClass:"configure_sn_settings_select"},{html:'<p style="text-align:center;margin-top:36px;"><input id="configure_anglo_fonts" class="btn btn-subdialog configure_anglo_fonts" onclick="ConfigureTablatureSettings()" type="button" value="Tablature Injection Settings" title="Configure the tablature injection settings"></p>'}];DayPilot.Modal.form(t,e,{theme:"modal_flat",top:150,width:680,scrollWithPage:AllowDialogsToScroll(),okText:"Inject",autoFocus:!1}).then(function(e){if(!e.canceled){sendGoogleAnalytics("tablature","Inject_ShapeNotes_"+(gShapeNoteStyle=parseInt(e.result.shape_note_style))),SaveConfigurationSettings(),SetRadioValue("notenodertab","noten"),gCurrentTab="noten",setABCEditorText(gShapeNoteStyle<=10?shapeNoteGenerator(getABCEditorText()):injectABCNoteNames(getABCEditorText())),gIsDirty=!0,gStripTab=!1;var t="Note names/Solfège injected!";t=makeCenteredPromptString(t),DayPilot.Modal.alert(t,{theme:"modal_flat",top:300,scrollWithPage:AllowDialogsToScroll()}).then(function(){RenderAsync(!0,null,function(){IdleAdvancedControls(!0),IdleAllowShowTabNames(),ensureMoreToolsVisible()})})}})}function ChangeTab(){var e=GetRadioValue("notenodertab");"whistle"==e&&PrepareWhistleFont(),"recorder"==e&&PrepareRecorderFont(),gIsQuickEditor&&-1==gCurrentTune||(e!=gCurrentTab?(gForceTabSave=!0,sendGoogleAnalytics("ChangeTab",e),RenderAsync(!0,null)):RenderAsync(!0,null),gCurrentTab=e)}function FocusAfterOperation(){ensureMoreToolsVisible(),isPureDesktopBrowser()?gEnableSyntax?gTheCM.focus():gTheABC.focus():gEnableSyntax?gTheCM.getInputField().blur():gTheABC.blur()}function FocusABC(){gEnableSyntax?(gTheCM.focus(),gTheCM.selectionStart=0,gTheCM.selectionEnd=0,gTheCM.getScrollerElement().scrollTo(0,0)):(gTheABC.focus(),gTheABC.selectionStart=0,gTheABC.selectionEnd=0,gTheABC.scrollTo(0,0))}function fadeOutAndHide(e,t){var n=setInterval(function(){e.style.opacity||(e.style.opacity=1),e.style.opacity>0?e.style.opacity-=.1:(clearInterval(n),e.style.display="none",t())},100)}function PreProcessSVGImageForDownload(){for(var e=document.querySelectorAll("#playback-paper svg .highlight"),t=0;t<e.length;t++)e[t].classList.remove("highlight");var n=document.querySelector("#playback-paper svg .abcjs-cursor");n&&(n.style.display="none")}function PostProcessSVGImageAfterDownload(){var e=document.querySelector("#playback-paper svg .abcjs-cursor");e&&(e.style.display="inline")}function dataURLtoBlob(e){for(var t=e.split(","),n=t[0].match(/:(.*?);/)[1],o=atob(t[1]),a=o.length,l=new Uint8Array(a);a--;)l[a]=o.charCodeAt(a);return new Blob([l],{type:n})}var gInDownloadSVG=!1;function DownloadSVG(e,t){if(gInDownloadSVG)return!1;e||sendGoogleAnalytics("export","DownloadSVG");var n=!1;document.getElementById("export_width")||(n=!0),n?gWebsiteImageWidthIsPercentage?theWidth=2400:(theWidth=parseInt(gWebsiteImageWidth),isNaN(theWidth)?theWidth=2400:theWidth*=2):(theWidth=document.getElementById("export_width").value,theWidth=parseInt(theWidth),isNaN(theWidth)&&(theWidth=2400)),e||(gExportWidth=theWidth,gLocalStorageAvailable&&(localStorage.ExportWidth=theWidth)),gInDownloadSVG=!0,PreProcessSVGImageForDownload();var o=document.querySelector("#playback-paper svg");if(!o){if(gInDownloadSVG=!1,!e)return;e(t)}var a=o.getBoundingClientRect();o=o.cloneNode(!0);var l=a.width,r=a.height,i=theWidth,s=theWidth*r/l;o.setAttribute("width",i+"px"),o.setAttribute("height",s+"px"),o.setAttribute("xmlns","http://www.w3.org/2000/svg");var c=o.outerHTML;c="whistle"==gCurrentTab?injectWhistleSVGCSS(c,!1):"recorder"==gCurrentTab?injectRecorderSVGCSS(c,!1):"notenames"==gCurrentTab?injectNoteNamesSVGCSS(c,!1):injectSVGCSS(c,!1);var g=new Blob(['<?xml version="1.0" standalone="no"?>\r\n',c],{type:"image/svg+xml;charset=utf-8"}),d=URL.createObjectURL(g),u=document.createElement("a");u.href=d,u.download=GetTuneAudioDownloadName(gPlayerABC,".svg"),document.body.appendChild(u),u.click(),window.URL.revokeObjectURL(d),document.body.removeChild(u),PostProcessSVGImageAfterDownload(),gInDownloadSVG=!1,o=null,e?e(t):(document.getElementById("abcplayer_svgbutton").value="SVG File Saved!",setTimeout(function(){document.getElementById("abcplayer_svgbutton").value="Save as SVG File"},500))}var gInDownloadJPEG=!1;function DownloadJPEG(e,t){if(gInDownloadJPEG)return!1;e||sendGoogleAnalytics("export","DownloadJPEG");var n,o=!1;document.getElementById("export_width")||(o=!0),o?gWebsiteImageWidthIsPercentage?n=2400:(n=parseInt(gWebsiteImageWidth),isNaN(n)?n=2400:n*=2):(n=document.getElementById("export_width").value,n=parseInt(n),isNaN(n)&&(n=2400)),e||o||(gExportWidth=n,gLocalStorageAvailable&&(localStorage.ExportWidth=n)),gInDownloadJPEG=!0,PreProcessSVGImageForDownload();var a=document.querySelector("#playback-paper svg");if(!a){if(gInDownloadJPEG=!1,!e)return;e(t)}var l=document.createElement("canvas"),r=a.getBoundingClientRect();a=a.cloneNode(!0);var i=r.width,s=n,c=n*r.height/i;l.width=s,l.height=c,l.style.width=s,l.style.height=c,a.setAttribute("width",s+"px"),a.setAttribute("height",c+"px");var g=l.getContext("2d");g.fillStyle="#ffffff",g.fillRect(0,0,l.width,l.height);var d=document.createElement("img"),u=(new XMLSerializer).serializeToString(a);u="whistle"==gCurrentTab?injectWhistleSVGCSS(u,!0):"recorder"==gCurrentTab?injectRecorderSVGCSS(u,!0):"notenames"==gCurrentTab?injectNoteNamesSVGCSS(u,!0):injectSVGCSS(u,!0),d.setAttribute("src","data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(u)))),d.onload=function(){g.drawImage(d,0,0);var n=l.toDataURL("image/jpeg",.75);if(isPureDesktopBrowser()){(o=document.createElement("a")).download=GetTuneAudioDownloadName(gPlayerABC,".jpg"),o.href=n,document.body.appendChild(o),o.click(),window.URL.revokeObjectURL(n),document.body.removeChild(o)}else{var o,r=dataURLtoBlob(n),i=URL.createObjectURL(r);(o=document.createElement("a")).href=i,o.download=GetTuneAudioDownloadName(gPlayerABC,".jpg"),document.body.appendChild(o),o.click(),window.URL.revokeObjectURL(i),document.body.removeChild(o)}PostProcessSVGImageAfterDownload(),gInDownloadJPEG=!1,a=null,e?e(t):(document.getElementById("abcplayer_jpgbutton").value="JPG File Saved!",setTimeout(function(){document.getElementById("abcplayer_jpgbutton").value="Save as JPG File"},500))}}var gInDownloadPNG=!1;function DownloadPNG(e,t){if(gInDownloadPNG)return!1;e||sendGoogleAnalytics("export","DownloadPNG");var n=document.getElementById("export_width").value;n=parseInt(n),isNaN(n)&&(n=2400),e||(gExportWidth=n,gLocalStorageAvailable&&(localStorage.ExportWidth=n)),gInDownloadPNG=!0,PreProcessSVGImageForDownload();var o=document.querySelector("#playback-paper svg");if(!o){if(gInDownloadPNG=!1,!e)return;e(t)}var a=document.createElement("canvas"),l=o.getBoundingClientRect();o=o.cloneNode(!0);var r=l.width,i=n,s=n*l.height/r;a.width=i,a.height=s,a.style.width=i,a.style.height=s,o.setAttribute("width",i+"px"),o.setAttribute("height",s+"px");var c=a.getContext("2d");c.fillStyle="#ffffff",c.fillRect(0,0,a.width,a.height);var g=document.createElement("img"),d=(new XMLSerializer).serializeToString(o);d="whistle"==gCurrentTab?injectWhistleSVGCSS(d,!0):"recorder"==gCurrentTab?injectRecorderSVGCSS(d,!0):"notenames"==gCurrentTab?injectNoteNamesSVGCSS(d,!0):injectSVGCSS(d,!0),g.setAttribute("src","data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(d)))),g.onload=function(){c.drawImage(g,0,0);var n=a.toDataURL("image/png",1);if(isPureDesktopBrowser()){(l=document.createElement("a")).download=GetTuneAudioDownloadName(gPlayerABC,".png"),l.href=n,document.body.appendChild(l),l.click(),window.URL.revokeObjectURL(n),document.body.removeChild(l)}else{var l,r=dataURLtoBlob(n),i=URL.createObjectURL(r);(l=document.createElement("a")).href=i,l.download=GetTuneAudioDownloadName(gPlayerABC,".png"),document.body.appendChild(l),l.click(),window.URL.revokeObjectURL(i),document.body.removeChild(l)}PostProcessSVGImageAfterDownload(),gInDownloadPNG=!1,o=null,e?e(t):(document.getElementById("abcplayer_pngbutton").value="PNG File Saved!",setTimeout(function(){document.getElementById("abcplayer_pngbutton").value="Save as PNG File"},500))}}function LaunchCSVTagExtractor(){sendGoogleAnalytics("dialog","LaunchCSVTagExtractor"),window.open("https://michaeleskin.com/tools/abc2csv.html")}function ExportAll(){if(isMobileBrowser()){var e="Batch export is not supported on iOS or Android at this time.";return e=makeCenteredPromptString(e),void DayPilot.Modal.alert(e,{theme:"modal_flat",top:400,scrollWithPage:AllowDialogsToScroll(),okText:"Ok"})}clearGetTuneByIndexCache();GetRadioValue("notenodertab");DayPilot.Modal.alert('<p style="text-align:center;font-size:20pt;font-family:helvetica">Export All Tunes</p><p style="text-align:center;font-size:14pt;font-family:helvetica;margin-top:28px;">Export All Tunes as Audio/MIDI</p><p style="text-align:center;font-size:18pt;font-family:helvetica;"><input id="exportall_mp3button" class="exportall_mp3button btn btn-allmp3download" onclick="BatchMP3Export();" type="button" value="Export all as MP3 Audio" title="Saves the audio for all the tunes as .MP3 files"><input id="exportall_midibutton" class="exportall_midibutton btn btn-allmididownload" onclick="BatchMIDIExport();" type="button" value="Export all as MIDI" title="Saves the MIDI file for all the tunes"></p><p style="text-align:center;font-size:14pt;font-family:helvetica;margin-top:28px;">Export All Tunes as Images</p><p style="text-align:center;font-size:14pt;font-family:helvetica;"><input id="exportall_jpegbutton" class="exportall_jpegbutton btn btn-alljpegdownload" onclick="BatchJPEGExport();" type="button" value="Export all as JPEG" title="Saves the images for all the tunes as bitmap JPEG files"><input id="exportall_pngbutton" class="exportall_pngbutton btn btn-allpngdownload" onclick="BatchPNGExport();" type="button" value="Export all as PNG" title="Saves the images for all the tunes as bitmap PNG files"><input id="exportall_svgbutton" class="exportall_svgbutton btn btn-allsvgdownload" onclick="BatchSVGExport();" type="button" value="Export all as SVG" title="Saves the images for all the tunes as vector format SVG files"></p><p class="export_all_text">Image width to export: <input id="export_width" type="number" min="0" step="1" max="4096" title="Image width to export" autocomplete="off"/></p><p style="text-align:center;font-size:14pt;font-family:helvetica;margin-top:28px;">Export All Tunes as ABC or MusicXML</p><p style="text-align:center;font-size:14pt;font-family:helvetica;"><input id="exportall_abcbutton" class="exportall_abcbutton btn btn-allabcdownload" onclick="BatchABCExport();" type="button" value="Export all Tunes as ABC" title="Saves each tune in its own ABC file"><input id="exportall_musicxmlbutton" class="exportall_musicxmlbutton btn btn-allmusicxmldownload" onclick="BatchMusicXMLExport();" type="button" value="Export all Tunes as MusicXML" title="Saves each tune in its own MusicXML file"></p><p style="text-align:center;font-size:14pt;font-family:helvetica;margin-top:28px;">Export All Tunes Titles</p><p style="text-align:center;font-size:14pt;font-family:helvetica;"><input id="export_tunetitlesbutton" class="export_tunetitlesbutton btn btn-exporttunetitles" onclick="ExportAllTuneTitles();" type="button" value="Export All Tune Titles" title="Saves a text file with all the tune titles"><p style="text-align:center;font-size:14pt;font-family:helvetica;margin-top:28px;">Developer Share URL Batch Export Tools</p><p style="text-align:center;font-size:14pt;font-family:helvetica;"><input id="exportall_jsonbutton" class="exportall_jsonbutton btn btn-alljsondownload" onclick="BatchJSONExport();" type="button" value="Export all Share URLs as JSON" title="Saves the Share URLs for all the tunes as a JSON file"><input id="exportall_csvbutton" class="exportall_csvbutton btn btn-allcsvdownload" onclick="BatchCSVExport();" type="button" value="Export all Share URLs as CSV" title="Saves the Share URLs for all the tunes as a CSV file"></p><p style="text-align:center;font-size:14pt;font-family:helvetica;"><input id="launchcsvextractor" class="launchcsvextractor btn btn-launchcsvextractor" onclick="LaunchCSVTagExtractor();");" type="button" value="Launch the ABC Tags to CSV Extractor Utility" title="Extract all ABC tags from one or more ABC files to a CSV file"></p><p style="text-align:center;font-size:14pt;font-family:helvetica;margin-top:28px;">SmartDraw Set List Builder</p><p style="text-align:center;font-size:14pt;font-family:helvetica;"><input id="export_smartdrawbutton" class="export_smartdrawbutton btn btn-smartdraw" onclick="SmartDrawExport();" type="button" value="SmartDraw Set List Builder" title="Build a SmartDraw set list using drag and drop"></p><a id="exportall_help" href="https://michaeleskin.com/abctools/userguide.html#export_all" target="_blank" style="text-decoration:none;" title="Learn more about the audio and image exporter" class="dialogcornerbutton">?</a>',{theme:"modal_flat",top:37,width:670,scrollWithPage:AllowDialogsToScroll()}),document.getElementById("export_width").value=gExportWidthAll}var gBatchImageExportCancelRequested=!1,gTheBatchImageExportOKButton=null,gTheBatchImageExportStatusText=null,gExportWidth=2400,gExportWidthAll=2400,gBatchExportDelayMS=200;function BatchJPEGExport(){sendGoogleAnalytics("dialog","BatchJPEGExport"),DoBatchImageExport("JPEG",null)}function BatchPNGExport(){sendGoogleAnalytics("dialog","BatchPNGExport"),DoBatchImageExport("PNG",null)}function BatchSVGExport(){sendGoogleAnalytics("dialog","BatchSVGExport"),DoBatchImageExport("SVG",null)}function BatchMIDIExport(){sendGoogleAnalytics("dialog","BatchMIDIExport"),DoBatchImageExport("MIDI",null)}function DoBatchImageExport(e,t){var n;function o(o){l--,o.click(),gBatchImageExportCancelRequested?(clearGetTuneByIndexCache(),t&&t(!0)):0!=l?setTimeout(function(){var t=getTuneByIndex(++r),o=getTuneTitle(t);gTheBatchImageExportStatusText.innerHTML="<p>Exporting "+e+" for tune "+(r+1)+" of "+n+"<br/><br/>"+o+"</p>",ExportImageDialog(t,a,r,!1)},gBatchExportDelayMS):(gTheBatchImageExportOKButton.click(),gBatchImageExportCancelRequested=!1,clearGetTuneByIndexCache(),t&&t(!1))}function a(t,n){switch(e){case"MIDI":DownloadMIDI(o,n);break;case"JPEG":DownloadJPEG(o,n);break;case"PNG":DownloadPNG(o,n);break;case"SVG":DownloadSVG(o,n)}}t||"MIDI"!=e&&(gExportWidthAll=document.getElementById("export_width").value,gExportWidthAll=parseInt(gExportWidthAll),isNaN(gExportWidthAll)&&(gExportWidthAll=2400),gLocalStorageAvailable&&(localStorage.ExportWidthAll=gExportWidthAll));var l=CountTunes();if(0!=l){var r=0;gBatchImageExportCancelRequested=!1,gTheBatchImageExportOKButton=null,gTheBatchImageExportStatusText=null;var i="Exporting "+e+" for tune "+(r+1)+" of "+(n=l);i=makeCenteredPromptString(i),DayPilot.Modal.alert(i,{theme:"modal_flat",top:290,scrollWithPage:AllowDialogsToScroll(),okText:"Cancel"}).then(function(e){gBatchImageExportCancelRequested=!0});var s=document.getElementsByClassName("modal_flat_main");s[s.length-1].style.zIndex=100001;for(var c=document.getElementsByClassName("modal_flat_ok"),g=null,d=0;d<c.length;++d)if("Cancel"==(g=c[d]).innerText){gTheBatchImageExportOKButton=g;break}var u=document.getElementsByClassName("modal_flat_content"),m=u.length;(gTheBatchImageExportStatusText=u[m-1]).style.textAlign="center";var p=getTuneByIndex(r),h=getTuneTitle(p);return gTheBatchImageExportStatusText.innerHTML="<p>Exporting "+e+" for tune "+(r+1)+" of "+n+"<br/><br/>"+h+"</p>",ExportImageDialog(p,a,r,!1),!0}}function ExportImageDialog(e,t,n,o){gTheOKButton=null,gPlayerABC=e;var a=GetABCJSParams(GetRadioValue("notenodertab"));a.oneSvgPerLine=!1,function(){var o=window.innerHeight-340;modal_msg='<div id="playerholder" style="height:'+o+'px;overflow-y:auto;margin-bottom:15px;">',modal_msg+='<div id="abcplayer">',modal_msg+='<div id="playback-paper"></div>',modal_msg+="</div>",modal_msg+="</div>",modal_msg+="</p>";var l,r=window.innerWidth,i=GetRadioValue("notenodertab");isDesktopBrowser()?(l=giPadTwoColumn?isLandscapeOrientation()?r*(gPlayerScaling/100):.9*r:r*(gPlayerScaling/100))<850&&(l=850):l=800,DayPilot.Modal.alert(modal_msg,{theme:"modal_flat",top:40,width:l,okText:"Close",scrollWithPage:isMobileBrowser()});for(var s=document.getElementsByClassName("modal_flat_ok"),c=null,g=0;g<s.length;++g)if("Close"==(c=s[g]).innerText){gTheOKButton=c;break}e=GetABCFileHeader()+e,postProcessTab([ABCJS.renderAbc("playback-paper",e,a)[0]],"playback-paper",i,!0),t&&setTimeout(function(){t(n,gTheOKButton)},10)}()}function BatchMusicXMLRoundTrip(){var e;if(!navigator.onLine)return e=makeCenteredPromptString(e="Reformat Using MusicXML not available while offline."),void DayPilot.Modal.alert(e,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});if(0==CountTunes())return e=makeCenteredPromptString(e="No ABC tunes to reformat."),void DayPilot.Modal.alert(e,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});DayPilot.Modal.form([{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Reformat Using MusicXML&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#reformatusingxml" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="margin-top:36px;margin-bottom:12px;font-size:12pt;line-height:18pt;font-family:helvetica">Click OK to reformat either the current tune or all the tunes in the ABC by exporting the tune(s) in MusicXML format and then re-import them using the current MusicXML import settings.</p>'},{html:'<p style="margin-top:24px;margin-bottom:12px;font-size:12pt;line-height:18pt;font-family:helvetica">This can be useful for cleaning up notation formatting issues or changing the number of measures per stave.</p>'},{html:'<p style="text-align:center;margin-top:32px;"><input style="margin-left:0px" id="configure_musicxml_import" class="btn btn-subdialog configure_musicxml_import" onclick="ConfigureMusicXMLImport()" type="button" value="MusicXML/MIDI Import Settings" title="Configure MusicXML/MIDI import settings"></p>'},{name:"          Reformat all tunes",id:"reformatall",type:"checkbox",cssClass:"configure_xmlroundtrip_text"}],{},{theme:"modal_flat_wide",top:100,width:600,scrollWithPage:AllowDialogsToScroll(),okText:"Reformat",autoFocus:!1}).then(function(e){e.canceled||(e.result.reformatall?BatchMusicXMLRoundTripWorker():BatchMusicXMLRoundTripCurrentTune())})}function BatchMusicXMLRoundTripCurrentTune(){sendGoogleAnalytics("dialog","BatchMusicXMLRoundTripOne");var e=findSelectedTuneIndex(),t=findSelectedTune();if(""!=t){var n=getTuneTitle(t);showTheSpinner();try{fetch("https://seisiuneer.pythonanywhere.com/abc2xml",{method:"POST",body:t}).then(e=>e.text()).then(o=>{o=importMusicXML(o,n);var a=getABCEditorText();setABCEditorText(a=a.replace(t,o)),RenderAsync(!0,gRawMode?null:e,function(){hideTheSpinner()}),gIsDirty=!0})}catch(e){hideTheSpinner()}}}var gBatchMusicXMLRoundTripAccum="";function BatchMusicXMLRoundTripWorker(){var e;sendGoogleAnalytics("dialog","BatchMusicXMLRoundTripAll");var t=CountTunes();gBatchMusicXMLRoundTripAccum=FindPreTuneHeader(getABCEditorText());var n=0;gBatchImageExportCancelRequested=!1,gTheBatchImageExportOKButton=null,gTheBatchImageExportStatusText=null;var o="Formatting tune "+(n+1)+" of "+(e=t);o=makeCenteredPromptString(o),DayPilot.Modal.alert(o,{theme:"modal_flat",top:290,scrollWithPage:AllowDialogsToScroll(),okText:"Cancel"}).then(function(e){gBatchImageExportCancelRequested=!0});var a=document.getElementsByClassName("modal_flat_main");a[a.length-1].style.zIndex=100001;for(var l=document.getElementsByClassName("modal_flat_ok"),r=null,i=0;i<l.length;++i)if("Cancel"==(r=l[i]).innerText){gTheBatchImageExportOKButton=r;break}var s=document.getElementsByClassName("modal_flat_content"),c=s.length;(gTheBatchImageExportStatusText=s[c-1]).style.textAlign="center";var g=getTuneByIndex(n),d=getTuneTitle(g);return gTheBatchImageExportStatusText.innerHTML="<p>Reformatting tune "+(n+1)+" of "+e+"<br/><br/>"+d+"</p>",showTheSpinner(),ExportMusicXMLForReformat(g,d,function o(a,l){gBatchMusicXMLRoundTripAccum+=importMusicXML(l,a),gBatchMusicXMLRoundTripAccum+="\n",t--,gBatchImageExportCancelRequested?(hideTheSpinner(),clearGetTuneByIndexCache()):0!=t?setTimeout(function(){var t=getTuneByIndex(++n),a=getTuneTitle(t);gTheBatchImageExportStatusText.innerHTML="<p>Reformatting tune "+(n+1)+" of "+e+"<br/><br/>"+a+"</p>",ExportMusicXMLForReformat(t,a,o)},250):(gTheBatchImageExportOKButton.click(),gBatchImageExportCancelRequested=!1,setABCEditorText(gBatchMusicXMLRoundTripAccum),RenderAsync(!0,null,function(){hideTheSpinner()}),gIsDirty=!0,clearGetTuneByIndexCache())}),!0}function ExportMusicXMLForReformat(e,t,n){fetch("https://seisiuneer.pythonanywhere.com/abc2xml",{method:"POST",body:e}).then(e=>e.text()).then(e=>{n(t,e)}).catch(e=>{console.log("ExportMusicXMLForReformat - MusicXML conversion failed on "+t),n(t,"")})}function BatchABCExport(){var e;sendGoogleAnalytics("dialog","BatchABCExport");var t=CountTunes();if(0!=t){var n=0;gBatchImageExportCancelRequested=!1,gTheBatchImageExportOKButton=null,gTheBatchImageExportStatusText=null;var o="Exporting ABC for tune "+(n+1)+" of "+(e=t);o=makeCenteredPromptString(o),DayPilot.Modal.alert(o,{theme:"modal_flat",top:290,scrollWithPage:AllowDialogsToScroll(),okText:"Cancel"}).then(function(e){gBatchImageExportCancelRequested=!0});var a=document.getElementsByClassName("modal_flat_main");a[a.length-1].style.zIndex=100001;for(var l=document.getElementsByClassName("modal_flat_ok"),r=null,i=0;i<l.length;++i)if("Cancel"==(r=l[i]).innerText){gTheBatchImageExportOKButton=r;break}var s=document.getElementsByClassName("modal_flat_content"),c=s.length;(gTheBatchImageExportStatusText=s[c-1]).style.textAlign="center";var g=getTuneByIndex(n),d=getTuneTitle(g);return gTheBatchImageExportStatusText.innerHTML="<p>Exporting ABC for tune "+(n+1)+" of "+e+"<br/><br/>"+d+"</p>",ExportOneABCTune(g,GetTuneAudioDownloadName(g,".abc"),function o(){t--,gBatchImageExportCancelRequested?clearGetTuneByIndexCache():0!=t?setTimeout(function(){var t=getTuneByIndex(++n),a=getTuneTitle(t);gTheBatchImageExportStatusText.innerHTML="<p>Exporting ABC for tune "+(n+1)+" of "+e+"<br/><br/>"+a+"</p>",ExportOneABCTune(t,GetTuneAudioDownloadName(t,".abc"),o,null)},gBatchExportDelayMS):(gTheBatchImageExportOKButton.click(),gBatchImageExportCancelRequested=!1,clearGetTuneByIndexCache())},null),!0}}function ExportOneABCTune(e,t,n,o){var a=document.createElement("a");document.body.appendChild(a),a.style="display: none";var l=new Blob([e],{type:"text/plain"}),r=window.URL.createObjectURL(l);a.href=r,a.download=t,a.click(),document.body.removeChild(a),setTimeout(function(){window.URL.revokeObjectURL(r)},1e3),n()}function BatchMusicXMLExport(){var e;sendGoogleAnalytics("dialog","BatchMusicXMLExport");var t=CountTunes();if(0!=t){var n=0;gBatchImageExportCancelRequested=!1,gTheBatchImageExportOKButton=null,gTheBatchImageExportStatusText=null;var o="Exporting MusicXML for tune "+(n+1)+" of "+(e=t);o=makeCenteredPromptString(o),DayPilot.Modal.alert(o,{theme:"modal_flat",top:290,scrollWithPage:AllowDialogsToScroll(),okText:"Cancel"}).then(function(e){gBatchImageExportCancelRequested=!0});var a=document.getElementsByClassName("modal_flat_main");a[a.length-1].style.zIndex=100001;for(var l=document.getElementsByClassName("modal_flat_ok"),r=null,i=0;i<l.length;++i)if("Cancel"==(r=l[i]).innerText){gTheBatchImageExportOKButton=r;break}var s=document.getElementsByClassName("modal_flat_content"),c=s.length;(gTheBatchImageExportStatusText=s[c-1]).style.textAlign="center";var g=getTuneByIndex(n),d=getTuneTitle(g);return gTheBatchImageExportStatusText.innerHTML="<p>Exporting MusicXML for tune "+(n+1)+" of "+e+"<br/><br/>"+d+"</p>",ExportMusicXML(g,GetTuneAudioDownloadName(g,".xml"),function o(){t--,gBatchImageExportCancelRequested?clearGetTuneByIndexCache():0!=t?setTimeout(function(){var t=getTuneByIndex(++n),a=getTuneTitle(t);gTheBatchImageExportStatusText.innerHTML="<p>Exporting MusicXML for tune "+(n+1)+" of "+e+"<br/><br/>"+a+"</p>",ExportMusicXML(t,GetTuneAudioDownloadName(t,".xml"),o,null)},250):(gTheBatchImageExportOKButton.click(),gBatchImageExportCancelRequested=!1,clearGetTuneByIndexCache())},null),!0}}function ExportMusicXML(e,t,n,o){fetch("https://seisiuneer.pythonanywhere.com/abc2xml",{method:"POST",body:e}).then(e=>e.text()).then(e=>{var o=document.createElement("a");document.body.appendChild(o),o.style="display: none";var a=new Blob([e],{type:"text/plain"}),l=window.URL.createObjectURL(a);o.href=l,o.download=t,o.click(),document.body.removeChild(o),setTimeout(function(){window.URL.revokeObjectURL(l)},1e3),n()}).catch(e=>{console.log("ExportMusicXML - MusicXML conversion failed on "+t),o?o():n()})}function Get_CSV_JSON_TuneName(e){for(var t=e.split("\n"),n=0;n<t.length;++n){var o=t[n].trim();if(o.startsWith("T:")){var a=o.slice(2);return a=a.trim()}}return"Gan Ainm"}function BatchJSONExport(){var e=CountTunes();if(0!=e){sendGoogleAnalytics("dialog","BatchJSONExport");for(var t=[],n=0;n<e;++n){var o=getTuneByIndex(n),a=Get_CSV_JSON_TuneName(o);a.startsWith("*")&&(a=a.substring(1));var l=FillUrlBoxWithAbcInLZW(o=GetABCFileHeader()+o,!1),r=a.replaceAll("&","");l+="&name="+(r=(r=r.replaceAll(" ","_")).replaceAll("#","^"))+"&play=1",t.push({Name:a,URL:l})}saveTextFileDeveloper("Please enter a filename for your batch Share URL JSON file:","All_Share_URLs_JSON.txt",JSON.stringify(t)),clearGetTuneByIndexCache()}}function escapeForCSV(e){if("string"!=typeof e)return e;let t=e.replace(/"/g,'""');return/[",]/.test(t)&&(t=`"${t}"`),t}function BatchCSVExport(){var e=CountTunes();if(0!=e){sendGoogleAnalytics("dialog","BatchCSVExport");for(var t="Name,ShareURL\n",n=0;n<e;++n){var o=getTuneByIndex(n),a=Get_CSV_JSON_TuneName(o);a.startsWith("*")&&(a=a.substring(1));var l=FillUrlBoxWithAbcInLZW(o=GetABCFileHeader()+o,!1),r=a.replaceAll("&","");r=(r=r.replaceAll(" ","_")).replaceAll("#","^"),t+=escapeForCSV(a),t+=",",t+=escapeForCSV(l+="&name="+r+"&play=1"),t+="\n"}saveCSVFile("Please enter a filename for your batch Share URL CSV file:","All_Share_URLs_CSV.csv",t),clearGetTuneByIndexCache()}}function ExportAllTuneTitles(){var e=CountTunes();if(0!=e){sendGoogleAnalytics("dialog","ExportAllTuneTitles");for(var t="",n=0;n<e;++n){var o=Get_CSV_JSON_TuneName(getTuneByIndex(n));o.startsWith("*")&&(o=o.substring(1)),t+=o,t+="\n"}saveTextFileDeveloper("Please enter a filename for your tune titles text file:","All_Tune_Titles.txt",t),clearGetTuneByIndexCache()}}var gMIDIbuffer=null,gPlayerABC=null,gTheOKButton=null,gTheMuteHandle=null,gPlayMetronome=!1;function GetTuneAudioDownloadName(e,t){for(var n=e.split("\n"),o=0;o<n.length;++o){var a=n[o].trim();if(a.startsWith("T:")){var l=a.slice(2);return(l=cleanFileName(l=l.trim()))+t}}return"output"+t}function isJigWithNoTiming(e,t){for(var n=e.split("\n"),o=!1,a=!1,l=!1,r=!1,i=t,s=0;s<n.length;++s){var c=n[s].trim();if(c.startsWith("Q:")&&(o=!0),c.startsWith("M:")){var g=c.replace("M:","");-1!=(g=g.trim()).indexOf("12/8")&&(r=!0,i=2e3),-1!=g.indexOf("6/8")&&(a=!0,i=1e3),-1!=g.indexOf("9/8")&&(l=!0,i=1500)}}return(a||l||r)&&!o?i:t}function DownloadWave(){var e;sendGoogleAnalytics("export","DownloadWave"),gMIDIbuffer.millisecondsPerMeasure=isJigWithNoTiming(gPlayerABC,gMIDIbuffer.millisecondsPerMeasure),e=gMIDIbuffer.millisecondsPerMeasure,gSynthControl&&gSynthControl.warp&&(gMIDIbuffer.millisecondsPerMeasure*=100/gSynthControl.warp);var t=computeFade(gPlayerABC);gMIDIbuffer.fadeLength=t,gMIDIbuffer.prime().then(function(t){var n=gMIDIbuffer.download();gMIDIbuffer.millisecondsPerMeasure=e;var o=document.createElement("a");document.body.appendChild(o),o.setAttribute("style","display: none;"),o.href=n,o.download=GetTuneAudioDownloadName(gPlayerABC,".wav"),o.click(),window.URL.revokeObjectURL(n),document.body.removeChild(o)}).catch(function(e){var t="A problem occured when exporting the .wav file.";t=makeCenteredPromptString(t),DayPilot.Modal.alert(t,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})})}var gBatchMP3ExportCancelRequested=!1,gTheBatchMP3ExportOKButton=null,gTheBatchMP3ExportStatusText=null;function AddDuplicatesForMp3(e,t,n,o,a){if(1==n&&!o&&!a)return e;var l=removeABCTuneHeaders(e=e.trim()),r=(l=l.trim()).split("\n"),i=r.length;if(0==i)return e;var s=0;if(-1!=r[0].indexOf("%")){l=l.replace(r[s]+"\n",""),s=1;for(var c=1;c<i&&-1!=r[c].indexOf("%");++c)l=l.replace(r[s]+"\n",""),s++}var g=r[s],d=e.indexOf(g);if(e=e.substring(0,d),a)switch(t){case"reel":default:e+="V:1\nV:2\nz8|z8|\nV:1\nz8|z8|\n";break;case"jig":case"waltz":e+="V:1\nV:2\nz6|z6|\nV:1\nz6|z6|\n";break;case"slide":e+="V:1\nV:2\nz12|\nV:1\nz12|\n";break;case"slipjig":e+="V:1\nV:2\nz9|z9|\nV:1\nz9|z9|\n";break;case"polka":e+="V:1\nV:2\nz4|z4|\nV:1\nz4|z4|\n"}if(o)switch(t){case"reel":default:e+="V:1\nV:2\n%%MIDI program 128\n^Cz3 ^Cz3|^Cz3 ^Cz3|\nV:1\nz8|z8|\n";break;case"jig":e+="V:1\nV:2\n%%MIDI program 128\n^Cz2 ^Cz2|^Cz2 ^Cz2|\nV:1\nz6|z6|\n";break;case"slide":e+="V:1\nV:2\n%%MIDI program 128\n^Cz2 ^Cz2 ^Cz2 ^Cz2|\nV:1\nz12|\n";break;case"slipjig":e+="V:1\nV:2\n%%MIDI program 128\n^Cz2 ^Cz2 ^Cz2|^Cz2 ^Cz2 ^Cz2|\nV:1\nz9|z9|\n";break;case"polka":e+="V:1\nV:2\n%%MIDI program 128\n^Cz ^Cz|^Cz ^Cz|\nV:1\nz4|z4|\n";break;case"waltz":e+="V:1\nV:2\n%%MIDI program 128\n^Cz ^Cz ^Cz|^Cz ^Cz ^Cz|\nV:1\nz6|z6|\n"}e+=l;for(c=0;c<n-1;++c)e+="\n",e+=l;return e}function getTuneRhythmType(e){for(var t=e.split("\n"),n=!1,o=!1,a=!1,l=!1,r=!1,i=!1,s=!1,c=0;c<t.length;++c){var g=t[c].trim();if(g.startsWith("M:")){var d=g.replace("M:","");-1!=(d=d.trim()).indexOf("3/8")&&(s=!0),-1!=d.indexOf("6/8")&&(n=!0),-1!=d.indexOf("9/8")&&(o=!0),-1!=d.indexOf("12/8")&&(a=!0),-1!=d.indexOf("2/4")&&(l=!0),-1!=d.indexOf("4/4")&&(r=!0),-1!=d.indexOf("3/4")&&(i=!0),-1!=d.indexOf("C")&&(r=!0)}}return n||a?"jig":o?"slipjig":s?"oddjig":l?"polka":r?"reel":i?"waltz":"reel"}var gBatchMP3ExportDelayMS=250;function BatchMP3Export(){sendGoogleAnalytics("dialog","BatchMP3Export");const e=[{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Export All Tunes as MP3&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#export_all_as_mp3" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="margin-top:24px;margin-bottom:24px;font-size:12pt;line-height:18pt;font-family:helvetica">This will export all the tunes in the ABC area as .MP3 files with one or more repeats.</p>'},{html:'<p style="margin-top:24px;margin-bottom:24px;font-size:12pt;line-height:18pt;font-family:helvetica">You may optionally set the playback speed as a percentage of the original.</p>'},{html:'<p style="margin-top:24px;margin-bottom:24px;font-size:12pt;line-height:18pt;font-family:helvetica">You may also optionally inject two bars of silence and/or a click intro before each tune.</p>'},{name:"Playback speed (percentage, default is 100):",id:"configure_percent_speed",type:"number",cssClass:"configure_repeats_form_text"},{name:"How many times to repeat each tune in the .MP3:",id:"configure_repeats",type:"number",cssClass:"configure_repeats_form_text"},{name:"         Include reverb effects in the .MP3",id:"configure_include_reverb",type:"checkbox",cssClass:"configure_repeats_form_text"},{name:"Before each tune:",id:"configure_before_each_tune",type:"select",options:[{name:"Do nothing",id:0},{name:"Inject two bars of silence",id:1},{name:"Inject a two-bar style-appropriate click intro",id:2},{name:"Inject both two bars of silence and click intro",id:3}],cssClass:"configure_mp3_before_tune_select"},{html:'<p style="margin-top:16px;font-size:12pt;line-height:18pt;font-family:helvetica"><strong>To append two-bars of silence and/or a click intro before each tune:</strong></p>'},{html:'<p style="margin-top:16px;font-size:12pt;line-height:18pt;font-family:helvetica">Select your option for silence and/or click intro from the <strong>Before each tune:</strong> dropdown.</p>'},{html:'<p style="margin-top:16px;font-size:12pt;line-height:18pt;font-family:helvetica"><strong>For best results with repeated tunes:</strong></p>'},{html:'<p style="margin-top:16px;font-size:12pt;line-height:18pt;font-family:helvetica">For clean repeats, your tunes must not have extraneous pickup or trailing notes and must have proper and complete timing.</p>'},{html:'<p style="margin-top:16px;font-size:12pt;line-height:18pt;font-family:helvetica">If there is a repeat at the end of the first part of a tune, either standalone or in a first ending, there must be a matching |: bar at the start of the tune for the tune repeats to work properly.</p>'}];DayPilot.Modal.form(e,{configure_repeats:1,configure_before_each_tune:0,configure_include_reverb:!0,configure_percent_speed:100},{theme:"modal_flat",top:100,width:760,scrollWithPage:AllowDialogsToScroll(),okText:"Export",autoFocus:!1}).then(function(e){if(!e.canceled){var t=e.result.configure_repeats;if(null==t)return;if(repeatCount=parseInt(t),isNaN(repeatCount)||null==repeatCount)return;if(repeatCount<1)return;var n=!1,o=!1;switch(e.result.configure_before_each_tune){case 0:n=!1,o=!1;break;case 1:n=!1,o=!0;break;case 2:n=!0,o=!1;break;case 3:n=!0,o=!0}var a=e.result.configure_include_reverb,l=e.result.configure_percent_speed,r=100;if(null!=l){l=l.replace("%","");r=parseInt(l);(isNaN(r)||null==r)&&(r=100),r<=5&&(r=5),r>400&&(r=400)}DoBatchMP3Export(repeatCount,n,o,a,r)}})}function DoBatchMP3Export(e,t,n,o,a){var l;function r(o){s--,o.click(),gBatchMP3ExportCancelRequested||(0!=s?setTimeout(function(){var o=getTuneByIndex(++c),a=getTuneTitle(o=PreProcessPlayABC(o=AddDuplicatesForMp3(o,getTuneRhythmType(o),e,t,n)));gTheBatchMP3ExportStatusText.innerHTML="<p>Exporting .MP3 for tune "+(c+1)+" of "+l+"<br/><br/>"+a+"</p>",PlayABCDialog(o,i,c,!1)},gBatchMP3ExportDelayMS):(gTheBatchMP3ExportOKButton.click(),gBatchMP3ExportCancelRequested=!1))}function i(e,t){gSynthControl.warp=a,o?DownloadMP3WithReverb(r,t):DownloadMP3(r,t)}var s=CountTunes();if(0!=s){var c=0;gBatchMP3ExportCancelRequested=!1,gTheBatchMP3ExportOKButton=null,gTheBatchMP3ExportStatusText=null;var g="Exporting .MP3 for tune "+(c+1)+" of "+(l=s);g=makeCenteredPromptString(g),DayPilot.Modal.alert(g,{theme:"modal_flat",top:290,scrollWithPage:AllowDialogsToScroll(),okText:"Cancel"}).then(function(e){gBatchMP3ExportCancelRequested=!0});var d=document.getElementsByClassName("modal_flat_main");d[d.length-1].style.zIndex=100001;for(var u=document.getElementsByClassName("modal_flat_ok"),m=null,p=0;p<u.length;++p)if("Cancel"==(m=u[p]).innerText){gTheBatchMP3ExportOKButton=m;break}var h=document.getElementsByClassName("modal_flat_content"),f=h.length;(gTheBatchMP3ExportStatusText=h[f-1]).style.textAlign="center";var b=getTuneByIndex(c),y=getTuneTitle(b=PreProcessPlayABC(b=AddDuplicatesForMp3(b,getTuneRhythmType(b),e,t,n)));return gTheBatchMP3ExportStatusText.innerHTML="<p>Exporting .MP3 for tune "+(c+1)+" of "+l+"<br/><br/>"+y+"</p>",PlayABCDialog(b,i,c,!1),!0}}var gInDownloadMP3=!1;function DownloadMP3(e,t){if(gInDownloadMP3)return!1;var n;sendGoogleAnalytics("export","DownloadMP3"),gInDownloadMP3=!0,gMIDIbuffer.millisecondsPerMeasure=isJigWithNoTiming(gPlayerABC,gMIDIbuffer.millisecondsPerMeasure),n=gMIDIbuffer.millisecondsPerMeasure,gSynthControl&&gSynthControl.warp&&(gMIDIbuffer.millisecondsPerMeasure*=100/gSynthControl.warp);var o=computeFade(gPlayerABC);gMIDIbuffer.fadeLength=o,gMIDIbuffer.prime().then(function(o){if(!e){var a=document.getElementById("abcplayer_mp3button");a&&(a.value="Encoding .MP3")}showTheSpinner(),setTimeout(async function(){var o=gMIDIbuffer.download(),a=await fetch(o).then(e=>e.blob());gMIDIbuffer.millisecondsPerMeasure=n;var l=new FileReader;l.onload=function(n){var o=function(e){var t=function(e){function t(t,n){for(var o=0,a=0;n;)o+=e[t]<<a,a+=8,t++,n--;return o}return{sampleRate:t(24,4),bitsPerSample:t(34,2),samples:e.subarray(44)}}(new Uint8Array(e)),n=t.samples.length,o=n/4,a=t.sampleRate,l=new lamejs.Mp3Encoder(2,a,gMP3Bitrate),r=[],i=new Int16Array(t.samples.buffer);for(let e=0;e<882;e++)i[e]=0;const s=Math.ceil(n/2),c=n-s;var g=new Int16Array(s),d=new Int16Array(c);for(let e=0;e<2*o;e++)e%2==0?g[e/2]=i[e]:d[(e-1)/2]=i[e];for(var u=1152,m=0;m<o;m+=u){var p,h=g.subarray(m,m+u),f=d.subarray(m,m+u);(p=l.encodeBuffer(h,f)).length>0&&r.push(p)}return(p=l.flush()).length>0&&r.push(p),r}(n.target.result),a=new Blob(o,{type:"audio/mp3"}),l=window.URL.createObjectURL(a),r=document.createElement("a");if(document.body.appendChild(r),r.setAttribute("style","display: none;"),r.href=l,r.download=GetTuneAudioDownloadName(gPlayerABC,".mp3"),r.click(),window.URL.revokeObjectURL(l),document.body.removeChild(r),!e){var i=document.getElementById("abcplayer_mp3button");i&&(i.value="Save as .MP3")}hideTheSpinner(),gInDownloadMP3=!1,e&&e(t)},l.readAsArrayBuffer(a)},gSpinnerDelay)}).catch(function(t){var n="A problem occured when exporting the .mp3 file.";if(n=makeCenteredPromptString(n),DayPilot.Modal.alert(n,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()}),!e){var o=document.getElementById("abcplayer_mp3button");o&&(o.value="Save as .MP3")}hideTheSpinner(),gInDownloadMP3=!1})}function DownloadMIDI(e,t){e||sendGoogleAnalytics("export","DownloadMIDI");var n=ABCJS.synth.getMidiFile(gPlayerABC,{midiOutputType:"link"})[0];n=n.replace("<a download",'<a id="downloadmidilink" download');var o=document.createElement("div");o.innerHTML=n,o.setAttribute("style","display: none;"),document.body.appendChild(o),document.getElementById("downloadmidilink").click(),document.body.removeChild(o),e&&e(t)}function ExportAudioOrImage(){var e="";GetRadioValue("notenodertab");e=gIsQuickEditor?'<p style="text-align:center;font-size:20pt;font-family:helvetica">Export Audio or Image</p>':'<p style="text-align:center;font-size:20pt;font-family:helvetica">Export Audio, Image, or PDF</p>',e+=gPlayABCTuneCount>1?'<p style="text-align:center;font-size:14pt;font-family:helvetica;margin-top:32px;">Export Single Tune Audio</p>':'<p style="text-align:center;font-size:14pt;font-family:helvetica;margin-top:32px;">Export Tune Audio</p>',e+='<p style="text-align:center;font-size:20pt;font-family:helvetica;">',e+='<input id="abcplayer_wavbutton" class="abcplayer_wavbutton btn btn-wavedownload" onclick="DownloadWave();" type="button" value="Export as WAV File" title="Exports the audio for the current tune as a .WAV file">',e+='<input id="abcplayer_mp3button" class="abcplayer_mp3button btn btn-mp3download" onclick="DownloadMP3();" type="button" value="Export as MP3 File" title="Exports the audio for the current tune as a .MP3 file">',e+='<input id="abcplayer_midibutton" class="abcplayer_midibutton btn btn-mididownload" onclick="DownloadMIDI();" type="button" value="Export as MIDI File" title="Exports the current tune note events as a MIDI file">',e+="</p>",e+='<p style="text-align:center;font-size:20pt;font-family:helvetica;">',e+='<input id="abcplayer_wavreverbbutton" class="abcplayer_wavreverbbutton btn btn-wavereverbdownload" onclick="DownloadWaveWithReverb();" type="button" value="Export as WAV File with Reverb" title="Exports the audio for the current tune as a .WAV file including reverb"><input id="abcplayer_mp3reverbbutton" class="abcplayer_mp3reverbbutton btn btn-mp3reverbdownload" onclick="DownloadMP3WithReverb();" type="button" value="Export as MP3 File with Reverb" title="Exports the audio for the current tune as a .MP3 file including reverb">',e+="</p>",e+=gPlayABCTuneCount>1?'<p style="text-align:center;font-size:14pt;font-family:helvetica;margin-top:24px;">Export Single Tune Image</p>':'<p style="text-align:center;font-size:14pt;font-family:helvetica;margin-top:24px;">Export Tune Image</p>',e+='<p style="text-align:center;font-size:20pt;font-family:helvetica"><input id="abcplayer_jpgbutton" class="abcplayer_jpgbutton btn btn-jpgdownload" onclick="DownloadJPEG();" type="button" value="Export as JPEG File" title="Exports the current tune image as a JPEG file">',e+='<input id="abcplayer_pngbutton" class="abcplayer_pngbutton btn btn-pngdownload" onclick="DownloadPNG();" type="button" value="Export as PNG File" title="Exports the current tune image as a PNG file">',e+='<input id="abcplayer_svgbutton" class="abcplayer_svgbutton btn btn-svgdownload" onclick="DownloadSVG();" type="button" value="Export as SVG File" title="Exports the current tune image as a SVG file">',e+="</p>",e+='<p class="export_single_text">',e+='Image width to export: <input id="export_width" type="number" min="0" step="1" max="4096" title="Image width to export" autocomplete="off"/>',e+="</p>",gIsQuickEditor||(gPlayABCTuneCount>1?(e+='<p style="text-align:center;font-size:14pt;font-family:helvetica;margin-top:24px;">Export All Tunes as PDF File</p>',e+='<p style="text-align:center;font-size:20pt;font-family:helvetica"><input id="abcplayer_pdfbutton" class="abcplayer_pdfbutton btn btn-pdfdownload" onclick="PDFExportDialog();" type="button" value="Export All Tunes as PDF File" title="Exports all the tunes as a PDF file"></p>'):(e+='<p style="text-align:center;font-size:14pt;font-family:helvetica;margin-top:24px;">Export Tune as PDF File</p>',e+='<p style="text-align:center;font-size:20pt;font-family:helvetica"><input id="abcplayer_pdfbutton" class="abcplayer_pdfbutton btn btn-pdfdownload" onclick="PDFExportDialog();" type="button" value="Export Tune as PDF File" title="Exports this tune as a PDF file"></p>')),e+='<a id="exportaudioimage_help" href="https://michaeleskin.com/abctools/userguide.html#export_audio_image" target="_blank" style="text-decoration:none;" title="Learn more about the audio and image exporter" class="dialogcornerbutton">?</a>',DayPilot.Modal.alert(e,{theme:"modal_flat",top:100,scrollWithPage:AllowDialogsToScroll()}),document.getElementById("export_width").value=gExportWidth}function computeFade(e){var t=200;gExtendDuration=0,searchRegExp=/^%abcjs_release_decay_time.*[\r\n]*/gm;var n=e.match(searchRegExp);if(n&&n.length>0){t=(t=n[n.length-1].replace("%abcjs_release_decay_time","")).trim();var o=parseInt(t);isNaN(o)||(t=o)>200&&(gExtendDuration=(t-200)/1e3)}return t}function postProcessTab(e,t,n,o){function a(){var n;n=o||gIsQuickEditor?document.querySelectorAll('div[id="'+t+'"] > svg > g > g > [class="abcjs-top-line"]'):document.querySelectorAll('div[id="'+t+'"] > div > svg > g > g > [class="abcjs-top-line"]');var a=e.length;if(0!=a){var l=0;if(a>1){l=t.replace("notation","");if(l=parseInt(l),isNaN(l))return}var r=e[l],i=r.lines.length;if(0!=i){for(var s=[],c=0;c<i;++c){r.lines[c].staff&&s.push(r.lines[c])}var g=s.length;if(0!=g){var d=[];for(c=0;c<g;++c){var u=s[c].staff.length,m=u/2;for(j=0;j<u;++j)j<m?d.push(!1):d.push(!0)}for(var p=0;p<n.length;p++)if(d[p]){n[p].setAttribute("class","hiddentabline");for(var h=getNextSiblings(n[p]),f=0;f<h.length;f++)h[f].setAttribute("class","hiddentabline")}}}}}if(e)if("whistle"===n){let e;a();const n=`div[id="${t}"] > `,l=gIsQuickEditor||o?"svg":"div > svg";e=document.querySelectorAll(`${n}${l} > g > g[data-name="tabNumber"] > text > tspan`);const r=["g","m","a","i","b","c","j","d","k","e","f","l","g","m","a","i","b","c","j","D","K","E","F","L","G","M","A","I","B","n","J","D","K","E","F","L","G","M","A"];e.forEach(e=>{e.setAttribute("class","whistle"),e.setAttribute("dy","-7");const t=parseInt(e.innerHTML);!isNaN(t)&&t>=0&&t<r.length?e.innerHTML=r[t]:(e.setAttribute("class","whistle_small"),e.setAttribute("dy","-23"),e.innerHTML="x")})}else if("recorder"===n){a();const e=gIsQuickEditor||o?`div[id="${t}"] > svg > g > g[data-name="tabNumber"] > text > tspan`:`div[id="${t}"] > div > svg > g > g[data-name="tabNumber"] > text > tspan`,n=document.querySelectorAll(e);var l;l=gRecorderFingeringGerman?["1","2","3","4","5","%","/","8","&","0","-","=","q","w","e","r","T","?","{","i","}","p","[","]","a","A","D","f","g","h","j","k"]:["1","2","3","4","5","6","7","8","9","0","-","=","q","w","e","r","T","y","u","i","o","p","[","]","a","s","d","f","g","h","j","k"],n.forEach(e=>{let t=parseInt(e.innerHTML,10);e.setAttribute("class","recorder"),e.setAttribute("dy","-8"),!isNaN(t)&&t>=0&&t<l.length?e.innerHTML=l[t]:(e.setAttribute("class","whistle_small"),e.setAttribute("dy","-23"),e.innerHTML="x")})}else if("notenames"===n){a();let e=!0,n=document.querySelectorAll(o||gIsQuickEditor?`div[id="${t}"] > svg`:`div[id="${t}"] > div > svg`);const l=o||gIsQuickEditor?0:1;if(!n||n.length<=l)return;const r={sharps:["G,","G♯,","A,","A♯,","B,","C","C♯","D","D♯","E","F","F♯","G","G♯","A","A♯","B","c","c♯","d","d♯","e","f","f♯","g","g♯","a","a♯","b","c'","c♯'","d'","d♯'","e'","f'","f♯'","g'","g♯'","a'","a♯'","b'"],flats:["G,","A♭,","A,","B♭,","B,","C","D♭","D","E♭","E","F","G♭","G","A♭","A","B♭","B","c","d♭","d","e♭","e","f","g♭","g","a♭","a","b♭","b","c'","d♭'","d'","e♭'","e'","f'","g♭'","g'","a♭'","a'","b♭'","b'"],comhaltas:{sharps:["G,","G♯,","A,","A♯,","B,","C,","C♯,","D","D♯","E","F","F♯","G","G♯","A","A♯","B","C","C♯","D'","D♯'","E'","F'","F♯'","G'","G♯'","A'","A♯'","B'","C'","C♯'","D''","D♯''","E''","F''","F♯''","G''","G♯''","A''","A♯''","B''"],flats:["G,","A♭,","A,","B♭,","B,","C,","D♭","D","E♭","E","F","G♭","G","A♭","A","B♭","B","C","D♭","D'","E♭'","E'","F'","G♭'","G'","A♭'","A'","B♭'","B'","C'","D♭'","D''","E♭''","E''","F''","G♭''","G''","A♭''","A''","B♭''","B''"]}};for(let t=l;t<n.length;t++){const o=n[t],a=o.querySelector('g[data-name="staff-extra key-signature"]');a?.innerHTML.includes("accidentals.flat")&&(e=!1);const l=o.querySelectorAll('g[data-name="tabNumber"] > text > tspan'),i=gUseComhaltasABC||gForceComhaltasABC?r.comhaltas[e?"sharps":"flats"]:r[e?"sharps":"flats"];l.forEach(e=>{const t=parseInt(e.innerHTML,10);e.innerHTML=i[t]||"?"})}}}function ToggleMetronome(){gPlayMetronome=!gPlayMetronome,gLocalStorageAvailable&&(localStorage.PlayMetronome=gPlayMetronome),gTheOKButton.click(),setTimeout(function(){if(gPlayMetronome){if(!inject_one_metronome(gPlayerABC,!1)){gPlayMetronome=!1;return DayPilot.Modal.alert('<p style="text-align:center;font-size:20pt;font-family:helvetica">Metronome Not Available for this Meter</p><p style="font-size:14pt;line-height:20pt;font-family:helvetica;">No metronome pattern is available for the meter of this tune.</p><p style="font-size:14pt;line-height:20pt;font-family:helvetica;">Only the original version can be played.</p>',{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()}).then(function(){PlayABCDialog(gPlayerABC,null,null,!1)}),void(gLocalStorageAvailable&&(localStorage.PlayMetronome=!1))}PlayABCDialog(gPlayerABC,null,null,gPlayMetronome)}else PlayABCDialog(gPlayerABC,null,null,gPlayMetronome)},250)}function ZoomPlayer(e){gPlayerScaling=parseInt(gPlayerScaling),isNaN(gPlayerScaling)?gPlayerScaling=gIsIPad?60:50:(e?(gPlayerScaling+=10)>100&&(gPlayerScaling=100):(gPlayerScaling-=10)<50&&(gPlayerScaling=50),gLocalStorageAvailable&&(localStorage.PlayerScaling=gPlayerScaling)),gTheOKButton.click();var t=getTuneByIndex(gPlayABCTuneIndex);""!=t&&(t=PreProcessPlayABC(t),setTimeout(function(){PlayABCDialog(t,null,null,gPlayMetronome)},250))}function ShowPlayerSettings(){ConfigurePlayerSettings(function(e){if(e){gTheOKButton.click();var t=getTuneByIndex(gPlayABCTuneIndex);if(""==t)return;t=PreProcessPlayABC(t),setTimeout(function(){PlayABCDialog(t,null,null,gPlayMetronome)},250)}})}var gPlayerContainerRect=null,gPlayerHolder=null;function throttle(e,t){let n;return function(...o){n||(e.apply(this,o),n=!0,setTimeout(()=>n=!1,t))}}function smoothWindowScrollBy(e,t){window.scrollBy({top:t,left:e,behavior:"smooth"})}function smoothElementScrollTo(e,t,n){e.scrollTo({top:n,left:t,behavior:"smooth"})}const throttledWindowScrollBy=throttle(smoothWindowScrollBy,200),throttledElementScrollTo=throttle(smoothElementScrollTo,200);function CursorControl(){var e=this,t=-1e3;e.onReady=function(){},e.onStart=function(){var e=document.querySelector("#playback-paper svg"),t=document.querySelector("#playback-paper svg .abcjs-cursor");t||((t=document.createElementNS("http://www.w3.org/2000/svg","line")).setAttribute("class","abcjs-cursor"),t.setAttributeNS(null,"x1",0),t.setAttributeNS(null,"y1",0),t.setAttributeNS(null,"x2",0),t.setAttributeNS(null,"y2",0),e.appendChild(t))},e.beatSubdivisions=2,e.onBeat=function(e,t,n){},e.onEvent=function(e){if(!e.measureStart||null!==e.left){if(!gDisablePlayHighlight){for(var n=document.querySelectorAll("#playback-paper svg .highlight"),o=0;o<n.length;o++)n[o].classList.remove("highlight");for(var a=0;a<e.elements.length;a++)for(var l=e.elements[a],r=0;r<l.length;r++)gOnlyHighlightV1?l[r].classList.contains("abcjs-v0")&&l[r].classList.add("highlight"):l[r].classList.add("highlight")}var i=document.querySelector("#playback-paper svg .abcjs-cursor");if(i&&(i.setAttribute("x1",e.left-2),i.setAttribute("x2",e.left-2),i.setAttribute("y1",e.top),i.setAttribute("y2",e.top+e.height),gAutoscrollPlayer)){const e=i.getBoundingClientRect();var s=(gPlayerContainerRect.bottom-gPlayerContainerRect.top)*(gAutoscrollTarget/100),c=!1;if((e.bottom<gPlayerContainerRect.top||e.top>gPlayerContainerRect.bottom)&&(c=!0),e.top<gPlayerContainerRect.top){var g=gPlayerHolder.scrollTop+e.top-gPlayerContainerRect.top;(d=t-g)<0&&(d=-d),(d>48||c)&&(gAutoscrollSmooth?throttledElementScrollTo(gPlayerHolder,0,g):gPlayerHolder.scrollTop=g,c||(t=g))}else if(e.bottom>s){if(e.bottom-e.top<=s){g=gPlayerHolder.scrollTop+e.bottom-s;(d=t-g)<0&&(d=-d),(d>48||c)&&(gAutoscrollSmooth?throttledElementScrollTo(gPlayerHolder,0,g):gPlayerHolder.scrollTop=g,c||(t=g))}else{var d;g=gPlayerHolder.scrollTop+e.top-gPlayerContainerRect.top;(d=t-g)<0&&(d=-d),(d>48||c)&&(gAutoscrollSmooth?throttledElementScrollTo(gPlayerHolder,0,g):gPlayerHolder.scrollTop=g,c||(t=g))}}}}},e.onFinished=function(){for(var e=document.querySelectorAll("svg .highlight"),t=0;t<e.length;t++)e[t].classList.remove("highlight");var n=document.querySelector("#playback-paper svg .abcjs-cursor");n&&(n.setAttribute("x1",0),n.setAttribute("x2",0),n.setAttribute("y1",0),n.setAttribute("y2",0))}}function CursorControlOneTune(){var e=this;e.onReady=function(){},e.onStart=function(){var e=document.querySelector("#notation0 svg"),t=document.querySelector("#notation0 svg .abcjs-cursor");t||((t=document.createElementNS("http://www.w3.org/2000/svg","line")).setAttribute("class","abcjs-cursor"),t.setAttributeNS(null,"x1",0),t.setAttributeNS(null,"y1",0),t.setAttributeNS(null,"x2",0),t.setAttributeNS(null,"y2",0),e.appendChild(t))},e.beatSubdivisions=2,e.onBeat=function(e,t,n){},e.onEvent=function(e){if(!e.measureStart||null!==e.left){if(!gRawMode&&!gDisablePlayHighlight){for(var t=document.querySelectorAll("#notation0 svg .highlight"),n=0;n<t.length;n++)t[n].classList.remove("highlight");for(var o=0;o<e.elements.length;o++)for(var a=e.elements[o],l=0;l<a.length;l++)gOnlyHighlightV1?a[l].classList.contains("abcjs-v0")&&a[l].classList.add("highlight"):a[l].classList.add("highlight")}var r=document.querySelector("#notation0 svg .abcjs-cursor");if(r&&(r.setAttribute("x1",e.left-2),r.setAttribute("x2",e.left-2),r.setAttribute("y1",e.top),r.setAttribute("y2",e.top+e.height),gAutoscrollPlayer&&(!gIsOneColumn||gIsOneColumn&&gIsMaximized))){const e=r.getBoundingClientRect();var i=window.innerHeight*(gAutoscrollTarget/100);if(e.top<0)gAutoscrollSmooth?throttledWindowScrollBy(0,e.top-32):window.scrollBy(0,e.top-32);else if(e.bottom>i){e.bottom-e.top<=i?gAutoscrollSmooth?throttledWindowScrollBy(0,e.bottom-i):window.scrollBy(0,e.bottom-i):gAutoscrollSmooth?throttledWindowScrollBy(0,e.top-32):window.scrollBy(0,e.top-32)}}}},e.onFinished=function(){if(!gRawMode)for(var e=document.querySelectorAll("svg .highlight"),t=0;t<e.length;t++)e[t].classList.remove("highlight");var n=document.querySelector("#notation0 svg .abcjs-cursor");n&&(n.setAttribute("x1",0),n.setAttribute("x2",0),n.setAttribute("y1",0),n.setAttribute("y2",0))}}function findLargestRectangle(e,t,n){for(var o={width:0,height:0},a=1;a<=e;a++){var l=a/n;l<=t&&(o.width=a,o.height=l)}return o}function PlayPrevious(e){if(gPlayABCTuneIndex>0){e.shiftKey?gPlayABCTuneIndex=0:gPlayABCTuneIndex--;var t=getTuneByIndex(gPlayABCTuneIndex);if(""==t)return;gTheOKButton.click(),PlayABCDialog(t=PreProcessPlayABC(t),null,null,gPlayMetronome)}}function PlayNext(e){if(gPlayABCTuneIndex<gPlayABCTuneCount-1){e.shiftKey?gPlayABCTuneIndex=gPlayABCTuneCount-1:gPlayABCTuneIndex++;var t=getTuneByIndex(gPlayABCTuneIndex);if(""==t)return;gTheOKButton.click(),PlayABCDialog(t=PreProcessPlayABC(t),null,null,gPlayMetronome)}}function PlaySelectedTune(){var e=document.getElementById("playertunelist").value;if(e=parseInt(e),!isNaN(e)){var t=getTuneByIndex(gPlayABCTuneIndex=e);""!=t&&(gTheOKButton.click(),PlayABCDialog(t=PreProcessPlayABC(t),null,null,gPlayMetronome))}}function JustTheNotes(e){if(isSectionHeader(e))return e;for(var t,n=e,o=removeABCTuneHeaders(e),a=o.split("\n"),l=a.length,r=!1,i=0;i<l;++i)if(0!=(t=a[i]).indexOf("%")){r=!0;var s=o.indexOf(t);o=o.substring(s);break}return r?o:n}function ProcessSelectRegionForPlay(e){if(gDisableSelectedPlay)return e;if(gIsMaximized)return e;var t,n;if(gEnableSyntax?(t=gTheCM.selectionStart,n=gTheCM.selectionEnd):(t=gTheABC.selectionStart,n=gTheABC.selectionEnd),t==n)return e;if(-1!=e.indexOf("V:"))return e;var o=findTuneOffsetByIndex(gPlayABCTuneIndex),a=e.length,l=JustTheNotes(e);t<o&&(t=o),n>o+a&&(n=o+a),t-=o,n-=o;var r=e.indexOf(l);if(-1==r)return e;if(t<r&&n<r)return e;t<r&&(t=r),t-=r,n-=r;var i=l.substring(t,n);return 0==(i=i.trim()).indexOf("\n")&&(i=(i=i.substring(1,i.length)).trim()),e.substring(0,r)+i}function deactivateQuickPlayer(){gIsQuickEditor&&(gRawMode&&(gSuppressQuickPlayer=!0,ToggleRawMode(),gSuppressQuickPlayer=!1),gMIDIbuffer=null,gIsIOS&&gTheMuteHandle&&(gTheMuteHandle.dispose(),gTheMuteHandle=null),gSynthControl&&(gSynthControl.destroy(),gSynthControl=null),document.getElementById("playback-audio-inline").innerHTML="",gCurrentTune=-1)}function PlayABC(e){if(gAllowCopy){if(gIsQuickEditor&&gRawMode)return;if(deactivateQuickPlayer(),gIsMaximized)if(gPlayABCGotMaximizedPlay){if(""==(t=getTuneByIndex(gPlayABCTuneIndex)))return}else{var t;if(""==(t=findSelectedTune()))return;gPlayABCTuneIndex=findSelectedTuneIndex(),gPlayABCTuneCount=CountTunes(),gPlayABCGotMaximizedPlay=!0}else{if(e&&e.shiftKey)return void TuneTrainer(!1);if(e&&e.altKey){if(gPlayABCTuneCount=CountTunes(),""==(t=getTuneByIndex(gPlayABCTuneIndex=Math.floor(Math.random()*gPlayABCTuneCount))))return}else{if(""==(t=findSelectedTune()))return;gPlayABCTuneIndex=findSelectedTuneIndex(),gPlayABCTuneCount=CountTunes(),-1==gPlayABCTuneIndex&&(t=getTuneByIndex(gPlayABCTuneIndex=0))}gPlayABCGotMaximizedPlay=!1}PlayABCDialog(t=PreProcessPlayABC(t=ProcessSelectRegionForPlay(t)),null,null,gPlayMetronome)}}function PlayerSetupCommon(e){var t=ScanTuneForSoundFont(e);if(t){var n=gTheActiveSoundFont;switch(t){case"fluid":gTheActiveSoundFont="https://paulrosen.github.io/midi-js-soundfonts/FluidR3_GM/";break;case"musyng":gTheActiveSoundFont="https://paulrosen.github.io/midi-js-soundfonts/MusyngKite/";break;case"fatboy":gTheActiveSoundFont="https://michaeleskin.com/abctools/soundfonts/fatboy_4/";break;case"canvas":gTheActiveSoundFont="https://michaeleskin.com/abctools/soundfonts/canvas/";break;case"mscore":gTheActiveSoundFont="https://michaeleskin.com/abctools/soundfonts/mscore_2/";break;case"arachno":gTheActiveSoundFont="https://michaeleskin.com/abctools/soundfonts/arachno_3/";break;case"fluidhq":gTheActiveSoundFont="https://michaeleskin.com/abctools/soundfonts/fluidhq_1/"}gTheActiveSoundFont!=n&&(gSoundsCacheABCJS={})}else gTheActiveSoundFont!=gDefaultSoundFont&&(gTheActiveSoundFont=gDefaultSoundFont,gSoundsCacheABCJS={});ScanTuneForGMOverride(e);var o=ScanTuneForBodhranPitch(e);if(o){var a=gTheActiveBodhranPitch;(gTheActiveBodhranPitch=o)!=a&&(gSoundsCacheABCJS={})}else gTheActiveBodhranPitch!=gDefaultBodhranPitch&&(gTheActiveBodhranPitch=gDefaultBodhranPitch,gSoundsCacheABCJS={});var l=ScanTuneForBanjoStyle(e);if(l){var r=gTheActiveBanjoStyle;gTheActiveBanjoStyle=l,l!=r&&(gSoundsCacheABCJS={})}else gTheActiveBanjoStyle!=gDefaultBanjoStyle&&(gTheActiveBanjoStyle=gDefaultBanjoStyle,gSoundsCacheABCJS={});gOnlyHighlightV1=!1,gOnlyHighlightV1=ScanTuneForV1OnlyHighlight(e),gDisablePlayHighlight=!1,gDisablePlayHighlight=ScanTuneForDisablePlayHighlight(e),gForceRollUseRollForIrishRoll=!1,gForceRollUseRollForIrishRoll=ScanTuneForForceIrishRoll(e),gForceRollUseRollForIrishRollDisable=!1,gForceRollUseRollForIrishRollDisable=ScanTuneForForceIrishRollDisable(e),gDisablePlayHighlight&&(gOnlyHighlightV1=!1),gVoiceTuning=null,gSequenceCallback=null,(gVoiceTuning=ScanTuneForVoiceTuning(e))&&gVoiceTuning.length>0&&(gSequenceCallback=VoiceTuningCallback);var i=GetRadioValue("notenodertab");return gTabFirstStaffOnly=ScanTuneForTabFirstStaffOnly(e,i),gTabSecondStaffOnly=!1,gTabFirstStaffOnly||(gTabSecondStaffOnly=ScanTuneForTabSecondStaffOnly(e,i)),ScanTuneForReverb(e),!0}function VoiceTuningCallback(e,t){var n,o,a=e.length,l=gVoiceTuning.length;for(l<a&&(a=l),n=0;n<a;++n){var r=gVoiceTuning[n],i=e[n],s=i.length;for(o=0;o<s;++o)i[o].cents=r}}var gPlayABCTuneIndex=0,gPlayABCTuneCount=0,gPlayABCGotMaximizedPlay=!1;function PlayABCDialog(e,t,n,o){if(sendGoogleAnalytics("dialog","PlayABCDialog"),gMIDIbuffer=null,gTheOKButton=null,gPlayerABC=e,o&&(e=inject_one_metronome(e,!1)),PlayerSetupCommon(e)){ScanTuneForCustomTimingInjection(e);var a=GetRadioValue("notenodertab"),l=GetABCJSParams(a);l.oneSvgPerLine=!1,"noten"!=a&&l.tablature&&l.tablature.length>0&&(l.tablature[0].label="");var r,i=new CursorControl;if(gIsIOS){var s=ABCJS.synth.activeAudioContext();gTheMuteHandle=null,s&&(gTheMuteHandle=unmute(s,!1,!1))}!function(){var t;if(gLoopCallback=null,gStartPlayCallback=null,gPreStartPlayCallback=null,gPlayerInPause=!1,gLargePlayerControls?t=window.innerHeight-306:(t=window.innerHeight-286,isDesktopBrowser()&&isSafari()&&(t-=10)),modal_msg='<div id="playerholder" style="height:'+t+'px;overflow-y:auto;margin-bottom:15px;">',modal_msg+=gLargePlayerControls?'<div id="abcplayer" class="abcjs-large">':'<div id="abcplayer">',modal_msg+='<div id="playback-paper"></div>',modal_msg+="</div>",modal_msg+="</div>",modal_msg+=gLargePlayerControls?'<div id="playback-audio" class="abcjs-large"></div>':'<div id="playback-audio"></div>',modal_msg+='<p style="text-align:center;margin:0px;margin-top:10px">',isDesktopBrowser()&&(modal_msg+='<input id="abcplayer_zoom_out" class="btn btn-player_zoom abcplayer_zoom_out" onclick="ZoomPlayer(false)" type="button" value="→&nbsp;←" title="Decreases the player width 10% of the window screen size">'),modal_msg+='<input id="abcplayer_trainer" class="btn btn-looper abcplayer_trainer" onclick="TuneTrainerLaunchFromPlayer()" type="button" value="Start Tune Trainer" title="Opens the Tune Trainer for practicing tunes with increasing tempos">',modal_msg+=gPlayMetronome?'<input id="abcplayer_metronomebutton" class="abcplayer_metronome button btn btn-metronome" onclick="ToggleMetronome();" type="button" value="Disable Metronome" title="Disables the metronome">':'<input id="abcplayer_metronomebutton" class="abcplayer_metronome button btn btn-metronome" onclick="ToggleMetronome();" type="button" value="Enable Metronome" title="Enables the metronome">',gIsQuickEditor?modal_msg+='<input id="abcplayer_exportbutton" class="abcplayer_exportbutton btn btn-exportaudiomidi" onclick="ExportAudioOrImage();" type="button" value="Export Audio or Image" title="Brings up a dialog where you can export the tune in various audio and image formats">':modal_msg+='<input id="abcplayer_exportbutton" class="abcplayer_exportbutton btn btn-exportaudiomidi" onclick="ExportAudioOrImage();" type="button" value="Export Audio, Image, or PDF" title="Brings up a dialog where you can export the tune in various audio, image, and PDF formats">',modal_msg+='<input id="abcplayer_settingsbutton" class="abcplayer_settingsbutton btn btn-configuresettingsfromhelp" onclick="ShowPlayerSettings();" type="button" value="Settings" title="Brings up the Player Instrument Settings dialog where you can select the default MIDI soundfont, MIDI instruments, and MIDI volumes to use when playing tunes.&nbsp;&nbsp;From the dialog you can also set the Player screen width percentage, load and manage custom instruments.">',isDesktopBrowser()&&(modal_msg+='<input id="abcplayer_zoom_in" class="btn btn-player_zoom abcplayer_zoom_in" onclick="ZoomPlayer(true)" type="button" value="←&nbsp;→" title="Increases the player width 10% of the window screen size">'),modal_msg+="</p>",modal_msg+='<p style="text-align:center;font-size:0pt;font-family:helvetica">&nbsp;</p>',modal_msg+='<a id="abcplayer_help" href="https://michaeleskin.com/abctools/userguide.html#playing_your_tunes" target="_blank" style="text-decoration:none;" title="Learn more about the Player" class="dialogcornerbutton">?</a>',gPlayABCTuneCount>1){modal_msg+=gPlayerStatusOnLeft?'<p id="playerstatus_left" class="playerstatus_left">':'<p id="playerstatus" class="playerstatus">',modal_msg+='<input id="abcplayer_previousbutton" class="abcplayer_previousbutton btn btn-playerprevious" onclick="PlayPrevious(event);" type="button" value="&nbsp;←&nbsp;" title="Play the previous tune.&nbsp;&nbsp;Shift-click to jump to the first tune.">Tune '+(gPlayABCTuneIndex+1)+" of "+gPlayABCTuneCount+'<input id="abcplayer_nextbutton" class="abcplayer_nextbutton btn btn-playernext" onclick="PlayNext(event);" type="button" value="&nbsp;→&nbsp;" title="Play the next tune.&nbsp;&nbsp;Shift-click to jump to the last tune.">',modal_msg+='<br/><select id="playertunelist" onchange="PlaySelectedTune();" title="Select a tune to play from the list">',totalTunes=CountTunes();for(var n=GetTunebookIndexTitles(),a=n.length,l=0;l<a;++l)modal_msg+='<option value="'+l+'">'+n[l]+"</option>";modal_msg+="</select></p>"}var s,g=window.innerWidth;if(GetRadioValue("notenodertab"),isDesktopBrowser()?(s=giPadTwoColumn?isLandscapeOrientation()?g*(gPlayerScaling/100):.9*g:g*(gPlayerScaling/100))<850&&(s=850):s=800,DayPilot.Modal.alert(modal_msg,{theme:"modal_flat",top:20,width:s,okText:"Close",scrollWithPage:isMobileBrowser()}),gPlayABCTuneCount>1){var d=document.getElementById("abcplayer_previousbutton");gPlayABCTuneIndex>0?(d.disabled=!1,d.style.opacity=1):(d.disabled=!0,d.style.opacity=.25),d=document.getElementById("abcplayer_nextbutton"),gPlayABCTuneIndex<gPlayABCTuneCount-1?(d.disabled=!1,d.style.opacity=1):(d.disabled=!0,d.style.opacity=.25),document.getElementById("playertunelist").value=gPlayABCTuneIndex}GetRadioValue("notenodertab"),o&&1==o&&((d=document.getElementById("abcplayer_metronomebutton")).value="Disable Metronome");var u=document.getElementsByClassName("modal_flat_ok"),m=null;for(l=0;l<u.length;++l)if("Close"==(m=u[l]).innerText){gTheOKButton=m;var p=m.onclick;m.onclick=function(){p(),gSynthControl=null,r&&(r.destroy(),r=null),FocusAfterOperation(),gIsIOS&&gTheMuteHandle&&(gTheMuteHandle.dispose(),gTheMuteHandle=null)};break}ABCJS.synth.supportsAudio()?(r=new ABCJS.synth.SynthController(e)).load("#playback-audio",i,{displayLoop:!0,displayRestart:!0,displayPlay:!0,displayProgress:!0,displayWarp:!0}):document.querySelector("#playback-audio").innerHTML="<div class='audio-error'>Audio is not supported in this browser.</div>",c(!1),gPlayerHolder=document.getElementById("playerholder"),gPlayerContainerRect=gPlayerHolder.getBoundingClientRect()}()}function c(o){r.disable(!0);var i=ABCJS.renderAbc("playback-paper",e,l)[0];postProcessTab([i],"playback-paper",a,!0);var s=new ABCJS.synth.CreateSynth(e);gMIDIbuffer=s,gMIDIInitStillWaiting=!1,SetupPlayerEventHandlers(),s.init({visualObj:i}).then(function(a){if(r){var l=computeFade(e);r.setTune(i,o,{fadeLength:l}).then(function(o){if(console.log("Audio successfully loaded."),gSynthControl=r,t?t(n,gTheOKButton):verifyCustomInstrumentsLoaded(e),(a=document.getElementsByClassName("abcjs-midi-tempo"))&&a.length>0&&(a[0].onclick=SetPlayerTempo),gTrainerTouchControls){var a,l=document.getElementsByClassName("abcjs-midi-clock"),i=document.getElementsByClassName("abcjs-midi-current-tempo-wrapper");if(l&&i&&l.length>0&&i.length>0)(a=l[0]).onclick=DecrementTempo,(a=i[0]).onclick=IncrementTempo}}).catch(function(e){hideTheSpinner(),gMIDIInitStillWaiting=!1,console.log("Problem loading audio for this tune")})}}).catch(function(e){hideTheSpinner(),gMIDIInitStillWaiting=!1,console.log("Problem loading audio for this tune")})}}function stripNewlineIfSingleLine(e){return e.endsWith("\n")&&e.indexOf("\n")===e.length-1?e.slice(0,-1):e}const removeSpacesAndDotsFromPLine=e=>e.split("\n").map(e=>e.startsWith("P:")?e.replace(/[ .]/g,""):e).join("\n");function removeVskipLines(e){return e.split("\n").filter(e=>!e.trim().startsWith("%%vskip")).join("\n")}function removeFirstTitleLine(e){const t=e.split("\n");if(t.filter(e=>e.startsWith("T:")).length>=2){const e=t.findIndex(e=>e.startsWith("T:"));-1!==e&&t.splice(e,1)}return t.join("\n")}function removeAllPLines(e){return e.split("\n").filter(e=>!e.startsWith("P:")).join("\n")}function removeSinglePercentLines(e){return e.split("\n").filter(e=>!/^%(?:\s|$|P:)/.test(e)).join("\n")}function flattenABCParts(e){e=(e=(e=(e=(e=removeSinglePercentLines(e)).replace(/^ *% *P:.*$/gm,"")).replace(/^\s*[\r\n]+/gm,"")).replace(/\[P:\s+([A-Z])\]/g,"P:$1\n")).replaceAll("\n\n","\n");const t=(e=removeSpacesAndDotsFromPLine(e)).match(/^[\s\S]*?(?=P:)/),n=t?t[0]:"",o=e.match(/P:([^\n]+)/);if(!o)return e;var a=o[1].replace(/\s+/g," ").trim();const l=/(P:[A-Z0-9()]*)([\s\S]*?)(?=P:[A-Z]|$)/g;let r,i={};for(var s=!1,c="";null!==(r=l.exec(e));){const e=r[1],t=r[2].trim();s||e.length>3&&(s=!0,c=e),i[e]=`${e}\n${t}`}if(!s)return e;const g=function e(t){let n=[];const o=/\(([^\)]+)\)(\d*)|([A-Z])(\d*)/g;let a;for(;null!==(a=o.exec(t));)if(a[3]){const e=a[3],t=parseInt(a[4],10)||1;for(let o=0;o<t;o++)n.push(e)}else if(a[1]){const t=a[1],o=parseInt(a[2],10)||1,l=e(t);for(let e=0;e<o;e++)n=n.concat(l)}return n}(a);let d=[];if(s&&i[c]){var u=stripNewlineIfSingleLine(i[c]);d.push(u)}return g.forEach(e=>{var t="P:"+e;i[t]&&d.push(i[t])}),n+d.join("\n")}function findMissingCustomInstrumentIndices(e){if(!e||!gCustomInstrumentSamples)return[];const t=new Set,n=/^%%MIDI\s+(program|bassprog|chordprog)\s+custom([1-8])\b/gim,o=/^%%MIDI\s+(program|bassprog|chordprog)\s+(15[0-7])\b/gim,a=/\[I:MIDI=(program|bassprog|chordprog)\s+custom([1-8])\]/gim,l=/\[I:MIDI (program|bassprog|chordprog)\s+custom([1-8])\]/gim;let r;for(;null!==(r=n.exec(e));){const e=parseInt(r[2],10);t.add(e)}for(;null!==(r=o.exec(e));){const e=parseInt(r[2],10)-149;e>=1&&e<=8&&t.add(e)}for(;null!==(r=a.exec(e));){const e=parseInt(r[2],10);t.add(e)}for(;null!==(r=l.exec(e));){const e=parseInt(r[2],10);t.add(e)}const i=[];for(const e of t){const t=gCustomInstrumentSamples[e];(null==t||Array.isArray(t)&&0===t.length)&&i.push(e)}return i.sort((e,t)=>e-t),i}function generateCustomInstrumentAlertMessage(e){if(!e||0===e.length)return null;const t=Array.from(new Set(e)).sort((e,t)=>e-t).map(e=>`custom${e}`),n=t.length>1;return`\n    <div style="font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif; line-height:1.6; font-size:1.1rem;">\n      <h3 style="margin:0 0 .5em; font-size:1.5rem; color:#111; text-align:center;">\n        ${n?"Custom Instruments Required":"Custom Instrument Required"}\n      </h3>\n\n      <p style="margin:.6em 0;font-size:1.05rem;">\n        One or more custom instruments are specified in the tune, but no instrument${n?"s are":" is"} currently loaded for:\n      </p>\n\n      <ul style="margin:.5em 0 1em 1.4em; padding:0; font-size:1.05rem;">\n        ${t.map(e=>`<li><code>${e}</code></li>`).join("")}\n      </ul>\n\n      <p style="margin:.6em 0;font-size:1.05rem;">To resolve this, please load the required custom instrument${n?"s":""} by either:</p>\n      <ol style="margin:.5em 0 1em 1.4em; padding:0; font-size:1.05rem;">\n        <li>Load ${n?"them":"it"} from the <strong>Player Instrument Settings</strong> dialog, or</li>\n        <li>Close the Player, then drag-and-drop the custom instrument${n?"s":""} onto the work area.</li>\n      </ol>\n\n      <p style="margin:.6em 0;font-size:1.05rem;">After loading the custom instrument${n?"s":""}, assign ${n?"them":"it"} to the missing custom instrument slot${n?"s":""}.</p>\n\n      <p style="margin:.6em 0; font-size:1.05rem;">\n        <em>Until ${n?"these custom instruments are":"this custom instrument is"} loaded, ${n?"they will":"it will"} produce no sound.</em>\n      </p>\n    </div>\n  `}function verifyCustomInstrumentsLoaded(e){const t=findMissingCustomInstrumentIndices(e);if(t&&0!=t.length){var n=generateCustomInstrumentAlertMessage(t);n&&DayPilot.Modal.alert(n,{theme:"modal_flat",top:100,scrollWithPage:AllowDialogsToScroll()})}}function PreProcessPlayABC(e){var t=GetABCFileHeader(),n=(a=/^%hide_first_title_on_play.*$/gm).test(e);(n||(n=a.test(t)),n&&(e=removeFirstTitleLine(e)),gAlwaysFlattenParts)?e=flattenABCParts(e):(a=/^%play_flatten_parts.*$/gm).test(e)&&(e=flattenABCParts(e));gAllowLowercaseChords=!1,(a=/^%allow_lowercase_chords.*$/gm).test(e)&&(gAllowLowercaseChords=!0),e=processAllStripping(e);var o=!1;if(gOverridePlayMIDIParams&&(e=OverrideOneTuneMIDIParams(e,gDefaultSoundFont,gTheMelodyProgram,gTheBassProgram,gTheChordProgram,gTheBassVolume,gTheChordVolume),o=!0),gAlwaysInjectPrograms){var a=/^%%MIDI chordprog.*$/m,l=e.match(a),r=!1;l&&l.length>0||(r=!0,e=InjectOneTuneMIDIProgramAboveTune(e,gTheChordProgram,!1,!0));a=/^%%MIDI bassprog.*$/m;var i=e.match(a);if(!(i&&i.length>0))if(o)e=InjectOneTuneMIDIProgramAboveTune(e,gTheBassProgram,!0,!1);else if(r)e=InjectOneTuneMIDIProgramAboveTune(e,gTheBassProgram,!0,!1);else{var s=l[0].replace("%%MIDI chordprog","");theBassProgam=s.trim(),e=InjectOneTuneMIDIProgramAboveTune(e,s,!0,!1)}a=/^%%MIDI program.*$/m;var c=e.match(a);c&&c.length>0||(e=InjectOneTuneMIDIProgramAboveTune(e,gTheMelodyProgram,!1,!1))}if(gAlwaysInjectVolumes){a=/^%%MIDI bassvol.*$/m;var g=e.match(a);g&&g.length>0||(e=InjectOneTuneMIDIVolumeAboveTune(e,gTheBassVolume,!1));a=/^%%MIDI chordvol.*$/m;var d=e.match(a);d&&d.length>0||(e=InjectOneTuneMIDIVolumeAboveTune(e,gTheChordVolume,!0))}if(gReverbString&&""!=gReverbString){a=/^%reverb.*$/m;var u=e.match(a);u&&u.length>0||(e=InjectReverbAboveTune(e,gReverbString))}var m=e.indexOf("%incipits_inject_start");if(-1!=m){var p=e.substring(0,m),h="%incipits_inject_end",f=e.indexOf(h);f+=21,p+=e.substring(f,e.length),e=p}(gUseGChord=!1,(a=/%%MIDI gchord\b/).test(e)&&(gUseGChord=!0),gUseGChord)||(a=/\[I:\s*MIDI[\s=]+gchord\s.*\]/).test(e)&&(gUseGChord=!0);e=e.replace(/%%titlespace\s.*\r?\n/g,""),(a=/^%hide_vskip_on_play.*$/gm).test(e=t+e)&&(e=removeVskipLines(e)),(a=/^%hide_player_part_tags.*$/gm).test(e)&&(e=removeAllPLines(e));return e=(e=(e=e.replace(/^(\s*%%MIDI\s+program\s+)custom(\s*)$/gim,"$1custom1$2")).replace("%custom_instrument_volume_scale","%custom_instrument_1_volume_scale")).replace("%custom_instrument_fade","%custom_instrument_1_fade"),gAllowLoopStateCaching=!0,e}function tuneIsHornpipe(e){var t=/^R:Hornpipe.*$/gm,n=e.match(t);return!!(n&&n.length>0)||(t=/^R: Hornpipe.*$/gm,!!((n=e.match(t))&&n.length>0)||(t=/^R:hornpipe.*$/gm,!!((n=e.match(t))&&n.length>0)||(t=/^R: hornpipe.*$/gm,!!((n=e.match(t))&&n.length>0))))}function validate_roll_2_params(e,t){var n=e.split(" ");if(n&&8!=n.length)return!1;var o=n[0],a=n[1],l=n[2],r=n[3],i=n[4],s=n[5],c=n[6],g=n[7];return o=parseFloat(o),a=parseFloat(a),l=parseFloat(l),r=parseFloat(r),i=parseFloat(i),s=parseFloat(s),c=parseFloat(c),g=parseFloat(g),!(isNaN(o)||isNaN(a)||isNaN(l)||isNaN(r)||isNaN(i)||isNaN(s)||isNaN(c)||isNaN(g))&&(o>=0&&a>=0&&l>=0&&l<=1&&r>=0&&r<=1&&i>=0&&i<=1&&s>=0&&s<=2&&c>=0&&c<=2&&g>=0&&g<=2&&o+a<3&&(t&&(gRoll2Duration1=o,gRoll2Duration2=a,gRoll2Fraction1=l,gRoll2Fraction2=r,gRoll2Fraction3=i,gRoll2Volume1=s,gRoll2Volume2=c,gRoll2Volume3=g),!0))}function validate_roll_3_params(e,t){var n=e.split(" ");if(n&&8!=n.length)return!1;var o=n[0],a=n[1],l=n[2],r=n[3],i=n[4],s=n[5],c=n[6],g=n[7];return o=parseFloat(o),a=parseFloat(a),l=parseFloat(l),r=parseFloat(r),i=parseFloat(i),s=parseFloat(s),c=parseFloat(c),g=parseFloat(g),isNaN(o)||isNaN(a)||isNaN(l)||isNaN(r)||isNaN(i)||isNaN(s)||isNaN(c)||isNaN(g)?(console.log("roll3 validation fail2"),!1):o>=0&&a>=0&&l>=0&&l<=1&&r>=0&&r<=1&&i>=0&&i<=1&&s>=0&&s<=2&&c>=0&&c<=2&&g>=0&&g<=2&&o+a<3&&(t&&(gRoll3Duration1=o,gRoll3Duration2=a,gRoll3Fraction1=l,gRoll3Fraction2=r,gRoll3Fraction3=i,gRoll3Volume1=s,gRoll3Volume2=c,gRoll3Volume3=g),!0)}function ScanTuneForCustomTimingInjection(e){var t,n;if((gAddSwing=!1,gAddABCJSSwing=!1,gSwingFactor=gAutoSwingFactor,gAutoSwingHornpipes&&(gAddSwing=tuneIsHornpipe(e)),t=/^%swing.*$/gm,(n=e.match(t))&&n.length>0)&&(gAddSwing=!0,(A=n[0].replace("%swing","").trim().split(" ")).length>=1)){var o=A[0],a=parseFloat(o);isNaN(a)||(gSwingFactor=a)}t=/^%noswing.*$/gm,(n=e.match(t))&&n.length>0&&(gAddSwing=!1),t=/^%swing_offset.*$/gm;var l=e.match(t);if((gSwingOffset=0,l&&l.length>0)&&(A=l[0].replace("%swing_offset","").trim().split(" ")).length>=1){var r=A[0],i=parseInt(r);isNaN(i)||i>=0&&i<=16&&(gSwingOffset=i)}t=/^%grace_duration_ms.*$/gm;var s=e.match(t);if((gGraceDuration=.045,s&&s.length>0)&&(A=s[0].replace("%grace_duration_ms","").trim().split(" ")).length>=1){var c=A[0],g=parseInt(c);isNaN(g)||g>=0&&g<=150&&(gGraceDuration=g/1e3)}gGraceMissingTempo=!0,t=/^Q:.*$/gm;var d=e.match(t);d&&d.length>0&&(gGraceMissingTempo=!1),gGraceTuneType=getTuneRhythmType(e),validate_roll_2_params(gRoll2DefaultParams,!0)||(gRoll2Duration1=.95,gRoll2Duration2=.8,gRoll2Fraction1=1,gRoll2Fraction2=.75,gRoll2Fraction3=.9,gRoll2Volume1=1,gRoll2Volume2=.75,gRoll2Volume3=1),t=/^%roll_2_params.*$/gm;var u=e.match(t);u&&u.length>0&&validate_roll_2_params(u[0].replace("%roll_2_params","").trim(),!0);validate_roll_3_params(gRoll3DefaultParams,!0)||(gRoll3Duration1=1.45,gRoll3Duration2=.6,gRoll3Fraction1=1,gRoll3Fraction2=.75,gRoll3Fraction3=.9,gRoll3Volume1=1,gRoll3Volume2=.75,gRoll3Volume3=1),t=/^%roll_3_params.*$/gm;var m=e.match(t);m&&m.length>0&&validate_roll_3_params(m[0].replace("%roll_3_params","").trim(),!0);gRollUseOriginalRollSolution=!1,t=/^%use_original_abcjs_roll_solution.*$/gm;var p=e.match(t);p&&p.length>0&&(gRollUseOriginalRollSolution=!0),gOrnamentDivider=32,t=/^%ornament_divider.*$/gm;var h=e.match(t);if(h&&h.length>0&&(A=h[0].replace("%ornament_divider","").trim().split(" ")).length>=1){var f=A[0],b=parseFloat(f);isNaN(b)||b>=2&&b<=256&&(gOrnamentDivider=b)}gOrnamentOffset=2,t=/^%ornament_offset.*$/gm;var y=e.match(t);if(y&&y.length>0&&(A=y[0].replace("%ornament_offset","").trim().split(" ")).length>=1){var T=A[0],I=parseInt(T);isNaN(I)||I>=0&&(gOrnamentOffset=I)}gTremoloDivider=0,t=/^%tremolo_divider.*$/gm;var A,S=e.match(t);if(S&&S.length>0&&(A=S[0].replace("%tremolo_divider","").trim().split(" ")).length>=1){var C=A[0],v=parseFloat(C);isNaN(v)||v>=2&&v<=256&&(gTremoloDivider=v)}}function ScanTuneForSoundFont(e){var t=null,n="%abcjs_soundfont",o=!1,a=/^%abcjs_soundfont.*$/gm,l=e.match(a);return l&&l.length>0?o=!0:(a=/^%soundfont.*$/gm,(l=e.match(a))&&l.length>0&&(o=!0,n="%soundfont")),o&&(t=(t=(t=l[l.length-1].replace(n,"")).trim()).toLowerCase()),t}function ScanTuneForGMOverride(e){var t=gOverrideCustomGMSounds,n=gCustomGMSoundsOverride;gOverrideCustomGMSounds=!1,gCustomGMSoundsOverride=!1;var o=null,a=e.match(/^%use_custom_gm_sounds.*$/gm);a&&a.length>0&&("true"==(o=(o=(o=a[a.length-1].replace("%use_custom_gm_sounds","")).trim()).toLowerCase())&&(gOverrideCustomGMSounds=!0,gCustomGMSoundsOverride=!0),"false"==o&&(gOverrideCustomGMSounds=!0,gCustomGMSoundsOverride=!1)),gOverrideCustomGMSounds==t&&n==gCustomGMSoundsOverride||(gSoundsCacheABCJS={})}function ScanTuneForBodhranPitch(e){var t=null,n=/^%bodhran_tuning.*$/gm,o=e.match(n);return o&&o.length>0&&(t=(t=(t=o[o.length-1].replace("%bodhran_tuning","")).trim()).toLowerCase()),t||(n=/^%bodhran_pitch.*$/gm,(o=e.match(n))&&o.length>0&&(t=(t=(t=o[o.length-1].replace("%bodhran_pitch","")).trim()).toLowerCase())),t}function ScanTuneForBanjoStyle(e){var t=null,n=e.match(/^%banjo_style.*$/gm);switch(n&&n.length>0&&(t=(t=n[n.length-1].replace("%banjo_style","")).trim()),t){case"0":case"1":case"2":case"3":case"4":break;default:return null}return t}function ScanTuneForV1OnlyHighlight(e){var t=e.match(/^%play_highlight_v1_only.*$/gm);return!!(t&&t.length>0)}function ScanTuneForDisablePlayHighlight(e){var t=e.match(/^%disable_play_highlight.*$/gm);return!!(t&&t.length>0)}function ScanTuneForForceIrishRoll(e){var t=e.match(/^%irish_rolls_on.*$/gm);return!!(t&&t.length>0)}function ScanTuneForForceIrishRollDisable(e){var t=e.match(/^%irish_rolls_off.*$/gm);return!!(t&&t.length>0)}function ScanTuneForVoiceTuning(e){var t=e.match(/^%voice_tuning_cents.*$/gm);if(t&&t.length>0){var n=t[0].replace("%voice_tuning_cents",""),o=(n=n.match(/(?:^|\s)(-?\d+(?:\.\d+)?)(?=\s|$)/g)).length;if(o>0){var a,l,r=[];for(a=0;a<o;++a)l=parseFloat(n[a]),isNaN(l)?r.push(0):r.push(l);return r}return null}return null}function ScanTuneForTabFirstStaffOnly(e,t){if("whistle"==t||"recorder"==t||"notenames"==t)return!1;var n=e.match(/^%tab_first_voice_only.*$/gm);return!!(n&&n.length>0)}function ScanTuneForTabSecondStaffOnly(e,t){if("whistle"==t||"recorder"==t||"notenames"==t)return!1;var n=e.match(/^%tab_first_voice_exclude.*$/gm);return!!(n&&n.length>0)}function ScanTuneForReverb(e){if(gSamplesOnline||gAllowOfflineInstruments){var t=["room","room1","room2","room3","chamber","chamber1","chamber2","chamber3","hall","hall1","hall2","hall3","church","church1","custom"];gEnableReverb=!1;var n=e.match(/^%reverb.*$/gm);if(n&&n.length>0){var o,a,l,r=!1,i=!1,s=!1,c=n[0].replace("%reverb",""),g=(c=c.trim()).match(/[a-zA-Z0-9.]+/g);if(g&&g.length>0){if(g.length>=1){o=(o=g[0]).trim();for(var d=0;d<t.length;++d)if(o==t[d]){r=!0;break}}if(g.length>=2&&(a=(a=g[1]).trim(),a=parseFloat(a),!isNaN(a)&&a>=0&&(i=!0)),g.length>=3&&(l=(l=g[2]).trim(),l=parseFloat(l),!isNaN(l)&&l>=0&&(s=!0)),r&&i&&s){var u=gReverbStyle;gEnableReverb=!0,gReverbStyle=o,gReverbDry=a,gReverbWet=l,gReverbStyle!=u&&(gSoundsCacheABCJS={})}}}}}function SwingExplorer(){if(gAllowCopy){deactivateQuickPlayer();var e=findSelectedTune();if(""==e)return;SwingExplorerDialog(e,PreProcessPlayABC(e),!1)}}function SwingExplorerRegenerate(){var e=!1,t=document.getElementById("swing_explorer_factor").value;t=parseFloat(t),!isNaN(t)&&t>=-.9&&t<=.9&&(gSwingFactor=t,e=!0);var n=document.getElementById("swing_explorer_offset").value;n=parseInt(n),!isNaN(n)&&n>=0&&n<=16&&(gSwingOffset=n,e=!0),e&&(gTheOKButton.click(),setTimeout(function(){SwingExplorerDialog(gPlayerABCSwingExplorerOriginal,gPlayerABCSwingExplorerProcessed,!0)},250))}function ScanTuneForSwingExplorer(e){var t,n;if((gAddSwing=!0,gSwingFactor=0,gAutoSwingHornpipes&&tuneIsHornpipe(e)&&(gSwingFactor=gAutoSwingFactor),t=/^%swing.*$/gm,(n=e.match(t))&&n.length>0)&&(l=n[0].replace("%swing","").trim().split(" ")).length>=1){var o=l[0],a=parseFloat(o);isNaN(a)||(gSwingFactor=a)}t=/^%swing_offset.*$/gm;var l,r=e.match(t);if((gSwingOffset=0,r&&r.length>0)&&(l=r[0].replace("%swing_offset","").trim().split(" ")).length>=1){var i=l[0],s=parseInt(i);isNaN(s)||s>=0&&s<=16&&(gSwingOffset=s)}}function SwingExplorerInject(){var e=!1,t=!1,n=document.getElementById("swing_explorer_factor").value;n=parseFloat(n),!isNaN(n)&&n>=-.9&&n<=.9&&(e=!0);var o=document.getElementById("swing_explorer_offset").value;if(o=parseInt(o),!isNaN(o)&&o>=0&&o<=16&&(t=!0),e||t){if(e){var a="%swing "+n,l=/^%swing.*[\r\n]*/gm,r=gPlayerABCSwingExplorerOriginal.replaceAll(l,"");tuneWithSwing=InjectStringBelowTuneHeader(r,a)}if(t){a="%swing_offset "+o,l=/^%swing_offset.*[\r\n]*/gm;if(e){var i=tuneWithSwing.replaceAll(l,"");tuneWithSwing=InjectStringBelowTuneHeader(i,a)}else{r=gPlayerABCSwingExplorerOriginal.replaceAll(l,"");tuneWithSwing=InjectStringBelowTuneHeader(r,a)}}var s;tuneWithSwing=tuneWithSwing.replace("\n\n",""),s=gEnableSyntax?gTheCM.selectionStart:gTheABC.selectionStart;var c=getABCEditorText();if(setABCEditorText(c=c.replace(gPlayerABCSwingExplorerOriginal,tuneWithSwing)),gIsDirty=!0,gPlayerABCSwingExplorerOriginal=tuneWithSwing,gRawMode)RenderAsync(!0,null,function(){DayPilot.Modal.alert('<p style="text-align:center;font-size:14pt;font-family:helvetica;">Swing Injection Complete!</p>',{theme:"modal_flat",top:300,width:500,scrollWithPage:AllowDialogsToScroll()}).then(function(){gEnableSyntax?(gTheCM.selectionStart=s,gTheCM.selectionEnd=s):(gTheABC.selectionStart=s,gTheABC.selectionEnd=s),FocusAfterOperation()})});else{DayPilot.Modal.alert('<p style="text-align:center;font-size:14pt;font-family:helvetica;">Swing Injection Complete!</p>',{theme:"modal_flat",top:300,width:500,scrollWithPage:AllowDialogsToScroll()}).then(function(){gEnableSyntax?(gTheCM.selectionStart=s,gTheCM.selectionEnd=s):(gTheABC.selectionStart=s,gTheABC.selectionEnd=s),FocusAfterOperation()})}}}var gPlayerABCSwingExplorerOriginal=null,gPlayerABCSwingExplorerProcessed=null;function SwingExplorerDialog(e,t,n){if(sendGoogleAnalytics("dialog","SwingExplorerDialog"),gMIDIbuffer=null,gTheOKButton=null,n||(gPlayerABCSwingExplorerOriginal=e,gPlayerABCSwingExplorerProcessed=t),PlayerSetupCommon(t)){n||(ScanTuneForCustomTimingInjection(t),ScanTuneForSwingExplorer(t));var o=GetRadioValue("notenodertab"),a=GetABCJSParams(o);a.oneSvgPerLine=!1,"noten"!=o&&a.tablature&&a.tablature.length>0&&(a.tablature[0].label="");var l,r=new CursorControl;if(gIsIOS){var i=ABCJS.synth.activeAudioContext();gTheMuteHandle=null,i&&(gTheMuteHandle=unmute(i,!1,!1))}!function(){gLoopCallback=null,gStartPlayCallback=null,gPreStartPlayCallback=null,gPlayerInPause=!1;var e=window.innerHeight-400;modal_msg='<div id="playerholder" style="height:'+e+'px;overflow-y:auto;margin-bottom:15px;">',modal_msg+=gLargePlayerControls?'<div id="abcplayer" class="abcjs-large">':'<div id="abcplayer">',modal_msg+='<div id="playback-paper"></div>',modal_msg+="</div>",modal_msg+="</div>",modal_msg+=gLargePlayerControls?'<div id="playback-audio" class="abcjs-large"></div>':'<div id="playback-audio"></div>',isMobileBrowser()?(modal_msg+='<p class="configure_swingexplorer_text_mobile" style="text-align:center;margin:0px;margin-top:22px">',modal_msg+='Swing factor: <input style="width:80px;" id="swing_explorer_factor" type="number" min="-0.9" step="0.05" max=".9" title="Swing factor, range is -0.9 to 0.9" autocomplete="off"/>',modal_msg+='&nbsp;&nbsp;Swing offset: <input style="width:90px;" id="swing_explorer_offset" type="number" min="0" step="1" max="16" title="Swing offset in eighth notes, range is 0 to 16" autocomplete="off"/>',modal_msg+="</p>",modal_msg+='<p class="configure_swingexplorer_text_mobile" style="text-align:center;margin:0px;margin-top:22px">',modal_msg+='<input id="swingexplorertest" class="swingexplorertest button btn btn-swingexplorertest" onclick="SwingExplorerRegenerate();" type="button" value="Reload Tune with Changed Swing Settings" title="Reloads the tune into the player with the entered swing factor">',modal_msg+='<input id="swingexplorerinject" class="swingexplorerinject button btn btn-swingexplorerinject" onclick="SwingExplorerInject();" type="button" style="margin-right:0px;" value="Inject Swing into the ABC" title="Injects the current swing factor into the tune ABC">',modal_msg+="</p>",modal_msg+='<a id="swingexplorerhelp" href="https://michaeleskin.com/abctools/userguide.html#swing_explorer" target="_blank" style="text-decoration:none;" title="Learn more about the Swing Explorer" class="dialogcornerbutton">?</a>'):(modal_msg+='<p class="configure_swingexplorer_text" style="text-align:center;margin:0px;margin-top:22px">',modal_msg+='Swing factor (range is -0.9 to 0.9): <input style="width:90px;" id="swing_explorer_factor" type="number" min="-0.9" step="0.05" max=".9" title="Swing factor, range is -0.9 to 0.9" autocomplete="off"/>',modal_msg+='&nbsp;&nbsp;Swing offset in eighth notes (range is 0 to 16): <input style="width:90px;" id="swing_explorer_offset" type="number" min="0" step="1" max="16" title="Swing offset in eighth notes, range is 0 to 16" autocomplete="off"/>',modal_msg+="</p>",modal_msg+='<p class="configure_swingexplorer_text" style="text-align:center;margin:0px;margin-top:22px">',modal_msg+='<input id="swingexplorertest" class="swingexplorertest button btn btn-swingexplorertest" onclick="SwingExplorerRegenerate();" type="button" value="Reload Tune with Changed Swing Settings" title="Reloads the tune into the player with the entered swing factor and offset">',modal_msg+='<input id="swingexplorerinject" class="swingexplorerinject button btn btn-swingexplorerinject" onclick="SwingExplorerInject();" type="button" style="margin-right:0px;" value="Inject Swing into the ABC" title="Injects the current swing factor and offset into the tune ABC">',modal_msg+="</p>",modal_msg+='<a id="swingexplorerhelp" href="https://michaeleskin.com/abctools/userguide.html#swing_explorer" target="_blank" style="text-decoration:none;" title="Learn more about the Swing Explorer" class="dialogcornerbutton">?</a>');var n,o=window.innerWidth;GetRadioValue("notenodertab"),isDesktopBrowser()?(n=giPadTwoColumn?isLandscapeOrientation()?o*(gPlayerScaling/100):.9*o:o*(gPlayerScaling/100))<850&&(n=850):n=800,DayPilot.Modal.alert(modal_msg,{theme:"modal_flat",top:50,width:n,okText:"Close",scrollWithPage:isMobileBrowser()}),document.getElementById("swing_explorer_factor").value=gSwingFactor,document.getElementById("swing_explorer_offset").value=gSwingOffset;for(var a=document.getElementsByClassName("modal_flat_ok"),i=null,c=0;c<a.length;++c)if("Close"==(i=a[c]).innerText){gTheOKButton=i;var g=i.onclick;i.onclick=function(){g(),gSynthControl=null,l&&(l.destroy(),l=null),FocusAfterOperation(),gIsIOS&&gTheMuteHandle&&(gTheMuteHandle.dispose(),gTheMuteHandle=null)};break}ABCJS.synth.supportsAudio()?(l=new ABCJS.synth.SynthController(t)).load("#playback-audio",r,{displayLoop:!0,displayRestart:!0,displayPlay:!0,displayProgress:!0,displayWarp:!0}):document.querySelector("#playback-audio").innerHTML="<div class='audio-error'>Audio is not supported in this browser.</div>",s(!1),gPlayerHolder=document.getElementById("playerholder"),gPlayerContainerRect=gPlayerHolder.getBoundingClientRect()}()}function s(e){l.disable(!0);var n=ABCJS.renderAbc("playback-paper",t,a)[0];postProcessTab([n],"playback-paper",o,!0);var r=new ABCJS.synth.CreateSynth(t);gMIDIbuffer=r,gMIDIInitStillWaiting=!1,SetupPlayerEventHandlers(),r.init({visualObj:n}).then(function(o){if(l){var a=computeFade(t);l.setTune(n,e,{fadeLength:a}).then(function(e){if(console.log("Audio successfully loaded."),verifyCustomInstrumentsLoaded(t),gSynthControl=l,(n=document.getElementsByClassName("abcjs-midi-tempo"))&&n.length>0&&(n[0].onclick=SetPlayerTempo),gTrainerTouchControls){var n,o=document.getElementsByClassName("abcjs-midi-clock"),a=document.getElementsByClassName("abcjs-midi-current-tempo-wrapper");if(o&&a&&o.length>0&&a.length>0)(n=o[0]).onclick=DecrementTempo,(n=a[0]).onclick=IncrementTempo}}).catch(function(e){hideTheSpinner(),gMIDIInitStillWaiting=!1,console.log("Problem loading audio for this tune")})}}).catch(function(e){hideTheSpinner(),gMIDIInitStillWaiting=!1,console.log("Problem loading audio for this tune")})}}function ReverbExplorer(){if(gAllowCopy){deactivateQuickPlayer();var e=findSelectedTune();if(""==e)return;ReverbExplorerDialog(e,PreProcessPlayABC(e),!1)}}function ReverbExplorerRegenerate(){gReverbExplorerStyle=document.getElementById("reverb_explorer_settings").value,gReverbExplorerDry=document.getElementById("reverb_explorer_dry").value,gReverbExplorerWet=document.getElementById("reverb_explorer_wet").value,gTheOKButton.click(),setTimeout(function(){ReverbExplorerDialog(gPlayerReverbExplorerOriginal,gPlayerReverbExplorerProcessed,!0)},250)}function ScanTuneForReverbExplorer(e){var t=["off","room","room1","room2","room3","chamber","chamber1","chamber2","chamber3","hall","hall1","hall2","hall3","church","church1","custom"],n=e.match(/^%reverb.*$/gm);if(gReverbExplorerDry=1,gReverbExplorerWet=0,gReverbExplorerStyle=0,n&&n.length>0){var o,a,l,r=!1,i=!1,s=!1,c=!1,g=n[0].replace("%reverb",""),d=(g=g.trim()).match(/[a-zA-Z0-9.]+/g);if(d&&d.length>0){if(d.length>=1){o=(o=d[0]).trim();for(var u=0;u<t.length;++u)if(o==t[u]){r=!0;break}}if(d.length>=2&&(a=(a=d[1]).trim(),a=parseFloat(a),!isNaN(a)&&a>=0&&(i=!0)),d.length>=3&&(l=(l=d[2]).trim(),l=parseFloat(l),!isNaN(l)&&l>=0&&(s=!0)),"off"==o&&(c=!0,a=1,l=0),c||r&&i&&s)switch(gReverbExplorerDry=a,gReverbExplorerWet=l,o){case"off":default:gReverbExplorerStyle=0;break;case"room":gReverbExplorerStyle=1;break;case"room1":gReverbExplorerStyle=2;break;case"room2":gReverbExplorerStyle=3;break;case"room3":gReverbExplorerStyle=4;break;case"chamber":gReverbExplorerStyle=5;break;case"chamber1":gReverbExplorerStyle=6;break;case"chamber2":gReverbExplorerStyle=7;break;case"chamber3":gReverbExplorerStyle=8;break;case"hall":gReverbExplorerStyle=9;break;case"hall1":gReverbExplorerStyle=10;break;case"hall2":gReverbExplorerStyle=11;break;case"hall3":gReverbExplorerStyle=12;break;case"church":gReverbExplorerStyle=13;break;case"church1":gReverbExplorerStyle=14;break;case"custom":gReverbExplorerStyle=15}}}}function ReverbExplorerInject(){var e=document.getElementById("reverb_explorer_settings").value,t=!1;"off"==(e=(e=(e=reverbSettingsNames[e]).replace(" ","")).toLowerCase())&&(t=!0);var n=!1,o=document.getElementById("reverb_explorer_dry").value;o=parseFloat(o),!isNaN(o)&&o>=0&&o<=10&&(n=!0);var a=!1,l=document.getElementById("reverb_explorer_wet").value;if(l=parseFloat(l),!isNaN(l)&&l>=0&&l<=10&&(a=!0),t||n&&a){var r;r=t?"%reverb off":"%reverb "+e+" "+o+" "+l;var i,s=InjectStringBelowTuneHeader(gPlayerReverbExplorerOriginal.replaceAll(/^%reverb.*[\r\n]*/gm,""),r);s=s.replace("\n\n",""),i=gEnableSyntax?gTheCM.selectionStart:gTheABC.selectionStart;var c=getABCEditorText();if(setABCEditorText(c=c.replace(gPlayerReverbExplorerOriginal,s)),gIsDirty=!0,gPlayerReverbExplorerOriginal=s,gRawMode)RenderAsync(!0,null,function(){DayPilot.Modal.alert('<p style="text-align:center;font-size:14pt;font-family:helvetica;">Reverb Injection Complete!</p>',{theme:"modal_flat",top:300,width:500,scrollWithPage:AllowDialogsToScroll()}).then(function(){gEnableSyntax?(gTheCM.selectionStart=i,gTheCM.selectionEnd=i):(gTheABC.selectionStart=i,gTheABC.selectionEnd=i),FocusAfterOperation()})});else{DayPilot.Modal.alert('<p style="text-align:center;font-size:14pt;font-family:helvetica;">Reverb Injection Complete!</p>',{theme:"modal_flat",top:300,width:500,scrollWithPage:AllowDialogsToScroll()}).then(function(){gEnableSyntax?(gTheCM.selectionStart=i,gTheCM.selectionEnd=i):(gTheABC.selectionStart=i,gTheABC.selectionEnd=i),FocusAfterOperation()})}}}function ReverbExplorerDialogInjectThisTune(e){var t=!1,n=reverbSettingsNames[gReverbExplorerStyle];"off"==(n=(n=n.replace(" ","")).toLowerCase())&&(t=!0),theInjectString=t?"%reverb off":"%reverb "+n+" "+gReverbExplorerDry+" "+gReverbExplorerWet;return e=(e=InjectStringBelowTuneHeader(e=e.replaceAll(/^%reverb.*[\r\n]*/gm,""),theInjectString)).replace("\n\n","")}var gReverbExplorerStyle=0,gReverbExplorerDry=0,gReverbExplorerWet=0,gPlayerReverbExplorerOriginal=null,gPlayerReverbExplorerProcessed=null,gReverbExplorerSettings=null;const reverbSettingsNames=["Off","Room","Room 1","Room 2","Room 3","Chamber","Chamber 1","Chamber 2","Chamber 3","Hall","Hall 1","Hall 2","Hall 3","Church","Church 1","Custom"];function idleReverbExplorer(){idleAdvancedSettings()}function ReverbExplorerDialog(e,t,n){if(sendGoogleAnalytics("dialog","ReverbExplorerDialog"),gMIDIbuffer=null,gTheOKButton=null,n||(gPlayerReverbExplorerOriginal=e,gPlayerReverbExplorerProcessed=t),PlayerSetupCommon(t)){n||(ScanTuneForCustomTimingInjection(t),ScanTuneForReverbExplorer(t)),gReverbExplorerSettings||(gReverbExplorerSettings=InstrumentExplorerBuildDropdown("reverb_explorer_settings",reverbSettingsNames)),ScanTuneForReverb(t=ReverbExplorerDialogInjectThisTune(gPlayerReverbExplorerProcessed));var o=GetRadioValue("notenodertab"),a=GetABCJSParams(o);a.oneSvgPerLine=!1,"noten"!=o&&a.tablature&&a.tablature.length>0&&(a.tablature[0].label="");var l,r=new CursorControl;if(gIsIOS){var i=ABCJS.synth.activeAudioContext();gTheMuteHandle=null,i&&(gTheMuteHandle=unmute(i,!1,!1))}!function(){gLoopCallback=null,gStartPlayCallback=null,gPreStartPlayCallback=null,gPlayerInPause=!1;var e=window.innerHeight-400;modal_msg='<div id="playerholder" style="height:'+e+'px;overflow-y:auto;margin-bottom:15px;">',modal_msg+=gLargePlayerControls?'<div id="abcplayer" class="abcjs-large">':'<div id="abcplayer">',modal_msg+='<div id="playback-paper"></div>',modal_msg+="</div>",modal_msg+="</div>",modal_msg+=gLargePlayerControls?'<div id="playback-audio" class="abcjs-large"></div>':'<div id="playback-audio"></div>',isMobileBrowser()?(modal_msg+='<p class="configure_reverbexplorer_text_mobile" style="text-align:center;margin:0px;margin-top:22px">',modal_msg+="Reverb style:"+gReverbExplorerSettings,modal_msg+='&nbsp;&nbsp;&nbsp;Dry signal fraction: <input style="width:80px;" id="reverb_explorer_dry" type="number" min="0" step="0.05" max="5" title="How much of the original sound gets mixed in" autocomplete="off"/>',modal_msg+='Wet signal fraction: <input style="width:80px;" id="reverb_explorer_wet" type="number" min="0" step="0.05" max="5" title="How much of the reverb gets mixed in" autocomplete="off"/>',modal_msg+="</p>",modal_msg+='<p class="configure_reverbexplorer_text_mobile" style="text-align:center;margin:0px;margin-top:22px">',modal_msg+='<input id="reverbexplorertest" class="reverbexplorertest button btn btn-reverbexplorertest" onclick="ReverbExplorerRegenerate();" type="button" value="Reload with Changed Reverb Settings" title="Reloads the tune into the player with the entered reverb settings">',modal_msg+='<input id="reverbexplorerinject" class="reverbexplorerinject button btn btn-reverbexplorerinject" onclick="ReverbExplorerInject();" type="button" style="margin-right:24px;" value="Inject Reverb into the ABC" title="Injects the current reverb settings into the tune ABC">',modal_msg+='<label class="loadimpulsebutton btn btn-reverbexplorerinject" for="loadimpulsebutton" title="Load a custom reverb convolution impulse .wav file">Load Custom Reverb Impulse <input type="file" id="loadimpulsebutton"  accept=".wav,.WAV" hidden/></label>',modal_msg+="</p>",modal_msg+='<a id="reverbexplorerhelp" href="https://michaeleskin.com/abctools/userguide.html#reverb_explorer" target="_blank" style="text-decoration:none;" title="Learn more about the Reverb Explorer" class="dialogcornerbutton">?</a>'):(modal_msg+='<p class="configure_reverbexplorer_text" style="text-align:center;margin:0px;margin-top:22px">',modal_msg+="Reverb style:"+gReverbExplorerSettings,modal_msg+='&nbsp;&nbsp;&nbsp;Dry signal fraction: <input style="width:80px;" id="reverb_explorer_dry" type="number" min="0" step="0.05" max="5" title="How much of the original sound gets mixed in" autocomplete="off"/>',modal_msg+='Wet signal fraction: <input style="width:80px;" id="reverb_explorer_wet" type="number" min="0" step="0.05" max="5" title="How much of the reverb gets mixed in" autocomplete="off"/>',modal_msg+="</p>",modal_msg+='<p class="configure_reverbexplorer_text" style="text-align:center;margin:0px;margin-top:22px">',modal_msg+='<input id="reverbexplorertest" class="reverbexplorertest button btn btn-reverbexplorertest" onclick="ReverbExplorerRegenerate();" type="button" value="Reload Tune with Changed Reverb Settings" title="Reloads the tune into the player with the entered reverb settings">',modal_msg+='<input id="reverbexplorerinject" class="reverbexplorerinject button btn btn-reverbexplorerinject" onclick="ReverbExplorerInject();" type="button" style="margin-right:24px;" value="Inject Reverb into the ABC" title="Injects the current reverb settings into the tune ABC">',modal_msg+='<label class="loadimpulsebutton btn btn-reverbexplorerinject" for="loadimpulsebutton" title="Load a custom reverb convolution impulse .wav file">Load Custom Reverb Impulse <input type="file" id="loadimpulsebutton"  accept=".wav,.WAV" hidden/></label>',modal_msg+="</p>",modal_msg+='<a id="reverbexplorerhelp" href="https://michaeleskin.com/abctools/userguide.html#reverb_explorer" target="_blank" style="text-decoration:none;" title="Learn more about the Swing Explorer" class="dialogcornerbutton">?</a>');var n,o=window.innerWidth;GetRadioValue("notenodertab"),isDesktopBrowser()?(n=giPadTwoColumn?isLandscapeOrientation()?o*(gPlayerScaling/100):.9*o:o*(gPlayerScaling/100))<850&&(n=850):n=800,DayPilot.Modal.alert(modal_msg,{theme:"modal_flat",top:50,width:n,okText:"Close",scrollWithPage:isMobileBrowser()}),setTimeout(function(){idleReverbExplorer()},100),document.getElementById("reverb_explorer_dry").value=gReverbExplorerDry,document.getElementById("reverb_explorer_wet").value=gReverbExplorerWet,document.getElementById("reverb_explorer_settings").value=gReverbExplorerStyle;for(var a=document.getElementsByClassName("modal_flat_ok"),i=null,c=0;c<a.length;++c)if("Close"==(i=a[c]).innerText){gTheOKButton=i;var g=i.onclick;i.onclick=function(){g(),gSynthControl=null,l&&(l.destroy(),l=null),FocusAfterOperation(),gIsIOS&&gTheMuteHandle&&(gTheMuteHandle.dispose(),gTheMuteHandle=null)};break}ABCJS.synth.supportsAudio()?(l=new ABCJS.synth.SynthController(t)).load("#playback-audio",r,{displayLoop:!0,displayRestart:!0,displayPlay:!0,displayProgress:!0,displayWarp:!0}):document.querySelector("#playback-audio").innerHTML="<div class='audio-error'>Audio is not supported in this browser.</div>",s(!1),gPlayerHolder=document.getElementById("playerholder"),gPlayerContainerRect=gPlayerHolder.getBoundingClientRect()}()}function s(e){l.disable(!0);var n=ABCJS.renderAbc("playback-paper",t,a)[0];postProcessTab([n],"playback-paper",o,!0);var r=new ABCJS.synth.CreateSynth(t);gMIDIbuffer=r,gMIDIInitStillWaiting=!1,SetupPlayerEventHandlers(),r.init({visualObj:n}).then(function(o){if(l){var a=computeFade(t);l.setTune(n,e,{fadeLength:a}).then(function(e){if(console.log("Audio successfully loaded."),verifyCustomInstrumentsLoaded(t),gSynthControl=l,(n=document.getElementsByClassName("abcjs-midi-tempo"))&&n.length>0&&(n[0].onclick=SetPlayerTempo),gTrainerTouchControls){var n,o=document.getElementsByClassName("abcjs-midi-clock"),a=document.getElementsByClassName("abcjs-midi-current-tempo-wrapper");if(o&&a&&o.length>0&&a.length>0)(n=o[0]).onclick=DecrementTempo,(n=a[0]).onclick=IncrementTempo}}).catch(function(e){hideTheSpinner(),gMIDIInitStillWaiting=!1,console.log("Problem loading audio for this tune")})}}).catch(function(e){hideTheSpinner(),gMIDIInitStillWaiting=!1,console.log("Problem loading audio for this tune")})}}var gInstrumentExplorerMelodyInstruments=null,gInstrumentExplorerBassInstruments=null,gInstrumentExplorerChordInstruments=null,gInstrumentExplorerSoundfonts=null;function InstrumentExplorer(){if(gAllowCopy){deactivateQuickPlayer();var e=findSelectedTune();if(""==e)return;gPlayerABCInstrumentExplorerOriginal=null,gPlayerABCInstrumentExplorerProcessed=null,gPlayerABCInstrumentExplorerInjected=null,gInstrumentExplorerSoundfonts||(gInstrumentExplorerSoundfonts=(gInstrumentExplorerSoundfonts=InstrumentExplorerBuildDropdown("instrument_explorer_soundfont",soundfontNames)).replace("<select ",'<select style="width:130px;" ')),gInstrumentExplorerMelodyInstruments||(gInstrumentExplorerMelodyInstruments=InstrumentExplorerBuildDropdown("instrument_explorer_melody_program",generalMIDISoundNames)),gInstrumentExplorerBassInstruments||(gInstrumentExplorerBassInstruments=InstrumentExplorerBuildDropdown("instrument_explorer_bass_program",generalMIDISoundNames)),gInstrumentExplorerChordInstruments||(gInstrumentExplorerChordInstruments=InstrumentExplorerBuildDropdown("instrument_explorer_chord_program",generalMIDISoundNames)),ScanTuneForCustomTimingInjection(e),ScanTuneForInstrumentExplorer(e),InstrumentExplorerDialog(e,PreProcessTuneInstrumentExplorer(e),!1)}}function InstrumentExplorerBuildDropdown(e,t){for(var n='<select id="'+e+'" name="'+e+'">\n',o=t.length,a=0;a<o;++a)n+='<option value="'+a+'"> '+t[a]+"</option>";return n+="</select>"}function PreProcessTuneInstrumentExplorer(e){var t=/^%abcjs_soundfont.*[\r\n]*/gm;return e=e.replaceAll(t,""),t=/^%soundfont.*[\r\n]*/gm,e=e.replaceAll(t,""),t=/^%%MIDI program.*[\r\n]*/gm,e=e.replaceAll(t,""),t=/^%%MIDI bassprog.*[\r\n]*/gm,e=e.replaceAll(t,""),t=/^%%MIDI chordprog.*[\r\n]*/gm,e=e.replaceAll(t,""),t=/^%%MIDI bassvol.*[\r\n]*/gm,e=e.replaceAll(t,""),t=/^%%MIDI chordvol.*[\r\n]*/gm,e=e.replaceAll(t,"")}function InstrumentExplorerRegenerate(){gInstrumentExplorerSoundfont=document.getElementById("instrument_explorer_soundfont").value,gInstrumentExplorerMelodyInstrument=document.getElementById("instrument_explorer_melody_program").value,gInstrumentExplorerBassInstrument=document.getElementById("instrument_explorer_bass_program").value,gInstrumentExplorerChordInstrument=document.getElementById("instrument_explorer_chord_program").value;var e=document.getElementById("instrument_explorer_bass_volume").value;e=parseInt(e),isNaN(e)||(gInstrumentExplorerBassVolume=e);var t=document.getElementById("instrument_explorer_chord_volume").value;t=parseInt(t),isNaN(t)||(gInstrumentExplorerChordVolume=t),gTheOKButton.click(),setTimeout(function(){InstrumentExplorerDialog(gPlayerABCInstrumentExplorerOriginal,gPlayerABCInstrumentExplorerProcessed,!0)},250)}function ScanTuneForInstrumentExplorer(e){switch(gDefaultSoundFont){case"https://paulrosen.github.io/midi-js-soundfonts/FluidR3_GM/":default:gInstrumentExplorerSoundfont="0";break;case"https://paulrosen.github.io/midi-js-soundfonts/MusyngKite/":gInstrumentExplorerSoundfont="1";break;case"https://michaeleskin.com/abctools/soundfonts/fatboy_4/":gInstrumentExplorerSoundfont="2";break;case"https://michaeleskin.com/abctools/soundfonts/canvas/":gInstrumentExplorerSoundfont="3";break;case"https://michaeleskin.com/abctools/soundfonts/mscore_2/":gInstrumentExplorerSoundfont="4";break;case"https://michaeleskin.com/abctools/soundfonts/arachno_3/":gInstrumentExplorerSoundfont="5";break;case"https://michaeleskin.com/abctools/soundfonts/fluidhq_1/":gInstrumentExplorerSoundfont="6"}var t,n;gInstrumentExplorerMelodyInstrument=""+(gInstrumentExplorerMelodyInstrument="158"==gTheMelodyProgram?0:parseInt(gTheMelodyProgram)+1),gInstrumentExplorerChordInstrument=""+(gInstrumentExplorerChordInstrument="158"==gTheChordProgram?0:parseInt(gTheChordProgram)+1),gInstrumentExplorerBassInstrument=""+(gInstrumentExplorerBassInstrument="158"==gTheBassProgram?0:parseInt(gTheBassProgram)+1),gInstrumentExplorerBassVolume=gTheBassVolume,gInstrumentExplorerChordVolume=gTheChordVolume;var o,a="%abcjs_soundfont",l=!1;if((t=/^%abcjs_soundfont.*$/gm,(n=e.match(t))&&n.length>0?l=!0:(t=/^%soundfont.*$/gm,(n=e.match(t))&&n.length>0&&(l=!0,a="%soundfont")),l)&&""!=(o=(o=n[n.length-1].replace(a,"")).trim()))switch(o){case"fluid":gInstrumentExplorerSoundfont="0";break;case"musyng":gInstrumentExplorerSoundfont="1";break;case"fatboy":gInstrumentExplorerSoundfont="2";break;case"canvas":gInstrumentExplorerSoundfont="3";break;case"mscore":gInstrumentExplorerSoundfont="4";break;case"arachno":gInstrumentExplorerSoundfont="5";break;case"fluidhq":gInstrumentExplorerSoundfont="6"}if((t=/^%%MIDI program.*$/gm,(n=e.match(t))&&n.length>0)&&""!=(o=(o=n[0].replace("%%MIDI program","")).trim()))if("mute"==o.toLowerCase())gInstrumentExplorerMelodyInstrument="0";else if("custom"==o.toLowerCase())gInstrumentExplorerMelodyInstrument="151";else if("custom1"==o.toLowerCase())gInstrumentExplorerMelodyInstrument="151";else if("custom2"==o.toLowerCase())gInstrumentExplorerMelodyInstrument="152";else if("custom3"==o.toLowerCase())gInstrumentExplorerMelodyInstrument="153";else if("custom4"==o.toLowerCase())gInstrumentExplorerMelodyInstrument="154";else if("custom5"==o.toLowerCase())gInstrumentExplorerMelodyInstrument="155";else if("custom6"==o.toLowerCase())gInstrumentExplorerMelodyInstrument="156";else if("custom7"==o.toLowerCase())gInstrumentExplorerMelodyInstrument="157";else if("custom8"==o.toLowerCase())gInstrumentExplorerMelodyInstrument="158";else{var r=parseInt(o);isNaN(r)||(gInstrumentExplorerMelodyInstrument=""+(r+1))}if((t=/^%%MIDI bassprog.*$/gm,(n=e.match(t))&&n.length>0)&&""!=(o=(o=n[0].replace("%%MIDI bassprog","")).trim()))if("mute"==o.toLowerCase())gInstrumentExplorerBassInstrument="0";else if("custom"==o.toLowerCase())gInstrumentExplorerBassInstrument="151";else if("custom1"==o.toLowerCase())gInstrumentExplorerBassInstrument="151";else if("custom2"==o.toLowerCase())gInstrumentExplorerBassInstrument="152";else if("custom3"==o.toLowerCase())gInstrumentExplorerBassInstrument="153";else if("custom4"==o.toLowerCase())gInstrumentExplorerBassInstrument="154";else if("custom5"==o.toLowerCase())gInstrumentExplorerBassInstrument="155";else if("custom6"==o.toLowerCase())gInstrumentExplorerBassInstrument="156";else if("custom7"==o.toLowerCase())gInstrumentExplorerBassInstrument="157";else if("custom8"==o.toLowerCase())gInstrumentExplorerBassInstrument="158";else{r=parseInt(o);isNaN(r)||(gInstrumentExplorerBassInstrument=""+(r+1))}if((t=/^%%MIDI chordprog.*$/gm,(n=e.match(t))&&n.length>0)&&""!=(o=(o=n[0].replace("%%MIDI chordprog","")).trim()))if("mute"==o.toLowerCase())gInstrumentExplorerChordInstrument="0";else if("custom"==o.toLowerCase())gInstrumentExplorerChordInstrument="151";else if("custom1"==o.toLowerCase())gInstrumentExplorerChordInstrument="151";else if("custom2"==o.toLowerCase())gInstrumentExplorerChordInstrument="152";else if("custom3"==o.toLowerCase())gInstrumentExplorerChordInstrument="153";else if("custom4"==o.toLowerCase())gInstrumentExplorerChordInstrument="154";else if("custom5"==o.toLowerCase())gInstrumentExplorerChordInstrument="155";else if("custom6"==o.toLowerCase())gInstrumentExplorerChordInstrument="156";else if("custom7"==o.toLowerCase())gInstrumentExplorerChordInstrument="157";else if("custom8"==o.toLowerCase())gInstrumentExplorerChordInstrument="158";else{r=parseInt(o);isNaN(r)||(gInstrumentExplorerChordInstrument=""+(r+1))}if((t=/^%%MIDI bassvol.*$/gm,(n=e.match(t))&&n.length>0)&&""!=(o=(o=n[0].replace("%%MIDI bassvol","")).trim())){r=parseInt(o);isNaN(r)||(gInstrumentExplorerBassVolume=r)}if((t=/^%%MIDI chordvol.*$/gm,(n=e.match(t))&&n.length>0)&&""!=(o=(o=n[0].replace("%%MIDI chordvol","")).trim())){r=parseInt(o);isNaN(r)||(gInstrumentExplorerChordVolume=r)}}function InstrumentExplorerInject(){var e=document.getElementById("instrumentexplorer_inject_all").checked;gInstrumentExplorerSoundfont=document.getElementById("instrument_explorer_soundfont").value,gInstrumentExplorerMelodyInstrument=document.getElementById("instrument_explorer_melody_program").value,gInstrumentExplorerBassInstrument=document.getElementById("instrument_explorer_bass_program").value,gInstrumentExplorerChordInstrument=document.getElementById("instrument_explorer_chord_program").value;var t=document.getElementById("instrument_explorer_bass_volume").value;t=parseInt(t),isNaN(t)||(gInstrumentExplorerBassVolume=t);var n=document.getElementById("instrument_explorer_chord_volume").value;if(n=parseInt(n),isNaN(n)||(gInstrumentExplorerChordVolume=n),e){for(var o=CountTunes(),a=getABCEditorText(),l=a.split(/^X:/gm),r=FindPreTuneHeader(a),i=1;i<=o;++i)l[i]="X:"+l[i],r+=InstrumentExplorerDialogInjectThisTune(l[i]),r+="\n\n";if(setABCEditorText(r),gIsDirty=!0,gRawMode)RenderAsync(!0,null,function(){DayPilot.Modal.alert('<p style="text-align:center;font-size:14pt;font-family:helvetica;">Instrument Injection Complete!</p>',{theme:"modal_flat",top:300,width:500,scrollWithPage:AllowDialogsToScroll()}).then(function(){gEnableSyntax?(gTheCM.selectionStart=0,gTheCM.selectionEnd=0):(gTheABC.selectionStart=0,gTheABC.selectionEnd=0),FocusAfterOperation()})});else{g='<p style="text-align:center;font-size:14pt;font-family:helvetica;">Instrument Injection Complete!</p>';DayPilot.Modal.alert(g,{theme:"modal_flat",top:300,width:500,scrollWithPage:AllowDialogsToScroll()}).then(function(){gEnableSyntax?(gTheCM.selectionStart=0,gTheCM.selectionEnd=0):(gTheABC.selectionStart=0,gTheABC.selectionEnd=0),FocusAfterOperation()})}}else{var s;gPlayerABCInstrumentExplorerInjected=InstrumentExplorerDialogInjectThisTune(gPlayerABCInstrumentExplorerProcessed),s=gEnableSyntax?gTheCM.selectionStart:gTheABC.selectionStart;var c=getABCEditorText();if(setABCEditorText(c=c.replace(gPlayerABCInstrumentExplorerOriginal,gPlayerABCInstrumentExplorerInjected)),gIsDirty=!0,gPlayerABCInstrumentExplorerOriginal=gPlayerABCInstrumentExplorerInjected,gRawMode)RenderAsync(!0,null,function(){DayPilot.Modal.alert('<p style="text-align:center;font-size:14pt;font-family:helvetica;">Instrument Injection Complete!</p>',{theme:"modal_flat",top:300,width:500,scrollWithPage:AllowDialogsToScroll()}).then(function(){gEnableSyntax?(gTheCM.selectionStart=s,gTheCM.selectionEnd=s):(gTheABC.selectionStart=s,gTheABC.selectionEnd=s),FocusAfterOperation()})});else{var g='<p style="text-align:center;font-size:14pt;font-family:helvetica;">Instrument Injection Complete!</p>';DayPilot.Modal.alert(g,{theme:"modal_flat",top:300,width:500,scrollWithPage:AllowDialogsToScroll()}).then(function(){gEnableSyntax?(gTheCM.selectionStart=s,gTheCM.selectionEnd=s):(gTheABC.selectionStart=s,gTheABC.selectionEnd=s),FocusAfterOperation()})}}}function InstrumentExplorerDialogInjectThisTune(e){switch(gInstrumentExplorerSoundfont){case"0":default:e=InjectStringBelowTuneHeader(e,"%soundfont fluid");break;case"1":e=InjectStringBelowTuneHeader(e,"%soundfont musyng");break;case"2":e=InjectStringBelowTuneHeader(e,"%soundfont fatboy");break;case"3":e=InjectStringBelowTuneHeader(e,"%soundfont canvas");break;case"4":e=InjectStringBelowTuneHeader(e,"%soundfont mscore");break;case"5":e=InjectStringBelowTuneHeader(e,"%soundfont arachno");break;case"6":e=InjectStringBelowTuneHeader(e,"%soundfont fluidhq")}if("0"==gInstrumentExplorerMelodyInstrument)e=InjectStringBelowTuneHeader(e,"%%MIDI program mute");else if("151"==gInstrumentExplorerMelodyInstrument)e=InjectStringBelowTuneHeader(e,"%%MIDI program custom1");else if("152"==gInstrumentExplorerMelodyInstrument)e=InjectStringBelowTuneHeader(e,"%%MIDI program custom2");else if("153"==gInstrumentExplorerMelodyInstrument)e=InjectStringBelowTuneHeader(e,"%%MIDI program custom3");else if("154"==gInstrumentExplorerMelodyInstrument)e=InjectStringBelowTuneHeader(e,"%%MIDI program custom4");else if("155"==gInstrumentExplorerMelodyInstrument)e=InjectStringBelowTuneHeader(e,"%%MIDI program custom5");else if("156"==gInstrumentExplorerMelodyInstrument)e=InjectStringBelowTuneHeader(e,"%%MIDI program custom6");else if("157"==gInstrumentExplorerMelodyInstrument)e=InjectStringBelowTuneHeader(e,"%%MIDI program custom7");else if("158"==gInstrumentExplorerMelodyInstrument)e=InjectStringBelowTuneHeader(e,"%%MIDI program custom8");else{e=InjectStringBelowTuneHeader(e,"%%MIDI program "+(parseInt(gInstrumentExplorerMelodyInstrument)-1))}if("0"==gInstrumentExplorerBassInstrument)e=InjectStringBelowTuneHeader(e,"%%MIDI bassprog mute");else if("151"==gInstrumentExplorerBassInstrument)e=InjectStringBelowTuneHeader(e,"%%MIDI bassprog custom1");else if("152"==gInstrumentExplorerBassInstrument)e=InjectStringBelowTuneHeader(e,"%%MIDI bassprog custom2");else if("153"==gInstrumentExplorerBassInstrument)e=InjectStringBelowTuneHeader(e,"%%MIDI bassprog custom3");else if("154"==gInstrumentExplorerBassInstrument)e=InjectStringBelowTuneHeader(e,"%%MIDI bassprog custom4");else if("155"==gInstrumentExplorerBassInstrument)e=InjectStringBelowTuneHeader(e,"%%MIDI bassprog custom5");else if("156"==gInstrumentExplorerBassInstrument)e=InjectStringBelowTuneHeader(e,"%%MIDI bassprog custom6");else if("157"==gInstrumentExplorerBassInstrument)e=InjectStringBelowTuneHeader(e,"%%MIDI bassprog custom7");else if("158"==gInstrumentExplorerBassInstrument)e=InjectStringBelowTuneHeader(e,"%%MIDI bassprog custom8");else{e=InjectStringBelowTuneHeader(e,"%%MIDI bassprog "+(parseInt(gInstrumentExplorerBassInstrument)-1))}if("0"==gInstrumentExplorerChordInstrument)e=InjectStringBelowTuneHeader(e,"%%MIDI chordprog mute");else if("151"==gInstrumentExplorerChordInstrument)e=InjectStringBelowTuneHeader(e,"%%MIDI chordprog custom1");else if("152"==gInstrumentExplorerChordInstrument)e=InjectStringBelowTuneHeader(e,"%%MIDI chordprog custom2");else if("153"==gInstrumentExplorerChordInstrument)e=InjectStringBelowTuneHeader(e,"%%MIDI chordprog custom3");else if("154"==gInstrumentExplorerChordInstrument)e=InjectStringBelowTuneHeader(e,"%%MIDI chordprog custom4");else if("155"==gInstrumentExplorerChordInstrument)e=InjectStringBelowTuneHeader(e,"%%MIDI chordprog custom5");else if("156"==gInstrumentExplorerChordInstrument)e=InjectStringBelowTuneHeader(e,"%%MIDI chordprog custom6");else if("157"==gInstrumentExplorerChordInstrument)e=InjectStringBelowTuneHeader(e,"%%MIDI chordprog custom7");else if("158"==gInstrumentExplorerChordInstrument)e=InjectStringBelowTuneHeader(e,"%%MIDI chordprog custom8");else{e=InjectStringBelowTuneHeader(e,"%%MIDI chordprog "+(parseInt(gInstrumentExplorerChordInstrument)-1))}return e=InjectStringBelowTuneHeader(e,"%%MIDI bassvol "+gInstrumentExplorerBassVolume),e=(e=InjectStringBelowTuneHeader(e,"%%MIDI chordvol "+gInstrumentExplorerChordVolume)).replace("\n\n","")}var gInstrumentExplorerSoundfont="0",gInstrumentExplorerMelodyInstrument="0",gInstrumentExplorerBassInstrument="0",gInstrumentExplorerChordInstrument="0",gInstrumentExplorerBassVolume=0,gInstrumentExplorerChordVolume=0,gPlayerABCInstrumentExplorerOriginal=null,gPlayerABCInstrumentExplorerProcessed=null,gPlayerABCInstrumentExplorerInjected=null;function InstrumentExplorerDialog(e,t,n){if(sendGoogleAnalytics("dialog","InstrumentExplorerDialog"),gMIDIbuffer=null,gTheOKButton=null,n||(gPlayerABCInstrumentExplorerOriginal=e,gPlayerABCInstrumentExplorerProcessed=t),t=InstrumentExplorerDialogInjectThisTune(gPlayerABCInstrumentExplorerProcessed),gPlayerABCInstrumentExplorerInjected=t,gReverbString&&""!=gReverbString){var o=t.match(/^%reverb.*$/m);o&&o.length>0||(t=InjectReverbAboveTune(t,gReverbString))}if(PlayerSetupCommon(t)){var a=GetRadioValue("notenodertab"),l=GetABCJSParams(a);l.oneSvgPerLine=!1,"noten"!=a&&l.tablature&&l.tablature.length>0&&(l.tablature[0].label="");var r,i=new CursorControl;if(gIsIOS){var s=ABCJS.synth.activeAudioContext();gTheMuteHandle=null,s&&(gTheMuteHandle=unmute(s,!1,!1))}!function(){gLoopCallback=null,gStartPlayCallback=null,gPreStartPlayCallback=null,gPlayerInPause=!1;var e=window.innerHeight-515;modal_msg='<div id="playerholder" style="height:'+e+'px;overflow-y:auto;margin-bottom:15px;">',modal_msg+=gLargePlayerControls?'<div id="abcplayer" class="abcjs-large">':'<div id="abcplayer">',modal_msg+='<div id="playback-paper"></div>',modal_msg+="</div>",modal_msg+="</div>",modal_msg+=gLargePlayerControls?'<div id="playback-audio" class="abcjs-large"></div>':'<div id="playback-audio"></div>',modal_msg+='<div class="configure_instrumentexplorer_text" style="text-align:center;margin:0px;margin-top:36px">',modal_msg+='<p class="configure_instrumentexplorer_text">',modal_msg+="Soundfont:"+gInstrumentExplorerSoundfonts+"&nbsp;&nbsp;&nbsp;Melody:"+gInstrumentExplorerMelodyInstruments,modal_msg+="</p>",modal_msg+='<p class="configure_instrumentexplorer_text">',modal_msg+="Bass:"+gInstrumentExplorerBassInstruments+"&nbsp;&nbsp;&nbsp;Chords:"+gInstrumentExplorerChordInstruments,modal_msg+="</p>",modal_msg+='<p class="configure_instrumentexplorer_text">',modal_msg+='Bass Volume (0-127):&nbsp;&nbsp;<input style="width:90px;" id="instrument_explorer_bass_volume" type="number" min="0" step="1" max="127" title="Bass volume, range is 0-127"  autocomplete="off"/>',modal_msg+='Chord Volume (0-127):&nbsp;&nbsp;<input style="width:90px;" id="instrument_explorer_chord_volume" type="number" min="0" step="1" max="127" title="Chord volume, range is 0-127" autocomplete="off"/>',modal_msg+='<span style="font-size:12pt;font-family:helvetica;">Inject all tunes:</span><input style="width:16px;margin-left:8px;margin-right:24px;" id="instrumentexplorer_inject_all" type="checkbox"/>',modal_msg+="</p>",modal_msg+='<p class="configure_instrumentexplorer_text">',modal_msg+='<input id="instrumentexplorertest" class="instrumentexplorertest button btn btn-instrumentexplorertest" onclick="InstrumentExplorerRegenerate();" type="button" value="Reload Tune with Changed Instruments and Volumes" title="Reloads the tune into the player with the selected MIDI soundfont, melody instrument, bass instrument, bass volumes, chord instrument, and chord volumes">',modal_msg+='<input id="instrumentexplorerinject" class="instrumentexplorerinject button btn btn-instrumentexplorerinject" onclick="InstrumentExplorerInject();" style="margin-right:0px;" type="button" value="Inject Instruments and Volumes into the ABC" title="Injects the current soundfont, melody instrument, bass instrument, bass volume, chord instrument, and chord volumes into the tune ABC">',modal_msg+="</p>",modal_msg+="</div>",modal_msg+='<a id="instrumentexplorerhelp" href="https://michaeleskin.com/abctools/userguide.html#midi_instrument_explorer" target="_blank" style="text-decoration:none;" title="Learn more about the MIDI Instrument Explorer" class="dialogcornerbutton">?</a>';var n,o=window.innerWidth;GetRadioValue("notenodertab"),isDesktopBrowser()?(n=giPadTwoColumn?isLandscapeOrientation()?o*(gPlayerScaling/100):.9*o:o*(gPlayerScaling/100))<850&&(n=850):n=800,DayPilot.Modal.alert(modal_msg,{theme:"modal_flat",top:50,width:n,okText:"Close",scrollWithPage:isMobileBrowser()}),document.getElementById("instrument_explorer_soundfont").value=gInstrumentExplorerSoundfont,document.getElementById("instrument_explorer_melody_program").value=gInstrumentExplorerMelodyInstrument,document.getElementById("instrument_explorer_bass_program").value=gInstrumentExplorerBassInstrument,document.getElementById("instrument_explorer_chord_program").value=gInstrumentExplorerChordInstrument,document.getElementById("instrument_explorer_bass_volume").value=gInstrumentExplorerBassVolume,document.getElementById("instrument_explorer_chord_volume").value=gInstrumentExplorerChordVolume;for(var a=document.getElementsByClassName("modal_flat_ok"),l=null,s=0;s<a.length;++s)if("Close"==(l=a[s]).innerText){gTheOKButton=l;var g=l.onclick;l.onclick=function(){g(),gSynthControl=null,r&&(r.destroy(),r=null),FocusAfterOperation(),gIsIOS&&gTheMuteHandle&&(gTheMuteHandle.dispose(),gTheMuteHandle=null)};break}ABCJS.synth.supportsAudio()?(r=new ABCJS.synth.SynthController(t)).load("#playback-audio",i,{displayLoop:!0,displayRestart:!0,displayPlay:!0,displayProgress:!0,displayWarp:!0}):document.querySelector("#playback-audio").innerHTML="<div class='audio-error'>Audio is not supported in this browser.</div>",c(!1),gPlayerHolder=document.getElementById("playerholder"),gPlayerContainerRect=gPlayerHolder.getBoundingClientRect()}()}function c(e){r.disable(!0);var n=t.replace(/%%titlespace\s.*\r?\n/g,"");n=GetABCFileHeader()+n;var o=ABCJS.renderAbc("playback-paper",n,l)[0];postProcessTab([o],"playback-paper",a,!0);var i=new ABCJS.synth.CreateSynth(t);gMIDIbuffer=i,gMIDIInitStillWaiting=!1,SetupPlayerEventHandlers(),i.init({visualObj:o}).then(function(n){if(r){var a=computeFade(t);r.setTune(o,e,{fadeLength:a}).then(function(e){if(console.log("Audio successfully loaded."),verifyCustomInstrumentsLoaded(t),gSynthControl=r,(n=document.getElementsByClassName("abcjs-midi-tempo"))&&n.length>0&&(n[0].onclick=SetPlayerTempo),gTrainerTouchControls){var n,o=document.getElementsByClassName("abcjs-midi-clock"),a=document.getElementsByClassName("abcjs-midi-current-tempo-wrapper");if(o&&a&&o.length>0&&a.length>0)(n=o[0]).onclick=DecrementTempo,(n=a[0]).onclick=IncrementTempo}}).catch(function(e){hideTheSpinner(),gMIDIInitStillWaiting=!1,console.log("Problem loading audio for this tune")})}}).catch(function(e){hideTheSpinner(),gMIDIInitStillWaiting=!1,console.log("Problem loading audio for this tune")})}}function GraceExplorer(){if(gAllowCopy){deactivateQuickPlayer();var e=findSelectedTune();if(""==e)return;ScanTuneForCustomTimingInjection(e),GraceExplorerDialog(e,PreProcessPlayABC(e),!1)}}function GraceExplorerRegenerate(){var e=!1,t=document.getElementById("grace_explorer_duration").value;t=parseFloat(t),!isNaN(t)&&t>=0&&t<=150&&(gGraceDuration=t/1e3,e=!0),e&&(gTheOKButton.click(),setTimeout(function(){GraceExplorerDialog(gPlayerABCGraceExplorerOriginal,gPlayerABCGraceExplorerProcessed,!0)},250))}function ScanTuneForGraceExplorer(e){var t,n;if(gGraceDuration=.045,t=/^%grace_duration_ms.*$/gm,(n=e.match(t))&&n.length>0){var o=n[0].replace("%grace_duration_ms",""),a=(o=o.trim()).split(" ");if(a.length>=1){var l=a[0],r=parseFloat(l);isNaN(r)||r>=0&&r<=150&&(gGraceDuration=r/1e3)}}}function GraceExplorerInject(){var e=document.getElementById("grace_explorer_inject_all").checked,t=!1,n=document.getElementById("grace_explorer_duration").value;if(n=parseFloat(n),!isNaN(n)&&n>=0&&n<=150&&(t=!0),t){var o="%grace_duration_ms "+n,a=/^%grace_duration_ms.*[\r\n]*/gm;if(e){for(var l=CountTunes(),r=getABCEditorText(),i=r.split(/^X:/gm),s=FindPreTuneHeader(r),c=1;c<=l;++c){i[c]="X:"+i[c],s+=g=(g=InjectStringBelowTuneHeader(i[c].replaceAll(a,""),o)).replace("\n\n",""),s+="\n\n"}if(setABCEditorText(s),gIsDirty=!0,gRawMode)RenderAsync(!0,null,function(){DayPilot.Modal.alert('<p style="text-align:center;font-size:14pt;font-family:helvetica;">Grace Duration Injection Complete!</p>',{theme:"modal_flat",top:300,width:500,scrollWithPage:AllowDialogsToScroll()}).then(function(){gEnableSyntax?(gTheCM.selectionStart=0,gTheCM.selectionEnd=0):(gTheABC.selectionStart=0,gTheABC.selectionEnd=0),FocusAfterOperation()})});else{m='<p style="text-align:center;font-size:14pt;font-family:helvetica;">Grace Duration Injection Complete!</p>';DayPilot.Modal.alert(m,{theme:"modal_flat",top:300,width:500,scrollWithPage:AllowDialogsToScroll()}).then(function(){gEnableSyntax?(gTheCM.selectionStart=0,gTheCM.selectionEnd=0):(gTheABC.selectionStart=0,gTheABC.selectionEnd=0),FocusAfterOperation()})}}else{var g,d;g=(g=InjectStringBelowTuneHeader(gPlayerABCGraceExplorerOriginal.replaceAll(a,""),o)).replace("\n\n",""),d=gEnableSyntax?gTheCM.selectionStart:gTheABC.selectionStart;var u=getABCEditorText();if(setABCEditorText(u=u.replace(gPlayerABCGraceExplorerOriginal,g)),gIsDirty=!0,gPlayerABCGraceExplorerOriginal=g,gRawMode)RenderAsync(!0,null,function(){DayPilot.Modal.alert('<p style="text-align:center;font-size:14pt;font-family:helvetica;">Grace Duration Injection Complete!</p>',{theme:"modal_flat",top:300,width:500,scrollWithPage:AllowDialogsToScroll()}).then(function(){gEnableSyntax?(gTheCM.selectionStart=d,gTheCM.selectionEnd=d):(gTheABC.selectionStart=d,gTheABC.selectionEnd=d),FocusAfterOperation()})});else{var m='<p style="text-align:center;font-size:14pt;font-family:helvetica;">Grace Duration Injection Complete!</p>';DayPilot.Modal.alert(m,{theme:"modal_flat",top:300,width:500,scrollWithPage:AllowDialogsToScroll()}).then(function(){gEnableSyntax?(gTheCM.selectionStart=d,gTheCM.selectionEnd=d):(gTheABC.selectionStart=d,gTheABC.selectionEnd=d),FocusAfterOperation()})}}}}var gPlayerABCGraceExplorerOriginal=null,gPlayerABCGraceExplorerProcessed=null;function GraceExplorerDialog(e,t,n){if(sendGoogleAnalytics("dialog","GraceExplorerDialog"),gMIDIbuffer=null,gTheOKButton=null,n||(gPlayerABCGraceExplorerOriginal=e,gPlayerABCGraceExplorerProcessed=t),PlayerSetupCommon(t)){n||ScanTuneForGraceExplorer(t);var o=GetRadioValue("notenodertab"),a=GetABCJSParams(o);a.oneSvgPerLine=!1,"noten"!=o&&a.tablature&&a.tablature.length>0&&(a.tablature[0].label="");var l,r=new CursorControl;if(gIsIOS){var i=ABCJS.synth.activeAudioContext();gTheMuteHandle=null,i&&(gTheMuteHandle=unmute(i,!1,!1))}!function(){gLoopCallback=null,gStartPlayCallback=null,gPreStartPlayCallback=null,gPlayerInPause=!1;var e=window.innerHeight-400;modal_msg='<div id="playerholder" style="height:'+e+'px;overflow-y:auto;margin-bottom:15px;">',modal_msg+=gLargePlayerControls?'<div id="abcplayer" class="abcjs-large">':'<div id="abcplayer">',modal_msg+='<div id="playback-paper"></div>',modal_msg+="</div>",modal_msg+="</div>",modal_msg+=gLargePlayerControls?'<div id="playback-audio" class="abcjs-large"></div>':'<div id="playback-audio"></div>',modal_msg+='<p class="configure_graceexplorer_text" style="text-align:center;margin:0px;margin-top:22px">',modal_msg+='Grace duration in milliseconds (range is 1-150): <input style="width:90px;" id="grace_explorer_duration" type="number" min="0" step="1" max="150" title="Grace duration in milliseconds, range is 1 to 150, 0 disables the custom grace duration feature and uses original abcjs default behavior" autocomplete="off"/>',modal_msg+='<span style="font-size:12pt;font-family:helvetica;">Inject all tunes:</span><input style="width:16px;margin-left:8px;margin-right:24px;" id="grace_explorer_inject_all" type="checkbox"/>',modal_msg+="</p>",modal_msg+='<p class="configure_graceexplorer_text" style="text-align:center;margin:0px;margin-top:22px">',modal_msg+='<input id="graceexplorertest" class="graceexplorertest button btn btn-graceexplorertest" onclick="GraceExplorerRegenerate();" type="button" value="Reload Tune with Changed Grace Duration" title="Reloads the tune into the player with the entered grace duration">',modal_msg+='<input id="graceexplorerinject" class="graceexplorerinject button btn btn-graceexplorerinject" onclick="GraceExplorerInject();" type="button" style="margin-right:0px;" value="Inject Grace Duration into the ABC" title="Injects the current grace duration into the tune ABC">',modal_msg+="</p>",modal_msg+='<a id="graceexplorerhelp" href="https://michaeleskin.com/abctools/userguide.html#grace_duration_explorer" target="_blank" style="text-decoration:none;" title="Learn more about the Grace Duration Explorer" class="dialogcornerbutton">?</a>';var n,o=window.innerWidth;GetRadioValue("notenodertab"),isDesktopBrowser()?(n=giPadTwoColumn?isLandscapeOrientation()?o*(gPlayerScaling/100):.9*o:o*(gPlayerScaling/100))<850&&(n=850):n=800,DayPilot.Modal.alert(modal_msg,{theme:"modal_flat",top:50,width:n,okText:"Close",scrollWithPage:isMobileBrowser()}),document.getElementById("grace_explorer_duration").value=gGraceDuration/.001;for(var a=document.getElementsByClassName("modal_flat_ok"),i=null,c=0;c<a.length;++c)if("Close"==(i=a[c]).innerText){gTheOKButton=i;var g=i.onclick;i.onclick=function(){g(),gSynthControl=null,l&&(l.destroy(),l=null),FocusAfterOperation(),gIsIOS&&gTheMuteHandle&&(gTheMuteHandle.dispose(),gTheMuteHandle=null)};break}ABCJS.synth.supportsAudio()?(l=new ABCJS.synth.SynthController(t)).load("#playback-audio",r,{displayLoop:!0,displayRestart:!0,displayPlay:!0,displayProgress:!0,displayWarp:!0}):document.querySelector("#playback-audio").innerHTML="<div class='audio-error'>Audio is not supported in this browser.</div>",s(!1),gPlayerHolder=document.getElementById("playerholder"),gPlayerContainerRect=gPlayerHolder.getBoundingClientRect()}()}function s(e){l.disable(!0);var n=ABCJS.renderAbc("playback-paper",t,a)[0];postProcessTab([n],"playback-paper",o,!0);var r=new ABCJS.synth.CreateSynth(t);gMIDIbuffer=r,gMIDIInitStillWaiting=!1,SetupPlayerEventHandlers(),r.init({visualObj:n}).then(function(o){if(l){var a=computeFade(t);l.setTune(n,e,{fadeLength:a}).then(function(e){if(console.log("Audio successfully loaded."),verifyCustomInstrumentsLoaded(t),gSynthControl=l,(n=document.getElementsByClassName("abcjs-midi-tempo"))&&n.length>0&&(n[0].onclick=SetPlayerTempo),gTrainerTouchControls){var n,o=document.getElementsByClassName("abcjs-midi-clock"),a=document.getElementsByClassName("abcjs-midi-current-tempo-wrapper");if(o&&a&&o.length>0&&a.length>0)(n=o[0]).onclick=DecrementTempo,(n=a[0]).onclick=IncrementTempo}}).catch(function(e){hideTheSpinner(),gMIDIInitStillWaiting=!1,console.log("Problem loading audio for this tune")})}}).catch(function(e){hideTheSpinner(),gMIDIInitStillWaiting=!1,console.log("Problem loading audio for this tune")})}}function RollExplorer(){if(gAllowCopy){deactivateQuickPlayer();var e=findSelectedTune();if(""==e)return;ScanTuneForCustomTimingInjection(e);var t=PreProcessPlayABC(e);gRollExplorerTransformed=!1,RollExplorerDialog(e,t,!1)}}function RollParameterIssueAlert(e){DayPilot.Modal.alert('<p style="text-align:center;font-size:18pt;font-family:helvetica;">Please Check the Roll Parameters</p><p style="font-size:12pt;line-height:18pt;margin-top:36px;text-align:center;">There is an issue with the roll parameters</p><p style="font-size:12pt;line-height:18pt;margin-top:20px;text-align:center;">All values must be positive</p><p style="font-size:12pt;line-height:18pt;margin-top:20px;text-align:center;">The total of the slot sizes for each of the roll styles must be less than 3</p><p style="font-size:12pt;line-height:18pt;margin-top:20px;text-align:center;">The fractions must be between 0 and 1</p><p style="font-size:12pt;line-height:18pt;margin-top:20px;text-align:center;">The volumes must be between 0 and 2</p>',{theme:"modal_flat",top:100,width:700,scrollWithPage:AllowDialogsToScroll()}).then(function(){e&&e()})}function makeRollString(e){var t,n="",o=e.length;for(t=0;t<o;++t)n+=t!=o-1?e[t]+" ":e[t];return n}function RollExplorerValidate(){var e=document.getElementById("roll_2_slot_1").value,t=document.getElementById("roll_2_slot_2").value,n=document.getElementById("roll_2_fraction_1").value,o=document.getElementById("roll_2_fraction_2").value,a=document.getElementById("roll_2_fraction_3").value,l=document.getElementById("roll_2_volume_1").value,r=document.getElementById("roll_2_volume_2").value,i=document.getElementById("roll_2_volume_3").value,s=document.getElementById("roll_3_slot_1").value,c=document.getElementById("roll_3_slot_2").value,g=document.getElementById("roll_3_fraction_1").value,d=document.getElementById("roll_3_fraction_2").value,u=document.getElementById("roll_3_fraction_3").value,m=document.getElementById("roll_3_volume_1").value,p=document.getElementById("roll_3_volume_2").value,h=document.getElementById("roll_3_volume_3").value,f=makeRollString([e,t,n,o,a,l,r,i]),b=makeRollString([s,c,g,d,u,m,p,h]),y=validate_roll_2_params(f,!1),T=validate_roll_3_params(b,!1);return!(!y||!T)&&(y=validate_roll_2_params(f,!0),T=validate_roll_3_params(b,!0),!0)}function RollExplorerTransformReel(e){function t(e){return e.replace(/(~[a-zA-Z])3/g,function(e,t){return t.charAt(1)+t+"2"})}function n(e){return e.replace(/(~[a-zA-Z])3/g,function(e,t){return t+"2"+t.charAt(1)})}gRollExplorerTransformed=!0,e?(gPlayerABCRollExplorerTransformed=n(gPlayerABCRollExplorerOriginal),gPlayerABCRollExplorerProcessed=n(gPlayerABCRollExplorerProcessed)):(gPlayerABCRollExplorerTransformed=t(gPlayerABCRollExplorerOriginal),gPlayerABCRollExplorerProcessed=t(gPlayerABCRollExplorerProcessed)),gTheOKButton.click(),setTimeout(function(){RollExplorerDialog(gPlayerABCRollExplorerTransformed,gPlayerABCRollExplorerProcessed,!0)},250)}function RollExplorerRegenerate(){RollExplorerValidate()?(gTheOKButton.click(),setTimeout(function(){RollExplorerDialog(gPlayerABCRollExplorerTransformed||gPlayerABCRollExplorerOriginal,gPlayerABCRollExplorerProcessed,!0)},250)):RollParameterIssueAlert(null)}function RollExplorerInject(){if(RollExplorerValidate()){var e,t="%roll_2_params "+gRoll2Duration1+" "+gRoll2Duration2+" "+gRoll2Fraction1+" "+gRoll2Fraction2+" "+gRoll2Fraction3+" "+gRoll2Volume1+" "+gRoll2Volume2+" "+gRoll2Volume3+"\n%roll_3_params "+gRoll3Duration1+" "+gRoll3Duration2+" "+gRoll3Fraction1+" "+gRoll3Fraction2+" "+gRoll3Fraction3+" "+gRoll3Volume1+" "+gRoll3Volume2+" "+gRoll3Volume3,n=/^%roll_2_params.*[\r\n]*/gm;e=gPlayerABCRollExplorerTransformed?gPlayerABCRollExplorerTransformed.replaceAll(n,""):gPlayerABCRollExplorerOriginal.replaceAll(n,""),n=/^%roll_3_params.*[\r\n]*/gm;var o,a=InjectStringBelowTuneHeader(e=e.replaceAll(n,""),t);a=a.replace("\n\n",""),o=gEnableSyntax?gTheCM.selectionStart:gTheABC.selectionStart;var l=getABCEditorText();if(setABCEditorText(l=l.replace(gPlayerABCRollExplorerOriginal,a)),gIsDirty=!0,gPlayerABCRollExplorerOriginal=a,gRawMode||gRollExplorerTransformed)RenderAsync(!0,null,function(){DayPilot.Modal.alert('<p style="text-align:center;font-size:14pt;font-family:helvetica;">Roll Parameter Injection Complete!</p>',{theme:"modal_flat",top:300,width:500,scrollWithPage:AllowDialogsToScroll()}).then(function(){gEnableSyntax?(gTheCM.selectionStart=o,gTheCM.selectionEnd=o):(gTheABC.selectionStart=o,gTheABC.selectionEnd=o),FocusAfterOperation()})});else{DayPilot.Modal.alert('<p style="text-align:center;font-size:14pt;font-family:helvetica;">Roll Parameter Injection Complete!</p>',{theme:"modal_flat",top:300,width:500,scrollWithPage:AllowDialogsToScroll()}).then(function(){gEnableSyntax?(gTheCM.selectionStart=o,gTheCM.selectionEnd=o):(gTheABC.selectionStart=o,gTheABC.selectionEnd=o),FocusAfterOperation()})}}else RollParameterIssueAlert(null)}function idleRollExplorer(){document.getElementById("roll_2_slot_1").value=gRoll2Duration1,document.getElementById("roll_2_slot_2").value=gRoll2Duration2,document.getElementById("roll_2_fraction_1").value=gRoll2Fraction1,document.getElementById("roll_2_fraction_2").value=gRoll2Fraction2,document.getElementById("roll_2_fraction_3").value=gRoll2Fraction3,document.getElementById("roll_2_volume_1").value=gRoll2Volume1,document.getElementById("roll_2_volume_2").value=gRoll2Volume2,document.getElementById("roll_2_volume_3").value=gRoll2Volume3,document.getElementById("roll_3_slot_1").value=gRoll3Duration1,document.getElementById("roll_3_slot_2").value=gRoll3Duration2,document.getElementById("roll_3_fraction_1").value=gRoll3Fraction1,document.getElementById("roll_3_fraction_2").value=gRoll3Fraction2,document.getElementById("roll_3_fraction_3").value=gRoll3Fraction3,document.getElementById("roll_3_volume_1").value=gRoll3Volume1,document.getElementById("roll_3_volume_2").value=gRoll3Volume2,document.getElementById("roll_3_volume_3").value=gRoll3Volume3}function RollExplorerResetRoll2(){validate_roll_2_params(gRoll2DefaultParams,!0),idleRollExplorer(),RollExplorerRegenerate()}function RollExplorerResetRoll3(){validate_roll_3_params(gRoll3DefaultParams,!0),idleRollExplorer(),RollExplorerRegenerate()}function RollExplorerDefaultRoll2(){var e=makeRollString([document.getElementById("roll_2_slot_1").value,document.getElementById("roll_2_slot_2").value,document.getElementById("roll_2_fraction_1").value,document.getElementById("roll_2_fraction_2").value,document.getElementById("roll_2_fraction_3").value,document.getElementById("roll_2_volume_1").value,document.getElementById("roll_2_volume_2").value,document.getElementById("roll_2_volume_3").value]),t=validate_roll_2_params(e,!1);if(t){t=validate_roll_2_params(e,!0),gRoll2DefaultParams=e,SaveConfigurationSettings();DayPilot.Modal.alert('<p style="text-align:center;font-size:14pt;font-family:helvetica;">Quarter Note Roll Parameters Set as Tool Default</p><p style="font-size:12pt;line-height:18pt;margin-top:36px;text-align:center;">You can edit the values in the Advanced Settings dialog.</p>',{theme:"modal_flat",top:200,width:700,scrollWithPage:AllowDialogsToScroll()}).then(function(){RollExplorerRegenerate()})}else RollParameterIssueAlert(null)}function RollExplorerDefaultRoll3(){var e=makeRollString([document.getElementById("roll_3_slot_1").value,document.getElementById("roll_3_slot_2").value,document.getElementById("roll_3_fraction_1").value,document.getElementById("roll_3_fraction_2").value,document.getElementById("roll_3_fraction_3").value,document.getElementById("roll_3_volume_1").value,document.getElementById("roll_3_volume_2").value,document.getElementById("roll_3_volume_3").value]),t=validate_roll_3_params(e,!1);if(t){t=validate_roll_3_params(e,!0),gRoll3DefaultParams=e,SaveConfigurationSettings();DayPilot.Modal.alert('<p style="text-align:center;font-size:14pt;font-family:helvetica;">Dotted Quarter Note Roll Parameters Set as Tool Default</p><p style="font-size:12pt;line-height:18pt;margin-top:36px;text-align:center;">You can edit the values in the Advanced Settings dialog.</p>',{theme:"modal_flat",top:200,width:700,scrollWithPage:AllowDialogsToScroll()}).then(function(){RollExplorerRegenerate()})}else RollParameterIssueAlert(null)}var gPlayerABCRollExplorerOriginal=null,gPlayerABCRollExplorerProcessed=null,gPlayerABCRollExplorerTransformed=null,gRollExplorerTransformed=!1;function RollExplorerDialog(e,t,n){if(sendGoogleAnalytics("dialog","RollExplorerDialog"),gMIDIbuffer=null,gTheOKButton=null,n||(gPlayerABCRollExplorerOriginal=e,gPlayerABCRollExplorerProcessed=t,gPlayerABCRollExplorerTransformed=null),PlayerSetupCommon(t)){n||ScanTuneForCustomTimingInjection(t);var o=GetRadioValue("notenodertab"),a=GetABCJSParams(o);a.oneSvgPerLine=!1,"noten"!=o&&a.tablature&&a.tablature.length>0&&(a.tablature[0].label="");var l,r=new CursorControl;if(gIsIOS){var i=ABCJS.synth.activeAudioContext();gTheMuteHandle=null,i&&(gTheMuteHandle=unmute(i,!1,!1))}!function(){gLoopCallback=null,gStartPlayCallback=null,gPreStartPlayCallback=null,gPlayerInPause=!1;var e=window.innerHeight-650;modal_msg='<div id="playerholder" style="height:'+e+'px;overflow-y:auto;margin-bottom:15px;">',modal_msg+=gLargePlayerControls?'<div id="abcplayer" class="abcjs-large">':'<div id="abcplayer">',modal_msg+='<div id="playback-paper"></div>',modal_msg+="</div>",modal_msg+="</div>",modal_msg+=gLargePlayerControls?'<div id="playback-audio" class="abcjs-large"></div>':'<div id="playback-audio"></div>',modal_msg+='<p class="configure_rollexplorer_text" style="font-size:14pt;text-align:center;margin:0px;margin-top:15px;margin-left:224px">Quarter Note Roll Parameters<input id="reset_roll_explorer_2" class="button btn btn-reset_roll_explorer_2" onclick="RollExplorerResetRoll2();" type="button" value="Reset" title="Reset quarter note roll parameters to the current tool defaults"><input id="default_roll_explorer_2" class="button btn btn-default_roll_explorer_2" onclick="RollExplorerDefaultRoll2();" type="button" value="Set as Tool Default" title="Makes the current quarter note roll parameters the default for the tool"></p>',modal_msg+='<p class="configure_rollexplorer_text" style="text-align:center;margin:0px;margin-top:8px">',modal_msg+='Slot 1: <input style="width:85px;" id="roll_2_slot_1" title="Quarter note slot 1 time" autocomplete="off" type="number" min="0" step="0.05" max="2.95"/>',modal_msg+='Slot 2: <input style="width:85px;" id="roll_2_slot_2" title="Quarter note slot 2 time" autocomplete="off"  type="number" min="0" step="0.05" max="2.95"/>',modal_msg+="</p>",modal_msg+='<p class="configure_rollexplorer_text" style="text-align:center;margin:0px;margin-top:8px">',modal_msg+='Fraction 1: <input style="width:85px;" id="roll_2_fraction_1" title="Quarter note fraction 1" autocomplete="off" type="number" min="0" step="0.05" max="1"/>',modal_msg+='Fraction 2: <input style="width:85px;" id="roll_2_fraction_2" title="Quarter note fraction 2" autocomplete="off" type="number" min="0" step="0.05" max="1"/>',modal_msg+='Fraction 3: <input style="width:85px;" id="roll_2_fraction_3" title="Quarter note fraction 3" autocomplete="off" type="number" min="0" step="0.05" max="1"/>',modal_msg+="</p>",modal_msg+='<p class="configure_rollexplorer_text" style="text-align:center;margin:0px;margin-top:8px">',modal_msg+='Volume 1: <input style="width:85px;" id="roll_2_volume_1" title="Quarter note volume 1" autocomplete="off" type="number" min="0" step="0.05" max="2"/>',modal_msg+='Volume 2: <input style="width:85px;" id="roll_2_volume_2" title="Quarter note volume 2" autocomplete="off" type="number" min="0" step="0.05" max="2"/>',modal_msg+='Volume 3: <input style="width:85px;" id="roll_2_volume_3" title="Quarter note volume 3" autocomplete="off" type="number" min="0" step="0.05" max="2"/>',modal_msg+="</p>",modal_msg+='<p class="configure_rollexplorer_text" style="font-size:14pt;text-align:center;margin:0px;margin-top:10px;margin-left:162px">Dotted Quarter Note Roll Parameters<input id="reset_roll_explorer_3" class="reset_roll_explorer_3 button btn btn-reset_roll_explorer_3" onclick="RollExplorerResetRoll3();" type="button" value="Reset" title="Reset dotted quarter note roll parameters to the current tool defaults"><input id="default_roll_explorer_3" class="button btn btn-default_roll_explorer_3" onclick="RollExplorerDefaultRoll3();" type="button" value="Set as Tool Default" title="Makes the current dotted quarter note roll parameters the default for the tool"></p>',modal_msg+='<p class="configure_rollexplorer_text" style="text-align:center;margin:0px;margin-top:8px">',modal_msg+='Slot 1: <input style="width:85px;" id="roll_3_slot_1" title="Dotted quarter note slot 1 time" autocomplete="off" type="number" min="0" step="0.05" max="2.95"/>',modal_msg+='Slot 2: <input style="width:85px;" id="roll_3_slot_2" title="Dotted quarter note slot 2 time" autocomplete="off" type="number" min="0" step="0.05" max="2.95"/>',modal_msg+="</p>",modal_msg+='<p class="configure_rollexplorer_text" style="text-align:center;margin:0px;margin-top:8px">',modal_msg+='Fraction 1: <input style="width:85px;" id="roll_3_fraction_1" title="Dotted quarter note fraction 1" autocomplete="off" type="number" min="0" step="0.05" max="1"/>',modal_msg+='Fraction 2: <input style="width:85px;" id="roll_3_fraction_2" title="Dotted quarter note fraction 2" autocomplete="off" type="number" min="0" step="0.05" max="1"/>',modal_msg+='Fraction 3: <input style="width:85px;" id="roll_3_fraction_3" title="Dotted quarter note fraction 3" autocomplete="off" type="number" min="0" step="0.05" max="1"/>',modal_msg+="</p>",modal_msg+='<p class="configure_rollexplorer_text" style="text-align:center;margin:0px;margin-top:8px">',modal_msg+='Volume 1: <input style="width:85px;" id="roll_3_volume_1" title="Dotted quarter note volume 1" autocomplete="off" type="number" min="0" step="0.05" max="2"/>',modal_msg+='Volume 2: <input style="width:85px;" id="roll_3_volume_2" title="Dotted quarter note volume 2" autocomplete="off" type="number" min="0" step="0.05" max="2"/>',modal_msg+='Volume 3: <input style="width:85px;" id="roll_3_volume_3" title="Dotted quarter note volume 3" autocomplete="off" type="number" min="0" step="0.05" max="2"/>',modal_msg+="</p>",modal_msg+='<p class="configure_rollexplorer_text" style="text-align:center;margin:0px;margin-top:24px">',modal_msg+='<input id="rollexplorertest" class="rollexplorertest button btn btn-rollexplorertest" onclick="RollExplorerRegenerate();" type="button" value="Reload Tune with Parameters" title="Reloads the tune into the player with the entered roll parameters">',modal_msg+='<input id="rollexplorerinject" class="rollexplorerinject button btn btn-rollexplorerinject" onclick="RollExplorerInject();" type="button" value="Inject Parameters into ABC" title="Injects the current roll parameters and roll transformations into the tune ABC">',modal_msg+='<input id="rollexplorertransform" class="rollexplorertransform button btn btn-rollexplorertransform" onclick="RollExplorerTransformReel(false);" type="button" value="~G3 → G~G2" title="Transforms ~G3 style rolls to G~G2 style, may be useful for creating a better sounding roll for reels">',modal_msg+='<input id="rollexplorertransform2" style="margin-right:0px" class="rollexplorertransform2 button btn btn-rollexplorertransform" onclick="RollExplorerTransformReel(true);" type="button" value="~G3 → ~G2G" title="Transforms ~G3 style rolls to ~G2G style, may be useful for creating a better sounding roll for reels">',modal_msg+="</p>",modal_msg+='<a id="rollexplorerhelp" href="https://michaeleskin.com/abctools/userguide.html#roll_explorer" target="_blank" style="text-decoration:none;" title="Learn more about the Roll Explorer" class="dialogcornerbutton">?</a>';var n,o=window.innerWidth;GetRadioValue("notenodertab"),isDesktopBrowser()?(n=giPadTwoColumn?isLandscapeOrientation()?.6*o:.9*o:.5*o)<850&&(n=850):n=800,DayPilot.Modal.alert(modal_msg,{theme:"modal_flat",top:20,width:n,okText:"Close",scrollWithPage:isMobileBrowser()}),idleRollExplorer();for(var a=document.getElementsByClassName("modal_flat_ok"),i=null,c=0;c<a.length;++c)if("Close"==(i=a[c]).innerText){gTheOKButton=i;var g=i.onclick;i.onclick=function(){g(),gSynthControl=null,l&&(l.destroy(),l=null),FocusAfterOperation(),gIsIOS&&gTheMuteHandle&&(gTheMuteHandle.dispose(),gTheMuteHandle=null)};break}ABCJS.synth.supportsAudio()?(l=new ABCJS.synth.SynthController(t)).load("#playback-audio",r,{displayLoop:!0,displayRestart:!0,displayPlay:!0,displayProgress:!0,displayWarp:!0}):document.querySelector("#playback-audio").innerHTML="<div class='audio-error'>Audio is not supported in this browser.</div>",s(!1),gPlayerHolder=document.getElementById("playerholder"),gPlayerContainerRect=gPlayerHolder.getBoundingClientRect()}()}function s(e){l.disable(!0);var n=ABCJS.renderAbc("playback-paper",t,a)[0];postProcessTab([n],"playback-paper",o,!0);var r=new ABCJS.synth.CreateSynth(t);gMIDIbuffer=r,gMIDIInitStillWaiting=!1,SetupPlayerEventHandlers(),r.init({visualObj:n}).then(function(o){if(l){var a=computeFade(t);l.setTune(n,e,{fadeLength:a}).then(function(e){if(console.log("Audio successfully loaded."),verifyCustomInstrumentsLoaded(t),gSynthControl=l,(n=document.getElementsByClassName("abcjs-midi-tempo"))&&n.length>0&&(n[0].onclick=SetPlayerTempo),gTrainerTouchControls){var n,o=document.getElementsByClassName("abcjs-midi-clock"),a=document.getElementsByClassName("abcjs-midi-current-tempo-wrapper");if(o&&a&&o.length>0&&a.length>0)(n=o[0]).onclick=DecrementTempo,(n=a[0]).onclick=IncrementTempo}}).catch(function(e){hideTheSpinner(),gMIDIInitStillWaiting=!1,console.log("Problem loading audio for this tune")})}}).catch(function(e){hideTheSpinner(),gMIDIInitStillWaiting=!1,console.log("Problem loading audio for this tune")})}}function TuneTrainerLaunchFromPlayer(){gTheOKButton.click(),setTimeout(function(){TuneTrainer(!0)},250)}function TuneTrainer(e){if(gAllowCopy){var t;if(e||deactivateQuickPlayer(),""==(t=e?getTuneByIndex(gPlayABCTuneIndex):findSelectedTune()))return;ScanTuneForCustomTimingInjection(t);var n=PreProcessPlayABC(t=ProcessSelectRegionForPlay(t=t.trim()));gAllowLoopStateCaching=!1,TuneTrainerDialog(t,n,!1)}}function TuneTrainerReset(){var e=!1,t=document.getElementById("looper_start_percent").value,n=document.getElementById("looper_end_percent").value,o=document.getElementById("looper_increment").value,a=document.getElementById("looper_count").value;if(t=parseFloat(t),n=parseFloat(n),o=parseFloat(o),a=parseFloat(a),isNaN(t)||isNaN(n)||isNaN(o)||isNaN(a)||t<=n&&t>=0&&n<=400&&o>=0&&a>0&&(gLooperSpeedEnd=n,gLooperSpeedIncrement=o,gLooperCurrent=gLooperSpeedStart=t,gLooperLoopCount=gLooperCount=a,e=!0),e)gLoopCallback=null,gStartPlayCallback=null,gPreStartPlayCallback=null,gPlayerInPause=!1,gTheOKButton.click(),setTimeout(function(){TuneTrainerDialog(gPlayerLooperOriginal,gPlayerLooperProcessed,!0)},250);else{DayPilot.Modal.alert('<p style="font-family:helvetica;font-size:14pt;text-align:center"><strong>Invalid Tune Trainer Values Entered</strong></p><p style="font-family:helvetica;font-size:14pt;margin-top:36px;">All values must be numbers.</p><p style="font-family:helvetica;font-size:14pt;">Starting tempo must be less than the ending tempo.</p><p style="font-family:helvetica;font-size:14pt;">Tempo increment must be greater than zero.</p><p style="font-family:helvetica;font-size:14pt;">Loop count must be greater than zero.</p><p style="font-family:helvetica;font-size:14pt;">Please fix and try again.</p>',{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})}}function ToggleTuneTrainerMetronome(){gPlayMetronome=!gPlayMetronome,gLocalStorageAvailable&&(localStorage.PlayMetronome=gPlayMetronome),gTheOKButton.click(),setTimeout(function(){if(gPlayMetronome){if(!inject_one_metronome(gPlayerLooperProcessed,!1)){gPlayMetronome=!1;return DayPilot.Modal.alert('<p style="text-align:center;font-size:20pt;font-family:helvetica">Metronome Not Available for this Meter</p><p style="font-size:14pt;line-height:20pt;font-family:helvetica;">No metronome pattern is available for the meter of this tune.</p><p style="font-size:14pt;line-height:20pt;font-family:helvetica;">Only the original version can be played.</p>',{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()}).then(function(){TuneTrainerDialog(gPlayerLooperOriginal,gPlayerLooperProcessed,!0)}),void(gLocalStorageAvailable&&(localStorage.PlayMetronome=!1))}TuneTrainerDialog(gPlayerLooperOriginal,gPlayerLooperProcessed,!0)}else TuneTrainerDialog(gPlayerLooperOriginal,gPlayerLooperProcessed,!0)},250)}function ToggleLoopCountdown(){gLooperDoCountdown=document.getElementById("looper_docountdown").checked,gLocalStorageAvailable&&(localStorage.LooperDoCountdown=gLooperDoCountdown)}function SaveLoopCountdown(){gLooperCountdown=document.getElementById("looper_countdown").value,gLooperCountdown=parseInt(gLooperCountdown),isNaN(gLooperCountdown)&&(gLooperCountdown=5),gLooperCountdown<1&&(gLooperCountdown=5),gLocalStorageAvailable&&(localStorage.LooperCountdown=gLooperCountdown)}var gLooperSpeedStart=50,gLooperSpeedEnd=100,gLooperSpeedIncrement=10,gLooperCount=1,gLooperCurrent=gLooperSpeedStart,gLooperLoopCount=gLooperCount,gPlayerLooperOriginal=null,gPlayerLooperProcessed=null,gTouchIncrementFive=!1,gLooperDoCountdown=!0,gLooperCountdown=5;function TuneTrainerDialog(e,t,n){sendGoogleAnalytics("dialog","TuneTrainer");var o=0,a=0;if(gMIDIbuffer=null,gTheOKButton=null,n||(gPlayerLooperOriginal=e,gPlayerLooperProcessed=t),gPlayMetronome&&(t=inject_one_metronome(gPlayerLooperProcessed,!1)),gLooperCurrent=gLooperSpeedStart,gLooperLoopCount=gLooperCount,gLocalStorageAvailable&&(localStorage.LooperSpeedStart=gLooperSpeedStart,localStorage.LooperSpeedEnd=gLooperSpeedEnd,localStorage.LooperSpeedIncrement=gLooperSpeedIncrement,localStorage.LooperCount=gLooperCount),PlayerSetupCommon(t)){var l=GetRadioValue("notenodertab"),r=GetABCJSParams(l);r.oneSvgPerLine=!1,"noten"!=l&&r.tablature&&r.tablature.length>0&&(r.tablature[0].label="");var i,s=new CursorControl;if(gIsIOS){var c=ABCJS.synth.activeAudioContext();gTheMuteHandle=null,c&&(gTheMuteHandle=unmute(c,!1,!1))}!function(){var e;gLoopCallback=null,gStartPlayCallback=null,gPreStartPlayCallback=null,gPlayerInPause=!1,gLargePlayerControls?e=window.innerHeight-416:(e=window.innerHeight-396,isDesktopBrowser()&&isSafari()&&(e-=10)),modal_msg='<div id="playerholder" style="height:'+e+'px;overflow-y:auto;margin-bottom:15px;">',modal_msg+=gLargePlayerControls?'<div id="abcplayer" class="abcjs-large">':'<div id="abcplayer">',modal_msg+='<div id="playback-paper"></div>',modal_msg+="</div>",modal_msg+="</div>",modal_msg+=gLargePlayerControls?'<div id="playback-audio" class="abcjs-large"></div>':'<div id="playback-audio"></div>',modal_msg+='<p class="configure_looper_text" style="text-align:center;margin:0px;margin-top:20px">',modal_msg+='<span id="looper_text_1">Starting tempo:</span> <input style="width:75px;margin-right:4px;" id="looper_start_percent" type="number" min="1" step="1" max="400" title="Tune tempo start percentage" autocomplete="off"/><span id="looper_percent_span_1">%&nbsp;&nbsp;&nbsp;&nbsp;</span>',modal_msg+='<span id="looper_text_2">Ending tempo:</span> <input style="width:75px;margin-right:4px;" id="looper_end_percent" type="number" min="1" step="1" max="400" title="Tune tempo end percentage" autocomplete="off"/><span id="looper_percent_span_2">%&nbsp;&nbsp;&nbsp;&nbsp;</span>',modal_msg+='<span id="looper_text_3">Tempo increment:</span> <input style="width:75px;margin-right:4px;" id="looper_increment" type="number" min="0" step="1" max="400" title="Tempo increment percentage" autocomplete="off"/><span id="looper_percent_span_3">%</span>',modal_msg+="</p>",modal_msg+='<p class="configure_looper_text" style="text-align:center;margin:0px;margin-top:20px">',modal_msg+='<span id="looper_text_4">Increment tempo after how many loops:</span> <input style="width:60px;margin-right:14px;" id="looper_count" type="number" min="1" step="1" max="100" title="Increment tempo after this many times through the tune" autocomplete="off"/><span id="looper_text_5">Countdown?</span><input style="width:18px;margin-left:8px;margin-right:14px;" id="looper_docountdown" type="checkbox" onchange="ToggleLoopCountdown();"/><span id="looper_text_6">Countdown secs:</span><input style="width:60px;margin-left:8px;" id="looper_countdown" type="number" min="1" step="1" max="30" title="Countdown secs" autocomplete="off" onchange="SaveLoopCountdown();"/>',modal_msg+="</p>",modal_msg+='<p class="configure_looper_text" style="text-align:center;margin:0px;margin-top:20px">',modal_msg+='<input id="looperreset" class="looperreset button btn btn-looperreset" onclick="TuneTrainerReset();" type="button" value="Apply Tune Trainer Settings and Reload the Player" title="Applies the entered tune trainer settings and reloads the player">',modal_msg+=gPlayMetronome?'<input id="looper_metronomebutton" class="looper_metronome button btn btn-metronome" onclick="ToggleTuneTrainerMetronome();" type="button" value="Disable Metronome" title="Disables the metronome">':'<input id="looper_metronomebutton" class="looper_metronome button btn btn-metronome" onclick="ToggleTuneTrainerMetronome();" type="button" value="Enable Metronome" title="Enables the metronome">',modal_msg+="</p>",modal_msg+='<a id="looperhelp" href="https://michaeleskin.com/abctools/userguide.html#tune_trainer" target="_blank" style="text-decoration:none;" title="Learn more about the Tune Trainer" class="dialogcornerbutton">?</a>',modal_msg+='<p id="looperstatus"></p>',modal_msg+='<div id="looperstatusbar"></div>',modal_msg+='<div id="looperstatusbaroverlay"></div>',modal_msg+='<div id="loopercountdown" class="looper-modal"><div class="looper-modal-content"><div class="looper-modal-text" id="loopercountdowntext"></div></div></div>';var n,a=window.innerWidth;GetRadioValue("notenodertab"),isDesktopBrowser()?(n=a*(gPlayerScaling/100),giPadTwoColumn&&(n=isLandscapeOrientation()?a*(gPlayerScaling/100):.9*a),n<850&&(n=850)):n=800,DayPilot.Modal.alert(modal_msg,{theme:"modal_flat",top:20,width:n,okText:"Close",scrollWithPage:isMobileBrowser()}),document.getElementById("looper_start_percent").value=gLooperSpeedStart,document.getElementById("looper_end_percent").value=gLooperSpeedEnd,document.getElementById("looper_increment").value=gLooperSpeedIncrement,document.getElementById("looper_count").value=gLooperCount,document.getElementById("looper_docountdown").checked=gLooperDoCountdown,document.getElementById("looper_countdown").value=gLooperCountdown,gTrainerTouchControls&&(document.getElementById("looper_text_1").onclick=h,document.getElementById("looper_text_2").onclick=h,document.getElementById("looper_text_3").onclick=h,document.getElementById("looper_text_4").onclick=h,document.getElementById("looper_percent_span_1").onclick=f,document.getElementById("looper_percent_span_2").onclick=f,document.getElementById("looper_percent_span_3").onclick=f),o=function(){if(gLooperSpeedStart==gLooperSpeedEnd||0==gLooperSpeedIncrement)return 1;for(var e=0,t=gLooperSpeedEnd,n=gLooperSpeedIncrement,o=gLooperCount,a=gLooperSpeedStart;a<t;)e+=o,a+=n;return e}(),document.getElementById("looper_metronomebutton").value=gPlayMetronome?"Disable Metronome":"Enable Metronome";for(var l=document.getElementsByClassName("modal_flat_ok"),r=null,c=0;c<l.length;++c)if("Close"==(r=l[c]).innerText){gTheOKButton=r;var d=r.onclick;r.onclick=function(){d(),gSynthControl=null,i&&(i.destroy(),i=null),FocusAfterOperation(),gIsIOS&&gTheMuteHandle&&(gTheMuteHandle.dispose(),gTheMuteHandle=null)};break}ABCJS.synth.supportsAudio()?(i=new ABCJS.synth.SynthController(t)).load("#playback-audio",s,{displayLoop:!1,displayRestart:!0,displayPlay:!0,displayProgress:!0,displayWarp:!0}):document.querySelector("#playback-audio").innerHTML="<div class='audio-error'>Audio is not supported in this browser.</div>",g(!1),gPlayerHolder=document.getElementById("playerholder"),gPlayerContainerRect=gPlayerHolder.getBoundingClientRect()}()}function g(e){i.disable(!0);var n=ABCJS.renderAbc("playback-paper",t,r)[0];postProcessTab([n],"playback-paper",l,!0);var o=new ABCJS.synth.CreateSynth(t);gMIDIbuffer=o,gMIDIInitStillWaiting=!1,SetupPlayerEventHandlers(),o.init({visualObj:n}).then(function(o){if(i){var a=computeFade(t);i.setTune(n,e,{fadeLength:a}).then(function(e){if(console.log("Audio successfully loaded."),verifyCustomInstrumentsLoaded(t),i.forceWarp(gLooperCurrent),i.isLooping=!0,gLoopCallback=u,gStartPlayCallback=m,gPreStartPlayCallback=p,gSynthControl=i,(n=document.getElementsByClassName("abcjs-midi-tempo"))&&n.length>0&&(n[0].onclick=SetPlayerTempo),gTrainerTouchControls){var n,o=document.getElementsByClassName("abcjs-midi-clock"),a=document.getElementsByClassName("abcjs-midi-current-tempo-wrapper");if(o&&a&&o.length>0&&a.length>0)(n=o[0]).onclick=DecrementTempo,(n=a[0]).onclick=IncrementTempo}}).catch(function(e){hideTheSpinner(),gMIDIInitStillWaiting=!1,console.log("Problem loading audio for this tune")})}}).catch(function(e){hideTheSpinner(),gMIDIInitStillWaiting=!1,console.log("Problem loading audio for this tune")})}function d(){if(!(a>o)){if(gLooperSpeedStart==gLooperSpeedEnd||0==gLooperSpeedIncrement){var e=document.getElementById("looperstatusbaroverlay");return e.style.display="block",(e=document.getElementById("looperstatusbar")).style.display="block",void(e.style.width="212px")}setTimeout(function(){var e,t=document.getElementById("looperstatusbaroverlay");t.style.display="block",(t=document.getElementById("looperstatusbar")).style.display="block",e=a/o*212,t.style.width=e+"px"},10)}}function u(){if(gPlayerInPause)gPlayerInPause=!1;else if(isNaN(gLooperSpeedEnd)||isNaN(gLooperSpeedIncrement)||isNaN(gLooperCount))gPlayerInPause=!1;else{a++;var e=!1;if(gLooperCurrent==gLooperSpeedEnd&&(e=!0),0!=gLooperSpeedIncrement){0==--gLooperLoopCount&&(gLooperLoopCount=gLooperCount,gLooperCurrent!=gLooperSpeedEnd?((gLooperCurrent+=gLooperSpeedIncrement)>=gLooperSpeedEnd&&(gLooperCurrent=gLooperSpeedEnd,e=!0),i.pause(),i.forceWarp(gLooperCurrent)):e=!0);var t=document.getElementById("looperstatus");t.innerHTML=e?"Tempo:&nbsp;"+gLooperCurrent+"%":gLooperSpeedStart!=gLooperSpeedEnd&&0!=gLooperSpeedIncrement?"Tempo:&nbsp;"+gLooperCurrent+"%&nbsp;&nbsp;-&nbsp;&nbsp;Loop "+(gLooperCount-gLooperLoopCount+1)+" of "+gLooperCount:"Tempo:&nbsp;"+gLooperCurrent+"%",d()}}}function m(){var e=document.getElementById("looperstatus");gLooperSpeedStart!=gLooperSpeedEnd&&0!=gLooperSpeedIncrement?e.innerHTML="Tempo:&nbsp;"+gLooperCurrent+"%&nbsp;&nbsp;-&nbsp;&nbsp;Loop 1 of "+gLooperCount:(e=document.getElementById("looperstatus")).innerHTML="Tempo:&nbsp;"+gLooperCurrent+"%";d()}function p(e){if(gLooperDoCountdown=document.getElementById("looper_docountdown").checked,gLooperCountdown=document.getElementById("looper_countdown").value,gLooperCountdown=parseInt(gLooperCountdown),isNaN(gLooperCountdown)&&(gLooperCountdown=5),gLooperCountdown<1&&(gLooperCountdown=5),gLocalStorageAvailable&&(localStorage.LooperDoCountdown=gLooperDoCountdown,localStorage.LooperCountdown=gLooperCountdown),gLooperDoCountdown){var t=document.getElementById("loopercountdown");t.style.display="block";var n=gLooperCountdown,o=document.getElementById("loopercountdowntext");o.textContent=n;var a=setInterval(function(){n--,o.textContent=n,n<=0&&(clearInterval(a),t.style.display="none",setTimeout(function(){e()},1e3))},1e3)}else e()}function h(e){var t=this.innerHTML,n=null,o=0;0==t.indexOf("Starting")?(n=document.getElementById("looper_start_percent"),o=0):0==t.indexOf("Ending")?(n=document.getElementById("looper_end_percent"),o=1):0==t.indexOf("Tempo")?(n=document.getElementById("looper_increment"),o=2):0==t.indexOf("Increment")&&(n=document.getElementById("looper_count"),o=3);const a=this.getBoundingClientRect();var l=!0,r=1;e.clientX-a.left>a.width/2?(l=!1,3!=o&&gTouchIncrementFive&&(r=5)):3!=o&&gTouchIncrementFive&&(r=5);var i=n.value;switch(o){case 0:case 1:i=parseFloat(i),l?(i-=r)<1&&(i=1):(i+=r)>400&&(i=400);break;case 2:i=parseFloat(i),l?(i-=r)<0&&(i=0):(i+=r)>400&&(i=400);break;case 3:i=parseInt(i),l?(i-=r)<1&&(i=1):(i+=r)>100&&(i=100)}n.value=i}function f(){gTouchIncrementFive=!gTouchIncrementFive}}var gSynthControl=null;function DecrementTempo(){var e=document.getElementsByClassName("abcjs-midi-tempo");if(e&&e.length>0){var t=e[0],n=t.value;n=parseInt(n),isNaN(n)||n>5&&(n-=5,t.value=n,gSynthControl.pause(),gSynthControl.forceWarp(n),gLastWarp=n,gLocalStorageAvailable&&(localStorage.LastWarp=gLastWarp))}}function IncrementTempo(){var e=document.getElementsByClassName("abcjs-midi-tempo");if(e&&e.length>0){var t=e[0],n=t.value;n=parseInt(n),isNaN(n)||(n+=5,t.value=n,gSynthControl.pause(),gSynthControl.forceWarp(n),gLastWarp=n,gLocalStorageAvailable&&(localStorage.LastWarp=gLastWarp))}}function SetPlayerTempo(e){var t,n,o=document.getElementsByClassName("abcjs-midi-tempo");if(!(o&&o.length>0))return;t=(n=o[0]).value,t=parseInt(t),isNaN(t)&&(t=100);const a={configure_tempo:t};var l=250;isMobileBrowser()&&(l=125);DayPilot.Modal.form([{html:'<p style="text-align:center;margin-bottom:32px;font-size:16pt;font-family:helvetica;margin-left:15px;">Set Tempo Percentage&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#playing_your_tunes" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{name:"Tempo percentage:",id:"configure_tempo",type:"number",cssClass:"configure_staffwidth_form_text"}],a,{theme:"modal_flat",top:l,width:400,scrollWithPage:AllowDialogsToScroll(),autoFocus:!0}).then(function(e){if(!e.canceled){var t=e.result.configure_tempo;if(t=parseInt(t),isNaN(t))return;if(t<0)return;n.value=t,gSynthControl.pause(),gSynthControl.forceWarp(t),gLastWarp=t,gLocalStorageAvailable&&(localStorage.LastWarp=gLastWarp)}})}function setupDGDAE(){var e=document.getElementById("b5");e.value="dgdae",(e=document.getElementById("b5label")).title="Shows DGDAE 5-string Bouzouki tablature",e.innerHTML="DGDAE"}function setupCGDAE(){var e=document.getElementById("b5");e.value="cgdae",(e=document.getElementById("b5label")).title="Shows CGDAE 5-string Fiddle tablature",e.innerHTML="CGDAE"}function setupCGDA(){var e=document.getElementById("b4");e.value="cgda",(e=document.getElementById("b4label")).title="Shows CGDA Mandola/Mandocello tablature",e.innerHTML="CGDA"}function setupGDAD(){var e=document.getElementById("b4");e.value="gdad",(e=document.getElementById("b4label")).title="Shows GDAD Bouzouki tablature",e.innerHTML="GDAD"}function setupWhistleTab(){var e=document.getElementById("b9");e.value="whistle",(e=document.getElementById("b9label")).title="Shows Tin Whistle (D) tablature",e.innerHTML="Whistle",e.style.padding="0.8rem 0.7rem 0.7rem 0.7rem"}function setupRecorderTab(){var e=document.getElementById("b9");e.value="recorder",(e=document.getElementById("b9label")).title="Shows Baroque Recorder tablature",e.innerHTML="Recorder",e.style.padding="0.8rem 7px 0.7rem 7px"}var gHarmonicaCustom,gAlwaysInjectPrograms=!0,gTheMelodyProgram=0,gTheBassProgram=0,gTheChordProgram=0,gAlwaysInjectVolumes=!0,gTheBassVolume=64,gTheChordVolume=64,gOverridePlayMIDIParams=!1,gInjectTab_StripChords=!0,gOpenLinksInTrainer=!1,gInjectTab_FontFamily="Palatino",gInjectTab_TabFontSize=11,gInjectTab_StaffSep=80,gInjectTab_MusicSpace=10,gInjectTab_TabLocation=1,gInjectTab_ConcertinaStyle=0,gInjectTab_ConcertinaTuning=0,gInjectTab_ConcertinaFingering=0,gInjectTab_GaryCoover=!1,gInjectTab_BoxTabStyle=0,gInjectTab_Colors=!1,gInjectTab_PushGlyph="↓",gInjectTab_DrawGlyph="↑",gInjectTab_UseBarForDraw=!1,gLargePlayerControls=!1,gTrainerTouchControls=!1,gBambooFluteKey=1,gMDulcimerStyle=0,gMDulcimerStripBadTunes=!1,gMDulcimerUseDashForOpenString=!1,gHarmonicaTuning="0",gHarmonicaKey="C",gHarmonicaOctave="0",gHarmonicaPlusSign=!1,gHarmonicaStacking=!0,gHarmonicaTabColors=!1;const gHarmonicaCustomDefault={version:3,type:"CustomHarmonica",name:"Custom",noteMap:["1","-1'","-1","1o","2","-2''","-2'","3","-3'''","-3''","-3'","-3","4","-4'","-4","4o","5","-5","5o","6","-6'","-6","6o","-7","7","-7o","-8","8'","8","-9","9'","9","-9o","-10","10''","10'","10","-10o'","x","x","x","x","x","x","x","x","x","x","x","x","x","x","x","x","x","x","x","x","x","x"]};var gCustomTab,gCustomTabKey="0",gCustomTabOctave="0";const gCustomTabDefault={version:2,type:"CustomTab",name:"Default (Scale Semitone Numbers)",noteMap:["0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59"]};function GetInitialConfigurationSettings(){gAlwaysInjectPrograms=!0,val=localStorage.TheMelodyProgram,gTheMelodyProgram=val||0,val=localStorage.TheBassProgram,gTheBassProgram=val||0,val=localStorage.TheChordProgram,gTheChordProgram=val||0,gAlwaysInjectVolumes=!0,val=localStorage.OpenLinksInTrainer,gOpenLinksInTrainer=!!val&&"true"==val,val=localStorage.TheBassVolume,gTheBassVolume=val||64,val=localStorage.TheChordVolume,gTheChordVolume=val||64,val=localStorage.OverridePlayMIDIParams,gOverridePlayMIDIParams=!!val&&"true"==val,val=localStorage.PlayAlternateChordsOverride,val?gPlayAlternateChordsOverride="true"==val:gPlayAlternateChordsOverride=!1,val=localStorage.InjectTab_FontFamily,gInjectTab_FontFamily=val||"Palatino",val=localStorage.InjectTab_TabFontSize,gInjectTab_TabFontSize=val||10,val=localStorage.InjectTab_StaffSep,gInjectTab_StaffSep=val||80,val=localStorage.InjectTab_MusicSpace,gInjectTab_MusicSpace=val||10,val=localStorage.InjectTab_TabLocation,gInjectTab_TabLocation=val||1,val=localStorage.InjectTab_ConcertinaTuning,gInjectTab_ConcertinaTuning=val||0,val=localStorage.InjectTab_ConcertinaStyle,gInjectTab_ConcertinaStyle=val||0,val=localStorage.InjectTab_ConcertinaFingering,gInjectTab_ConcertinaFingering=val||1,val=localStorage.InjectTab_GaryCoover,gInjectTab_GaryCoover=!!val&&"true"==val,val=localStorage.InjectTab_Colors,gInjectTab_Colors=!!val&&"true"==val,val=localStorage.InjectTab_BoxTabStyle,gInjectTab_BoxTabStyle=val||0,val=localStorage.InjectTab_StripChords,gInjectTab_StripChords=!val||"true"==val,val=localStorage.InjectTab_PushGlyph,gInjectTab_PushGlyph=val||"↓",val=localStorage.InjectTab_DrawGlyph,gInjectTab_DrawGlyph=val||"↑",val=localStorage.InjectTab_UseBarForDraw,gInjectTab_UseBarForDraw=!!val&&"true"==val,val=localStorage.FullScreenScaling,gFullScreenScaling=val||50;var e=localStorage.angloButtonNames2;e?gAngloButtonNames=JSON.parse(e):resetAngloButtonNames();var t=localStorage.musicXMLImportOptionsV6;t?gMusicXMLImportOptions=JSON.parse(t):resetMusicXMLImportOptions(),val=localStorage.LargePlayerControls,gLargePlayerControls=val?"true"==val:!(!gIsIPhone&&!gIsAndroid),val=localStorage.TrainerTouchControls,gTrainerTouchControls=val?"true"==val:!!(gIsIPhone||gIsAndroid||gIsIPad),val=localStorage.HarmonicaTuning,gHarmonicaTuning=val||"0",val=localStorage.HarmonicaKey,gHarmonicaKey=val||"C",val=localStorage.HarmonicaOctave,gHarmonicaOctave=val||"0",val=localStorage.HarmonicaPlusSign,gHarmonicaPlusSign=!!val&&"true"==val,val=localStorage.HarmonicaStacking,gHarmonicaStacking=!val||"true"==val,val=localStorage.HarmonicaTabColors,gHarmonicaTabColors=!!val&&"true"==val;var n=localStorage.HarmonicaCustom;if(n){if(1==(gHarmonicaCustom=JSON.parse(n)).version){gHarmonicaCustom.version=3;for(var o=0;o<22;++o)gHarmonicaCustom.noteMap.push("x");localStorage.HarmonicaCustom=JSON.stringify(gHarmonicaCustom)}else if(2==gHarmonicaCustom.version){gHarmonicaCustom.version=3;for(o=0;o<12;++o)gHarmonicaCustom.noteMap.push("x");localStorage.HarmonicaCustom=JSON.stringify(gHarmonicaCustom)}}else resetHarmonicaCustom();val=localStorage.CustomTabKey,gCustomTabKey=val||"0",val=localStorage.CustomTabOctave,gCustomTabOctave=val||"0";var a=localStorage.CustomTab;if(a){if(1==(gCustomTab=JSON.parse(a)).version){gCustomTab.version=2;for(o=0;o<12;++o)gCustomTab.noteMap.push("x");localStorage.CustomTab=JSON.stringify(gCustomTab)}}else resetCustomTab();val=localStorage.BambooFluteKey,gBambooFluteKey=val||1,val=localStorage.MDulcimerStyle,gMDulcimerStyle=val||0,val=localStorage.MDulcimerStripBadTunes,gMDulcimerStripBadTunes=!!val&&"true"==val,val=localStorage.MDulcimerUseDashForOpenString,gMDulcimerUseDashForOpenString=!!val&&"true"==val;var l=localStorage.RenderingFonts;if(l)try{(gRenderingFonts=JSON.parse(l)).tablabelfont||(gRenderingFonts.tablabelfont="Trebuchet MS 14"),gRenderingFonts.tabgracefont||(gRenderingFonts.tabgracefont="Arial 8")}catch(e){resetABCRenderingFonts()}else resetABCRenderingFonts();var r=localStorage.abcShowTabNames;if(gShowTabNames=!r||"true"==r,val=localStorage.abcCapo,gCapo=val||0,val=localStorage.MP3Bitrate,gMP3Bitrate=val||224,val=localStorage.theSoundFont4,val?(gDefaultSoundFont=val,gTheActiveSoundFont=val):gTheActiveSoundFont=gDefaultSoundFont="https://paulrosen.github.io/midi-js-soundfonts/FluidR3_GM/",val=localStorage.AutoscrollPlayer,gAutoscrollPlayer=!val||"true"==val,val=localStorage.AutoscrollSmooth,gAutoscrollSmooth=!val||"true"==val,val=localStorage.AutoscrollTarget,val){var i=parseFloat(val);isNaN(i)||((gAutoscrollTarget=i)<0||gAutoscrollTarget>100)&&(gAutoscrollTarget=66)}else gAutoscrollTarget=66;if(val=localStorage.AutoSwingHornpipes,gAutoSwingHornpipes=!val||"true"==val,val=localStorage.AutoSwingFactor,val){i=parseFloat(val);isNaN(i)||(gAutoSwingFactor=i)}else gAutoSwingFactor=.25;val=localStorage.UseCustomGMSounds,gUseCustomGMSounds=!val||"true"==val,val=localStorage.TipJarCount,gTipJarCount=val||0,val=localStorage.SavedSnapshot,val||(localStorage.SavedSnapshot=""),val=localStorage.SavedSnapshot2,val||(localStorage.SavedSnapshot2=""),val=localStorage.SavedSnapshot3,val||(localStorage.SavedSnapshot3=""),val=localStorage.SavedSnapshot4,val||(localStorage.SavedSnapshot4=""),val=localStorage.SaveLastAutoSnapShot,gSaveLastAutoSnapShot=!!val&&"true"==val,val=localStorage.LastAutoSnapShot,val||(localStorage.LastAutoSnapShot=""),val=localStorage.PDFFont,val&&(gPDFFont=val),val=localStorage.PDFFontStyle,val&&(gPDFFontStyle=val),val=localStorage.PDFOrientation,val&&(gPDFOrientation=val),val=localStorage.PDFIncludeHiddenTitles,val&&(gPDFIncludeHiddenTitles="true"==val),val=localStorage.PDFAutoPageNumbers,val&&(gPDFAutoPageNumbers="true"==val),val=localStorage.UseComhaltasABC,val&&(gUseComhaltasABC="true"==val),val=localStorage.AllowMIDIInput,val&&(gAllowMIDIInput="true"==val),val=localStorage.MIDIChromatic,val&&(gMIDIChromatic="true"==val);var s=localStorage.PDFTunebookConfig;if(s?(null!=(gPDFTunebookConfig=JSON.parse(s)).bAdd_add_full_tunebook&&null!=gPDFTunebookConfig.bAdd_add_full_tunebook||(gPDFTunebookConfig.bAdd_add_full_tunebook=!1),null!=gPDFTunebookConfig.bAdd_add_fonts&&null!=gPDFTunebookConfig.bAdd_add_fonts||(gPDFTunebookConfig.bAdd_add_fonts=!1)):resetPDFTunebookConfig(),val=localStorage.LooperSpeedStart,val?(gLooperSpeedStart=parseFloat(val),isNaN(gLooperSpeedStart)&&(gLooperSpeedStart=50)):gLooperSpeedStart=50,val=localStorage.LooperSpeedEnd,val?(gLooperSpeedEnd=parseFloat(val),isNaN(gLooperSpeedEnd)&&(gLooperSpeedEnd=100)):gLooperSpeedEnd=100,val=localStorage.LooperSpeedIncrement,val?(gLooperSpeedIncrement=parseFloat(val),isNaN(gLooperSpeedIncrement)&&(gLooperSpeedIncrement=10)):gLooperSpeedIncrement=10,val=localStorage.LooperCount,val?(gLooperCount=parseInt(val),isNaN(gLooperCount)&&(gLooperCount=1)):gLooperCount=1,val=localStorage.LooperDoCountdown,gLooperDoCountdown=!val||"true"==val,val=localStorage.LooperCountdown,val?(gLooperCountdown=parseInt(val),isNaN(gLooperCountdown)&&(gLooperCountdown=5)):gLooperCountdown=5,val=localStorage.abcStaffSpacing,val){i=parseInt(val);gStaffSpacing=isNaN(i)?STAFFSPACEOFFSET+STAFFSPACEDEFAULT:STAFFSPACEOFFSET+i}else{var c=(gStaffSpacing=STAFFSPACEOFFSET+STAFFSPACEDEFAULT)-STAFFSPACEOFFSET;localStorage.abcStaffSpacing=c}(val=localStorage.BatchExportDelayMS,val?(gBatchExportDelayMS=parseInt(val),(isNaN(gBatchExportDelayMS)||gBatchExportDelayMS<0)&&(gBatchExportDelayMS=200)):gBatchExportDelayMS=200,val=localStorage.BatchMP3ExportDelayMS,val?(gBatchMP3ExportDelayMS=parseInt(val),(isNaN(gBatchMP3ExportDelayMS)||gBatchMP3ExportDelayMS<0)&&(gBatchMP3ExportDelayMS=250)):gBatchMP3ExportDelayMS=250,val=localStorage.ExportWidth,val?(gExportWidth=parseInt(val),(isNaN(gExportWidth)||gExportWidth<0)&&(gExportWidth=2400)):gExportWidth=2400,val=localStorage.ExportWidthAll,val?(gExportWidthAll=parseInt(val),(isNaN(gExportWidthAll)||gExportWidthAll<0)&&(gExportWidthAll=2400)):gExportWidthAll=2400,val=localStorage.MetronomeHighVolume,val?(gMetronomeHighVolume=parseInt(val),(isNaN(gMetronomeHighVolume)||gMetronomeHighVolume<0||gMetronomeHighVolume>127)&&(gMetronomeHighVolume=64)):gMetronomeHighVolume=64,val=localStorage.MetronomeLowVolume,val?(gMetronomeLowVolume=parseInt(val),(isNaN(gMetronomeLowVolume)||gMetronomeLowVolume<0||gMetronomeLowVolume>127)&&(gMetronomeLowVolume=48)):gMetronomeLowVolume=48,val=localStorage.MetronomeHighSound,val?(gMetronomeHighSound=parseInt(val),(isNaN(gMetronomeHighSound)||gMetronomeHighSound<35||gMetronomeHighSound>81)&&(gMetronomeHighSound=76)):gMetronomeHighSound=76,val=localStorage.MetronomeLowSound,val?(gMetronomeLowSound=parseInt(val),(isNaN(gMetronomeLowSound)||gMetronomeLowSound<35||gMetronomeLowSound>81)&&(gMetronomeLowSound=77)):gMetronomeLowSound=77,gRawFirstTime=!0,val=localStorage.RawFirstTime,val&&(gRawFirstTime="true"==val),gRawHighlightColor="#F00000",val=localStorage.RawHighlightColor,val&&(gRawHighlightColor=val),gPlayerStatusOnLeft=!1,val=localStorage.PlayerStatusOnLeft,val&&(gPlayerStatusOnLeft="true"==val),gDisableSelectedPlay=!1,val=localStorage.DisableSelectedPlay,val&&(gDisableSelectedPlay="true"==val),gRollUseRollForIrishRoll=!0,val=localStorage.RollUseRollForIrishRoll2,val&&(gRollUseRollForIrishRoll="true"==val),gRoll2DefaultParams="0.95 0.8 1.0 0.75 0.9 1.0 0.75 1.0",val=localStorage.Roll2DefaultParams,val)&&(validate_roll_2_params(val,!1)&&(gRoll2DefaultParams=val,validate_roll_2_params(val,!0)));(gRoll3DefaultParams="1.45 0.6 1.0 0.75 0.9 1.0 0.75 1.0",val=localStorage.Roll3DefaultParams,val)&&(validate_roll_3_params(val,!1)&&(gRoll3DefaultParams=val,validate_roll_3_params(val,!0)));if(gDefaultTuneDatabase=0,val=localStorage.DefaultTuneDatabase,val&&(gDefaultTuneDatabase=parseInt(val)),gTuneDatabaseRetryTimeMS=3e3,val=localStorage.TuneDatabaseRetryTimeMS,val&&(gTuneDatabaseRetryTimeMS=parseInt(val)),gTuneDatabaseRetryCount=10,val=localStorage.TuneDatabaseRetryCount,val&&(gTuneDatabaseRetryCount=parseInt(val)),gLastTuneSearchValue="",val=localStorage.LastTuneSearchValue,val&&(gLastTuneSearchValue=val),gShapeNoteStyle=0,val=localStorage.ShapeNoteStyle,val&&(gShapeNoteStyle=val),gFeaturesShowSearch=!0,val=localStorage.FeaturesShowSearch,val&&(gFeaturesShowSearch="true"==val),gFeaturesShowExamples=!0,val=localStorage.FeaturesShowExamples,val&&(gFeaturesShowExamples="true"==val),gFeaturesShowTemplates=!0,val=localStorage.FeaturesShowTemplates,val&&(gFeaturesShowTemplates="true"==val),gFeaturesShowTablatures=!0,val=localStorage.FeaturesShowTablatures,val&&(gFeaturesShowTablatures="true"==val),gFeaturesShowExplorers=!0,val=localStorage.FeaturesShowExplorers,val&&(gFeaturesShowExplorers="true"==val),gFeaturesShowExport=!0,val=localStorage.FeaturesShowExport,val&&(gFeaturesShowExport="true"==val),gFeaturesShowBagpipeDrones=!0,val=localStorage.FeaturesShowBagpipeDrones,val&&(gFeaturesShowBagpipeDrones="true"==val),gFeaturesShowTabButtons=!0,val=localStorage.FeaturesShowTabButtons,val&&(gFeaturesShowTabButtons="true"==val),val=localStorage.ABCEditorFontSize,val?(gABCEditorFontsize=parseInt(val),isNaN(gABCEditorFontsize)&&(gABCEditorFontsize=13)):gABCEditorFontsize=13,gShowDiagnostics=!1,val=localStorage.ShowDiagnostics,val&&(gShowDiagnostics="true"==val),gReverbString="chamber 0.95 0.05",val=localStorage.ReverbString2,val&&(gReverbString=val),gDoTinyURLAPIKeyOverride=!1,gTinyURLAPIKeyOverride="",val=localStorage.TinyURLAPIKeyOverride,val&&""!=val&&(gDoTinyURLAPIKeyOverride=!0,gTinyURLAPIKeyOverride=val),gTinyURLCount=0,val=localStorage.TinyURLCount,val&&(gTinyURLCount=val),gMIDIImportWarned=!1,val=localStorage.MIDIImportWarned,val&&(gMIDIImportWarned="true"==val),gShowDGDAETab=!1,val=localStorage.ShowDGDAETab,val&&(gShowDGDAETab="true"==val)&&setupDGDAE(),gShowCGDATab=!1,val=localStorage.ShowCGDATab,val&&(gShowCGDATab="true"==val)&&setupCGDA(),gShowRecorderTab=!1,val=localStorage.ShowRecorderTab,val&&(gShowRecorderTab="true"==val)&&setupRecorderTab(),gRecorderFingeringGerman=!1,val=localStorage.RecorderFingeringGerman,val&&(gRecorderFingeringGerman="true"==val),gConfirmClear=!0,val=localStorage.ConfirmClear,val&&(gConfirmClear="true"==val),gCleanSmartQuotes=!0,val=localStorage.CleanSmartQuotes,val&&(gCleanSmartQuotes="true"==val),gAllowOfflineInstruments=!1,val=localStorage.AllowOfflineInstruments,val&&(gAllowOfflineInstruments="true"==val),giPadTwoColumn=!1,val=localStorage.iPadTwoColumn,(giPadTwoColumn=!!val&&"true"==val)&&(gLargePlayerControls=!0),val=localStorage.PlayerScaling,gPlayerScaling=val||(gIsIPad?60:50),BuildTuneSetRepeat=!1,val=localStorage.BuildTuneSetRepeat,val&&(BuildTuneSetRepeat="true"==val),BuildTuneSetVerbose=!0,val=localStorage.BuildTuneSetVerbose,val&&(BuildTuneSetVerbose="true"==val),BuildTuneSetRepeatCount=1,val=localStorage.BuildTuneSetRepeatCount,val&&(BuildTuneSetRepeatCount=parseInt(val),isNaN(BuildTuneSetRepeatCount)&&(BuildTuneSetRepeatCount=1),BuildTuneSetRepeatCount<1&&(BuildTuneSetRepeatCount=1)),gForceAndroid=!1,val=localStorage.forceAndroid,val&&(gForceAndroid="true"==val),gDisableAndroid=!1,val=localStorage.disableAndroid,val&&(gDisableAndroid="true"==val),gZoomBannerAlwaysHidden=!1,val=localStorage.ZoomBannerAlwaysHidden,val&&(gZoomBannerAlwaysHidden="true"==val),val=localStorage.CustomStringedCount,val?(gCustomStringedCount=parseInt(val),isNaN(gCustomStringedCount)&&(gCustomStringedCount=6)):gCustomStringedCount=6,val=localStorage.CustomStringedCapo,val?(gCustomStringedCapo=parseInt(val),isNaN(gCustomStringedCapo)&&(gCustomStringedCapo=0)):gCustomStringedCapo=0,val=localStorage.CustomStringedString1,gCustomStringedString1=val||""==val?val:"D,",val=localStorage.CustomStringedString2,gCustomStringedString2=val||""==val?val:"A,",val=localStorage.CustomStringedString3,gCustomStringedString3=val||""==val?val:"D",val=localStorage.CustomStringedString4,gCustomStringedString4=val||""==val?val:"G",val=localStorage.CustomStringedString5,gCustomStringedString5=val||""==val?val:"B",val=localStorage.CustomStringedString6,gCustomStringedString6=val||""==val?val:"e",val=localStorage.CustomStringedLabel,gCustomStringedLabel=val||""==val?val:"Guitar - Drop D",val=localStorage.IncipitsBuilderBars,val?(gIncipitsBuilderBars=parseInt(val),isNaN(gIncipitsBuilderBars)&&(gIncipitsBuilderBars=3)):gIncipitsBuilderBars=3,val=localStorage.IncipitsBuilderWidth,val?(gIncipitsBuilderWidth=parseInt(val),isNaN(gIncipitsBuilderWidth)&&(gIncipitsBuilderWidth=400)):gIncipitsBuilderWidth=400,gIncipitsBuilderLeftJustify=!0,val=localStorage.IncipitsBuilderLeftJustify,val&&(gIncipitsBuilderLeftJustify="true"==val),gIncipitsBuilderInjectNumbers=!1,val=localStorage.IncipitsBuilderInjectNumbers,val&&(gIncipitsBuilderInjectNumbers="true"==val),gIncipitsBuilderStripText=!0,val=localStorage.IncipitsBuilderStripText,val&&(gIncipitsBuilderStripText="true"==val),val=localStorage.IncipitsTagsToStrip,gIncipitsTagsToStrip=val||""==val?val:"ABCDINOSWwZ",gIncipitsBuilderMultiPart=!0,val=localStorage.IncipitsBuilderMultiPart,val&&(gIncipitsBuilderMultiPart="true"==val),gIncipitsBuilderOwnLines=!1,val=localStorage.IncipitsBuilderOwnLines,val&&(gIncipitsBuilderOwnLines="true"==val),val=localStorage.LastWarp,val?(gLastWarp=parseInt(val),isNaN(gLastWarp)&&(gLastWarp=100)):gLastWarp=100,gLastPlayerRepeat=!1,val=localStorage.LastPlayerRepeat,val&&(gLastPlayerRepeat="true"==val),gPlayMetronome=!1,val=localStorage.PlayMetronome,val&&(gPlayMetronome="true"==val),document.querySelectorAll('style[custom_cursor_definition="true"]').forEach(e=>e.remove()),gUseWidePlayCursor=!0,val=localStorage.UseWidePlayCursor,val&&(gUseWidePlayCursor="true"==val),gUseWidePlayCursor){const e=document.createElement("style");e.setAttribute("custom_cursor_definition","true"),e.textContent=".abcjs-cursor{stroke:#00F000;stroke-width:12px;stroke-opacity:0.25;transform:translate(7px,0px);}",document.head.appendChild(e)}gJumpToTuneAutoscroll=!0,val=localStorage.JumpToTuneAutoscroll,val&&(gJumpToTuneAutoscroll="true"==val),gCustomInstrumentShowStatus=!0,val=localStorage.CustomInstrumentShowStatus,val&&(gCustomInstrumentShowStatus="true"==val),gEnableSyntax=isPureDesktopBrowser(),val=localStorage.EnableSyntax4,val&&(gEnableSyntax="true"==val),gSyntaxDarkMode=!1,val=localStorage.SyntaxDarkMode,val&&(gSyntaxDarkMode="true"==val),gEnableSyntaxMessageDelivered=!1,val=localStorage.EnableSyntaxMessageDelivered,val&&(gEnableSyntaxMessageDelivered="true"==val),gAlwaysFlattenParts=!1,val=localStorage.AlwaysFlattenParts,val&&(gAlwaysFlattenParts="true"==val),ensureInitialAbcThemeApplied(),SaveConfigurationSettings()}function SaveConfigurationSettings(){if(gLocalStorageAvailable){localStorage.TheMelodyProgram=gTheMelodyProgram,localStorage.TheBassProgram=gTheBassProgram,localStorage.TheChordProgram=gTheChordProgram,localStorage.OpenLinksInTrainer=gOpenLinksInTrainer,localStorage.TheBassVolume=gTheBassVolume,localStorage.TheChordVolume=gTheChordVolume,localStorage.OverridePlayMIDIParams=gOverridePlayMIDIParams,localStorage.PlayAlternateChordsOverride=gPlayAlternateChordsOverride,localStorage.InjectTab_StripChords=gInjectTab_StripChords,localStorage.InjectTab_FontFamily=gInjectTab_FontFamily,localStorage.InjectTab_TabFontSize=gInjectTab_TabFontSize,localStorage.InjectTab_StaffSep=gInjectTab_StaffSep,localStorage.InjectTab_MusicSpace=gInjectTab_MusicSpace,localStorage.InjectTab_TabLocation=gInjectTab_TabLocation,localStorage.InjectTab_ConcertinaTuning=gInjectTab_ConcertinaTuning,localStorage.InjectTab_ConcertinaStyle=gInjectTab_ConcertinaStyle,localStorage.InjectTab_ConcertinaFingering=gInjectTab_ConcertinaFingering,localStorage.InjectTab_GaryCoover=gInjectTab_GaryCoover,localStorage.InjectTab_Colors=gInjectTab_Colors,localStorage.InjectTab_BoxTabStyle=gInjectTab_BoxTabStyle,localStorage.InjectTab_PushGlyph=gInjectTab_PushGlyph,localStorage.InjectTab_DrawGlyph=gInjectTab_DrawGlyph,localStorage.InjectTab_UseBarForDraw=gInjectTab_UseBarForDraw,localStorage.FullScreenScaling=gFullScreenScaling,localStorage.angloButtonNames2=JSON.stringify(gAngloButtonNames),localStorage.musicXMLImportOptionsV6=JSON.stringify(gMusicXMLImportOptions),localStorage.LargePlayerControls=gLargePlayerControls,localStorage.TrainerTouchControls=gTrainerTouchControls,localStorage.HarmonicaTuning=gHarmonicaTuning,localStorage.HarmonicaKey=gHarmonicaKey,localStorage.HarmonicaOctave=gHarmonicaOctave,localStorage.HarmonicaPlusSign=gHarmonicaPlusSign,localStorage.HarmonicaStacking=gHarmonicaStacking,localStorage.HarmonicaTabColors=gHarmonicaTabColors,localStorage.HarmonicaCustom=JSON.stringify(gHarmonicaCustom),localStorage.CustomTabKey=gCustomTabKey,localStorage.CustomTabOctave=gCustomTabOctave,localStorage.CustomTab=JSON.stringify(gCustomTab),localStorage.BambooFluteKey=gBambooFluteKey,localStorage.MDulcimerStyle=gMDulcimerStyle,localStorage.MDulcimerStripBadTunes=gMDulcimerStripBadTunes,localStorage.MDulcimerUseDashForOpenString=gMDulcimerUseDashForOpenString,localStorage.RenderingFonts=JSON.stringify(gRenderingFonts);var e=gShowTabNames;localStorage.abcShowTabNames=e?"true":"false",localStorage.abcCapo=gCapo,localStorage.MP3Bitrate=gMP3Bitrate,localStorage.theSoundFont4=gDefaultSoundFont,localStorage.AutoscrollPlayer=gAutoscrollPlayer,localStorage.AutoscrollSmooth=gAutoscrollSmooth,localStorage.AutoscrollTarget=gAutoscrollTarget,localStorage.AutoSwingHornpipes=gAutoSwingHornpipes,localStorage.AutoSwingFactor=gAutoSwingFactor,localStorage.UseCustomGMSounds=gUseCustomGMSounds,localStorage.TipJarCount=gTipJarCount,localStorage.SaveLastAutoSnapShot=gSaveLastAutoSnapShot,localStorage.PDFFont=gPDFFont,localStorage.PDFFontStyle=gPDFFontStyle,localStorage.UseComhaltasABC=gUseComhaltasABC,localStorage.AllowMIDIInput=gAllowMIDIInput,localStorage.MIDIChromatic=gMIDIChromatic,localStorage.PDFTunebookConfig=JSON.stringify(gPDFTunebookConfig),localStorage.LooperSpeedStart=gLooperSpeedStart,localStorage.LooperSpeedEnd=gLooperSpeedEnd,localStorage.LooperSpeedIncrement=gLooperSpeedIncrement,localStorage.LooperCount=gLooperCount,localStorage.LooperDoCountdown=gLooperDoCountdown,localStorage.LooperCountdown=gLooperCountdown,localStorage.BatchExportDelayMS=gBatchExportDelayMS,localStorage.BatchMP3ExportDelayMS=gBatchMP3ExportDelayMS,localStorage.ExportWidth=gExportWidth,localStorage.ExportWidthAll=gExportWidthAll,localStorage.MetronomeHighVolume=gMetronomeHighVolume,localStorage.MetronomeLowVolume=gMetronomeLowVolume,localStorage.MetronomeHighSound=gMetronomeHighSound,localStorage.MetronomeLowSound=gMetronomeLowSound,localStorage.RawFirstTime=gRawFirstTime,localStorage.RawHighlightColor=gRawHighlightColor,localStorage.PlayerStatusOnLeft=gPlayerStatusOnLeft,localStorage.RollUseRollForIrishRoll2=gRollUseRollForIrishRoll,localStorage.Roll2DefaultParams=gRoll2DefaultParams,localStorage.Roll3DefaultParams=gRoll3DefaultParams,localStorage.DefaultTuneDatabase=gDefaultTuneDatabase,localStorage.TuneDatabaseRetryTimeMS=gTuneDatabaseRetryTimeMS,localStorage.TuneDatabaseRetryCount=gTuneDatabaseRetryCount,localStorage.LastTuneSearchValue=gLastTuneSearchValue,localStorage.ShapeNoteStyle=gShapeNoteStyle,localStorage.DisableSelectedPlay=gDisableSelectedPlay,localStorage.FeaturesShowSearch=gFeaturesShowSearch,localStorage.FeaturesShowExamples=gFeaturesShowExamples,localStorage.FeaturesShowTemplates=gFeaturesShowTemplates,localStorage.FeaturesShowTablatures=gFeaturesShowTablatures,localStorage.FeaturesShowExplorers=gFeaturesShowExplorers,localStorage.FeaturesShowExport=gFeaturesShowExport,localStorage.FeaturesShowTabButtons=gFeaturesShowTabButtons,localStorage.FeaturesShowBagpipeDrones=gFeaturesShowBagpipeDrones,localStorage.ABCEditorFontSize=gABCEditorFontsize,localStorage.ShowDiagnostics=gShowDiagnostics,localStorage.ReverbString2=gReverbString,localStorage.TinyURLAPIKeyOverride=gTinyURLAPIKeyOverride,localStorage.TinyURLCount=gTinyURLCount,localStorage.ShowDGDAETab=gShowDGDAETab,localStorage.ShowCGDATab=gShowCGDATab,localStorage.ShowRecorderTab=gShowRecorderTab,localStorage.RecorderFingeringGerman=gRecorderFingeringGerman,localStorage.ConfirmClear=gConfirmClear,localStorage.AllowOfflineInstruments=gAllowOfflineInstruments,localStorage.CleanSmartQuotes=gCleanSmartQuotes,localStorage.iPadTwoColumn=giPadTwoColumn,localStorage.PlayerScaling=gPlayerScaling,localStorage.BuildTuneSetRepeat=BuildTuneSetRepeat,localStorage.BuildTuneSetRepeatCount=BuildTuneSetRepeatCount,localStorage.BuildTuneSetVerbose=BuildTuneSetVerbose,localStorage.forceAndroid=gForceAndroid,localStorage.disableAndroid=gDisableAndroid,localStorage.CustomStringedCount=gCustomStringedCount,localStorage.CustomStringedCapo=gCustomStringedCapo,localStorage.CustomStringedLabel=gCustomStringedLabel,localStorage.CustomStringedString1=gCustomStringedString1,localStorage.CustomStringedString2=gCustomStringedString2,localStorage.CustomStringedString3=gCustomStringedString3,localStorage.CustomStringedString4=gCustomStringedString4,localStorage.CustomStringedString5=gCustomStringedString5,localStorage.CustomStringedString6=gCustomStringedString6,localStorage.IncipitsBuilderBars=gIncipitsBuilderBars,localStorage.IncipitsBuilderWidth=gIncipitsBuilderWidth,localStorage.IncipitsBuilderLeftJustify=gIncipitsBuilderLeftJustify,localStorage.IncipitsBuilderInjectNumbers=gIncipitsBuilderInjectNumbers,localStorage.IncipitsBuilderStripText=gIncipitsBuilderStripText,localStorage.IncipitsTagsToStrip=gIncipitsTagsToStrip,localStorage.IncipitsBuilderMultiPart=gIncipitsBuilderMultiPart,localStorage.IncipitsBuilderOwnLines=gIncipitsBuilderOwnLines,localStorage.LastWarp=gLastWarp,localStorage.LastPlayerRepeat=gLastPlayerRepeat,localStorage.PlayMetronome=gPlayMetronome,localStorage.UseWidePlayCursor=gUseWidePlayCursor,localStorage.JumpToTuneAutoscroll=gJumpToTuneAutoscroll,localStorage.CustomInstrumentShowStatus=gCustomInstrumentShowStatus,localStorage.EnableSyntax4=gEnableSyntax,localStorage.SyntaxDarkMode=gSyntaxDarkMode,localStorage.AlwaysFlattenParts=gAlwaysFlattenParts}}var gDialogRenderingFonts,gMusicXMLImportOptions={};function resetMusicXMLImportOptions(){gMusicXMLImportOptions={b:4,n:0,c:0,v:0,d:4,x:0,noped:0,p:"",v1:0,stm:0,s:0,t:0,u:0,v:0,v1:0,mnum:-1,m:1,addq:1,q:100,addstavenum:0}}function setMusicXMLOptions(){gMusicXMLImportOptions.x=$("#musicxml_nlb").prop("checked")?1:0,0==gMusicXMLImportOptions.x?(gMusicXMLImportOptions.addstavenum=0,$("#musicxml_addstavenum").prop("checked",!1)):gMusicXMLImportOptions.addstavenum=$("#musicxml_addstavenum").prop("checked")?1:0,gMusicXMLImportOptions.u=$("#musicxml_unfld").prop("checked")?1:0,gMusicXMLImportOptions.b=parseInt($("#musicxml_bpl").val()||4),gMusicXMLImportOptions.n=parseInt($("#musicxml_cpl").val()||0),gMusicXMLImportOptions.c=parseInt($("#musicxml_crf").val()||0),gMusicXMLImportOptions.d=parseInt($("#musicxml_den").val()||4),gMusicXMLImportOptions.m=parseInt($("#musicxml_midi").val()||0),gMusicXMLImportOptions.noped=$("#musicxml_noped").prop("checked")?1:0,gMusicXMLImportOptions.v1=$("#musicxml_v1").prop("checked")?1:0,gMusicXMLImportOptions.stm=$("#musicxml_stems").prop("checked")?1:0,gMusicXMLImportOptions.mnum=parseInt($("#musicxml_mnum").val()||-1),gMusicXMLImportOptions.addq=$("#musicxml_addq").prop("checked")?1:0,gMusicXMLImportOptions.q=parseInt($("#musicxml_q").val()||100)}function idleXMLImport(){0==gMusicXMLImportOptions.x&&(gMusicXMLImportOptions.addstavenum=0),$("#musicxml_unfld").prop("checked",1==gMusicXMLImportOptions.u),$("#musicxml_bpl").val(gMusicXMLImportOptions.b),$("#musicxml_cpl").val(gMusicXMLImportOptions.n),$("#musicxml_crf").val(gMusicXMLImportOptions.c),$("#musicxml_den").val(gMusicXMLImportOptions.d),$("#musicxml_midi").val(gMusicXMLImportOptions.m),$("#musicxml_nlb").prop("checked",1==gMusicXMLImportOptions.x),$("#musicxml_noped").prop("checked",1==gMusicXMLImportOptions.noped),$("#musicxml_v1").prop("checked",1==gMusicXMLImportOptions.v1),$("#musicxml_stems").prop("checked",1==gMusicXMLImportOptions.stm),$("#musicxml_mnum").val(gMusicXMLImportOptions.mnum),$("#musicxml_addq").prop("checked",1==gMusicXMLImportOptions.addq),$("#musicxml_q").val(gMusicXMLImportOptions.q),$("#musicxml_addstavenum").prop("checked",1==gMusicXMLImportOptions.addstavenum)}function defaultMusicXMLSettings(){sendGoogleAnalytics("action","defaultMusicXMLSettings");var e="Are you sure you want to reset the MusicXML/MIDI Import Settings to their default values?";e=makeCenteredPromptString(e),DayPilot.Modal.confirm(e,{top:180,theme:"modal_flat",scrollWithPage:AllowDialogsToScroll()}).then(function(e){e.canceled||(resetMusicXMLImportOptions(),idleXMLImport())})}function ConfigureMusicXMLImport(){sendGoogleAnalytics("dialog","ConfigureMusicXMLImport");var e=JSON.parse(JSON.stringify(gMusicXMLImportOptions));const t=[{html:'<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">MusicXML/MIDI Import Settings&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#musicxml" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></p><div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">Bars-per-line:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" style="width:60px;" id="musicxml_bpl" type="text" pattern="d+" title="Default: 3"/></div>\n<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">Characters-per-line:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" style="width:60px;" id="musicxml_cpl" type="text" pattern="d+" title="Default: 0 - ignore"/></div>\n<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">Measure numbers:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" style="width:60px;" id="musicxml_mnum" type="text" pattern="d+" title="-1: No measure numbers, 1..n: Number every n-th measure, 0: Number every system"/></div>\n<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">Include measure numbers at end of staves:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" id="musicxml_addstavenum" type="checkbox"/></div>\n<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">Unfold repeats:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" id="musicxml_unfld" type="checkbox"/></div>\n<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">Credit text filter (level 0-6):&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" style="width:60px;" id="musicxml_crf" type="text" pattern="[0123456]" title="0 (Default), 1, 2, 3, 4, 5, 6"/></div>\n<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">Denominator unit length for L: tags:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" style="width:60px;" id="musicxml_den" type="text" pattern="dd?" title="0 (Automatic), 1, 2, 4, 8, 16, or 32"/></div>\n<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">%%MIDI options:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" style="width:60px;" id="musicxml_midi" type="text" pattern="[012]" title="0: No MIDI, 1: Only program, 2: All MIDI"/></div>\n<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">No score line breaks:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" id="musicxml_nlb" type="checkbox"/></div>\n<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">No pedal directions:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" id="musicxml_noped" type="checkbox"/></div>\n<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">All directions to first voice:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" id="musicxml_v1" type="checkbox"/></div>\n<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">Translate stem directions:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" id="musicxml_stems" type="checkbox"/></div>\n<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">Inject Q: tag if not present:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" id="musicxml_addq" type="checkbox"/></div>\n<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">Q: tag value to inject:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" style="width:60px;" id="musicxml_q" type="text" pattern="d+" title="Default: 100"/></div>\n<p style="text-align:center;margin-top:22px;"><input id="default_musicxml_settings" class="btn btn-clearbutton default_musicxml_settings" onclick="defaultMusicXMLSettings()" type="button" value="Reset to Default" title="Reset the MusicXML/MIDI import settings to their default values"></p>\n'}];setTimeout(function(){idleXMLImport()},150);DayPilot.Modal.form(t,{},{theme:"modal_flat",top:50,width:500,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(t){t.canceled?gMusicXMLImportOptions=e:gLocalStorageAvailable&&(localStorage.musicXMLImportOptionsV6=JSON.stringify(gMusicXMLImportOptions))})}function resetAngloButtonNames(){gAngloButtonNames=["1*","2*","3*","4*","5*","①*","②*","③*","④*","⑤*","1","2","3","4","5","①","②","③","④","⑤","6","7","8","9","10","⑥","⑦","⑧","⑨","⑩"]}function defaultAngloButtonNames(){sendGoogleAnalytics("action","defaultAngloButtonNames");var e="Are you sure you want to reset the Anglo Concertina button names and Push/Draw characters to their default values?";e=makeCenteredPromptString(e),DayPilot.Modal.confirm(e,{top:180,theme:"modal_flat",scrollWithPage:AllowDialogsToScroll()}).then(function(e){if(!e.canceled){var t;for(resetAngloButtonNames(),t=0;t<10;++t){var n="r1c"+(t+1);document.getElementById(n).value=gAngloButtonNames[t]}for(t=0;t<10;++t){n="r2c"+(t+1);document.getElementById(n).value=gAngloButtonNames[t+10]}for(t=0;t<10;++t){n="r3c"+(t+1);document.getElementById(n).value=gAngloButtonNames[t+20]}gInjectTab_PushGlyph="↓",gInjectTab_DrawGlyph="↑",gInjectTab_UseBarForDraw=!1}})}function initAngloButtonNames(){var e;for(e=0;e<10;++e){var t="r1c"+(e+1);document.getElementById(t).value=gAngloButtonNames[e]}for(e=0;e<10;++e){t="r2c"+(e+1);document.getElementById(t).value=gAngloButtonNames[e+10]}for(e=0;e<10;++e){t="r3c"+(e+1);document.getElementById(t).value=gAngloButtonNames[e+20]}}function angloFingeringsChangeHandler(){var e;for(e=0;e<10;++e){var t="r1c"+(e+1);gAngloButtonNames[e]=document.getElementById(t).value}for(e=0;e<10;++e){t="r2c"+(e+1);gAngloButtonNames[e+10]=document.getElementById(t).value}for(e=0;e<10;++e){t="r3c"+(e+1);gAngloButtonNames[e+20]=document.getElementById(t).value}for(e=0;e<30;++e)""==gAngloButtonNames[e]&&(gAngloButtonNames[e]=" ")}function saveCustomAngloButtons(){sendGoogleAnalytics("action","saveCustomAngloButtons");var e={type:"CustomAnglo",buttons:gAngloButtonNames,pushGlyph:gInjectTab_PushGlyph,drawGlyph:gInjectTab_DrawGlyph,useBarForDraw:gInjectTab_UseBarForDraw};saveTextFile("Please enter a filename for your custom Anglo Concertina button names:","custom_anglo_buttons_settings.txt",JSON.stringify(e))}function loadAngloNamesClickHandler(){document.getElementById("load_custom_anglo_names_fs").click()}function loadCustomAngloButtons(e){sendGoogleAnalytics("action","loadCustomAngloButtons");const t=new FileReader;t.addEventListener("load",e=>{var t=e.target.result;try{var n=JSON.parse(t);if(!n.type||"CustomAnglo"!=n.type)return o=makeCenteredPromptString(o="This is not a valid custom Anglo Concertina button names file."),void DayPilot.Modal.alert(o,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});gAngloButtonNames=n.buttons,n.pushGlyph&&(gInjectTab_PushGlyph=n.pushGlyph),n.drawGlyph&&(gInjectTab_DrawGlyph=n.drawGlyph),n.useBarForDraw&&(gInjectTab_UseBarForDraw=n.useBarForDraw),initAngloButtonNames()}catch(e){var o;return o=makeCenteredPromptString(o="This is not a valid custom Anglo Concertina button names file."),void DayPilot.Modal.alert(o,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})}}),t.readAsText(e)}function idleOpenCustomAnglo(){document.getElementById("load_custom_anglo_names_fs").onchange=()=>{let e=document.getElementById("load_custom_anglo_names_fs");if(0===e.files.length){var t="Please select a custom Anglo Concertina button names file";return t=makeCenteredPromptString(t),void DayPilot.Modal.alert(t,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})}loadCustomAngloButtons(e.files[0]),e.value=""}}function ConfigureAngloFingerings(){sendGoogleAnalytics("dialog","ConfigureAngloFingerings");var e=gAngloButtonNames.slice(),t=gInjectTab_PushGlyph,n=gInjectTab_DrawGlyph,o=gInjectTab_UseBarForDraw;const a=[{html:'<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">Configure Anglo Concertina Tablature Button Names&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#injecting_box_or_anglo_concertina_tablature" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p><div id="anglo-button-names-dialog"><table style="margin-bottom:24px;text-align:center;">\n<tr>\n<td><input class="anglobuttonnames" type="text" id="r1c1" onchange="angloFingeringsChangeHandler()"></td>\n<td><input class="anglobuttonnames" type="text" id="r1c2" onchange="angloFingeringsChangeHandler()"></td>\n<td><input class="anglobuttonnames" type="text" id="r1c3" onchange="angloFingeringsChangeHandler()"></td>\n<td><input class="anglobuttonnames" type="text" id="r1c4" onchange="angloFingeringsChangeHandler()"></td>\n<td><input class="anglobuttonnames" type="text" id="r1c5" onchange="angloFingeringsChangeHandler()"></td>\n<td><input class="anglobuttonnames" type="text" id="r1c6" style="margin-left:36px" onchange="angloFingeringsChangeHandler()"></td>\n<td><input class="anglobuttonnames" type="text" id="r1c7" onchange="angloFingeringsChangeHandler()"></td>\n<td><input class="anglobuttonnames" type="text" id="r1c8" onchange="angloFingeringsChangeHandler()"></td>\n<td><input class="anglobuttonnames" type="text" id="r1c9" onchange="angloFingeringsChangeHandler()"></td>\n<td><input class="anglobuttonnames" type="text" id="r1c10" onchange="angloFingeringsChangeHandler()"></td>\n</tr>\n<tr>\n<td><input class="anglobuttonnames" type="text" id="r2c1" onchange="angloFingeringsChangeHandler()"></td>\n<td><input class="anglobuttonnames" type="text" id="r2c2" onchange="angloFingeringsChangeHandler()"></td>\n<td><input class="anglobuttonnames" type="text" id="r2c3" onchange="angloFingeringsChangeHandler()"></td>\n<td><input class="anglobuttonnames" type="text" id="r2c4" onchange="angloFingeringsChangeHandler()"></td>\n<td><input class="anglobuttonnames" type="text" id="r2c5" onchange="angloFingeringsChangeHandler()"></td>\n<td><input class="anglobuttonnames" type="text" id="r2c6" style="margin-left:36px" onchange="angloFingeringsChangeHandler()"></td>\n<td><input class="anglobuttonnames" type="text" id="r2c7" onchange="angloFingeringsChangeHandler()"></td>\n<td><input class="anglobuttonnames" type="text" id="r2c8" onchange="angloFingeringsChangeHandler()"></td>\n<td><input class="anglobuttonnames" type="text" id="r2c9" onchange="angloFingeringsChangeHandler()"></td>\n<td><input class="anglobuttonnames" type="text" id="r2c10" onchange="angloFingeringsChangeHandler()"></td>\n</tr>\n<tr>\n<td><input class="anglobuttonnames" type="text" id="r3c1" onchange="angloFingeringsChangeHandler()"></td>\n<td><input class="anglobuttonnames" type="text" id="r3c2" onchange="angloFingeringsChangeHandler()"></td>\n<td><input class="anglobuttonnames" type="text" id="r3c3" onchange="angloFingeringsChangeHandler()"></td>\n<td><input class="anglobuttonnames" type="text" id="r3c4" onchange="angloFingeringsChangeHandler()"></td>\n<td><input class="anglobuttonnames" type="text" id="r3c5" onchange="angloFingeringsChangeHandler()"></td>\n<td><input class="anglobuttonnames" type="text" id="r3c6" style="margin-left:36px" onchange="angloFingeringsChangeHandler()"></td>\n<td><input class="anglobuttonnames" type="text" id="r3c7" onchange="angloFingeringsChangeHandler()"></td>\n<td><input class="anglobuttonnames" type="text" id="r3c8" onchange="angloFingeringsChangeHandler()"></td>\n<td><input class="anglobuttonnames" type="text" id="r3c9" onchange="angloFingeringsChangeHandler()"></td>\n<td><input class="anglobuttonnames" type="text" id="r3c10" onchange="angloFingeringsChangeHandler()"></td>\n</tr>\n</table>\n</div>\n<p style="text-align:center;margin-top:22px;"><input type="file" id="load_custom_anglo_names_fs" accept=".txt,.TXT" hidden/><input id="save_custom_anglo_names" class="btn btn-subdialog" onclick="saveCustomAngloButtons()" type="button" value="Save Custom Tab Button Names" title="Save a custom Anglo Concertina button names file"><input id="load_custom_anglo_names" class="btn btn-subdialog load_custom_anglo_names" onclick="loadAngloNamesClickHandler()" type="button" value="Load Custom Tab Button Names" title="Load a custom Anglo Concertina button names file"></p>\n<p style="text-align:center;margin-top:22px;"><input id="default_anglo_fingerings" class="btn btn-clearbutton default_anglo_fingerings" onclick="defaultAngloButtonNames()" type="button" value="Reset to Default" title="Reset the Anglo Concertina button names to their default values"></p>\n'}];setTimeout(function(){initAngloButtonNames(),idleOpenCustomAnglo()},150);DayPilot.Modal.form(a,{},{theme:"modal_flat",top:190,width:800,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(a){a.canceled?(gAngloButtonNames=e,gInjectTab_PushGlyph=t,gInjectTab_DrawGlyph=n,gInjectTab_UseBarForDraw=o):gLocalStorageAvailable&&(localStorage.angloButtonNames2=JSON.stringify(gAngloButtonNames),localStorage.InjectTab_PushGlyph=gInjectTab_PushGlyph,localStorage.InjectTab_DrawGlyph=gInjectTab_DrawGlyph,localStorage.InjectTab_UseBarForDraw=gInjectTab_UseBarForDraw)})}function ConfigureTablatureSettings(){sendGoogleAnalytics("dialog","ConfigureTablatureSettings");const e={configure_font_family:gInjectTab_FontFamily,configure_tab_font_size:gInjectTab_TabFontSize,configure_staffsep:gInjectTab_StaffSep,configure_musicspace:gInjectTab_MusicSpace,configure_tab_location:parseInt(gInjectTab_TabLocation),configure_strip_chords:gInjectTab_StripChords,configure_pushglyph:gInjectTab_PushGlyph,configure_drawglyph:gInjectTab_DrawGlyph,configure_use_bar_for_draw:gInjectTab_UseBarForDraw,configure_box_tab_style:gInjectTab_BoxTabStyle,configure_tab_colors:gInjectTab_Colors},t=[{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Tablature Injection Settings&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#tablature_settings" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="font-size:12pt;line-height:18pt;font-family:helvetica"><strong>General Tablature Formatting Settings:</strong></p>'},{name:"Font family (Recommended: Palatino):",id:"configure_font_family",type:"text",cssClass:"configure_tab_settings_form_text_wide"},{name:"Tablature/Solfège font size (Recommended: 10):",id:"configure_tab_font_size",type:"text",cssClass:"configure_tab_settings_form_text"},{name:"%%staffsep value (Recommended: 80):",id:"configure_staffsep",type:"text",cssClass:"configure_tab_settings_form_text"},{name:"%%musicspace value (Recommended: 10):",id:"configure_musicspace",type:"text",cssClass:"configure_tab_settings_form_text"},{name:"Tab location relative to notation:",id:"configure_tab_location",type:"select",options:[{name:"  Above",id:"0"},{name:"  Below",id:"1"}],cssClass:"configure_tab_settings_select"},{name:"    Strip all chords and tab before injecting tab (Tab below only. Tab above always strips.)",id:"configure_strip_chords",type:"checkbox",cssClass:"configure_tab_settings_form_text"},{html:'<p style="font-size:12pt;line-height:18pt;font-family:helvetica;margin-top:24px;"><strong>Irish Button Box and Anglo Concertina-specific Tablature Settings:</strong></p>'},{name:"Box tab style:",id:"configure_box_tab_style",type:"select",options:[{name:"  Default (Uses settings below for push/draw characters and tab location)",id:"0"},{name:"  Push/Draw (Single quote for outside row, tab drawn below notes)",id:"1"}],cssClass:"configure_tab_settings_select_box_style"},{name:"Character(s) for Push indication (Clearing this field will reset to ↓ ):",id:"configure_pushglyph",type:"text",cssClass:"configure_tab_settings_form_text"},{name:"Character(s) for Draw indication (Clearing this field will reset to ↑ ):",id:"configure_drawglyph",type:"text",cssClass:"configure_tab_settings_form_text"},{name:"    Use a bar over button name to indicate Draw (overrides Push and Draw characters)",id:"configure_use_bar_for_draw",type:"checkbox",cssClass:"configure_tab_settings_form_text"},{name:"    Inject Push and Draw tab colors and CSS",id:"configure_tab_colors",type:"checkbox",cssClass:"configure_tab_settings_form_text"}];DayPilot.Modal.form(t,e,{theme:"modal_flat",top:50,width:720,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(e){e.canceled||(gInjectTab_FontFamily=e.result.configure_font_family,gInjectTab_TabFontSize=e.result.configure_tab_font_size,gInjectTab_StaffSep=e.result.configure_staffsep,gInjectTab_MusicSpace=e.result.configure_musicspace,gInjectTab_TabLocation=e.result.configure_tab_location,gInjectTab_BoxTabStyle=e.result.configure_box_tab_style,gInjectTab_StripChords=e.result.configure_strip_chords,gInjectTab_Colors=e.result.configure_tab_colors,""==(gInjectTab_PushGlyph=e.result.configure_pushglyph)&&(gInjectTab_PushGlyph="↓"),""==(gInjectTab_DrawGlyph=e.result.configure_drawglyph)&&(gInjectTab_DrawGlyph="↑"),gInjectTab_UseBarForDraw=e.result.configure_use_bar_for_draw,SaveConfigurationSettings())})}function InjectTabColors(e,t){if(1==t&&"1"==gInjectTab_BoxTabStyle||gInjectTab_UseBarForDraw){var n="Unable to automatically inject Push/Draw colors into this style of tab.";return n=makeCenteredPromptString(n),DayPilot.Modal.alert(n,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()}),e}switch(t){case 0:e=gInjectTab_GaryCoover?(e=e.replace(/("_ ;\d+"|"\^\d+"|"_ ;\d+a"|"\^\d+a")/g,"$1!push!")).replace(/("__;\d+"|"___;\d+"|"__;\d+a"|"___;\d+a"|"\^_;\d+"|"\^__;\d+"|"\^_;\d+a"|"\^__;\d+a")/g,"$1!draw!"):(e=e.replaceAll(gInjectTab_PushGlyph+'"',gInjectTab_PushGlyph+'"!push!')).replaceAll(gInjectTab_DrawGlyph+'"',gInjectTab_DrawGlyph+'"!draw!');break;case 1:e=(e=e.replaceAll(gInjectTab_PushGlyph+'"',gInjectTab_PushGlyph+'"!push!')).replaceAll(gInjectTab_DrawGlyph+'"',gInjectTab_DrawGlyph+'"!draw!')}return e="% Begin tab color CSS\n%%begincss\n.push {fill:#C00000}\n.draw {fill:#0000C0}\n%%endcss\n% End tab color CSS\n\n"+e}function InjectHarmonicaTabColors(e){if(e=(e=e.replaceAll(';+"',';+"!push!')).replaceAll(';-"',';-"!draw!'),gHarmonicaPlusSign||(e=e.replaceAll(';+"',';"')),!gHarmonicaStacking){const t=["","'''","''","'","o'","o"];["+","-"].forEach(n=>{t.forEach(t=>{const o=t.replace(/([\\^$*+?.()|[\]{}])/g,"\\$1"),a=new RegExp(`(\\d+)${o};+\\${n}`,"g"),l=`${n}$1${t}`;e=e.replace(a,l)})}),e=e.replaceAll(';"','"')}return e="% Begin tab color CSS\n%%begincss\n.push {fill:#C00000}\n.draw {fill:#0000C0}\n%%endcss\n% End tab color CSS\n\n"+e}function CleanHarmonicaTab(e){return gHarmonicaStacking&&(e=e.replace(/"(\^[^"+-]*[^"+-])"/g,'"$1;"')),e}function idleOpenFonts(){gIsIOS&&document.getElementById("load_rendering_fonts_fs").removeAttribute("accept"),document.getElementById("load_rendering_fonts_fs").onchange=()=>{let e=document.getElementById("load_rendering_fonts_fs");if(0===e.files.length){var t="Please select a font settings file";return t=makeCenteredPromptString(t),void DayPilot.Modal.alert(t,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})}loadFontSettings(e.files[0]),e.value=""}}function loadFontSettings(e){sendGoogleAnalytics("action","loadFontSettings");const t=new FileReader;t.addEventListener("load",e=>{var t=e.target.result,n=JSON.parse(t);if(!n.titlefont||!n.voicefont){var o="This is not a valid font settings file.";return o=makeCenteredPromptString(o),void DayPilot.Modal.alert(o,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})}(gDialogRenderingFonts=n).tablabelfont||(gDialogRenderingFonts.tablabelfont="Trebuchet MS 14"),gDialogRenderingFonts.tabgracefont||(gDialogRenderingFonts.tabgracefont="Arial 8"),idleFontsDialog()}),t.readAsText(e)}function saveFontSettings(){sendGoogleAnalytics("action","saveFontSettings");var e={titlefont:$('[name="configure_titlefont"]').val(),subtitlefont:$('[name="configure_subtitlefont"]').val(),infofont:$('[name="configure_infofont"]').val(),partsfont:$('[name="configure_partsfont"]').val(),tempofont:$('[name="configure_tempofont"]').val(),textfont:$('[name="configure_textfont"]').val(),composerfont:$('[name="configure_composerfont"]').val(),annotationfont:$('[name="configure_annotationfont"]').val(),gchordfont:$('[name="configure_gchordfont"]').val(),vocalfont:$('[name="configure_vocalfont"]').val(),wordsfont:$('[name="configure_wordsfont"]').val(),tablabelfont:$('[name="configure_tablabelfont"]').val(),tabnumberfont:$('[name="configure_tabnumberfont"]').val(),tabgracefont:$('[name="configure_tabgracefont"]').val(),historyfont:$('[name="configure_historyfont"]').val(),voicefont:$('[name="configure_voicefont"]').val()};saveTextFile("Please enter a filename for your font settings:","abc_tool_fonts.txt",JSON.stringify(e))}function idleFontsDialog(){$('[name="configure_titlefont"]').val(gDialogRenderingFonts.titlefont),$('[name="configure_subtitlefont"]').val(gDialogRenderingFonts.subtitlefont),$('[name="configure_infofont"]').val(gDialogRenderingFonts.infofont),$('[name="configure_partsfont"]').val(gDialogRenderingFonts.partsfont),$('[name="configure_tempofont"]').val(gDialogRenderingFonts.tempofont),$('[name="configure_textfont"]').val(gDialogRenderingFonts.textfont),$('[name="configure_composerfont"]').val(gDialogRenderingFonts.composerfont),$('[name="configure_annotationfont"]').val(gDialogRenderingFonts.annotationfont),$('[name="configure_gchordfont"]').val(gDialogRenderingFonts.gchordfont),$('[name="configure_vocalfont"]').val(gDialogRenderingFonts.vocalfont),$('[name="configure_wordsfont"]').val(gDialogRenderingFonts.wordsfont),$('[name="configure_tablabelfont"]').val(gDialogRenderingFonts.tablabelfont),$('[name="configure_tabnumberfont"]').val(gDialogRenderingFonts.tabnumberfont),$('[name="configure_tabgracefont"]').val(gDialogRenderingFonts.tabgracefont),$('[name="configure_historyfont"]').val(gDialogRenderingFonts.historyfont),$('[name="configure_voicefont"]').val(gDialogRenderingFonts.voicefont)}function resetABCRenderingFonts(){gDialogRenderingFonts={titlefont:"Palatino 18",subtitlefont:"Palatino 13",infofont:"Palatino 13",partsfont:"Palatino 13",tempofont:"Palatino 13",textfont:"Palatino 13",composerfont:"Palatino 13",annotationfont:"Palatino 13",gchordfont:"Verdana 12",vocalfont:"Palatino 13",wordsfont:"Palatino 13",tablabelfont:"Trebuchet MS 14",tabnumberfont:"Arial 12",tabgracefont:"Arial 8",historyfont:"Times New Roman 14",voicefont:"Times New Roman 13"}}function defaultFontSettings(){sendGoogleAnalytics("action","defaultFontSettings");var e="Are you sure you want to reset the ABC rendering fonts to their default values?";e=makeCenteredPromptString(e),DayPilot.Modal.confirm(e,{top:180,theme:"modal_flat",scrollWithPage:AllowDialogsToScroll()}).then(function(e){e.canceled||(resetABCRenderingFonts(),SaveConfigurationSettings(),idleFontsDialog())})}function loadFontSettingsClickHandler(){document.getElementById("load_rendering_fonts_fs").click()}function ConfigureFonts(){sendGoogleAnalytics("dialog","ConfigureFonts");const e={configure_titlefont:gRenderingFonts.titlefont,configure_subtitlefont:gRenderingFonts.subtitlefont,configure_infofont:gRenderingFonts.infofont,configure_partsfont:gRenderingFonts.partsfont,configure_tempofont:gRenderingFonts.tempofont,configure_textfont:gRenderingFonts.textfont,configure_composerfont:gRenderingFonts.composerfont,configure_annotationfont:gRenderingFonts.annotationfont,configure_gchordfont:gRenderingFonts.gchordfont,configure_vocalfont:gRenderingFonts.vocalfont,configure_wordsfont:gRenderingFonts.wordsfont,configure_tablabelfont:gRenderingFonts.tablabelfont,configure_tabnumberfont:gRenderingFonts.tabnumberfont,configure_tabgracefont:gRenderingFonts.tabgracefont,configure_historyfont:gRenderingFonts.historyfont,configure_voicefont:gRenderingFonts.voicefont};setTimeout(function(){idleOpenFonts()},150);DayPilot.Modal.form([{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Configure ABC Rendering Fonts&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#configure_fonts" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{name:"Title font (Default: Palatino 18):",id:"configure_titlefont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Subtitle font (Default: Palatino 13):",id:"configure_subtitlefont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Info font (Default: Palatino 13):",id:"configure_infofont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Composer font (Default: Palatino 13):",id:"configure_composerfont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Tempo font (Default: Palatino 13):",id:"configure_tempofont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Guitar chord font (Default: Verdana 12):",id:"configure_gchordfont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Tab label font (Default: Trebuchet MS 14):",id:"configure_tablabelfont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Tab number font (Default: Arial 12):",id:"configure_tabnumberfont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Tab grace font (Default: Arial 8):",id:"configure_tabgracefont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"History font (Default: Times New Roman 14):",id:"configure_historyfont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Text font (Default: Palatino 13):",id:"configure_textfont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Annotation font (Default: Palatino 13):",id:"configure_annotationfont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Voice font (Default: Times New Roman 13):",id:"configure_voicefont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Parts font (Default: Palatino 13):",id:"configure_partsfont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Vocal font (Default: Palatino 13):",id:"configure_vocalfont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Words font (Default: Palatino 13):",id:"configure_wordsfont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{html:'<p style="text-align:center;margin-top:22px;"><input id="save_rendering_fonts" class="btn btn-top save_rendering_fonts" onclick="saveFontSettings()" type="button" value="Save to File" title="Saves the ABC rendering font settings to a file"><input type="file" id="load_rendering_fonts_fs" accept=".txt,.TXT" hidden/><input class="btn btn-top load_rendering_fonts" type="button" id="load_rendering_fonts" title="Loads the ABC rendering font settings from a file" value="Load from File" onclick="loadFontSettingsClickHandler()"/><input id="default_rendering_fonts" class="btn btn-clearbutton default_rendering_fonts" onclick="defaultFontSettings()" type="button" value="Reset to Default" title="Reset the ABC rendering fonts to their default values"></p>'}],e,{theme:"modal_flat",top:10,width:600,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(e){e.canceled||(gRenderingFonts.titlefont=e.result.configure_titlefont,gRenderingFonts.subtitlefont=e.result.configure_subtitlefont,gRenderingFonts.infofont=e.result.configure_infofont,gRenderingFonts.partsfont=e.result.configure_partsfont,gRenderingFonts.tempofont=e.result.configure_tempofont,gRenderingFonts.textfont=e.result.configure_textfont,gRenderingFonts.composerfont=e.result.configure_composerfont,gRenderingFonts.annotationfont=e.result.configure_annotationfont,gRenderingFonts.gchordfont=e.result.configure_gchordfont,gRenderingFonts.vocalfont=e.result.configure_vocalfont,gRenderingFonts.wordsfont=e.result.configure_wordsfont,gRenderingFonts.tablabelfont=e.result.configure_tablabelfont,gRenderingFonts.tabnumberfont=e.result.configure_tabnumberfont,gRenderingFonts.tabgracefont=e.result.configure_tabgracefont,gRenderingFonts.historyfont=e.result.configure_historyfont,gRenderingFonts.voicefont=e.result.configure_voicefont,SaveConfigurationSettings(),RenderAsync(!0,null))})}function AddAutoPlay(){var e=urltextbox.value;-1==e.indexOf("&play=1")&&(e+="&play=1"),urltextbox.value=e,document.getElementById("addautoplay").value="Auto-Play Added!",setTimeout(function(){var e=document.getElementById("addautoplay");e&&(e.value="Add Auto-Play")},500)}function AddDisableEditing(){var e=urltextbox.value;-1==e.indexOf("&dx=1")&&(e+="&dx=1"),urltextbox.value=e,document.getElementById("adddisableediting").value="Disable Editing Added!",setTimeout(function(){var e=document.getElementById("adddisableediting");e&&(e.value="Add Disable Editing")},500)}function AddOpenInEditor(){var e=urltextbox.value;-1==e.indexOf("&editor=1")&&(e+="&editor=1"),urltextbox.value=e,document.getElementById("addopenineditor").value="Open in Editor Added!",setTimeout(function(){var e=document.getElementById("addopenineditor");e&&(e.value="Add Open in Editor")},500)}function AddNoUI(){var e=urltextbox.value;-1==e.indexOf("&noui")&&(e+="&noui"),urltextbox.value=e,document.getElementById("addnoui").value="Hide UI Added!",setTimeout(function(){var e=document.getElementById("addnoui");e&&(e.value="Add Hide UI")},500)}function SharingControlsDialog(){sendGoogleAnalytics("dialog","SharingControlsDialog");setTimeout(function(){CreateURLfromHTML()},200),DayPilot.Modal.alert('<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">Sharing Controls&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#sharing_controls" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p><div id="sharing-controls-dialog"><p style="margin-top:28px;"><input id="testurl" class="urlcontrols btn btn-urlcontrols" onclick="TestShareURL()" type="button" value="Test Share URL" title="Opens the Share URL in a new tab"><input id="copyurl" class="urlcontrols btn btn-urlcontrols" onclick="CopyShareURL()" type="button" value="Copy Share URL" title="Copies the Share URL to the clipboard"><input id="saveurl" class="urlcontrols btn btn-urlcontrols" onclick="SaveShareURL()" type="button" value="Save Share URL" title="Saves the Share URL to a file"><input id="shortenurl" class="urlcontrols btn btn-urlcontrols" onclick="ShortenURL(event)" type="button" value="Shorten URL" title="Shortens the Share URL and copies it to the clipboard"><input id="generateqrcode" class="urlcontrolslast btn btn-urlcontrols" onclick="GenerateQRCode(event)" type="button" value="Generate QR Code" title="Generates a QR Code for the Share URL.&nbsp;&nbsp;Even if this button is greyed-out, Shift-click attempts to generate a QR code from the text in the Share URL box."></p><p style="margin-top:24px;"><textarea id="urltextbox" rows="10" cols="80" spellcheck="false" autocorrect="off" autocapitalize="off" placeholder="URL for sharing will appear here" ></textarea></p><p id="shareurlcaption">Share URL</p><p style="text-align:center;margin-top:36px;"><input id="addautoplay" class="urlcontrols btn btn-urlcontrols" onclick="AddAutoPlay()" type="button" value="Add Auto-Play" title="Adds &play=1 to the ShareURL.&nbsp;&nbsp;Tune will open in the player."><input id="addopenineditor" class="urlcontrols btn btn-urlcontrols" onclick="AddOpenInEditor()" type="button" value="Add Open in Editor" title="Adds &editor=1 to the ShareURL.&nbsp;&nbsp;Share links will load in the editor.&nbsp;&nbsp;This setting overrides Add Auto-Play."><input id="adddisableediting" class="urlcontrols btn btn-urlcontrols" onclick="AddDisableEditing()" type="button" value="Add Disable Editing" title="Adds &dx=1 to the ShareURL.&nbsp;&nbsp;Entering the editor from the full screen tune view will be disabled.&nbsp;&nbsp;Also overrides Add Open in Editor."><input id="addnoui" class="urlcontrolslast btn btn-urlcontrols" onclick="AddNoUI()" type="button" value="Add Hide UI" title="Adds &noui to the ShareURL for responsive iframe embedding.&nbsp;&nbsp;When the link is opened, hides the UI.&nbsp;&nbsp;Overrides Add Open in Editor and Add Auto-Play."></p></div>',{theme:"modal_flat",top:100,width:800,scrollWithPage:AllowDialogsToScroll()}).then(function(){})}function idlePDFExportDialog(){function e(e){var t;"incipits"!=e?(t=document.getElementsByName("configure_incipitscolumns"))&&0!=t.length&&(t[0].disabled=!0,t[0].style.opacity=.4):(t=document.getElementsByName("configure_incipitscolumns"))&&0!=t.length&&(t[0].disabled=!1,t[0].style.opacity=1)}var t=document.getElementsByName("configure_tunelayout");t&&0!=t.length&&(e(t[0].value),t[0].onchange=function(){e(this.value)})}function PDFExportDialog(){if(!gAllowCopy)return;if(gRenderingPDF)return;var e=!0;gIsMaximized&&(e=!1),sendGoogleAnalytics("dialog",e?"PDFExportDialog":"PDFExportDialogFS");const t=[{name:"  Letter",id:"letter"},{name:"  A4",id:"a4"}],n=[{name:"  Portrait",id:"portrait"},{name:"  Landscape",id:"landscape"}];var o;o=isMobileBrowser()?[{name:"  One Tune per Page",id:"one"},{name:"  Multiple Tunes per Page",id:"multi"},{name:"  Notes Incipits",id:"incipits"},{name:"  ABC Text Incipits",id:"incipits_abc"},{name:"  ABC Text Incipits Sorted",id:"incipits_abc_sort"},{name:"  ABC Text Complete Tunes",id:"incipits_abc_full"},{name:"  ABC Text Complete Tunes - Comhaltas ABC",id:"incipits_abc_full_cce"},{name:"  QR Code for Each Tune",id:"all_qr_codes"},{name:"  Notation + QR Code for Each Tune",id:"mixed_notation_qr"}]:[{name:"  One Tune per Page",id:"one"},{name:"  Multiple Tunes per Page",id:"multi"},{name:"  Notes Incipits",id:"incipits"},{name:"  ABC Text Incipits",id:"incipits_abc"},{name:"  ABC Text Incipits Sorted",id:"incipits_abc_sort"},{name:"  ABC Text Complete Tunes",id:"incipits_abc_full"},{name:"  ABC Text Complete Tunes - Comhaltas ABC",id:"incipits_abc_full_cce"},{name:"  QR Code for Each Tune",id:"all_qr_codes"},{name:"  Notation + QR Code for Each Tune",id:"mixed_notation_qr"},{name:"  Individual PDF File for Each Tune",id:"pdf_per_tune"}];const a=[{name:"  One Column",id:1},{name:"  Two Columns",id:2}],l=[{name:"  None",id:"none"},{name:"  Top Left",id:"tl"},{name:"  Top Center",id:"tc"},{name:"  Top Right",id:"tr"},{name:"  Bottom Left",id:"bl"},{name:"  Bottom Center",id:"bc"},{name:"  Bottom Right",id:"br"},{name:"  Alternating Top Left/Right",id:"tlr"},{name:"  Alternating Top Right/Left",id:"trl"},{name:"  Alternating Bottom Left/Right",id:"blr"},{name:"  Alternating Bottom Right/Left",id:"brl"}],r=[{name:"  Times",id:"Times"},{name:"  Helvetica",id:"Helvetica"},{name:"  Courier",id:"Courier"},{name:"  Noto-Serif",id:"Noto-Serif"},{name:"  Noto-Sans",id:"Noto-Sans"}],i=[{name:"  Normal",id:"Normal"},{name:"  Bold",id:"Bold"},{name:"  Oblique",id:"Oblique"},{name:"  Bold Oblique",id:"BoldOblique"}];var s="letter",c=getPDFFormat();-1!=c.indexOf("a4")&&(s="a4",c=c.replace("_a4",""));var g=getPageNumbers(),d="yes"==getFirstPage(),u=gPDFFont,m=u.toLowerCase();"times"!=m&&"helvetica"!=m&&"courier"!=m&&"noto-serif"!=m&&"noto-sans"!=m&&(u="Times");var p=gPDFFontStyle;if("noto-serif"!=m&&"noto-sans"!=m||(p="Normal"),""==p)p="Normal";else{var h=p.toLowerCase();"Times"==u&&("italic"==h&&(p="Oblique"),"bolditalic"==h&&(p="BoldOblique")),"normal"!=(h=p.toLowerCase())&&"bold"!=h&&"oblique"!=h&&"boldoblique"!=h&&(p="Normal")}clearGetTuneByIndexCache();const f={configure_papersize:s,configure_tunelayout:c,configure_orientation:gPDFOrientation,configure_incipitscolumns:gIncipitsColumns,configure_pagenumber:g,configure_pagenumberonfirstpage:d,configure_fontname:u,configure_fontstyle:p,configure_hidden_titles:gPDFIncludeHiddenTitles,configure_auto_page_numbers:gPDFAutoPageNumbers};var b;b=e?isPureDesktopBrowser()?[{html:'<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">Export PDF Tunebook&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#export_pdf_tunebook" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="text-align:center;margin-top:24px;"><input id="tunebookbuilder-play" class="advancedcontrols btn btn-injectcontrols-tunebookbuilder-play" onclick="PDFTunebookBuilderPlayOnly();" type="button" value="Inject Only PDF Tunebook Play Features" title="Inject only minimal playback-related instrument and volume commands at the top of your tunebook ABC"><input id="tunebookbuilder" class="advancedcontrols btn btn-injectcontrols-tunebookbuilder" onclick="PDFTunebookBuilder();" type="button" value="Inject All PDF Tunebook Features" title="Inject commands at the top of your tunebook ABC for adding a Title Page, Table of Contents, Index, Page Headers, Page Footers, instruments and volumes for Playback Links, and Custom QR Code"></p>'},{name:"Paper Size:",id:"configure_papersize",type:"select",options:t,cssClass:"configure_pdf_papersize_select"},{name:"Orientation:",id:"configure_orientation",type:"select",options:n,cssClass:"configure_pdf_orientation_select"},{name:"Tune Layout:",id:"configure_tunelayout",type:"select",options:o,cssClass:"configure_pdf_tunelayout_select"},{name:"Notes Incipits Columns:",id:"configure_incipitscolumns",type:"select",options:a,cssClass:"configure_pdf_incipitscolumns_select"},{name:"Page Number Location:",id:"configure_pagenumber",type:"select",options:l,cssClass:"configure_pdf_pagenumber_select"},{name:"            Page Number on First Page",id:"configure_pagenumberonfirstpage",type:"checkbox",cssClass:"configure_pdf_settings_form_text"},{name:"            Inject tune title text for PDF searchability",id:"configure_hidden_titles",type:"checkbox",cssClass:"configure_pdf_settings_form_text"},{name:"            Automatically offset page numbers for Title Page and/or Table of Contents",id:"configure_auto_page_numbers",type:"checkbox",cssClass:"configure_pdf_settings_form_text"},{html:'<p id="exportpdfanchor" style="margin-top:20px;font-size:12pt;line-height:18px;font-family:helvetica;">Font for Title Page, Table of Contents, Index, Page Headers/Footers, Page Numbers, Text Incipits:</p>'},{name:"Font:",id:"configure_fontname",type:"select",options:r,cssClass:"configure_pdf_fontname_select"},{name:"Font Style:",id:"configure_fontstyle",type:"select",options:i,cssClass:"configure_pdf_fontstyle_select"},{html:'<p style="text-align:center;margin-top:36px;"><input id="pdfusebrowserprint" class="advancedcontrols btn btn-browser-pdf-export" onclick="Do_Browser_PDF_Export();return;" type="button" value="Browser Native Print-to-PDF with Play Links" title="Quickly export a PDF tunebook using the browser\'s native Print-to-PDF feature with one tune per page and play links when you click the title.&nbsp;&nbsp;Does not include a Title Page, Table of Contents, Index, or QR Code."></p>'}]:[{html:'<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">Export PDF Tunebook&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#export_pdf_tunebook" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="text-align:center;margin-top:24px;"><input id="tunebookbuilder-play" class="advancedcontrols btn btn-injectcontrols-tunebookbuilder-play" onclick="PDFTunebookBuilderPlayOnly();" type="button" value="Inject Only PDF Tunebook Play Features" title="Inject only minimal playback-related instrument and volume commands at the top of your tunebook ABC"><input id="tunebookbuilder" class="advancedcontrols btn btn-injectcontrols-tunebookbuilder" onclick="PDFTunebookBuilder();" type="button" value="Inject All PDF Tunebook Features" title="Inject commands at the top of your tunebook ABC for adding a Title Page, Table of Contents, Index, Page Headers, Page Footers, instruments and volumes for Playback Links, and Custom QR Code"></p>'},{name:"Paper Size:",id:"configure_papersize",type:"select",options:t,cssClass:"configure_pdf_papersize_select"},{name:"Orientation:",id:"configure_orientation",type:"select",options:n,cssClass:"configure_pdf_orientation_select"},{name:"Tune Layout:",id:"configure_tunelayout",type:"select",options:o,cssClass:"configure_pdf_tunelayout_select"},{name:"Notes Incipits Columns:",id:"configure_incipitscolumns",type:"select",options:a,cssClass:"configure_pdf_incipitscolumns_select"},{name:"Page Number Location:",id:"configure_pagenumber",type:"select",options:l,cssClass:"configure_pdf_pagenumber_select"},{name:"            Page Number on First Page",id:"configure_pagenumberonfirstpage",type:"checkbox",cssClass:"configure_pdf_settings_form_text"},{name:"            Inject tune title text for PDF searchability",id:"configure_hidden_titles",type:"checkbox",cssClass:"configure_pdf_settings_form_text"},{name:"            Automatically offset page numbers for Title Page and/or Table of Contents",id:"configure_auto_page_numbers",type:"checkbox",cssClass:"configure_pdf_settings_form_text"},{html:'<p id="exportpdfanchor" style="margin-top:20px;font-size:12pt;line-height:18px;font-family:helvetica;">Font for Title Page, Table of Contents, Index, Page Headers/Footers, Page Numbers, Text Incipits:</p>'},{name:"Font:",id:"configure_fontname",type:"select",options:r,cssClass:"configure_pdf_fontname_select"},{name:"Font Style:",id:"configure_fontstyle",type:"select",options:i,cssClass:"configure_pdf_fontstyle_select"},{html:'<p style="font-size:3pt;">&nbsp;</p>'}]:[{html:'<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">Export PDF Tunebook&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#export_pdf_tunebook" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{name:"Paper Size:",id:"configure_papersize",type:"select",options:t,cssClass:"configure_pdf_papersize_select"},{name:"Orientation:",id:"configure_orientation",type:"select",options:n,cssClass:"configure_pdf_orientation_select"},{name:"Tune Layout:",id:"configure_tunelayout",type:"select",options:o,cssClass:"configure_pdf_tunelayout_select"},{name:"Notes Incipits Columns:",id:"configure_incipitscolumns",type:"select",options:a,cssClass:"configure_pdf_incipitscolumns_select"},{name:"Page Number Location:",id:"configure_pagenumber",type:"select",options:l,cssClass:"configure_pdf_pagenumber_select"},{name:"            Page Number on First Page",id:"configure_pagenumberonfirstpage",type:"checkbox",cssClass:"configure_pdf_settings_form_text"},{name:"            Inject tune title text for PDF searchability",id:"configure_hidden_titles",type:"checkbox",cssClass:"configure_pdf_settings_form_text"},{name:"            Automatically offset page numbers for Title Page and/or Table of Contents",id:"configure_auto_page_numbers",type:"checkbox",cssClass:"configure_pdf_settings_form_text"},{html:'<p id="exportpdfanchor" style="margin-top:20px;font-size:12pt;line-height:18px;font-family:helvetica;">Font for Title Page, Table of Contents, Index, Page Headers/Footers, Page Numbers, Text Incipits:</p>'},{name:"Font:",id:"configure_fontname",type:"select",options:r,cssClass:"configure_pdf_fontname_select"},{name:"Font Style:",id:"configure_fontstyle",type:"select",options:i,cssClass:"configure_pdf_fontstyle_select"},{html:'<p style="font-size:3pt;">&nbsp;</p>'}],gIsSafari&&!isMobileBrowser()&&(b=b.concat([{html:'<p style="margin-top:24px;font-size:12pt;line-height:24px;font-family:helvetica;text-align:center;">On Safari, before clicking <strong>Export</strong>, please set the Zoom level to 100% by pressing ⌘+0 (zero)</p>'}])),setTimeout(function(){idlePDFExportDialog()},150);DayPilot.Modal.form(b,f,{theme:"modal_flat",top:25,width:760,scrollWithPage:AllowDialogsToScroll(),okText:"Export",autoFocus:!1}).then(function(e){if(!e.canceled){gIncipitsColumns=e.result.configure_incipitscolumns;var t=e.result.configure_papersize;gPDFPaperSize=t,gPDFIncludeHiddenTitles=e.result.configure_hidden_titles,gPDFAutoPageNumbers=e.result.configure_auto_page_numbers;var n=e.result.configure_tunelayout;"a4"==t&&("incipits_abc"==n?n="incipits_a4_abc":"incipits_abc_sort"==n?n="incipits_a4_abc_sort":"incipits_abc_full"==n?n="incipits_a4_abc_full":"incipits_abc_full_cce"==n?n="incipits_a4_abc_full_cce":"all_qr_codes"==n?n="all_qr_codes_a4":"mixed_notation_qr"==n?n="mixed_notation_qr_a4":n+="_a4"),sendGoogleAnalytics("pdf_orientation",gPDFOrientation=e.result.configure_orientation),"portrait"==gPDFOrientation?(gRenderPixelRatio=2,"letter"==t?(gPageWidth=535,gTPTOPOFFSET=435,gINDEXTOPOFFSET=330,gTOCTOPOFFSET=330,gPAGENUMBERTOP=296,gTEXTINCIPITTOPOFFSET=330,gTEXTINCIPITLEFTMARGIN=45,gTEXTINCIPITRIGHTMARGIN=200):(gPageWidth=535,gTPTOPOFFSET=455,gINDEXTOPOFFSET=350,gTOCTOPOFFSET=350,gPAGENUMBERTOP=313,gTEXTINCIPITTOPOFFSET=350,gTEXTINCIPITLEFTMARGIN=45,gTEXTINCIPITRIGHTMARGIN=195)):(gRenderPixelRatio=3,"letter"==t?(gPageWidth=718,gTPTOPOFFSET=330,gINDEXTOPOFFSET=265,gTOCTOPOFFSET=265,gPAGENUMBERTOP=232,gTEXTINCIPITTOPOFFSET=265,gTEXTINCIPITLEFTMARGIN=100,gTEXTINCIPITRIGHTMARGIN=250):(gPageWidth=785,gTPTOPOFFSET=350,gINDEXTOPOFFSET=255,gTOCTOPOFFSET=255,gPAGENUMBERTOP=232,gTEXTINCIPITTOPOFFSET=255,gTEXTINCIPITLEFTMARGIN=105,gTEXTINCIPITRIGHTMARGIN=281)),setPDFFormat(n),setPageNumbers(e.result.configure_pagenumber),setFirstPage(e.result.configure_pagenumberonfirstpage?"yes":"no");var o=e.result.configure_fontname;gPDFFont=o;var a=e.result.configure_fontstyle;if("Noto-Sans"==o||"Noto-Serif"==o)a="Normal";else if("Normal"==a)a="";else if("Times"===o)"oblique"==a.toLowerCase()?a="Italic":"boldoblique"==a.toLowerCase()&&(a="BoldItalic");gPDFFontStyle=a,SavePDFSettings(),clearGetTuneByIndexCache(),ExportPDF()}})}function BrowserPDFInjectInstruments(e){var t=gPDFTunebookConfig.melody_instrument,n=gPDFTunebookConfig.bass_instrument,o=gPDFTunebookConfig.chord_instrument;0==t?t="mute":((t-=1)<0||t>MIDI_PATCH_COUNT)&&(t=0),0==n?n="mute":((n-=1)<0||n>MIDI_PATCH_COUNT)&&(n=0),0==o?o="mute":((o-=1)<0||o>MIDI_PATCH_COUNT)&&(o=0);var a=gPDFTunebookConfig.bass_volume,l=gPDFTunebookConfig.chord_volume;switch(gPDFTunebookConfig.sound_font){case"fluid":default:e=InjectStringBelowTuneHeaderConditional(e,"%abcjs_soundfont fluid");break;case"musyng":e=InjectStringBelowTuneHeaderConditional(e,"%abcjs_soundfont musyng");break;case"fatboy":e=InjectStringBelowTuneHeaderConditional(e,"%abcjs_soundfont fatboy");break;case"canvas":e=InjectStringBelowTuneHeaderConditional(e,"%abcjs_soundfont canvas");break;case"mscore":e=InjectStringBelowTuneHeaderConditional(e,"%abcjs_soundfont mscore");break;case"arachno":e=InjectStringBelowTuneHeaderConditional(e,"%abcjs_soundfont arachno");break;case"fluidhq":e=InjectStringBelowTuneHeaderConditional(e,"%abcjs_soundfont fluidhq")}return e=InjectStringBelowTuneHeaderConditional(e,"%%MIDI program "+t),e=InjectStringBelowTuneHeaderConditional(e,"%%MIDI bassprog "+n),e=InjectStringBelowTuneHeaderConditional(e,"%%MIDI chordprog "+o),e=InjectStringBelowTuneHeaderConditional(e,"%%MIDI bassvol "+a),e=InjectStringBelowTuneHeaderConditional(e,"%%MIDI chordvol "+l),e=(e=InjectStringBelowTuneHeaderConditional(e,"%add_all_playback_links")).replace("\n\n","")}function Do_Browser_PDF_Export(){if(gRenderingPDF)return;for(var e=document.getElementsByClassName("modal_flat_cancel"),t=null,n=0;n<e.length&&"Cancel"!=(t=e[n]).innerText;++n);if(!t)return;t.click(),sendGoogleAnalytics("export","PrintToPDF"),loadPDFTunebookConfigFromABC(),gPDFTunebookConfig.sound_font&&""!=gPDFTunebookConfig.sound_font||(gPDFTunebookConfig.sound_font="fluid"),void 0!==gPDFTunebookConfig.bass_instrument&&null!==gPDFTunebookConfig.bass_instrument&&""!==gPDFTunebookConfig.bass_instrument||(gPDFTunebookConfig.bass_instrument=1),gPDFTunebookConfig.bass_volume&&""!=gPDFTunebookConfig.bass_volume||(gPDFTunebookConfig.bass_volume="64"),gPDFTunebookConfig.chord_volume&&""!=gPDFTunebookConfig.chord_volume||(gPDFTunebookConfig.chord_volume="64");var o=[];for(n=0;n<=MIDI_PATCH_COUNT;++n)o.push({name:"  "+generalMIDISoundNames[n],id:n});for(n=0;n<=MIDI_PATCH_COUNT;++n)o.push({name:"  "+generalMIDISoundNames[n],id:n});var a=[{html:'<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;margin-bottom:36px">Browser Native Print-to-PDF with Play Links&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#browser_print_to_pdf" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="margin-top:10px;margin-bottom:30px;font-size:12pt;line-height:18pt;font-family:helvetica">Clicking "Export" will use the browser\'s native PDF exporter to export a PDF with play links on each tune using the playback instruments and volumes selected below:</p>'},{name:"Soundfont for playback links:",id:"sound_font",type:"select",options:[{name:"  Fluid",id:"fluid"},{name:"  Musyng Kite",id:"musyng"},{name:"  FatBoy",id:"fatboy"},{name:"  Canvas",id:"canvas"},{name:"  MScore",id:"mscore"},{name:"  Arachno",id:"arachno"},{name:"  FluidHQ",id:"fluidhq"}],cssClass:"configure_nativepdftunebook_midi_program_select"},{name:"Melody instrument for playback links:",id:"melody_instrument",type:"select",options:o,cssClass:"configure_nativepdftunebook_midi_program_select"},{name:"Bass instrument for playback links:",id:"bass_instrument",type:"select",options:o,cssClass:"configure_nativepdftunebook_midi_program_select"},{name:"Bass volume (0-127):",id:"bass_volume",type:"number",cssClass:"configure_nativepdftunebook_form_text"},{name:"Chord instrument for playback links:",id:"chord_instrument",type:"select",options:o,cssClass:"configure_nativepdftunebook_midi_program_select"},{name:"Chord volume (0-127):",id:"chord_volume",type:"number",cssClass:"configure_nativepdftunebook_form_text"}];DayPilot.Modal.form(a,gPDFTunebookConfig,{theme:"modal_flat",top:100,width:690,scrollWithPage:AllowDialogsToScroll(),okText:"Export",autoFocus:!1}).then(function(e){e.canceled||(gPDFTunebookConfig.sound_font=e.result.sound_font,gPDFTunebookConfig.melody_instrument=e.result.melody_instrument,gPDFTunebookConfig.bass_instrument=e.result.bass_instrument,gPDFTunebookConfig.bass_volume=e.result.bass_volume,gPDFTunebookConfig.chord_instrument=e.result.chord_instrument,gPDFTunebookConfig.chord_volume=e.result.chord_volume,SaveConfigurationSettings(),setTimeout(function(){var e=CountTunes();if(0!=e){clearGetTuneByIndexCache();for(var t=[],n=0;n<e;++n){var o=getTuneByIndex(n),a=GetTuneAudioDownloadName(o,"");a.startsWith("*")&&(a=a.substring(1)),o=BrowserPDFInjectInstruments(o);var l=FillUrlBoxWithAbcInLZW(o=GetABCFileHeader()+o,!1),r=a.replaceAll(" ","_");r=r.replaceAll("#","^"),l=l.replaceAll("&","&amp;"),l+="&amp;name="+r+"&amp;play=1",t.push({Name:a,URL:l})}for(n=0;n<e;++n){var i=document.getElementById("notation"+n).querySelectorAll("svg")[0];if(i){const e=document.createElement("a");e.href=t[n].URL,e.style.textDecoration="none",i.parentNode.insertBefore(e,i),e.appendChild(i)}}setTimeout(function(){window.print(),setTimeout(function(){clearGetTuneByIndexCache();for(var t=0;t<e;++t){document.getElementById("notation"+t).querySelectorAll("a > svg").forEach(e=>{var t=e.parentNode;t.parentNode.insertBefore(e,t),t.remove()})}},100)},100)}},100))})}var gMoreABCToolsOKButton=null;function Configure_AdvancedControlsDialog_UI(){var e=gFeaturesShowTablatures,t=gFeaturesShowExplorers,n=gFeaturesShowExport,o=gFeaturesShowBagpipeDrones;const a={showtablatures:gFeaturesShowTablatures,showexplorers:gFeaturesShowExplorers,showexport:gFeaturesShowExport,showbagpipedrones:gFeaturesShowBagpipeDrones};var l=[{html:'<p style="text-align:center;font-size:14pt;font-family:helvetica;margin-left:15px;">More ABC Tools Feature Options</p>'},{name:"          Show Tablature Injectors",id:"showtablatures",type:"checkbox",cssClass:"configure_ui_options_form_text"},{name:"          Show MIDI, Swing, Grace, Roll, and Reverb Explorers",id:"showexplorers",type:"checkbox",cssClass:"configure_ui_options_form_text"}];isDesktopBrowser()?l.push({name:"          Show Export All Tunes, Sort by Tag, and Incipits Builder",id:"showexport",type:"checkbox",cssClass:"configure_ui_options_form_text"}):l.push({name:"          Show Sort by Tag and Incipits Builder",id:"showexport",type:"checkbox",cssClass:"configure_ui_options_form_text"}),l.push({name:"          Show abcjs Custom CSS Generator, Transpose to Key, and Inject Bagpipe Sounds",id:"showbagpipedrones",type:"checkbox",cssClass:"configure_ui_options_form_text"});DayPilot.Modal.form(l,a,{theme:"modal_flat",top:100,width:500,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(a){if(!a.canceled){if(gFeaturesShowTablatures=a.result.showtablatures,gFeaturesShowExplorers=a.result.showexplorers,gFeaturesShowExport=a.result.showexport,gFeaturesShowBagpipeDrones=a.result.showbagpipedrones,gFeaturesShowTablatures==e&&gFeaturesShowExplorers==t&&gFeaturesShowExport==n&&gFeaturesShowBagpipeDrones==o)return;SaveConfigurationSettings(),gMoreABCToolsOKButton.click(),setTimeout(function(){AdvancedControlsDialog()},250)}})}function IdleMoreABCTools(){for(var e=document.getElementsByClassName("modal_flat_ok"),t=null,n=0;n<e.length;++n)if("OK"==(t=e[n]).innerText){gMoreABCToolsOKButton=t;break}}function AdvancedControlsDialog(){sendGoogleAnalytics("dialog","AdvancedControlsDialog");var e='<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">More ABC Tools&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#more_tools" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span><img id="moreabctoolssettings" class="moreabctoolssettings moresettingsbutton" src="img/settings.png" title="More ABC Tools Settings" onclick="Configure_AdvancedControlsDialog_UI();"</img></p>';e+='<div id="advanced-controls-dialog">',e+='<p style="text-align:center;font-size:14pt;font-family:helvetica;margin-top:20px;">Show/Hide ABC Features</p>',e+='<p style="text-align:center;">',e+='<input id="toggleannotations" class="advancedcontrolsdisabled btn btn-advancedcontrols" onclick="ToggleAnnotations(false)" type="button" value="Hide Annotations" title="Hides/Shows all common annotations in the ABC">',e+='<input id="toggletext" class="advancedcontrolsdisabled btn btn-advancedcontrols" onclick="ToggleTextAnnotations(false)" type="button" value="Hide Text" title="Hides/Shows all text in the ABC">',e+='<input id="togglechords" class="advancedcontrolsdisabled btn btn-advancedcontrols" onclick="ToggleChords(false)" type="button" value="Hide Chords" title="Hides/Shows all chords in the ABC">',e+='<input id="toggletab" class="advancedcontrolsdisabled btn btn-advancedcontrols" onclick="ToggleTab(false)" type="button" value="Hide Injected Tab" title="Hides/Shows all injected tablature in the ABC">',e+='<input id="toggleornaments" class="advancedcontrolsdisabled btn btn-advancedcontrols" onclick="ToggleOrnaments(false)" type="button" value="Hide Ornaments" title="Hides/Shows all ~ and {} style ornaments in the ABC">',e+="</p>",e+='<p style="text-align:center;font-size:14pt;font-family:helvetica;margin-top:20px;">Strip ABC Features</p>',e+='<p style="text-align:center;">',e+='<input id="stripannotations" class="advancedcontrolsdisabled btn btn-injectcontrols" onclick="ToggleAnnotations(true)" type="button" value="Strip Annotations" title="Strips all common annotations from the ABC">',e+='<input id="striptext" class="advancedcontrolsdisabled btn btn-injectcontrols" onclick="ToggleTextAnnotations(true)" type="button" value="Strip Text" title="Strips all text from the ABC">',e+='<input id="stripchords" class="advancedcontrolsdisabled btn btn-injectcontrols" onclick="ToggleChords(true)" type="button" value="Strip Chords" title="Strips all chords from the ABC">',e+='<input id="striptab" class="advancedcontrolsdisabled btn btn-injectcontrols" onclick="ToggleTab(true)" type="button" value="Strip Injected Tab" title="Strips all injected tablature from the ABC">',e+='<input id="stripornaments" class="advancedcontrolsdisabled btn btn-injectcontrols" onclick="ToggleOrnaments(true)" type="button" value="Strip Ornaments" title="Strips all injected ~ and {} style ornaments from the ABC">',e+="</p>",e+='<p style="text-align:center;font-size:14pt;font-family:helvetica;margin-top:20px;">ABC Injection Features</p>',e+='<p style="text-align:center;">',e+='<input id="injecttunenumbers" class="advancedcontrols btn btn-injectcontrols-headers" onclick="TuneTitlesNumbersDialog()" type="button" value="Inject Tune Title Numbers" title="Opens a dialog where you can add or remove numbers on the tune titles">',e+='<input id="injectsectionheader" class="advancedcontrols btn btn-injectcontrols-headers" onclick="InjectSectionHeader()" type="button" value="Inject PDF Section Header" title="Injects a PDF section header placeholder tune at the cursor insertion point">',e+='<input id="injectfontsettings" class="advancedcontrols btn btn-injectcontrols-headers" onclick="InjectFontSettings()" type="button" value="Inject Font Settings" title="Injects all ABC font directives at the top of the current or all tunes from the current font settings">',e+="</p>",e+='<p style="text-align:center;margin-top:20px;">',e+='<input id="injectallmidiparams" class="advancedcontrols btn btn-injectcontrols-headers" onclick="InjectAllMIDIParams()" type="button" value="Inject MIDI Programs and Volumes" title="Injects MIDI Soundfont, Melody program, Bass program, Chord program, and volume annotations into one or all tunes">',e+='<input id="injectmetronome" class="advancedcontrols btn btn-injectcontrols-headers" onclick="InjectMetronome()" type="button" value="Inject Metronome" title="Injects ABC for a metronome into one or all tunes">',e+='<input id="injectclicktrackall" class="advancedcontrols btn btn-injectcontrols-headers" onclick="InjectRepeatsAndClickTrackAll()" type="button" value="Inject Repeats + Intros" title="Injects repeated copies of tunes and optional style-adaptive two-bar click intros into every tune">',e+="</p>",e+='<p style="text-align:center;margin-top:20px;">',e+='<input id="injectheaderstring" class="advancedcontrols btn btn-injectcontrols-headers" onclick="InjectHeaderString()" type="button" value="Inject ABC Header Text" title="Injects text at the top or bottom of the ABC header for one or all tunes">',e+='<input id="injectstaffwidth" class="advancedcontrols btn btn-injectcontrols-headers" onclick="InjectCustomStringedInstrumentTab()" type="button" value="Custom Stringed Instrument Tab" title="Injects a custom tablature description for stringed instruments">',e+='<input id="injectlargeprint" class="advancedcontrols btn btn-injectcontrols-headers" onclick="NotationSpacingExplorer()" type="button" value="Notation Spacing Explorer" title="Find the right spacing and scale values for your notation">',e+="</p>",gFeaturesShowTablatures&&(e+='<p style="text-align:center;margin-top:20px;">',e+='<input id="injectharmonicatab" class="advancedcontrols btn btn-injectcontrols" onclick="DoInjectHarmonicaTab()" type="button" value="Inject Harmonica Tab" title="Injects 10-hole diatonic harmonica tablature into the ABC">',e+='<input id="injectboxtab" class="advancedcontrols btn btn-injectcontrols" onclick="DoInjectBoxTablature()" type="button" value="Inject Irish Button Box Tab" title="Injects B/C or C#/D box tablature into the ABC">',e+='<input id="injectanglotab" class="advancedcontrols btn btn-injectcontrols" onclick="DoInjectTablature_Anglo()" type="button" value="Inject Anglo Concertina Tab" title="Injects Anglo Concertina tablature into the ABC">',e+="</p>",e+='<p style="text-align:center;margin-top:20px;">',e+='<input id="injectfiddlefingerings" class="advancedcontrols btn btn-injectcontrols" onclick="DoInjectTablature_Fiddle_Fingerings_Dialog()" type="button" value="Inject Fiddle Fingerings" title="Injects Fiddle fingerings tablature with either finger numbers or string names and finger numbers into the ABC">',e+='<input id="injectmd" class="advancedcontrols btn btn-injectcontrols" onclick="DoInjectTablature_MD()" type="button" value="Inject Dulcimer Tab" title="Injects Mountain Dulcimer tablature into the ABC">',e+='<input id="injectbambooflute" class="advancedcontrols btn btn-injectcontrols" onclick="DoInjectTablature_Bamboo_Flute()" type="button" value="Inject Bamboo Flute Tab" title="Injects Bamboo flute tablature into the ABC">',e+="</p>",e+='<p style="text-align:center;margin-top:20px;"><input id="ceoltastransform" style="margin-right:18px;" class="advancedcontrols btn btn-injectcontrols" onclick="DoCeoltasTransformDialog()" type="button" value="Comhaltas Transform" title="Brings up a dialog where you can transform the ABC to/from Comhaltas format"><input id="injectshapenotes" style="margin-right:18px;" class="advancedcontrols btn btn-injectcontrols" onclick="DoInjectTablature_ShapeNotes()" type="button" value="Inject Note Names/Shapes/Solfège" title="Injects note names (Pitch Names, Standard ABC, Comhaltas ABC), Shape Note shapes, or Solfège note names into the ABC"><input id="injectcustomtab" style="margin-right:18px;" class="advancedcontrols btn btn-injectcontrols" onclick="DoInjectCustomTab()" type="button" value="Inject Custom Tab" title="Injects custom tablature into the ABC"></p>'),gFeaturesShowExplorers&&(e+='<p style="text-align:center;margin-top:20px;"><input id="configure_instrument_explorer" class="configure_instrument_explorer button btn btn-instrumentexplorer" onclick="InstrumentExplorer();" type="button" value="MIDI Instrument Explorer" title="Brings up a tune player where you can experiment playing the current tune with different MIDI soundfonts and melody/chord instruments"><input id="configure_swing_explorer" class="btn btn-swingexplorer configure_swing_explorer " onclick="SwingExplorer()" type="button" value="Swing Explorer" title="Brings up a tune player where you can experiment with different swing factor settings"><input id="configure_grace_explorer" class="btn btn-graceexplorer configure_grace_explorer " onclick="GraceExplorer()" type="button" value="Grace Duration Explorer" title="Brings up a tune player where you can experiment with different grace note duration settings"><input id="configure_roll_explorer" class="btn btn-rollexplorer configure_roll_explorer " onclick="RollExplorer()" type="button" value="Roll Explorer" title="Brings up a tune player where you can experiment with different roll parameters"></p>'),gFeaturesShowExport&&gFeaturesShowExplorers?e+='<p style="text-align:center;margin-top:20px;"><input id="configure_reverb_explorer" class="btn btn-reverbexplorer configure_reverb_explorer " onclick="ReverbExplorer()" type="button" value="Reverb Explorer" title="Brings up a tune player where you can experiment with different reverb parameters"><input id="configure_batch_mp3_export" class="btn btn-batchmp3export configure_batch_mp3_export " onclick="ExportAll()" type="button" value="Export All Tunes" title="Exports all the tunes in the ABC text area as audio, image, MusicXML, and other formats"><input class="sortbutton btn btn-sortbutton" id="sortbutton" onclick="SortDialog()" type="button" value="Sort by Tag" title="Brings up the Sort by Specific Tag dialog"><input class="incipitsbuilder btn btn-incipitsbuilder" id="incipitsbuilder" onclick="IncipitsBuilderDialog()" type="button" value="Notes Incipits Builder" title="Formats the ABC for notation incipits PDF export"></p>':!gFeaturesShowExport&&gFeaturesShowExplorers?e+='<p style="text-align:center;margin-top:20px;"><input id="configure_reverb_explorer" class="btn btn-reverbexplorer configure_reverb_explorer " style="margin-right:0px" onclick="ReverbExplorer()" type="button" value="Reverb Explorer" title="Brings up a tune player where you can experiment with different reverb parameters"></p>':gFeaturesShowExport&&!gFeaturesShowExplorers&&(e+='<p style="text-align:center;margin-top:20px;"><input id="configure_batch_mp3_export" class="btn btn-batchmp3export configure_batch_mp3_export " onclick="ExportAll()" type="button" value="Export All Tunes" title="Exports all the tunes in the ABC text area as audio, image, MusicXML, and other formats"><input class="sortbutton btn btn-sortbutton" id="sortbutton" onclick="SortDialog()" type="button" value="Sort by Tag" title="Brings up the Sort by Specific Tag dialog"><input class="incipitsbuilder btn btn-incipitsbuilder" id="incipitsbuilder" onclick="IncipitsBuilderDialog()" type="button" value="Notes Incipits Builder" title="Formats the ABC for notation incipits PDF export"></p>'),gFeaturesShowBagpipeDrones&&(e+='<p style="text-align:center;margin-top:20px;"><input id="customcssgenerator" class="advancedcontrols btn btn-cssgenerator" onclick="abcjsColorEditor()" type="button" value="abcjs Custom CSS Generator" title="Inject a custom CSS block at the top of the ABC where you can set the color of each abcjs element"><input class="transposetokey btn btn-transposetokey" id="transposetokey" onclick="TransposeToKeyDialog()" type="button" value="Transpose to Key" title="Transposes one or all the tunes to a specific key"><input id="injectbagpipedrones" class="advancedcontrols btn btn-injectcontrols" onclick="InjectBagpipeSounds()" type="button" value="Inject Bagpipe Sounds" title="Changes the melody sound to one of several bagpipe instruments and inject drones as a second voice of the tune(s)"></p>'),e+="</div>";GetRadioValue("notenodertab");setTimeout(function(){IdleMoreABCTools()},25),setTimeout(function(){IdleAdvancedControls(!0),IdleAllowShowTabNames()},50),DayPilot.Modal.alert(e,{theme:"modal_flat",top:20,width:740,scrollWithPage:AllowDialogsToScroll()}).then(function(){}),document.getElementById("configure_batch_mp3_export")&&isMobileBrowser()&&(document.getElementById("configure_batch_mp3_export").style.display="none")}function ResetRollDefaultParams(){$('[name="configure_roll2_default"]').val("0.95 0.8 1.0 0.75 0.9 1.0 0.75 1.0"),$('[name="configure_roll3_default"]').val("1.45 0.6 1.0 0.75 0.9 1.0 0.75 1.0")}function launchCustomInstrumentBuilder(){sendGoogleAnalytics("action","LaunchCustomInstrumentBuilder"),window.open("https://michaeleskin.com/tools/custom_instrument_builder.html")}const USE_CUSTOM_INSTRUMENT_DB=!0;function isZipDescriptor(e){return!!e&&"string"==typeof e.name&&e.zipBytes instanceof ArrayBuffer}async function fileToZipDescriptor(e){const t=await e.arrayBuffer();return{name:e.name,zipBytes:t}}function displayZipName(e){return e&&e.name?e.name.replace(/\.zip$/i,""):""}var gCustomInstrumentSlots=[null,null,null,null,null,null,null,null],gCustomInstrumentState=null;function processCustomInstruments(e){gCustomInstrumentVolumeScaleOriginal=[1,1,1,1,1,1,1,1],gCustomInstrumentFadeOriginal=[100,100,100,100,100,100,100,100];var t=0;let n=0;!function o(){if(n>=gCustomInstrumentState.slots.length){if(0==t){var a="No Custom Instruments Loaded";return a=makeCenteredPromptString(a),void DayPilot.Modal.alert(a,{theme:"modal_flat",top:300,scrollWithPage:AllowDialogsToScroll()})}if(gCustomInstrumentShowStatus&&!e){var l='<p style="text-align:center;font-size:16pt;font-family:helvetica;margin-bottom:24px;margin-left:15px;">'+t+" Custom "+(t>1?"Instruments":"Instrument")+' Loaded&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#custom_midi_instrument" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p><p style="font-size:12pt;line-height:18pt;font-family:helvetica">In the following, replace (n) with 1-8 for the custom instrument number.</p><p style="font-size:12pt;line-height:18pt;font-family:helvetica">To play the custom instrument, add the following to your ABC tunes:</p><p style="font-size:12pt;line-height:18pt;font-family:helvetica"><strong>%%MIDI program custom(n)</strong></p><p style="font-size:12pt;line-height:18pt;font-family:helvetica">Example:<br/>%%MIDI program custom1</p><p style="font-size:12pt;line-height:18pt;font-family:helvetica">Custom instruments have default volume scale and fade values built-in.</p><p style="font-size:12pt;line-height:18pt;font-family:helvetica">To make the instrument volume louder or softer than the default,<br/>add the following to your ABC tunes:</p><p style="font-size:12pt;line-height:18pt;font-family:helvetica"><strong>%custom_instrument_(n)_volume_scale (scale_multiplier_float)</strong></p><p style="font-size:12pt;line-height:18pt;font-family:helvetica">Example:<br/>%custom_instrument_1_volume_scale 2.0</p><p style="font-size:12pt;line-height:18pt;font-family:helvetica">To change the note release fade time from the default,<br/>add the following to your ABC tunes:</p><p style="font-size:12pt;line-height:18pt;font-family:helvetica"><strong>%custom_instrument_(n)_fade (fade_time_in_ms)</strong></p><p style="font-size:12pt;line-height:18pt;font-family:helvetica">Example:<br/>%custom_instrument_1_fade 1000</p>';DayPilot.Modal.alert(l,{theme:"modal_flat",top:50,scrollWithPage:AllowDialogsToScroll()})}return}const r=gCustomInstrumentState.slots[n];n++,r?(t++,doCustomInstrumentImport(r,n,function(){o()})):(gCustomInstrumentSamples[n]=[],gSoundsCacheABCJS["custom"+n]={},o())}()}async function manageCustomInstrumentSlots(e){let t=!1;const n=Array.from(e||[]).filter(e=>e&&e.name&&e.name.toLowerCase().endsWith(".zip")),o=await Promise.all(n.map(fileToZipDescriptor)),a=gCustomInstrumentSlots,l="slotdlg_"+Math.random().toString(36).slice(2),r=l+"-root",i=(window.DayPilot&&DayPilot.Modal&&DayPilot.Modal.alert?DayPilot.Modal:DayPilot).alert(`<div id="${r}"></div>`,{top:50,width:780,theme:"modal_flat",okText:"Done",scrollWithPage:AllowDialogsToScroll()}).then(async function(){if(t=!0,gCustomInstrumentState&&gCustomInstrumentState.slots){if(gCustomInstrumentSlots=gCustomInstrumentState.slots.map(e=>e?{name:e.name,zipBytes:e.zipBytes}:null),"undefined"!=typeof CustomInstrumentsDB&&CustomInstrumentsDB.saveSlots)try{await CustomInstrumentsDB.saveSlots(gCustomInstrumentSlots)}catch(e){console.warn("Failed to persist custom instruments:",e)}processCustomInstruments(!1)}});await new Promise(requestAnimationFrame);const s=document.getElementById(r);if(!s)return console.warn("Slot dialog: modal host not found"),null;const c=Array.from({length:8},(e,t)=>{const n=a[t]??null;return isZipDescriptor(n)?n:null}),g=new Set(c.filter(Boolean).map(e=>e.name)),d=o.filter(e=>!g.has(e.name));gCustomInstrumentState={slots:c,pool:d,selectedPoolIndex:null};const u=document.createElement("style");u.textContent=`\n    #${l}-wrap { position: relative; font-family: system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;\n      max-width: 720px; width: min(720px, 92vw); margin: 0 auto; box-sizing: border-box; }\n    #${l}-grid { display: grid; gap: 8px; grid-template-columns: repeat(4, 1fr); margin-bottom:24px; }\n    @media (max-width: 520px) { #${l}-grid { grid-template-columns: repeat(2, 1fr); } }\n    .${l}-slot { border: 1px solid #ccc; border-radius: 10px; padding: 10px; min-height: 40px;\n      display:flex; align-items:center; justify-content:center; text-align:center; position:relative; background:#fff;\n      user-select: none; min-width: 0; }\n    .${l}-slot[data-has="false"] { color:#666; background:#fafafa; }\n    .${l}-slot[data-has="true"]  { font-weight: 600; }\n    .${l}-slot.dragover { outline: 2px dashed #888; outline-offset: 2px; }\n    .${l}-label { display: block; max-width: 100%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;font-size:11pt; }\n    .${l}-chip { border:1px solid #bbb; border-radius:8px; padding:8px 14px; margin:6px; display:inline-flex; align-items:center;\n      cursor:grab; user-select:none; background:#fff; font-size:12px; max-width: 320px; overflow: hidden; text-overflow: ellipsis;\n      white-space: nowrap; min-width: 0; }\n    .${l}-chip.selected { outline: 2px solid #007aff; }\n    .${l}-chip:active { cursor:grabbing; }\n    #${l}-buttons { display:flex; align-items:center; justify-content:flex-start; gap:12px; margin-top:12px; max-width:100%;\n      padding-right:4px; box-sizing:border-box; flex-wrap: wrap; }\n    .${l}-btn { padding:8px 14px; min-width:80px; border-radius:10px; border:1px solid #ccc; background:#fff; cursor:pointer; font-size:13px; }\n    .${l}-btn.primary { background:#007aff; border-color:#007aff; color:#fff; }\n    .${l}-btn.danger  { background:#ffdbdb; border-color:#9c0d0d; color:#9c0d0d; width:120px;}\n    @media (hover:hover){ .${l}-btn.danger:hover{ background:#D0B0B0; } }\n    #${l}-hint {margin-top:24px;margin-bottom:18px;}\n    #${l}-hint2 {margin-top:18px;margin-bottom:36px;}\n    #${l}-hint3 {margin-top:18px;margin-bottom:36px;}\n    .${l}-remove { position:absolute; top:4px; right:6px; color:#888; cursor:pointer; font-size:14px; line-height:1; user-select:none; }\n    .${l}-remove:hover { color:#e02424; }\n    #${l}-title{ text-align:center; font-size:18pt; font-family:helvetica; margin-bottom:36px; }\n    .${l}-slotnum { position:absolute; top:4px; left:6px; font-size:12px; color:#666; pointer-events:none; user-select:none; }\n    .${l}-doclink { position:absolute; top:-6px; left:0px; font-size:24pt; }\n    .${l}-doclink a { text-decoration:none; color:inherit; }\n    .${l}-doclink a:hover { color:#007aff; }\n    .${l}-chklabel { display: inline-flex; align-items: center; gap: 6px; font-size: 16px; color: #333; user-select: none; }\n  `,s.appendChild(u);const m=B("div",{id:`${l}-wrap`},s),p=B("span",{class:`${l}-doclink`},m);B("a",{text:"?",attrs:{href:"https://michaeleskin.com/abctools/userguide.html#custom_midi_instrument",target:"_blank",title:"View documentation in new tab"}},p),B("div",{id:`${l}-title`,text:"Assign Files to Custom Instruments"},m);const h=B("div",{id:`${l}-sections`},m),f=B("section",{id:`${l}-slots`},h);B("h3",{text:"Installed Custom Instruments"},f);const b=B("div",{id:`${l}-grid`},f);for(let e=0;e<8;e++){const t=B("div",{class:`${l}-slot`,attrs:{"data-slot":String(e),"data-has":gCustomInstrumentState.slots[e]?"true":"false"}},b);B("span",{class:`${l}-slotnum`,text:String(e+1)},t);const n=B("span",{class:`${l}-remove`,text:"×",attrs:{title:"Remove from this slot"}},t);B("span",{class:`${l}-label`,text:gCustomInstrumentState.slots[e]?displayZipName(gCustomInstrumentState.slots[e]):"Available",attrs:{title:gCustomInstrumentState.slots[e]?gCustomInstrumentState.slots[e].name:"Available"}},t);t.addEventListener("click",()=>{null!=gCustomInstrumentState.selectedPoolIndex&&x(gCustomInstrumentState.selectedPoolIndex,e)}),n.addEventListener("click",t=>{t.stopPropagation(),_(e)}),t.addEventListener("dragover",e=>{e.preventDefault(),t.classList.add("dragover")}),t.addEventListener("dragleave",()=>t.classList.remove("dragover")),t.addEventListener("drop",n=>{n.preventDefault(),t.classList.remove("dragover");try{const t=JSON.parse(n.dataTransfer.getData("text/plain")||"{}");if("pool"===t.type)x(0|t.index,e);else if("slot"===t.type){const n=0|t.index;if(n===e)return;const o=gCustomInstrumentState.slots[e];gCustomInstrumentState.slots[e]=gCustomInstrumentState.slots[n],gCustomInstrumentState.slots[n]=o,C()}}catch{}}),t.draggable=!0,t.addEventListener("dragstart",t=>{t.dataTransfer.setData("text/plain",JSON.stringify({type:"slot",index:e}))})}const y=B("section",{id:`${l}-pool`},h);B("h3",{text:"Available Custom Instrument Files"},y);const T=B("div",{id:`${l}-poolList`},y);B("div",{id:`${l}-hint`,text:"Drag-and-drop, or click a file then click an instrument slot."},y),B("div",{id:`${l}-hint2`,text:"Click × on an instrument slot to return its file to the list."},y),B("div",{id:`${l}-hint3`,text:"The custom instrument settings will be saved between sessions."},y),T.addEventListener("dragover",e=>e.preventDefault()),T.addEventListener("drop",e=>{e.preventDefault();try{const t=JSON.parse(e.dataTransfer.getData("text/plain")||"{}");if("slot"===t.type){const e=0|t.index;gCustomInstrumentState.slots[e]&&(gCustomInstrumentState.pool.push(gCustomInstrumentState.slots[e]),gCustomInstrumentState.slots[e]=null,gCustomInstrumentState.selectedPoolIndex=null,C(),v())}}catch{}});const I=B("div",{id:`${l}-buttons`},m);B("button",{class:`${l}-btn danger`,text:"Clear All"},I).addEventListener("click",async()=>{gCustomInstrumentState.slots.forEach(e=>{e&&gCustomInstrumentState.pool.push(e)});for(let e=0;e<8;e++)gCustomInstrumentState.slots[e]=null;if(gCustomInstrumentState.selectedPoolIndex=null,C(),v(),gCustomInstrumentSlots=Array(8).fill(null),"undefined"!=typeof CustomInstrumentsDB&&CustomInstrumentsDB.clearAll)try{await CustomInstrumentsDB.clearAll()}catch(e){console.warn("Failed to clear instrument DB:",e)}});const A=B("label",{class:`${l}-chklabel`},I),S=B("input",{attrs:{type:"checkbox",id:`${l}-keepChk`}},A);S.checked=gCustomInstrumentShowStatus,B("span",{text:"Show custom instrument load status after clicking Done"},A),S.addEventListener("change",()=>{gCustomInstrumentShowStatus=S.checked,void 0!==gLocalStorageAvailable&&gLocalStorageAvailable&&(localStorage.CustomInstrumentShowStatus=gCustomInstrumentShowStatus)});function C(){if(!t)for(let e=0;e<8;e++){const t=b.querySelector(`[data-slot="${e}"]`);if(!t)return;const n=!!gCustomInstrumentState.slots[e],o=t.querySelector(`.${l}-label`);if(t.dataset.has=n?"true":"false",n)o.textContent=displayZipName(gCustomInstrumentState.slots[e]),o.title=gCustomInstrumentState.slots[e].name;else{const e="Available";o.textContent=e,o.title=e}}}function v(){t||T&&(T.replaceChildren(),gCustomInstrumentState.pool.forEach((e,t)=>{const n=B("div",{class:`${l}-chip`+(gCustomInstrumentState.selectedPoolIndex===t?" selected":""),text:displayZipName(e),attrs:{title:e.name}},T);n.draggable=!0,n.addEventListener("click",()=>{gCustomInstrumentState.selectedPoolIndex=gCustomInstrumentState.selectedPoolIndex===t?null:t,v()}),n.addEventListener("dragstart",e=>{e.dataTransfer.setData("text/plain",JSON.stringify({type:"pool",index:t}))})}))}function x(e,t){null!=e&&gCustomInstrumentState.pool[e]&&(gCustomInstrumentState.slots[t]&&gCustomInstrumentState.pool.push(gCustomInstrumentState.slots[t]),gCustomInstrumentState.slots[t]=gCustomInstrumentState.pool[e],gCustomInstrumentState.pool.splice(e,1),gCustomInstrumentState.selectedPoolIndex=null,C(),v())}function _(e){gCustomInstrumentState.slots[e]&&(gCustomInstrumentState.pool.push(gCustomInstrumentState.slots[e]),gCustomInstrumentState.slots[e]=null,gCustomInstrumentState.selectedPoolIndex=null,C(),v())}function B(e,t={},n){const o=document.createElement(e);if(t.id&&(o.id=t.id),t.class&&(o.className=t.class),null!=t.text&&(o.textContent=t.text),t.attrs)for(const[e,n]of Object.entries(t.attrs))o.setAttribute(e,n);return n&&n.appendChild(o),o}document.addEventListener("keydown",e=>{"Escape"===e.key&&DayPilot.Modal.close(null)},{once:!0}),C(),v();const P=await i;return P&&"object"==typeof P&&"result"in P?P.result:null}async function doCustomInstrumentImport(e,t,n){function o(){try{"function"==typeof n&&n()}catch{}}try{if(!(e&&e.zipBytes instanceof ArrayBuffer))return o();if(t=parseInt(t,10),!Number.isFinite(t)||t<1||t>8)return o();const n=new JSZip,a=await n.loadAsync(e.zipBytes);gCustomInstrumentSamples[t]=[];const l=Object.keys(a.files);for(let e=0;e<l.length;e++){const n=l[e],o=a.files[n];if(o.dir)continue;const r=n.toLowerCase();if("abctools.json"!==r){if((r.endsWith(".wav")||r.endsWith(".mp3")||r.endsWith(".ogg"))&&!r.includes("macosx"))try{const e=await o.async("arraybuffer"),a=n.replace(/\.wav$/i,"").replace(/\.mp3$/i,"").replace(/\.ogg$/i,"");gCustomInstrumentSamples[t].push({name:a,samples:e})}catch(e){console.error("Error extracting",n,e)}}else try{const e=await o.async("string"),n=JSON.parse(e);"number"==typeof n.volumeScale&&(gCustomInstrumentVolumeScaleOriginal[t-1]=n.volumeScale),"number"==typeof n.fadeTimeMs&&(gCustomInstrumentFadeOriginal[t-1]=n.fadeTimeMs)}catch(e){console.error("Error reading abctools.json:",e)}}return gSoundsCacheABCJS["custom"+t]={},o()}catch(e){return console.error("doCustomInstrumentImport failed:",e),o()}}function readWavFile(e){return new Promise((t,n)=>{const o=new FileReader;o.onload=()=>{t(o.result)},o.onerror=n,o.readAsArrayBuffer(e)})}function idleAdvancedSettings(){gIsIOS&&document.getElementById("loadimpulsebutton").removeAttribute("accept"),document.getElementById("loadimpulsebutton").onchange=async()=>{let e=document.getElementById("loadimpulsebutton");if(0===e.files.length)return o=makeCenteredPromptString(o="Please select an custom reverb impulse .wav file"),void DayPilot.Modal.alert(o,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});let t=e.files[0];if(t)try{const e=await readWavFile(t);saveImpulse_DB("custom",e);var n,o="Custom reverb impulse file load successful!",a=[],l=gReverbKernels.length;for(n=0;n<l;++n){var r=gReverbKernels[n];"custom"!=r.style&&a.push(r)}gReverbKernels=a,o=makeCenteredPromptString(o),DayPilot.Modal.alert(o,{theme:"modal_flat",top:300,scrollWithPage:AllowDialogsToScroll()}),gSoundsCacheABCJS={}}catch(e){return o=makeCenteredPromptString(o="There was an issue reading the custom reverb impulse file."),void DayPilot.Modal.alert(o,{theme:"modal_flat",top:300,scrollWithPage:AllowDialogsToScroll()})}e.value=""}}function ShowBrowserInfo(){var e='<p style="text-align:center;font-size:18pt;font-family:helvetica">Browser Information</p>';e+='<p style="font-size:12pt;line-height:20pt;font-family:helvetica">',e+='Tool version: <span id="versionNumber" style="color:blue;cursor:pointer;" ',e+='title="Click to copy">'+gVersionNumber+"</span>",e+='<span id="copyTooltip" style="margin-left:10px;color:green;font-size:10pt;opacity:0;transition:opacity 0.5s;">Copied!</span></p>',e+='<p style="font-size:12pt;line-height:20pt;font-family:helvetica">navigator.userAgent: '+navigator.userAgent+"</p>",e+='<p style="font-size:12pt;line-height:20pt;font-family:helvetica">navigator.platform: '+navigator.platform+"</p>",e+='<p style="font-size:12pt;line-height:20pt;font-family:helvetica">navigator.vendor: '+navigator.vendor+"</p>",e+='<p style="font-size:12pt;line-height:20pt;font-family:helvetica">navigator.maxTouchPoints: '+navigator.maxTouchPoints+"</p>",e+='<p style="font-size:12pt;line-height:20pt;font-family:helvetica">gIsIOS: '+gIsIOS+"</p>",e+='<p style="font-size:12pt;line-height:20pt;font-family:helvetica">gIsIPhone: '+gIsIPhone+"</p>",e+='<p style="font-size:12pt;line-height:20pt;font-family:helvetica">gIsIPad: '+gIsIPad+"</p>",e+='<p style="font-size:12pt;line-height:20pt;font-family:helvetica">gIsAndroid: '+gIsAndroid+"</p>",e+='<p style="font-size:12pt;line-height:20pt;font-family:helvetica">localStorage available: '+gLocalStorageAvailable+"</p>",setTimeout(function(){var e=document.getElementById("versionNumber"),t=document.getElementById("copyTooltip");e&&e.addEventListener("click",function(){navigator.clipboard.writeText(gVersionNumber).then(function(){t&&(t.style.opacity="1",setTimeout(()=>{t.style.opacity="0"},1500))}).catch(function(e){console.error("Could not copy version number: ",e)})})},100),DayPilot.Modal.alert(e,{theme:"modal_flat",top:50,scrollWithPage:AllowDialogsToScroll()})}function AdvancedSettings(){sendGoogleAnalytics("dialog","AdvancedSettings");var e=gRawHighlightColor,t=gShowDiagnostics,n=gForceAndroid,o=gDisableAndroid;const a={configure_fullscreen_scaling:gFullScreenScaling,configure_highlight_color:gRawHighlightColor,configure_player_status_on_left:gPlayerStatusOnLeft,configure_large_player_controls:gLargePlayerControls,configure_autoscrollplayer:gAutoscrollPlayer,configure_autoscrollsmooth:gAutoscrollSmooth,configure_autoscrolltarget:gAutoscrollTarget,configure_trainer_touch_controls:gTrainerTouchControls,configure_mp3_bitrate:gMP3Bitrate,configure_export_delayms:gBatchExportDelayMS,configure_mp3export_delayms:gBatchMP3ExportDelayMS,configure_DisableRendering:gDisableNotationRendering,configure_disable_selected_play:gDisableSelectedPlay,configure_show_diagnostics:gShowDiagnostics,configure_reverb:gReverbString,configure_tinyurl:gTinyURLAPIKeyOverride,configure_confirm_clear:gConfirmClear,configure_show_render_progress:gShowABCJSRenderProgress,configure_clean_smartquotes:gCleanSmartQuotes,configure_jumptotune_autoscroll:gJumpToTuneAutoscroll,configure_force_android:gForceAndroid,configure_disable_android:gDisableAndroid};var l=[{html:'<p style="text-align:center;font-size:16pt;font-family:helvetica;margin-bottom:24px;margin-left:15px;">Advanced Settings&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#advanced_settings" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="font-size:12pt;line-height:12px;font-family:helvetica;"><strong>Only change these values if you know what you are doing!</strong></p>'}];l=l.concat([{name:"          Always confirm before deletion when clicking Clear",id:"configure_confirm_clear",type:"checkbox",cssClass:"advanced_settings2_form_text_checkbox"},{name:"          Always replace curly single and double quotes with standard versions on Open or Paste",id:"configure_clean_smartquotes",type:"checkbox",cssClass:"advanced_settings2_form_text_checkbox"},{name:"          Show ABC syntax validation panel",id:"configure_show_diagnostics",type:"checkbox",cssClass:"advanced_settings2_form_text_checkbox"},{name:"          Show tune rendering progress in Javascript console",id:"configure_show_render_progress",type:"checkbox",cssClass:"advanced_settings2_form_text_checkbox"},{name:"    Disable abcjs notation rendering",id:"configure_DisableRendering",type:"checkbox",cssClass:"advanced_settings2_form_text_checkbox"},{name:"    Jump to Tune always scrolls to the last selected tune",id:"configure_jumptotune_autoscroll",type:"checkbox",cssClass:"advanced_settings2_form_text_checkbox"},{name:"    Autoscroll player when playing",id:"configure_autoscrollplayer",type:"checkbox",cssClass:"advanced_settings2_form_text_checkbox"},{name:"    Smooth autoscroll when playing (when Autoscroll player is enabled)",id:"configure_autoscrollsmooth",type:"checkbox",cssClass:"advanced_settings2_form_text_checkbox"},{name:"    Player autoscroll vertical position target percentage (default is 66):",id:"configure_autoscrolltarget",type:"text",cssClass:"advanced_settings2_form_text"},{name:"    Player/Tune Trainer always plays full tune even if there is a selection region",id:"configure_disable_selected_play",type:"checkbox",cssClass:"advanced_settings2_form_text_checkbox"},{name:"    Player uses large controls (easier to touch on phone/tablet)",id:"configure_large_player_controls",type:"checkbox",cssClass:"advanced_settings2_form_text_checkbox"},{name:"    Player tunebook navigation controls on left side",id:"configure_player_status_on_left",type:"checkbox",cssClass:"advanced_settings2_form_text_checkbox"},{name:"    Player/Tune Trainer uses label L/R side click to decrement/increment values",id:"configure_trainer_touch_controls",type:"checkbox",cssClass:"advanced_settings2_form_text_checkbox"},{name:"Full screen tune display width scaling (percentage) (default is 50):",id:"configure_fullscreen_scaling",type:"number",cssClass:"advanced_settings2_form_text"}]),isPureDesktopBrowser()&&(l=l.concat([{name:"Highlighting color (HTML format) (default is #F00000):",id:"configure_highlight_color",type:"text",cssClass:"advanced_settings2_form_text"}])),l=l.concat([{name:"Default %reverb annotation (blank = no reverb):",id:"configure_reverb",type:"text",cssClass:"advanced_settings2_reverb_text"},{name:"MP3 audio export bitrate (kbit/sec) (default is 224):",id:"configure_mp3_bitrate",type:"number",cssClass:"advanced_settings2_form_text"}]),isPureDesktopBrowser()&&(l=l.concat([{name:"Image/ABC Batch Export Delay in milliseconds (default is 200):",id:"configure_export_delayms",type:"text",cssClass:"advanced_settings2_form_text"},{name:"MP3 Batch Export Delay in milliseconds (default is 250):",id:"configure_mp3export_delayms",type:"text",cssClass:"advanced_settings2_form_text"}])),gIsIOS||gIsIPad||l.push({name:"    Force Android phone UI (If mobile browser doesn't identify as Android)",id:"configure_force_android",type:"checkbox",cssClass:"advanced_settings2_form_text_checkbox"}),gIsIOS||gIsIPad||l.push({name:"    Disable Android phone UI (If mobile browser does identify as Android)",id:"configure_disable_android",type:"checkbox",cssClass:"advanced_settings2_form_text_checkbox"}),l=l.concat([{name:"Private TinyURL API Token:",id:"configure_tinyurl",type:"text",cssClass:"advanced_settings2_tinyurl_text"},{html:'<p style="text-align:center;margin-top:18px;margin-bottom:6px"><input id="customthemeeditor" class="btn btn-subdialog" onclick="customThemeEditor()" type="button" value="ABC Syntax Highlighting Theme Editor" title="Opens the ABC Syntax Highlighting Theme Editor"><label class="loadimpulsebutton btn btn-subdialog " for="loadimpulsebutton" title="Load a custom reverb convolution impulse .wav file">Load Custom Reverb Impulse <input type="file" id="loadimpulsebutton"  accept=".wav,.WAV" hidden/></label><input id="resetsettings" class="btn btn-resetsettings resetsettings" onclick="ResetSettingsDialog()" type="button" value="Reset Settings" title="Opens a dialog where you can reset all tool settings to the default and/or clear the instrument notes, reverb settings, and tune search engine collection databases"></p><p style="font-size:10pt;line-height:14pt;font-family:helvetica;color:grey;position:absolute;left:20px;bottom:30px;margin:0px;cursor:pointer;" onclick="ShowBrowserInfo();" title="Click to show browser information">Click to show browser info<br/>Installed version: '+gVersionNumber+"</p>"}]),setTimeout(function(){idleAdvancedSettings()},25);DayPilot.Modal.form(l,a,{theme:"modal_flat",top:10,width:800,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(a){if(!a.canceled){if(gJumpToTuneAutoscroll=a.result.configure_jumptotune_autoscroll,gConfirmClear=a.result.configure_confirm_clear,gCleanSmartQuotes=a.result.configure_clean_smartquotes,gShowDiagnostics=a.result.configure_show_diagnostics,updateDiagnostics(),gIsIOS||(gForceAndroid=a.result.configure_force_android,gDisableAndroid=a.result.configure_disable_android),gDisableNotationRendering=a.result.configure_DisableRendering){sendGoogleAnalytics("action","RenderDisable"),gTheNotation.innerHTML="";var l=document.getElementById("rawmodebutton");gRawLastIndex=-1,l.value="Highlighting",l.classList.add("btn-rawmode-off"),l.classList.remove("btn-rawmode-on"),gEnableSyntax?(setCMDarkMode(gDarkModeColor,gLightModeColor),gTheCM.refresh()):gTheABC.style.backgroundColor=gLightModeColor,gRawMode=!1}gShowABCJSRenderProgress=a.result.configure_show_render_progress,gFullScreenScaling=(gFullScreenScaling=a.result.configure_fullscreen_scaling).replace("%",""),(gFullScreenScaling=isNaN(parseInt(gFullScreenScaling))?50:parseInt(gFullScreenScaling))<25&&(gFullScreenScaling=25),gFullScreenScaling>100&&(gFullScreenScaling=100),gPlayerStatusOnLeft=a.result.configure_player_status_on_left,gLargePlayerControls=a.result.configure_large_player_controls,gAutoscrollPlayer=a.result.configure_autoscrollplayer,gAutoscrollSmooth=a.result.configure_autoscrollsmooth;var r=parseFloat(a.result.configure_autoscrolltarget);isNaN(r)||gAutoscrollTarget>=0&&gAutoscrollTarget<=100&&(gAutoscrollTarget=r),gTrainerTouchControls=a.result.configure_trainer_touch_controls,gDisableSelectedPlay=a.result.configure_disable_selected_play,gReverbString=a.result.configure_reverb;var i=parseInt(a.result.configure_mp3_bitrate);isNaN(i)||((gMP3Bitrate=i)<96&&(gMP3Bitrate=96),gMP3Bitrate>384&&(gMP3Bitrate=384));var s=a.result.configure_tinyurl;if(s&&(s=s.trim()),s&&""!=s?(gDoTinyURLAPIKeyOverride||sendGoogleAnalytics("sharing","custom_tinyurl_token_entered"),gTinyURLAPIKeyOverride=s,gDoTinyURLAPIKeyOverride=!0):(gTinyURLAPIKeyOverride="",gDoTinyURLAPIKeyOverride=!1),IdleAllowShowTabNames(),isPureDesktopBrowser()&&(gRawHighlightColor=a.result.configure_highlight_color,r=a.result.configure_export_delayms,r=parseInt(r),isNaN(r)||r>=0&&(gBatchExportDelayMS=r),r=a.result.configure_mp3export_delayms,r=parseInt(r),isNaN(r)||r>=0&&(gBatchMP3ExportDelayMS=r),gRawMode&&gRawHighlightColor!=e&&RenderAsync(!0,null)),t!=gShowDiagnostics&&HandleWindowResize(),SaveConfigurationSettings(),!gIsIOS){var c;if(n!=gForceAndroid)return c=makeCenteredPromptString(c="The tool will restart since the forcing Android setting changed."),void DayPilot.Modal.alert(c,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()}).then(function(e){window.location.reload()});if(o!=gDisableAndroid)return c=makeCenteredPromptString(c="The tool will restart since the disabling Android setting changed."),void DayPilot.Modal.alert(c,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()}).then(function(e){window.location.reload()})}}})}function idleConfigurePlayerSettings(){gIsIOS&&document.getElementById("loadinstrumentbutton").removeAttribute("accept"),document.getElementById("loadinstrumentbutton").onchange=async()=>{let e=document.getElementById("loadinstrumentbutton");0!==e.files.length&&(manageCustomInstrumentSlots(e.files),e.value="")}}function ConfigurePlayerSettings(e){sendGoogleAnalytics("dialog","ConfigurePlayerSettings");for(var t=[],n=0;n<=MIDI_PATCH_COUNT;++n)t.push({name:"  "+generalMIDISoundNames[n],id:n});var o,a=gDefaultSoundFont;o="mute"==gTheMelodyProgram?0:parseInt(gTheMelodyProgram)+1;var l;l="mute"==gTheChordProgram?0:parseInt(gTheChordProgram)+1;var r;r="mute"==gTheBassProgram?0:parseInt(gTheBassProgram)+1;const i={configure_soundfont:gDefaultSoundFont,configure_melody_program:o,configure_bass_program:r,configure_chord_program:l,configure_bass_volume:gTheBassVolume,configure_chord_volume:gTheChordVolume,configure_override_play_midi_params:gOverridePlayMIDIParams,configure_player_scaling:gPlayerScaling,configure_always_play_alternate_chords:gPlayAlternateChordsOverride,configure_metronome_high_sound:gMetronomeHighSound,configure_metronome_low_sound:gMetronomeLowSound,configure_metronome_high_volume:gMetronomeHighVolume,configure_metronome_low_volume:gMetronomeLowVolume,configure_wide_playback_cursor:gUseWidePlayCursor,configure_always_flatten_parts:gAlwaysFlattenParts},s=[{name:" Acoustic Bass Drum",id:"35"},{name:" Bass Drum",id:"36"},{name:" Side Stick",id:"37"},{name:" Acoustic Snare",id:"38"},{name:" Hand Clap",id:"39"},{name:" Electric Snare",id:"40"},{name:" Low Floor Tom",id:"41"},{name:" Closed Hi-Hat",id:"42"},{name:" High Floor Tom",id:"43"},{name:" Pedal Hi-Hat",id:"44"},{name:" Low Tom",id:"45"},{name:" Open Hi-Hat",id:"46"},{name:" Low Mid Tom",id:"47"},{name:" High Mid Tom",id:"48"},{name:" Crash Cymbal 1",id:"49"},{name:" High Tom",id:"50"},{name:" Ride Cymbal 1",id:"51"},{name:" Chinese Cymbal",id:"52"},{name:" Ride Bell",id:"53"},{name:" Tambourine",id:"54"},{name:" Splash Cymbal",id:"55"},{name:" Cowbell",id:"56"},{name:" Crash Cymbal 2",id:"57"},{name:" Vibraslap",id:"58"},{name:" Ride Cymbal 2",id:"59"},{name:" High Bongo",id:"60"},{name:" Low Bongo",id:"61"},{name:" Mute High Conga",id:"62"},{name:" Open High Conga",id:"63"},{name:" Low Conga",id:"64"},{name:" High Timbale",id:"65"},{name:" Low Timbale",id:"66"},{name:" High Agogo",id:"67"},{name:" Low Agogo",id:"68"},{name:" Cabasa",id:"69"},{name:" Maracas",id:"70"},{name:" Short Whistle",id:"71"},{name:" Long Whistle",id:"72"},{name:" Short Guiro",id:"73"},{name:" Long Guiro",id:"74"},{name:" Claves",id:"75"},{name:" High Wood Block",id:"76"},{name:" Low Wood Block",id:"77"},{name:" Mute Cuica",id:"78"},{name:" Open Cuica",id:"79"},{name:" Mute Triangle",id:"80"},{name:" Open Triangle",id:"81"}];var c=[{html:'<p style="text-align:center;font-size:16pt;font-family:helvetica;margin-left:15px;">Player Instrument Settings&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#default_player_settings" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p class="configure_settings_form_text_fs">The following values are used as the instrument and volume defaults if not already specified in a tune:</p>'},{name:"Default MIDI Soundfont:",id:"configure_soundfont",type:"select",options:[{name:"  Fluid",id:"https://paulrosen.github.io/midi-js-soundfonts/FluidR3_GM/"},{name:"  Musyng Kite",id:"https://paulrosen.github.io/midi-js-soundfonts/MusyngKite/"},{name:"  FatBoy",id:"https://michaeleskin.com/abctools/soundfonts/fatboy_4/"},{name:"  Canvas",id:"https://michaeleskin.com/abctools/soundfonts/canvas/"},{name:"  MScore",id:"https://michaeleskin.com/abctools/soundfonts/mscore_2/"},{name:"  Arachno",id:"https://michaeleskin.com/abctools/soundfonts/arachno_3/"},{name:"  FluidHQ",id:"https://michaeleskin.com/abctools/soundfonts/fluidhq_1/"}],cssClass:"configure_settings_select_fs"},{name:"Default Melody MIDI program:",id:"configure_melody_program",type:"select",options:t,cssClass:"configure_midi_program_form_select"},{name:"Default Bass MIDI program:",id:"configure_bass_program",type:"select",options:t,cssClass:"configure_midi_program_form_select"},{name:"Default Chords MIDI program:",id:"configure_chord_program",type:"select",options:t,cssClass:"configure_midi_program_form_select"},{name:"Default Bass MIDI volume (0-127):",id:"configure_bass_volume",type:"number",cssClass:"configure_settings_form_text_fs"},{name:"Default Chords MIDI volume (0-127):",id:"configure_chord_volume",type:"number",cssClass:"configure_settings_form_text_fs"},{html:'<p class="configure_settings_form_text_fs">Check the following box if you want the above values to override any instruments or volumes already specified in a tune when playing.</p>'},{name:"            Override all MIDI programs and volumes in the ABC with the defaults when playing tunes",id:"configure_override_play_midi_params",type:"checkbox",cssClass:"configure_settings_form_text_checkbox_fs"},{name:'            Always play alternate chords wrapped in parenthesis (examples:  "(Gm7)"  "G(Dm7)")',id:"configure_always_play_alternate_chords",type:"checkbox",cssClass:"configure_settings_form_text_checkbox_fs2"},{name:"Metronome first beat sound (default is High Wood Block):  ",id:"configure_metronome_high_sound",type:"select",options:s,cssClass:"configure_midi_program_form_select"},{name:"Metronome first beat volume (0-127, default is 64):",id:"configure_metronome_high_volume",type:"text",cssClass:"configure_settings_form_text_fs"},{name:"Metromone other beats sound (default is Low Wood Block):",id:"configure_metronome_low_sound",type:"select",options:s,cssClass:"configure_midi_program_form_select"},{name:"Metronome other beats volume (0-127, default is 48):",id:"configure_metronome_low_volume",type:"text",cssClass:"configure_settings_form_text_fs"}];e&&(c=c.concat([{name:"Player screen width (percentage) (min is 50, max is 100):",id:"configure_player_scaling",type:"number",cssClass:"configure_settings_form_text_fs"}])),c=(c=c.concat([{name:"            Player uses wide note highlight cursor",id:"configure_wide_playback_cursor",type:"checkbox",cssClass:"configure_settings_form_text_checkbox_fs"},{name:"            Always flatten playback parts when P:AABBCC style parts order is specified in a tune",id:"configure_always_flatten_parts",type:"checkbox",cssClass:"configure_settings_form_text_checkbox_fs"}])).concat([{html:'<p style="text-align:center;margin-top:24px"><label class="btn btn-subdialog loadinstrumentbutton" for="loadinstrumentbutton" title="Load one or more Custom Instruments">Load Custom Instruments <input type="file" id="loadinstrumentbutton" accept=".zip" multiple hidden/></label><input id="configurecustominstruments" class="advancedcontrols btn btn-subdialog" onclick="manageCustomInstrumentSlots()" type="button" value="Configure Custom Instruments" title="Brings up the Assign Files to Custom Instruments dialog"><input id="launchcustominstrumentbuilder" class="advancedcontrols btn btn-subdialog" onclick="launchCustomInstrumentBuilder()" type="button" value="Launch Custom Instrument Builder" title="Launches the Custom Instrument Builder utility in a new browser tab"></p>'}]),setTimeout(function(){idleConfigurePlayerSettings()},25);DayPilot.Modal.form(c,i,{theme:"modal_flat",top:10,width:790,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(t){if(t.canceled)FocusAfterOperation(),e&&e(!1);else{e&&(gPlayerScaling=(gPlayerScaling=t.result.configure_player_scaling).replace("%",""),(gPlayerScaling=isNaN(parseInt(gPlayerScaling))?gIsIPad?60:50:parseInt(gPlayerScaling))<50&&(gPlayerScaling=50),gPlayerScaling>100&&(gPlayerScaling=100)),gAlwaysFlattenParts=t.result.configure_always_flatten_parts,gDefaultSoundFont=t.result.configure_soundfont,a!=gDefaultSoundFont&&(gTheActiveSoundFont=gDefaultSoundFont,gSoundsCacheABCJS={}),gTheMelodyProgram=t.result.configure_melody_program,gTheBassProgram=t.result.configure_bass_program,gTheChordProgram=t.result.configure_chord_program,0==gTheMelodyProgram?gTheMelodyProgram="mute":gTheMelodyProgram--,"mute"!=gTheMelodyProgram&&(isNaN(parseInt(gTheMelodyProgram))&&(gTheMelodyProgram=0),gTheMelodyProgram<0&&(gTheMelodyProgram=0),gTheMelodyProgram>MIDI_PATCH_COUNT&&(gTheMelodyProgram=MIDI_PATCH_COUNT)),0==gTheBassProgram?gTheBassProgram="mute":gTheBassProgram--,"mute"!=gTheBassProgram&&(isNaN(parseInt(gTheBassProgram))&&(gTheBassProgram=0),gTheBassProgram<0&&(gTheBassProgram=0),gTheBassProgram>MIDI_PATCH_COUNT&&(gTheBassProgram=MIDI_PATCH_COUNT)),0==gTheChordProgram?gTheChordProgram="mute":gTheChordProgram--,"mute"!=gTheChordProgram&&(isNaN(parseInt(gTheChordProgram))&&(gTheChordProgram=0),gTheChordProgram<0&&(gTheChordProgram=0),gTheChordProgram>MIDI_PATCH_COUNT&&(gTheChordProgram=MIDI_PATCH_COUNT)),gTheBassVolume=t.result.configure_bass_volume,gTheChordVolume=t.result.configure_chord_volume,isNaN(parseInt(gTheBassVolume))&&(gTheBassVolume=0),gTheBassVolume<0&&(gTheBassVolume=0),gTheBassVolume>127&&(gTheBassVolume=127),isNaN(parseInt(gTheChordVolume))&&(gTheChordVolume=0),gTheChordVolume<0&&(gTheChordVolume=0),gTheChordVolume>127&&(gTheChordVolume=127),gOverridePlayMIDIParams=t.result.configure_override_play_midi_params,gPlayAlternateChordsOverride=t.result.configure_always_play_alternate_chords,gMetronomeHighSound=t.result.configure_metronome_high_sound,gMetronomeLowSound=t.result.configure_metronome_low_sound;var n=t.result.configure_metronome_high_volume;if(n=parseInt(n),isNaN(n)||n>=0&&n<128&&(gMetronomeHighVolume=n),n=t.result.configure_metronome_low_volume,n=parseInt(n),isNaN(n)||n>=0&&n<128&&(gMetronomeLowVolume=n),gUseWidePlayCursor=t.result.configure_wide_playback_cursor,document.querySelectorAll('style[custom_cursor_definition="true"]').forEach(e=>e.remove()),gUseWidePlayCursor){const e=document.createElement("style");e.setAttribute("custom_cursor_definition","true"),e.textContent=".abcjs-cursor{stroke:#00F000;stroke-width:12px;stroke-opacity:0.25;transform:translate(7px,0px);}",document.head.appendChild(e)}SaveConfigurationSettings(),e&&e(!0)}})}function ConfigureToolSettings(){sendGoogleAnalytics("dialog","ConfigureToolSettings");var e=gSaveLastAutoSnapShot,t=gStaffSpacing-STAFFSPACEOFFSET,n=gShowTabNames,o=gCapo,a=gUseCustomGMSounds,l=gAllowMIDIInput,r=gFeaturesShowTabButtons,i=gUseComhaltasABC,s=gForceComhaltasABC,c=giPadTwoColumn,g=gShowRecorderTab,d=GetRadioValue("notenodertab"),u=gRecorderFingeringGerman,m=gEnableSyntax,p=gSyntaxDarkMode;const h={configure_save_exit_snapshot:gSaveLastAutoSnapShot,configure_editor_fontsize:gABCEditorFontsize,configure_staff_spacing:t,configure_capo:gCapo,configure_show_tab_names:gShowTabNames,configure_use_custom_gm_sounds:gUseCustomGMSounds,configure_open_links_in_trainer:gOpenLinksInTrainer,configure_auto_swing_hornpipes:gAutoSwingHornpipes,configure_auto_swing_factor:gAutoSwingFactor,configure_allow_midi_input:gAllowMIDIInput,configure_midi_chromatic:gMIDIChromatic,configure_show_tab_buttons:gFeaturesShowTabButtons,configure_show_dgdae:gShowDGDAETab,configure_show_cgda:gShowCGDATab,configure_show_recorder:gShowRecorderTab,configure_recorder_german:gRecorderFingeringGerman,configure_comhaltas:gUseComhaltasABC,configure_RollUseRollForIrishRoll:gRollUseRollForIrishRoll,configure_allow_offline_instruments:gAllowOfflineInstruments,configure_ipad_two_column:giPadTwoColumn,configure_player_scaling:gPlayerScaling,configure_syntax_highlighting:gEnableSyntax,configure_syntax_highlighting_dark:gSyntaxDarkMode};var f=[{html:'<p style="text-align:center;font-size:16pt;font-family:helvetica;margin-left:15px;">ABC Transcription Tools Settings&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#settings_dialog" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'}];gIsIPad&&f.push({name:"    iPad Side-by-Side view (similar to desktop)",id:"configure_ipad_two_column",type:"checkbox",cssClass:"configure_settings_form_text_checkbox"}),isPureDesktopBrowser()?f.push({name:"          Enable ABC syntax highlighting (change requires restart)",id:"configure_syntax_highlighting",type:"checkbox",cssClass:"configure_settings_form_text_checkbox"}):f.push({name:"          Enable ABC syntax highlighting (change requires restart, some issues on mobile browsers)",id:"configure_syntax_highlighting",type:"checkbox",cssClass:"configure_settings_form_text_checkbox"}),f.push({name:"          Use Dark Mode for the editor when syntax highlighting is enabled",id:"configure_syntax_highlighting_dark",type:"checkbox",cssClass:"advanced_settings2_form_text_checkbox"}),f=f.concat([{name:"Player screen width (percentage) (min is 50, max is 100):",id:"configure_player_scaling",type:"number",cssClass:"configure_settings_form_text"},{name:"          Show instrument tablature button bar below ABC editor",id:"configure_show_tab_buttons",type:"checkbox",cssClass:"configure_settings_form_text_checkbox"}]),isPureDesktopBrowser()&&f.push({name:"   Save an Auto-Snapshot on browser tab close or reload (Restore it from the Add dialog)",id:"configure_save_exit_snapshot",type:"checkbox",cssClass:"configure_settings_form_text_checkbox"}),isDesktopBrowser()&&f.push({name:"ABC Editor Font Size (default is 13):",id:"configure_editor_fontsize",type:"number",cssClass:"configure_settings_form_text"}),f=f.concat([{name:"Space between the staves (default is 10, minimum is -40):",id:"configure_staff_spacing",type:"number",cssClass:"configure_settings_form_text"},{name:"    Note name tablature uses Comhaltas style ABC (D' E' F' instead of d e f for octave notes)",id:"configure_comhaltas",type:"checkbox",cssClass:"configure_settings_form_text_checkbox"},{name:"          Show CGDA as the 4-string tab option (default is GDAD)",id:"configure_show_cgda",type:"checkbox",cssClass:"configure_settings_form_text_checkbox"},{name:"          Show DGDAE as the 5-string tab option (default is CGDAE)",id:"configure_show_dgdae",type:"checkbox",cssClass:"configure_settings_form_text_checkbox"},{name:"Stringed instrument capo fret position:",id:"configure_capo",type:"number",cssClass:"configure_settings_form_text"},{name:"    Show stringed instrument names on tablature (single-voice tunes only, not shown in the Player)",id:"configure_show_tab_names",type:"checkbox",cssClass:"configure_settings_form_text_checkbox"},{name:"          Show Recorder tab button instead of the Whistle tab button",id:"configure_show_recorder",type:"checkbox",cssClass:"configure_settings_form_text_checkbox"},{name:"          Use German Recorder fingerings (default is Baroque Recorder fingerings)",id:"configure_recorder_german",type:"checkbox",cssClass:"configure_settings_form_text_checkbox"},{html:'<p style="text-align:center;"><input id="abcplayer_settingsbutton" style="margin-left:0px" class="abcplayer_settingsbutton btn btn-configuresettingsfromhelp" onclick="ConfigurePlayerSettings(null);" type="button" value="Select Default Player Instruments and Volumes" title="Brings up the Player Instrument Settings dialog where you can select the default MIDI soundfont, MIDI instruments, and MIDI volumes to use when playing tunes.&nbsp;&nbsp;You can also load and manage custom instruments from this dialog."><input id="managedatabases" class="btn btn-managedatabases managedatabases" onclick="ManageDatabasesDialog()" type="button" value="Manage Notes, Reverb, and Tune Search Databases" title="Opens a dialog where you can manage the instrument notes, reverb settings, and tune search engine collection databases"></p>'},{name:"    Allow instrument notes and reverb settings database to be used offline",id:"configure_allow_offline_instruments",type:"checkbox",cssClass:"configure_settings_form_text_checkbox"},{name:"    Use custom sounds for Dulcimer, Accordion, Flute, Whistle, Banjo, Bagpipe, Fiddle, and Bodhran",id:"configure_use_custom_gm_sounds",type:"checkbox",cssClass:"configure_settings_form_text_checkbox"},{name:"            Automatically swing Hornpipes when playing (enabled if R:Hornpipe is found in the tune)",id:"configure_auto_swing_hornpipes",type:"checkbox",cssClass:"configure_settings_form_text_checkbox"},{name:"Auto-swing scale factor (range is -0.9 to 0.9, default for Hornpipes is 0.25):",id:"configure_auto_swing_factor",type:"number",cssClass:"configure_settings_form_text"},{name:"    Rolls indicated in the ABC with ~ use the custom abcjs roll playback solution",id:"configure_RollUseRollForIrishRoll",type:"checkbox",cssClass:"configure_settings_form_text_checkbox"},{name:"            Open exported PDF and Website play links in the Tune Trainer",id:"configure_open_links_in_trainer",type:"checkbox",cssClass:"configure_settings_form_text_checkbox"}]),browserSupportsMIDI()&&(f.push({name:"    Allow MIDI input for ABC text entry",id:"configure_allow_midi_input",type:"checkbox",cssClass:"configure_settings_form_text_checkbox"}),f.push({name:"    MIDI input is key and mode aware (if unchecked, enters note names with no accidentals)",id:"configure_midi_chromatic",type:"checkbox",cssClass:"configure_settings_form_text_checkbox"})),gUpdateAvailable?f.push({html:'<p style="text-align:center;"><input id="configure_fonts" class="btn btn-subdialog configure_fonts" onclick="ConfigureFonts()" type="button" value="Font Settings" title="Configure the fonts used for rendering the ABC"><input id="configure_box" class="btn btn-subdialog configure_box" onclick="ConfigureTablatureSettings()" type="button" value="Tablature Injection Settings" title="Configure the tablature injection settings"><input id="configure_musicxml_import" class="btn btn-subdialog configure_musicxml_import" onclick="ConfigureMusicXMLImport()" type="button" value="MusicXML/MIDI Settings" title="Configure MusicXML/MIDI import settings"><input id="configure_developer_settings" class="btn btn-subdialog configure_developer_settings" onclick="AdvancedSettings()" type="button" value="Advanced Settings" title="Configure low level tool settings"></p><p style="font-size:10pt;font-family:helvetica;line-height:14pt;color:red;position:absolute;left:20px;bottom:20px;margin:0px;cursor:pointer;" title="Click to update to the latest version of the tool" onclick="UpdateToLatestVersion();">Click here to update to the latest version<br/>Latest version: '+gUpdateVersion+"<br/>Installed version: "+gVersionNumber+"</p>"}):f.push({html:'<p style="text-align:center;"><input id="configure_fonts" class="btn btn-subdialog configure_fonts" onclick="ConfigureFonts()" type="button" value="Font Settings" title="Configure the fonts used for rendering the ABC"><input id="configure_box" class="btn btn-subdialog configure_box" onclick="ConfigureTablatureSettings()" type="button" value="Tablature Injection Settings" title="Configure the tablature injection settings"><input id="configure_musicxml_import" class="btn btn-subdialog configure_musicxml_import" onclick="ConfigureMusicXMLImport()" type="button" value="MusicXML/MIDI Settings" title="Configure MusicXML/MIDI import settings"><input id="configure_developer_settings" class="btn btn-subdialog configure_developer_settings" onclick="AdvancedSettings()" type="button" value="Advanced Settings" title="Configure low level tool settings"></p><p style="font-size:10pt;font-family:helvetica;line-height:14pt;color:grey;position:absolute;left:20px;bottom:20px;margin:0px;cursor:pointer;" title="Click to update to the latest version" onclick="UpdateToLatestVersion();">You have the latest version<br/>Version: '+gVersionNumber+"<br>Click here to force an update</p>"});DayPilot.Modal.form(f,h,{theme:"modal_flat",top:10,width:790,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(h){if(h.canceled)FocusAfterOperation();else{gEnableSyntax=h.result.configure_syntax_highlighting,gSyntaxDarkMode=h.result.configure_syntax_highlighting_dark;var f=gEnableSyntax!=m;isPureDesktopBrowser()?(gSaveLastAutoSnapShot=h.result.configure_save_exit_snapshot)?e!=gSaveLastAutoSnapShot&&AddTabCloseListener():(gLocalStorageAvailable&&(localStorage.LastAutoSnapShot=""),e!=gSaveLastAutoSnapShot&&RemoveTabCloseListener()):gSaveLastAutoSnapShot=!1,gIsIPad&&(giPadTwoColumn=h.result.configure_ipad_two_column),gPlayerScaling=(gPlayerScaling=h.result.configure_player_scaling).replace("%",""),(gPlayerScaling=isNaN(parseInt(gPlayerScaling))?gIsIPad?60:50:parseInt(gPlayerScaling))<50&&(gPlayerScaling=50),gPlayerScaling>100&&(gPlayerScaling=100),gAllowOfflineInstruments=h.result.configure_allow_offline_instruments,gFeaturesShowTabButtons=h.result.configure_show_tab_buttons,1==r&&0==gFeaturesShowTabButtons&&sendGoogleAnalytics("action","HidingTabButtonBar"),0==r&&1==gFeaturesShowTabButtons&&sendGoogleAnalytics("action","ShowingTabButtonBar");var b=h.result.configure_staff_spacing;b=parseInt(b),isNaN(b)||null==b?b=gStaffSpacing-STAFFSPACEOFFSET:b<-1*STAFFSPACEOFFSET&&(b=-1*STAFFSPACEOFFSET),isNaN(b)||b!=t&&(gStaffSpacing=b+STAFFSPACEOFFSET);var y=h.result.configure_capo;if(!isNaN(parseInt(y))){var T=parseInt(y);T>=0&&T<=12&&(gCapo=parseInt(y))}gShowTabNames=h.result.configure_show_tab_names,(gUseCustomGMSounds=h.result.configure_use_custom_gm_sounds)!=a&&(gSoundsCacheABCJS={}),gOpenLinksInTrainer=h.result.configure_open_links_in_trainer,gAutoSwingHornpipes=h.result.configure_auto_swing_hornpipes;var I=h.result.configure_auto_swing_factor;if(!isNaN(parseFloat(I))){var A=parseFloat(I);A>=-.9&&A<=.9&&(gAutoSwingFactor=A)}f||browserSupportsMIDI()&&(gAllowMIDIInput=h.result.configure_allow_midi_input,gMIDIChromatic=h.result.configure_midi_chromatic,l!=gAllowMIDIInput&&(gAllowMIDIInput?(sendGoogleAnalytics("action","enable_MIDI"),initMIDI(),enableMIDIMute()):disableMIDIMute()));var S=gShowCGDATab;(gShowCGDATab=h.result.configure_show_cgda)?setupCGDA():setupGDAD();var C=gShowDGDAETab;(gShowDGDAETab=h.result.configure_show_dgdae)?setupDGDAE():setupCGDAE(),gRecorderFingeringGerman=h.result.configure_recorder_german,(gShowRecorderTab=h.result.configure_show_recorder)?setupRecorderTab():setupWhistleTab(),gShowRecorderTab!=g&&(gWhistleFontPrepared=!1,gRecorderFontPrepared=!1,"whistle"==d&&gShowRecorderTab?(SetRadioValue("notenodertab","recorder"),gCurrentTab="recorder",PrepareRecorderFont()):"recorder"!=d||gShowRecorderTab||(SetRadioValue("notenodertab","whistle"),gCurrentTab="whistle",PrepareWhistleFont())),gForceComhaltasABC=!1,gUseComhaltasABC=h.result.configure_comhaltas,gRollUseRollForIrishRoll=h.result.configure_RollUseRollForIrishRoll;var v,x=GetRadioValue("notenodertab"),_=gIsFromShare&&("gdad"==x||"cgda"==x||"dgdae"==x||"cgdae"==x||"whistle"==x||"recorder"==x);if(IdleAllowShowTabNames(),!f&&isDesktopBrowser()){var B=h.result.configure_editor_fontsize;B=parseInt(B),isNaN(B)||B>=6&&B<=36&&(gABCEditorFontsize=B,updateABCEditorFont(),HandleWindowResize())}if(gLocalStorageAvailable&&(localStorage.abcStaffSpacing=b),gIsIPad&&c!=giPadTwoColumn&&(giPadTwoColumn?(gLargePlayerControls=!0,sendGoogleAnalytics("action","iPad_Two_Column")):(gLargePlayerControls=!1,sendGoogleAnalytics("action","iPad_One_Column"))),gProcessABCFileHeader=h.result.configure_process_abc_file_header,f||gEnableSyntax&&p!=gSyntaxDarkMode&&(gRawMode?setCMDarkMode("#ffe0ff","#F8FDF8"):setCMDarkMode(gDarkModeColor,gLightModeColor)),SaveConfigurationSettings(),gIsIPad)if(c!=giPadTwoColumn)return v=makeCenteredPromptString(v=giPadTwoColumn?"The tool will restart to switch to two-column display.":"The tool will restart to switch to single-column display."),void DayPilot.Modal.alert(v,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()}).then(function(e){window.location.reload()});if(f)gEnableSyntax?(sendGoogleAnalytics("action","EnableSyntax"),v=isPureDesktopBrowser()||gIsAndroid?"<br/>The tool will now restart with ABC syntax highlighting enabled.<br/><br/><strong>Note for Android users:</strong><br/><br/>While the tool is usable, there may be<br/>issues with text selection context menus.<br/>":"<br/>The tool will now restart with ABC syntax highlighting enabled.<br/><br/><strong>Note for iOS users:</strong><br/><br/>While the tool is usable, there may be <br/>issues with text selection highlighting.<br/>"):(sendGoogleAnalytics("action","DisableSyntax"),v="<br/>The tool will now restart with ABC syntax highlighting disabled.<br/>"),v=makeCenteredPromptString(v),DayPilot.Modal.alert(v,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()}).then(function(e){window.location.reload()});ShowHideTabButtons();var P=GetRadioValue("notenodertab");(b!=t||n!=gShowTabNames||gAllowShowTabNames&&gCapo!=o||S!=gShowCGDATab||C!=gShowDGDAETab||g!=gShowRecorderTab||u!=gRecorderFingeringGerman||_||"notenames"==P&&(gUseComhaltasABC!=i||s&&!gUseComhaltasABC))&&RenderAsync(!0,null,function(){FocusAfterOperation()})}})}function isXML(e){return-1!=e.slice(0,100).indexOf("<?xml")}function isBWWFile(e){var t=e.slice(0,100);return 0==(t=t.trim()).indexOf("Bagpipe Reader")||0==t.indexOf("Bagpipe Music Writer")}function InjectQTag(e,t){const n=[{name:"C|",pattern:"1/2"},{name:"C",pattern:"1/2"},{name:"2/2",pattern:"1/2"},{name:"3/2",pattern:"1/2"},{name:"2/4",pattern:"1/4"},{name:"3/4",pattern:"1/4"},{name:"4/4",pattern:"1/2"},{name:"5/4",pattern:"1/4"},{name:"6/4",pattern:"1/2"},{name:"7/4",pattern:"1/4"},{name:"2/8",pattern:"1/8"},{name:"3/8",pattern:"3/8"},{name:"5/8",pattern:"1/8"},{name:"6/8",pattern:"3/8"},{name:"7/8",pattern:"1/8"},{name:"9/8",pattern:"3/8"},{name:"10/8",pattern:"1/8"},{name:"11/8",pattern:"1/8"},{name:"12/8",pattern:"3/8"}];for(var o=e.split("\n"),a=o.length,l=0;l<a;++l)if(0==o[l].trim().indexOf("Q:"))return e;var r="",i=null,s=!1;for(l=0;l<a;++l)if(0==(r=o[l]).trim().indexOf("M:")){s=!0,l<a-1&&(i=(i=o[l].replace("M:","")).trim(),r=o[l+1]);break}if(s){for(var c=e.indexOf(r),g=e.substring(0,c),d=e.substring(c),u="",m=0;m<n.length;++m)if(i==n[m].name){u=n[m].pattern;break}e=""!=u?g+"Q:"+u+"="+t+"\n"+d:g+"Q:"+t+"\n"+d}else{var p="",h=!1;for(l=0;l<a;++l)if(0==(p=o[l]).trim().indexOf("K:")){h=!0;break}if(h){var f=e.indexOf(p);g=e.substring(0,f),d=e.substring(f);e=g+"Q:"+t+"\n"+d}}return e}function doTitleCaps(e){var t="(a|an|and|as|at|but|by|en|for|if|in|of|on|or|the|to|v[.]?|via|vs[.]?)",n="([!\"#$%&'()*+,./:;<=>?@[\\\\\\]^_`{|}~-]*)";function o(e){return e.toLowerCase()}function a(e){return e.substr(0,1).toUpperCase()+e.substr(1)}return function(e){for(var l=[],r=/[:.;?!] |(?: |^)["Ò]/g,i=0;;){var s=r.exec(e);if(l.push(e.substring(i,s?s.index:e.length).replace(/\b([A-Za-z][a-z.'Õ]*)\b/g,function(e){return/[A-Za-z]\.[A-Za-z]/.test(e)?e:a(e)}).replace(RegExp("\\b"+t+"\\b","ig"),o).replace(RegExp("^"+n+t+"\\b","ig"),function(e,t,n){return t+a(n)}).replace(RegExp("\\b"+t+n+"$","ig"),a)),i=r.lastIndex,!s)break;l.push(s[0])}return l.join("").replace(/ V(s?)\. /gi," v$1. ").replace(/(['Õ])S\b/gi,"$1s").replace(/\b(AT&T|Q&A)\b/gi,function(e){return e.toUpperCase()})}(e)}function isTagLine(e){const t=["X:","T:","M:","K:","L:","Q:","W:","Z:","R:","C:","A:","O:","P:","N:","G:","H:","B:","D:","F:","S:","I:","V:","%"];for(const n of t)if(e.startsWith(n))return!0;return!1}function splitTextAtLineBreak(e,t){const n=e.split(t);let o=[];for(let e of n){let t=e.trim();t&&o.push(t)}return o}function replaceLineBreaks(e,t){const n=e.split("\n");let o=[],a="";var l=!1;for(let e of n)if(!/^(X:|T:|M:|K:|L:|Q:|W:|Z:|R:|C:|A:|O:|P:|N:|G:|H:|B:|D:|F:|S:|I:|V:|w:|%)/.test(e)&&-1!=e.indexOf(t)){l=!0;break}if(!l)return e;for(let e of n)/^(X:|T:|M:|K:|L:|Q:|W:|Z:|R:|C:|A:|O:|P:|N:|G:|H:|B:|D:|F:|S:|I:|V:|w:|%)/.test(e)?(a&&(o.push(a),a=""),o.push(e)):a+=(a?" ":"")+e;a&&o.push(a);var r=[];o.map(e=>{if(isTagLine(e))return r.push(e);for(var n=splitTextAtLineBreak(e,t),o=n.length,a=0;a<o;++a){var l=n[a];""!=(l=l.trim())&&r.push(l)}});return r.join("\n")}function removeLinesStartingWithILinebreak(e){let t=e.split("\n");return t=t.filter(e=>!e.startsWith("I:linebreak")),t.join("\n")}function importMusicXML(e,t){var n=$.parseXML(e),o=!1;0==gMusicXMLImportOptions.x&&1==gMusicXMLImportOptions.addstavenum&&(o=!0,gMusicXMLImportOptions.addstavenum=0);var a=vertaal(n,gMusicXMLImportOptions);o&&(gMusicXMLImportOptions.addstavenum=1);var l=a[0];(l=(l=(l=(l=(l=(l=(l=l.replaceAll("[K:treble]","")).replaceAll("[K:alto]","")).replaceAll("[K:alto1]","")).replaceAll("[K:alto2]","")).replaceAll("[K:tenor]","")).replaceAll("[K:bass]","")).replaceAll("[K:bass3]",""),1==gMusicXMLImportOptions.addq)&&(l=InjectQTag(l,gMusicXMLImportOptions.q));-1!=l.indexOf("T:Title")&&(t=doTitleCaps(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(".mxl","")).replace(".xml","")).replace(".musicxml","")).replace(".MXL","")).replace(".XML","")).replace(".MUSICXML","")).replaceAll("_"," ")).replaceAll("-"," ")).replaceAll("  "," ")),l=l.replace("T:Title","T:"+t));var r=!1,i=l.match(/^I:linebreak.*$/m),s="";return i&&i.length>0&&(s=(s=i[0].replace("I:linebreak","")).trim()).length>0&&("!"==s||"$"==s)&&(r=!0,s=s[0]),r&&(l=replaceLineBreaks(l,s)),l=removeLinesStartingWithILinebreak(l)}function checkForMissingXMLHeader(e){const t=e.match(/^<score-partwise\s+version="([^"]+)">/);if(!t)return e;return`<?xml version="1.0" encoding="UTF-8"?>\n<!DOCTYPE score-partwise PUBLIC "-//Recordare//DTD MusicXML ${t[1]} Partwise//EN" "http://www.musicxml.org/dtds/partwise.dtd">\n`+e}function DoReadCommon(e,t){gImportAccumulator.push(e),setTimeout(function(){gABCFromFile=!0,gIsFromShare=!1,"function"==typeof t&&t()},10)}function DoFileRead(e,t){if(ensureABCFile(e.name)){var n=-1!=e.name.toLowerCase().indexOf(".mid"),o=-1!=e.name.toLowerCase().indexOf(".mxl"),a=-1!=e.name.toLowerCase().indexOf(".xml")||-1!=e.name.toLowerCase().indexOf(".musicxml"),l=document.getElementById("abc-selected");if(l.innerText=n?"Converting MIDI to ABC: "+e.name:o||a?"Converting MusicXML to ABC: "+e.name:"Loading: "+e.name,gDisplayedName=e.name,o)return void(new JSZip).loadAsync(e).then(function(n){n.files["META-INF/container.xml"].async("string").then(function(o){var a=$.parseXML(o).getElementsByTagName("rootfile")[0].getAttribute("full-path");n.files[a].async("string").then(function(n){if(!isXML(n)){var o=e.name+" is not a valid MusicXML file.";return o=makeCenteredPromptString(o),void DayPilot.Modal.alert(o,{theme:"modal_flat",top:100,scrollWithPage:AllowDialogsToScroll()}).then(function(){"function"==typeof t&&t()})}DoReadCommon(n=importMusicXML(n,gDisplayedName),t)})},function(){var n=e.name+" is not a valid MusicXML file.";n=makeCenteredPromptString(n),DayPilot.Modal.alert(n,{theme:"modal_flat",top:100,scrollWithPage:AllowDialogsToScroll()}).then(function(){"function"==typeof t&&t()})})},function(){var n=e.name+" is not a valid MusicXML file.";n=makeCenteredPromptString(n),DayPilot.Modal.alert(n,{theme:"modal_flat",top:100,scrollWithPage:AllowDialogsToScroll()}).then(function(){"function"==typeof t&&t()})});if(n){if(!navigator.onLine){var r="MIDI import not available while offline.";return r=makeCenteredPromptString(r),void DayPilot.Modal.alert(r,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()}).then(function(){"function"==typeof t&&t()})}if(gMIDIImportWarned)i();else{gMIDIImportWarned=!0,gLocalStorageAvailable&&(localStorage.MIDIImportWarned=!0),DayPilot.Modal.alert('<p style="text-align:center;font-size:16pt;font-family:helvetica">First Time Use Notes on MIDI Import</p><p style="font-size:12pt;line-height:18pt;font-family:helvetica">MIDI Import is an experimental feature that depends on an external service.</p><p style="font-size:12pt;line-height:18pt;font-family:helvetica">It may sometimes produce complete garbage, odd results, fail, or even crash or lock up the tool.</p><p style="font-size:12pt;line-height:18pt;font-family:helvetica">If the tool crashes during notation rendering after MIDI import is complete, reload the page to restart.</p><p style="font-size:12pt;line-height:18pt;font-family:helvetica">Imported notes are quantized to sixteenth note durations.</p><p style="font-size:12pt;line-height:18pt;font-family:helvetica">MIDI Import is limited to a maximum file length of 40960 bytes.</p>',{theme:"modal_flat",top:25,scrollWithPage:AllowDialogsToScroll()}).then(function(e){i()})}function i(){const n=new FileReader;n.onload=function(n){const o=n.target.result;if(o.byteLength>40960){var a=e.name+" file size is "+o.byteLength+" bytes.<br/><br/>MIDI file import is limited to a maximum file size of 40960 bytes.";return a=makeCenteredPromptString(a),void DayPilot.Modal.alert(a,{theme:"modal_flat",top:100,scrollWithPage:AllowDialogsToScroll()}).then(function(){"function"==typeof t&&t()})}!function(n){var o=new Blob([n]),a=new FormData;a.append("array_buffer",o,"midi.mid"),fetch("https://seisiuneer.pythonanywhere.com/midi2xml",{method:"POST",body:a}).then(e=>{if(!e.ok&&!e.ok)throw new Error("Failed to upload MIDI file");return e.text()}).then(n=>{var o=e.name.replace(".midi","");o=doTitleCaps(o=(o=(o=(o=(o=(o=o.replace(".MIDI","")).replace(".mid","")).replace(".MID","")).replaceAll("_"," ")).replaceAll("-"," ")).replaceAll("  "," ")),DoReadCommon(importMusicXML(n=(n=n.replaceAll("Music21 Fragment",o)).replaceAll("Music21",""),gDisplayedName),t)}).catch(n=>{var o="There was an issue converting the MIDI file:<br/><br/>"+e.name;o=makeCenteredPromptString(o),DayPilot.Modal.alert(o,{theme:"modal_flat",top:100,scrollWithPage:AllowDialogsToScroll()}).then(function(){"function"==typeof t&&t()})})}(o)},n.onerror=function(){var n="There was an issue converting the MIDI file:<br/><br/>"+e.name;n=makeCenteredPromptString(n),DayPilot.Modal.alert(n,{theme:"modal_flat",top:100,scrollWithPage:AllowDialogsToScroll()}).then(function(){"function"==typeof t&&t()})},n.readAsArrayBuffer(e)}return}const s=new FileReader;s.addEventListener("load",e=>{var n=e.target.result;isXML(n=checkForMissingXMLHeader(n))?n=importMusicXML(n,gDisplayedName):isBWWFile(n)&&(n=convert_bww_to_abc(n)),DoReadCommon(n,t)}),s.readAsText(e)}else"function"==typeof t&&t()}function ShowTopBar(){var e;(e=document.getElementById("topbar")).style.display="block",e.style.opacity=1,gTopBarShowing=!0,(e=document.getElementById("abc-selected")).style.marginTop="15px",e.style.marginBottom="1px",gAllowControlToggle&&ShowAllControls()}function HideTopBar(){(e=document.getElementById("topbar")).style.display="none",gTopBarShowing=!1;var e=document.getElementById("abc-selected");gIsIPhone||gIsAndroid?(e.style.marginTop="18px",e.style.marginBottom="38px"):e.style.marginTop="4px",gAllowControlToggle&&HideAllControls()}function ToggleTopBar(){gTopBarShowing?HideTopBar():ShowTopBar(),UpdateNotationTopPosition(),gIsOneColumn&&MakeTuneVisible(!0),UpdateLocalStorage()}function isFirstRun(){return!!gLocalStorageAvailable&&(!localStorage.abcTab&&(!localStorage.abcTunesPerPage&&(!localStorage.abcPageNumberLocation&&(!localStorage.abcPageNumberOnPageOne&&(!localStorage.abcStaffSpacing&&!localStorage.abcHideTopBar)))))}function restoreStateFromLocalStorage(){if(gLocalStorageAvailable){var e=localStorage.abcTab;e&&("recorder"!=e||gShowRecorderTab||(e="whistle"),SetRadioValue("notenodertab",e),"whistle"==e&&PrepareWhistleFont(),"recorder"==e&&PrepareRecorderFont(),gCurrentTab=e);var t=localStorage.abcTunesPerPage;t&&setPDFFormat(t);var n=localStorage.abcPageNumberLocation;n&&setPageNumbers(n);var o=localStorage.abcPageNumberOnPageOne;o&&setFirstPage(o);var a=localStorage.abcCapo;if(a){var l=parseInt(a);gCapo=isNaN(l)?0:l}var r=localStorage.abcStaffSpacing;if(r){var i=parseInt(r);gStaffSpacing=isNaN(i)?STAFFSPACEOFFSET+STAFFSPACEDEFAULT:STAFFSPACEOFFSET+i}var s=localStorage.abcHideTopBar;s&&"true"==s&&HideTopBar(),gIsFirstRun&&(UpdateLocalStorage(),showWelcomeScreen())}}function restorePDFStateFromLocalStorage(){if(gLocalStorageAvailable){var e=localStorage.abcTunesPerPage;e&&setPDFFormat(e);var t=localStorage.abcPageNumberLocation;t&&setPageNumbers(t);var n=localStorage.abcPageNumberOnPageOne;n&&setFirstPage(n)}}function DoMultiReadCommon(e,t){if(gImportRunning)return void(t&&(t.value=""));var n=!0;let o=document.getElementById("zoombanner");n=!o||"none"===getComputedStyle(o).display,isMobileBrowser()&&(n=!0),UpdateNotationTopPosition(),gImportRunning=!0,gImportAccumulator=[getABCEditorText()],gImportCancelRequested=!1;const a=e.length;let l=0;const r=document.getElementById("abc-selected");var i,s,c;if(n&&a>1){(i=document.createElement("div")).style.position="absolute",i.style.top=r.offsetTop+9+"px",i.style.left=r.offsetLeft+"px",i.style.width=r.offsetWidth+"px",i.style.height=r.offsetHeight+"px",i.style.background="#ffffff00",i.style.display="flex",i.style.flexDirection="column",i.style.alignItems="center",i.style.justifyContent="center",i.style.zIndex=9999,i.style.color="#fff",i.style.fontWeight="bold",(s=document.createElement("div")).style.width="80%",s.style.height="7px",s.style.background="#EEE",s.style.borderRadius="6px",s.style.overflow="hidden",s.style.marginTop="8px",(c=document.createElement("div")).style.width="0%",c.style.height="100%",c.style.background="#00cc66",c.style.transition="width 0.2s ease",s.appendChild(c),i.appendChild(s);const e=document.createElement("button");e.setAttribute("aria-label","Stop import after current file"),e.setAttribute("title","Stop import after current file"),e.style.cssText=gIsSafari||gIsIOS?"\n            position: absolute;\n            top: 100%;\n            right: 49px; /* Push to the right of overlay */\n            transform: translateY(-100%);\n            width: 30px;\n            height: 30px;\n            border-radius: 50%;\n            background: #e02424;\n            color: #fff;\n            font-size: 22px;\n            border: none;\n            cursor: pointer;\n            box-shadow: 0 3px 6px rgba(0,0,0,0.2);\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            padding-block-start: 0px;\n            padding-block-end: 3px;\n          ":"\n            position: absolute;\n            top: 100%;\n            right: 49px; /* Push to the right of overlay */\n            transform: translateY(-100%);\n            width: 30px;\n            height: 30px;\n            border-radius: 50%;\n            background: #e02424;\n            color: #fff;\n            font-size: 14px;\n            border: none;\n            cursor: pointer;\n            box-shadow: 0 3px 6px rgba(0,0,0,0.2);\n            display: flex;\n            align-items: center;\n            justify-content: center;\n          ",e.textContent="✕",e.addEventListener("click",()=>{gImportCancelRequested=!0}),i.appendChild(e),r.parentElement.style.position="relative",r.parentElement.appendChild(i)}!function o(){if(l>=a||gImportCancelRequested){gImportCancelRequested=!1,n&&a>1&&i.remove();var s=gImportAccumulator.map(e=>e.trim()).filter(e=>e.length).join("\n\n");gImportAccumulator=[];var g=CountTunesInBuffer(s+="\n");return gIsQuickEditor?""!==s&&g>0&&(g>1e3&&showTheSpinner("Processing Tunes"),r.innerText=g+" tunes loaded. Processing ABC and rendering notation for the last tune..."):""!==s&&g>0&&(r.innerText=1===g?"Processing ABC and rendering notation for 1 tune...":"Processing ABC and rendering notation for "+g+" tunes..."),setTimeout(function(){setABCEditorText(s),setABCEditorText(CleanSmartQuotes(s)),clearGetTuneByIndexCache(),RestoreDefaults(),RestoreSavedStaffSpacing(),RenderAsync(!0,null,function(){UpdateNotationTopPosition();var e=getTuneByIndex(CountTunes()-1),t=getABCEditorText().length-e.length;gIsMaximized||(gEnableSyntax?(ScrollABCTextIntoView(gTheCM,t,t,10),isMobileBrowser||(gTheCM.getInputField().blur(),gTheCM.focus())):(ScrollABCTextIntoView(gTheABC,t,t,10),isMobileBrowser||(gTheABC.blur(),gTheABC.focus()))),MakeTuneVisible(!0)})},10),t&&(t.value=""),void(gImportRunning=!1)}const d=e[l++];n&&a>1&&function(){const e=Math.round(l/a*100);c.style.width=e+"%"}(),DoFileRead(d,o)}()}function DoDrop(e){e.stopPropagation(),e.preventDefault();const t=Array.from(e.dataTransfer.files);t&&t[0].name.endsWith(".zip")?manageCustomInstrumentSlots(t):DoMultiReadCommon(t,null)}function HideZoomBanner(){document.getElementById("zoombanner").style.display="none",gZoomBannerHidden=!0,UpdateNotationTopPosition()}function HideZoomBannerForever(e){e.stopPropagation();var t="Are you sure you want to hide the Zoom out banner forever?<br/></br/>If you click OK, there is no way to turn it back on.";t=makeCenteredPromptString(t),DayPilot.Modal.confirm(t,{top:180,theme:"modal_flat",scrollWithPage:AllowDialogsToScroll()}).then(function(e){e.canceled||(document.getElementById("zoombanner").style.display="none",gZoomBannerHidden=!0,gZoomBannerAlwaysHidden=!0,gLocalStorageAvailable&&(localStorage.ZoomBannerAlwaysHidden=!0),UpdateNotationTopPosition())})}function HandleWindowResize(){if(isDesktopBrowser())if(gIsMaximized){if((l=document.getElementById("app-container")).style.marginLeft="0px",giPadTwoColumn)isLandscapeOrientation()?(e="54px",t="16px",n=16):(e="80px",t="8px",n=8),document.getElementById("zoombutton").style.width=e,document.getElementById("zoombutton").style.height=e,document.getElementById("zoombutton").style.top=t,document.getElementById("zoombutton").style.right=t,document.getElementById("jumpbutton").style.width=e,document.getElementById("jumpbutton").style.height=e,document.getElementById("jumpbutton").style.top=t,isLandscapeOrientation()?document.getElementById("jumpbutton").style.right=n+120+"px":document.getElementById("jumpbutton").style.right=n+180+"px",document.getElementById("helpbutton").style.width=e,document.getElementById("helpbutton").style.height=e,document.getElementById("helpbutton").style.top=t,document.getElementById("helpbutton").style.left=t,document.getElementById("playbuttonicon").style.width=e,document.getElementById("playbuttonicon").style.height=e,document.getElementById("playbuttonicon").style.bottom=t,document.getElementById("playbuttonicon").style.right=t,gIsQuickEditor?(document.getElementById("qerewindbutton").style.width=e,document.getElementById("qerewindbutton").style.height=e,document.getElementById("qerewindbutton").style.bottom=t,isLandscapeOrientation()?document.getElementById("qerewindbutton").style.right=n+120+"px":document.getElementById("qerewindbutton").style.right=n+180+"px",document.getElementById("qetempobutton").style.width=e,document.getElementById("qetempobutton").style.height=e,document.getElementById("qetempobutton").style.bottom=t,isLandscapeOrientation()?document.getElementById("qetempobutton").style.right=n+240+"px":document.getElementById("qetempobutton").style.right=n+360+"px"):(document.getElementById("pdfbuttonicon").style.width=e,document.getElementById("pdfbuttonicon").style.height=e,document.getElementById("pdfbuttonicon").style.bottom=t,document.getElementById("pdfbuttonicon").style.left=t)}else{var e,t,n,o=window.innerWidth;if(o<1798){var a=(o-850)/2;(l=document.getElementById("app-container")).style.marginLeft=a+"px",gEnableSyntax?setCMRows(gTheCM,12):gTheABC.rows=12,gIsOneColumn=!0,gZoomBannerHidden||gZoomBannerAlwaysHidden||(document.getElementById("zoombanner").style.display="block"),(l=document.getElementById("notation-placeholder-text")).style.marginTop="64px"}else{var l;a=(o-1700)/2;(l=document.getElementById("app-container")).style.marginLeft=a+"px";var r=window.innerHeight;if(giPadTwoColumn&&(isLandscapeOrientation()||(r-=200)),gIsQuickEditor?r-=440:r-=375,gShowDiagnostics&&(r-=90),gEnableSyntax){const e=gTheCM.getWrapperElement(),t=getComputedStyle(e),n=parseFloat(t.fontSize),o=parseFloat(t.lineHeight)||1.2*n;var i=Math.floor(r/o);setCMRows(gTheCM,i)}else{l=document.getElementById("abc");const e=getComputedStyle(l),t=parseFloat(e.fontSize),n=parseFloat(e.lineHeight)||1.2*t;i=Math.floor(r/n);gTheABC.rows=i}gIsOneColumn=!1,document.getElementById("zoombanner").style.display="none",(l=document.getElementById("notation-placeholder-text")).style.marginTop="136px"}if(giPadTwoColumn)isLandscapeOrientation()?(e="54px",t="16px",n=16):(e="80px",t="8px",n=8),document.getElementById("zoombutton").style.width=e,document.getElementById("zoombutton").style.height=e,document.getElementById("zoombutton").style.top=t,document.getElementById("zoombutton").style.right=t,document.getElementById("jumpbutton").style.width=e,document.getElementById("jumpbutton").style.height=e,document.getElementById("jumpbutton").style.top=t,isLandscapeOrientation()?document.getElementById("jumpbutton").style.right=n+120+"px":document.getElementById("jumpbutton").style.right=n+180+"px",document.getElementById("helpbutton").style.width=e,document.getElementById("helpbutton").style.height=e,document.getElementById("helpbutton").style.top=t,document.getElementById("helpbutton").style.left=t,document.getElementById("playbuttonicon").style.width=e,document.getElementById("playbuttonicon").style.height=e,document.getElementById("playbuttonicon").style.bottom=t,document.getElementById("playbuttonicon").style.right=t,gIsQuickEditor?(document.getElementById("qerewindbutton").style.width=e,document.getElementById("qerewindbutton").style.height=e,document.getElementById("qerewindbutton").style.bottom=t,isLandscapeOrientation()?document.getElementById("qerewindbutton").style.right=n+120+"px":document.getElementById("qerewindbutton").style.right=n+180+"px",document.getElementById("qetempobutton").style.width=e,document.getElementById("qetempobutton").style.height=e,document.getElementById("qetempobutton").style.bottom=t,isLandscapeOrientation()?document.getElementById("qetempobutton").style.right=n+240+"px":document.getElementById("qetempobutton").style.right=n+360+"px"):(document.getElementById("pdfbuttonicon").style.width=e,document.getElementById("pdfbuttonicon").style.height=e,document.getElementById("pdfbuttonicon").style.bottom=t,document.getElementById("pdfbuttonicon").style.left=t)}}function getMIDI_note_name(e){return{24:" ",25:"BACKSPACE",26:"|",27:"/",28:"2",29:"3",30:"4",31:"(3",32:"|:",33:":|",34:"||",35:"|]",36:"C,,",37:"C,,",38:"D,,",39:"D,,",40:"E,,",41:"F,,",42:"F,,",43:"G,,",44:"G,,",45:"A,,",46:"A,,",47:"B,,",48:"C,",49:"C,",50:"D,",51:"D,",52:"E,",53:"F,",54:"F,",55:"G,",56:"G,",57:"A,",58:"A,",59:"B,",60:"C",61:"C",62:"D",63:"D",64:"E",65:"F",66:"F",67:"G",68:"G",69:"A",70:"A",71:"B",72:"c",73:"c",74:"d",75:"d",76:"e",77:"f",78:"f",79:"g",80:"g",81:"a",82:"a",83:"b",84:"c'",85:"c'",86:"d'",87:"d'",88:"e'",89:"f'",90:"f'",91:"g'",92:"g'",93:"a'",94:"a'",95:"b'",96:"c''"}[""+e]}const sharpNotes=["c","^c","d","^d","e","f","^f","g","^g","a","^a","b"],flatNotes=["c","_d","d","_e","e","f","_g","g","_a","a","_b","b"],sharps=[6,1,8,3,10,5],flats=[10,3,8,1,6,11];function midiFindKeySignature(e){var t,n,o=null,a=e.match(/^K: *([A-G])([b#])? *(.*?)$/m);if(null==a||a.length<3)return null;t=null==a[2]?a[1]:a[1]+a[2];if(null==(o=""==(n=(n=(n=a[3].toLowerCase()).replace(/%.*/,"")).trim())||-1!=n.search("maj")||-1!=n.search("ion")?midiKeySignatureMap(t,0):-1!=n.search("mix")?midiKeySignatureMap(t,1):-1!=n.search("dor")?midiKeySignatureMap(t,2):-1!=n.search("m")&&-1==n.search("mix")||-1!=n.search("min")||-1!=n.search("aeo")?midiKeySignatureMap(t,3):-1!=n.search("phr")?midiKeySignatureMap(t,4):-1!=n.search("loc")?midiKeySignatureMap(t,5):-1!=n.search("lyd")?midiKeySignatureMap(t,-1):-1!=n.search("exp")?midiKeySignatureMap("C",0):null))return o;var l=n.match(/_./g),r=n.match(/\^./g);for(note in l)o.flats+=l[note][1].toUpperCase();for(note in r)o.sharps+=r[note][1].toUpperCase();return o}function midiKeySignatureMap(e,t){var n="FCGDAEB",o={sharps:"",flats:""},a=n.indexOf(e[0])-1;if(-2==a)return null;"b"==e.slice(1)?a-=7:"#"==e.slice(1)&&(a+=7);var l=a-t;return l>7||l<-7?null:(l>0?o.sharps=n.slice(0,l):l<0&&(o.flats=n.slice(l)),o.accidentalSharps="",o.accidentalFlats="",o.accidentalNaturals="",o)}function lookupAbcNote(e,t){var n=e%12,o=Math.floor(e/12),a=t?flatNotes[n]:sharpNotes[n];o<5?(a=a.toUpperCase(),a+=",".repeat(4-o)):a+="'".repeat(o-5);return a}function getMIDI_note_name_chromatic(e){if(!(e<24)){if(e>=24&&e<=35)return{24:" ",25:"BACKSPACE",26:"|",27:"/",28:"2",29:"3",30:"4",31:"(3",32:"|:",33:":|",34:"||",35:"|]"}[e];var t=midiFindKeySignature(getTuneByIndex(findSelectedTuneIndex()));null==t&&(t={sharps:"",flats:""});var n=parseInt(e)-12,o=n%12,a=0,l="",r=!0,i=!1;if(""!=t.flats&&(r=!1,i=!0),r){var s=t.sharps.length,c=sharps.slice(0,s);c.includes(o)?a--:c.includes(o+1)&&(l="=")}else{var g=t.flats.length,d=flats.slice(0,g);-1!=d.indexOf(o)?a++:d.includes(o-1)&&(l="=")}return l+lookupAbcNote(n+a,i)}console.log("out of range")}var gMIDIAccess=null;function MIDI_NoteOn(e){var t;if(t=gMIDIChromatic?getMIDI_note_name_chromatic(e):getMIDI_note_name(e),gEnableSyntax){if(t){var n=gTheCM.selectionStart,o=gTheCM.selectionEnd;if("BACKSPACE"!=t)setABCEditorText(getABCEditorText().substring(0,n)+t+getABCEditorText().substring(o)),gIsDirty=!0,gTheCM.selectionStart=n+t.length,gTheCM.selectionEnd=gTheCM.selectionStart,OnABCTextChange();else if(0!=n)setABCEditorText(getABCEditorText().substring(0,n-1)+getABCEditorText().substring(o)),gIsDirty=!0,gTheCM.selectionStart=n-1,gTheCM.selectionEnd=gTheCM.selectionStart,OnABCTextChange()}}else if(t){n=gTheABC.selectionStart,o=gTheABC.selectionEnd;if("BACKSPACE"!=t)setABCEditorText(getABCEditorText().substring(0,n)+t+getABCEditorText().substring(o)),gIsDirty=!0,gTheABC.selectionStart=n+t.length,gTheABC.selectionEnd=gTheABC.selectionStart,OnABCTextChange();else if(0!=n)setABCEditorText(getABCEditorText().substring(0,n-1)+getABCEditorText().substring(o)),gIsDirty=!0,gTheABC.selectionStart=n-1,gTheABC.selectionEnd=gTheABC.selectionStart,OnABCTextChange()}}function toggleMIDIMute(){gMIDIMute=!gMIDIMute;var e=document.getElementById("toolpagetitle");gMIDIMute?e.innerHTML="<span style='color:red'>MIDI Input Muted</span>":setOnlineTitle()}function enableMIDIMute(){document.getElementById("toolpagetitle").onclick=toggleMIDIMute,gMIDIMute=!1,setOnlineTitle()}function disableMIDIMute(){document.getElementById("toolpagetitle").onclick=null,gMIDIMute=!1,setOnlineTitle()}function MIDI_Receive(e){if(gAllowMIDIInput&&!gMIDIMute){var t=e.data[0],n=e.data[1],o=e.data[2];if(144==(240&t))0!=o&&MIDI_NoteOn(n)}}function midiOnStateChange(e){console.log("midiOnStateChange");for(var t=gMIDIAccess.inputs.values(),n=t.next();n&&!n.done;n=t.next())n.value.onmidimessage=MIDI_Receive}function onMIDIInit(e){console.log("onMIDIInit"),enableMIDIMute();for(var t=(gMIDIAccess=e).inputs.values(),n=t.next();n&&!n.done;n=t.next())n.value.onmidimessage=MIDI_Receive;e.onstatechange=midiOnStateChange}function onMIDIReject(e){sendGoogleAnalytics("action","onMIDIReject");var t="The MIDI input system failed to start. MIDI input will be disabled.";t=makeCenteredPromptString(t),DayPilot.Modal.alert(t,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()}),gLocalStorageAvailable&&(gAllowMIDIInput=!1,localStorage.AllowMIDIInput=!1)}function browserSupportsMIDI(){return!!navigator.requestMIDIAccess}function initMIDI(){if(browserSupportsMIDI()&&null==gMIDIAccess)if(navigator.requestMIDIAccess)navigator.requestMIDIAccess({sysex:!1}).then(onMIDIInit,onMIDIReject);else{var e="This browser does not support MIDI input.";e=makeCenteredPromptString(e),DayPilot.Modal.alert(e,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()}),gLocalStorageAvailable&&(gAllowMIDIInput=!1,localStorage.AllowMIDIInput=!1)}}function showWelcomeScreen(){sendGoogleAnalytics("dialog","showWelcomeScreen");var e='<p style="text-align:center;font-size:18pt;font-family:helvetica">Welcome to My ABC Transcription Tools!</p>';e+='<p style="font-size:12pt;line-height:16pt;font-family:helvetica"><strong>Please visit my <a href="userguide.html" target="_blank" title="ABC Transcription Tools User Guide">User Guide</a> page for complete instructions and demo videos on how to use the tools.</strong></p>',gIsQuickEditor&&(e+='<p style="font-size:12pt;line-height:16pt;font-family:helvetica">The Quick Editor is optimized for editing and playback of larger tunebooks.</p>'),e+='<p style="font-size:12pt;line-height:16pt;font-family:helvetica">To begin, type or paste tunes in ABC format into the text area.</p>',e+='<p style="font-size:12pt;line-height:16pt;font-family:helvetica">Each ABC tune <strong>must</strong> begin with an X: tag.</p>',e+='<p style="font-size:12pt;line-height:16pt;font-family:helvetica">Notation updates instantly as you make changes to the ABC.</p>',e+='<p style="font-size:12pt;line-height:16pt;font-family:helvetica">Click "Open" to open ABC, MusicXML, BWW, or MIDI files from your system.</p>',e+='<p style="font-size:12pt;line-height:16pt;font-family:helvetica">Click "Add" to add ABC MusicXML, BWW, or MIDI files or tune templates.</p>',isPureDesktopBrowser()&&(e+='<p style="font-size:12pt;line-height:16pt;font-family:helvetica">You may drag-and-drop ABC, MusicXML, BWW, or MIDI files onto the editor area to add them.</p>'),e+='<p style="font-size:12pt;line-height:16pt;font-family:helvetica">Click "Search for Tunes" to find tunes by name.</p>',e+='<p style="font-size:12pt;line-height:16pt;font-family:helvetica"><strong>Once ABC has been entered and notation is displayed:</strong></p>',e+='<p style="font-size:12pt;line-height:16pt;font-family:helvetica">• Click the Zoom-Out arrows at the top-right to view the notation full screen.</p>',e+='<p style="font-size:12pt;line-height:16pt;font-family:helvetica">• Click "Save" to save all the ABC text to an ABC text file.</p>',gIsQuickEditor||(e+='<p style="font-size:12pt;line-height:16pt;font-family:helvetica">• Click "Export PDF" to export your tunebook in PDF format.</p>',e+='<p style="font-size:12pt;line-height:16pt;font-family:helvetica">• Click "Export Website" to export your tunebook as a website.</p>'),e+='<p style="font-size:12pt;line-height:16pt;font-family:helvetica">• Click "Play" to play or train on the tune currently being edited.</p>',DayPilot.Modal.alert(e,{theme:"modal_flat",top:50,scrollWithPage:AllowDialogsToScroll()})}function showZoomInstructionsScreen(){sendGoogleAnalytics("dialog","showZoomInstructionsScreen");var e='<p style="text-align:center;font-size:18pt;font-family:helvetica">Welcome to My ABC Transcription Tools!</p>';e+='<p style="font-size:12pt;line-height:16pt;font-family:helvetica">Since this is your first time using the tools, here is some useful information to help you get started:</p>',e+='<p style="font-size:12pt;line-height:16pt;font-family:helvetica">In this view, you may scroll through the tune notation.</p>',gIsQuickEditor||(e+='<p style="font-size:12pt;line-height:16pt;font-family:helvetica">Click the Play button at the bottom-right to play or train on the current tune.</p>',e+='<p style="font-size:12pt;line-height:16pt;font-family:helvetica">From the Player you can also export the tune image or audio in multiple formats.</p>',e+='<p style="font-size:12pt;line-height:16pt;font-family:helvetica">Click the PDF button at the bottom-left to export the tunes in PDF format.</p>'),gDisableEditFromPlayLink||(e+='<p style="font-size:12pt;line-height:16pt;font-family:helvetica">If you would like to edit the ABC for these tunes:</p>',e+='<p style="font-size:12pt;line-height:16pt;font-family:helvetica">Click the Zoom-In arrows at the top-right to close the full screen notation view and open the ABC editor.</p>',e+='<p style="font-size:12pt;line-height:16pt;font-family:helvetica">The ABC for all the tunes will be loaded in the editor.</p>',e+='<p style="font-size:12pt;line-height:16pt;font-family:helvetica">In the ABC editor, click the Zoom-Out arrows at the top-right to view notation full screen.</p>'),e+='<p style="font-size:12pt;line-height:16pt;font-family:helvetica">Please visit my <a href="userguide.html" target="_blank" title="ABC Transcription Tools User Guide">User Guide</a> page for complete instructions and demo videos on how to use the tools.</p>',DayPilot.Modal.alert(e,{theme:"modal_flat",top:50,scrollWithPage:AllowDialogsToScroll()})}function TipJarReminderDialog(){sendGoogleAnalytics("dialog","TipJarReminderDialog");DayPilot.Modal.alert('<p style="text-align:center;font-size:22pt;font-family:helvetica">Thank You!</p><p style="font-size:14pt;line-height:18pt;font-family:helvetica;text-align:center;">I hope my ABC Transcription Tools have been useful to you!</p><p style="font-size:14pt;line-height:18pt;font-family:helvetica;text-align:center;margin-top:36px;">If so, please consider dropping something in one of my </p><p style="font-size:14pt;line-height:18pt;font-family:helvetica;text-align:center;"><strong><a href="tipjars.html" target="_blank" title="My Virtual Tip Jars">Virtual Tip Jars</a></strong></p><p style="font-size:14pt;line-height:18pt;font-family:helvetica;text-align:center;margin-top:36px;">Cheers and thanks!</p><div style="text-align:center"><img style="width:150px;" src="img/michael2.jpg"/></div><p style="font-size:14pt;line-height:18pt;font-family:helvetica;text-align:center;">Michael Eskin</p>',{theme:"modal_flat",top:75,scrollWithPage:AllowDialogsToScroll()})}function SyntaxHighlightInfoDialog(){DayPilot.Modal.alert('<p style="text-align:center;font-size:17pt;font-family:helvetica">ABC Syntax Highlighting is Enabled</p><p style="font-size:14pt;line-height:18pt;font-family:helvetica;text-align:center;margin-top:36px;">Please try out the new ABC syntax highlighting features.</p><p style="font-size:14pt;line-height:20pt;font-family:helvetica;text-align:center;margin-top:36px;">If you decide you don\'t like it,<br/>you can easily disable it from the Settings dialog.</p>',{theme:"modal_flat",top:150,scrollWithPage:AllowDialogsToScroll()})}function TinyURLReminderDialog(){sendGoogleAnalytics("dialog","TinyURLReminderDialog");DayPilot.Modal.alert('<p style="text-align:center;font-size:18pt;font-family:helvetica">TinyURL Use Request</p><p style="font-size:12pt;line-height:14pt;font-family:helvetica;text-align:center;margin-top:32px;">I get a limited number of free shortened URLs from TinyURL each month.</p><p style="font-size:12pt;line-height:18pt;font-family:helvetica;text-align:center;">If you plan on creating many shortened URLs, please sign up<br/>for your own free or paid TinyURL account at:</p><p style="font-size:12pt;line-height:14pt;font-family:helvetica;text-align:center;"><strong><a href="https://tinyurl.com" target="_blank" title="TinyURL">TinyURL</a></strong></p><p style="font-size:12pt;line-height:14pt;font-family:helvetica;text-align:center;">After signing up, you can obtain a private API token from:</p><p style="font-size:12pt;line-height:14pt;font-family:helvetica;text-align:center;"><strong><a href="https://tinyurl.com/app/settings/api" target="_blank" title="TinyURL API">TinyURL API Settings</a></strong></p><p style="font-size:12pt;line-height:14pt;font-family:helvetica;text-align:center;">And then enter it on the <strong>Advanced Settings</strong> dialog.</p><p style="font-size:12pt;line-height:14pt;font-family:helvetica;text-align:center;">More details here:</p><p style="font-size:12pt;line-height:14pt;font-family:helvetica;text-align:center;"><strong><a href="https://michaeleskin.com/abctools/userguide.html#private_tinyurl_token" target="_blank" title="Private TinyURL Token">Using a Private TinyURL API Token</a></strong></p><p style="font-size:12pt;line-height:14pt;font-family:helvetica;text-align:center;margin-top:36px;">Cheers and thanks!</p><div style="text-align:center"><img style="width:150px;" src="img/michael2.jpg"/></div><p style="font-size:12pt;line-height:14pt;font-family:helvetica;text-align:center;">Michael Eskin</p>',{theme:"modal_flat",top:25,scrollWithPage:AllowDialogsToScroll()})}function ShowHelp(){if(sendGoogleAnalytics("dialog","ShowHelp"),gIsMaximized){var e='<p style="text-align:center;font-size:16pt;font-family:helvetica">About the Full Screen Notation View</p>';e+='<p style="font-size:12pt;line-height:16pt;font-family:helvetica">In this view, you may scroll through the tune notation.</p>',e+='<p style="font-size:12pt;line-height:16pt;font-family:helvetica">Click the Play button at the bottom-right to play or train on the current tune.</p>',e+='<p style="font-size:12pt;line-height:16pt;font-family:helvetica">From the Player you can also export the tune image or audio in multiple formats.</p>',e+='<p style="font-size:12pt;line-height:16pt;font-family:helvetica">Click the PDF button at the bottom-left to export the tunes in PDF format.</p>',gDisableEditFromPlayLink||(e+='<p style="font-size:12pt;line-height:16pt;font-family:helvetica">If you would like to edit the ABC for these tunes:</p>',e+='<p style="font-size:12pt;line-height:16pt;font-family:helvetica">Click the Zoom-In arrows at the top-right to close the full screen notation view and open the tunes in the ABC editor.</p>',e+='<p style="font-size:12pt;line-height:16pt;font-family:helvetica">The ABC for all the tunes will be loaded in the editor.</p>',e+='<p style="font-size:12pt;line-height:16pt;font-family:helvetica">In the ABC editor, click the Zoom-Out arrows at the top-right to view the notation full screen.</p>'),e+='<p style="font-size:12pt;line-height:16pt;font-family:helvetica">Please visit the <a href="userguide.html" target="_blank" title="ABC Transcription Tools User Guide">User Guide</a> page for complete instructions and demo videos on how to use the tools.</p>',DayPilot.Modal.alert(e,{theme:"modal_flat",top:50,scrollWithPage:AllowDialogsToScroll()})}else window.open("https://michaeleskin.com/abctools/userguide.html")}var RESIZETEXTBOX_DEBOUNCEMS=20,gLastResizeTextboxTime=0;function ResizeTextBox(){if(!gIsMaximized){var e,t=Date.now();if(t-gLastResizeTextboxTime>RESIZETEXTBOX_DEBOUNCEMS)if(gLastResizeTextboxTime=t,(e=gEnableSyntax?gTheCM.getWrapperElement().offsetWidth:gTheABC.offsetWidth)>gInitialTextBoxContainerWidth&&!giPadTwoColumn){var n=(e-gInitialTextBoxWidth)/2-(gInitialTextBoxContainerWidth-gInitialTextBoxWidth)/2;if(n<=gInitialTextBoxContainerLeft){if(gEnableSyntax){gTheCM.getWrapperElement().style.marginLeft=-n+"px",gTheCM.refresh()}else gTheABC.style.marginLeft=-n+"px";if(!gIsOneColumn){var o=document.getElementById("app-container"),a=o.style.marginLeft;a&&(a=o.style.marginLeft.replace("px",""),theAppContainerMarginFloat=parseFloat(a),isNaN(theAppContainerMarginFloat)||(theAppContainerMarginFloat-=48,n<theAppContainerMarginFloat&&(gTheNotation.style.marginLeft=n+"px")))}}}else{if(gEnableSyntax){gTheCM.getWrapperElement().style.marginLeft="0px",gTheCM.refresh()}else gTheABC.style.marginLeft="0px";gTheNotation.style.marginLeft=n+"px"}}}function AllowDialogsToScroll(){return!!isMobileBrowser()||window.innerHeight<950}function CleanSmartQuotes(e){return gCleanSmartQuotes?(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replaceAll("“",'"')).replaceAll("”",'"')).replaceAll("‘","'")).replaceAll("’","'")).replaceAll("″",'"')).replaceAll("′","'")).replaceAll("😐",":|")).replaceAll("…","...")).replaceAll("–","-")).replaceAll("—","-"),elem=document.getElementById("diagnostics"),elem.innerHTML="",e):e}function updateABCEditorFont(){if(gEnableSyntax){let e=gTheCM.getWrapperElement();13===gABCEditorFontsize?(e.style.fontSize="13pt",e.style.lineHeight="16pt"):(e.style.fontSize=gABCEditorFontsize+"pt",e.style.lineHeight=gABCEditorFontsize+.23*gABCEditorFontsize+"pt"),gTheCM.refresh()}else 13==gABCEditorFontsize?(gTheABC.style.fontSize="13pt",gTheABC.style.lineHeight="16pt"):(gTheABC.style.fontSize=gABCEditorFontsize+"pt",gTheABC.style.lineHeight=gABCEditorFontsize+.23*gABCEditorFontsize+"pt")}function updateDiagnostics(){var e=document.getElementById("diagnostics");e.style.display=gShowDiagnostics?"block":"none"}var gIsFacebook=!1;function CheckFacebook_iOS(){if(gIsFacebook=!1,gIsIOS){var e=navigator.userAgent;if(-1==e.indexOf("FBIOS")&&-1==e.indexOf("FBAV")||(gIsFacebook=!0),gIsFacebook){if(-1!=e.indexOf("Version/17")||-1!=e.indexOf("OS 17")||-1!=e.indexOf("Version/18")||-1!=e.indexOf("OS 18"))try{var t=window.top.location.href;if(t){var n='<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-top:60px;">Facebook iOS App Browser Issue</p>';n+='<p style="font-size:12pt;line-height:30pt;font-family:helvetica;">The Facebook iOS app browser does not support running the ABC Tools.</p>',n+='<p style="font-size:12pt;line-height:20pt;font-family:helvetica">Open the ABC Transcription Tools in Safari by clicking the button below:</p>',n+='<p style="text-align:center"><a style="display: inline-block; padding: 10px 20px; margin-top:40px; font-size: 18px; color: white; background-color: #007BFF; text-align: center; text-decoration: none; border-radius: 5px; transition: background-color 0.3s ease;" href='+(t="x-safari-"+t)+">Click here to open in Safari</a></p>"}}catch(e){n='<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-top:40px;">Facebook iOS App Browser Issue</p>';n+='<p style="font-size:12pt;line-height:30pt;font-family:helvetica;">The Facebook iOS app browser does not support running the ABC Tools.</p>',n+='<p style="font-size:12pt;line-height:18pt;font-family:helvetica;margin-top:36px;">To open the ABC Transcription Tools in Safari from this view:</p>',n+='<p style="font-size:12pt;line-height:20pt;font-family:helvetica">1) Click the&nbsp;&nbsp;<strong><span style="font-size:18pt">...</span></strong>&nbsp;&nbsp;at the top-right of the screen</p>',n+='<p style="font-size:12pt;line-height:12pt;font-family:helvetica">2) Click <strong>Open in external browser</strong></p>'}else{n='<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-top:40px;">Facebook iOS App Browser Issue</p>';n+='<p style="font-size:12pt;line-height:30pt;font-family:helvetica;">The Facebook iOS app browser does not support running the ABC Tools.</p>',n+='<p style="font-size:12pt;line-height:18pt;font-family:helvetica">To open the ABC Transcription Tools in Safari from this view:</p>',n+='<p style="font-size:12pt;line-height:20pt;font-family:helvetica">1) Click the&nbsp;&nbsp;<strong><span style="font-size:18pt">...</span></strong>&nbsp;&nbsp;at the top-right of the screen</p>',n+='<p style="font-size:12pt;line-height:12pt;font-family:helvetica">2) Click <strong>Open in external browser</strong></p>'}DayPilot.Modal.alert(n,{theme:"modal_flat",top:100,scrollWithPage:AllowDialogsToScroll()}),setTimeout(function(){for(var e=document.getElementsByClassName("modal_flat_ok"),t=null,n=0;n<e.length;++n)if("OK"==(t=e[n]).innerText){t.style.display="none";break}},10)}}}function FixIOS17(e){var t=navigator.userAgent;if(-1!=t.indexOf("Version/17")||-1!=t.indexOf("OS 17")||-1!=t.indexOf("Version/18")||-1!=t.indexOf("OS 18")||-1!=t.indexOf("FxiOS")){try{e=decodeURI(e);try{e=decodeURI(e)}catch(e){}}catch(e){}return e=(e=e.replaceAll("%3A",":")).replaceAll("x:","X:")}return e}function theTabCloseListener(e){DoSaveLastAutoSnapShot()}function AddTabCloseListener(){isPureDesktopBrowser()&&window.addEventListener("beforeunload",theTabCloseListener)}function fileOpenIntercept(e){var t=document.getElementById("selectabcfile");if(gIsDirty){var n='<p style="font-size:18pt;line-height:20pt;text-align:center;">You Have Unsaved Changes</p><p style="font-size:13pt;line-height:16pt;text-align:center;margin-top:30px;">Click "OK" to abandon your work and open a new file.<br/><br/>Click "Cancel" to go back.</p>';n=makeCenteredPromptString(n),DayPilot.Modal.confirm(n,{top:200,theme:"modal_flat",scrollWithPage:AllowDialogsToScroll()}).then(function(e){e.canceled||setTimeout(function(){t.click()},100)})}else t.click()}function RemoveTabCloseListener(){isPureDesktopBrowser()&&window.removeEventListener("beforeunload",theTabCloseListener)}function ShowHideTabButtons(){var e=document.getElementById("tabs-selection");gFeaturesShowTabButtons?(e.style.display="flex",(e=document.getElementById("transpose-controls")).style.marginTop="18px"):(e.style.display="none",(e=document.getElementById("transpose-controls")).style.marginTop="0px"),UpdateNotationTopPosition()}function isMac(){return-1!==navigator.userAgent.indexOf("Macintosh")||-1!==navigator.userAgent.indexOf("Mac OS X")}function isDesktopBrowser(){return!!giPadTwoColumn||!(gIsIOS||gIsAndroid)}function isMobileBrowser(){return gIsIOS||gIsAndroid}function isPureDesktopBrowser(){return isDesktopBrowser()&&!isMobileBrowser()}function makeCenteredPromptString(e){return'<p style="font-size:12pt;line-height:18pt;font-family:helvetica;text-align:center">'+e+"</p>"}function sendGoogleAnalytics(e,t,n){navigator.onLine&&(gIsIOS||gLocalStorageAvailable&&"undefined"!=typeof gtag&&gtag&&gtag instanceof Function&&(n||(n="none"),gIsQuickEditor?gtag("event","q_abc_"+e+"_"+t,{event_category:e,event_action:t,event_label:n}):gtag("event","abc_"+e+"_"+t,{event_category:e,event_action:t,event_label:n})))}function isIOS(){return!!/iPad|iPhone|iPod/.test(navigator.platform)||navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform)}function isIPhone(){return!!/iPad|iPhone|iPod/.test(navigator.platform)}function isIPad(){return navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform)||navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/iPad/.test(navigator.platform)}function isAndroid(){return!!/Android/i.test(navigator.userAgent)}function isSafari(){return!(!/Safari/i.test(navigator.userAgent)||!/Apple Computer/.test(navigator.vendor))}function isChrome(){return!!/chrome|chromium|crios/i.test(navigator.userAgent)}function inlinePlayback(){gMIDIbuffer=null,gIsIOS&&gTheMuteHandle&&(gTheMuteHandle.dispose(),gTheMuteHandle=null),gSynthControl&&(gSynthControl.destroy(),gSynthControl=null),setTimeout(function(){var e=getTuneByIndex(gCurrentTune);if((e=PreProcessPlayABC(e),!gRawMode)&&(e=processAllStripping(e),!hasStaffSep(GetABCFileHeader()))){e=e.replace(/^X:.*$/gm,"X:1\n%%staffsep "+gStaffSpacing)}if(PlayerSetupCommon(e)){ScanTuneForCustomTimingInjection(e),ScanTuneForSwingExplorer(e);var t=GetRadioValue("notenodertab"),n=GetABCJSParams(t);n.oneSvgPerLine=!1;var o=new CursorControlOneTune;gSynthControl=new ABCJS.synth.SynthController(e);var a=document.getElementById("playback-audio-inline");if(gLargePlayerControls?a.classList.add("abcjs-large"):a.classList.remove("abcjs-large"),gSynthControl.load("#playback-audio-inline",o,{displayLoop:!0,displayRestart:!0,displayPlay:!0,displayProgress:!0,displayWarp:!0}),(a=document.getElementsByClassName("abcjs-midi-tempo"))&&a.length>0&&(a[0].onclick=SetPlayerTempo),gIsIOS){var l=ABCJS.synth.activeAudioContext();gTheMuteHandle=null,l&&(gTheMuteHandle=unmute(l,!1,!1))}UpdateNotationTopPosition(),function(){gSynthControl.disable(!0);var o="notation0";gRawMode&&(o="offscreenrenderquickedit");var a=ABCJS.renderAbc(o,e,n)[0];postProcessTab([a],o,t,!0);var l=new ABCJS.synth.CreateSynth(e);gMIDIbuffer=l,gMIDIInitStillWaiting=!1,l.init({visualObj:a}).then(function(t){if(gSynthControl){var n=computeFade(e);gSynthControl.setTune(a,!1,{fadeLength:n}).then(function(e){console.log("Audio successfully loaded.")}).catch(function(e){gMIDIInitStillWaiting=!1,hideTheSpinner(),console.log("Problem loading audio for this tune")})}}).catch(function(e){gMIDIInitStillWaiting=!1,hideTheSpinner(),console.log("Problem loading audio for this tune")})}()}},100)}function alignMeasureMarkers(e){let t=e.split("\n"),n=[];var o=[];t.forEach(e=>{let t=function(e,t){let n,o=new RegExp(e,"g"),a=[];for(;null!==(n=o.exec(t));)a.push({value:n[0],position:n.index});return a}(/\|\||:\|\[\d+|\|\[\d+|:\|:|::|:\|\d+|\|\d+|:\||\|:|\|\]|\[\||\|/g,e);if(t&&t.length>0&&t[0].position>0&&t.unshift({value:"",position:0}),t.length>o.length)for(var a=t.length-o.length,l=0;l<a;++l)o.push(0);if(n.push(t),t.length>1)for(l=0;l<t.length-1;++l){var r=t[l+1].position-t[l].position;0==t[l+1].value.indexOf(":")&&r++,r>o[l]&&(o[l]=r)}});for(var a=t.length,l=[],r=0;r<a;++r)if(0!=t[r].length){var i="",s=n[r];if(n[r].length>1){for(var c=0;c<n[r].length-1;++c){var g=t[r].substring(s[c].position,s[c+1].position);if(g.length<o[c]){var d=o[c]-g.length;0==s[c+1].value.indexOf(":")&&d--;for(var u=0;u<d;++u)g+=" "}i+=g}s[s.length-1].position<t[r].length&&(i+=t[r].substring(s[s.length-1].position,t[r].length))}else i=t[r];l.push(i)}return l.join("\n")}function AlignMeasures(e){if(gAllowCopy){if(sendGoogleAnalytics("action","AlignMeasures"),clearGetTuneByIndexCache(),e){for(var t=CountTunes(),n=FindPreTuneHeader(s=getABCEditorText()),o=0;o<t;++o){var a=alignMeasureMarkers(s=JustTheNotes(r=getTuneByIndex(o)));n+=(r=(r=r.replace(s,a)).trim())+"\n\n"}setABCEditorText(n);var l="Measures aligned!";l=makeCenteredPromptString(l),DayPilot.Modal.alert(l,{theme:"modal_flat",top:300,scrollWithPage:AllowDialogsToScroll()}).then(function(){RenderAsync(!0,null)})}else{var r,i=findSelectedTuneIndex();if(""==(r=findSelectedTune()))return;var s,c="";a=alignMeasureMarkers(s=JustTheNotes(r));c=(c=r.replace(s,a)).trim();var g=getABCEditorText();setABCEditorText(g=g.replace(r,c)),RenderAsync(!1,i,null)}gIsDirty=!0}}function QEAlignBars(e){if(gAllowCopy)return e.shiftKey?void AlignMeasures(!0):void AlignMeasures(!1)}function injectMIDIgchord(e,t,n,o,a,l){let r=e.split("\n"),i=[];r.forEach(e=>{let t=function(e,t){let n,o=new RegExp(e,"g"),a=[];for(;null!==(n=o.exec(t));)a.push({value:n[0],position:n.index});return a}(/\|\||:\|\[\d+|\|\[\d+|:\|:|::|:\|\d+|\|\d+|:\||\|:|\|\]|\[\||\|/g,e);t&&t.length>0&&t[0].position>0&&t.unshift({value:"",position:0}),i.push(t)});for(var s=r.length,c=[],g=0;g<s;++g)if(0!=r[g].length){var d="",u=i[g];if(i[g].length>1){for(var m=0;m<i[g].length-1;++m){var p=r[g].substring(u[m].position,u[m+1].position),h="[I:MIDI=gchord "+t+"]";n&&(h+="[I:MIDI=gchordstress "+o+"]"),a&&(h+="[I:MIDI=gchordduration "+l+"]"),h+=" ",d+=p=p.replace(u[m].value,u[m].value+h)}u[u.length-1].position<r[g].length&&(d+=r[g].substring(u[u.length-1].position,r[g].length))}else d=r[g];c.push(d)}return c.join("\n")}function getMIDIGChordMeter(e){for(var t=e.split("\n"),n="",o=0;o<t.length;++o){var a=t[o].match(/^M:.*[\r\n]*/m);a&&a.length>0&&""==n&&(n=(n=a[0].replace("M:","")).trim())}return n}function getDefaultMIDIGChordString(e){for(var t="",n=0;n<midigchordinject_list.length;++n)if(e==midigchordinject_list[n].name){t=midigchordinject_list[n].pattern;break}return t}const midigchordinject_list=[{name:"C|",pattern:"zzzz"},{name:"C",pattern:"zzzzzzzz"},{name:"2/2",pattern:"zzzz"},{name:"3/2",pattern:"zzzzzz"},{name:"2/4",pattern:"zzzz"},{name:"3/4",pattern:"zzzzzz"},{name:"4/4",pattern:"zzzzzzzz"},{name:"5/4",pattern:"zzzzzzzzzz"},{name:"6/4",pattern:"zzzzzzzzzzzz"},{name:"7/4",pattern:"zzzzzzzzzzzzzz"},{name:"2/8",pattern:"zz"},{name:"3/8",pattern:"zzz"},{name:"5/8",pattern:"zzzzz"},{name:"6/8",pattern:"zzzzzz"},{name:"7/8",pattern:"zzzzzzz"},{name:"9/8",pattern:"zzzzzzzzz"},{name:"10/8",pattern:"zzzzzzzzzz"},{name:"11/8",pattern:"zzzzzzzzzzz"},{name:"12/8",pattern:"zzzzzzzzzzzz"}];var gInjectMIDIGChordPattern="",gDoInjectMIDIGChordStress=!1,gInjectMIDIGChordStress=1,gDoInjectMIDIGChordDuration=!1,gInjectMIDIGChordDuration=1,gLastMIDIGChordMeter="";function InjectMIDIGChordTemplates(){if(!gAllowCopy)return;var e=findSelectedTuneIndex(),t=findSelectedTune();if(""==t)return;var n=getMIDIGChordMeter(t);if(n!=gLastMIDIGChordMeter){var o=getDefaultMIDIGChordString(n);if(""==o){var a="%%MIDI gchord not available for meter: "+n;return a=makeCenteredPromptString(a),void DayPilot.Modal.alert(a,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})}gInjectMIDIGChordPattern=o,gLastMIDIGChordMeter=n}const l={injectPattern:gInjectMIDIGChordPattern,bDoInjectStress:gDoInjectMIDIGChordStress,injectStress:gInjectMIDIGChordStress,bDoInjectDuration:gDoInjectMIDIGChordDuration,injectDuration:gInjectMIDIGChordDuration};DayPilot.Modal.form([{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Inject MIDI gchord Templates&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#inject_midigchord" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="margin-top:36px;margin-bottom:36px;font-size:12pt;line-height:18pt;font-family:helvetica">This will inject an inline %%MIDI gchord backup pattern annotation for each measure of the current tune along with optional inline %%MIDI gchordstress and %%MIDI gchordduration vectors:</p>'},{name:"    %%MIDI gchord pattern:",id:"injectPattern",type:"text",cssClass:"inject_gchord_templates_form_text"},{html:'<p style="margin-top:10px;font-size:4pt;font-family:helvetica">&nbsp;</p>'},{name:"          Include inline %%MIDI gchordstress vector for each measure",id:"bDoInjectStress",type:"checkbox",cssClass:"inject_gchord_templates_form_text"},{name:"    %%MIDI gchordstress vector:",id:"injectStress",type:"text",cssClass:"inject_gchord_templates_form_text"},{html:'<p style="margin-top:10px;font-size:4pt;font-family:helvetica">&nbsp;</p>'},{name:"          Include inline %%MIDI gchordduration vector for each measure",id:"bDoInjectDuration",type:"checkbox",cssClass:"inject_gchord_templates_form_text"},{name:"    %%MIDI gchordduration vector:",id:"injectDuration",type:"text",cssClass:"inject_gchord_templates_form_text"},{html:'<p style="margin-top:24px;font-size:12pt;line-height:18pt;font-family:helvetica">&nbsp;</p>'}],l,{theme:"modal_flat",top:100,width:600,scrollWithPage:AllowDialogsToScroll(),okText:"Inject",autoFocus:!1}).then(function(n){if(!n.canceled){var o;sendGoogleAnalytics("action","InjectMIDIGChordTemplate"),o=gInjectMIDIGChordPattern=n.result.injectPattern,gDoInjectMIDIGChordStress=n.result.bDoInjectStress,gInjectMIDIGChordStress=n.result.injectStress,gDoInjectMIDIGChordDuration=n.result.bDoInjectDuration,gInjectMIDIGChordDuration=n.result.injectDuration;var a="",l=JustTheNotes(t),r=injectMIDIgchord(l,o,gDoInjectMIDIGChordStress,gInjectMIDIGChordStress,gDoInjectMIDIGChordDuration,gInjectMIDIGChordDuration);a=(a=t.replace(l,r)).trim();var i=getABCEditorText();setABCEditorText(i=i.replace(t,a)),gIsDirty=!0;var s="MIDI gchord templates injected!";s=makeCenteredPromptString(s),DayPilot.Modal.alert(s,{theme:"modal_flat",top:300,scrollWithPage:AllowDialogsToScroll()}).then(function(){RenderAsync(!1,e,null)})}})}function captureEditorBaselines(){const e=gTheCM.getWrapperElement(),t=e.parentElement;window.gInitialTextBoxWidth=e.offsetWidth,window.gInitialTextBoxContainerWidth=t.offsetWidth;const n=e.getBoundingClientRect();window.gInitialTextBoxContainerLeft=n.left}function MaximizeEditor(){if(gEnableSyntax){if(!gAllowCopy)return;if(isMobileBrowser())return;if(gIsOneColumn)return;sendGoogleAnalytics("action","MaximizeEditor");const e=gTheCM.getWrapperElement(),t=(gTheCM.getScrollerElement(),window.innerWidth-gTheNotation.offsetWidth-125);e.style.width=Math.max(0,t)+"px",e.style.display="block",e.style.boxSizing="border-box",gTheCM.refresh(),requestAnimationFrame(()=>{setTimeout(()=>{const t=e.offsetWidth;if(t>gInitialTextBoxContainerWidth){const n=(t-gInitialTextBoxWidth)/2-(gInitialTextBoxContainerWidth-gInitialTextBoxWidth)/2;if(n<=gInitialTextBoxContainerLeft&&(e.style.marginLeft=-n+"px",gTheCM.refresh(),!gIsOneColumn)){const e=document.getElementById("app-container");let t=e&&e.style.marginLeft;if(t&&(t=parseFloat(t.replace("px","")),!isNaN(t))){n<t-48&&(gTheNotation.style.marginLeft=n+"px")}}}},100)})}else{if(!gAllowCopy)return;if(isMobileBrowser())return;if(gIsOneColumn)return;sendGoogleAnalytics("action","MaximizeEditor"),gTheABC.style.width=window.innerWidth-gTheNotation.offsetWidth-125+"px",setTimeout(function(){var e=gTheABC.offsetWidth;if(e>gInitialTextBoxContainerWidth){var t=(e-gInitialTextBoxWidth)/2-(gInitialTextBoxContainerWidth-gInitialTextBoxWidth)/2;if(t<=gInitialTextBoxContainerLeft&&(gTheABC.style.marginLeft=-t+"px",!gIsOneColumn)){var n=document.getElementById("app-container"),o=n.style.marginLeft;o&&(o=n.style.marginLeft.replace("px",""),theAppContainerMarginFloat=parseFloat(o),isNaN(theAppContainerMarginFloat)||(theAppContainerMarginFloat-=48,t<theAppContainerMarginFloat&&(gTheNotation.style.marginLeft=t+"px")))}}},100)}}function JumpToSearch(){var e=document.getElementById("jumpToSearchValue").value.toLowerCase(),t=""==e,n=document.getElementById("jumpto-tune-list"),o="";for(i=0;i<gJumpTitleCount;++i)(t||-1!=gJumpTitles[i].toLowerCase().indexOf(e))&&(o+='<div class="jumpto_tune" onclick="JumpToToggleSelection(this,'+i+')">'+gJumpTitles[i]+"</div>");n.innerHTML=o,gJumpTune=-1}function JumpToToggleSelection(e,t){gJumpTune=t;const n=document.querySelectorAll("#jumpto-tune-list .jumpto_tune");Array.from(n).map(e=>{e.classList.remove("jumpto_selected")}),e.classList.add("jumpto_selected")}var gJumpTune=-1,gJumpTitles=[],gJumpTitleCount=0;function JumpToTune(){var e;gJumpTune=-1,gJumpTitles=[],gJumpTitleCount=0,totalTunes=CountTunes();var t=GetTunebookIndexTitles(),n=t.length;if(0==n){var o="No tunes in the editor.";return o=makeCenteredPromptString(o),void DayPilot.Modal.alert(o,{theme:"modal_flat",top:200,scrollWithPage:!1})}var a=null;-1!=gCurrentTune&&gCurrentTune<n&&(a=t[gCurrentTune]),gJumpTitles=t,gJumpTitleCount=n;var l='<div id="jumpto-tune-list" style="overflow:auto;height:'+(window.innerHeight-330)+'px;margin-top:18px">';for(e=0;e<n;++e)l+='<div id="jumpto_tune_'+e+'" class="jumpto_tune" onclick="JumpToToggleSelection(this,'+e+')">'+t[e]+"</div>";var r=[{html:'<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">Jump to Tune&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#hamburger_jump_to_tune" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<input style="width:100%;font-size:12pt;line-height:18px;padding:6px;margin-left:5px;" id="jumpToSearchValue" title="Enter your search text here" autocomplete="off" autocorrect="off" placeholder="Enter your search text here" oninput="JumpToSearch();"/>'},{html:l+="</div>"}];DayPilot.Modal.form(r,{},{theme:"modal_flat",top:25,width:650,scrollWithPage:!1,autoFocus:!1,okText:"Jump"}).then(function(e){if(!e.canceled&&-1!=gJumpTune){var t=findTuneOffsetByIndex(gCurrentTune=gJumpTune);gEnableSyntax?(gTheCM.focus(),gTheCM.selectionStart=t,gTheCM.selectionEnd=t):(gTheABC.focus(),gTheABC.selectionStart=t,gTheABC.selectionEnd=t),isDesktopBrowser()?MakeTuneVisible(!0):window.setTimeout(function(){MakeTuneVisible(!0)},250),ScrollABCTextIntoView(gEnableSyntax?gTheCM:gTheABC,t,t,10),gPlayABCGotMaximizedPlay=!1,isPureDesktopBrowser()||(gEnableSyntax?gTheCM.getInputField().blur():gTheABC.blur()),gIsQuickEditor&&(gDisableNotationRendering||Render(!1,gCurrentTune))}});gJumpToTuneAutoscroll&&setTimeout(function(){if(a){var e=gJumpTitles.findIndex(e=>e.toLowerCase()===a.toLowerCase());if(-1!==e){var t=document.getElementById("jumpto-tune-list"),n=document.getElementById("jumpto_tune_"+e);t&&n&&(t.scrollTop=n.offsetTop-t.offsetTop)}}},25)}var gSR_currentIndex=-1,gSR_matchIndexes=[],gSR_searchInput=null,gSR_replaceInput=null,gSR_caseSensitive=null,gSR_regex=null,gSR_lastSearch="",gSR_lastReplace="",gSR_lastCaseSensitive=!0,gSR_lastRegex=!1;function SR_processMatches(e,t){return(e=e.replaceAll("$&","$0")).replace(/\$(\d+)/g,(e,n)=>t[n]||e)}function SR_findMatches(){gSR_matchIndexes=[];var e=getABCEditorText(),t=gSR_searchInput.value;if(""!==t){var n=gSR_caseSensitive.checked;gSR_lastCaseSensitive=n;var o=gSR_regex.checked;if(gSR_lastRegex=o,o)try{t=n?new RegExp(t,"gm"):new RegExp(t,"gmi")}catch(e){return}else n||(e=e.toLowerCase(),t=t.toLowerCase());if(o)for(;null!==(match=t.exec(e));){if(0==match[0].length)return;gSR_matchIndexes.push({offset:match.index,length:match[0].length,matches:match})}else{let n=0;for(;-1!==n;)n=e.indexOf(t,n),-1!==n&&(gSR_matchIndexes.push({offset:n,length:t.length}),n+=t.length)}}}function SR_highlightMatch(e){var t=gSR_regex.checked;const n=gSR_searchInput.value;0!==gSR_matchIndexes.length&&""!==n&&(gEnableSyntax?(gTheCM.focus(),t?(gTheCM.setSelectionRange(gSR_matchIndexes[e].offset,gSR_matchIndexes[e].offset+gSR_matchIndexes[e].length),isPureDesktopBrowser()&&ScrollABCTextIntoView(gTheCM,gSR_matchIndexes[e].offset,gSR_matchIndexes[e].offset+gSR_matchIndexes[e].length,2)):(gTheCM.setSelectionRange(gSR_matchIndexes[e].offset,gSR_matchIndexes[e].offset+n.length),isPureDesktopBrowser()&&ScrollABCTextIntoView(gTheCM,gSR_matchIndexes[e].offset,gSR_matchIndexes[e].offset+n.length,2))):(gTheABC.focus(),t?(gTheABC.setSelectionRange(gSR_matchIndexes[e].offset,gSR_matchIndexes[e].offset+gSR_matchIndexes[e].length),isPureDesktopBrowser()&&ScrollABCTextIntoView(gTheABC,gSR_matchIndexes[e].offset,gSR_matchIndexes[e].offset+gSR_matchIndexes[e].length,2)):(gTheABC.setSelectionRange(gSR_matchIndexes[e].offset,gSR_matchIndexes[e].offset+n.length),isPureDesktopBrowser()&&ScrollABCTextIntoView(gTheABC,gSR_matchIndexes[e].offset,gSR_matchIndexes[e].offset+n.length,2))),isPureDesktopBrowser()&&MakeTuneVisible(!0))}function SR_search(e){if(""!=gSR_searchInput.value)if(0!==gSR_matchIndexes.length)"next"===e?gSR_currentIndex=(gSR_currentIndex+1)%gSR_matchIndexes.length:"previous"===e&&(gSR_currentIndex=(gSR_currentIndex-1+gSR_matchIndexes.length)%gSR_matchIndexes.length),SR_highlightMatch(gSR_currentIndex);else{var t=makeCenteredPromptString("Search value not found");DayPilot.Modal.alert(t,{theme:"modal_flat",top:270})}}function SR_search_next(){SR_search("next")}function SR_search_previous(){SR_search("previous")}function SR_replaceOne(){if(0==gSR_matchIndexes.length)return;if(-1===gSR_currentIndex){var e=makeCenteredPromptString("Nothing to replace");return void DayPilot.Modal.alert(e,{theme:"modal_flat",top:270})}const t=gSR_searchInput.value;if(""==t)return;var n=gSR_regex.checked,o=(gSR_caseSensitive.checked,gSR_replaceInput.value);const a=gSR_matchIndexes[gSR_currentIndex].offset;if(n?(o=SR_processMatches(o,gSR_matchIndexes[gSR_currentIndex].matches),setABCEditorText(getABCEditorText().slice(0,a)+o+getABCEditorText().slice(a+gSR_matchIndexes[gSR_currentIndex].length))):setABCEditorText(getABCEditorText().slice(0,a)+o+getABCEditorText().slice(a+t.length)),SR_findMatches(),gIsDirty=!0,gRawMode)RenderAsync(!0,null,function(){if(gSR_matchIndexes.length>0)SR_search("previous"),SR_search("next");else if(0===gSR_matchIndexes.length){var e=makeCenteredPromptString("Search value not found");return void DayPilot.Modal.alert(e,{theme:"modal_flat",top:270})}});else if(Render(!1,findTuneByOffset(a)),gSR_matchIndexes.length>0)SR_search("previous"),SR_search("next");else if(0===gSR_matchIndexes.length){e=makeCenteredPromptString("Search value not found");return void DayPilot.Modal.alert(e,{theme:"modal_flat",top:270})}}function SR_replaceAll(e){var t=gSR_searchInput.value;if(""!=t)if(0!==gSR_matchIndexes.length){var n,o,a=gSR_caseSensitive.checked,l=gSR_replaceInput.value;if(gSR_regex.checked)try{l=l.replace(/\$0/g,"$$&"),o=a?new RegExp(t,"gm"):new RegExp(t,"gmi")}catch(e){return}else{t=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");o=new RegExp(t,a?"g":"gi")}(n=getABCEditorText().match(o))&&0==n[0].length||(setABCEditorText(getABCEditorText().replace(o,l)),SR_findMatches(),RenderAsync(!0,null,function(){setTimeout(function(){var e="Replaced "+n.length;1!=n.length?e+=" instances.":e+=" instance.";var t=makeCenteredPromptString(e);DayPilot.Modal.alert(t,{theme:"modal_flat",top:270,scrollWithPage:!1})},100)}),gIsDirty=!0)}else{var r=makeCenteredPromptString("Search value not found");DayPilot.Modal.alert(r,{theme:"modal_flat",top:270})}}function SR_LoadFindAndReplace(e){const t=new FileReader;t.addEventListener("load",e=>{var t=e.target.result;try{var n=JSON.parse(t);if(null==n.find||null==n.replace||null==n.isCaseSensitive||null==n.isRegex)return o=makeCenteredPromptString(o="This is not a valid Find and Replace settings file."),void DayPilot.Modal.alert(o,{theme:"modal_flat",top:200,scrollWithPage:!1});gSR_searchInput.value=n.find,gSR_replaceInput.value=n.replace,gSR_caseSensitive.checked=n.isCaseSensitive,gSR_regex.checked=n.isRegex,gSR_lastSearch=gSR_searchInput.value,gSR_lastReplace=gSR_replaceInput.value,SR_findMatches()}catch(e){var o;return o=makeCenteredPromptString(o="This is not a valid Find and Replace settings file."),void DayPilot.Modal.alert(o,{theme:"modal_flat",top:200,scrollWithPage:!1})}}),t.readAsText(e)}function SR_TriggerLoad(){document.getElementById("load_find_replace_fs").click()}function SR_save(){var e={find:gSR_searchInput.value,replace:gSR_replaceInput.value,isCaseSensitive:gSR_caseSensitive.checked,isRegex:gSR_regex.checked};try{var t=JSON.stringify(e);0!=t.length&&saveTextFile("Please enter a filename for your Find and Replace settings:","find_and_replace.txt",t)}catch(e){}}function FindAndReplace(){if(sendGoogleAnalytics("action","FindAndReplace"),gAllowCopy){gSR_currentIndex=-1,gSR_matchIndexes=[];var e='<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;margin-bottom:12px;">Find and Replace&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#moretoolsdropdown" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>';isPureDesktopBrowser()?e+='<p style="font-size:12pt;line-height:24pt;margin-top:0px;">Find:<br/><textarea style="width:625px;padding:6px;" id="searchText" title="Enter text to find here" autocomplete="off" autocorrect="off" spellcheck="false" autocapitalize="none" placeholder="Text to find..." rows="7"></textarea></p>':e+='<p style="font-size:12pt;line-height:24pt;margin-top:0px;">Find:<br/><textarea style="width:625px;padding:6px;" id="searchText" title="Enter text to find here" autocomplete="off" autocorrect="off" spellcheck="false" autocapitalize="none" placeholder="Text to find..." rows="4"></textarea></p>',e+='<p style="font-size:12pt;line-height:12pt;margin-top:0px;">Case sensitive?&nbsp;<input id="searchCaseSensitive" type="checkbox" style="margin-top:-5px;margin-bottom:0px;" onchange="SR_findMatches();" checked/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Match using regular expression?&nbsp;<input id="searchRegex" type="checkbox" style="margin-top:-5px;margin-bottom:0px;" onchange="SR_findMatches();"/></p>',isPureDesktopBrowser()?e+='<p style="font-size:12pt;line-height:24pt;margin-top:0px;">Replace with:<br/><textarea style="width:625px;padding:6px;" id="replacementText" title="Enter replacement text here" autocomplete="off" autocorrect="off" spellcheck="false" autocapitalize="none" placeholder="Replace with..." rows="7"></textarea></p>':e+='<p style="font-size:12pt;line-height:24pt;margin-top:0px;">Replace with:<br/><textarea style="width:625px;padding:6px;" id="replacementText" title="Enter replacement text here" autocomplete="off" autocorrect="off" spellcheck="false" autocapitalize="none" placeholder="Replace with..." rows="5"></textarea></p>',e+='<p style="font-size:12pt;text-align:center;margin-top:24px;"><input class="btn btn-search-previous search-previous" id="search-previous" onclick="SR_search_previous();" type="button" value="Find Previous" title="Find previous match"/><input class="btn btn-search-next search-next" id="search-next" onclick="SR_search_next();" type="button" value="Find Next" title="Find next match"/><input class="btn btn-search-replace search-replace" id="search-replace" onclick="SR_replaceOne();" type="button" value="Replace" title="Replace one text instance"/><input class="btn btn-search-replace-all search-replace-all" id="search-replace-all" onclick="SR_replaceAll();" type="button" value="Replace All" title="Replace all text instances"/><input type="file" id="load_find_replace_fs" accept=".txt,.TXT" hidden/><input class="btn btn-search-load search-load" id="search-load" onclick="SR_TriggerLoad();" type="button" value="Load" title="Load Find and Replace settings"/><input class="btn btn-search-save search-save" id="search-save" onclick="SR_save();" type="button" value="Save" title="Save Find and Replace settings"/></p>',DayPilot.Modal.alert(e,{theme:"modal_flat",top:25,width:700,scrollWithPage:!1}).then(function(){isPureDesktopBrowser()||(gEnableSyntax?gTheCM.focus():gTheABC.focus())}),document.getElementById("load_find_replace_fs").onchange=()=>{let e=document.getElementById("load_find_replace_fs");if(0===e.files.length){var t="Please select a Find and Replace settings file";return t=makeCenteredPromptString(t),void DayPilot.Modal.alert(t,{theme:"modal_flat",top:200,scrollWithPage:!1})}SR_LoadFindAndReplace(e.files[0]),e.value=""},(gSR_searchInput=document.getElementById("searchText")).focus(),gSR_replaceInput=document.getElementById("replacementText"),gSR_caseSensitive=document.getElementById("searchCaseSensitive"),gSR_regex=document.getElementById("searchRegex"),gSR_searchInput.value=gSR_lastSearch,gSR_replaceInput.value=gSR_lastReplace,gSR_caseSensitive.checked=gSR_lastCaseSensitive,gSR_regex.checked=gSR_lastRegex,""!=gSR_lastSearch&&SR_findMatches(),gSR_searchInput.addEventListener("input",function(e){gSR_lastSearch=gSR_searchInput.value,SR_findMatches()}),gSR_replaceInput.addEventListener("input",function(e){gSR_lastReplace=gSR_replaceInput.value})}else{var t=makeCenteredPromptString("No Text in the ABC Editor to Find/Replace");DayPilot.Modal.alert(t,{theme:"modal_flat",top:200})}}var gLastSplitLongTagsLength=80,gLastSplitTags=!0,gLastSplitText=!0,gLastTagsToSplit="ABCDFGHNOSTWZ";function processAndReplaceTextGroups(e,t){let n=e.split("\n"),o=[],a=!1;for(let e of n)if("%%begintext"==e||e.startsWith("%%begintext "))a=!0,o.push("%%begintext");else if("%%endtext"==e||e.startsWith("%%endtext "))a=!1,o.push("%%endtext");else if(a){for(;e.length>t;){let n=e.lastIndexOf(" ",t);-1===n&&(n=t),o.push(e.slice(0,n)),e=e.slice(n).trim()}o.push(e)}else o.push(e);return o.join("\n")}function splitLJTextLines(e,t){const n="%%text ",o=e.split("\n"),a=[];for(let e of o)if(e.startsWith(n)){const n=e.slice(7).trim(),o=[];let l=n;if(l.length<=t)a.push("%%text "+n);else{for(;l.length>t;){let e=l.lastIndexOf(" ",t);-1===e&&(e=t),o.push(l.slice(0,e)),l=l.slice(e).trim()}l.length>0&&o.push(l),a.push("%%begintext"),a.push(...o),a.push("%%endtext")}}else a.push(e);return a.join("\n")}function splitLinesWithPrefix(e,t,n){let o=e.split("\n"),a=[];for(let e of o)if(e.startsWith(t)){for(;e.length>n;){let o=e.lastIndexOf(" ",n);(-1===o||o<t.length)&&(o=n),a.push(e.slice(0,o)),e=t+e.slice(o).trim()}a.push(e)}else a.push(e);return a.join("\n")}function SplitOneTuneTagsText(e,t,n,o,a){if(!o&&!a)return e;var l=e;if(o){let o=e.split("\n"),i=[];var r=!1;for(let e of o){r=!1;for(let o of t)if(e.startsWith(`${o}:`)){for(r=!0;e.length>n;){let t=e.lastIndexOf(" ",n);(-1===t||t<`${o}:`.length)&&(t=n),i.push(e.slice(0,t)),e=`${o}:`+e.slice(t).trim()}i.push(e)}r||i.push(e)}if(l=i.join("\n"),!a)return l}return l=splitLinesWithPrefix(l=splitLJTextLines(l,n),"%%center ",n),l=processAndReplaceTextGroups(l=splitLinesWithPrefix(l,"%%right ",n),n)}function SplitLongTextAndTags(){if(sendGoogleAnalytics("action","SplitLongTags"),!gAllowCopy){var e=makeCenteredPromptString("No Text in the ABC Editor to Split");return void DayPilot.Modal.alert(e,{theme:"modal_flat",top:200})}const t={max_tag_line_length:gLastSplitLongTagsLength,bSplitTags:gLastSplitTags,bSplitText:gLastSplitText,tags_to_split:gLastTagsToSplit,bSplitAllTunes:!0};DayPilot.Modal.form([{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Split Long Tags and Text&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#moretoolsdropdown" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="margin-top:36px;margin-bottom:24px;font-size:12pt;line-height:18pt;font-family:helvetica">This will split long strings in tags and/or text at the specified line length.</p>'},{html:'<p style="font-size:5pt;font-family:helvetica">&nbsp;</p>'},{name:"Maximum line length:",id:"max_tag_line_length",type:"number",cssClass:"splitlongtextandtags"},{html:'<p style="font-size:5pt;font-family:helvetica">&nbsp;</p>'},{name:"          Split tags",id:"bSplitTags",type:"checkbox",cssClass:"splitlongtextandtags"},{name:"          Tags to split:",id:"tags_to_split",type:"text",cssClass:"splitlongtextandtags_text"},{html:'<p style="font-size:5pt;font-family:helvetica">&nbsp;</p>'},{name:"          Split text",id:"bSplitText",type:"checkbox",cssClass:"splitlongtextandtags"},{html:'<p style="font-size:5pt;font-family:helvetica">&nbsp;</p>'},{name:"          Split all tunes",id:"bSplitAllTunes",type:"checkbox",cssClass:"splitlongtextandtags"}],t,{theme:"modal_flat_wide",top:100,width:600,scrollWithPage:AllowDialogsToScroll(),okText:"Split",autoFocus:!1}).then(function(e){if(!e.canceled){var t=e.result.max_tag_line_length;if(t=parseInt(t),isNaN(t)||(gLastSplitLongTagsLength=t),gLastSplitTags=e.result.bSplitTags,gLastSplitText=e.result.bSplitText,gLastTagsToSplit=e.result.tags_to_split,e.result.bSplitAllTunes){for(var n=CountTunes(),o=getABCEditorText(),a=o.split(/^X:/gm),l=FindPreTuneHeader(o),r=1;r<=n;++r){a[r]="X:"+a[r];var i=SplitOneTuneTagsText(a[r],gLastTagsToSplit,gLastSplitLongTagsLength,gLastSplitTags,gLastSplitText);l+=i=i.trim(),n>1&&(l+="\n\n")}setABCEditorText(l),gIsDirty=!0,u=makeCenteredPromptString(u="Text and tags split!"),DayPilot.Modal.alert(u,{theme:"modal_flat",top:300,scrollWithPage:AllowDialogsToScroll()}).then(function(){RenderAsync(!0,null,function(){gEnableSyntax?(gTheCM.selectionStart=0,gTheCM.selectionEnd=0):(gTheABC.selectionStart=0,gTheABC.selectionEnd=0),FocusAfterOperation()})})}else{var s=findSelectedTuneIndex(),c=findSelectedTune();if(""==c)return;var g,d=SplitOneTuneTagsText(c,gLastTagsToSplit,gLastSplitLongTagsLength,gLastSplitTags,gLastSplitText);if(!d)return;g=gEnableSyntax?gTheCM.selectionStart:gTheABC.selectionStart;var u,m=getABCEditorText();setABCEditorText(m=m.replace(c,d)),gIsDirty=!0,u=makeCenteredPromptString(u="Text and tags split!"),DayPilot.Modal.alert(u,{theme:"modal_flat",top:300,scrollWithPage:AllowDialogsToScroll()}).then(function(){RenderAsync(!1,s,function(){gEnableSyntax?(gTheCM.selectionStart=g,gTheCM.selectionEnd=g):(gTheABC.selectionStart=g,gTheABC.selectionEnd=g),FocusAfterOperation()})})}}})}function DoNormalizeDiacriticals(e){var t=getABCEditorText();setABCEditorText(t=e?escapeDiacriticals(t):replaceEscapedDiacriticals(t)),gIsDirty=!0;var n="Diacriticals normalized!";e&&(n="Diacriticals escaped!"),n=makeCenteredPromptString(n),DayPilot.Modal.alert(n,{theme:"modal_flat",top:300,scrollWithPage:AllowDialogsToScroll()}).then(function(){RenderAsync(!0,null,function(){gEnableSyntax?(gTheCM.selectionStart=0,gTheCM.selectionEnd=0):(gTheABC.selectionStart=0,gTheABC.selectionEnd=0),FocusAfterOperation()})})}function NormalizeDiacriticals(){if(sendGoogleAnalytics("action","NormalizeDiacriticals"),gAllowCopy){DayPilot.Modal.alert('<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Normalize Diacriticals&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#hamburger_normalize_diacriticals" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p><p style="margin-top:24px;margin-bottom:12px;font-size:12pt;line-height:18pt;font-family:helvetica">When sorting the tunes by title or generating a sorted Table of Contents or Index in an exported PDF, for optimal sorting and title display, it is best to normalize the diacriticals if escaped versions were used in the ABC.</p><p style="margin-top:24px;margin-bottom:12px;font-size:12pt;line-height:18pt;font-family:helvetica">Click <strong>Normalize Diacriticals</strong> to replace all escaped /\'A or /\'E style diacriticals with single characters that include the diacritical marks, for example, Á and É.</p><p style="margin-top:24px;margin-bottom:36px;font-size:12pt;line-height:18pt;font-family:helvetica">Click <strong>Escape Diacriticals</strong> to replace all single characters that include the diacritical marks, for example, Á and É with escaped /\'A or /\'E style diacriticals.</p><p style="text-align:center;"><input id="normalizediacriticals" class="advancedcontrols btn btn-injectcontrols-headers" onclick="DoNormalizeDiacriticals(false)" type="button" value="Normalize Diacriticals" title="Normalizes escaped diacriticals"><input id="escapediacriticals" class="advancedcontrols btn btn-injectcontrols-headers" onclick="DoNormalizeDiacriticals(true)" type="button" value="Escape Diacriticals" title="Escapes normalized diacriticals"><p>&nbsp;</p>',{theme:"modal_flat",top:100,width:600,scrollWithPage:AllowDialogsToScroll()})}else{var e=makeCenteredPromptString("No Text in the ABC Editor to Normalize");DayPilot.Modal.alert(e,{theme:"modal_flat",top:200})}}var abctt_ParseCommon={};function titleReverser(e){const t=e=>{const t=/^(\d+)\./.exec(e);return t?t[1]:null},n={", The":"The",", the":"The",", A":"A",", a":"A",", Da":"Da",", La":"La",", Le":"Le",", Les":"Les",", Ye":"Ye",", An":"An",", an":"an",", Der":"Der",", Die":"Die",", Das":"Das",", Ein":"Ein",", Eine":"Eine"};for(const[o,a]of Object.entries(n))if(abctt_ParseCommon.endsWith(e,o)){const n=t(e);n&&(e=e.replace(n+".","").trim());let l=`${a} ${e.slice(0,-o.length)}`;return n&&(l=`${n}. ${l}`),l}return e}function normalizeTitleArticles(e){var t,n=getABCEditorText();if(e){const e={"The ":", The","Da ":", Da","An ":", An","A ":", A","Le ":", Le","La ":", La","Ye ":", Ye","Les ":", Les","an ":", an","Der ":", Der","Die ":", Die","Das ":", Das","Ein ":", Ein","Eine ":", Eine"};t=n.split("\n").map(t=>{if(t.startsWith("T:")){let n=t.slice(2).trim();for(const[t,o]of Object.entries(e))if(n.startsWith(t)){n=n.slice(t.length)+o;break}return"T:"+n}return t}).join("\n")}else t=n.split("\n").map(e=>{if(e.startsWith("T:")){return"T:"+titleReverser(e.slice(2).trim())}return e}).join("\n");setABCEditorText(t),gIsDirty=!0;var o="Titles normalized!";o=makeCenteredPromptString(o),DayPilot.Modal.alert(o,{theme:"modal_flat",top:300,scrollWithPage:AllowDialogsToScroll()}).then(function(){RenderAsync(!0,null,function(){gEnableSyntax?(gTheCM.selectionStart=0,gTheCM.selectionEnd=0):(gTheABC.selectionStart=0,gTheABC.selectionEnd=0),FocusAfterOperation()})})}function NormalizeTitles(){if(sendGoogleAnalytics("action","NormalizeTitles"),!gAllowCopy){var e=makeCenteredPromptString("No Text in the ABC Editor to Normalize");return void DayPilot.Modal.alert(e,{theme:"modal_flat",top:200})}DayPilot.Modal.form([{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Normalize Title Postfixes&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#hamburger_normalize_title_postfixes" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="margin-top:24px;margin-bottom:12px;font-size:12pt;line-height:18pt;font-family:helvetica">Click one of the two actions below to process all title or subtitle T: tag postfix or prefix articles, for example:<br/><br/>"Kesh, The" and "Slockit Light, Da"<br/><br/>to the front of the titles and subtitles resulting in:<br/><br/>"The Kesh" and "Da Slockit Light" or the other way around.</p>'},{html:'<p style="margin-top:24px;margin-bottom:12px;font-size:12pt;line-height:18pt;font-family:helvetica">The title or subtitle postfix articles that can be normalized are:</p>'},{html:'<p style="margin-top:18px;margin-bottom:48px;font-size:12pt;line-height:18pt;font-family:helvetica">The, the, A, a, An, an, Da, La, Le, Les, Ye, Der, Die, Das, Ein, Eine</p>'},{html:'<p style="text-align:center;margin-top:18px;margin-bottom:12px"><input id="title_normalize_forward" style="margin-right:18px;" class="advancedcontrols btn btn-injectcontrols-headers" onclick="normalizeTitleArticles(false);" type="button" value="Kesh, The → The Kesh" title="Move the title postfixes to the start of the titles"><input id="title_normalize_inverse" style="margin-right:18px;" class="advancedcontrols btn btn-injectcontrols-headers" onclick="normalizeTitleArticles(true);" type="button" value="The Kesh → Kesh, The" title="Moves the title prefixes to the end of the titles"></p>'},{html:"<p>&nbsp;</p>"}],{},{theme:"modal_flat_wide",top:50,width:600,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1})}function splitVoices(e){const t=e.split("\n");let n=[],o={},a=null,l=!1,r=[];const i=/^V:\s*(\d+)(.*)$/,s=/^\[V:\s*(\d+)\s*\](.*)$/,c=/^W:/;t.forEach(e=>{if(e.startsWith("%%score"))return;if(c.test(e))return void r.push(e);const t=e.match(i),g=e.match(s);if(t){const e=t[1],r=t[2].trim();a=e,o[a]||(o[a]=[...n],""!==r&&o[a].push(`V:1 ${r}`)),l=!0}else if(g){const e=g[1],t=g[2].trim();a=e,o[a]?""!==t&&o[a].push(t):(o[a]=[...n],""!==t&&o[a].push(`V:1 ${t}`)),l=!0}else l?a&&o[a].push(e):n.push(e)});return Object.keys(o).map(e=>o[e].concat(r).join("\n"))}function SplitVoices(){if(sendGoogleAnalytics("action","Split Voices"),gAllowCopy){if(CountTunes()>1){a=makeCenteredPromptString("Split Voices only works with a single multi-voice tune");DayPilot.Modal.alert(a,{theme:"modal_flat",top:200})}else{var e=getTuneByIndex(0);if(""!=e){var t=splitVoices(e);if(t.length<2){a=makeCenteredPromptString("Multiple voices not found in tune");DayPilot.Modal.alert(a,{theme:"modal_flat",top:200})}else{var n=getABCEditorText();n+="\n";for(var o=0;o<t.length;++o)o>0&&(n+="\n"),n+=t[o],n+="\n";setABCEditorText(n),gIsDirty=!0,RenderAsync(!0,null,function(){var e=makeCenteredPromptString(t.length+" Voices Split");DayPilot.Modal.alert(e,{theme:"modal_flat",top:200})})}}}}else{var a=makeCenteredPromptString("No Tune in the ABC Editor to Split");DayPilot.Modal.alert(a,{theme:"modal_flat",top:200})}}function NormalizeVoiceKeySignatures(){function e(e){const t=e.split(/\r?\n/),n=t.findIndex(e=>/^\s*K\s*:/.test(e));if(-1===n)return e;const o=t[n].match(/^\s*K\s*:\s*(\S.*)$/i);if(!o)return e;const a=o[1].trim(),l=new Set;let r=null;const i=e=>(e||"").trim(),s=e=>{const t=e.match(/^\s*V\s*:\s*([^\s\]]+)/i);return t?i(t[1]):null},c=e=>{const t=e.match(/^(\s*)(\[(?:V|v)\s*:\s*([^\]\s]+)[^\]]*\])(.*)$/);return t?{leading:t[1],tag:t[2],voiceId:i(t[3]),rest:t[4]}:null},g=e=>/^\s*(%|I\s*:|K\s*:|%%)/i.test(e)||""===e.trim(),d=[];for(let e=0;e<t.length;e++){let n=t[e];const o=s(n);if(o){r=o,d.push(n);continue}const i=c(n);if(i){const{leading:e,tag:t,voiceId:o,rest:s}=i;""===s.trim()?(r=o,d.push(n)):l.has(o)?d.push(n):(l.add(o),d.push(`${e}${t}[K:${a}] ${s}`));continue}if(r){if(g(n)){d.push(n);continue}{const e=r;if(r=null,!l.has(e)){l.add(e);const t=(n.match(/^\s*/)||[""])[0];n=`${t}[K:${a}] ${n.slice(t.length)}`}}}d.push(n)}return d.join("\n")}var t;if(0==(o=CountTunes()))return t=makeCenteredPromptString(t="No tunes to normalize."),void DayPilot.Modal.alert(t,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});sendGoogleAnalytics("action","NormalizeVoiceKeySignatures");for(var n=getABCEditorText(),o=CountTunes(),a=n.split(/^X:/gm),l=FindPreTuneHeader(n),r=1;r<=o;++r){var i="X:"+a[r];l+=i=e(i)}setABCEditorText(l),gIsDirty=!0,t=makeCenteredPromptString(t="Voice key signatures normalized!"),DayPilot.Modal.alert(t,{theme:"modal_flat",top:300,scrollWithPage:AllowDialogsToScroll()}).then(function(){RenderAsync(!0,null,function(){gEnableSyntax?(gTheCM.selectionStart=0,gTheCM.selectionEnd=0):(gTheABC.selectionStart=0,gTheABC.selectionEnd=0),FocusAfterOperation()})})}function LaunchStandardEditor(){window.open("https://michaeleskin.com/abctools/abctools.html","_blank")}function LaunchEditorHelp(){window.open("https://michaeleskin.com/abctools/userguide.html","_blank")}function LaunchQuickEditor(){window.open("https://michaeleskin.com/abctools/abctools-quick-editor.html","_blank")}function LaunchQuickEditorHelp(){window.open("https://michaeleskin.com/abctools/userguide.html#quickeditor","_blank")}function DoVersionCheck(){gUpdateVersion=gVersionNumber,gUpdateAvailable=!1;try{fetch("https://michaeleskin.com/abctools/abc_tools_version.json").then(e=>e.json()).then(e=>{e&&e.version&&e.version!=gVersionNumber?(SetupContextMenu(!0),gUpdateAvailable=!0,gUpdateVersion=e.version):SetupContextMenu(!1)})}catch(e){SetupContextMenu(!1)}}function SetupContextMenu(e){var t;if(isDesktopBrowser())if(gIsQuickEditor)if(isPureDesktopBrowser()){if(t=[{},{name:"Reorder Tunes",fn:function(e){ChangeTuneOrder()}},{name:"Delete Tunes",fn:function(e){CullTunes()}},{},{name:"Sort Tunes by Tag",fn:function(e){SortDialog()}},{}],isMac()?t.push({name:"Align Bars (One Tune) (⌘+\\)",fn:function(e){AlignMeasures(!1)}}):t.push({name:"Align Bars (One Tune) (Ctrl+\\)",fn:function(e){AlignMeasures(!1)}}),t=t.concat([{name:"Align Bars (All Tunes)",fn:function(e){AlignMeasures(!0)}},{},{name:"Split Long Tags and Text",fn:function(e){SplitLongTextAndTags()}},{},{name:"Normalize Diacriticals",fn:function(e){NormalizeDiacriticals()}},{name:"Normalize Title Postfixes",fn:function(e){NormalizeTitles()}},{},{name:"Reformat Using MusicXML",fn:function(e){BatchMusicXMLRoundTrip()}},{},{name:"Split Voices",fn:function(e){SplitVoices()}},{name:"Normalize Voice Keys",fn:function(e){NormalizeVoiceKeySignatures()}},{},{name:"Inject MIDI gchord Templates",fn:function(e){InjectMIDIGChordTemplates()}},{},{name:"Import PDF, Website, or CSV",fn:function(e){ImportPDF_CSV_Website()}},{},{name:"Toggle Top/Bottom Toolbars",fn:function(e){ToggleTopBar()}},{name:"Maximize Editor",fn:function(e){MaximizeEditor()}},{},{name:"Settings",fn:function(e){ConfigureToolSettings()}},{name:"Advanced Settings",fn:function(e){AdvancedSettings()}},{},{name:"Launch Standard Editor",fn:function(e){LaunchStandardEditor()}},{},{name:"About the Quick Editor",fn:function(e){LaunchQuickEditorHelp()}}]),e)t=t.concat([{},{name:"*A new version is available!",fn:function(e){UpdateToLatestVersion()}},{name:"*Click here to update the tool",fn:function(e){UpdateToLatestVersion()}}]),(l=document.getElementById("morecommands")).classList.add("attention"),l.title="An update to the tool is available!";var n={name:"Create Tune Set (Ctrl+/)",fn:function(e){BuildTuneSet()}};isMac()&&(n={name:"Create Tune Set (⌘+/)",fn:function(e){BuildTuneSet()}}),t.unshift(n),t.unshift({});var o={name:"Jump to Tune (Ctrl+J)",fn:function(e){JumpToTune()}};isMac()&&(o={name:"Jump to Tune (⌘+J)",fn:function(e){JumpToTune()}}),t.unshift(o),t.unshift({});var a={name:"Find and Replace (Ctrl+F)",fn:function(e){FindAndReplace()}};isMac()&&(a={name:"Find and Replace (⌘+F)",fn:function(e){FindAndReplace()}}),t.unshift(a)}else{if(t=[{name:"Find and Replace",fn:function(e){FindAndReplace()}},{},{name:"Jump to Tune",fn:function(e){JumpToTune()}},{},{name:"Create Tune Set",fn:function(e){BuildTuneSet()}},{},{name:"Reorder Tunes",fn:function(e){ChangeTuneOrderMobile()}},{name:"Delete Tunes",fn:function(e){CullTunes()}},{},{name:"Sort Tunes by Tag",fn:function(e){SortDialog()}},{},{name:"Align Bars (One Tune)",fn:function(e){AlignMeasures(!1)}},{name:"Align Bars (All Tunes)",fn:function(e){AlignMeasures(!0)}},{},{name:"Split Long Tags and Text",fn:function(e){SplitLongTextAndTags()}},{},{name:"Normalize Diacriticals",fn:function(e){NormalizeDiacriticals()}},{name:"Normalize Title Postfixes",fn:function(e){NormalizeTitles()}},{},{name:"Reformat Using MusicXML",fn:function(e){BatchMusicXMLRoundTrip()}},{},{name:"Split Voices",fn:function(e){SplitVoices()}},{name:"Normalize Voice Keys",fn:function(e){NormalizeVoiceKeySignatures()}},{},{name:"Import PDF, Website, or CSV",fn:function(e){ImportPDF_CSV_Website()}},{},{name:"Toggle Top/Bottom Toolbars",fn:function(e){ToggleTopBar()}},{name:"Maximize Editor",fn:function(e){MaximizeEditor()}},{},{name:"Settings",fn:function(e){ConfigureToolSettings()}},{name:"Advanced Settings",fn:function(e){AdvancedSettings()}},{},{name:"Launch Standard Editor",fn:function(e){LaunchStandardEditor()}},{},{name:"About the Quick Editor",fn:function(e){LaunchQuickEditorHelp()}}],e)t=t.concat([{},{name:"*A new version is available!",fn:function(e){UpdateToLatestVersion()}},{name:"*Click here to update the tool",fn:function(e){UpdateToLatestVersion()}}]),(l=document.getElementById("morecommands")).classList.add("attention"),l.title="An update to the tool is available!"}else if(isPureDesktopBrowser()){if(t=[{},{name:"Reorder Tunes",fn:function(e){ChangeTuneOrder()}},{name:"Delete Tunes",fn:function(e){CullTunes()}},{},{name:"Sort Tunes by Tag",fn:function(e){SortDialog()}},{}],isMac()?t.push({name:"Align Bars (One Tune) (⌘+\\)",fn:function(e){AlignMeasures(!1)}}):t.push({name:"Align Bars (One Tune) (Ctrl+\\)",fn:function(e){AlignMeasures(!1)}}),t=t.concat([{name:"Align Bars (All Tunes)",fn:function(e){AlignMeasures(!0)}},{},{name:"Split Long Tags and Text",fn:function(e){SplitLongTextAndTags()}},{},{name:"Normalize Diacriticals",fn:function(e){NormalizeDiacriticals()}},{name:"Normalize Title Postfixes",fn:function(e){NormalizeTitles()}},{},{name:"Reformat Using MusicXML",fn:function(e){BatchMusicXMLRoundTrip()}},{},{name:"Split Voices",fn:function(e){SplitVoices()}},{name:"Normalize Voice Keys",fn:function(e){NormalizeVoiceKeySignatures()}},{},{name:"Inject MIDI gchord Templates",fn:function(e){InjectMIDIGChordTemplates()}},{},{name:"Import PDF, Website, or CSV",fn:function(e){ImportPDF_CSV_Website()}},{},{name:"Toggle Top/Bottom Toolbars",fn:function(e){ToggleTopBar()}},{name:"Maximize Editor",fn:function(e){MaximizeEditor()}},{},{name:"Settings",fn:function(e){ConfigureToolSettings()}},{name:"Advanced Settings",fn:function(e){AdvancedSettings()}},{},{name:"Launch Quick Editor",fn:function(e){LaunchQuickEditor()}}]),e)t=t.concat([{},{name:"*A new version is available!",fn:function(e){UpdateToLatestVersion()}},{name:"*Click here to update the tool",fn:function(e){UpdateToLatestVersion()}}]),(l=document.getElementById("morecommands")).classList.add("attention"),l.title="An update to the tool is available!";n={name:"Create Tune Set (Ctrl+/)",fn:function(e){BuildTuneSet()}};isMac()&&(n={name:"Create Tune Set (⌘+/)",fn:function(e){BuildTuneSet()}}),t.unshift(n),t.unshift({});o={name:"Jump to Tune (Ctrl+J)",fn:function(e){JumpToTune()}};isMac()&&(o={name:"Jump to Tune (⌘+J)",fn:function(e){JumpToTune()}}),t.unshift(o),t.unshift({});a={name:"Find and Replace (Ctrl+F)",fn:function(e){FindAndReplace()}};isMac()&&(a={name:"Find and Replace (⌘+F)",fn:function(e){FindAndReplace()}}),t.unshift(a)}else{var l;if(t=[{name:"Find and Replace",fn:function(e){FindAndReplace()}},{},{name:"Jump to Tune",fn:function(e){JumpToTune()}},{},{name:"Create Tune Set",fn:function(e){BuildTuneSet()}},{},{name:"Reorder Tunes",fn:function(e){ChangeTuneOrderMobile()}},{name:"Delete Tunes",fn:function(e){CullTunes()}},{},{name:"Sort Tunes by Tag",fn:function(e){SortDialog()}},{},{name:"Align Bars (One Tune)",fn:function(e){AlignMeasures(!1)}},{name:"Align Bars (All Tunes)",fn:function(e){AlignMeasures(!0)}},{},{name:"Split Long Tags and Text",fn:function(e){SplitLongTextAndTags()}},{},{name:"Normalize Diacriticals",fn:function(e){NormalizeDiacriticals()}},{name:"Normalize Title Postfixes",fn:function(e){NormalizeTitles()}},{},{name:"Reformat Using MusicXML",fn:function(e){BatchMusicXMLRoundTrip()}},{},{name:"Split Voices",fn:function(e){SplitVoices()}},{name:"Normalize Voice Keys",fn:function(e){NormalizeVoiceKeySignatures()}},{},{name:"Import PDF, Website, or CSV",fn:function(e){ImportPDF_CSV_Website()}},{},{name:"Toggle Top/Bottom Toolbars",fn:function(e){ToggleTopBar()}},{name:"Maximize Editor",fn:function(e){MaximizeEditor()}},{},{name:"Settings",fn:function(e){ConfigureToolSettings()}},{name:"Advanced Settings",fn:function(e){AdvancedSettings()}},{},{name:"Launch Quick Editor",fn:function(e){LaunchQuickEditor()}}],e)t=t.concat([{},{name:"*A new version is available!",fn:function(e){UpdateToLatestVersion()}},{name:"*Click here to update the tool",fn:function(e){UpdateToLatestVersion()}}]),(l=document.getElementById("morecommands")).classList.add("attention"),l.title="An update to the tool is available!"}else gIsQuickEditor?(t=[{name:"Find and Replace",fn:function(e){FindAndReplace()}},{},{name:"Jump to Tune",fn:function(e){JumpToTune()}},{},{name:"Create Tune Set",fn:function(e){BuildTuneSet()}},{},{name:"Reorder Tunes",fn:function(e){ChangeTuneOrderMobile()}},{name:"Delete Tunes",fn:function(e){CullTunes()}},{},{name:"Sort Tunes by Tag",fn:function(e){SortDialog()}},{},{name:"Align Bars (One Tune)",fn:function(e){AlignMeasures(!1)}},{name:"Align Bars (All Tunes)",fn:function(e){AlignMeasures(!0)}},{},{name:"Split Long Tags and Text",fn:function(e){SplitLongTextAndTags()}},{},{name:"Normalize Diacriticals",fn:function(e){NormalizeDiacriticals()}},{name:"Normalize Title Postfixes",fn:function(e){NormalizeTitles()}},{},{name:"Reformat Using MusicXML",fn:function(e){BatchMusicXMLRoundTrip()}},{},{name:"Split Voices",fn:function(e){SplitVoices()}},{name:"Normalize Voice Keys",fn:function(e){NormalizeVoiceKeySignatures()}},{},{name:"Import PDF, Website, or CSV",fn:function(e){ImportPDF_CSV_Website()}},{},{name:"Toggle Top/Bottom Toolbars",fn:function(e){ToggleTopBar()}},{},{name:"Settings",fn:function(e){ConfigureToolSettings()}},{name:"Advanced Settings",fn:function(e){AdvancedSettings()}},{},{name:"Launch Standard Editor",fn:function(e){LaunchStandardEditor()}},{},{name:"About the Quick Editor",fn:function(e){LaunchQuickEditorHelp()}}],e&&(t=t.concat([{},{name:"*A new version is available!",fn:function(e){UpdateToLatestVersion()}},{name:"*Click here to update the tool",fn:function(e){UpdateToLatestVersion()}}]),(l=document.getElementById("morecommands")).classList.add("attention"),l.title="An update to the tool is available!")):(t=[{name:"Find and Replace",fn:function(e){FindAndReplace()}},{},{name:"Jump to Tune",fn:function(e){JumpToTune()}},{},{name:"Create Tune Set",fn:function(e){BuildTuneSet()}},{},{name:"Reorder Tunes",fn:function(e){ChangeTuneOrderMobile()}},{name:"Delete Tunes",fn:function(e){CullTunes()}},{},{name:"Sort Tunes by Tag",fn:function(e){SortDialog()}},{},{name:"Align Bars (One Tune)",fn:function(e){AlignMeasures(!1)}},{name:"Align Bars (All Tunes)",fn:function(e){AlignMeasures(!0)}},{},{name:"Split Long Tags and Text",fn:function(e){SplitLongTextAndTags()}},{},{name:"Normalize Diacriticals",fn:function(e){NormalizeDiacriticals()}},{name:"Normalize Title Postfixes",fn:function(e){NormalizeTitles()}},{},{name:"Reformat Using MusicXML",fn:function(e){BatchMusicXMLRoundTrip()}},{},{name:"Split Voices",fn:function(e){SplitVoices()}},{name:"Normalize Voice Keys",fn:function(e){NormalizeVoiceKeySignatures()}},{},{name:"Import PDF, Website, or CSV",fn:function(e){ImportPDF_CSV_Website()}},{},{name:"Toggle Top/Bottom Toolbars",fn:function(e){ToggleTopBar()}},{},{name:"Settings",fn:function(e){ConfigureToolSettings()}},{name:"Advanced Settings",fn:function(e){AdvancedSettings()}},{},{name:"Launch Quick Editor",fn:function(e){LaunchQuickEditor()}}],e&&(t=t.concat([{},{name:"*A new version is available!",fn:function(e){UpdateToLatestVersion()}},{name:"*Click here to update the tool",fn:function(e){UpdateToLatestVersion()}}]),(l=document.getElementById("morecommands")).classList.add("attention"),l.title="An update to the tool is available!"));new ContextMenu(".context-menu",t)}function SetTopButtonMargins(){if(gIsQuickEditor){var e=["openabcfile","newabcfile","saveabcfile","saveaswebsite","copybutton","playbutton","rawmodebutton"],t=20;isMobileBrowser()&&(t=32),giPadTwoColumn&&(t=32),e.forEach(function(e){var n=document.getElementById(e);n&&(n.style.marginRight=t+"px")})}else{e=["openabcfile","newabcfile","saveabcfile","saveaspdf","saveaswebsite","copybutton","playbutton","rawmodebutton"],t=8;isMobileBrowser()&&(t=20),gIsIPad&&(t=14),giPadTwoColumn&&(t=22),e.forEach(function(e){var n=document.getElementById(e);n&&(n.style.marginRight=t+"px")})}}function DoStartup(){if(gShowAdvancedControls=!1,gShowShareControls=!1,gStripAnnotations=!1,gStripQPTags=!1,gStripTextAnnotations=!1,gStripChords=!1,gStripTab=!1,gStripOrnaments=!1,gRenderingPDF=!1,gAllowSave=!1,gAllowURLSave=!1,gShowAllControls=!1,gAllowControlToggle=!1,gAllowFilterAnnotations=!1,gAllowFilterText=!1,gAllowFilterChords=!1,gAllowFilterTab=!1,gAllowFilterOrnaments=!1,gIsMaximized=!1,gCapo=0,gABCFromFile=!1,gAllowCopy=!1,gAllowPDF=!1,gAllowWebExport=!1,gShowTabNames=!0,gAllowShowTabNames=!1,gLastAutoScrolledTune=-1,gLastClickedTune=-1,gTopBarShowing=!0,gCurrentTune=0,gTotalTunes=0,gCurrentTab="noten",gForceFullRender=!1,gIsOneColumn=!0,gLocalStorageAvailable=!1,gPDFQuality=.75,gPDFTitleSpacing=1,gPDFSubTitleSpacing=1,gPDFPageNumberHOffset=0,gPDFPageNumberVOffset=0,gPDFPageHeaderVOffset=0,gPDFPageFooterVOffset=0,gIncludePageLinks=!0,gDoForcePDFFilename=!1,gForcePDFFilename="",gFullScreenScaling=50,gIsDirty=!1,gForceComhaltasABC=!1,gForceAndroid=!1,gDisableAndroid=!1,window.localStorage&&(gLocalStorageAvailable=!0),doOnlineCheck(),HideMaximizeButton(),DoMaximize(),gSpinnerDelay=25,(gIsSafari=isSafari())&&(gSpinnerDelay=250),gIsChrome=!1,gIsSafari||isChrome()&&(gIsChrome=!0),gIsIOS=!1,isIOS()&&(gIsIOS=!0),gIsIPad=!1,isIPad()&&(gIsIPad=!0),gIsIPhone=!1,isIPhone()&&(gIsIPhone=!0),gIsAndroid=!1,isAndroid()&&(gIsAndroid=!0),CheckFacebook_iOS(),!gIsFacebook){if(isPureDesktopBrowser()||(gTheABC.placeholder="Enter the ABC for your tunes here"),gLocalStorageAvailable)gEnableSyntax=isPureDesktopBrowser(),(e=localStorage.EnableSyntax4)&&(gEnableSyntax="true"==e),gSyntaxDarkMode=!1,(e=localStorage.SyntaxDarkMode)&&(gSyntaxDarkMode="true"==e),gEnableSyntaxMessageDelivered=!1,(e=localStorage.EnableSyntaxMessageDelivered)&&(gEnableSyntaxMessageDelivered="true"==e);if(gEnableSyntax&&(initCodeMirror(),wireClickish(gTheCM,AUTOSCROLLDEBOUNCEMS)),gIsIOS&&document.getElementById("selectabcfile").removeAttribute("accept"),gLocalStorageAvailable){var e=localStorage.iPadTwoColumn;(giPadTwoColumn=!!e&&"true"==e)&&(gLargePlayerControls=!0),(e=localStorage.forceAndroid)&&("true"==e?(gForceAndroid=!0,gIsAndroid=!0,gIsIOS=!1,gIsIPad=!1,giPadTwoColumn=!1):gForceAndroid=!1),(e=localStorage.disableAndroid)&&("true"==e?(gDisableAndroid=!0,gIsAndroid=!1,gIsIOS=!1,gIsIPad=!1,giPadTwoColumn=!1):gDisableAndroid=!1)}if(isMobileBrowser())if((l=document.getElementById("toolpagetitle")).style.fontFamily="Helvetica",(l=document.getElementById("notenlinks")).style.paddingTop="20px",giPadTwoColumn){document.querySelector("meta[name=viewport]").setAttribute("content","width=1800,maximum-scale=1.0,user-scalable=0"),(l=document.getElementById("rawmodebutton")).style.display="none",(l=document.getElementById("notation-placeholder")).style.width="860px",(l=document.getElementById("noscroller")).style.width="860px",(l=gTheNotation).style.width="860px",(l=document.getElementById("notation-spacer")).style.width="860px",(l=document.getElementById("uioverlay")).style.width="860px",(l=document.getElementById("diagnostics")).style.width="836px",(l=document.getElementById("transpose-controls")).style.display="inline-block",document.addEventListener("touchstart",function(e){e.touches.length>1&&e.preventDefault()},{passive:!1}),document.addEventListener("touchmove",function(e){e.touches.length>1&&e.preventDefault()},{passive:!1})}else{if((l=document.getElementById("toolpagetitle")).size=4,gIsIPhone||gIsAndroid)gEnableSyntax?(setCMFont(gTheCM,16,18),setCodeMirrorRows(gTheCM,13)):((l=gTheABC).cols=gIsIPhone?60:58,l.style.fontSize="16pt",l.style.lineHeight="18pt"),document.querySelector("meta[name=viewport]").setAttribute("content","width=860,maximum-scale=1.0,user-scalable=0");gEnableSyntax&&gIsIPad&&setCMFont(gTheCM,13,17),(l=document.getElementById("app-container")).style.width="860px",l.style.display="block",l.style.marginLeft="0px",(l=document.getElementById("notation-placeholder")).style.width="860px",l.style.display="none",(l=document.getElementById("noscroller")).style.width="860px",l.style.display="none",(l=gTheNotation).style.width="820px",l.style.display="block",l.style.marginLeft="20px",l.style.marginRight="0px",l.style.overflow="hidden",(l=document.getElementById("notation-spacer")).style.width="860px",l.style.display="block",l.style.marginRight="0px",(l=document.getElementById("uioverlay")).style.width="860px",l.style.display="block",(l=document.getElementById("diagnostics")).style.width="836px",l.style.display="block",(l=document.getElementById("rawmodebutton")).style.display="none"}if((gIsIPhone||gIsAndroid)&&(document.getElementById("zoombutton").style.right="21px",document.getElementById("jumpbutton").style.right="153px",document.getElementById("helpbutton").style.left="21px",document.getElementById("playbuttonicon").style.right="21px",gIsQuickEditor?(document.getElementById("qerewindbutton").style.right="150px",document.getElementById("qetempobutton").style.right="272px"):document.getElementById("pdfbuttonicon").style.left="21px"),gIsIPad){var t="36px",n="8px",o=8;giPadTwoColumn&&(t="54px",n="16px",o=16),document.getElementById("zoombutton").style.width=t,document.getElementById("zoombutton").style.height=t,document.getElementById("zoombutton").style.top=n,document.getElementById("zoombutton").style.right=n,document.getElementById("jumpbutton").style.width=t,document.getElementById("jumpbutton").style.height=t,document.getElementById("jumpbutton").style.top=n,document.getElementById("jumpbutton").style.right=o+80+"px",document.getElementById("helpbutton").style.width=t,document.getElementById("helpbutton").style.height=t,document.getElementById("helpbutton").style.top=n,document.getElementById("helpbutton").style.left=n,document.getElementById("playbuttonicon").style.width=t,document.getElementById("playbuttonicon").style.height=t,document.getElementById("playbuttonicon").style.bottom=n,document.getElementById("playbuttonicon").style.right=n,gIsQuickEditor?(document.getElementById("qerewindbutton").style.width=t,document.getElementById("qerewindbutton").style.height=t,document.getElementById("qerewindbutton").style.bottom=n,document.getElementById("qerewindbutton").style.right=o+80+"px",document.getElementById("qetempobutton").style.width=t,document.getElementById("qetempobutton").style.height=t,document.getElementById("qetempobutton").style.bottom=n,document.getElementById("qetempobutton").style.right=o+160+"px"):(document.getElementById("pdfbuttonicon").style.width=t,document.getElementById("pdfbuttonicon").style.height=t,document.getElementById("pdfbuttonicon").style.bottom=n,document.getElementById("pdfbuttonicon").style.left=n)}gEnableSyntax?gTheCM.on("changes",debounce(()=>{gIsDirty=!0,gForceFullRender?RenderAsync(!0,null):OnABCTextChange(),gForceFullRender=!1},DEBOUNCEMS)):(document.getElementById("abc").oninput=debounce(()=>{gIsDirty=!0,gForceFullRender?RenderAsync(!0,null):OnABCTextChange(),gForceFullRender=!1},DEBOUNCEMS),document.getElementById("abc").onpaste=function(e){var t=!1,n=e.clipboardData||window.clipboardData;if(n){var o=n.getData("text");o&&-1!=o.indexOf("X:")&&(t=!0)}setTimeout(function(){var e=getABCEditorText();e=CleanSmartQuotes(e),gIsDirty=!0,gIsIOS&&(e=FixIOS17(e)),setABCEditorText(e),t&&setTimeout(function(){RenderAsync(!0,null)},250)},0)},document.getElementById("abc").onclick=debounce(e=>{if(isPureDesktopBrowser()&&e.altKey){e.target;const o=getABCEditorText(),a=gTheABC.selectionStart;let l=o.lastIndexOf("\nX:",a);-1===l?l=o.indexOf("X:",0):l++;var t=o.indexOf("\n\n",a),n=o.indexOf("X:",a);-1===t&&-1===n?t=o.length:(-1===t||t>=n)&&(t=n),gTheABC.setSelectionRange(l,t)}MakeTuneVisible(!1),fireSelectionChanged()},AUTOSCROLLDEBOUNCEMS)),document.getElementById("selectabcfile").onchange=()=>{let e=document.getElementById("selectabcfile");if(0===e.files.length){var t="Please select an ABC, MusicXML, or MIDI file";return t=makeCenteredPromptString(t),void DayPilot.Modal.alert(t,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})}if(gImportRunning)return void(e&&(e.value=""));setABCEditorText(""),Render(!0,null),gIsDirty=!1;DoMultiReadCommon(Array.from(e.files),e)},gIsFirstRun=isFirstRun(),SetRadioValue("notenodertab","noten"),setPDFFormat("one"),setPageNumbers("none"),setFirstPage("yes"),document.getElementById("zoombutton").onclick=function(e){e.altKey?togglePresentationMode():ToggleMaximize()},document.getElementById("jumpbutton").onclick=function(e){JumpToTune()},document.getElementById("helpbutton").onclick=function(){ShowHelp()},gIsQuickEditor?(document.getElementById("playbuttonicon").onclick=QE_PlayButton_Handler,document.getElementById("qerewindbutton").onclick=QE_RewindButton_Handler,document.getElementById("qetempobutton").onclick=QE_TempoButton_Handler):(document.getElementById("playbuttonicon").onclick=function(e){e.shiftKey?TuneTrainer(!1):PlayABC(null)},document.getElementById("pdfbuttonicon").onclick=function(){PDFExportDialog()}),gStaffSpacing=STAFFSPACEOFFSET+STAFFSPACEDEFAULT,ClearNoRender(),resetAngloButtonNames(),resetMusicXMLImportOptions(),gLocalStorageAvailable&&GetInitialConfigurationSettings(),isPureDesktopBrowser()&&gSaveLastAutoSnapShot&&AddTabCloseListener(),gForceInitialTextBoxRecalc=!1;var a=processShareLink();if(gIsFromShare=a,gForceInitialTextBoxRecalc=a,a?(gIsQuickEditor?(ShowPlayButton(),ShowQEFSPlayerButtons()):(ShowPlayButton(),ShowPDFButton()),gIsFirstRun&&showZoomInstructionsScreen(),restorePDFStateFromLocalStorage(),UpdateLocalStorage(),sendGoogleAnalytics("start","from_share")):(DoMinimize(),document.getElementById("notation-placeholder").style.display="block",restoreStateFromLocalStorage(),sendGoogleAnalytics("start","no_share")),ShowHideTabButtons(),SetTopButtonMargins(),HideJumpButton(),gEnableSyntax?new ResizeObserver(TextBoxResizeHandler).observe(gTheCM.getWrapperElement()):new ResizeObserver(TextBoxResizeHandler).observe(gTheABC),isDesktopBrowser()){if(gEnableSyntax){let e=gTheCM.getWrapperElement();giPadTwoColumn?(gInitialTextBoxWidth=832,e.style.marginLeft="0px",e.style.width=gInitialTextBoxWidth+"px",gTheCM.refresh()):gInitialTextBoxWidth=gTheCM.offsetWidth}else giPadTwoColumn?(gInitialTextBoxWidth=832,gTheABC.style.marginLeft="0px",gTheABC.style.width=gInitialTextBoxWidth+"px"):gInitialTextBoxWidth=gTheABC.offsetWidth;var l=document.getElementById("notenlinks");gInitialTextBoxContainerWidth=l.offsetWidth,l=document.getElementById("noscroller"),gInitialTextBoxContainerLeft=l.offsetLeft,isPureDesktopBrowser()&&(gEnableSyntax?new ResizeObserver(ResizeTextBox).observe(gTheCM.getWrapperElement()):new ResizeObserver(ResizeTextBox).observe(gTheABC)),window.onresize=function(){if(HandleWindowResize(),gIsMaximized)gGotWindowResizeWhileMaximized=!0;else{if(gEnableSyntax){let e=gTheCM.getWrapperElement();e.style.marginLeft="0px",e.style.width=gInitialTextBoxWidth+"px",gTheCM.refresh()}else gTheABC.style.marginLeft="0px",gTheABC.style.width=gInitialTextBoxWidth+"px";var e=document.getElementById("notenlinks");gInitialTextBoxContainerWidth=e.offsetWidth,e=document.getElementById("noscroller"),gInitialTextBoxContainerLeft=e.offsetLeft,gTheNotation.style.marginLeft="auto",ResizeTextBox(),gGotWindowResizeWhileMaximized=!1}},updateABCEditorFont()}if(updateDiagnostics(),HandleWindowResize(),ShowAllControls(),setTimeout(function(){var e=getABCEditorText();e&&e.trim().length>0&&(CountTunes()>0&&RenderAsync(!0,null))},100),a||(document.getElementById("notenrechts").style.display="none",gAllowControlToggle=!1),isPureDesktopBrowser()?($.event.props.push("dataTransfer"),gEnableSyntax?wireAbcDragDrop():($("#abc").on("drop",function(e){$(this).toggleClass("indrag",!1),DoDrop(e)}),$("#abc").on("dragover",function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}),$("#abc").on("dragenter dragleave",function(){$(this).toggleClass("indrag")}),$("#abc").on("dragstart",function(e){e.preventDefault()}))):(document.getElementById("desktop_use_message").style.display="none",gEnableSyntax||$("#abc").on("dragstart",function(e){e.preventDefault()})),isPureDesktopBrowser()){if(gEnableSyntax){let e=gTheCM.getWrapperElement();e.onmousedown=function(e){gRawMode&&setTimeout(function(){gRawIsDragging=!0,fireSelectionChanged()},0)},e.onmouseup=function(e){gRawMode&&(gRawIsDragging=!1,fireSelectionChanged())},e.onmousemove=function(e){gRawMode&&gRawIsDragging&&fireSelectionChanged()}}else gTheABC.onmousedown=function(e){gRawMode&&setTimeout(function(){gRawIsDragging=!0,fireSelectionChanged()},0)},gTheABC.onmouseup=function(e){gRawMode&&(gRawIsDragging=!1,fireSelectionChanged())},gTheABC.onmousemove=function(e){gRawMode&&gRawIsDragging&&fireSelectionChanged()};if(gAllowRawMode=!0,isMac())(l=document.getElementById("saveabcfile")).title="Saves the current ABC text to a file (⌘+S)",document.addEventListener("keydown",function(e){if("F3"===e.key){e.preventDefault();const t=document.querySelector("button.abcjs-midi-reset");t&&t.click()}else if("F4"===e.key){e.preventDefault();const t=document.querySelector("button.abcjs-midi-start");if(t)t.click(),isSafari()||setTimeout(function(){var e=ABCJS.synth.activeAudioContext();if(e&&"suspended"==e.state){t.classList.remove("abcjs-loading");DayPilot.Modal.alert('<p style="text-align:center;font-size:18pt;font-family:helvetica;">Click OK to Play</p><p style="font-size:14pt;line-height:18pt;margin-top:36px;text-align:center;">Your browser requires a click before you can use F4 to play the tune.</p><p style="font-size:14pt;line-height:18pt;margin-top:18px;text-align:center;">Please click OK to play the tune.</p>',{theme:"modal_flat",top:200,width:700,scrollWithPage:AllowDialogsToScroll()}).then(function(){e.resume()})}},250);else{const e=document.getElementById("playbutton");e&&e.click()}}else if(e.metaKey&&"f"===e.key){e.preventDefault(),document.querySelector(".modal_flat_main")||gRenderingPDF||FindAndReplace()}else if(e.metaKey&&"j"===e.key){e.preventDefault(),document.querySelector(".modal_flat_main")||gRenderingPDF||JumpToTune()}else if(e.metaKey&&"\\"===e.key){e.preventDefault(),document.querySelector(".modal_flat_main")||gRenderingPDF||AlignMeasures(!1)}else if(e.metaKey&&"/"===e.key){e.preventDefault(),document.querySelector(".modal_flat_main")||gRenderingPDF||BuildTuneSet()}else if(e.metaKey&&"s"===e.key){e.preventDefault(),document.querySelector(".modal_flat_main")||gRenderingPDF||SaveABC_KB()}},!0);else(l=document.getElementById("saveabcfile")).title="Saves the current ABC text to a file (Ctrl+S)",document.addEventListener("keydown",function(e){if("F3"===e.key){e.preventDefault();const t=document.querySelector("button.abcjs-midi-reset");t&&t.click()}else if("F4"===e.key){e.preventDefault();const t=document.querySelector("button.abcjs-midi-start");if(t)t.click(),setTimeout(function(){var e=ABCJS.synth.activeAudioContext();if(e&&"suspended"==e.state){t.classList.remove("abcjs-loading");DayPilot.Modal.alert('<p style="text-align:center;font-size:18pt;font-family:helvetica;">Click OK to Play</p><p style="font-size:14pt;line-height:18pt;margin-top:36px;text-align:center;">Your browser requires a click before you can use F4 to play the tune.</p><p style="font-size:14pt;line-height:18pt;margin-top:18px;text-align:center;">Please click OK to play the tune.</p>',{theme:"modal_flat",top:200,width:700,scrollWithPage:AllowDialogsToScroll()}).then(function(){e.resume()})}},100);else{const e=document.getElementById("playbutton");e&&e.click()}}else if(e.ctrlKey&&"f"===e.key){e.preventDefault(),document.querySelector(".modal_flat_main")||gRenderingPDF||FindAndReplace()}else if(e.ctrlKey&&"j"===e.key){e.preventDefault(),document.querySelector(".modal_flat_main")||gRenderingPDF||JumpToTune()}else if(e.ctrlKey&&"\\"===e.key){e.preventDefault(),document.querySelector(".modal_flat_main")||gRenderingPDF||AlignMeasures(!1)}else if(e.ctrlKey&&"/"===e.key){e.preventDefault(),document.querySelector(".modal_flat_main")||gRenderingPDF||BuildTuneSet()}else if(e.ctrlKey&&"s"===e.key){e.preventDefault(),document.querySelector(".modal_flat_main")||gRenderingPDF||SaveABC_KB()}},!0)}var r=!1;if(0==window.location.protocol.indexOf("file:")&&(r=!0,console.log("Tool is running from disk.")),r||!navigator.onLine?SetupContextMenu(!1):DoVersionCheck(),a||(gTipJarCount++,gLocalStorageAvailable&&(localStorage.TipJarCount=gTipJarCount)),25!=gTipJarCount&&75!=gTipJarCount&&150!=gTipJarCount&&300!=gTipJarCount||TipJarReminderDialog(),gAllowMIDIInput&&initMIDI(),a||!isPureDesktopBrowser()||gEnableSyntaxMessageDelivered||(SyntaxHighlightInfoDialog(),gEnableSyntaxMessageDelivered=!0,gLocalStorageAvailable&&(localStorage.EnableSyntaxMessageDelivered=!0)),ShowHelpButton(),SetupRawModeUI(),initImpulseDB(),initTuneDB(),initSamplesDB(),async function(){try{await CustomInstrumentsDB.init();const e=await CustomInstrumentsDB.loadSlots();if(!Array.isArray(e)||!e.some(Boolean))return;gCustomInstrumentSlots=e.map(e=>e?{name:e.name,zipBytes:e.zipBytes}:null),gCustomInstrumentState={slots:gCustomInstrumentSlots.map(e=>e?{name:e.name,zipBytes:e.zipBytes}:null),pool:[],selectedPoolIndex:null},processCustomInstruments(!0)}catch(e){console.warn("Custom instrument DB init failed:",e)}}(),window.addEventListener("online",doOnlineCheck),window.addEventListener("offline",doOnlineCheck),a&&giPadTwoColumn&&!gOpenInEditor&&(gIsMaximized=!1,ToggleMaximize()),gEnableSyntax){if(isMobileBrowser()){const e=gTheCM.getWrapperElement(),t=e.offsetWidth;e.style.width=t-32+"px",e.style.marginLeft="14px",gTheCM.refresh()}gTheCM.focus()}else gTheABC.focus()}}abctt_ParseCommon.strip=function(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")},abctt_ParseCommon.startsWith=function(e,t){return 0===e.indexOf(t)},abctt_ParseCommon.endsWith=function(e,t){var n=e.length-t.length;return n>=0&&e.lastIndexOf(t)===n},abctt_ParseCommon.last=function(e){return 0===e.length?null:e[e.length-1]};const ABCJS_STYLE_ITEMS=[{id:"abcjs-ending",label:"1st/2nd Endings",selectors:[".abcjs-ending"],props:["color"],color:"#000000"},{id:"abcjs-lyric",label:"Aligned Lyrics (w:)",selectors:[".abcjs-lyric"],props:["color"],color:"#000000"},{id:"abcjs-meta-bottom",label:"All Metadata Above Notation",selectors:[".abcjs-meta-bottom"],props:["color"],color:"#000000"},{id:"abcjs-meta-top",label:"All Metadata Below Notation",selectors:[".abcjs-meta-top"],props:["color"],color:"#000000"},{id:"abcjs-annotation",label:"Annotations (^...)",selectors:[".abcjs-annotation"],props:["color"],color:"#000000"},{id:"abcjs-author",label:"Author (A:)",selectors:[".abcjs-author"],props:["color"],color:"#000000"},{id:"abcjs-bar",label:"Barlines",selectors:[".abcjs-bar"],props:["color"],color:"#000000"},{id:"abcjs-bar-number",label:"Bar Numbers",selectors:[".abcjs-bar-number"],props:["color"],color:"#000000"},{id:"abcjs-brace",label:"Brace (Grand Staff)",selectors:[".abcjs-brace"],props:["color"],color:"#000000"},{id:"abcjs-bracket",label:"Bracket (Choir)",selectors:[".abcjs-bracket"],props:["color"],color:"#000000"},{id:"abcjs-chord",label:'Chord Symbols ("Am")',selectors:[".abcjs-chord"],props:["color"],color:"#000000"},{id:"abcjs-clef",label:"Clefs",selectors:[".abcjs-clef"],props:["color"],color:"#000000"},{id:"abcjs-composer",label:"Composer (C:)",selectors:[".abcjs-composer"],props:["color"],color:"#000000"},{id:"abcjs-decoration",label:"Decorations",selectors:[".abcjs-decoration"],props:["color"],color:"#000000"},{id:"abcjs-dynamics",label:"Dynamics (p, f)",selectors:[".abcjs-dynamics"],props:["color"],color:"#000000"},{id:"abcjs-key-signature",label:"Key Signatures",selectors:[".abcjs-key-signature"],props:["color"],color:"#000000"},{id:"abcjs-note",label:"Notes/Rests",selectors:[".abcjs-note",".abcjs-beam-elem",".abcjs-stem",".abcjs-rest",".abcjs-slur",".abcjs-tie",".abcjs-legato",".abcjs-triplet"],props:["color"],color:"#000000"},{id:"abcjs-text",label:"Other Text",selectors:[".abcjs-text"],props:["color"],color:"#000000"},{id:"abcjs-part",label:"Part (P:)",selectors:[".abcjs-part"],props:["color"],color:"#000000"},{id:"abcjs-part-order",label:"Part Order (P: in header)",selectors:[".abcjs-part-order"],props:["color"],color:"#000000"},{id:"abcjs-rhythm",label:"Rhythm (R:)",selectors:[".abcjs-rhythm"],props:["color"],color:"#000000"},{id:"abcjs-staff",label:"Staff Lines",selectors:[".abcjs-staff",".abcjs-ledger"],props:["color"],color:"#000000"},{id:"abcjs-staff-extra",label:"Staff Extras (clef/key/time)",selectors:[".abcjs-staff-extra"],props:["color"],color:"#000000"},{id:"abcjs-subtitle",label:"Subtitle (Subsequent T:)",selectors:[".abcjs-subtitle"],props:["color"],color:"#000000"},{id:"abcjs-symbol",label:"Symbols (trill, etc.)",selectors:[".abcjs-symbol"],props:["color"],color:"#000000"},{id:"abcjs-tempo",label:"Tempo (Q:)",selectors:[".abcjs-tempo"],props:["color"],color:"#000000"},{id:"abcjs-defined-text",label:"Text (%%text, %%center, %%right)",selectors:[".abcjs-defined-text"],props:["color"],color:"#000000"},{id:"abcjs-time-signature",label:"Time Signatures (M:)",selectors:[".abcjs-time-signature"],props:["color"],color:"#000000"},{id:"abcjs-title",label:"Title (First T:)",selectors:[".abcjs-title"],props:["color"],color:"#000000"},{id:"abcjs-unaligned-words",label:"Unaligned Lyrics (W:)",selectors:[".abcjs-unaligned-words"],props:["color"],color:"#000000"},{id:"abcjs-voices",label:"Voice #1-8",selectors:[".abcjs-v0",".abcjs-v1",".abcjs-v2",".abcjs-v3",".abcjs-v4",".abcjs-v5",".abcjs-v6",".abcjs-v7"],props:["color"],color:"#000000"},{id:"abcjs-voice-name",label:"Voice Names",selectors:[".abcjs-voice-name"],props:["color"],color:"#000000"},{id:"mark",label:"!mark!, !mark1!, ..., !mark10! ",selectors:[".mark",".mark1",".mark2",".mark3",".mark4",".mark5",".mark6",".mark7",".mark8",".mark9",".mark10"],props:["fill"],color:"#000000"},{id:"push-draw",label:"!push!, !draw!",selectors:[".push",".draw"],props:["fill"],color:"#000000"}],ABCJS_COLOR_STORAGE_KEY="abcjsColors_v1";function getDefaultAbcjsColors(){const e={};for(const t of ABCJS_STYLE_ITEMS)e[t.id]={color:"#000000"};return e}function loadAbcjsColorsFromStorage(){try{const e=localStorage.getItem("abcjsColors_v1");if(!e)return null;const t=JSON.parse(e);return t&&"object"==typeof t?t:null}catch{return null}}function saveAbcjsColorsToStorage(e){try{localStorage.setItem("abcjsColors_v1",JSON.stringify(e))}catch{}}function ensureInitialAbcjsColorsApplied(){if(loadAbcjsColorsFromStorage());else{saveAbcjsColorsToStorage(getDefaultAbcjsColors())}}function buildDeclarations(e,t){return(Array.isArray(e)&&e.length?e:["fill","color"]).map(e=>`${e}:${t} !important;`).join(" ")}function buildAbcjsCss(e){return e=e&&"object"==typeof e?e:{},ABCJS_STYLE_ITEMS.map(t=>{const n=e?.[t.id]?.color||"#000000",o=buildDeclarations(t.props,n);return`${t.selectors.join(", ")} { ${o} }`}).join("\n")}function buildAbcjsCssBlock(e){e=e&&"object"==typeof e?e:{};const t=[];for(const n of ABCJS_STYLE_ITEMS){let o=e?.[n.id]?.color||"#000000";o=String(o).toLowerCase();if(!("#000000"===o||"#000"===o)){const e=buildDeclarations(n.props,o);for(const o of n.selectors)t.push(`${o} { ${e} }`)}}if(0===t.length)return"";return`%%begincss\n/* Created by the abcjs Custom CSS Generator */\n${t.join("\n")}\n%%endcss`}function buildAbcjsEditorHtml(e,t){return`\n  <style>\n    .dp-modal .dp-modal-main { width: 700px !important; max-width: 700px !important; }\n\n    .abcjs_custom_css-theme { font-family: system-ui,-apple-system,Segoe UI,Roboto,sans-serif; font-size: 13px; }\n    .abcjs_custom_css-title { text-align:center; font-size: 24px; margin: 6px 0 24px; }\n\n    .abcjs_custom_css-scroll { max-height: 760px; overflow: auto; border: 1px solid #e5e7eb; border-radius: 8px; background: #fff; }\n    .abcjs_custom_css-head { font-size: 16px; font-weight: 600; color: #111827; text-align:center; }\n\n    .abcjs_custom_css-help {position:absolute; left:10px; top:10px; display:inline-flex; align-items:center; justify-content:center; width:36px; height:36px; font-size:30px; line-height:1; text-decoration:none; color:#111; } \n    .abcjs_custom_css-help:hover { background:#e5e7eb; }\n    .abcjs_custom_css-help:focus { outline:2px solid #2563eb; outline-offset:2px; }\n\n    .abcjs_custom_css-grid-body { padding: 8px; }\n    .abcjs_custom_css-cell.key code { color: #111827; font-family: Helvetica, Arial, sans-serif; font-size: 12pt; }\n\n    .abcjs_custom_css-grid-head {position: sticky; top: 0; z-index: 1; display: grid; grid-template-columns: 45% 55%; column-gap: 6px; align-items: center; padding: 8px; background: #f9fafb; border-bottom: 1px solid #e5e7eb; }\n    .abcjs_custom_css-row {display: grid; grid-template-columns: 45% 55%; align-items: center; gap: 6px; margin: 10px 0; }\n    .abcjs_custom_css-color {width: 96%; height: 45px; padding: 0; border: 1px solid #cfd4dc; border-radius: 6px; }\n    .abcjs_custom_css-actions { display: flex; gap: 30px; justify-content: center; margin-top: 10px; flex-wrap: wrap; }\n\n    .abcjs_custom_css-btn {appearance: none; border: 1px solid #cfd4dc; border-radius: 6px; padding: 8px 14px; background: #fff; cursor: pointer; font-size: 14px; min-width: 180px; transition: background 0.2s ease, color 0.2s ease, box-shadow 0.2s ease; }\n\n    .abcjs_custom_css-btn.primary {background: darkblue; color: #fff; border-color: darkblue; }\n\n    .abcjs_custom_css-btn.restore {background: #111827; color: #fff; border-color: #111827; } \n\n    @media (hover: hover) {\n      .abcjs_custom_css-btn:hover {\n        background: #8888CC;   \n      }\n    }\n\n  </style>\n  <div class="abcjs_custom_css-theme" id="${t}">\n\n    <a class="abcjs_custom_css-help" href="https://michaeleskin.com/abctools/userguide.html#advanced_customcssgenerator" target="_blank" rel="noopener noreferrer" aria-label="ABC Tools User Guide">?</a>\n\n    <div class="abcjs_custom_css-title">abcjs Custom CSS Generator</div>\n\n    <div class="abcjs_custom_css-scroll" id="${t}-scroll">\n      <div class="abcjs_custom_css-grid-head">\n        <div class="abcjs_custom_css-head">abcjs CSS Element</div>\n        <div class="abcjs_custom_css-head">Color</div>\n      </div>\n      <div class="abcjs_custom_css-grid-body">${ABCJS_STYLE_ITEMS.map(t=>{const n=e[`${t.id}_color`]||"#000000";return`<div class="abcjs_custom_css-row">\n      <div class="abcjs_custom_css-cell c1 key"><code>${t.label}</code></div>\n      <div class="abcjs_custom_css-cell c2"><input id="${t.id}_color" type="color" value="${n}" class="abcjs_custom_css-color" /></div>\n    </div>`}).join("")}</div>\n    </div>\n\n    <div class="abcjs_custom_css-actions">\n      <button class="abcjs_custom_css-btn restore" onclick="__abcjsRestoreDefaultsInDialog()">Reset All to Black</button>\n      <button class="abcjs_custom_css-btn primary" onclick="__abcjsSaveAbcjsColorsFromAlert()">Inject Custom CSS</button>\n      <button class="abcjs_custom_css-btn" onclick="__abcjsCancelAlert()">Cancel</button>\n    </div>\n  </div>`}async function abcjsColorEditor(e={}){sendGoogleAnalytics("dialog","CustomCSSGenerator"),ensureInitialAbcjsColorsApplied();const t=loadAbcjsColorsFromStorage()||getDefaultAbcjsColors(),n={};for(const o of ABCJS_STYLE_ITEMS){const a=e&&e[o.id]||t&&t[o.id]||{color:"#000000"};n[`${o.id}_color`]=a.color}const o=`abcjs_custom_css-colors-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,a=buildAbcjsEditorHtml(n,o),l=DayPilot.Modal.alert(a,{width:700,theme:"modal_flat",top:35,scrollWithPage:"function"!=typeof AllowDialogsToScroll||AllowDialogsToScroll()}),r=(e=40)=>{const t=document.getElementById(o);if(!t)return e?setTimeout(()=>r(e-1),25):void 0;const n=t.closest(".modal_flat_main, .dp-modal");if(!n)return e?setTimeout(()=>r(e-1),25):void 0;const a=n.querySelector(".modal_flat_buttons, .dp-modal-buttons"),l=t.querySelector(".abcjs_custom_css-actions, .abc-actions"),i=a&&(a.querySelector(".dp-modal-button-ok")||a.querySelector("button"));if(!a||!l)return e?setTimeout(()=>r(e-1),25):void 0;i&&i.remove(),a.innerHTML="",a.appendChild(l)};r();const i=await l;if(!i||!i.result)return;const{theme:s,css:c,cssBlock:g}=i.result;saveAbcjsColorsToStorage(s);var d=getABCEditorText();d=d.replace(/%%begincss[\s\S]*?%%endcss/gim,"").trim(),setABCEditorText(g?g+"\n\n"+d:d),RenderAsync(!0,null)}window.__abcjsRestoreDefaultsInDialog=function(){for(const e of ABCJS_STYLE_ITEMS){const t=document.getElementById(e.id+"_color");t&&(t.value="#000000")}},window.__abcjsSaveAbcjsColorsFromAlert=function(){const e={};for(const t of ABCJS_STYLE_ITEMS){const n=document.getElementById(t.id+"_color");e[t.id]={color:n?n.value:"#000000"}}const t=buildAbcjsCss(e),n=buildAbcjsCssBlock(e);DayPilot.Modal.close({theme:e,css:t,cssBlock:n})},window.__abcjsCancelAlert=function(){DayPilot.Modal.close(null)};const ABC_THEME_ITEMS=[{id:"cm-abc-header-title",label:"Titles/Subtitles",className:"cm-abc-header-title",color:"#00608a",styleWeight:"bold",sample:"The Kesh"},{id:"cm-abc-header-tag",label:"Header Tags",className:"cm-abc-header-tag",color:"#0000A0",styleWeight:"bold",sample:"X: T: L: M: K:"},{id:"cm-abc-header-val",label:"Header Values",className:"cm-abc-header-val",color:"#444444",styleWeight:"normal",sample:"6/8, G major"},{id:"cm-abc-meta",label:"%% Directives",className:"cm-abc-meta",color:"#5924bc",styleWeight:"bold",sample:"%%MIDI program 0"},{id:"cm-abc-font-directive",label:"Font Directives",className:"cm-abc-font-directive",color:"#7c2243",styleWeight:"normal",sample:"%%font-..."},{id:"cm-abc-comment",label:"Comments",className:"cm-abc-comment",color:"#005231",styleWeight:"italic",sample:"% comment"},{id:"cm-abc-extended-directive",label:"Tool-private Directives",className:"cm-abc-extended-directive",color:"#B00023",styleWeight:"normal",sample:"%soundfont fluid"},{id:"cm-abc-note",label:"Notes and Rests",className:"cm-abc-note",color:"#000000",styleWeight:"normal",sample:"A B c d' e'' z"},{id:"cm-abc-note-prefix",label:"Note Prefixes",className:"cm-abc-note-prefix",color:"#148500",styleWeight:"normal",sample:"~ T P H u v"},{id:"cm-abc-string",label:"Chords",className:"cm-abc-string",color:"#6200a8",styleWeight:"normal",sample:'"Am"  "D"  "G"'},{id:"cm-abc-number",label:"Tuple Numbers",className:"cm-abc-number",color:"#010604",styleWeight:"normal",sample:"(3  (2  (5"},{id:"cm-abc-builtin",label:"Block Chords",className:"cm-abc-builtin",color:"#487830",styleWeight:"normal",sample:"[CEG]  [DFA]"},{id:"cm-abc-bar",label:"Barlines",className:"cm-abc-bar",color:"#006999",styleWeight:"normal",sample:"|| :| [| |]"},{id:"cm-abc-ending",label:"Endings",className:"cm-abc-ending",color:"#006999",styleWeight:"normal",sample:"|1  |2  [1  [2"},{id:"cm-abc-qualifier",label:"!*! Annotations",className:"cm-abc-qualifier",color:"#73160d",styleWeight:"normal",sample:"!p!  !mf!  !trill!"},{id:"cm-abc-operator",label:"Slurs and Ties",className:"cm-abc-operator",color:"#555555",styleWeight:"normal",sample:"( slur )  - tie -"},{id:"cm-abc-abccss",label:"Custom CSS",className:"cm-abc-abccss",color:"#a300a3",styleWeight:"normal",sample:".abcjs-note"}];function buildAbcThemeCss(e){const t=[];for(const n of ABC_THEME_ITEMS){const o=e[n.id]||{color:n.color,styleWeight:n.styleWeight},a="bold"===o.styleWeight?"font-weight:700;":"font-weight:400;",l="italic"===o.styleWeight?"font-style:italic;":"font-style:normal;";t.push(`.${n.className} { color:${o.color} !important; ${a} ${l} }`)}return t.join("\n")}function applyAbcTheme(e){const t=buildAbcThemeCss(e);let n=document.getElementById("abc-theme-style");return n||(n=document.createElement("style"),n.id="abc-theme-style",document.head.appendChild(n)),n.textContent=t,t}window.__abcRestoreDefaultsInDialog=function(){for(const e of ABC_THEME_ITEMS){const t=document.getElementById(e.id+"_color"),n=document.getElementById(e.id+"_style");t&&(t.value=e.color),n&&(n.value=e.styleWeight),__abcUpdatePreview(e.id)}};const ABC_STORAGE_KEY="abcTheme_v2";function getDefaultAbcTheme(){const e={};for(const t of ABC_THEME_ITEMS)e[t.id]={color:t.color,styleWeight:t.styleWeight};return e}function loadAbcThemeFromStorage(){try{const e=localStorage.getItem("abcTheme_v2");if(!e)return null;const t=JSON.parse(e);return t&&"object"==typeof t?t:null}catch{return null}}function saveAbcThemeToStorage(e){try{localStorage.setItem("abcTheme_v2",JSON.stringify(e))}catch{}}function ensureInitialAbcThemeApplied(){const e=loadAbcThemeFromStorage();if(e)applyAbcTheme(e);else{const e=getDefaultAbcTheme();saveAbcThemeToStorage(e),applyAbcTheme(e)}}function __abcRgbToHex(e){if(!e)return null;if(e.startsWith("#"))return 4===e.length?"#"+[...e.slice(1)].map(e=>e+e).join(""):e.slice(0,7);const t=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/i);if(!t)return null;return`#${Number(t[1]).toString(16).padStart(2,"0")}${Number(t[2]).toString(16).padStart(2,"0")}${Number(t[3]).toString(16).padStart(2,"0")}`}function __abcStyleToWeight(e,t){if("italic"===(e||"").toLowerCase())return"italic";const n=String(t||"400");return"bold"===n||parseInt(n,10)>=600?"bold":"normal"}function readCurrentCssTheme(){const e=document.createElement("div");e.style.cssText="position:absolute;left:-99999px;top:-99999px;visibility:hidden;",document.body.appendChild(e);const t={};for(const n of ABC_THEME_ITEMS){const o=document.createElement("span");o.className=n.className,o.textContent="probe",e.appendChild(o);const a=getComputedStyle(o);t[n.id]={color:__abcRgbToHex(a.color)||n.color,styleWeight:__abcStyleToWeight(a.fontStyle,a.fontWeight)||n.styleWeight}}return e.remove(),t}function buildEditorHtml(e,t){return`\n  <style>\n    .dp-modal .dp-modal-main { width: 780px !important; max-width: 780px !important; }\n    .dp-modal .dp-modal-title { text-align: center !important; }\n\n    .abc-theme { font-family: system-ui,-apple-system,Segoe UI,Roboto,sans-serif; font-size: 13px; }\n    .abc-wrap  { width: 740px; margin: 0px -10px; position:relative; }\n    .abc-title { text-align:center; font-size: 24px; margin: 6px 0 24px; }\n\n    .abc-help {\n      position:absolute; left:-11px; top:-16px;\n      display:inline-flex; align-items:center; justify-content:center;\n      width:36px; height:36px;\n      font-size:30px; line-height:1; text-decoration:none; color:#111;\n    }\n    .abc-help:hover { background:#e5e7eb; }\n    .abc-help:focus { outline:2px solid #2563eb; outline-offset:2px; }\n\n    .abc-grid {display:grid; grid-template-columns: 170px 64px 120px 1fr 1fr; column-gap:10px; align-items:center; }\n    .abc-grid-head { margin-bottom: 8px; }\n    .abc-head { font-family: system-ui,-apple-system,Segoe UI,Roboto,sans-serif; font-size: 14px;font-weight:600; color:#111827; padding: 0 2px 2px;}\n\n    .abc-grid-body { row-gap: 8px; }\n    .abc-row { display: contents; }\n\n    .abc-cell.c1 { grid-column:1; }\n    .abc-cell.c2 { grid-column:2; }\n    .abc-cell.c3 { grid-column:3; }\n    .abc-cell.c4 { grid-column:4; }\n    .abc-cell.c5 { grid-column:5; }\n\n    .abc-cell.key { white-space: nowrap; }\n    .abc-cell.key code {font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; font-size: 14px; font-weight: 700; /* bold */ color: #111827; }\n    .abc-color { width: 48px; height: 33px; padding:0; border:1px solid #cfd4dc; border-radius:4px; background:#f9fafb; }\n    .abc-sel   { width: 100%; height:28px; padding:2px 8px; border:1px solid #cfd4dc; border-radius:4px; background:#fff; }\n\n    .abc-preview {padding: 8px 10px; border:1px solid #e5e7eb; white-space:pre-wrap; background:#fff; border-radius:4px; } .abc-invert  { filter: invert(100%); border-radius:10px; background:#fff; }\n\n    .abc-actions { display:flex; gap:32px; justify-content:center; margin-top:14px; flex-wrap:wrap; }\n    .abc-btn { appearance:none; border:1px solid #cfd4dc; border-radius:4px; padding:5px 12px; background:#fff; cursor:pointer; }\n    .abc-btn.primary { background:darkblue; color:#fff; border-color:darkblue; }\n    .abc-btn.ghost {\n      background: #484;         /* darker gray background */\n      color: #fff;              /* white text */\n      border-color: #333;       /* darker border */\n      min-width: 160px;         /* wider button */\n    }\n    @media (hover: hover) {\n      .abc-btn:hover {\n        background: #8888CC;   \n      }\n    }\n    .abc-btn:active { transform: translateY(1px); }\n    .abc-actions .abc-btn { font-size:14px; height:auto; min-height:32px; width:195px; line-height:1.2; white-space:nowrap; }\n    .modal_flat_buttons .abc-actions, .dp-modal-buttons .abc-actions { margin-top:0; }\n  </style>\n\n  <div class="abc-theme abc-wrap" id="${t}">\n    <a class="abc-help" href="https://michaeleskin.com/abctools/userguide.html#customthemeeditor" target="_blank" rel="noopener noreferrer" aria-label="ABC Tools User Guide">?</a>\n\n    <div class="abc-title">ABC Syntax Highlighting Theme Editor</div>\n\n    <div class="abc-grid abc-grid-head">\n      <div class="abc-head">&nbsp;</div>\n      <div class="abc-head">Color</div>\n      <div class="abc-head">Style</div>\n      <div class="abc-head">Light Mode</div>\n      <div class="abc-head">Dark Mode</div>\n    </div>\n\n    <div class="abc-grid abc-grid-body">\n      ${ABC_THEME_ITEMS.map(t=>{const n=e[`${t.id}_color`]??t.color,o=e[`${t.id}_style`]??t.styleWeight,a="bold"===o?"700":"400",l="italic"===o?"italic":"normal";return`\n      <div class="abc-row">\n        <div class="abc-cell c1 key"><code>${t.label}</code></div>\n        <div class="abc-cell c2">\n          <input id="${t.id}_color" type="color" value="${n}" class="abc-color"\n                 oninput="__abcUpdatePreview('${t.id}')" />\n        </div>\n        <div class="abc-cell c3">\n          ${((e,t)=>`<select id="${e}" class="abc-sel" onchange="__abcUpdatePreview('${e.replace("_style","")}')">\n      <option value="normal"${"normal"===t?" selected":""}>Normal</option>\n      <option value="bold"${"bold"===t?" selected":""}>Bold</option>\n      <option value="italic"${"italic"===t?" selected":""}>Italic</option>\n     </select>`)(`${t.id}_style`,o)}\n        </div>\n        <div class="abc-cell c4 preview">\n          <div id="${t.id}_prev_normal"\n               class="abc-preview"\n               style="color:${n};font-weight:${a};font-style:${l};">${t.sample}</div>\n        </div>\n        <div class="abc-cell c5 preview">\n          <div class="abc-invert">\n            <div id="${t.id}_prev_invert"\n                 class="abc-preview"\n                 style="color:${n};font-weight:${a};font-style:${l};">${t.sample}</div>\n          </div>\n        </div>\n      </div>\n    `}).join("")}\n    </div>\n\n    \x3c!-- Will be moved into THIS modal's footer --\x3e\n    <div class="abc-actions">\n      <button class="abc-btn ghost" onclick="__abcRestoreDefaultsInDialog()">Restore Defaults</button>\n      <button class="abc-btn primary" onclick="__abcSaveThemeFromAlert()">Apply and Save Theme</button>\n      <button class="abc-btn" onclick="__abcCancelAlert()">Cancel</button>\n    </div>\n  </div>`}async function customThemeEditor(e={}){sendGoogleAnalytics("dialog","CustomThemeEditor"),ensureInitialAbcThemeApplied();const t=readCurrentCssTheme(),n={};for(const o of ABC_THEME_ITEMS){const a=t[o.id]||e[o.id]||{color:o.color,styleWeight:o.styleWeight};n[`${o.id}_color`]=a.color,n[`${o.id}_style`]=a.styleWeight}const o=`abc-theme-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,a=buildEditorHtml(n,o),l=DayPilot.Modal.alert(a,{width:780,theme:"modal_flat",top:15,scrollWithPage:"function"!=typeof AllowDialogsToScroll||AllowDialogsToScroll()}),r=(e=30)=>{const t=document.getElementById(o);if(!t)return e?setTimeout(()=>r(e-1),25):void 0;const n=t.closest(".modal_flat_main, .dp-modal");if(!n)return e?setTimeout(()=>r(e-1),25):void 0;const a=n.querySelector(".modal_flat_buttons, .dp-modal-buttons"),l=t.querySelector(".abc-actions"),i=a&&(a.querySelector(".dp-modal-button-ok")||a.querySelector("button"));if(!a||!l)return e?setTimeout(()=>r(e-1),25):void 0;i&&i.remove(),a.innerHTML="",a.appendChild(l)};r();const i=await l;if(!i||!i.result)return null;const{theme:s}=i.result;return saveAbcThemeToStorage(s),applyAbcTheme(s),i.result}function cm_preserveScroll(){return gTheCM.getScrollInfo()}function cm_restoreScroll(e){gTheCM.scrollTo(e.left,e.top),gTheCM.scrollIntoView(gTheCM.getCursor(),50)}function setupStableManualPaste(e){const t=e.getWrapperElement(),n=e.getInputField();function o(t){const n=t.clipboardData||window.clipboardData;if(!n)return;var o=n.getData("text/plain");if(null==o)return;var a=!1;-1!==o.indexOf("X:")&&(a=!0),o=CleanSmartQuotes(o),gIsDirty=!0,gIsIOS&&(o=FixIOS17(o)),a&&setTimeout(function(){RenderAsync(!0,null)},250),t.preventDefault(),"function"==typeof t.stopImmediatePropagation&&t.stopImmediatePropagation(),t.stopPropagation();const l=function(){const t=e.getScrollInfo();return{left:t.left,top:t.top,sels:e.listSelections(),hadFocus:e.hasFocus()}}();e.hasFocus()||e.focus(),e.operation(()=>{const t=l.sels&&l.sels.length?l.sels:e.listSelections();if(t.length>1){const n=new Array(t.length).fill(o);e.replaceSelections(n,"end","paste-manual")}else e.replaceSelections([o],"end","paste-manual")}),function(t){requestAnimationFrame(()=>{e.refresh(),requestAnimationFrame(()=>{e.scrollTo(t.left,t.top);const n=e.getScrollInfo(),o=e.charCoords(e.getCursor(),"local");(o.top<n.top+50||o.bottom>n.top+n.clientHeight-50)&&e.scrollIntoView(e.getCursor(),50),t.hadFocus&&e.focus()})})}(l)}t.addEventListener("paste",o,!0),n.addEventListener("paste",o,!0)}function isDesktopSafari(){const e=navigator.userAgent,t=/^((?!chrome|crios|fxios|android|edg|firefox).)*safari/i.test(e),n=/Mac/.test(navigator.platform)||/Mac OS X/.test(e),o=(navigator.maxTouchPoints||0)>1;return t&&n&&!o}function installEditorSelectionBehavior(){const e=document.getElementById("cm-selection-policy");e&&e.remove();const t=document.createElement("style");t.id="cm-selection-policy",isPureDesktopBrowser()?t.textContent="\n      /* Hide native selection overlay so CM's layer is visible */\n      .CodeMirror ::selection,\n      .CodeMirror *::selection { background: transparent !important; color: inherit !important; }\n      .CodeMirror ::-moz-selection,\n      .CodeMirror *::-moz-selection { background: transparent !important; color: inherit !important; }\n\n      /* Make CM's selection visible */\n      .CodeMirror .CodeMirror-selected {\n        background: rgba(90,150,255,0.35) !important;\n      }\n    ":t.textContent="",document.head.appendChild(t)}function fixSafariGhostSelection(e){const t=/Mac/.test(navigator.platform),n=/^((?!chrome|crios|fxios|android).)*safari/i.test(navigator.userAgent);if(!t||!n)return;const o=e.getWrapperElement();function a(){o.style.webkitTransform="translateZ(0)",o.offsetHeight,o.style.webkitTransform=""}e.on("beforeSelectionChange",()=>{requestAnimationFrame(a)})}function setCodeMirrorSelectionColor(e,t){if(!isPureDesktopBrowser()){const e=document.getElementById("cm-selection-style");return void(e&&e.remove())}const n=document.getElementById("cm-selection-style");if(n&&n.remove(),!e||!t)return;const o=document.createElement("style");o.id="cm-selection-style",o.textContent=`\n    .CodeMirror-selected { background: ${e} !important; }\n    .CodeMirror-focused .CodeMirror-selected { background: ${t} !important; }\n  `,document.head.appendChild(o)}function setCMDarkMode(e,t){const n=gTheCM.getWrapperElement(),o=gTheCM.getScrollerElement();gSyntaxDarkMode?(n.style.backgroundColor=e,o.style.filter="invert(100%)",o.style.backgroundColor=e,isPureDesktopBrowser()?setCodeMirrorSelectionColor("#808050","#808050"):setCodeMirrorSelectionColor()):(n.style.backgroundColor=t,o.style.filter="",o.style.backgroundColor=t,setCodeMirrorSelectionColor())}function wireClickish(e,t){const n=e.getScrollerElement(),o=debounce(t=>{if(isPureDesktopBrowser()&&t.altKey){const t=e.getValue(),n=e.indexFromPos(e.getCursor("from"));let o=t.lastIndexOf("\nX:",n);-1===o?o=t.indexOf("X:",0):o++,-1===o&&(o=0);const a=t.indexOf("\n\n",n),l=t.indexOf("X:",n);let r;r=-1===a&&-1===l?t.length:-1===a?l:-1===l?a:Math.min(a,l),e.setSelection(e.posFromIndex(o),e.posFromIndex(r))}MakeTuneVisible(!1),fireSelectionChanged()},t);e.on("mousedown",(e,t)=>{t.target&&t.target.closest(".CodeMirror-gutters")||o(t)});let a=0,l=!1;n.addEventListener("touchstart",()=>{a=Date.now(),l=!1},{passive:!0}),n.addEventListener("touchmove",()=>{l=!0},{passive:!0}),n.addEventListener("touchend",e=>{const t=Date.now()-a;l||t>500||o(e)},{passive:!0}),n.addEventListener("pointerup",e=>{"touch"===e.pointerType&&o(e)},{passive:!0})}function wireAbcDragDrop(){const e=gTheCM.getWrapperElement();if(gTheCM.setOption("dragDrop",!1),isPureDesktopBrowser()){e.addEventListener("dragover",function(t){t.preventDefault(),t.stopPropagation(),t.dataTransfer&&(t.dataTransfer.dropEffect="copy"),e.classList.add("indrag")}),e.addEventListener("dragenter",function(t){e.classList.add("indrag")}),e.addEventListener("dragleave",function(t){e.classList.remove("indrag")}),e.addEventListener("drop",function(t){t.preventDefault(),t.stopPropagation(),e.classList.remove("indrag"),DoDrop(t)}),e.addEventListener("dragstart",e=>e.preventDefault())}else{gTheCM.setOption("placeholder","Enter the ABC for your tunes here");const t=document.getElementById("desktop_use_message");t&&(t.style.display="none"),e.addEventListener("dragstart",e=>e.preventDefault())}}function setCMFont(e,t,n){let o=gTheCM.getWrapperElement();o.style.fontSize=t+"pt",o.style.lineHeight=n+"pt",e.refresh()}function setCodeMirrorRows(e,t){const n=e.getWrapperElement(),o=parseFloat(getComputedStyle(n).lineHeight)||16;n.style.height=t*o+"px",e.refresh()}function setCMRows(e,t){const n=e.getWrapperElement(),o=e.defaultTextHeight();n.style.height=t*o+"px",e.refresh()}function addTextareaSelectionShim(e){Object.defineProperties(e,{selectionStart:{get:()=>e.indexFromPos(e.getCursor("from")),set(t){let n=e.posFromIndex(t);e.setCursor(n)}},selectionEnd:{get:()=>e.indexFromPos(e.getCursor("to")),set(t){let n=e.posFromIndex(e.selectionStart),o=e.posFromIndex(t);e.setSelection(n,o)}}}),e.setSelectionRange=function(t,n){let o=e.posFromIndex(t),a=e.posFromIndex(n);e.setSelection(o,a)}}function initCodeMirror(){!function(){var e=document.getElementById("abc");if(e){var t,n="abc-plus",o=gSyntaxViewportMargin;gEnableSyntax||(n=null),t=gEnableSyntax?CodeMirror.fromTextArea(e,{lineWrapping:!0,lineNumbers:!1,gutters:["abc-line-gutter"],mode:n,viewportMargin:o,inputStyle:isMobileBrowser()?"contenteditable":"textarea"}):CodeMirror.fromTextArea(e,{lineWrapping:!0,lineNumbers:!1,gutters:["abc-line-gutter"],mode:null,inputStyle:isMobileBrowser()?"contenteditable":"textarea"}),window.gTheCM=t,installEditorSelectionBehavior(),setCMDarkMode(gDarkModeColor,gLightModeColor);var a=l(t.getDoc());t.on("changes",function(){s._raf&&cancelAnimationFrame(s._raf),s._raf=requestAnimationFrame(s)}),t.on("viewportChange",function(){c._raf&&cancelAnimationFrame(c._raf),c._raf=requestAnimationFrame(c)}),window.addEventListener("resize",()=>requestAnimationFrame(g)),new ResizeObserver(()=>g()).observe(t.getWrapperElement()),s(),addTextareaSelectionShim(t),fixSafariGhostSelection(t),setupStableManualPaste(gTheCM),setTimeout(()=>{captureEditorBaselines()},0)}else console.error("Textarea #abcEditor not found");function l(e){for(var t=e.lineCount(),n=new Array(t),o=!1,a=0,l=/^\s*X\s*:/i,r=!1,i=0;i<t;i++){var s=e.getLine(i)||"";l.test(s)?(o=!0,r=!1,a=1,n[i]=a):o?/^\s*$/.test(s)?(r=!0,n[i]=null):r?n[i]=null:(a++,n[i]=a):n[i]=null}return n}function r(e){if(null==e)return document.createTextNode("");var t=document.createElement("div");return t.className="abc-ln",t.textContent=e,t}function i(e,n){t.operation(function(){for(var o=e;o<=n;o++)t.setGutterMarker(o,"abc-line-gutter",r(a[o]))})}function s(){a=l(t.getDoc()),i(0,t.lineCount()-1)}function c(){var e=t.getViewport();i(Math.max(0,e.from-50),Math.min(t.lineCount()-1,e.to+50))}function g(){t.refresh(),c()}}()}function WaitForReady(e){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}window.__abcApplyPreviewStyle=function(e,t,n){e&&(e.style.color=t||"",e.style.fontWeight="bold"===n?"700":"400",e.style.fontStyle="italic"===n?"italic":"normal")},window.__abcUpdatePreview=function(e){const t=document.getElementById(e+"_color")?.value,n=document.getElementById(e+"_style")?.value;__abcApplyPreviewStyle(document.getElementById(e+"_prev_normal"),t,n),__abcApplyPreviewStyle(document.getElementById(e+"_prev_invert"),t,n)},window.__abcSaveThemeFromAlert=function(){const e={};for(const t of ABC_THEME_ITEMS)e[t.id]={color:document.getElementById(t.id+"_color").value,styleWeight:document.getElementById(t.id+"_style").value};const t=buildAbcThemeCss(e);DayPilot.Modal.close({theme:e,css:t})},window.__abcCancelAlert=function(){DayPilot.Modal.close(null)},CodeMirror.defineMode("abc-plus",function(){const e=/^(?:\^{1,2}|_{1,2}|=)?[A-Ga-g](?:[,']+)?(?:\d+(?:\/\d+)?|\/\d+|\/\/|\/)?/,t=/^[zx](?:\d+\/?\d*|\/\d+|\/)?/i,n=/^\(\d+/,o=/^(?:!(?:[^!\n]+)!|\+(?:[^+\n]+)\+)/;function a(e){let t=e.pos,n=e.string;for(;t<n.length&&/\s/.test(n.charAt(t));)t++;return t<n.length&&/\d/.test(n.charAt(t))}return{startState:()=>({inCss:!1,wantEndingDigits:!1,inHeaderVal:!1,inTitleVal:!1}),token(l,r){if(r.inCss)return l.sol()&&l.match(/^\s*%%endcss\b.*$/i)?(r.inCss=!1,"abc-meta"):(l.skipToEnd(),"abc-abccss");if(l.sol()){if(l.match(/^\s*%%begincss\b.*$/i))return r.inCss=!0,"abc-meta";if(l.match(/^\s*%%(?:gchordfont|partsfont|tripletfont|vocalfont|textfont|annotationfont|historyfont|infofont|measurefont|repeatfont|wordsfont|composerfont|titlefont|subtitlefont|tempofont|voicefont|headerfont|tablabelfont|tabnumberfont|tabgracefont|barlabelfont|barnumberfont|barnumfont)\b.*$/i))return"abc-font-directive";if(l.match(/^\s*%%[A-Za-z].*$/))return"abc-meta"}if(l.sol()&&l.match(/^%(?:pdfquality|pdf_between_tune_space|pdfname|pdffont|addtitle|addsubtitle|urladdtitle|urladdsubtitle|titlefontsize|subtitlefontsize|titlelinespacing|subtitlelinespacing|addtoc|addsortedtoc|addlinkbacktotoc|tocheader|toctopoffset|toctitleoffset|toctitlefontsize|tocfontsize|toclinespacing|addindex|addsortedindex|addlinkbacktoindex|indexheader|indextopoffset|indextitleoffset|indextitlefontsize|indexfontsize|indexlinespacing|no_toc_or_index_links|toc_no_page_numbers|index_no_page_numbers|firstpagenumber|pagenumberhoffset|pagenumbervoffset|pageheader|pagefooter|headerfooterfontsize|headervoffset|footervoffset|urlpageheader|urlpagefooter|textincipitsfontsize|textincipitslinespacing|add_all_links_to_thesession|add_all_playback_links|add_all_playback_volumes|playback_links_are_complete_tunebook|add_all_fonts|swing_all_hornpipes|noswing_all_hornpipes|no_edit_allowed|links_open_in_editor|qrcode|caption_for_qrcode|abcjs_soundfont|soundfont|hyperlink|add_link_to_thesession|add_playback_link|swing|swing_offset|noswing|bodhran_tuning|bodhran_pitch|banjo_style|grace_duration_ms|roll_2_params|roll_3_params|use_original_abcjs_roll_solution|abcjs_release_decay_time|use_custom_gm_sounds|disable_play_highlight|play_highlight_v1_only|irish_rolls_on|irish_rolls_off|voice_tuning_cents|tab_first_voice_only|tab_first_voice_exclude|reverb|ornament_divider|ornament_offset|tremolo_divider|play_flatten_parts|allow_lowercase_chords|hide_first_title_on_play|hide_vskip_on_play|hide_information_labels|hide_rhythm_tag|hide_composer_tag|hide_part_tags|hide_player_part_tags|hide_dynamics|hide_cautionary_ks|left_justify_titles|no_title_reverser|whistle_tab_key|whistle_tab_octave|recorder_tab_key|recorder_tab_octave|enable_hyperlinks|disable_hyperlinks|play_alternate_chords|force_power_chords|custom_instrument_volume_scale|custom_instrument_[1-8]_volume_scale|custom_instrument_fade|custom_instrument_[1-8]_fade|abcjs_render_params|tocleftoffset|tocrightoffset|indexleftoffset|indexrightoffset|pdf_notation_width|pdf_left_margin|toc_index_backlink_vpos|pdf_notation_percent_width)\b.*/i))return"abc-extended-directive";if("%"===l.peek())return l.skipToEnd(),"abc-comment";if(l.eatSpace())return null;if(r.inTitleVal)return r.inTitleVal=!1,l.skipToEnd(),"abc-header-title";if(r.inHeaderVal)return r.inHeaderVal=!1,l.skipToEnd(),"abc-header-val";if(l.sol()&&l.match(/^\s*T\s*:\s*/))return r.inTitleVal=!0,"abc-header-tag";if(l.sol()&&l.match(/^\s*[A-Za-z]\s*:\s*/))return r.inHeaderVal=!0,"abc-header-tag";if(r.wantEndingDigits){if(l.eatWhile(/\s/),l.match(/^\d+\b/))return r.wantEndingDigits=!1,"abc-ending";r.wantEndingDigits=!1}return l.match(/^\[[A-Za-z]\s*:[^\]\n]*\]/)?"abc-header-tag":l.match(/^\[(\d+)\b/)?"abc-ending":l.match(/^::/)||l.match(/^\|\]/)||l.match(/^\[\|/)?"abc-bar":l.match(/^\|:/)||l.match(/^:\|/)||l.match(/^\|\|/)||l.match(/^\|/)?(r.wantEndingDigits=a(l),"abc-bar"):l.match(/^"[^"\n]*"/)?"abc-string":l.match(/^\[(?:\^{1,2}|_{1,2}|=)?[A-Ga-g][^\]\n]*\]/)?"abc-builtin":l.match(o)?"abc-qualifier":l.match(/^\{[^}\n]*\}/)?"abc-meta":l.match(n)?"abc-number":l.match(t)?"abc-note":l.match(/^([.\~uvHJjLMOPRSTt]+)(?=(?:\^{1,2}|_{1,2}|=)?[A-Ga-g])/)?"abc-note-prefix":l.match(e)?"abc-note":l.match(/^[-()]/)?"abc-operator":l.match(/^\\$/)?"abc-meta":(l.next(),null)},lineComment:"%"}}),WaitForReady(DoStartup);