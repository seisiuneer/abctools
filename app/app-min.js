var gInitialTextBoxWidth,gInitialTextBoxContainerWidth,gInitialTextBoxContainerLeft,pdf,gOriginalWidthBeforePDFExport,gDialogRenderingFonts,gVersionNumber="0055_160724_1700",gMIDIInitStillWaiting=!1,gShowAdvancedControls=!1,gStripAnnotations=!1,gStripTextAnnotations=!1,gStripChords=!1,gStripTab=!1,gStripOrnaments=!1,STAFFSPACEMIN=0,STAFFSPACEDEFAULT=10,STAFFSPACEMAX=200,STAFFSPACEOFFSET=40,gStaffSpacing=STAFFSPACEOFFSET+STAFFSPACEDEFAULT,gIsIOS=!1,gIsIPad=!1,gIsIPhone=!1,gIsSafari=!1,gIsChrome=!1,gIsAndroid=!1,gRenderingPDF=!1,gTheQRCode=null,MAXQRCODEURLLENGTH=2300,ALLTITLESMAXLENGTH=70,HEADERFOOTERFONTSIZE=12,QRCODECAPTIONPDFFONTSIZE=12,gShowShareControls=!1,gAllowSave=!1,gAllowURLSave=!1,gAllowQRCodeSave=!1,gShowAllControls=!1,gAllowControlToggle=!1,gAllowFilterAnnotations=!1,gAllowFilterText=!1,gAllowFilterChords=!1,gAllowFilterTab=!1,gAllowFilterOrnaments=!1,gCapo=0,gIsMaximized=!1,gABCFromFile=!1,gAllowCopy=!1,gAllowPDF=!1,gDisplayedName="",gShowTabNames=!0,gAllowShowTabNames=!1,gWhistleFontPrepared=!1,DEBOUNCEMS=280,AUTOSCROLLDEBOUNCEMS=250,gLastAutoScrolledTune=-1,gLastClickedTune=-1,gTopBarShowing=!0,gCurrentTune=0,gTotalTunes=0,gCurrentTab="noten",gForceFullRender=!1,gIsFirstRender=!0,gIsOneColumn=!0,gGotRenderDivClick=!1,gRenderDivClickOffset=-1,gLocalStorageAvailable=!1,gPDFQuality=.75,gQualitaet=1200,gPDFFont="Times",gPDFFontStyle="",gPDFOrientation="portrait",gPDFPaperSize="letter",gPageWidth=535,gRenderPixelRatio=2,gIncludePageLinks=!0,gDoForcePDFFilename=!1,gForcePDFFilename="",gAddTOCLinkback=!1,gAddIndexLinkback=!1,gTuneHyperlinks=[],gAddTheSessionHyperlinks=!1,gAddPlaybackHyperlinks=!1,gAddPlaybackHyperlinksIncludePrograms=!1,gPlaybackHyperlinkMelodyProgram="",gPlaybackHyperlinkBassProgram="",gPlaybackHyperlinkChordProgram="",gAddPlaybackHyperlinkVolumes=!1,gPlaybackHyperlinkBassVolume="",gPlaybackHyperlinkChordVolume="",gPlaybackHyperlinkSoundFont="",gAddTunebookPlaybackHyperlinks=!1,gAddAllFonts=!1,gInjectEditDisabled=!1,gDisableEditFromPlayLink=!1,gFullScreenScaling=50,gAngloButtonNames=[],gRenderingFonts={titlefont:"Palatino 18",subtitlefont:"Palatino 13",infofont:"Palatino 13",partsfont:"Palatino 13",tempofont:"Palatino 13",textfont:"Palatino 13",composerfont:"Palatino 13",annotationfont:"Palatino 13",gchordfont:"Verdana 12",vocalfont:"Palatino 13",wordsfont:"Palatino 13",tablabelfont:"Trebuchet MS 14",tabnumberfont:"Arial 12",tabgracefont:"Arial 8",historyfont:"Times New Roman 14",voicefont:"Times New Roman 13"},gMP3Bitrate=224,gDefaultSoundFont="https://paulrosen.github.io/midi-js-soundfonts/FluidR3_GM/",gTheActiveSoundFont=gDefaultSoundFont,gDefaultBodhranPitch="a",gTheActiveBodhranPitch=gDefaultBodhranPitch,gDefaultBanjoStyle="2",gTheActiveBanjoStyle=gDefaultBanjoStyle,gOnlyHighlightV1=!1,gDisablePlayHighlight=!1,gVoiceTuning=null,gAutoscrollPlayer=!0,gAutoSwingHornpipes=!0,gAutoSwingFactor=.25,gAllSwingHornpipesRequested=!1,gAllSwingHornpipesSwingFactor=.25,gAllNoSwingHornpipesRequested=!1,gUseCustomGMSounds=!0,gOverrideCustomGMSounds=!1,gCustomGMSoundsOverride=!1,gTipJarCount=0,gSaveLastAutoSnapShot=!1,gIncipitsColumns=1,gUseComhaltasABC=!1,gZoomBannerHidden=!1,gForceInitialTextBoxRecalc=!1,gGotWindowResizeWhileMaximized=!1,gNotationLeftMarginBeforeMaximize="auto",gTheNotation=document.getElementById("notation-holder"),gAllowMIDIInput=!1,gMIDIChromatic=!1,gIsFromShare=!1,gIsDirty=!1,gIsFirstRun=!1,gAllowRawMode=!1,gRawMode=!1,gRawVisual=null,gRawIsDragging=!1,gRawLastIndex=-1,gRawFirstTime=!0,gRawHighlightColor="#F00000",gPlayerStatusOnLeft=!1,gRoll2DefaultParams="0.95 0.8 1.0 0.75 0.9 1.0 0.75 1.0",gRoll3DefaultParams="1.45 0.6 1.0 0.75 0.9 1.0 0.75 1.0",gDisableNotationRendering=!1,gDisableSelectedPlay=!1,gMixedNotationAndQRCode=!1,gFeaturesShowSearch=!0,gFeaturesShowExamples=!0,gFeaturesShowTemplates=!0,gFeaturesShowTablatures=!0,gFeaturesShowExplorers=!0,gFeaturesShowTabButtons=!0,gFeaturesShowCompliance=!1,gFeaturesShowBagpipeDrones=!0,gForceTabSave=!1,gABCEditorFontsize=13,gShowDiagnostics=!1,gShowABCJSRenderProgress=!1,gReverbString="chamber 0.95 0.05",gDoTinyURLAPIKeyOverride=!1,gTinyURLAPIKeyOverride="",gTinyURLCount=0,gMIDIImportWarned=!1,gShowDGDAETab=!1,gShowCGDATab=!1,gConfirmClear=!0,gOpenInEditor=!1,gTheABC=document.getElementById("abc"),gPDFFormat="one",gPageNumbers="none",gFirstPage="yes";function setPDFFormat(t){gPDFFormat=t}function getPDFFormat(){return gPDFFormat}function setPageNumbers(t){gPageNumbers=t}function getPageNumbers(){return gPageNumbers}function setFirstPage(t){gFirstPage=t}function getFirstPage(){return gFirstPage}function isMultiVoiceTune(t){let n=t.split("\n"),o=new Set,a=/^V:\s*(\S+)/;for(let r of n){let l=r.match(a);l&&o.add(l[1])}return o.size>1}function getTuneTitle(t){var n=escape(t),o=n.split("%0D%0A");o=n.split("%0A");for(var a="",r=0;r<o.length;++r){o[r]=unescape(o[r]);var l=o[r].split("");if("T"==l[0]&&":"==l[1])return(a=o[r].slice(2)).trim()}return"No Title"}function stripAllABCTuneHeaders(t){let n=t.replace(/^(X:|T:|M:|K:|L:|Q:|W:|Z:|R:|C:|A:|O:|P:|N:|G:|H:|B:|D:|F:|S:|I:|:[A-Za-z]:)[^\r\n]*\r?\n?/gm,"");return n}function removeABCTuneHeaders(t){var n,o,a,r,l="XTMKLQWZRCAOPNGHBDFSI",s=l.length,g="",c=t.split("\n"),d=!0;for(o=0;o<c.length;++o){if(d){for(n=0,a=c[o].split(""),r=!1;n<s;++n)if("%"==a[0]||a[0]==l[n]&&":"==a[1]){r=!0;break}}r||(d=!1,g+=c[o],o==c.length-1||(g+="\n"))}return g}function isSectionHeader(t){var n=t.match(/^T:\s*\*.*$/m);return!!n&&!!(n.length>0)}function findTuneOffsetByIndex(t){var n=gTheABC.value;if(0==t){var o=n.search(/^X:.*[\r\n]*/m);return -1==o?0:o}for(var a=n.split(/^X:/gm),r=a[0].length,l=1;l<=t;++l)r+=a[l].length+2;return r}function findTuneByOffset(t){var n=gTheABC.value.split(/^X:/gm),o=n.length,a=0;a=n[0].length;for(var r=1;r<o;++r)if(t<(a+=n[r].length+2))return r-1;return o-2}function getTuneByIndex(t){return"X:"+gTheABC.value.split(/^X:/gm)[t+1]}function getSelectedText(t){var n=document.getElementById(t),o=n.selectionStart,a=n.selectionEnd;return n.value.substring(o,a)}function findSelectedTune(){var t=gTheABC.value,n=gTheABC.selectionStart;if(0==n&&(n=t.indexOf("X:")+2),0==n)return"";var o=t.length;n==o&&(n=o-1);var a=t.split(/^X:/gm),r=a.length,l=0;l=a[0].length;for(var s=1;s<r;++s)if(n<(l+=a[s].length+2)){var g="X:"+a[s];return g.trimEnd()}return""}function GetFirstTuneTitle(){for(var t="",n=gTheABC.value,o=(n=escape(n)).split("%0A"),a=0;a<o.length;++a){o[a]=unescape(o[a]);var r=o[a].split("");if("T"==r[0]&&":"==r[1]){t=(t=(t=(t=(t=o[a].slice(2)).trim()).replace(/[^a-zA-Z0-9_\-. ]+/ig,"")).replace(/\s/g,"_")).replace(/\'/g,"_");break}}return t}function CountTunes(){var t=gTheABC.value.split(/^X:.*$/gm).length-1;return gTotalTunes=t,t}function GetAllTuneTitles(){var t=[],n=escape(gTheABC.value),o=n.split("%0D%0A");for(i=0,o=n.split("%0A");i<o.length;++i){o[i]=unescape(o[i]);var a=o[i].split("");if("T"==a[0]&&":"==a[1]){var r=o[i].slice(2);r=r.trim(),t.push(r)}}var l=t.length,s="";if(l>0)for(i=0;i<l;++i){if((s+=t[i]).length>ALLTITLESMAXLENGTH){var g=l-i-1;g>0&&(s=s+" + "+g+" more");break}i!=l-1&&(s+=" / ")}return s}function SetupRawModeUI(){if(gRawMode=!1,gRawLastIndex=-1,gAllowRawMode){var t=document.getElementById("rawmodebutton");t.value="Highlighting Off",gTheABC.style.backgroundColor="white",t.classList.remove("rawmodebutton"),t.classList.add("rawmodebuttondisabled"),t.classList.add("btn-rawmode-off"),t.classList.remove("btn-rawmode-on")}else{var t=document.getElementById("rawmodebutton");t.value="Highlighting Off",t.classList.remove("rawmodebutton"),t.classList.add("rawmodebuttondisabled"),t.classList.add("btn-rawmode-off"),t.classList.remove("btn-rawmode-on"),gTheABC.style.backgroundColor="white"}}function ShowHighlightingExplanation(){sendGoogleAnalytics("dialog","ShowHighlightingExplanation");var t='<p style="text-align:center;font-size:18pt;font-family:helvetica">About Highlighting</p>';t+='<p style="font-size:14pt;line-height:22pt;font-family:helvetica">Since this is your first time using Highlighting, here is some important information:</p>',t+='<p style="font-size:14pt;line-height:22pt;font-family:helvetica">When Highlighting is turned on:</p>',t+='<p style="font-size:14pt;line-height:22pt;font-family:helvetica">Select ABC text to highlight the corresponding notes in red in the notation.</p>',t+='<p style="font-size:14pt;line-height:22pt;font-family:helvetica">Click any element in the notation to select the corresponding ABC text in the editor.</p>',t+='<p style="font-size:14pt;line-height:22pt;font-family:helvetica">Highlighting requires redrawing all tunes on each change to the ABC.</p>',t+='<p style="font-size:14pt;line-height:22pt;font-family:helvetica">This may be slow on large numbers of tunes.</p>',t+='<p style="font-size:14pt;line-height:22pt;font-family:helvetica">All pre-processing of the ABC at notation drawing time is turned off. Any hiding of Annotations/Text/Chords selected in the Advanced dialog as well as automatic injection of staff separation space will be disabled. Your settings will be restored when you turn highlighting off.</p>',DayPilot.Modal.alert(t,{theme:"modal_flat",top:50,scrollWithPage:AllowDialogsToScroll()})}function ToggleRawMode(){if(gDisableNotationRendering){var t="Highlighting not possible with rendering disabled.";t=makeCenteredPromptString(t),DayPilot.Modal.alert(t,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});return}if(!isMobileBrowser()&&0!=CountTunes()){gRawMode=!gRawMode;var n=document.getElementById("rawmodebutton");gRawLastIndex=-1,gRawMode?(gRawFirstTime&&(ShowHighlightingExplanation(),gRawFirstTime=!1,SaveConfigurationSettings()),n.value="Highlighting On",n.classList.add("btn-rawmode-on"),n.classList.remove("btn-rawmode-off"),gTheABC.style.backgroundColor="#F8FDF8"):(n.value="Highlighting Off",n.classList.add("btn-rawmode-off"),n.classList.remove("btn-rawmode-on"),gTheABC.style.backgroundColor="white"),RenderAsync(!0,null)}}function getTuneRangeForTranspose(){var t=gTheABC.value,n=gTheABC,o=n.selectionStart;0==o&&(o=t.indexOf("X:")+2);var a=n.selectionEnd;0==a&&(a=t.indexOf("X:")+2);var r=findTuneByOffset(o),l=findTuneByOffset(a);return{start:r,end:l}}function resetSelectionAfterTranspose(t,n){var o=findTuneOffsetByIndex(t),a=getTuneByIndex(n),r=findTuneOffsetByIndex(n)+(a.length-1);gTheABC.selectionStart=o,gTheABC.selectionEnd=r,FocusAfterOperation()}function ShowTransposeWarningDialog(t){sendGoogleAnalytics("dialog","ShowTransposeWarningDialog");var n='<p style="text-align:center;font-size:18pt;font-family:helvetica;">Some Tunes Were Not Tranposed</p>';n+='<p style="font-size:12pt;line-height:18pt;margin-top:36px;">During the operation some tunes were not able to be transposed:</p>';for(var o=t.length,a=0;a<o;++a)n+='<p style="font-size:12pt;line-height:12pt;">',n+=t[a],n+="</p>";DayPilot.Modal.alert(n,{theme:"modal_flat",top:100,width:630,scrollWithPage:AllowDialogsToScroll()})}function Transpose(t){if(gDisableNotationRendering){var n="Transpose not possible with rendering disabled.";n=makeCenteredPromptString(n),DayPilot.Modal.alert(n,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});return}if(!gRenderingPDF){sendGoogleAnalytics("action","Transpose");var o=CountTunes(),a=getTuneRangeForTranspose(),r=a.end-a.start+1;!(r<=0)&&(r>5&&(document.getElementById("loading-bar-spinner").style.display="block"),setTimeout(function(){for(var n=gTheABC.value,r=GetABCJSParams(),l=n.split(/^X:/gm),s=FindPreTuneHeader(n),g=!1,c=[],d=1;d<=o;++d){l[d]="X:"+l[d];var u=getTuneTitle(l[d]),p=null;if(d-1>=a.start&&d-1<=a.end)try{p=ABCJS.renderAbc("*",l[d],r),s+=ABCJS.strTranspose(l[d],p,t)}catch(m){g=!0,s+=l[d],c.push(u),gShowABCJSRenderProgress&&console.log("Transpose failed: "+u)}else s+=l[d]}gTheABC.value=s,gIsDirty=!0,resetSelectionAfterTranspose(a.start,a.end),setTimeout(function(){gRawMode?RenderAsync(!0,null,function(){g&&ShowTransposeWarningDialog(c)}):RenderRangeAsync(a.start,a.end,function(){g&&ShowTransposeWarningDialog(c)})},0)},0))}}function TransposeUp(t){var n=1;t.shiftKey&&(n=2),t.altKey&&(n=12),Transpose(n)}function TransposeDown(t){var n=-1;t.shiftKey&&(n=-2),t.altKey&&(n=-12),Transpose(n)}function getTuneRootKey(t){for(var t=escape(t),n=t.split("%0A"),o=n.length,a="",r=!1,l=0;l<o;++l)if(-1!=(a=unescape(n[l])).indexOf("K:")){r=!0;break}if(!r)return"C";var s=(a=(a=a.replace("K:","")).trim())[0].toUpperCase();return a.length>1&&("#"==a[1]||"b"==a[1])&&(s=a.substring(0,2)),s}var gLastTransposeToKey="A";function TransposeToKeyDialog(){let t={transposekey:gLastTransposeToKey,transposeall:!1};DayPilot.Modal.form([{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Transpose to Key&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/app/userguide.html#advanced_transposetokey" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="margin-top:36px;margin-bottom:12px;font-size:12pt;line-height:18pt;font-family:helvetica">This will transpose the current tune or all the tunes to the specified root key.</p>'},{html:'<p style="margin-bottom:12px;font-size:12pt;line-height:18pt;font-family:helvetica">Any modes specified in the tune keys will be preserved.</p>'},{html:'<p style="margin-top:12px;margin-bottom:42px;font-size:12pt;line-height:18pt;font-family:helvetica"><strong>If the Transpose to Key results are too high or too low:</strong><br/>Click in a single tune or select across one or more tunes in the ABC editor then <strong>Alt-Click</strong> the lower toolbar <strong>Transpose Up</strong> or <strong>Transpose Down</strong> buttons to transpose the tune(s) down or up an octave.</p>'},{name:"Root key:",id:"transposekey",type:"select",options:[{name:"C",id:"C"},{name:"C#",id:"C#"},{name:"Db",id:"Db"},{name:"D",id:"D"},{name:"D#",id:"D#"},{name:"Eb",id:"Eb"},{name:"E",id:"E"},{name:"F",id:"F"},{name:"F#",id:"F#"},{name:"Gb",id:"Gb"},{name:"G",id:"G"},{name:"G#",id:"G#"},{name:"Ab",id:"Ab"},{name:"A",id:"A"},{name:"A#",id:"A#"},{name:"Bb",id:"Bb"},{name:"B",id:"B"}],cssClass:"configure_transpose_settings_select"},{name:"          Transpose all tunes",id:"transposeall",type:"checkbox",cssClass:"configure_transposetokey_text"},{html:'<p style="font-size:12pt;font-family:helvetica">&nbsp;</p>'},],t,{theme:"modal_flat",top:200,width:600,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(t){t.canceled||DoTransposeToKey(gLastTransposeToKey=t.result.transposekey,t.result.transposeall)})}function DoTransposeToKey(t,n){function o(t){let n=[{name:"C",degree:0},{name:"C#",degree:1},{name:"Db",degree:1},{name:"D",degree:2},{name:"D#",degree:3},{name:"Eb",degree:3},{name:"E",degree:4},{name:"F",degree:5},{name:"F#",degree:6},{name:"Gb",degree:6},{name:"G",degree:7},{name:"G#",degree:8},{name:"Ab",degree:8},{name:"A",degree:9},{name:"A#",degree:10},{name:"Bb",degree:10},{name:"B",degree:11}];for(var o=n.length,a=0;a<o;++a)if(n[a].name==t)return n[a].degree;return 0}var a=o(t);if(gDisableNotationRendering){var r="Transpose not possible with rendering disabled.";r=makeCenteredPromptString(r),DayPilot.Modal.alert(r,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});return}!gRenderingPDF&&(sendGoogleAnalytics("dialog","TransposeToKey"),document.getElementById("loading-bar-spinner").style.display="block",setTimeout(function(){var t,r=GetABCJSParams(),l=CountTunes(),s=0;n||(s=findSelectedTuneIndex());for(var g=FindPreTuneHeader(gTheABC.value),c=!1,d=[],u=0;u<l;++u){var p=null,m=getTuneByIndex(u);if(isSectionHeader(m)){g+=m;continue}try{var h=getTuneRootKey(m),f=o(h);if(a<=f){var A=-1*(f-a),b=A;A<0&&(A*=-1);var T=a+12-f,y=T;T<0&&(T*=-1),transposeAmount=A<=T?b:y}else{var A=a-f,b=A;A<0&&(A*=-1);var T=f+12-a;T>12&&(T-=12);var y=T*=-1;T<0&&(T*=-1),transposeAmount=A<=T?b:y}n?0!=transposeAmount?(t=getTuneTitle(m),p=ABCJS.renderAbc("*",m,r),g+=ABCJS.strTranspose(m,p,transposeAmount)):g+=m:0!=transposeAmount&&u==s?(t=getTuneTitle(m),p=ABCJS.renderAbc("*",m,r),g+=ABCJS.strTranspose(m,p,transposeAmount)):g+=m}catch(I){c=!0,d.push(t),gShowABCJSRenderProgress&&console.log("Transpose failed: "+t),g+=m}}gTheABC.value=g,gIsDirty=!0;var v=n,C=s;gRawMode&&(v=!0),v&&(C=null),setTimeout(function(){RenderAsync(v,C,function(){gRawLastIndex=-1,DayPilot.Modal.alert('<p style="text-align:center;font-size:14pt;font-family:helvetica;">Transpose to Key Complete!</p>',{theme:"modal_flat",top:300,width:500,scrollWithPage:AllowDialogsToScroll()}).then(function(){gTheABC.selectionStart,n?(gTheABC.selectionStart=0,gTheABC.selectionEnd=0,gCurrentTune=0):(gCurrentTune=s,resetSelectionAfterTranspose(s,s)),FocusAfterOperation(),c&&ShowTransposeWarningDialog(d)})})},0)},0))}function GetAllTuneTags(t,n){var o,a=[];for(o=0;o<n;++o){var r=getTuneByIndex(o),l=escape(r),s=l.split("%0D%0A");s=l.split("%0A");for(var g=!1,c=0;c<s.length;++c){s[c]=unescape(s[c]);var d=s[c].split("");if(d[0]==t&&":"==d[1]){var u=s[c].slice(2);u=u.trim(),a.push(u),g=!0;break}}g||a.push(" ")}return a}function SortTunesByTag(t,n){let o=[{name:"C|",weight:1},{name:"C",weight:2},{name:"2/2",weight:10},{name:"3/2",weight:11},{name:"2/4",weight:7},{name:"3/4",weight:8},{name:"4/4",weight:3},{name:"5/4",weight:12},{name:"6/4",weight:9},{name:"7/4",weight:13},{name:"2/8",weight:14},{name:"3/8",weight:15},{name:"5/8",weight:16},{name:"6/8",weight:4},{name:"7/8",weight:17},{name:"9/8",weight:5},{name:"10/8",weight:18},{name:"11/8",weight:19},{name:"12/8",weight:6}];var a,r=gTheABC.value,l=r.split(/(^X:.*$)/gm),s=(l.length-1)/2;if(!(s<2)){var g=l[0],c=GetAllTuneTags(t,l.length-1),d=c.length;if("M"==t){for(var u=[],a=0;a<d;++a){for(var p=c[a],m=19,h=0;h<o.length;++h)if(p==o[h].name){m=o[h].weight;break}u.push(m)}c=u}var f=[],A=0;for(a=0;a<s;++a)void 0!=l[2*a+1]&&(thisTag=c[A],n&&(thisTag=thisTag.toLowerCase()),A++,f.push({tag:thisTag,tune:l[2*a+1]+l[2*a+2]}));for(f.sort((t,n)=>{let o=t.tag,a=n.tag;return o<a?-1:o>a?1:0}),r="",r+=g,a=0;a<A;++a)r+=f[a].tune;gTheABC.value=r,gIsDirty=!0,gTheABC.selectionStart=0,gTheABC.selectionEnd=0,FocusAfterOperation()}}function DoSortTunesByMeter(){if(!gRenderingPDF){var t=document.getElementById("sortbutton");t&&(t.value="Sorting..."),setTimeout(function(){SortTunes(),SortTunesByTag("M",!1),RenderAsync(!0,null,function(){var t=document.getElementById("sortbutton");t&&(t.value="   Sorted!   "),setTimeout(function(){var t=document.getElementById("sortbutton");t&&(t.value="Sort by Tag")},1e3)})},750)}}function DoSortTunesByKey(){if(!gRenderingPDF){var t=document.getElementById("sortbutton");t&&(t.value="Sorting..."),setTimeout(function(){SortTunes(),SortTunesByTag("K",!1),RenderAsync(!0,null,function(){var t=document.getElementById("sortbutton");t&&(t.value="   Sorted!   "),setTimeout(function(){var t=document.getElementById("sortbutton");t&&(t.value="Sort by Tag")},1e3)})},750)}}function processTitleForSorting(t){return 0==t.indexOf("The ")&&(t=t.substring(4,t.length)+", The"),0==t.indexOf("Da ")&&(t=t.substring(3,t.length)+", Da"),0==t.indexOf("An ")&&(t=t.substring(3,t.length)+", An"),0==t.indexOf("A ")&&(t=t.substring(2,t.length)+", A"),0==t.indexOf("Le ")&&(t=t.substring(3,t.length)+", Le"),0==t.indexOf("La ")&&(t=t.substring(3,t.length)+", La"),t}function SortTunes(){var t,n,o=gTheABC.value,a=o.split(/(^X:.*$)/gm),r=(a.length-1)/2;if(!(r<2)){var l=a[0];totalTunes=r;var s=GetTunebookIndexTitles(),g=[],c=0;for(t=0;t<r;++t)void 0!=a[2*t+1]&&(n=processTitleForSorting(n=s[c]),c++,g.push({title:n,tune:a[2*t+1]+a[2*t+2]}));for(g.sort((t,n)=>{let o=t.title.toUpperCase(),a=n.title.toUpperCase();return o<a?-1:o>a?1:0}),o="",o+=l,t=0;t<c;++t)o+=g[t].tune;gTheABC.value=o,gIsDirty=!0,gTheABC.selectionStart=0,gTheABC.selectionEnd=0,FocusAfterOperation()}}function DoSortTunesByName(){if(!gRenderingPDF){var t=document.getElementById("sortbutton");t&&(t.value="Sorting..."),setTimeout(function(){SortTunes(),RenderAsync(!0,null,function(){var t=document.getElementById("sortbutton");t&&(t.value="   Sorted!   "),setTimeout(function(){var t=document.getElementById("sortbutton");t&&(t.value="Sort by Tag")},1e3)})},750)}}function DoSortTunesByRhythm(){if(!gRenderingPDF){var t=document.getElementById("sortbutton");t&&(t.value="Sorting..."),setTimeout(function(){SortTunes(),SortTunesByTag("R",!0),RenderAsync(!0,null,function(){var t=document.getElementById("sortbutton");t&&(t.value="   Sorted!   "),setTimeout(function(){var t=document.getElementById("sortbutton");t&&(t.value="Sort by Tag")},1e3)})},750)}}function DoSortTunesByID(){if(!gRenderingPDF){var t=document.getElementById("sortbutton");t&&(t.value="Sorting..."),setTimeout(function(){SortTunes(),SortTunesByTag("X",!1),RenderAsync(!0,null,function(){var t=document.getElementById("sortbutton");t&&(t.value="   Sorted!   "),setTimeout(function(){var t=document.getElementById("sortbutton");t&&(t.value="Sort by Tag")},1e3)})},750)}}function RenumberXTags(){var t,n=gTheABC.value,o=n.split(/(^X:.*$)/gm),a=o.length;n="",n+=o[0];var r=1;for(i=1;i<a;++i)i%2?(n+="X:"+r,r++):n+=o[i];gTheABC.value=n,gIsDirty=!0,gTheABC.selectionStart=0,gTheABC.selectionEnd=0,FocusAfterOperation()}var gLastSortOrder="0";function SortDialog(){sendGoogleAnalytics("dialog","SortDialog");let t={configure_sort:gLastSortOrder};DayPilot.Modal.form([{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Sort by Specific Tag&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/app/userguide.html#sort_dialog" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="margin-top:36px;margin-bottom:36px;font-size:12pt;line-height:18pt;font-family:helvetica">This will sort the tunes based on the ABC tag you select:</p>'},{name:"Tag to sort by:",id:"configure_sort",type:"select",options:[{name:"  Sort by Name (T:)",id:"0"},{name:"  Sort by Key (K:)",id:"1"},{name:"  Sort by Meter (M:)",id:"2"},{name:"  Sort by Rhythm (R:)",id:"3"},{name:"  Sort by ID (X:)",id:"4"},{name:"  Renumber all X: Tags",id:"5"},],cssClass:"configure_sort_settings_select"},{html:'<p style="font-size:12pt;font-family:helvetica">&nbsp;</p>'},],t,{theme:"modal_flat",top:200,width:500,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(t){if(!t.canceled)switch(gLastSortOrder=t.result.configure_sort,t.result.configure_sort){case"0":default:DoSortTunesByName();break;case"1":DoSortTunesByKey();break;case"2":DoSortTunesByMeter();break;case"3":DoSortTunesByRhythm();break;case"4":DoSortTunesByID();break;case"5":RenumberXTags()}})}function Clear(){function t(){gIsFromShare=!1,gIsDirty=!1;var t=document.getElementById("rawmodebutton");t.value="Highlighting Off",t.classList.remove("rawmodebutton"),t.classList.add("rawmodebuttondisabled"),t.classList.add("btn-rawmode-off"),t.classList.remove("btn-rawmode-on"),gTheABC.style.backgroundColor="white",gRawMode=!1,gRawLastIndex=-1,RestoreSavedStaffSpacing(),ClearNoRender(),RenderAsync(!0,null),gTheABC.focus(),(t=document.getElementById("diagnostics")).innerHTML=""}if(!gRenderingPDF){if(sendGoogleAnalytics("action","Clear"),gConfirmClear){var n="Are you sure you want to erase all the ABC and start over?";n=makeCenteredPromptString(n),DayPilot.Modal.confirm(n,{top:200,theme:"modal_flat",scrollWithPage:AllowDialogsToScroll()}).then(function(n){n.canceled||t()})}else t()}}function ClearNoRender(){gTheABC.value="",gDisplayedName="No ABC file selected",gABCFromFile=!1,RestoreDefaults()}function RestoreSavedStaffSpacing(){if(gLocalStorageAvailable){var t=localStorage.abcStaffSpacing;t=parseInt(t),gStaffSpacing=isNaN(t)?STAFFSPACEOFFSET+STAFFSPACEDEFAULT:STAFFSPACEOFFSET+t}}function DoSaveLastAutoSnapShot(){if(gLocalStorageAvailable){var t=gTheABC.value;localStorage.LastAutoSnapShot=t}}function SaveSnapshot(t){if(gLocalStorageAvailable){sendGoogleAnalytics("action","SaveSnapshot");var n,o=gTheABC.value;t&&t.shiftKey&&t.altKey?(n="4",localStorage.SavedSnapshot4=o):t&&t.altKey?(n="3",localStorage.SavedSnapshot3=o):t&&t.shiftKey?(n="2",localStorage.SavedSnapshot2=o):(n="1",localStorage.SavedSnapshot=o),document.getElementById("snapshotbutton").value="Saved #"+n,setTimeout(function(){document.getElementById("snapshotbutton").value="Snapshot"},1e3)}else{sendGoogleAnalytics("action","SaveSnapshot_Fail");var a="Snapshot storage not available on this browser.";a=makeCenteredPromptString(a),DayPilot.Modal.alert(a,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})}}function RestoreSnapshot(t,n,o){if(gLocalStorageAvailable){if(sendGoogleAnalytics("action","RestoreSnapshot"),gTheABC.value,n)a=localStorage.LastAutoSnapShot,c="Replace the contents of the ABC editor with the Auto-Snapshot?",d="No saved Auto-Snapshot available to restore.";else{var a,r,l,s,g,c,d,u,p=!0;r=localStorage.SavedSnapshot,l=localStorage.SavedSnapshot2,s=localStorage.SavedSnapshot3,g=localStorage.SavedSnapshot4,t&&t.shiftKey&&t.altKey?(a=g,u="4"):t&&t.altKey?(a=s,u="3"):t&&t.shiftKey?(a=l,u="2"):(a=r,p=!1,u="1"),o&&!p&&(r&&""!=r?(a=r,u="1"):l&&""!=l?(a=l,u="2"):s&&""!=s?(a=s,u="3"):g&&""!=g&&(a=g,u="4")),c="Replace the contents of the ABC editor with Snapshot #"+u+"?",d="No saved Snapshot #"+u+" available to restore."}c=makeCenteredPromptString(c),a&&""!=a?DayPilot.Modal.confirm(c,{top:200,theme:"modal_flat",scrollWithPage:AllowDialogsToScroll()}).then(function(t){if(!t.canceled){if(o){var r;n?(r=document.getElementById("dialogrestoreautobutton"))&&(r.value="Restoring from Auto-Snapshot"):(r=document.getElementById("dialogrestorebutton"))&&(r.value="Restoring from Snapshot"),setTimeout(function(){gTheABC.value=a,gIsFromShare=!1,gIsDirty=!0,RestoreSavedStaffSpacing(),RenderAsync(!0,null,function(){var t;n?(t=document.getElementById("dialogrestoreautobutton"))&&(t.value="Restored from Auto-Snapshot"):(t=document.getElementById("dialogrestorebutton"))&&(t.value="Restored from Snapshot"),setTimeout(function(){var t;n?(t=document.getElementById("dialogrestoreautobutton"))&&(t.value="Restore from Auto-Snapshot"):(t=document.getElementById("dialogrestorebutton"))&&(t.value="Restore from Snapshot")},1e3),gRawLastIndex=-1,gCurrentTune=0})},750)}else document.getElementById("restorebutton").value="Restoring",setTimeout(function(){gTheABC.value=a,gIsFromShare=!1,RestoreSavedStaffSpacing(),gIsDirty=!0,RenderAsync(!0,null,function(){document.getElementById("restorebutton").value="Restored",setTimeout(function(){document.getElementById("restorebutton").value="Restore"},1e3),gRawLastIndex=-1,gCurrentTune=0})},750)}}):(sendGoogleAnalytics("action","RestoreSnapshot_Fail_1"),DayPilot.Modal.alert('<p style="text-align:center;font-size:18px;">'+d+"</p>",{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()}))}else{sendGoogleAnalytics("action","RestoreSnapshot_Fail_2");var c="Snapshot storage not available on this browser.";c=makeCenteredPromptString(c),DayPilot.Modal.alert(c,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})}}var gPAGENUMBERTOP=296,PAGETOPOFFSET=32,PAGEBOTTOMOFFSET=24,PAGELEFTOFFSET=37,PAGELEFTOFFSETA4=29,PAGEHEIGHTLETTER=792,PAGEHEIGHTA4=842,PAGEHEIGHTLETTER_LANDSCAPE=580,PAGEHEIGHTA4_LANDSCAPE=565,BETWEENTUNESPACE=20,gBetweenTuneSpace=20,gGotBetweenTuneSpace=!1,running_height=PAGETOPOFFSET,column_number=0,theCurrentPageNumber=1,isFirstPage=!0,tunesProcessed=0,totalTunes=0,thePageHeader="",thePageFooter="",thePageHeaderURL="",thePageFooterURL="",theRenderTime="",theHeaderFooterTuneNames="",thePageNumberVerticalOffset=0,gQRCodeRequested=!1,gQRCodeURLOverride="",gDoForceQRCodeURLOverride=!1,gQRCodeCaptionOverride="",gDoForceQRCodeCaptionOverride=!1,TunebookIndexRequested=!1,theTunebookIndexTitle="",TunebookSortedIndexRequested=!1,theTunebookSortedIndexTitle="",TunebookIndexHeaderRequested=!1,theTunebookIndexHeader="",TunebookTOCRequested=!1,theTunebookTOCTitle="",TunebookSortedTOCRequested=!1,theTunebookSortedTOCTitle="",TunebookTOCHeaderRequested=!1,theTunebookTOCHeader="",TunebookTPRequested=!1,theTunebookTP="",theTunebookTPURL="",TunebookTPSTRequested=!1,theTunebookTPST="",theTunebookTPSTURL="",TunebookBookmarksAdded=!1,TunebookTOCWithNoPageNumbers=!1,TunebookIndexWithNoPageNumbers=!1,theTunePageMap=[],PDFJPGQUALITY=.8,PDFSCALEFACTOR=1.55,theOffscreen=null,gPDFCancelRequested=!1,gPDFTabselected="noten";function GetTunebookIndexTitles(){var t,n=[];for(t=0;t<totalTunes;++t){var o=getTuneByIndex(t),a=escape(o),r=a.split("%0D%0A");r=a.split("%0A");for(var l=!1,s=0;s<r.length;++s){r[s]=unescape(r[s]);var g=r[s].split("");if("T"==g[0]&&":"==g[1]){titel=(titel=r[s].slice(2)).trim(),n.push(titel),l=!0;break}}l||n.push("No Title")}return n}var TPTITLESIZE=24,TPSTTITLESIZE=16,gTPTOPOFFSET=435,TPSTOFFSET=24;function AppendTuneTitlePage(t,n,o,a){if(t.setPage(1),""!=o){if(t.setFont(gPDFFont,gPDFFontStyle,"normal"),t.setFontSize(TPTITLESIZE),theTunebookTPURL&&""!=theTunebookTPURL){var r=t.getTextWidth(o);t.textWithLink(o,t.internal.pageSize.getWidth()/3.1-r/2,gTPTOPOFFSET,{align:"center",url:theTunebookTPURL})}else t.text(o,t.internal.pageSize.getWidth()/3.1,gTPTOPOFFSET,{align:"center"})}if(""!=a){if(t.setFont(gPDFFont,gPDFFontStyle,"normal"),t.setFontSize(TPSTTITLESIZE),theTunebookTPSTURL&&""!=theTunebookTPSTURL){var r=t.getTextWidth(a);t.textWithLink(a,t.internal.pageSize.getWidth()/3.1-r/2,gTPTOPOFFSET+TPSTOFFSET,{align:"center",url:theTunebookTPSTURL})}else t.text(a,t.internal.pageSize.getWidth()/3.1,gTPTOPOFFSET+TPSTOFFSET,{align:"center"})}}var gTEXTINCIPITTOPOFFSET=330,TEXTINCIPITBOTTOMOFFSET=12,gTEXTINCIPITLEFTMARGIN=65,gTEXTINCIPITRIGHTMARGIN=190,TEXTINCIPITFONTSIZE=12,TEXTINCIPITLINESPACING=10,TEXTINCIPITGUTTER=5;function fitIncipitsTitle(t,n,o,a){var r,l=n;if(""==n)return l="No title",""!=o&&(l+=" ("+o+")"),l;l=l.trim(),""!=o&&(l+=" ("+o+")"),t.setFont(gPDFFont,gPDFFontStyle,"normal"),t.setFontSize(TEXTINCIPITFONTSIZE);var s=t.getTextWidth(l);if(""==n||s<=a)return l;var g="...";""!=o&&(g+=" ("+o+")"),a-=t.getTextWidth(g),a-=t.getTextWidth("W");for(var c="",d=l.length,u=0;u<d&&(c+=l[u],!((r=t.getTextWidth(c))>a));++u);return c+g}function cleanIncipitLine(t){return searchRegExp=/\[V:\s*\d+\]/gm,t=t.replace(searchRegExp,""),searchRegExp=/V:\s+\S+\s/gm,t=t.replace(searchRegExp,""),searchRegExp=/V:[^ ]+ /gm,t=t.replace(searchRegExp,""),searchRegExp=/![^!\n]*!/gm,t=(t=(t=(t=(t=t.replace(searchRegExp,"")).replaceAll(":","")).replaceAll("[","")).replaceAll("]","")).replaceAll("\\","")}function GenerateTextIncipits(t,n,o,a,r,l,s){var g=t.internal.pageSize.getHeight(),c=t.internal.pageSize.getWidth()/1.55,d=g-(PAGETOPOFFSET+TEXTINCIPITBOTTOMOFFSET),u=gTEXTINCIPITTOPOFFSET,p=GetTunebookIndexTitles();t.setFont(gPDFFont,gPDFFontStyle,"normal"),t.setFontSize(TEXTINCIPITFONTSIZE);var m=[];for(f=0;f<totalTunes;++f){for(A=0,T=getTuneByIndex(f),T=StripTabOne(T=StripChordsOne(T=StripTextAnnotationsOne(T=StripAnnotationsOne(T)))),C=/^M:.*[\r\n]*/gm,_=(S=(T=escape(T=T.replace(C,""))).split("%0A")).length,M="";A<_&&-1==(M=unescape(S[A])).indexOf("K:");++A);for(A=0,M=(M=(M=(M=(M=(M=(M=(M=(M=(M=(M=M.replace("K:","")).trim()).replace("Major","maj")).replace("Minor","min")).replace("Dorian","dor")).replace("Mixolydian","mix")).replace("major","maj")).replace("minor","min")).replace("dorian","dor")).replace("mixolydian","mix")).replace(" ","");A<_;++A)if(-1==(y=unescape(S[A])).indexOf("%%score")&&-1!=y.indexOf("|")){if(A<=_-2)for(b=A+1;b<_;++b){var h=unescape(S[b]);if(-1!=h.indexOf("|")){y+=h;break}}break}for(A=0,I=(y=cleanIncipitLine(y)).split("|"),v=[],B=I.length;A<B;++A)""!=I[A]&&v.push(I[A]);for((B=v.length)>3&&(B=3),D="",A=0;A<B;++A)v[A]=v[A].trim(),D+=v[A],A!=B-1&&(D+=" | ");0==(y=D).indexOf(" | ")&&(y=y.substring(3,y.length)),y=y.replaceAll("  "," "),E=p[f],y=y.length>40?(y=y.substring(0,40)).trim():y.trim(),s&&(E=processTitleForSorting(E)),E=fitIncipitsTitle(t,E,M,c-gTEXTINCIPITRIGHTMARGIN-gTEXTINCIPITLEFTMARGIN-TEXTINCIPITGUTTER),m.push({title:E,incipit:y,index:f})}if(s){var f,A,b,T,y,I,v,C,S,_,B,D,E,M,F=[];for(f=0;f<totalTunes;++f)F.push({title:m[f].title,incipit:m[f].incipit,index:m[f].index});for(F.sort((t,n)=>{var o=t.title.toUpperCase(),a=n.title.toUpperCase();return o<a?-1:o>a?1:0}),f=0;f<totalTunes;++f)m[f].title=F[f].title,m[f].incipit=F[f].incipit,m[f].index=F[f].index}for(f=0;f<totalTunes;++f){E=m[f].title;var P,w=!1;0==E.indexOf("*")&&(E=(E=E.replaceAll("*","")).trim(),w=!0,u+=TEXTINCIPITLINESPACING),y=m[f].incipit,t.setFont(gPDFFont,gPDFFontStyle,"normal"),t.setFontSize(TEXTINCIPITFONTSIZE);var R=t.getTextWidth(E);w?(0!=f&&(theCurrentPageNumber++,t.addPage(r,gPDFOrientation),t.setFont(gPDFFont,gPDFFontStyle,"normal"),t.setFontSize(TEXTINCIPITFONTSIZE),u=gTEXTINCIPITTOPOFFSET),t.setFont(gPDFFont,"bold","normal"),t.setFontSize(TEXTINCIPITFONTSIZE),R=t.getTextWidth(E),t.text(E,t.internal.pageSize.getWidth()/3.1-R/2,u,{align:"left"})):(t.text(E,gTEXTINCIPITLEFTMARGIN,u,{align:"left"}),t.setFont("Courier","normal","normal"),t.setFontSize(TEXTINCIPITFONTSIZE),t.text(y,c-gTEXTINCIPITRIGHTMARGIN,u,{align:"left"})),l.push(theCurrentPageNumber),"portrait"==gPDFOrientation?(P=119,"a4"==r&&(P=125),gTuneHyperlinks.push({page:theCurrentPageNumber,x:1.55*gTEXTINCIPITLEFTMARGIN,y:1.55*u-(gTEXTINCIPITTOPOFFSET+P),width:1.55*R,height:1.55*TEXTINCIPITLINESPACING,url:""})):(P=78,"a4"==r&&(P=82),gTuneHyperlinks.push({page:theCurrentPageNumber,x:1.55*gTEXTINCIPITLEFTMARGIN,y:(u-TEXTINCIPITLINESPACING)*1.55-(gTEXTINCIPITTOPOFFSET+P),width:1.55*R,height:1.55*TEXTINCIPITLINESPACING,url:""})),u+=TEXTINCIPITLINESPACING,w&&(u+=TEXTINCIPITLINESPACING),f!=totalTunes-1&&u>d&&(theCurrentPageNumber++,t.addPage(r,gPDFOrientation),t.setFont(gPDFFont,gPDFFontStyle,"normal"),t.setFontSize(TEXTINCIPITFONTSIZE),u=gTEXTINCIPITTOPOFFSET)}if(s){var k=[];for(f=0;f<totalTunes;++f)for(A=0;A<totalTunes;++A)if(m[A].index==f){k.push(gTuneHyperlinks[A]);break}gTuneHyperlinks=k}return l}var FULLTEXTINCIPITFONTSIZE=11,FULLTEXTINCIPITLINESPACING=9,FULLTEXTINCIPITLEFTMARGIN=45;function GenerateFullTextIncipits(t,n,o,a,r,l,s,g){var c=t.internal.pageSize.getHeight();t.internal.pageSize.getWidth();var d=c-(PAGETOPOFFSET+TEXTINCIPITBOTTOMOFFSET),u=gTEXTINCIPITTOPOFFSET;FULLTEXTINCIPITFONTSIZE=11,FULLTEXTINCIPITLINESPACING=9,FULLTEXTINCIPITLEFTMARGIN=35,g&&(FULLTEXTINCIPITFONTSIZE=10,FULLTEXTINCIPITLINESPACING=8,FULLTEXTINCIPITLEFTMARGIN=30);var p=GetTunebookIndexTitles();t.setFont(gPDFFont,gPDFFontStyle,"normal"),t.setFontSize(FULLTEXTINCIPITFONTSIZE);var m=[];for(f=0;f<totalTunes;++f){for(T=getTuneByIndex(f),g&&0!=p[f].indexOf("*")&&(T=ceoltasABCTransformer(T,!1,!0)),T=StripTabOne(T=StripChordsOne(T=StripTextAnnotationsOne(T=StripAnnotationsOne(T)))),C=/^M:.*[\r\n]*/gm,_=(S=(T=escape(T=T.replace(C,""))).split("%0A")).length,M="",A=0;A<_&&-1==(M=unescape(S[A])).indexOf("K:");++A);M=(M=(M=(M=(M=(M=(M=(M=(M=(M=(M=M.replace("K:","")).trim()).replace("Major","maj")).replace("Minor","min")).replace("Dorian","dor")).replace("Mixolydian","mix")).replace("major","maj")).replace("minor","min")).replace("dorian","dor")).replace("mixolydian","mix")).replace(" ","");var h=[];for(b=0;b<_;++b)if(-1!=(y=unescape(S[b])).indexOf("|")){for(A=0,I=(y=cleanIncipitLine(y)).split("|"),v=[],B=I.length;A<B;++A)""!=I[A]&&v.push(I[A]);for(A=0,B=v.length,D="";A<B;++A)v[A]=v[A].trim(),D+=v[A],A!=B-1&&(D+=" | ");0==(y=D).indexOf(" | ")&&(y=y.substring(3,y.length)),h.push(y)}E=(E=p[f]).trim(),""!=M&&(E+=" ("+M+")"),m.push({title:E,incipits:h})}for(f=0;f<totalTunes;++f){E=m[f].title;var f,A,b,T,y,I,v,C,S,_,B,D,E,M,F,P=!1;0==E.indexOf("*")&&(E=(E=E.replaceAll("*","")).trim(),P=!0,0!=f&&(theCurrentPageNumber++,t.addPage(r,gPDFOrientation),u=gTEXTINCIPITTOPOFFSET));var h=m[f].incipits,_=h.length,w=1.5*FULLTEXTINCIPITLINESPACING;_>0&&(w+=(_-1)*FULLTEXTINCIPITLINESPACING),u+w>d&&(theCurrentPageNumber++,t.addPage(r,gPDFOrientation),t.setFont("Courier","normal","normal"),t.setFontSize(FULLTEXTINCIPITFONTSIZE),u=gTEXTINCIPITTOPOFFSET),l.push(theCurrentPageNumber),t.setFont(gPDFFont,"bold","normal"),t.setFontSize(1.1*FULLTEXTINCIPITFONTSIZE),t.text(E,FULLTEXTINCIPITLEFTMARGIN,u,{align:"left"});var R=t.getTextWidth(E);"portrait"==gPDFOrientation?(F=117,"a4"==r&&(F=124),gTuneHyperlinks.push({page:theCurrentPageNumber,x:1.55*FULLTEXTINCIPITLEFTMARGIN,y:1.55*u-(gTEXTINCIPITTOPOFFSET+F),width:1.55*R,height:1.5*FULLTEXTINCIPITLINESPACING*1.55,url:""})):(F=83,"a4"==r&&(F=83),gTuneHyperlinks.push({page:theCurrentPageNumber,x:1.55*FULLTEXTINCIPITLEFTMARGIN,y:(u-FULLTEXTINCIPITLINESPACING)*1.55-(gTEXTINCIPITTOPOFFSET+F),width:1.55*R,height:1.8*FULLTEXTINCIPITLINESPACING*1.55,url:""})),u+=1.5*FULLTEXTINCIPITLINESPACING;for(var A=0;A<_;++A){var y=h[A];t.setFont("Courier","normal","normal"),t.setFontSize(FULLTEXTINCIPITFONTSIZE),t.text(y,FULLTEXTINCIPITLEFTMARGIN,u,{align:"left"}),A==_-1&&f!=totalTunes-1&&(u+=FULLTEXTINCIPITLINESPACING),u+=FULLTEXTINCIPITLINESPACING,f!=totalTunes-1&&u>d&&(theCurrentPageNumber++,t.addPage(r,gPDFOrientation),t.setFont("Courier","normal","normal"),t.setFontSize(FULLTEXTINCIPITFONTSIZE),u=gTEXTINCIPITTOPOFFSET)}P&&(u+=FULLTEXTINCIPITLINESPACING),f!=totalTunes-1&&u>d&&(theCurrentPageNumber++,t.addPage(r,gPDFOrientation),t.setFont("Courier","normal","normal"),t.setFontSize(FULLTEXTINCIPITFONTSIZE),u=gTEXTINCIPITTOPOFFSET)}return l}function processSingleTunePlaybackInjectsQR(t){if(gAllNoSwingHornpipesRequested){if(tuneIsHornpipe(t)&&-1==t.indexOf("%swing")){var n=/^X:.*[\r\n]*/gm;t="X:1\n%noswing\n"+(t=t.replace(n,""))}}else if(gAllSwingHornpipesRequested&&tuneIsHornpipe(t)&&-1==t.indexOf("%noswing")){var n=/^X:.*[\r\n]*/gm;t="X:1\n%swing "+gAllSwingHornpipesSwingFactor+"\n"+(t=t.replace(n,""))}if(gAddPlaybackHyperlinksIncludePrograms){var n=/^X:.*[\r\n]*/gm;t=t.replace(n,""),t=gAddPlaybackHyperlinkVolumes?"X:1\n%abcjs_soundfont "+gPlaybackHyperlinkSoundFont+"\n%%MIDI program "+gPlaybackHyperlinkMelodyProgram+"\n%%MIDI bassprog "+gPlaybackHyperlinkBassProgram+"\n%%MIDI bassvol "+gPlaybackHyperlinkBassVolume+"\n%%MIDI chordprog "+gPlaybackHyperlinkChordProgram+"\n%%MIDI chordvol "+gPlaybackHyperlinkChordVolume+"\n"+t:"X:1\n%abcjs_soundfont "+gPlaybackHyperlinkSoundFont+"\n%%MIDI program "+gPlaybackHyperlinkMelodyProgram+"\n%%MIDI bassprog "+gPlaybackHyperlinkBassProgram+"\n%%MIDI chordprog "+gPlaybackHyperlinkChordProgram+"\n"+t}gAddAllFonts&&(t=injectAllFonts(t));var o=t.indexOf("%incipits_inject_start");if(-1!=o){var a=t.substring(0,o),r="%incipits_inject_end",l=t.indexOf(r);l+=r.length+1,a+=t.substring(l,t.length),t=a}return t}function PostProcessMixedNotationAndQRCode(t,n,o,a,r,l,s){IntermixTuneQRCodes(t,a,r,l,function t(){s()})}function IntermixTuneQRCodes(t,n,o,a,r){if(0==totalTunes){r();return}var l,s=GetTunebookIndexTitles();gTuneHyperlinks=[],!function g(c){if(gPDFCancelRequested||c==totalTunes){r();return}document.getElementById("statustunecount").innerHTML="Adding Tune QR Code "+(c+1)+" of "+totalTunes,l=getTuneByIndex(c),gAddPlaybackHyperlinks&&(l=processSingleTunePlaybackInjectsQR(l)),theCurrentPageNumber=c!=totalTunes-1?o[c+1]-1:a,t.setPage(theCurrentPageNumber),AppendPDFTuneQRCode(pdf,n,l,s[c],function t(){g(++c)})}(0)}function GenerateFullTuneQRCodes(t,n,o,a,r,l,s){if(0==totalTunes){s([]);return}var g,c=GetTunebookIndexTitles();!function n(o){if(gPDFCancelRequested||o==totalTunes){s(l);return}document.getElementById("statustunecount").innerHTML="Adding Tune QR Code "+(o+1)+" of "+totalTunes,o>0&&t.addPage(r,gPDFOrientation),g=getTuneByIndex(o),gAddPlaybackHyperlinks&&(g=processSingleTunePlaybackInjectsQR(g)),AppendPDFTuneQRCode(pdf,r,g,c[o],function t(){l.push(theCurrentPageNumber),o!=totalTunes-1&&theCurrentPageNumber++,n(++o)})}(0)}var gINDEXTOPOFFSET=330,INDEXBOTTOMOFFSET=16,INDEXTITLEOFFSET=35,INDEXLEFTMARGIN=90,INDEXRIGHTMARGIN=105,INDEXTITLESIZE=18,INDEXFONTSIZE=13,INDEXLINESPACING=12,gINDEXLEFTOFFSET=0,gINDEXRIGHTOFFSET=0;function AppendTunebookIndex(t,n,o,a,r,l,s,g,c,d){t.addPage(a,gPDFOrientation),TunebookIndexHeaderRequested&&AddPageTextHeader(t,a,theTunebookIndexHeader),t.setFont(gPDFFont,gPDFFontStyle,"normal"),t.setFontSize(INDEXTITLESIZE),""!=l&&t.text(l,t.internal.pageSize.getWidth()/3.1,gINDEXTOPOFFSET,{align:"center"});var u=GetTunebookIndexTitles(),p=pdf.internal.pageSize.getHeight(),m=pdf.internal.pageSize.getWidth()/1.55,h=p-(PAGETOPOFFSET+INDEXBOTTOMOFFSET),f=gINDEXTOPOFFSET+INDEXTITLEOFFSET;t.setFont(gPDFFont,gPDFFontStyle,"normal"),t.setFontSize(INDEXFONTSIZE);var A=[];for(b=0;b<totalTunes;++b)A.push(r[b]);if(s){for(b=0;b<totalTunes;++b)y=processTitleForSorting(y=u[b]),u[b]=y;var b,T,y,I=[];for(b=0;b<totalTunes;++b)I.push({name:u[b],pageNumber:A[b]});for(I.sort((t,n)=>{var o=t.name.toUpperCase(),a=n.name.toUpperCase();return o<a?-1:o>a?1:0}),b=0;b<totalTunes;++b)u[b]=I[b].name,g||(A[b]=I[b].pageNumber)}var v=!0;for(b=0;b<totalTunes;++b){var C=T=A[b];if(c&&(C+=d),0!=u[b].indexOf("*")){if(TunebookIndexWithNoPageNumbers){var S=t.getTextWidth(u[b]);c?(t.textWithLink(u[b],t.internal.pageSize.getWidth()/3.1-S/2,f,{align:"left",pageNumber:C}),TunebookBookmarksAdded||t.outline.add(null,u[b],{pageNumber:C})):t.text(u[b],t.internal.pageSize.getWidth()/3.1-S/2,f,{align:"left"})}else c?(t.textWithLink(u[b],INDEXLEFTMARGIN-gINDEXLEFTOFFSET,f,{align:"left",pageNumber:C}),TunebookBookmarksAdded||t.outline.add(null,u[b],{pageNumber:C})):t.text(u[b],INDEXLEFTMARGIN-gINDEXLEFTOFFSET,f,{align:"left"}),c?t.textWithLink(""+T,m-INDEXRIGHTMARGIN+gINDEXRIGHTOFFSET,f,{align:"left",pageNumber:C}):t.text(""+T,m-INDEXRIGHTMARGIN+gINDEXRIGHTOFFSET,f,{align:"left"});f+=INDEXLINESPACING}else{var _=u[b];_=(_=_.replaceAll("*","")).trim();var S=t.getTextWidth(_);!s&&(v||(f+=INDEXLINESPACING,v=!0),v&&(v=!1)),c?(t.textWithLink(_,t.internal.pageSize.getWidth()/3.1-S/2,f,{align:"left",pageNumber:C}),TunebookBookmarksAdded||t.outline.add(null,_,{pageNumber:C})):t.text(_,t.internal.pageSize.getWidth()/3.1-S/2,f,{align:"left"}),s?f+=INDEXLINESPACING:f+=2*INDEXLINESPACING}b!=totalTunes-1&&f>h&&(theCurrentPageNumber++,t.addPage(a,gPDFOrientation),TunebookIndexHeaderRequested&&AddPageTextHeader(t,a,theTunebookIndexHeader),t.setFont(gPDFFont,gPDFFontStyle,"normal"),t.setFontSize(INDEXFONTSIZE),f=gINDEXTOPOFFSET+INDEXTITLEOFFSET),v=!1}theCurrentPageNumber++}function PostProcessHeadersAndFooters(t,n,o,a,r,l,s){for(var g=o;g<o+a;++g)t.setPage(g),AddPageHeaderFooter(t,n,g-o+1,r,l,s)}var gAcrobatURLLimitExceeded=[],ACROBATMAXURLLENGTH=2076,gGotURLLengthWarning=!1;function injectAllFonts(t){var n="";return n+="%%titlefont "+gRenderingFonts.titlefont+"\n",n+="%%subtitlefont "+gRenderingFonts.subtitlefont+"\n",n+="%%infofont "+gRenderingFonts.infofont+"\n",n+="%%tempofont "+gRenderingFonts.tempofont+"\n",n+="%%gchordfont "+gRenderingFonts.gchordfont+"\n",n+="%%annotationfont "+gRenderingFonts.annotationfont+"\n",n+="%%textfont "+gRenderingFonts.textfont+"\n",-1!=t.indexOf("C:")&&(n+="%%composerfont "+gRenderingFonts.composerfont+"\n"),-1!=t.indexOf("H:")&&(n+="%%historyfont "+gRenderingFonts.historyfont+"\n"),-1!=t.indexOf("V:")&&(n+="%%voicefont "+gRenderingFonts.voicefont+"\n"),-1!=t.indexOf("P:")&&(n+="%%partsfont "+gRenderingFonts.partsfont+"\n"),-1!=t.indexOf("w:")&&(n+="%%vocalfont "+gRenderingFonts.vocalfont+"\n"),-1!=t.indexOf("W:")&&(n+="%%wordsfont "+gRenderingFonts.wordsfont+"\n"),"noten"!=GetRadioValue("notenodertab")&&(n+="%%tablabelfont "+gRenderingFonts.tablabelfont+"\n",n+="%%tabnumberfont "+gRenderingFonts.tabnumberfont+"\n",n+="%%tabgracefont "+gRenderingFonts.tabgracefont+"\n"),t="X:1\n"+n+(t=t.replace(/^X:.*[\r\n]*/gm,""))}function GetAllTuneHyperlinks(t){function n(t){if(gAllNoSwingHornpipesRequested){if(tuneIsHornpipe(t)&&-1==t.indexOf("%swing")){var n=/^X:.*[\r\n]*/gm;t="X:1\n%noswing\n"+(t=t.replace(n,""))}}else if(gAllSwingHornpipesRequested&&tuneIsHornpipe(t)&&-1==t.indexOf("%noswing")){var n=/^X:.*[\r\n]*/gm;t="X:1\n%swing "+gAllSwingHornpipesSwingFactor+"\n"+(t=t.replace(n,""))}if(gAddPlaybackHyperlinksIncludePrograms){var n=/^X:.*[\r\n]*/gm;t=t.replace(n,""),t=gAddPlaybackHyperlinkVolumes?"X:1\n%abcjs_soundfont "+gPlaybackHyperlinkSoundFont+"\n%%MIDI program "+gPlaybackHyperlinkMelodyProgram+"\n%%MIDI bassprog "+gPlaybackHyperlinkBassProgram+"\n%%MIDI bassvol "+gPlaybackHyperlinkBassVolume+"\n%%MIDI chordprog "+gPlaybackHyperlinkChordProgram+"\n%%MIDI chordvol "+gPlaybackHyperlinkChordVolume+"\n"+t:"X:1\n%abcjs_soundfont "+gPlaybackHyperlinkSoundFont+"\n%%MIDI program "+gPlaybackHyperlinkMelodyProgram+"\n%%MIDI bassprog "+gPlaybackHyperlinkBassProgram+"\n%%MIDI chordprog "+gPlaybackHyperlinkChordProgram+"\n"+t}gAddAllFonts&&(t=injectAllFonts(t));var o=t.indexOf("%incipits_inject_start");if(-1!=o){var a=t.substring(0,o),r="%incipits_inject_end",l=t.indexOf(r);l+=r.length+1,a+=t.substring(l,t.length),t=a}return t}function o(){for(var t=CountTunes(),o=FindPreTuneHeader(gTheABC.value),r=0;r<t;++r){var l=getTuneByIndex(r);0==a[r].indexOf("*")||(l=n(l)),o+=l}return o}gGotURLLengthWarning=!1,gAcrobatURLLimitExceeded=[];var a,r=CountTunes();if(a=GetTunebookIndexTitles(),r!=t.length)return!1;for(var l=0;l<r;++l){var s=getTuneByIndex(l);if(0!=a[l].indexOf("*")){var g="";if(gAddPlaybackHyperlinks){var c=s;c=gAddTunebookPlaybackHyperlinks?o():n(c);var d=FillUrlBoxWithAbcInLZW(c,!1);d.length>=8100?!gGotURLLengthWarning&&(gGotURLLengthWarning=!0,gAddTunebookPlaybackHyperlinks&&DayPilot.Modal.alert('<p style="text-align:center;font-family:helvetica;font-size:12pt;">Share URL for entire tunebook is too long to add to the tunes.</p>',{theme:"modal_flat",top:230,scrollWithPage:AllowDialogsToScroll()})):gOpenInEditor?((d+="&editor=1").length>ACROBATMAXURLLENGTH&&gAcrobatURLLimitExceeded.push({name:a[l],urllength:d.length}),t[l].url=d):(d+="&play=1",gAddTunebookPlaybackHyperlinks&&(d+="&index="+l),gInjectEditDisabled&&(d+="&dx=1"),d.length>ACROBATMAXURLLENGTH&&gAcrobatURLLimitExceeded.push({name:a[l],urllength:d.length}),t[l].url=d)}else gAddTheSessionHyperlinks&&(t[l].url="https://thesession.org/tunes/search?q="+encodeURIComponent(a[l]));var u=/^%add_link_to_thesession.*$/m,p=s.match(u);p&&p.length>0&&(t[l].url="https://thesession.org/tunes/search?q="+encodeURIComponent(a[l])),u=/^%add_playback_link.*$/m;var m=s.match(u);if(m&&m.length>0){var c=s,h=m[0].replace("%add_playback_link","").match(/\b(\w+)\b/g),f=gTheMelodyProgram,A=gTheBassProgram,b=gTheChordProgram,T="fluid";-1!=gDefaultSoundFont.indexOf("FluidR3_GM")?T="fluid":-1!=gDefaultSoundFont.indexOf("Musyng")?T="musyng":-1!=gDefaultSoundFont.indexOf("fatboy")?T="fatboy":-1!=gDefaultSoundFont.indexOf("canvas")?T="canvas":-1!=gDefaultSoundFont.indexOf("mscore")?T="mscore":-1!=gDefaultSoundFont.indexOf("arachno")?T="arachno":-1!=gDefaultSoundFont.indexOf("fluidhq")&&(T="fluidhq"),gAddPlaybackHyperlinks&&(T=gPlaybackHyperlinkSoundFont,f=gPlaybackHyperlinkMelodyProgram,A=gPlaybackHyperlinkBassProgram,b=gPlaybackHyperlinkChordProgram);var y=!1;if(h&&h.length>0&&(h.length>=1&&(f=(f=h[0]).trim()),h.length>=2&&(A=(A=h[1]).trim()),h.length>=3&&(b=(b=h[2]).trim()),h.length>=4&&(T=(T=h[3]).trim()),y=!0),y){var u=/^X:.*[\r\n]*/gm;c="X:1\n%abcjs_soundfont "+T+"\n%%MIDI program "+f+"\n%%MIDI bassprog "+A+"\n%%MIDI chordprog "+b+"\n"+(c=c.replace(u,""))}var d=FillUrlBoxWithAbcInLZW(c,!1);gOpenInEditor?d+="&editor=1":(d+="&play=1",gInjectEditDisabled&&(d+="&dx=1")),d.length>ACROBATMAXURLLENGTH&&gAcrobatURLLimitExceeded.push({name:a[l],urllength:d.length}),t[l].url=d}u=/^%hyperlink.*$/m;var I=s.match(u);I&&I.length>0&&((g=(g=I[0].replace("%hyperlink","")).trim()).length>ACROBATMAXURLLENGTH&&gAcrobatURLLimitExceeded.push({name:a[l],urllength:g.length}),t[l].url=g)}}return!0}function PostProcessTuneHyperlinks(t,n,o,a){if(n){if(GetAllTuneHyperlinks(n)){t.internal.pageSize.getWidth(),t.internal.pageSize.getHeight(),t.setFont("Verdana","","normal"),t.setFontSize(18);for(var r=n.length,l=-1,s=0;s<r;++s){var g=n[s];if(""!=g.url){var c=g.page;c!=l&&(t.setPage(c+a-1),l=c);var d={left:g.x,top:g.y,width:g.width,height:g.height};d=pageRect2LinkRect(t,d,o),t.link(d.left,d.top,d.width,d.height,{url:g.url})}}}}}function PostProcessTOCAndIndexLinks(t,n,o,a,r,l,s){for(var g=n;g<=o;++g){t.setPage(g),t.setFont("Verdana","","normal"),t.setFontSize(18);var c=t.internal.pageSize.getWidth(),d=t.internal.pageSize.getHeight();if(a&&t.textWithLink("<<",5,d/1.55,{align:"left",pageNumber:r}),l){var u=t.getTextWidth(">>");t.textWithLink(">>",c/1.55-(u+5),d/1.55,{align:"left",pageNumber:s})}}}function AddPageTextHeader(t,n,o){var a=gPAGENUMBERTOP;t.setFont(gPDFFont,gPDFFontStyle,"normal"),t.setFontSize(HEADERFOOTERFONTSIZE),t.text(o,t.internal.pageSize.getWidth()/3.1,a,{align:"center"})}var gTOCTOPOFFSET=330,TOCBOTTOMOFFSET=16,TOCTITLEOFFSET=35,TOCLEFTMARGIN=90,TOCRIGHTMARGIN=105,TOCTITLESIZE=18,TOCFONTSIZE=13,TOCLINESPACING=12,gTOCLEFTOFFSET=0,gTOCRIGHTOFFSET=0;function AppendTuneTOC(t,n,o,a,r,l,s,g,c,d,u){var p=u;t.setPage(p),TunebookTOCHeaderRequested&&AddPageTextHeader(t,a,theTunebookTOCHeader),t.setFont(gPDFFont,gPDFFontStyle,"normal"),t.setFontSize(TOCTITLESIZE),""!=l&&t.text(l,t.internal.pageSize.getWidth()/3.1,gTOCTOPOFFSET,{align:"center"});var m=GetTunebookIndexTitles(),h=pdf.internal.pageSize.getHeight(),f=pdf.internal.pageSize.getWidth()/1.55,A=h-(PAGETOPOFFSET+TOCBOTTOMOFFSET),b=gTOCTOPOFFSET+TOCTITLEOFFSET;t.setFont(gPDFFont,gPDFFontStyle,"normal"),t.setFontSize(TOCFONTSIZE);var T=[];for(y=0;y<totalTunes;++y)T.push(r[y]);if(s){for(y=0;y<totalTunes;++y)v=processTitleForSorting(v=m[y]),m[y]=v;var y,I,v,C=[];for(y=0;y<totalTunes;++y)C.push({name:m[y],pageNumber:T[y]});for(C.sort((t,n)=>{var o=t.name.toUpperCase(),a=n.name.toUpperCase();return o<a?-1:o>a?1:0}),y=0;y<totalTunes;++y)m[y]=C[y].name,g||(T[y]=C[y].pageNumber)}var S=!0;for(y=0;y<totalTunes;++y){if(I=T[y],0!=m[y].indexOf("*")){if(TunebookTOCWithNoPageNumbers){var _=t.getTextWidth(m[y]);c?(t.textWithLink(m[y],t.internal.pageSize.getWidth()/3.1-_/2,b,{align:"left",pageNumber:I+d}),t.outline.add(null,m[y],{pageNumber:I+d}),TunebookBookmarksAdded=!0):t.text(m[y],t.internal.pageSize.getWidth()/3.1-_/2,b,{align:"left"})}else c?(t.textWithLink(m[y],TOCLEFTMARGIN-gTOCLEFTOFFSET,b,{align:"left",pageNumber:I+d}),t.outline.add(null,m[y],{pageNumber:I+d}),TunebookBookmarksAdded=!0):t.text(m[y],TOCLEFTMARGIN-gTOCLEFTOFFSET,b,{align:"left"}),c?t.textWithLink(""+I,f-TOCRIGHTMARGIN+gTOCRIGHTOFFSET,b,{align:"left",pageNumber:I+d}):t.text(""+I,f-TOCRIGHTMARGIN+gTOCRIGHTOFFSET,b,{align:"left"});b+=TOCLINESPACING}else{var B=m[y];B=(B=B.replaceAll("*","")).trim();var _=t.getTextWidth(B);!s&&(S||(b+=TOCLINESPACING,S=!0),S&&(S=!1)),c?(t.textWithLink(B,t.internal.pageSize.getWidth()/3.1-_/2,b,{align:"left",pageNumber:I+d}),t.outline.add(null,B,{pageNumber:I+d}),TunebookBookmarksAdded=!0):t.text(B,t.internal.pageSize.getWidth()/3.1-_/2,b,{align:"left"}),s?b+=TOCLINESPACING:b+=2*TOCLINESPACING}y!=totalTunes-1&&b>A&&(p++,t.setPage(p),TunebookTOCHeaderRequested&&AddPageTextHeader(t,a,theTunebookTOCHeader),t.setFont(gPDFFont,gPDFFontStyle,"normal"),t.setFontSize(TOCFONTSIZE),b=gTOCTOPOFFSET+TOCTITLEOFFSET),S=!1}}function DryRunAddTuneTOC(t,n,o,a,r,l,s,g){t.addPage(a,gPDFOrientation);var c=GetTunebookIndexTitles(),d=pdf.internal.pageSize.getHeight();pdf.internal.pageSize.getWidth();var u=d-(PAGETOPOFFSET+TOCBOTTOMOFFSET),p=gTOCTOPOFFSET+TOCTITLEOFFSET,m=[];for(h=0;h<totalTunes;++h)m.push(r[h]);if(s){for(h=0;h<totalTunes;++h)f=processTitleForSorting(f=c[h]),c[h]=f;var h,f,A=[];for(h=0;h<totalTunes;++h)A.push({name:c[h],pageNumber:m[h]});for(A.sort((t,n)=>{var o=t.name.toUpperCase(),a=n.name.toUpperCase();return o<a?-1:o>a?1:0}),h=0;h<totalTunes;++h)c[h]=A[h].name,g||(m[h]=A[h].pageNumber)}var b=!0;for(h=0;h<totalTunes;++h)0!=c[h].indexOf("*")?p+=TOCLINESPACING:s?p+=TOCLINESPACING:(b?p+=2*TOCLINESPACING:p+=3*TOCLINESPACING,b&&(b=!1)),h!=totalTunes-1&&p>u&&(theCurrentPageNumber++,t.movePage(theCurrentPageNumber,1),p=gTOCTOPOFFSET+TOCTITLEOFFSET,t.addPage(a,gPDFOrientation));theCurrentPageNumber++,t.movePage(theCurrentPageNumber,1)}function pageRect2LinkRect(t,n,o){var a=26;return"a4"==o&&(a=27),n.left=n.left/1.55,n.top=t.internal.pageSize.getHeight()/3.1+a+n.top/1.55,n.width=n.width/1.55,n.height=n.height/1.55,n}function pageVOffset2LinkVOffset(t,n,o){var a=26;return"a4"==o&&(a=27),t.internal.pageSize.getHeight()/3.1+a+n/1.55}function linkVOffset2PageVOffset(t,n,o){var a=26;return"a4"==o&&(a=27),n-=t.internal.pageSize.getHeight()/3.1+a,n*=1.55}function AppendPDFTuneQRCode(t,n,o,a,r){l=FillUrlBoxWithAbcInLZW(o,!1),gAddPlaybackHyperlinks&&(l+="&play=1");var l,s=!0;l.length>2300&&(l=FillUrlBoxWithAbcInLZW("X:1\nT:"+a+"\nT:Tune ABC was too long to generate a valid QR Code\n",!1),s=!1),null==gTheQRCode?gTheQRCode=new QRCode(document.getElementById("qrcode"),{text:l,width:548,height:548,colorDark:"#000000",colorLight:"#ffffff",border:16,correctLevel:QRCode.CorrectLevel.M}):(gTheQRCode.clear(),gTheQRCode.makeCode(l)),setTimeout(function(){var o=document.querySelectorAll('div[id="qrcode"] > img');if(o&&o[0]){g="portrait"==gPDFOrientation?"letter"==gPDFPaperSize?t.internal.pageSize.getWidth()/3.1-18:t.internal.pageSize.getWidth()/3.1-22:"letter"==gPDFPaperSize?t.internal.pageSize.getWidth()/3.1+12:t.internal.pageSize.getWidth()/3.1+24;var g,c,d,u=(o=o[0]).src;g-=64,"portrait"==gPDFOrientation?(t.addImage(u,"PNG",g,150,384,384,void 0,"FAST"),c={left:g,top:150,width:384,height:384}):(t.addImage(u,"PNG",g,86,384,384,void 0,"FAST"),c={left:g,top:75,width:384,height:384}),gTuneHyperlinks.push({page:theCurrentPageNumber,x:c.left,y:c.top,width:c.width,height:c.height,url:l}),t.setFont(gPDFFont,gPDFFontStyle,"normal"),t.setFontSize(QRCODECAPTIONPDFFONTSIZE),"portrait"==gPDFOrientation?(d=558,"a4"==n&&(d=575),d+=80):(d=500,"a4"==n&&(d=500),d+=32);var p=a;s||(p=a+" - Tune is too long to generate a QR Code. Click to open instead.");var m=t.internal.pageSize.getWidth(),h=t.getTextWidth(p);t.text(p,m/3.1-h/2,d,{align:"left"}),gTheQRCode.clear(),r()}else gTheQRCode.clear(),r()},25)}function AppendQRCode(t,n,o){var a;if(gDoForceQRCodeURLOverride)a=gQRCodeURLOverride;else if(a=FillUrlBoxWithAbcInLZW(null,!1),!gAllowQRCodeSave){o(!1);return}null==gTheQRCode?gTheQRCode=new QRCode(document.getElementById("qrcode"),{text:a,width:548,height:548,colorDark:"#000000",colorLight:"#ffffff",border:16,correctLevel:QRCode.CorrectLevel.M}):(gTheQRCode.clear(),gTheQRCode.makeCode(a)),setTimeout(function(){var r=document.querySelectorAll('div[id="qrcode"] > img');if(r&&r[0]){t.addPage(n,gPDFOrientation),l="portrait"==gPDFOrientation?"letter"==gPDFPaperSize?t.internal.pageSize.getWidth()/3.1-18:t.internal.pageSize.getWidth()/3.1-22:"letter"==gPDFPaperSize?t.internal.pageSize.getWidth()/3.1+12:t.internal.pageSize.getWidth()/3.1+24;var l,s,g,c=(r=r[0]).src;l-=64,"portrait"==gPDFOrientation?(t.addImage(c,"PNG",l,150,384,384,void 0,"FAST"),s={left:l,top:150,width:384,height:384}):(t.addImage(c,"PNG",l,86,384,384,void 0,"FAST"),s={left:l,top:75,width:384,height:384}),s=pageRect2LinkRect(t,s,n),t.link(s.left,s.top,s.width,s.height,{url:a}),t.setFont(gPDFFont,gPDFFontStyle,"normal"),t.setFontSize(QRCODECAPTIONPDFFONTSIZE),"portrait"==gPDFOrientation?(g=558,"a4"==n&&(g=575),g+=80):(g=500,"a4"==n&&(g=500),g+=32);var d=theHeaderFooterTuneNames;gDoForceQRCodeCaptionOverride&&(d=gQRCodeCaptionOverride);var u=t.internal.pageSize.getWidth(),p=t.getTextWidth(d);t.textWithLink(d,u/3.1-p/2,g,{align:"left",url:a}),gTheQRCode.clear(),o(!0)}else gTheQRCode.clear(),o(!1)},1e3)}function getDescriptiveFileName(t,n){var o="";if(gABCFromFile?o=(o=(o=(o=(o=gDisplayedName).trim()).replace(/[^a-zA-Z0-9_\-. ]+/ig,"")).replace(/\s/g,"_")).replace(/\..+$/,""):(o=GetFirstTuneTitle(),t>1&&(o+="_Set")),n){var a=GetRadioValue("notenodertab"),r="";switch(a){case"noten":r="";break;case"notenames":r="_Note_Names";break;case"mandolin":r="_Mandolin";break;case"gdad":r="_GDAD";break;case"cgda":r="_CGDA";break;case"cgdae":r="_CGDAE";break;case"dgdae":r="_DGDAE";break;case"guitare":r="_Guitar";break;case"guitard":r="_DADGAD";break;case"uke":r="_Ukulele";break;case"whistle":r="_Whistle"}switch(o+=r,r="",a){case"noten":case"notenames":case"whistle":break;case"mandolin":case"gdad":case"cgda":case"cgdae":case"dgdae":case"guitare":case"guitard":case"uke":gCapo>0&&(r="_Capo_"+gCapo)}o+=r}return o}function ProcessTunesForContinuousLayout(t,n,o){var a=t.length;if(a<=1)return t;var r=[];for(l=0;l<a;++l){c=(g=document.getElementById("notation"+l)).offsetHeight/PDFSCALEFACTOR;var l,s,g,c,d,u,p=[],m=g.children,h=m.length,f=1;o&&(h>2&&(h=2),2==gIncipitsColumns&&(f=2));var A=0;for(s=0;s<h;++s)d=(u=m.item(s)).offsetHeight/PDFSCALEFACTOR,p.push(d/=f),A+=d;o&&(c=A);var b={theElement:g,height:c,staffHeights:p};r.push(b)}var T=n-(PAGETOPOFFSET+PAGEBOTTOMOFFSET),y=T+BETWEENTUNESPACE,I=!0;for(l=0;l<a;++l){0!=l&&t[l-1]&&(y=T+BETWEENTUNESPACE);var v=r[l].height;"landscape"==gPDFOrientation&&(v="letter"==gPDFPaperSize?718*v/535:785*v/535);var C=v+r[l].staffHeights.length/f;if(C>y){if(0!=l&&(t[l-1]=!0),y=T+BETWEENTUNESPACE,C>T){var C,S,_,B=r[l].staffHeights.length;for(s=0;s<B;++s)(S=y-(_=r[l].staffHeights[s]+1))<0&&(y=T),y-=_;y-=BETWEENTUNESPACE/f,I=!1}else y=T+BETWEENTUNESPACE,y-=C,y-=BETWEENTUNESPACE/f,I=!0}else I&&(I=!1),y-=C,y-=BETWEENTUNESPACE/f}return t}function scanTunesForPageBreaks(t,n,o){switch(gPDFOrientation){case"portrait":a=PAGEHEIGHTLETTER,"a4"==n&&(a=PAGEHEIGHTA4);break;case"landscape":a=PAGEHEIGHTLETTER_LANDSCAPE,"a4"==n&&(a=PAGEHEIGHTA4_LANDSCAPE)}var a,r=[],l=gTheABC.value.split(/^X:.*$/gm),s=l.length-1;if(0==s)return r;if(o)for(var g=1;g<=s;++g)r.push(!1);else for(var g=1;g<=s;++g)g>1&&isSectionHeader(l[g])&&(r[g-2]=!0),-1!=l[g].indexOf("%%newpage")?r.push(!0):r.push(!1);return ProcessTunesForContinuousLayout(r,a,o)}function formatDate(t){var n=new Date,o=""+(n.getMonth()+1),a=""+n.getDate(),r=n.getFullYear();return(o.length<2&&(o="0"+o),a.length<2&&(a="0"+a),0==t)?[o,a,r].join("-"):[r,o,a].join("-")}function formatTime(){if(""!=theRenderTime)return theRenderTime;var t=new Date,n=t.getHours(),o=t.getMinutes(),a=" AM";0==n&&(n=12),n>12&&(n-=12,a=" PM"),n=""+n,(o=""+o).length<2&&(o="0"+o);var r=[n,o].join(":");return r+=a,theRenderTime=r,r}function ParseCommentCommands(t){thePageHeader="",thePageFooter="";var n=/^%pageheader.*$/m,o=t.match(n);o&&o.length>0&&(thePageHeader=(thePageHeader=o[0].replace("%pageheader","")).trim()),n=/^%pagefooter.*$/m;var a=t.match(n);a&&a.length>0&&(thePageFooter=(thePageFooter=a[0].replace("%pagefooter","")).trim()),gQRCodeRequested=!1,gDoForceQRCodeURLOverride=!1,gQRCodeURLOverride="",n=/^%qrcode.*$/m;var r=t.match(n);r&&r.length>0&&(gQRCodeRequested=!0,""!=(gQRCodeURLOverride=(gQRCodeURLOverride=r[0].replace("%qrcode","")).trim())&&(gDoForceQRCodeURLOverride=!0)),gDoForceQRCodeCaptionOverride=!1,gQRCodeCaptionOverride="",n=/^%caption_for_qrcode.*$/m;var l=t.match(n);l&&l.length>0&&""!=(gQRCodeCaptionOverride=(gQRCodeCaptionOverride=l[0].replace("%caption_for_qrcode","")).trim())&&(gDoForceQRCodeCaptionOverride=!0),theTunebookIndexTitle="",TunebookIndexRequested=!1,n=/^%addindex.*$/m;var s=t.match(n);s&&s.length>0&&(TunebookIndexRequested=!0,theTunebookIndexTitle=(theTunebookIndexTitle=s[0].replace("%addindex","")).trim()),theTunebookSortedIndexTitle="",TunebookSortedIndexRequested=!1,n=/^%addsortedindex.*$/m;var g=t.match(n);g&&g.length>0&&(TunebookSortedIndexRequested=!0,theTunebookSortedIndexTitle=(theTunebookSortedIndexTitle=g[0].replace("%addsortedindex","")).trim()),TunebookBookmarksAdded=!1,theTunebookTOCTitle="",TunebookTOCRequested=!1,n=/^%addtoc.*$/m;var c=t.match(n);c&&c.length>0&&(TunebookTOCRequested=!0,theTunebookTOCTitle=(theTunebookTOCTitle=c[0].replace("%addtoc","")).trim()),theTunebookSortedTOCTitle="",TunebookSortedTOCRequested=!1,n=/^%addsortedtoc.*$/m;var d=t.match(n);d&&d.length>0&&(TunebookSortedTOCRequested=!0,theTunebookSortedTOCTitle=(theTunebookSortedTOCTitle=d[0].replace("%addsortedtoc","")).trim()),theTunebookTP="",TunebookTPRequested=!1,n=/^%addtitle.*$/m;var u=t.match(n);u&&u.length>0&&(TunebookTPRequested=!0,theTunebookTP=(theTunebookTP=u[0].replace("%addtitle","")).trim()),theTunebookTPST="",TunebookTPSTRequested=!1,n=/^%addsubtitle.*$/m;var p=t.match(n);p&&p.length>0&&(TunebookTPSTRequested=!0,theTunebookTPST=(theTunebookTPST=p[0].replace("%addsubtitle","")).trim()),INDEXFONTSIZE=13,n=/^%indexfontsize.*$/m;var m=t.match(n);if(m&&m.length>0){var h=m[0].replace("%indexfontsize",""),f=parseInt(h=h.trim());!isNaN(f)&&f>0&&(INDEXFONTSIZE=f)}INDEXLINESPACING=12,n=/^%indexlinespacing.*$/m;var A=t.match(n);if(A&&A.length>0){var b=A[0].replace("%indexlinespacing",""),T=parseInt(b=b.trim());!isNaN(T)&&T>=0&&(INDEXLINESPACING=T)}INDEXTITLESIZE=18,n=/^%indextitlefontsize.*$/m;var y=t.match(n);if(y&&y.length>0){var h=y[0].replace("%indextitlefontsize",""),f=parseInt(h=h.trim());!isNaN(f)&&f>0&&(INDEXTITLESIZE=f)}INDEXTITLEOFFSET=35,n=/^%indextitleoffset.*$/m;var I=t.match(n);if(I&&I.length>0){var v=I[0].replace("%indextitleoffset",""),C=parseInt(v=v.trim());!isNaN(C)&&C>=0&&(INDEXTITLEOFFSET=C)}n=/^%indextopoffset.*$/m;var S=t.match(n);if(S&&S.length>0){var _=S[0].replace("%indextopoffset",""),B=parseInt(_=_.trim());!isNaN(B)&&B>=0&&(gINDEXTOPOFFSET=B+300)}TOCFONTSIZE=13,n=/^%tocfontsize.*$/m;var D=t.match(n);if(D&&D.length>0){var h=D[0].replace("%tocfontsize",""),f=parseInt(h=h.trim());!isNaN(f)&&f>0&&(TOCFONTSIZE=f)}TOCLINESPACING=12,n=/^%toclinespacing.*$/m;var E=t.match(n);if(E&&E.length>0){var b=E[0].replace("%toclinespacing",""),T=parseInt(b=b.trim());!isNaN(T)&&T>=0&&(TOCLINESPACING=T)}TOCTITLESIZE=18,n=/^%toctitlefontsize.*$/m;var M=t.match(n);if(M&&M.length>0){var h=M[0].replace("%toctitlefontsize",""),f=parseInt(h=h.trim());!isNaN(f)&&f>0&&(TOCTITLESIZE=f)}TOCTITLEOFFSET=35,n=/^%toctitleoffset.*$/m;var F=t.match(n);if(F&&F.length>0){var v=F[0].replace("%toctitleoffset",""),C=parseInt(v=v.trim());!isNaN(C)&&C>=0&&(TOCTITLEOFFSET=C)}n=/^%toctopoffset.*$/m;var P=t.match(n);if(P&&P.length>0){var _=P[0].replace("%toctopoffset",""),B=parseInt(_=_.trim());!isNaN(B)&&B>=0&&(gTOCTOPOFFSET=B+300)}gTOCLEFTOFFSET=0,n=/^%tocleftoffset.*$/m;var w=t.match(n);if(w&&w.length>0){var R=w[0].replace("%tocleftoffset",""),k=parseInt(R=R.trim());isNaN(k)||(gTOCLEFTOFFSET=k)}gINDEXLEFTOFFSET=0,n=/^%indexleftoffset.*$/m;var L=t.match(n);if(L&&L.length>0){var H=L[0].replace("%indexleftoffset",""),N=parseInt(H=H.trim());isNaN(N)||(gINDEXLEFTOFFSET=N)}gTOCRIGHTOFFSET=0,n=/^%tocrightoffset.*$/m;var O=t.match(n);if(O&&O.length>0){var G=O[0].replace("%tocrightoffset",""),z=parseInt(G=G.trim());isNaN(z)||(gTOCRIGHTOFFSET=z)}gINDEXRIGHTOFFSET=0,n=/^%indexrightoffset.*$/m;var U=t.match(n);if(U&&U.length>0){var W=U[0].replace("%indexrightoffset",""),V=parseInt(W=W.trim());isNaN(V)||(gINDEXRIGHTOFFSET=V)}gPDFQuality=.75,n=/^%pdfquality.*$/m;var Q=t.match(n);if(Q&&Q.length>0){var X=Q[0].replace("%pdfquality",""),Y=parseFloat(X=X.trim());!isNaN(Y)&&Y>=0&&(gPDFQuality=Y)}gIncludePageLinks=!0,n=/^%no_toc_or_index_links.*$/m;var J=t.match(n);J&&J.length>0&&(gIncludePageLinks=!1),gForcePDFFilename="",gDoForcePDFFilename=!1,n=/^%pdfname.*$/m;var q=t.match(n);q&&q.length>0&&(gDoForcePDFFilename=!0,""==(gForcePDFFilename=(gForcePDFFilename=q[0].replace("%pdfname","")).trim())&&(gDoForcePDFFilename=!1)),thePageHeaderURL="",thePageFooterURL="",n=/^%urlpageheader.*$/m;var K=t.match(n);if(K&&K.length>0){var Z=K[0].replace("%urlpageheader ",""),ee=(Z=Z.trim()).split(" ");ee.length>1&&(thePageHeaderURL=ee[0],thePageHeader=(thePageHeader=Z.replace(thePageHeaderURL,"")).trim())}n=/^%urlpagefooter.*$/m;var et=t.match(n);if(et&&et.length>0){var en=et[0].replace("%urlpagefooter ",""),ee=(en=en.trim()).split(" ");ee.length>1&&(thePageFooterURL=ee[0],thePageFooter=(thePageFooter=en.replace(thePageFooterURL,"")).trim())}theTunebookTPURL="",theTunebookTPSTURL="",n=/^%urladdtitle.*$/m;var eo=t.match(n);if(eo&&eo.length>0){var ea=eo[0].replace("%urladdtitle ","");theTunebookTP=ea.trim();var ee=ea.split(" ");ee.length>1&&(theTunebookTPURL=ee[0],theTunebookTP=(theTunebookTP=ea.replace(theTunebookTPURL,"")).trim(),TunebookTPRequested=!0)}n=/^%urladdsubtitle.*$/m;var er=t.match(n);if(er&&er.length>0){var ei=er[0].replace("%urladdsubtitle ","");theTunebookTPST=ei.trim();var ee=ei.split(" ");ee.length>1&&(theTunebookTPSTURL=ee[0],theTunebookTPST=(theTunebookTPST=ei.replace(theTunebookTPSTURL,"")).trim(),TunebookTPSTRequested=!0)}gAddTOCLinkback=!1,n=/^%addlinkbacktotoc.*$/m;var el=t.match(n);el&&el.length>0&&(gAddTOCLinkback=!0),gAddIndexLinkback=!1,n=/^%addlinkbacktoindex.*$/m;var es=t.match(n);es&&es.length>0&&(gAddIndexLinkback=!0),gAddTheSessionHyperlinks=!1,n=/^%add_all_links_to_thesession.*$/m;var eg=t.match(n);eg&&eg.length>0&&(gAddTheSessionHyperlinks=!0),n=/^%addlinkstothesession.*$/m,(eg=t.match(n))&&eg.length>0&&(gAddTheSessionHyperlinks=!0),gInjectEditDisabled=!1,n=/^%no_edit_allowed.*$/m;var ec=t.match(n);ec&&ec.length>0&&(gInjectEditDisabled=!0),gAllSwingHornpipesRequested=!1,gAllSwingHornpipesSwingFactor=gAutoSwingFactor,n=/^%swing_all_hornpipes.*$/m;var ed=t.match(n);if(ed&&ed.length>0){gAllSwingHornpipesRequested=!0;var eu=ed[0].replace("%swing_all_hornpipes","");if(""!=(eu=eu.trim())){var ep=parseFloat(eu);!isNaN(ep)&&ep>=-.9&&ep<=.9&&(gAllSwingHornpipesSwingFactor=ep)}}gAllNoSwingHornpipesRequested=!1,n=/^%noswing_all_hornpipes.*$/m;var em=t.match(n);em&&em.length>0&&(gAllNoSwingHornpipesRequested=!0),gAddPlaybackHyperlinks=!1,gAddPlaybackHyperlinksIncludePrograms=!1,n=/^%add_all_playback_links.*$/m;var eh=t.match(n);if(eh&&eh.length>0){gAddPlaybackHyperlinks=!0;var ef=eh[0].replace("%add_all_playback_links",""),eA=(ef=ef.trim()).match(/\b(\w+)\b/g);gPlaybackHyperlinkMelodyProgram=gTheMelodyProgram,gPlaybackHyperlinkBassProgram=gTheBassProgram,gPlaybackHyperlinkChordProgram=gTheChordProgram,gPlaybackHyperlinkSoundFont="fluid",-1!=gDefaultSoundFont.indexOf("FluidR3_GM")?gPlaybackHyperlinkSoundFont="fluid":-1!=gDefaultSoundFont.indexOf("Musyng")?gPlaybackHyperlinkSoundFont="musyng":-1!=gDefaultSoundFont.indexOf("fatboy")?gPlaybackHyperlinkSoundFont="fatboy":-1!=gDefaultSoundFont.indexOf("canvas")?gPlaybackHyperlinkSoundFont="canvas":-1!=gDefaultSoundFont.indexOf("mscore")?gPlaybackHyperlinkSoundFont="mscore":-1!=gDefaultSoundFont.indexOf("arachno")?gPlaybackHyperlinkSoundFont="arachno":-1!=gDefaultSoundFont.indexOf("fluidhq")&&(theSoundFont="fluidhq"),eA&&eA.length>0?(gAddPlaybackHyperlinksIncludePrograms=!0,eA.length>=1&&(gPlaybackHyperlinkMelodyProgram=(gPlaybackHyperlinkMelodyProgram=eA[0]).trim()),eA.length>=2&&(gPlaybackHyperlinkBassProgram=(gPlaybackHyperlinkBassProgram=eA[1]).trim()),eA.length>=3&&(gPlaybackHyperlinkChordProgram=(gPlaybackHyperlinkChordProgram=eA[2]).trim()),eA.length>=4&&(gPlaybackHyperlinkSoundFont=(gPlaybackHyperlinkSoundFont=eA[3]).trim())):gAddPlaybackHyperlinksIncludePrograms=!1}if(gOpenInEditor=!1,!gInjectEditDisabled){n=/^%links_open_in_editor.*$/m;var eb=t.match(n);eb&&eb.length>0&&(gOpenInEditor=!0,gAddPlaybackHyperlinks=!0,gAddPlaybackHyperlinksIncludePrograms=!1)}gAddAllFonts=!1,n=/^%add_all_fonts.*$/m;var eT=t.match(n);eT&&eT.length>0&&(gAddAllFonts=!0),gAddPlaybackHyperlinkVolumes=!1,n=/^%add_all_playback_volumes.*$/m;var ey=t.match(n);if(ey&&ey.length>0){gPlaybackHyperlinkBassVolume=gTheBassVolume,gPlaybackHyperlinkChordVolume=gTheChordVolume;var ef=ey[0].replace("%add_all_playback_volumes",""),eA=(ef=ef.trim()).match(/\b(\w+)\b/g);eA&&eA.length>0&&(gAddPlaybackHyperlinkVolumes=!0,eA.length>=1&&(gPlaybackHyperlinkBassVolume=(gPlaybackHyperlinkBassVolume=eA[0]).trim()),eA.length>=2&&(gPlaybackHyperlinkChordVolume=(gPlaybackHyperlinkChordVolume=eA[1]).trim()))}gAddTunebookPlaybackHyperlinks=!1,n=/^%playback_links_are_complete_tunebook.*$/m;var eI=t.match(n);eI&&eI.length>0&&(gAddTunebookPlaybackHyperlinks=!0),theTunebookTOCHeader="",TunebookTOCHeaderRequested=!1,n=/^%tocheader.*$/m;var ev=t.match(n);ev&&ev.length>0&&(TunebookTOCHeaderRequested=!0,theTunebookTOCHeader=(theTunebookTOCHeader=ev[0].replace("%tocheader","")).trim()),theTunebookIndexHeader="",TunebookTOCIndexHeaderRequested=!1,n=/^%indexheader.*$/m;var e$=t.match(n);e$&&e$.length>0&&(TunebookIndexHeaderRequested=!0,theTunebookIndexHeader=(theTunebookIndexHeader=e$[0].replace("%indexheader","")).trim()),n=/^%pdf_between_tune_space.*$/m,gBetweenTuneSpace=20,gGotBetweenTuneSpace=!1;var eC=t.match(n);if(eC&&eC.length>0){var eC=eC[0].replace("%pdf_between_tune_space",""),e8=parseInt(eC=eC.trim());!isNaN(e8)&&e8>=0&&(gBetweenTuneSpace=e8,gGotBetweenTuneSpace=!0)}n=/^%pdffont.*$/m;var eS=t.match(n);if(eS&&eS.length>0){var ex=(eS=(eS=eS[0].replace("%pdffont","")).trim()).split(" ");ex&&ex.length>1?(gPDFFont=ex[0],gPDFFontStyle=ex[1]):(gPDFFont=eS,gPDFFontStyle=""),"normal"==gPDFFontStyle.toLowerCase()&&(gPDFFontStyle="");var e_=gPDFFont.toLowerCase();switch(e_){case"times":"oblique"==gPDFFontStyle.toLowerCase()?gPDFFontStyle="Italic":"boldoblique"==gPDFFontStyle.toLowerCase()&&(gPDFFontStyle="BoldItalic");break;case"helvetica":case"courier":break;default:gPDFFont="Times",gPDFFontStyle=""}var eB=gPDFFontStyle.toLowerCase();if(""!=eB)switch(eB){case"normal":case"bold":case"oblique":case"boldoblique":case"italic":case"bolditalic":break;default:gPDFFontStyle=""}}TunebookTOCWithNoPageNumbers=!1,n=/^%toc_no_page_numbers.*$/m;var eD=t.match(n);eD&&eD.length>0&&(TunebookTOCWithNoPageNumbers=!0),TunebookIndexWithNoPageNumbers=!1,n=/^%index_no_page_numbers.*$/m;var eE=t.match(n);eE&&eE.length>0&&(TunebookIndexWithNoPageNumbers=!0)}function ProcessHeaderFooter(t,n,o){var a=getDescriptiveFileName(o,!0);if(gDoForcePDFFilename){var r=a;""==(a=(a=(a=gForcePDFFilename).trim()).replace(".pdf",""))&&(a=r)}var l=t.replace("$PDFNAME",a+".pdf");l=(l=(l=l.replace("$PAGENUMBER",n)).replace("$TUNECOUNT",totalTunes)).replace("$TUNENAMES",theHeaderFooterTuneNames);var s=formatDate(0),g=formatDate(1);l=(l=l.replace("$DATEMDY",s)).replace("$DATEYMD",g);var c=formatTime();return l.replace("$TIME",c)}function calcPageNumberVerticalOffset(t){thePageNumberVerticalOffset=t.internal.pageSize.getHeight()-9}function AddPageHeaderFooter(t,n,o,a,r,l){var s=gPAGENUMBERTOP;t.setFont(gPDFFont,gPDFFontStyle,"normal"),t.setFontSize(HEADERFOOTERFONTSIZE);var g=!1;if(thePageHeader&&""!=thePageHeader){var c=ProcessHeaderFooter(thePageHeader,o,totalTunes);if(thePageHeaderURL&&""!=thePageHeaderURL){var d=t.getTextWidth(c);t.textWithLink(c,t.internal.pageSize.getWidth()/3.1-d/2,s,{align:"left",url:thePageHeaderURL})}else t.text(c,t.internal.pageSize.getWidth()/3.1,s,{align:"center"});g=!0}var u=!1;if(thePageFooter&&""!=thePageFooter){var p=ProcessHeaderFooter(thePageFooter,o,totalTunes);if(thePageFooterURL&&""!=thePageFooterURL){var d=t.getTextWidth(p);t.textWithLink(p,t.internal.pageSize.getWidth()/3.1-d/2,thePageNumberVerticalOffset,{align:"center",url:thePageFooterURL})}else t.text(p,t.internal.pageSize.getWidth()/3.1,thePageNumberVerticalOffset,{align:"center"});u=!0}if(n&&(!r||1!=o)){t.setFont(gPDFFont,gPDFFontStyle,"normal"),t.setFontSize(HEADERFOOTERFONTSIZE);var m=""+o;switch(a){case"tl":t.text(m,13,s,{align:"center"});break;case"tc":g||t.text(m,t.internal.pageSize.getWidth()/3.1,s,{align:"center"});break;case"tr":t.text(m,t.internal.pageSize.getWidth()/1.55-12,s,{align:"center"});break;case"bl":t.text(m,13,thePageNumberVerticalOffset,{align:"center"});break;case"bc":u||t.text(m,t.internal.pageSize.getWidth()/3.1,thePageNumberVerticalOffset,{align:"center"});break;case"br":t.text(m,t.internal.pageSize.getWidth()/1.55-12,thePageNumberVerticalOffset,{align:"center"});break;case"tlr":o%2==1?t.text(m,13,s,{align:"center"}):t.text(m,t.internal.pageSize.getWidth()/1.55-12,s,{align:"center"});break;case"trl":o%2==1?t.text(m,t.internal.pageSize.getWidth()/1.55-12,s,{align:"center"}):t.text(m,13,s,{align:"center"});break;case"blr":o%2==1?t.text(m,13,thePageNumberVerticalOffset,{align:"center"}):t.text(m,t.internal.pageSize.getWidth()/1.55-12,thePageNumberVerticalOffset,{align:"center"});break;case"brl":o%2==1?t.text(m,t.internal.pageSize.getWidth()/1.55-12,thePageNumberVerticalOffset,{align:"center"}):t.text(m,13,thePageNumberVerticalOffset,{align:"center"})}}}function PrimeWhistleRender(t,n){if(t.length<2){n();return}var o=t[0].querySelector("svg");theOffscreen.innerHTML="<div>"+o.outerHTML+"</div>",(o=theOffscreen.querySelector("svg")).setAttribute("width",gQualitaet),htmlToImage.toCanvas(o,{backgroundColor:"white",style:{background:"white"},pixelRatio:gPDFQuality*gRenderPixelRatio}).then(function(o){var a=t[1].querySelector("svg");theOffscreen.innerHTML="<div>"+a.outerHTML+"</div>",(a=theOffscreen.querySelector("svg")).setAttribute("width",gQualitaet),htmlToImage.toCanvas(a,{backgroundColor:"white",style:{background:"white"},pixelRatio:gPDFQuality*gRenderPixelRatio}).then(function(o){var a,r=(a=t.length<3?t[1]:t[2]).querySelector("svg");theOffscreen.innerHTML="<div>"+r.outerHTML+"</div>",(r=theOffscreen.querySelector("svg")).setAttribute("width",gQualitaet),htmlToImage.toCanvas(r,{backgroundColor:"white",style:{background:"white"},pixelRatio:gPDFQuality*gRenderPixelRatio}).then(function(t){n()})})})}function RenderPDFBlock(t,n,o,a,r,l,s,g,c,d){if(null!=t&&void 0!=t){var u=1;if(c){var p=t.id+".block";if(-1==p.indexOf("_0.block")&&-1==p.indexOf("_1.block")){d();return}2==gIncipitsColumns&&(u=2)}var m=t.querySelector("svg");theOffscreen.innerHTML="<div>"+m.outerHTML+"</div>",(m=theOffscreen.querySelector("svg")).setAttribute("width",gQualitaet),htmlToImage.toCanvas(m,{backgroundColor:"white",style:{background:"white"},pixelRatio:gPDFQuality*gRenderPixelRatio}).then(function(n){var r,l=PAGELEFTOFFSET;"a4"==g&&(l=PAGELEFTOFFSETA4);var s=l,p=l+gPageWidth/2;switch(1==column_number&&(l=p),gPDFOrientation){case"portrait":r=PAGEHEIGHTLETTER,"a4"==g&&(r=PAGEHEIGHTA4);break;case"landscape":r=PAGEHEIGHTLETTER_LANDSCAPE,"a4"==g&&(r=PAGEHEIGHTA4_LANDSCAPE)}pdf.internal.scaleFactor=PDFSCALEFACTOR;var m=n.toDataURL("image/jpeg",PDFJPGQUALITY),h=t.id+".block",f=!1;-1!=h.indexOf("_0.block")&&(f=!0,isFirstPage?(isFirstPage=!1,calcPageNumberVerticalOffset(pdf)):o?(gMixedNotationAndQRCode&&(theCurrentPageNumber++,pdf.addPage(g,gPDFOrientation)),running_height=PAGETOPOFFSET,theCurrentPageNumber++,pdf.addPage(g,gPDFOrientation),document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"):a[tunesProcessed-1]?c?2==gIncipitsColumns&&0==column_number?(running_height=PAGETOPOFFSET,column_number=1,l=p):(running_height=PAGETOPOFFSET,theCurrentPageNumber++,pdf.addPage(g,gPDFOrientation),document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages",column_number=0,l=s):(running_height=PAGETOPOFFSET,theCurrentPageNumber++,pdf.addPage(g,gPDFOrientation),document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"):running_height+=BETWEENTUNESPACE/u,theTunePageMap[tunesProcessed]=theCurrentPageNumber,++tunesProcessed<totalTunes&&(document.getElementById("statustunecount").innerHTML='Rendering tune <font color="red">'+(tunesProcessed+1)+'</font> of  <font color="red">'+totalTunes+"</font>")),height=parseInt(n.height*gPageWidth/n.width),running_height+(height/=u)<=r-PAGEBOTTOMOFFSET?(f&&gTuneHyperlinks.push({page:theCurrentPageNumber,x:l,y:running_height,width:gPageWidth/u,height:height,url:""}),pdf.addImage(m,"JPG",l,running_height,gPageWidth/u,height)):(running_height=PAGETOPOFFSET,theCurrentPageNumber++,f&&(gTuneHyperlinks.push({page:theCurrentPageNumber,x:l,y:running_height,width:gPageWidth/u,height:height,url:""}),theTunePageMap[tunesProcessed-1]=theCurrentPageNumber),pdf.addPage(g,gPDFOrientation),pdf.addImage(m,"JPG",l,running_height,gPageWidth/u,height),document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),running_height=running_height+height+1/u,d(!0)})}}function promptForPDFFilename(t,n){if(ParseCommentCommands(gTheABC.value),gDoForcePDFFilename){var o=t;""==(t=(t=(t=gForcePDFFilename).trim()).replace(".pdf",""))&&(t=o)}t=(t=(t=cleanTitleNumber(t)).trim()).replace(/^[_]+/,""),DayPilot.Modal.prompt("Please enter a filename for your PDF file:",t+".pdf",{theme:"modal_flat",top:200,autoFocus:!1,scrollWithPage:AllowDialogsToScroll()}).then(function(t){var o=t.result;null==o||(0!=(o=o.replace(/[^a-zA-Z0-9_\-. ]+/ig,"")).length?isDesktopBrowser()&&o.endsWith(".pdf")||(o=o.replace(/\..+$/,""),o+=".pdf"):o=null),n(o)})}function ShowAcrobatHyperlinkLengthWarning(){sendGoogleAnalytics("dialog","ShowAcrobatHyperlinkLengthWarning");var t='<p style="text-align:center;font-size:18pt;font-family:helvetica;">Adobe Acrobat Hyperlink Length Warning</p>';t+='<p style="font-size:12pt;line-height:18pt;margin-top:36px;">Adobe Acrobat limits the length of clicked hyperlinks to 2076 characters.</p>',t+='<p style="font-size:12pt;line-height:18pt;">Some very complex tune Share URLs used in tunebooks generated with this tool may exceed this limit.</p>',t+='<p style="font-size:12pt;line-height:18pt;">If you are using Adobe Acrobat as your PDF reader, and you are seeing this message after clicking a complex tune link, try instead simply dragging the PDF of the tunebook to your browser to read it.</p>',t+='<p style="font-size:12pt;line-height:18pt;">The PDF readers built into most modern browsers do not have this hyperlink length limitation and will properly open the tune hyperlink when clicked.</p>',DayPilot.Modal.alert(t,{theme:"modal_flat",top:100,width:700,scrollWithPage:AllowDialogsToScroll()})}function ShowHyperlinkBadDecodeAlert(){sendGoogleAnalytics("dialog","ShowHyperlinkBadDecodeAlert");var t='<p style="text-align:center;font-size:18pt;font-family:helvetica;">Problem Decoding Tune Share URL</p>';t+='<p style="font-size:12pt;line-height:18pt;margin-top:36px;text-align:center;">An unrecoverable error occured when decoding this tune ShareURL.</p>',DayPilot.Modal.alert(t,{theme:"modal_flat",top:100,width:700,scrollWithPage:AllowDialogsToScroll()})}function ShowAcrobatURLSizeWarningDialog(){sendGoogleAnalytics("dialog","ShowAcrobatURLSizeWarningDialog");var t='<p style="text-align:center;font-size:18pt;font-family:helvetica;">Adobe Acrobat Maximum URL Length Warning</p>';if(gAddTunebookPlaybackHyperlinks)t+='<p style="font-size:12pt;line-height:18pt;margin-top:36px;">During PDF export play hyperlink embedding, the entire tunebook play hyperlink length of '+gAcrobatURLLimitExceeded[0].urllength+" characters exceeded the Adobe Acrobat maximum URL length of 2076 characters.</p>",t+='<p style="font-size:12pt;line-height:18pt;">These play links will work with the built-in PDF reader on most web browsers and online PDF readers, many non-Adobe desktop and mobile PDF readers, but will not open correctly if the tune title is clicked when the PDF is viewed using Adobe Acrobat:</p>',t+='<p style="font-size:12pt;line-height:18pt;margin-top:24px">If Adobe Acrobat is your target PDF reader, your best option is to use the per-tune %hyperlink directive in these tunes with a shortened play Share URL to the entire tunebook manually generated using the Sharing dialog.</p>';else{t+='<p style="font-size:12pt;line-height:18pt;margin-top:36px;">During PDF export play hyperlink embedding, some very long and complex tunes had play hyperlinks that exceeded the Adobe Acrobat maximum URL length of 2076 characters.</p>',t+='<p style="font-size:12pt;line-height:18pt;">These play links will work with the built-in PDF reader on most web browsers and online PDF readers, many non-Adobe desktop and mobile PDF readers, but will not open correctly if the tune title is clicked when the PDF is viewed using Adobe Acrobat:</p>';for(var n=gAcrobatURLLimitExceeded.length,o=0;o<n;++o)t+='<p style="font-size:12pt;line-height:10pt;">"'+gAcrobatURLLimitExceeded[o].name+'"&nbsp;-&nbsp;URL length: '+gAcrobatURLLimitExceeded[o].urllength+"</p>";t+='<p style="font-size:12pt;line-height:18pt;margin-top:24px">If Adobe Acrobat is your target PDF reader, your best option is to use the per-tune %hyperlink directive in these tunes with a shortened play Share URL manually generated using the Sharing dialog.</p>'}DayPilot.Modal.alert(t,{theme:"modal_flat",top:75,width:700,scrollWithPage:AllowDialogsToScroll()}).then(function(){gAcrobatURLLimitExceeded=[]})}function ExportPDF(){if(!gRenderingPDF&&gAllowPDF){var t=getPDFFormat(),n="incipits_abc"==t||"incipits_a4_abc"==t||"incipits_abc_sort"==t||"incipits_a4_abc_sort"==t||"incipits_abc_full"==t||"incipits_a4_abc_full"==t||"incipits_abc_full_cce"==t||"incipits_a4_abc_full_cce"==t,o="all_qr_codes"==t||"all_qr_codes_a4"==t,a="incipits_abc_full"==t||"incipits_a4_abc_full"==t||"incipits_abc_full_cce"==t||"incipits_a4_abc_full_cce"==t,r="incipits_abc_full_cce"==t||"incipits_a4_abc_full_cce"==t;(gMixedNotationAndQRCode="mixed_notation_qr"==t||"mixed_notation_qr_a4"==t)&&setPDFFormat(t="mixed_notation_qr"==t?"one":"one_a4"),totalTunes=CountTunes();var l=getDescriptiveFileName(totalTunes,!0);if(o)promptForPDFFilename(l+="_QR_Codes",function(t){t&&ExportTextIncipitsPDF(t,a,r,!0)});else if(n)a?r?l+="_Comhaltas":l+="_ABC":l+="_Incipits",promptForPDFFilename(l,function(t){t&&ExportTextIncipitsPDF(t,a,r,!1)});else{if(gDisableNotationRendering){var s="Notation PDF export not possible with rendering disabled.";s=makeCenteredPromptString(s),DayPilot.Modal.alert(s,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});return}var t=getPDFFormat();("incipits"==t||"incipits_a4"==t)&&(l+="_Incipits"),gMixedNotationAndQRCode&&(l+="_Notation_QR"),promptForPDFFilename(l,function(t){t&&(gOriginalWidthBeforePDFExport=gTheNotation.style.width,gTheNotation.style.width="850px",ExportNotationPDF(t))})}}}function ExportTextIncipitsPDF(t,n,o,a){gPDFCancelRequested=!1;var r=getPDFFormat();document.getElementById("pdf-controls").style.display="block";var l=getPageNumbers(),s="none"!=l,g="letter";("incipits_a4_abc"==r||"incipits_a4_abc_sort"==r||"incipits_a4_abc_full"==r||"incipits_a4_abc_full_cce"==r||"all_qr_codes_a4"==r)&&(g="a4");var c=!1;("incipits_abc_sort"==r||"incipits_a4_abc_sort"==r)&&(c=!0);var d=!1;"no"==getFirstPage()&&(d=!0),ParseCommentCommands(gTheABC.value),theRenderTime="",theHeaderFooterTuneNames=GetAllTuneTitles(),theCurrentPageNumber=1,totalTunes=CountTunes(),isFirstPage=!0,document.getElementById("statuspdfname").innerHTML='Generating <font color="blue">'+t+"</font>",document.getElementById("statustunecount").innerHTML="",document.getElementById("pagestatustext").innerHTML="&nbsp;",gRenderingPDF=!0,(pdf=new jsPDF(gPDFOrientation,"pt",g)).setDisplayMode("fullpage","single","UseNone"),pdf.internal.scaleFactor=PDFSCALEFACTOR,calcPageNumberVerticalOffset(pdf),gTuneHyperlinks=[],setTimeout(function(){var r=[];function u(){if(gPDFCancelRequested){gRenderingPDF=!1,document.getElementById("pdf-controls").style.display="none";return}var n=theCurrentPageNumber;TunebookTPRequested&&(pdf.addPage(g,gPDFOrientation),theCurrentPageNumber++,pdf.movePage(theCurrentPageNumber,1));var o=theCurrentPageNumber,a=1,u=1;TunebookTOCRequested&&DryRunAddTuneTOC(pdf,l,d,g,r,theTunebookSortedTOCTitle,!1,c),u=theCurrentPageNumber-o,u++,TunebookSortedTOCRequested&&DryRunAddTuneTOC(pdf,l,d,g,r,theTunebookSortedTOCTitle,!0,c),theTOCDelta=theCurrentPageNumber-o,theCurrentPageNumber=o,TunebookTPRequested&&(a++,u++,theTOCDelta++),TunebookTOCRequested&&(document.getElementById("statustunecount").innerHTML="Adding Table of Contents",AppendTuneTOC(pdf,l,d,g,r,theTunebookTOCTitle,c,c,gIncludePageLinks,theTOCDelta,a),document.getElementById("statustunecount").innerHTML="Table of Contents Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),TunebookSortedTOCRequested&&(document.getElementById("statustunecount").innerHTML="Adding Sorted Table of Contents",AppendTuneTOC(pdf,l,d,g,r,theTunebookSortedTOCTitle,!0,c,gIncludePageLinks,theTOCDelta,u),document.getElementById("statustunecount").innerHTML="Sorted Table of Contents Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),TunebookTPRequested&&(document.getElementById("statustunecount").innerHTML="Adding Title Page",AppendTuneTitlePage(pdf,g,theTunebookTP,theTunebookTPST),document.getElementById("statustunecount").innerHTML="Title Page Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),o=theCurrentPageNumber-o,TunebookTPRequested&&o++,(TunebookTOCRequested||TunebookSortedTOCRequested)&&(o=theTOCDelta),PostProcessHeadersAndFooters(pdf,s,o+1,n,l,d,g),TunebookIndexRequested&&(document.getElementById("statustunecount").innerHTML="Adding Tunebook Index",AppendTunebookIndex(pdf,l,d,g,r,theTunebookIndexTitle,c,c,gIncludePageLinks,o),document.getElementById("statustunecount").innerHTML="Tunebook Index Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),TunebookSortedIndexRequested&&(document.getElementById("statustunecount").innerHTML="Adding Tunebook Sorted Index",AppendTunebookIndex(pdf,l,d,g,r,theTunebookSortedIndexTitle,!0,c,gIncludePageLinks,o),document.getElementById("statustunecount").innerHTML="Tunebook Sorted Index Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages");var p=!1,m=1,h=!1,f=1,A=theTOCDelta+1,b=theTOCDelta+n;if(gAddTOCLinkback&&(TunebookTOCRequested||TunebookSortedTOCRequested)&&(p=!0,TunebookTPRequested&&(m=2)),gAddIndexLinkback&&(TunebookIndexRequested||TunebookSortedIndexRequested)&&(h=!0,f=n+theTOCDelta+1),(p||h)&&PostProcessTOCAndIndexLinks(pdf,A,b,p,m,h,f),gTuneHyperlinks.length>0&&PostProcessTuneHyperlinks(pdf,gTuneHyperlinks,g,A),gQRCodeRequested)document.getElementById("statustunecount").innerHTML="Adding Tunebook QR Code",AppendQRCode(pdf,g,function t(n){n?(theCurrentPageNumber++,document.getElementById("statustunecount").innerHTML="Tunebook QR Code Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"):document.getElementById("statustunecount").innerHTML="Share URL too long for QR Code, try sharing fewer tunes";var o=1e3;n||(o=4e3),setTimeout(function(){document.getElementById("statustunecount").innerHTML="&nbsp;",T()},o)});else{T();return}function T(){document.getElementById("statuspdfname").innerHTML='<font color="darkgreen">Rendering Complete!</font>',setTimeout(function(){document.getElementById("statuspdfname").innerHTML='Saving <font color="blue">'+t+"</font>",setTimeout(function(){if(isMobileBrowser()){var n=pdf.output("blob",{filename:t}),o=new Blob([n],{type:"application/octet-stream"}),a=document.createElement("a");document.body.appendChild(a),a.style="display: none",url=window.URL.createObjectURL(o),a.href=url,a.download=t,a.click(),document.body.removeChild(a),setTimeout(function(){window.URL.revokeObjectURL(url)},1e3)}else pdf.save(t);document.getElementById("statuspdfname").innerHTML="&nbsp;",document.getElementById("statustunecount").innerHTML="&nbsp;",document.getElementById("pagestatustext").innerHTML="&nbsp;",document.getElementById("pdf-controls").style.display="none",gRenderingPDF=!1},1500)},2e3)}}a?(sendGoogleAnalytics("export","PDFQRCodes"),r=GenerateFullTuneQRCodes(pdf,s,l,d,g,r,function t(n){r=n,document.getElementById("statustunecount").innerHTML="All QR Codes Added!",u()})):n?(sendGoogleAnalytics("export","PDFFullText"),r=GenerateFullTextIncipits(pdf,s,l,d,g,r,!1,o),document.getElementById("statustunecount").innerHTML="Full ABC Text Added!",u()):(sendGoogleAnalytics("export","PDFTextIncipits"),r=GenerateTextIncipits(pdf,s,l,d,g,r,c),document.getElementById("statustunecount").innerHTML="ABC Incipits Added!",u())},250)}function ExportNotationPDF(t){gPDFCancelRequested=!1,gPDFTabselected=GetRadioValue("notenodertab"),document.getElementById("pdf-controls").style.display="block";var n=getPDFFormat(),o=getPageNumbers(),a="one"==n||"one_a4"==n,r="none"!=o,l="letter";("one_a4"==n||"multi_a4"==n||"incipits_a4"==n)&&(l="a4");var s="incipits"==n||"incipits_a4"==n,g=!1;"no"==getFirstPage()&&(g=!0),ParseCommentCommands(gTheABC.value),theRenderTime="",theHeaderFooterTuneNames=GetAllTuneTitles(),theCurrentPageNumber=1,tunesProcessed=0,column_number=0,theTunePageMap=[],totalTunes=CountTunes(),isFirstPage=!0;var c=0,d=[],u=null,p=0,m=null,h=!1;function f(){sendGoogleAnalytics("export","PDFFull"),running_height=PAGETOPOFFSET,document.getElementById("statuspdfname").innerHTML='Generating <font color="blue">'+t+"</font>",document.getElementById("statustunecount").innerHTML="Processing notation for PDF generation",document.getElementById("pagestatustext").innerHTML="&nbsp;",theOffscreen=document.getElementById("offscreenrender"),PrepareSVGDivsForRasterization(),document.getElementById("statustunecount").innerHTML='Rendering tune <font color="red">1</font> of  <font color="red">'+totalTunes+"</font>",theTunePageMap[0]=theCurrentPageNumber,gRenderingPDF=!0,(pdf=new jsPDF(gPDFOrientation,"pt",l)).setDisplayMode("fullpage","single","UseNone"),d=[],a||(d=scanTunesForPageBreaks(pdf,l,s)),p=(u=document.querySelectorAll('div[class="block"]')).length,m=u[0],"whistle"==gPDFTabselected?PrimeWhistleRender(u,A):A()}function A(){setTimeout(function(){RenderPDFBlock(m,0,a,d,r,o,g,l,s,n);function n(){if(gPDFCancelRequested){(gRenderingPDF=!1,gTheNotation.style.width=gOriginalWidthBeforePDFExport,pdf=null,u=null,h)?(document.getElementById("statuspdfname").innerHTML='<font color="red">Cleaning up after PDF generation</font>',RenderAsync(!0,null,function(){document.getElementById("pdf-controls").style.display="none",document.getElementById("offscreenrender").innerHTML=""})):(document.getElementById("pdf-controls").style.display="none",RestoreSVGDivsAfterRasterization()),gMixedNotationAndQRCode&&("a4"==l?setPDFFormat("mixed_notation_qr_a4"):setPDFFormat("mixed_notation_qr"),SavePDFSettings());return}if(++c==p){gMixedNotationAndQRCode&&(theCurrentPageNumber++,pdf.addPage(l,gPDFOrientation));var f=theCurrentPageNumber;function A(){TunebookTPRequested&&(pdf.addPage(l,gPDFOrientation),theCurrentPageNumber++,pdf.movePage(theCurrentPageNumber,1));var n=theCurrentPageNumber,a=1,s=1;TunebookTOCRequested&&DryRunAddTuneTOC(pdf,o,g,l,theTunePageMap,theTunebookTOCTitle,!1,!1),s=theCurrentPageNumber-n,s++,TunebookSortedTOCRequested&&DryRunAddTuneTOC(pdf,o,g,l,theTunePageMap,theTunebookSortedTOCTitle,!0,!1),theTOCDelta=theCurrentPageNumber-n,theCurrentPageNumber=n,TunebookTPRequested&&(a++,s++,theTOCDelta++),TunebookTOCRequested&&(document.getElementById("statustunecount").innerHTML="Adding Table of Contents",AppendTuneTOC(pdf,o,g,l,theTunePageMap,theTunebookTOCTitle,!1,!1,gIncludePageLinks,theTOCDelta,a),document.getElementById("statustunecount").innerHTML="Table of Contents Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),TunebookSortedTOCRequested&&(document.getElementById("statustunecount").innerHTML="Adding Sorted Table of Contents",AppendTuneTOC(pdf,o,g,l,theTunePageMap,theTunebookSortedTOCTitle,!0,!1,gIncludePageLinks,theTOCDelta,s),document.getElementById("statustunecount").innerHTML="Sorted Table of Contents Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),TunebookTPRequested&&(document.getElementById("statustunecount").innerHTML="Adding Title Page",AppendTuneTitlePage(pdf,l,theTunebookTP,theTunebookTPST),document.getElementById("statustunecount").innerHTML="Title Page Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),n=theCurrentPageNumber-n,TunebookTPRequested&&n++,(TunebookTOCRequested||TunebookSortedTOCRequested)&&(n=theTOCDelta),PostProcessHeadersAndFooters(pdf,r,n+1,f,o,g,l),TunebookIndexRequested&&(document.getElementById("statustunecount").innerHTML="Adding Tunebook Index",AppendTunebookIndex(pdf,o,g,l,theTunePageMap,theTunebookIndexTitle,!1,!1,gIncludePageLinks,n),document.getElementById("statustunecount").innerHTML="Tunebook Index Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),TunebookSortedIndexRequested&&(document.getElementById("statustunecount").innerHTML="Adding Tunebook Sorted Index",AppendTunebookIndex(pdf,o,g,l,theTunePageMap,theTunebookSortedIndexTitle,!0,!1,gIncludePageLinks,n),document.getElementById("statustunecount").innerHTML="Tunebook Sorted Index Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages");var c=!1,d=1,u=!1,p=1,m=theTOCDelta+1,A=theTOCDelta+f;if(gAddTOCLinkback&&(TunebookTOCRequested||TunebookSortedTOCRequested)&&(c=!0,TunebookTPRequested&&(d=2)),gAddIndexLinkback&&(TunebookIndexRequested||TunebookSortedIndexRequested)&&(u=!0,p=f+theTOCDelta+1),(c||u)&&PostProcessTOCAndIndexLinks(pdf,m,A,c,d,u,p),gTuneHyperlinks.length>0&&PostProcessTuneHyperlinks(pdf,gTuneHyperlinks,l,m),gQRCodeRequested)document.getElementById("statustunecount").innerHTML="Adding Tunebook QR Code",AppendQRCode(pdf,l,function t(n){n?(theCurrentPageNumber++,document.getElementById("statustunecount").innerHTML="Tunebook QR Code Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"):document.getElementById("statustunecount").innerHTML="Share URL too long for QR Code, try sharing fewer tunes";var o=1e3;n||(o=4e3),setTimeout(function(){document.getElementById("statustunecount").innerHTML="&nbsp;",b()},o)});else{b();return}function b(){document.getElementById("statuspdfname").innerHTML='<font color="darkgreen">Rendering Complete!</font>',setTimeout(function(){t&&(document.getElementById("statuspdfname").innerHTML='Saving <font color="blue">'+t+"</font>"),setTimeout(function(){if(isMobileBrowser()){var n=pdf.output("blob",{filename:t}),o=new Blob([n],{type:"application/octet-stream"}),a=document.createElement("a");document.body.appendChild(a),a.style="display: none",url=window.URL.createObjectURL(o),a.href=url,a.download=t,a.click(),document.body.removeChild(a),setTimeout(function(){window.URL.revokeObjectURL(url)},1e3)}else pdf.save(t);function r(){document.getElementById("statuspdfname").innerHTML="&nbsp;",document.getElementById("statustunecount").innerHTML="&nbsp;",document.getElementById("pagestatustext").innerHTML="&nbsp;",document.getElementById("pdf-controls").style.display="none",gAcrobatURLLimitExceeded.length>0&&ShowAcrobatURLSizeWarningDialog(),gMixedNotationAndQRCode&&("a4"==l?setPDFFormat("mixed_notation_qr_a4"):setPDFFormat("mixed_notation_qr"),SavePDFSettings())}h?(document.getElementById("statuspdfname").innerHTML='<font color="red">Cleaning up after PDF generation</font>',setTimeout(function(){gRenderingPDF=!1,gTheNotation.style.width=gOriginalWidthBeforePDFExport,Render(!0,null),document.getElementById("offscreenrender").innerHTML="",r()},100)):(RestoreSVGDivsAfterRasterization(),r(),gRenderingPDF=!1,gTheNotation.style.width=gOriginalWidthBeforePDFExport)},1500)},2e3)}}gMixedNotationAndQRCode?PostProcessMixedNotationAndQRCode(pdf,o,g,l,theTunePageMap,f,A):A()}else{if(c>u.length)return;c>0&&(u[c-1]=null),(m=u[c])&&RenderPDFBlock(m,c,a,d,r,o,g,l,s,n)}}},250)}gTuneHyperlinks=[],BETWEENTUNESPACE=gBetweenTuneSpace,s?(sendGoogleAnalytics("export","PDFIncipits"),1!=gIncipitsColumns||gGotBetweenTuneSpace||(BETWEENTUNESPACE=0),IdleAdvancedControls(!1),IdleAllowShowTabNames(),gRawMode||gAllowFilterAnnotations&&!gStripAnnotations||gAllowFilterText&&!gStripTextAnnotations||gAllowShowTabNames&&gShowTabNames?(document.getElementById("statuspdfname").innerHTML='Generating <font color="blue">'+t+"</font>",document.getElementById("statustunecount").innerHTML="Processing Incipits for PDF generation",document.getElementById("pagestatustext").innerHTML="&nbsp;",setTimeout(function(){var t=gStripAnnotations;gStripAnnotations=!0;var n=gStripTextAnnotations;gStripTextAnnotations=!0;var o=gShowTabNames;gAllowShowTabNames&&(gShowTabNames=!1);var a=gRawMode;gRawMode=!1,Render(!0,null),gRawMode=a,gStripAnnotations=t,gStripTextAnnotations=n,gAllowShowTabNames&&(gShowTabNames=o),h=!0,f()},100)):f()):gRawMode?(document.getElementById("statuspdfname").innerHTML='Generating <font color="blue">'+t+"</font>",document.getElementById("statustunecount").innerHTML="Processing ABC for PDF generation",document.getElementById("pagestatustext").innerHTML="&nbsp;",setTimeout(function(){gRawMode=!1,Render(!0,null),gRawMode=!0,h=!0,f()},100)):f()}function CancelPDF(){gPDFCancelRequested=!0}function getNextSiblings(t,n){for(var o=[];t=t.nextSibling;)(!n||n(t))&&o.push(t);return o}function getStyleProp(t,n){return window.getComputedStyle?window.getComputedStyle(t,null).getPropertyValue(n):t.currentStyle?t.currentStyle[n]:void 0}function GetABCJSParams(t){var n,o="",a="";if(t&&gShowTabNames)switch(gCapo>0&&(o=" (Capo "+gCapo+")"),t){case"noten":break;case"notenames":case"whistle":a=" ";break;case"mandolin":a="Mandolin"+o;break;case"gdad":a="GDAD"+o;break;case"cgda":a="CGDA"+o;break;case"cgdae":a="CGDAE"+o;break;case"dgdae":a="DGDAE"+o;break;case"guitare":a="Guitar"+o;break;case"guitard":a="DADGAD"+o;break;case"uke":a="Ukulele"+o}var r=gRenderingFonts;gDrawTabSymbol=!0;var l=!0;if(t?"noten"==t?(l=!1,n={responsive:"resize",oneSvgPerLine:"true",expandToWidest:"true",selectTypes:!1,format:r}):"mandolin"==t?n={tablature:[{instrument:"violin",label:a,tuning:["G,","D","A","e"],highestNote:"f'",capo:gCapo}],responsive:"resize",oneSvgPerLine:"true",expandToWidest:"true",selectTypes:!1,format:r}:"gdad"==t?n={tablature:[{instrument:"violin",label:a,tuning:["G,","D","A","d"],highestNote:"f'",capo:gCapo}],responsive:"resize",oneSvgPerLine:"true",expandToWidest:"true",selectTypes:!1,format:r}:"cgda"==t?n={tablature:[{instrument:"violin",label:a,tuning:["C,","G,","D","A"],highestNote:"f'",capo:gCapo}],responsive:"resize",oneSvgPerLine:"true",expandToWidest:"true",selectTypes:!1,format:r}:"cgdae"==t?n={tablature:[{instrument:"fivestring",label:a,tuning:["C,","G,","D","A","e"],highestNote:"f'",capo:gCapo}],responsive:"resize",oneSvgPerLine:"true",expandToWidest:"true",selectTypes:!1,format:r}:"dgdae"==t?n={tablature:[{instrument:"fivestring",label:a,tuning:["D,","G,","D","A","e"],highestNote:"f'",capo:gCapo}],responsive:"resize",oneSvgPerLine:"true",expandToWidest:"true",selectTypes:!1,format:r}:"guitare"==t?n={tablature:[{instrument:"guitar",label:a,tuning:["E,","A,","D","G","B","e"],highestNote:"f'",capo:gCapo}],responsive:"resize",oneSvgPerLine:"true",expandToWidest:"true",selectTypes:!1,format:r}:"guitard"==t?n={tablature:[{instrument:"guitar",label:a,tuning:["D,","A,","D","G","A","d"],highestNote:"f'",capo:gCapo}],responsive:"resize",oneSvgPerLine:"true",expandToWidest:"true",selectTypes:!1,format:r}:"uke"==t?n={tablature:[{instrument:"violin",label:a,tuning:["G,","C","E","A"],highestNote:"f'",capo:gCapo}],responsive:"resize",oneSvgPerLine:"true",expandToWidest:"true",selectTypes:!1,format:r}:"notenames"==t?(gDrawTabSymbol=!1,n={tablature:[{instrument:"violin",label:a,tuning:["G,,,","G,,","G,"],highestNote:"b'",hideTabSymbol:!0,linePitch:2}],responsive:"resize",oneSvgPerLine:"true",expandToWidest:"true",selectTypes:!1,format:r}):"whistle"==t?(gDrawTabSymbol=!1,n={tablature:[{instrument:"violin",label:a,tuning:["G,"],highestNote:"^a'",hideTabSymbol:!0}],responsive:"resize",oneSvgPerLine:"true",expandToWidest:"true",selectTypes:!1,format:r}):(l=!1,n={responsive:"resize",oneSvgPerLine:"true",selectTypes:!1,format:r}):(l=!1,n={responsive:"resize",oneSvgPerLine:"true",expandToWidest:"true",selectTypes:!1,format:r},t=""),l&&n.tablature&&n.tablature.length>0)for(var s=n.tablature[0],g=0;g<7;++g)n.tablature.push(s);return gOnlyHighlightV1&&(n.add_classes=!0),n}function UpdateLocalStorage(){if(gLocalStorageAvailable){if(!gIsFromShare||gForceTabSave){var t=GetRadioValue("notenodertab");localStorage.abcTab=t,gForceTabSave=!1}var n=gCapo;if(localStorage.abcCapo=n,!gIsFromShare){var o=gStaffSpacing-STAFFSPACEOFFSET;localStorage.abcStaffSpacing=o}var a=getPDFFormat();localStorage.abcTunesPerPage=a;var r=getPageNumbers();localStorage.abcPageNumberLocation=r;var l=getFirstPage();localStorage.abcPageNumberOnPageOne=l,gTopBarShowing?localStorage.abcHideTopBar="false":localStorage.abcHideTopBar="true",gShowTabNames?localStorage.abcShowTabNames="true":localStorage.abcShowTabNames="false",localStorage.PDFFont=gPDFFont,localStorage.PDFFontStyle=gPDFFontStyle,localStorage.PDFOrientation=gPDFOrientation}}function SavePDFSettings(){UpdateLocalStorage()}function PrepareSVGDivsForRasterization(){document.getElementById("offscreenrender").innerHTML="";for(var t=CountTunes(),n=0;n<t;++n){var o,a,r="notation"+n,l=document.querySelectorAll('div[id="'+r+'"] > div'),s=l.length;for(o=0;o<s;++o)(a=l.item(o)).classList.add("block"),a.id="block_"+n+"_"+o}}function RestoreSVGDivsAfterRasterization(){document.getElementById("offscreenrender").innerHTML="";for(var t=CountTunes(),n=0;n<t;++n){var o,a,r="notation"+n,l=document.querySelectorAll('div[id="'+r+'"] > div'),s=l.length;for(o=0;o<s;++o)(a=l.item(o)).removeAttribute("class"),a.removeAttribute("id")}}function NoteClickListener(t,n,o,a,r,l){var s=window.scrollY;setTimeout(function(){var n;window.scrollTo(0,s),gTheABC.focus(),ScrollABCTextIntoView(gTheABC,t.startChar,t.endChar,2)},10)}function fireSelectionChanged(){if(gRawMode&&CountTunes()>0&&gRawVisual){if(gCurrentTune!=gRawLastIndex){for(var t=gRawVisual.length,n=0;n<t;++n){var o=gRawVisual[n].engraver;o.rangeHighlight(0,0)}gRawLastIndex=gCurrentTune}var o=gRawVisual[gRawLastIndex].engraver;o&&o.rangeHighlight(gTheABC.selectionStart,gTheABC.selectionEnd)}}function RenderTheNotes(t,n,o,a){if(!gDisableNotationRendering){var r=GetABCJSParams(n),l=[],s=0,g=0,c=0;if(o){c=s=CountTunes();for(var d=0;d<s;++d)l.push("notation"+d)}else s=1,g=a,c=a+1,l.push("notation"+a);if(0!=s){gRawMode&&isDesktopBrowser()&&(r.clickListener=NoteClickListener,r.selectTypes=!0,r.selectionColor=gRawHighlightColor),gTabFirstStaffOnly=ScanTuneForTabFirstStaffOnly(t,n),gTabSecondStaffOnly=!1,gTabFirstStaffOnly||(gTabSecondStaffOnly=ScanTuneForTabSecondStaffOnly(t,n));try{var u=ABCJS.renderAbc(l,t,r)}catch(p){var m='<p style="text-align:center;font-size:18pt;font-family:helvetica;">Tune Rendering Issue</p>';m+='<p style="font-size:12pt;line-height:18pt;margin-top:36px;text-align:center;">During rendering, the following tune caused the tool to crash:</p>',m+='<p style="font-size:12pt;line-height:18pt;margin-top:20px;text-align:center;"><strong>'+gLastRenderedTuneName+"</strong></p>",m+='<p style="font-size:12pt;line-height:18pt;margin-top:20px;text-align:center;">Try isolating this one tune to determine the issue.</p>',m+='<p style="font-size:3pt;line-height:3pt;text-align:center;">&nbsp;</p>',DayPilot.Modal.alert(m,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})}if(gShowDiagnostics&&gRawMode&&o&&s>1){var h=document.getElementById("diagnostics");h.innerHTML='<p class="diagnostics_message">Diagnostics are not available if Highlighting is on and there are multiple tunes in the ABC editor.</p>'}else if(gShowDiagnostics&&(!o||1==s)&&u&&u[0]){var f=u[0].warnings,h=document.getElementById("diagnostics");if(f){var d,A="",b=f.length;for(d=0;d<b;++d)A+='<p class="diagnostics_message">'+f[d]+"</p>";h.innerHTML=A}else h.innerHTML='<p class="diagnostics_message">No issues found</p>'}gRawVisual=gRawMode?u:null;for(var T=g;T<c;++T)postProcessTab(u,"notation"+T,n,!1);u=null}}}function SetRadioValue(t,n){let o=document.querySelectorAll('input[name="'+t+'"]');for(let a of o)a.value==n?a.checked=!0:a.checked=!1}function GetRadioValue(t){let n=document.querySelectorAll('input[name="'+t+'"]'),o;for(let a of n)if(a.checked){o=a.value;break}return o}function StripAnnotations(){var t=gTheABC.value;t=StripAnnotationsOne(t),gTheABC.value=t,gIsDirty=!0}function StripAnnotationsOne(t){var n=/^Q:.*[\r\n]*/gm;return t=t.replace(n,""),n=/^Z:.*[\r\n]*/gm,t=t.replace(n,""),n=/^R:.*[\r\n]*/gm,t=t.replace(n,""),n=/^S:.*[\r\n]*/gm,t=t.replace(n,""),n=/^N:.*[\r\n]*/gm,t=t.replace(n,""),n=/^D:.*[\r\n]*/gm,t=t.replace(n,""),n=/^H:.*[\r\n]*/gm,t=t.replace(n,""),n=/^B:.*[\r\n]*/gm,t=t.replace(n,""),n=/^C:.*[\r\n]*/gm,t=t.replace(n,""),n=/^O:.*[\r\n]*/gm,t=t.replace(n,""),n=/^A:.*[\r\n]*/gm,t=t.replace(n,""),n=/^P:.*[\r\n]*/gm,t=t.replace(n,"")}function StripTextAnnotations(){var t=gTheABC.value;t=StripTextAnnotationsOne(t),gTheABC.value=t,gIsDirty=!0}function StripTextAnnotationsOne(t){var n=/%%text .*[\r\n]*/gm;return t=t.replace(n,""),n=/%%text[\r\n]/gm,t=t.replace(n,""),n=/%%center.*[\r\n]*/gm,t=t.replace(n,"")}function StripChords(){var t=gTheABC.value;t=StripChordsOne(t),gTheABC.value=t,gIsDirty=!0}function StripChordsOne(t){return t=t.replace(/"[^"]*"/gm,function t(n){return -1!=n.indexOf('"_')||-1!=n.indexOf('"^')?n:n.length>9?n:-1!=n.indexOf(" ")?n:""})}function AreChordsInMatch(t,n){if(!n)return!1;for(var o=n.length,a=0;a<o;++a){var r=n[a];if(-1==r.indexOf('"_')&&-1==r.indexOf('"^')){if(r.length>9)continue;if(-1!=r.indexOf(" "))continue;return!0}}return!1}function IsTabInMatch(t,n){if(!n)return!1;for(var o=n.length,a=0;a<o;++a)if(0==n[a].indexOf('"_')||0==n[a].indexOf('"^'))return!0;return!1}function StripTab(){var t=gTheABC.value;t=StripTabOne(t),gTheABC.value=t,gIsDirty=!0}function StripTabOne(t){return t=t.replace(/"[^"]*"/gm,function t(n){return 0==n.indexOf('"_')||0==n.indexOf('"^')?"":n})}function StripOrnaments(t){var t=gTheABC.value;t=StripOrnamentsOne(t,!0),gTheABC.value=t,gIsDirty=!0}function StripOrnamentsOne(t,n){var o;return t=(o=t).replace(/%%score \{[^}]*\}|\{[^}]*\}/gm,t=>t.startsWith("%%score")?t:""),n&&(t=t.replaceAll("~","")),t}function processAllStripping(t){var n="";return gStripAnnotations&&(n=/^Q:.*$/gm,t=t.replace(n,"% comment"),n=/^Z:.*$/gm,t=t.replace(n,"% comment"),n=/^R:.*$/gm,t=t.replace(n,"% comment"),n=/^S:.*$/gm,t=t.replace(n,"% comment"),n=/^N:.*$/gm,t=t.replace(n,"% comment"),n=/^D:.*$/gm,t=t.replace(n,"% comment"),n=/^H:.*$/gm,t=t.replace(n,"% comment"),n=/^B:.*$/gm,t=t.replace(n,"% comment"),n=/^C:.*$/gm,t=t.replace(n,"% comment"),n=/^O:.*$/gm,t=t.replace(n,"% comment"),n=/^A:.*$/gm,t=t.replace(n,"% comment"),n=/^P:.*$/gm,t=t.replace(n,"% comment")),gStripTextAnnotations&&(n=/%%text .*$/gm,t=t.replace(n,"% comment"),n=/%%text[\r\n]/gm,t=t.replace(n,"% comment\n"),n=/%%center.*$/gm,t=t.replace(n,"% comment")),gStripChords&&(t=StripChordsOne(t)),gStripTab&&(t=StripTabOne(t)),gStripOrnaments&&(t=StripOrnamentsOne(t,!0)),t}function RenderRangeAsync(t,n,o){if(gRenderingPDF){o&&void 0!=o&&o();return}var a=n-t+1;if(a<=0){o&&void 0!=o&&o();return}document.getElementById("loading-bar-spinner").style.display="none";var r=!1;a>5&&(r=!0),r&&(document.getElementById("loading-bar-spinner").style.display="block"),setTimeout(function(){for(var a=t;a<=n;++a)Render(!1,a);document.getElementById("loading-bar-spinner").style.display="none",o&&void 0!=o&&o()},10)}function RenderAsync(t,n,o){if(gRenderingPDF){o&&void 0!=o&&o();return}document.getElementById("loading-bar-spinner").style.display="none",t?(document.getElementById("loading-bar-spinner").style.display="block",setTimeout(function(){Render(t,n),document.getElementById("loading-bar-spinner").style.display="none",MakeTuneVisible(!0),o&&void 0!=o&&o()},10)):(Render(t,n),o&&void 0!=o&&o())}function Render(t,n){if(!gRenderingPDF){var o=CountTunes();if(""!=gTheABC.value&&o>0){var a,r=document.getElementById("abc-selected");1==o?r.innerText=gDisplayedName+"  ("+o+" Tune)":r.innerText=gDisplayedName+"  ("+o+" Tunes)";var l=window.pageYOffset;UpdateLocalStorage(),document.getElementById("notation-placeholder").style.display="none",isDesktopBrowser()?gIsMaximized?gTheNotation.style.display="flex":gTheNotation.style.display="inline":gIsMaximized?gTheNotation.style.display="flex":gTheNotation.style.display="block",gDisableEditFromPlayLink?HideMaximizeButton():ShowMaximizeButton(),(isDesktopBrowser()||gIsMaximized)&&(ShowPlayButton(),ShowPDFButton()),gShowAllControls?(document.getElementById("notenrechts").style.display="inline-block",gIsFirstRender&&(UpdateNotationTopPosition(),gIsFirstRender=!1)):document.getElementById("notenrechts").style.display="none",document.getElementById("saveabcfile").classList.remove("saveabcfiledisabled"),document.getElementById("saveabcfile").classList.add("saveabcfile"),gAllowSave=!0,gAllowControlToggle=!0,document.getElementById("saveaspdf").classList.remove("saveaspdfdisabled"),document.getElementById("saveaspdf").classList.add("saveaspdf"),gAllowPDF=!0,document.getElementById("copybutton").classList.remove("copybuttondisabled"),document.getElementById("copybutton").classList.add("copybutton"),document.getElementById("playbutton").classList.remove("playbuttondisabled"),document.getElementById("playbutton").classList.add("playbutton"),isDesktopBrowser()&&(document.getElementById("rawmodebutton").classList.remove("rawmodebuttondisabled"),document.getElementById("rawmodebutton").classList.add("rawmodebutton")),gAllowCopy=!0;var s=GetRadioValue("notenodertab");t?(GenerateRenderingDivs(o),a=gTheABC.value):a=getTuneByIndex(n),!gRawMode&&(a=(a=processAllStripping(a)).replace(/^X:.*$/gm,"X:1\n%%staffsep "+gStaffSpacing)),RenderTheNotes(a,s,t,n),window.scrollTo(0,l)}else{document.getElementById("notenrechts").style.display="none",gTheNotation.style.display="none",document.getElementById("saveabcfile").classList.remove("saveabcfile"),document.getElementById("saveabcfile").classList.add("saveabcfiledisabled"),gAllowSave=!1,document.getElementById("saveaspdf").classList.remove("saveaspdf"),document.getElementById("saveaspdf").classList.add("saveaspdfdisabled"),gAllowPDF=!1,gAllowControlToggle=!1,document.getElementById("copybutton").classList.remove("copybutton"),document.getElementById("copybutton").classList.add("copybuttondisabled"),document.getElementById("playbutton").classList.remove("playbutton"),document.getElementById("playbutton").classList.add("playbuttondisabled"),document.getElementById("rawmodebutton").classList.remove("rawmodebutton"),document.getElementById("rawmodebutton").classList.add("rawmodebuttondisabled"),document.getElementById("rawmodebutton").classList.add("btn-rawmode-off"),document.getElementById("rawmodebutton").classList.remove("btn-rawmode-on"),document.getElementById("rawmodebutton").value="Highlighting Off",gTheABC.style.backgroundColor="white",gRawMode=!1,gRawLastIndex=-1,gLastClickedTune=-1,gAllowCopy=!1,document.getElementById("notation-placeholder").style.display="block",document.getElementById("zoombutton").style.display="none",HidePlayButton(),HidePDFButton(),document.getElementById("loading-bar-spinner").style.display="none";var r=document.getElementById("abc-selected");r.innerText="No ABC file selected",gDisplayedName="No ABC file selected",gABCFromFile=!1,gIsFirstRender=!0,(elem=document.getElementById("diagnostics")).innerHTML="",UpdateNotationTopPosition()}}}function ensureABCFile(t){var n="";if(t.lastIndexOf(".")>0&&(n=t.substring(t.lastIndexOf(".")+1,t.length)),"abc"==n.toLowerCase()||"txt"==n.toLowerCase()||"xml"==n.toLowerCase()||"musicxml"==n.toLowerCase()||"mxl"==n.toLowerCase()||"mid"==n.toLowerCase()||"midi"==n.toLowerCase()||"bww"==n.toLowerCase()||"BWW"==n.toLowerCase())return!0;var o="Sorry, only .abc, .txt, .xml, .musicxml, .mxl, .bww, .mid, or .midi files are supported.";return o=makeCenteredPromptString(o),DayPilot.Modal.alert(o,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()}),!1}function IdleAdvancedControls(t){var n=gTheABC.value,o="",a=!1,r=!1,l=!1,s=!1,g=!1;o=/^Q:.*$/gm,(g=-1!=n.search(o))||(o=/^Z:.*$/gm,g=-1!=n.search(o)),g||(o=/^R:.*$/gm,g=-1!=n.search(o)),g||(o=/^S:.*$/gm,g=-1!=n.search(o)),g||(o=/^N:.*$/gm,g=-1!=n.search(o)),g||(o=/^D:.*$/gm,g=-1!=n.search(o)),g||(o=/^H:.*$/gm,g=-1!=n.search(o)),g||(o=/^B:.*$/gm,g=-1!=n.search(o)),g||(o=/^C:.*$/gm,g=-1!=n.search(o)),g||(o=/^O:.*$/gm,g=-1!=n.search(o)),g||(o=/^A:.*$/gm,g=-1!=n.search(o)),g||(o=/^P:.*$/gm,g=-1!=n.search(o)),a=g,g=!1,o=/%%text .*$/gm,(g=-1!=n.search(o))||(o=/%%text[\r\n]/gm,g=-1!=n.search(o)),g||(o=/%%center.*$/gm,g=-1!=n.search(o)),r=g,g=!1,o=/"[^"]*"/gm;var c=n.match(o);if(l=g=AreChordsInMatch(n,c),o=/"[^"]*"/gm,c=n.match(o),EnableTab=g=IsTabInMatch(n,c),g=!1,-1!=n.indexOf("~")&&(g=!0),!g&&(o=/%%score \{[^}]*\}|\{[^}]*\}/gm,(c=n.match(o))&&c.length)){for(var d=c.length,u=0;u<d;++u)if(0==c[u].indexOf("{")){g=!0;break}}s=g,a?(gAllowFilterAnnotations=!0,t&&(document.getElementById("toggleannotations").classList.remove("advancedcontrolsdisabled"),document.getElementById("toggleannotations").classList.add("advancedcontrols"),document.getElementById("stripannotations").classList.remove("advancedcontrolsdisabled"),document.getElementById("stripannotations").classList.add("advancedcontrols"))):(gAllowFilterAnnotations=!1,t&&(document.getElementById("toggleannotations").classList.remove("advancedcontrols"),document.getElementById("toggleannotations").classList.add("advancedcontrolsdisabled"),document.getElementById("stripannotations").classList.remove("advancedcontrols"),document.getElementById("stripannotations").classList.add("advancedcontrolsdisabled"))),r?(gAllowFilterText=!0,t&&(document.getElementById("toggletext").classList.remove("advancedcontrolsdisabled"),document.getElementById("toggletext").classList.add("advancedcontrols"),document.getElementById("striptext").classList.remove("advancedcontrolsdisabled"),document.getElementById("striptext").classList.add("advancedcontrols"))):(gAllowFilterText=!1,t&&(document.getElementById("toggletext").classList.remove("advancedcontrols"),document.getElementById("toggletext").classList.add("advancedcontrolsdisabled"),document.getElementById("striptext").classList.remove("advancedcontrols"),document.getElementById("striptext").classList.add("advancedcontrolsdisabled"))),l?(gAllowFilterChords=!0,t&&(document.getElementById("togglechords").classList.remove("advancedcontrolsdisabled"),document.getElementById("togglechords").classList.add("advancedcontrols"),document.getElementById("stripchords").classList.remove("advancedcontrolsdisabled"),document.getElementById("stripchords").classList.add("advancedcontrols"))):(gAllowFilterChords=!1,t&&(document.getElementById("togglechords").classList.remove("advancedcontrols"),document.getElementById("togglechords").classList.add("advancedcontrolsdisabled"),document.getElementById("stripchords").classList.remove("advancedcontrols"),document.getElementById("stripchords").classList.add("advancedcontrolsdisabled"))),EnableTab?(gAllowFilterTab=!0,t&&(document.getElementById("toggletab").classList.remove("advancedcontrolsdisabled"),document.getElementById("toggletab").classList.add("advancedcontrols"),document.getElementById("striptab").classList.remove("advancedcontrolsdisabled"),document.getElementById("striptab").classList.add("advancedcontrols"))):(gAllowFilterTab=!1,t&&(document.getElementById("toggletab").classList.remove("advancedcontrols"),document.getElementById("toggletab").classList.add("advancedcontrolsdisabled"),document.getElementById("striptab").classList.remove("advancedcontrols"),document.getElementById("striptab").classList.add("advancedcontrolsdisabled"))),s?(gAllowFilterOrnaments=!0,t&&(document.getElementById("toggleornaments").classList.remove("advancedcontrolsdisabled"),document.getElementById("toggleornaments").classList.add("advancedcontrols"),document.getElementById("stripornaments").classList.remove("advancedcontrolsdisabled"),document.getElementById("stripornaments").classList.add("advancedcontrols"))):(gAllowFilterOrnaments=!1,t&&(document.getElementById("toggleornaments").classList.remove("advancedcontrols"),document.getElementById("toggleornaments").classList.add("advancedcontrolsdisabled"),document.getElementById("stripornaments").classList.remove("advancedcontrols"),document.getElementById("stripornaments").classList.add("advancedcontrolsdisabled"))),t&&(gStripAnnotations?document.getElementById("toggleannotations").value="Show Annotations":document.getElementById("toggleannotations").value="Hide Annotations",gStripTextAnnotations?document.getElementById("toggletext").value="Show Text":document.getElementById("toggletext").value="Hide Text",gStripChords?document.getElementById("togglechords").value="Show Chords":document.getElementById("togglechords").value="Hide Chords",gStripTab?document.getElementById("toggletab").value="Show Injected Tab":document.getElementById("toggletab").value="Hide Injected Tab",gStripOrnaments?document.getElementById("toggleornaments").value="Show Ornaments":document.getElementById("toggleornaments").value="Hide Ornaments")}function UpdateNotationTopPosition(){var t=document.getElementById("noscroller").offsetHeight;document.getElementById("notation-spacer").style.height=t+"px"}function RestoreDefaults(){gStripAnnotations=!1,gStripTextAnnotations=!1,gStripChords=!1,gStripTab=!1,gStripOrnaments=!1,gAllowFilterAnnotations=!1,gAllowFilterText=!1,gAllowFilterChords=!1,gAllowFilterTab=!1,gAllowFilterOrnaments=!1,gTotalTunes=0,gCurrentTune=0,gRawLastIndex=-1,gForceFullRender=!1,gIsFirstRender=!0,gLastAutoScrolledTune=-1,gLastClickedTune=-1;document.getElementById("selectabcfile").value="",clearQRCode(),UpdateNotationTopPosition()}function ToggleAnnotations(t){if(gAllowFilterAnnotations){if(t){StripAnnotations(),RenderAsync(!0,null),IdleAdvancedControls(!0);return}gStripAnnotations=!gStripAnnotations,RenderAsync(!0,null),IdleAdvancedControls(!0)}}function ToggleTextAnnotations(t){if(gAllowFilterText){if(t){StripTextAnnotations(),RenderAsync(!0,null),IdleAdvancedControls(!0);return}gStripTextAnnotations=!gStripTextAnnotations,RenderAsync(!0,null),IdleAdvancedControls(!0)}}function ToggleChords(t){if(gAllowFilterChords){if(t){StripChords(),RenderAsync(!0,null),IdleAdvancedControls(!0);return}gStripChords=!gStripChords,RenderAsync(!0,null),IdleAdvancedControls(!0)}}function ToggleTab(t){if(gAllowFilterTab){if(t){StripTab(),RenderAsync(!0,null),IdleAdvancedControls(!0);return}gStripTab=!gStripTab,RenderAsync(!0,null),IdleAdvancedControls(!0)}}function ToggleOrnaments(t){if(gAllowFilterOrnaments){if(t){StripOrnaments(),RenderAsync(!0,null),IdleAdvancedControls(!0);return}gStripOrnaments=!gStripOrnaments,RenderAsync(!0,null),IdleAdvancedControls(!0)}}function idleAddABC(){gIsIOS&&document.getElementById("addabcfilebutton").removeAttribute("accept"),document.getElementById("addabcfilebutton").onchange=()=>{let t=document.getElementById("addabcfilebutton");if(0===t.files.length){var n="Please select an ABC, MusicXML, or MIDI file";n=makeCenteredPromptString(n),DayPilot.Modal.alert(n,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});return}DoFileRead(t.files[0],!0),t.value=""};var t=document.getElementById("dialogrestorebutton");t.style.display="none";var n=document.getElementById("dialogrestoreautobutton");if(n.style.display="none",gLocalStorageAvailable){var o=localStorage.SavedSnapshot,a=localStorage.SavedSnapshot2,r=localStorage.SavedSnapshot3,l=localStorage.SavedSnapshot4,s=localStorage.LastAutoSnapShot;(o&&""!=o||a&&""!=a||r&&""!=r||l&&""!=l)&&(t.style.display="inline"),s&&""!=s&&(n.style.display="inline")}var g=document.getElementsByClassName("modal_flat_ok"),c=null;gAddABCOKButton=null;for(var d=0;d<g.length;++d)if("OK"==(c=g[d]).innerText){gAddABCOKButton=c;break}}var gPDFTunebookConfig={pdfquality:.75,pdf_between_tune_space:20,addtitle:"Tunebook Title",addsubtitle:"Tunebook Subtitle",addtoc:"Table of Contents",addindex:"Index",pageheader:"This is the Page Header",pagefooter:"This is the Page Footer",bAdd_add_all_playback_links:!0,bAdd_add_full_tunebook:!1,bInjectInstruments:!0,sound_font:"fluid",melody_instrument:1,bass_instrument:1,bass_volume:64,chord_instrument:1,chord_volume:64,bAdd_add_fonts:!1,bAdd_QRCode:!0,qrcode_link:"https://michaeleskin.com/abc",caption_for_qrcode:"Created using Michael Eskin's ABC Transcription Tools"};function resetPDFTunebookConfig(){gPDFTunebookConfig={pdfquality:.75,pdf_between_tune_space:20,addtitle:"Tunebook Title",addsubtitle:"Tunebook Subtitle",addtoc:"Table of Contents",addindex:"Index",pageheader:"This is the Page Header",pagefooter:"This is the Page Footer",bAdd_add_all_playback_links:!0,bAdd_add_full_tunebook:!1,bInjectInstruments:!0,sound_font:"fluid",melody_instrument:1,bass_instrument:1,bass_volume:64,chord_instrument:1,chord_volume:64,bAdd_add_fonts:!1,bAdd_QRCode:!0,qrcode_link:"https://michaeleskin.com/abc",caption_for_qrcode:"Created using Michael Eskin's ABC Transcription Tools"}}function idlePDFTunebookBuilder(){$('[name="addtitle"]').attr("placeholder","No Title Page will be included"),$('[name="addsubtitle"]').attr("placeholder","No Title Page subtitle will be included"),$('[name="addtoc"]').attr("placeholder","No Table of Contents will be included"),$('[name="addindex"]').attr("placeholder","No Index will be included"),$('[name="pageheader"]').attr("placeholder","No Page Header will be included"),$('[name="pagefooter"]').attr("placeholder","No Page Footer will be included"),$('[name="qrcode_link"]').attr("placeholder","QR Code will use default Share URL"),$('[name="caption_for_qrcode"]').attr("placeholder","No QR Code caption will be included")}function PDFTunebookBuilder(){if(!gRenderingPDF){sendGoogleAnalytics("dialog","PDFTunebookBuilder"),gPDFTunebookConfig.sound_font&&""!=gPDFTunebookConfig.sound_font||(gPDFTunebookConfig.sound_font="fluid"),gPDFTunebookConfig.bass_instrument&&""!=gPDFTunebookConfig.bass_instrument||(gPDFTunebookConfig.bass_instrument=1),gPDFTunebookConfig.bass_volume&&""!=gPDFTunebookConfig.bass_volume||(gPDFTunebookConfig.bass_volume="64"),gPDFTunebookConfig.chord_volume&&""!=gPDFTunebookConfig.chord_volume||(gPDFTunebookConfig.chord_volume="64");for(var t=[],n=0;n<=MIDI_PATCH_COUNT;++n)t.push({name:"  "+generalMIDISoundNames[n],id:n});for(var n=0;n<=MIDI_PATCH_COUNT;++n)t.push({name:"  "+generalMIDISoundNames[n],id:n});setTimeout(function(){idlePDFTunebookBuilder()},150),DayPilot.Modal.form([{html:'<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;margin-bottom:18px">Inject PDF Tunebook Features&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/app/userguide.html#inject_pdf_tunebook_features" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="margin-top:12px;margin-bottom:12px;font-size:12pt;line-height:14pt;font-family:helvetica">Clicking "OK" will inject PDF tunebook feature commands at the top of your ABC.</p>'},{html:'<p style="margin-top:12px;margin-bottom:12px;font-size:12pt;line-height:14pt;font-family:helvetica">Leave any text fields blank for features you don\'t want in your PDF tunebook.</p>'},{name:"PDF quality:",id:"pdfquality",type:"select",options:[{name:"  Draft",id:.4},{name:"  Good",id:.5},{name:"  High",id:.75},],cssClass:"configure_pdfquality_select"},{name:'Space between tunes (in 1/72"):',id:"pdf_between_tune_space",type:"number",cssClass:"configure_setuppdftunebook_form_text3"},{name:"Title Page title:",id:"addtitle",type:"text",cssClass:"configure_setuppdftunebook_form_text_wide2"},{name:"Title Page subtitle:",id:"addsubtitle",type:"text",cssClass:"configure_setuppdftunebook_form_text_wide"},{name:"Table of Contents title:",id:"addtoc",type:"text",cssClass:"configure_setuppdftunebook_form_text_wide"},{name:"Index title:",id:"addindex",type:"text",cssClass:"configure_setuppdftunebook_form_text_wide"},{name:"Page Header:",id:"pageheader",type:"text",cssClass:"configure_setuppdftunebook_form_text_wide"},{name:"Page Footer:",id:"pagefooter",type:"text",cssClass:"configure_setuppdftunebook_form_text_wide"},{name:"          Add playback links to each tune to allow playing the tune by clicking the tune title",id:"bAdd_add_all_playback_links",type:"checkbox",cssClass:"configure_setuppdftunebook_form_text2"},{name:"          Playback links contain entire tunebook",id:"bAdd_add_full_tunebook",type:"checkbox",cssClass:"configure_setuppdftunebook_form_text"},{name:"Soundfont for playback links:",id:"sound_font",type:"select",options:[{name:"  Fluid",id:"fluid"},{name:"  Musyng Kite",id:"musyng"},{name:"  FatBoy",id:"fatboy"},{name:"  Canvas",id:"canvas"},{name:"  MScore",id:"mscore"},{name:"  Arachno",id:"arachno"},{name:"  FluidHQ",id:"fluidhq"}],cssClass:"configure_setuppdftunebook_midi_program_select"},{name:"Melody instrument for playback links:",id:"melody_instrument",type:"select",options:t,cssClass:"configure_setuppdftunebook_midi_program_select"},{name:"Bass instrument for playback links:",id:"bass_instrument",type:"select",options:t,cssClass:"configure_setuppdftunebook_midi_program_select"},{name:"Bass volume (0-127):",id:"bass_volume",type:"number",cssClass:"configure_setuppdftunebook_form_text"},{name:"Chord instrument for playback links:",id:"chord_instrument",type:"select",options:t,cssClass:"configure_setuppdftunebook_midi_program_select"},{name:"Chord volume (0-127):",id:"chord_volume",type:"number",cssClass:"configure_setuppdftunebook_form_text"},{name:"          Inject all required fonts into the ABC in the playback links",id:"bAdd_add_fonts",type:"checkbox",cssClass:"configure_setuppdftunebook_form_text"},{name:"          Add a QR Code to the end of the PDF",id:"bAdd_QRCode",type:"checkbox",cssClass:"configure_setuppdftunebook_form_text"},{html:'<p style="margin-top:18px;margin-bottom:16px;font-size:12pt;line-height:10pt;font-family:helvetica">To override the default Share URL QR Code, enter your own URL below:</p>'},{name:"Custom URL:",id:"qrcode_link",type:"text",cssClass:"configure_setuppdftunebook_form_text_wide"},{name:"QR Code caption:",id:"caption_for_qrcode",type:"text",cssClass:"configure_setuppdftunebook_form_text_wide"},],gPDFTunebookConfig,{theme:"modal_flat",top:10,width:690,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(t){if(!t.canceled){var n="% Start of PDF Tunebook Features\n";if(n+="%\n",gPDFTunebookConfig.pdfquality=t.result.pdfquality,n+="%pdfquality "+gPDFTunebookConfig.pdfquality+"\n",gPDFTunebookConfig.pdf_between_tune_space=t.result.pdf_between_tune_space,""!=gPDFTunebookConfig.pdf_between_tune_space&&(n+="%pdf_between_tune_space "+gPDFTunebookConfig.pdf_between_tune_space+"\n"),gPDFTunebookConfig.addtitle=t.result.addtitle,gPDFTunebookConfig.addsubtitle=t.result.addsubtitle,""!=gPDFTunebookConfig.addtitle&&(n+="%addtitle "+gPDFTunebookConfig.addtitle+"\n",""!=gPDFTunebookConfig.addsubtitle&&(n+="%addsubtitle "+gPDFTunebookConfig.addsubtitle+"\n")),gPDFTunebookConfig.addtoc=t.result.addtoc,""!=gPDFTunebookConfig.addtoc&&(n+="%addtoc "+gPDFTunebookConfig.addtoc+"\n",n+="%addlinkbacktotoc\n",n+="%tocleftoffset 0\n",n+="%tocrightoffset 0\n"),gPDFTunebookConfig.addindex=t.result.addindex,""!=gPDFTunebookConfig.addindex&&(n+="%addsortedindex "+gPDFTunebookConfig.addindex+"\n",n+="%addlinkbacktoindex\n",n+="%indexleftoffset 0\n",n+="%indexrightoffset 0\n"),gPDFTunebookConfig.pageheader=t.result.pageheader,""!=gPDFTunebookConfig.pageheader&&(n+="%pageheader "+gPDFTunebookConfig.pageheader+"\n"),gPDFTunebookConfig.pagefooter=t.result.pagefooter,""!=gPDFTunebookConfig.pagefooter&&(n+="%pagefooter "+gPDFTunebookConfig.pagefooter+"\n"),gPDFTunebookConfig.bAdd_add_all_playback_links=t.result.bAdd_add_all_playback_links,gPDFTunebookConfig.bAdd_add_full_tunebook=t.result.bAdd_add_full_tunebook,gPDFTunebookConfig.bInjectInstruments=t.result.bInjectInstruments,gPDFTunebookConfig.sound_font=t.result.sound_font,gPDFTunebookConfig.melody_instrument=t.result.melody_instrument,gPDFTunebookConfig.bass_instrument=t.result.bass_instrument,gPDFTunebookConfig.bass_volume=t.result.bass_volume,gPDFTunebookConfig.chord_instrument=t.result.chord_instrument,gPDFTunebookConfig.chord_volume=t.result.chord_volume,gPDFTunebookConfig.bAdd_add_all_playback_links){var o=gPDFTunebookConfig.sound_font,a=gPDFTunebookConfig.melody_instrument,r=gPDFTunebookConfig.bass_instrument,l=gPDFTunebookConfig.chord_instrument;0==a?a="mute":((a-=1)<0||a>MIDI_PATCH_COUNT)&&(a=0),0==r?r="mute":((r-=1)<0||r>MIDI_PATCH_COUNT)&&(r=0),0==l?l="mute":((l-=1)<0||l>MIDI_PATCH_COUNT)&&(l=0);var s=gPDFTunebookConfig.bass_volume,g=gPDFTunebookConfig.chord_volume;n+="%add_all_playback_links "+a+" "+r+" "+l+" "+o+"\n",n+="%add_all_playback_volumes "+s+" "+g+"\n",gPDFTunebookConfig.bAdd_add_full_tunebook&&(n+="%playback_links_are_complete_tunebook\n"),gPDFTunebookConfig.bAdd_add_fonts=t.result.bAdd_add_fonts,gPDFTunebookConfig.bAdd_add_fonts&&(n+="%add_all_fonts\n")}gPDFTunebookConfig.bAdd_QRCode=t.result.bAdd_QRCode,gPDFTunebookConfig.qrcode_link=t.result.qrcode_link,gPDFTunebookConfig.caption_for_qrcode=t.result.caption_for_qrcode,gPDFTunebookConfig.bAdd_QRCode&&(""!=gPDFTunebookConfig.qrcode_link?n+="%qrcode "+gPDFTunebookConfig.qrcode_link+"\n":n+="%qrcode\n",""!=gPDFTunebookConfig.caption_for_qrcode&&(n+="%caption_for_qrcode "+gPDFTunebookConfig.caption_for_qrcode+"\n")),n+="%\n",n+="% End of PDF Tunebook Features\n",n+="\n",SaveConfigurationSettings();var c=gTheABC.value,d="% End of PDF Tunebook Features\n\n",u=c.indexOf(d);-1!=u&&(u+=d.length,c=c.substring(u)),d="% End of PDF Tunebook Features\n",-1!=(u=c.indexOf(d))&&(u+=d.length,c=c.substring(u)),n+=c,gTheABC.value=n,gIsDirty=!0,gRawMode&&RenderAsync(!0,null)}})}}function capitalizeSongName(t){let n=["the","of","and","for","a","an"],o=t.split(" "),a=o.map((t,o)=>n.includes(t.toLowerCase())&&0!==o?t.toLowerCase():t.charAt(0).toUpperCase()+t.slice(1)),r=a.join(" ");return r}function capitalizeAfterO(t){return t.replace(/(O')([a-z])/g,function(t,n,o){return n+o.toUpperCase()})}function searchForTunes(){var t=gTheCurrentTuneDatabase;if(0==t){if(!gTheParsedTuneDatabase){var n=makeCenteredPromptString("Gavin Heneghan tune database still loading...");DayPilot.Modal.alert(n,{theme:"modal_flat",top:200});return}}else if(!gTheFolkFriendDatabase){var n=makeCenteredPromptString("FolkFriend tune database still loading...");DayPilot.Modal.alert(n,{theme:"modal_flat",top:200});return}var o=document.getElementById("tuneNameToSearch").value;if(""==o){var n=makeCenteredPromptString("No Text Entered in the Search Field");DayPilot.Modal.alert(n,{theme:"modal_flat",top:200});return}if(o=(o=(o=o.toLowerCase()).replace("'","")).replace('"',""),document.getElementById("search_results").value="",0==t)for(var a=document.getElementById("chords_only").checked,r=document.getElementById("match_title_start").checked,l=document.getElementById("only_first_variation").checked,s=gTheParsedTuneDatabase.length,g="",c=0,d=!1,u=0;u<s&&!d;++u){var p=gTheParsedTuneDatabase[u].info;if(""!=gTheTuneSearchStyle){var m=p.R;if(!m||(m=m.toLowerCase())!=gTheTuneSearchStyle)continue}var h=p.T;if(h=(h=(h=h.toLowerCase()).replace("'","")).replace('"',""),!r&&-1!=h.indexOf(o)||r&&0==h.indexOf(o)){var f=gTheParsedTuneDatabase[u].variations,A=1,b=Object.entries(f).length;for(let[T,y]of Object.entries(f))if(a){var I=/"[^"]*"/gm,v=y.match(I);if(v&&v.length>0){for(let[C,S]of Object.entries(p))"X"==C?g+=C+": "+(c+1)+"\n":g+=C+": "+S+"\n";if(!l&&b>1&&(g+="% Variation "+A+"\n"),g+=y+"\n\n",A++,++c==gTheMaxDatabaseResults){d=!0;break}if(l)break}}else{for(let[_,B]of Object.entries(p))"X"==_?g+=_+": "+(c+1)+"\n":g+=_+": "+B+"\n";if(!l&&b>1&&(g+="% Variation "+A+" of "+b+"\n"),g+=y+"\n\n",A++,++c==gTheMaxDatabaseResults){d=!0;break}if(l)break}}}else{var a=document.getElementById("chords_only").checked,r=document.getElementById("match_title_start").checked,l=document.getElementById("only_first_variation").checked,D=gTheFolkFriendDatabase.settings,E=[];for(let M in D)D.hasOwnProperty(M)&&E.push(M);var F=E.length,P=gTheFolkFriendDatabase.aliases,w=[];for(let R in P)P.hasOwnProperty(R)&&w.push(R);for(var k=w.length,g="",c=0,d=!1,L=[],u=0;u<k&&!d;++u){var H=gTheFolkFriendDatabase.aliases[w[u]],N=[];for(let O in H)H.hasOwnProperty(O)&&N.push(O);for(var G=N.length,z=0;z<G&&!d;++z){var h=H[N[z]],U=h;if(h=(h=(h=h.toLowerCase()).replace("'","")).replace('"',""),!r&&-1!=h.indexOf(o)||r&&0==h.indexOf(o)){h=U;for(var W=0;W<F&&!d;++W){var V=gTheFolkFriendDatabase.settings[E[W]];if(""!=gTheTuneSearchStyle){var m=V.dance;if(!m||(m=m.toLowerCase())!=gTheTuneSearchStyle)continue}if(V.tune_id==w[u]){var Q=!0;if(l){for(var X=L.length,Y=0;Y<X;++Y)L[Y]==V.tune_id&&(Q=!1);L.push(V.tune_id)}if(Q){if(a){var I=/"[^"]*"/gm,v=V.abc.match(I);if(v&&v.length>0){c++;var J=capitalizeSongName(h);J=capitalizeAfterO(J),g+="X: "+c+"\n",g+="T: "+J+"\n",g+="S: https://thesession.org/tunes/"+V.tune_id+"\n";var q=!1;V.dance&&(g+="R: "+V.dance+"\n","polka"==V.dance&&(q=!0)),V.meter&&(g+="M: "+V.meter+"\n",q&&"2/4"==V.meter&&(g+="L: 1/8\n")),V.mode&&(g+="K: "+V.mode+"\n"),g+=V.abc+"\n\n",c==gTheMaxDatabaseResults&&(d=!0)}}else{c++;var J=capitalizeSongName(h);J=capitalizeAfterO(J),g+="X: "+c+"\n",g+="T: "+J+"\n",g+="S: https://thesession.org/tunes/"+V.tune_id+"\n";var q=!1;V.dance&&(g+="R: "+V.dance+"\n","polka"==V.dance&&(q=!0)),V.meter&&(g+="M: "+V.meter+"\n",q&&"2/4"==V.meter&&(g+="L: 1/8\n")),V.mode&&(g+="K: "+V.mode+"\n"),g+=V.abc+"\n\n",c==gTheMaxDatabaseResults&&(d=!0)}}}}}}}}var K=document.getElementById("search_result");K.innerHTML="Search Results:&nbsp;&nbsp;"+c+" found",document.getElementById("search_results").value=g,(K=document.getElementById("search_results")).selectionStart=0,K.selectionEnd=0,isDesktopBrowser()?K.focus():K.blur(),K=document.getElementById("add-search-results"),c>0?(K.classList.remove("add-search-results-disabled"),K.classList.add("add-search-results"),K.disabled=!1):(K.classList.remove("add-search-results"),K.classList.add("add-search-results-disabled"),K.disabled=!0)}function addSearchResults(){var t=document.getElementById("search_results").value;if(t&&0!=t.length){ProcessAddTune(t);var n='<p style="text-align:center;font-size:14pt;font-family:helvetica;">Search Results Added to Tunebook!</p>';DayPilot.Modal.alert(n,{theme:"modal_flat",top:300,width:700,scrollWithPage:AllowDialogsToScroll()})}else{var n='<p style="text-align:center;font-size:14pt;font-family:helvetica;">Nothing to Add!</p>';DayPilot.Modal.alert(n,{theme:"modal_flat",top:300,width:700,scrollWithPage:AllowDialogsToScroll()})}}function idleSearchResults(){var t=document.getElementById("search_results").value,n=document.getElementById("add-search-results");t&&t.length>0?(n.classList.remove("add-search-results-disabled"),n.classList.add("add-search-results"),n.disabled=!1):(n.classList.remove("add-search-results"),n.classList.add("add-search-results-disabled"),n.disabled=!0)}function SetTuneSearchMaxResults(){gTheMaxDatabaseResults=parseInt(document.getElementById("maxtunesearchresults").value),isNaN(gTheMaxDatabaseResults)&&(gTheMaxDatabaseResults=25)}function SetTuneSearchStyle(){gTheTuneSearchStyle=document.getElementById("tunesearchstyle").value}function wait_for_retry(t){return new Promise(n=>setTimeout(n,t))}function fetchWithRetry(t,n,o,a={}){return fetch(t,a).catch(function r(l){if(!(triesLeft=o-1))throw l;return wait_for_retry(n).then(()=>fetchWithRetry(t,n,triesLeft,a))})}function SwitchTuneDatabase(){var t=document.getElementById("databaseselect").value;switch(t){case"0":gTheCurrentTuneDatabase=0,gTheParsedTuneDatabase?document.getElementById("status").innerHTML="&nbsp;&nbsp;&nbsp;Ready to search":(document.getElementById("status").innerHTML="&nbsp;&nbsp;&nbsp;Waiting for tune collection to load...",getTuneDatabase_DB(!1,function(t){t&&t.length>0?(document.getElementById("status")&&(document.getElementById("status").innerHTML="&nbsp;&nbsp;&nbsp;Ready to search"),gTheParsedTuneDatabase=t[0]):fetchWithRetry("https://michaeleskin.com/app/abctunes_gavin_heneghan_10nov2023.json",gTuneDatabaseRetryTimeMS,gTuneDatabaseRetryCount).then(t=>t.json()).then(t=>{document.getElementById("status")&&0==gTheCurrentTuneDatabase&&(document.getElementById("status").innerHTML="&nbsp;&nbsp;&nbsp;Ready to search"),gTheParsedTuneDatabase=t,saveTuneDatabase_DB(t,!1)}).catch(function(t){document.getElementById("status")&&0==gTheCurrentTuneDatabase&&(document.getElementById("status").innerHTML="&nbsp;&nbsp;&nbsp;Unable to load tune collection, please retry later...")})})),document.getElementById("search_results").value="",document.getElementById("search_result").innerHTML="Search Results:",idleSearchResults();break;case"1":gTheCurrentTuneDatabase=1,gTheFolkFriendDatabase?document.getElementById("status").innerHTML="&nbsp;&nbsp;&nbsp;Ready to search":(document.getElementById("status").innerHTML="&nbsp;&nbsp;&nbsp;Waiting for tune collection to load...",getTuneDatabase_DB(!0,function(t){t&&t.length>0?(document.getElementById("status")&&(document.getElementById("status").innerHTML="&nbsp;&nbsp;&nbsp;Ready to search"),gTheFolkFriendDatabase=t[0]):fetchWithRetry("https://michaeleskin.com/app/folkfriend-non-user-data_22dec2023.json",gTuneDatabaseRetryTimeMS,gTuneDatabaseRetryCount).then(t=>t.json()).then(t=>{document.getElementById("status")&&1==gTheCurrentTuneDatabase&&(document.getElementById("status").innerHTML="&nbsp;&nbsp;&nbsp;Ready to search"),gTheFolkFriendDatabase=t,saveTuneDatabase_DB(t,!0)}).catch(function(t){document.getElementById("status")&&1==gTheCurrentTuneDatabase&&(document.getElementById("status").innerHTML="&nbsp;&nbsp;&nbsp;Unable to load tune collection, please retry later...")})})),document.getElementById("search_results").value="",document.getElementById("search_result").innerHTML="Search Results:",idleSearchResults()}gDefaultTuneDatabase=gTheCurrentTuneDatabase,SaveConfigurationSettings()}var gTheParsedTuneDatabase=null,gTheFolkFriendDatabase=null,gTheCurrentTuneDatabase=0,gTheMaxDatabaseResults=25,gDefaultSearchCollection=0,gTheTuneSearchStyle="",gTuneDatabaseRetryTimeMS=3e3,gTuneDatabaseRetryCount=10;function AddFromSearch(t,n){sendGoogleAnalytics("dialog","AddFromSearch"),t&&t.preventDefault(),gTheCurrentTuneDatabase=gDefaultTuneDatabase;var o=window.innerHeight-650;isMobileBrowser()&&(o=window.innerHeight-675);var a='<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">Search and Add Tunes&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/app/userguide.html#search_and_add_tunes" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>';a+='<p style="font-size:12pt;line-height:24pt;margin-top:20px;margin-bottom:12px;" class="switchtunedatabase">Tune Collection to Search: <select id="databaseselect" onchange="SwitchTuneDatabase();" title="Select your tune search database"><option value="0">Gavin Heneghan\'s Collection (20,000+ Tune Settings)</option><option value="1">FolkFriend.app Collection (45,000+ Tune Settings)</option></select></p>',a+='<p style="font-size:12pt;line-height:24pt;margin-top:0px;margin-bottom:18px;">Search for text in the tune name:&nbsp;&nbsp;<input style="width:100%;font-size:12pt;line-height:18px;padding:6px;" id="tuneNameToSearch" title="Enter your search text here" autocomplete="off" autocorrect="off" placeholder="Enter your search text here"/> </p>',a+='<p class="tunesearchoptions">Only return first variation found?&nbsp;<input id="only_first_variation" type="checkbox" style="margin-top:-5px;margin-bottom:0px;" checked/>&nbsp;&nbsp;&nbsp;Match start of title?&nbsp;<input id="match_title_start" type="checkbox" style="margin-top:-5px;margin-bottom:0px;"/>&nbsp;&nbsp;&nbsp;Only return tunes with chords?&nbsp;<input id="chords_only" type="checkbox" style="margin-top:-5px;margin-bottom:0px;"/></p>',a+='<p class="tunesearchoptionsmax">Tune style:<select id="tunesearchstyle" onchange="SetTuneSearchStyle();" title="Tune style to search" style="margin-top:-7px;width:130px"><option value="">All Tunes</option> <option value="jig">Jigs</option> <option value="reel">Reels</option> <option value="slip jig">Slip Jigs</option> <option value="hornpipe">Hornpipes</option> <option value="polka">Polkas</option> <option value="slide">Slides</option> <option value="waltz">Waltzes</option> <option value="barndance">Barndances</option> <option value="strathspey">Strathspeys</option> <option value="three-two">Three-Twos</option> <option value="mazurka">Mazurkas</option> <option value="march">Marches</option></select>&nbsp;&nbsp;&nbsp;&nbsp;Maximum number of results:<select id="maxtunesearchresults" onchange="SetTuneSearchMaxResults();" title="Maximum number of results" style="margin-top:-7px;"><option value="10">10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option></select></p>',a+='<p style="margin-top:10px;font-size:12pt;">	<input class="btn btn-start-search start-search" id="start-search" onclick="searchForTunes();" type="button" value="Search" title="Start search"><span id="status">&nbsp;&nbsp;&nbsp;Waiting for tune collection to load...</span></p>',a+='<div style="margin-bottom: 18px;">',a+='<h4 id="search_result">Search Results:</h4>',a+='<textarea id="search_results" style="font-family:Courier;font-size:13pt;line-height:16pt;width:724px;height:'+o+'px;padding:6px" placeholder="Search results will appear here" spellcheck="false" autocorrect="off" autocapitalize="none" oninput="idleSearchResults()"></textarea>',a+='<p style="margin-top:20px;text-align: center;">',a+='<input class="btn btn-add-search-results add-search-results-disabled" id="add-search-results" onclick="addSearchResults();" type="button" value="Add Results to Tunebook" title="Add Results to Tunebook">',a+="</p>",DayPilot.Modal.alert(a,{theme:"modal_flat",top:25,width:800,scrollWithPage:AllowDialogsToScroll()}).then(function(){n&&n()}),document.getElementById("maxtunesearchresults").value="25",gTheMaxDatabaseResults=25,document.getElementById("tunesearchstyle").value="",gTheTuneSearchStyle="",document.getElementById("add-search-results").disabled=!0,document.getElementById("tuneNameToSearch").addEventListener("keydown",function(t){"Enter"===t.key&&(t.stopPropagation(),t.preventDefault(),searchForTunes())}),0==gTheCurrentTuneDatabase?document.getElementById("databaseselect").value="0":document.getElementById("databaseselect").value="1",SwitchTuneDatabase()}function ChangeTuneOrderMobileSelect(t){ChangeTuneOrderCurrent&&ChangeTuneOrderCurrent.classList.remove("draggable_tune_mobile_selected"),ChangeTuneOrderCurrent=t,t.classList.add("draggable_tune_mobile_selected")}function ChangeTuneOrderMobileUp(){if(null==ChangeTuneOrderCurrent)return;var t=ChangeTuneOrderCurrent.previousElementSibling;if(null==t)return;let n=document.getElementById("sortable-tune-list-mobile");n.insertBefore(ChangeTuneOrderCurrent,t);let o=document.querySelectorAll("#sortable-tune-list-mobile .draggable_tune_mobile");ChangeTuneOrderNewOrder=Array.from(o).map(t=>t.getAttribute("data_tune_index"))}function ChangeTuneOrderMobileDown(){if(null==ChangeTuneOrderCurrent)return;var t=ChangeTuneOrderCurrent.nextElementSibling;if(null==t)return;var n=t;t=t.nextElementSibling;let o=document.getElementById("sortable-tune-list-mobile");null==t?o.insertBefore(n,ChangeTuneOrderCurrent):o.insertBefore(ChangeTuneOrderCurrent,t);let a=document.querySelectorAll("#sortable-tune-list-mobile .draggable_tune_mobile");ChangeTuneOrderNewOrder=Array.from(a).map(t=>t.getAttribute("data_tune_index"))}var ChangeTuneOrderCurrent=null,ChangeTuneOrderOriginalOrder=[],ChangeTuneOrderNewOrder=[];function ChangeTuneOrderMobile(){var t,n=[];ChangeTuneOrderNewOrder=[],ChangeTuneOrderCurrent=null,totalTunes=CountTunes();var o=GetTunebookIndexTitles(),a=o.length;if(0==a){var r="No tunes to re-order.";r=makeCenteredPromptString(r),DayPilot.Modal.alert(r,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});return}var l='<div id="sortable-tune-list-mobile" style="overflow:auto;height:'+(window.innerHeight-350)+'px;margin-top:18px">';for(t=0;t<a;++t)l+='<div class="draggable_tune_mobile" data_tune_index="'+t+'" onclick="ChangeTuneOrderMobileSelect(this)">'+o[t]+"</div>";var s=[{html:'<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">Change the Order of the Tunes&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/app/userguide.html#change_tune_order" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:l+="</div>"},{html:'<p style="text-align:center;margin-top:36px;"><input id="mobile_tune_order_up" class="advancedcontrols btn btn-injectcontrols-headers" onclick="ChangeTuneOrderMobileUp(this);" type="button" value="Move Up" title="Moves the currently selected tune up one position"><input id="mobile_tune_order_down" class="advancedcontrols btn btn-injectcontrols-headers" onclick="ChangeTuneOrderMobileDown(this);" type="button" value="Move Down" title="Moves the currently selected tune down one position"></p>'}];setTimeout(function(){let t=document.querySelectorAll("#sortable-tune-list-mobile .draggable_tune_mobile");n=(ChangeTuneOrderNewOrder=Array.from(t).map(t=>t.getAttribute("data_tune_index"))).slice()},100),DayPilot.Modal.form(s,{},{theme:"modal_flat",top:25,width:650,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(o){if(!o.canceled){var a=!1;for(t=0;t<totalTunes;++t)if(ChangeTuneOrderNewOrder[t]!=n[t]){a=!0;break}if(a){var r=FindPreTuneHeader(gTheABC.value);for(t=0;t<totalTunes;++t){var l=getTuneByIndex(parseInt(ChangeTuneOrderNewOrder[t]));l=l.trim(),l+="\n\n",r+=l}gTheABC.value=r,RenderAsync(!0,null,function(){gTheABC.selectionStart=0,gTheABC.selectionEnd=0,gTheABC.focus(),MakeTuneVisible(!0)}),gIsDirty=!0}}})}function ChangeTuneOrder(){var t,n=[],o=[];ChangeTuneOrderCurrent=null,totalTunes=CountTunes();var a=GetTunebookIndexTitles(),r=a.length;if(0==r){var l="No tunes to re-order.";l=makeCenteredPromptString(l),DayPilot.Modal.alert(l,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});return}var s='<div id="sortable-tune-list" style="overflow:auto;height:'+(window.innerHeight-300)+'px;margin-top:18px">';for(t=0;t<r;++t)s+='<div class="draggable_tune" draggable="true" data_tune_index="'+t+'">'+a[t]+"</div>";var g=[{html:'<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">Change the Order of the Tunes&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/app/userguide.html#change_tune_order" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="margin-top:18px;font-size:12pt;">Drag and drop the tune names to change the order of the tunes in the tunebook:</p>'},{html:s+="</div>"}];setTimeout(function(){let t=document.querySelectorAll("#sortable-tune-list .draggable_tune");n=(o=Array.from(t).map(t=>t.getAttribute("data_tune_index"))).slice()},100),DayPilot.Modal.form(g,{},{theme:"modal_flat",top:25,width:650,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(a){if(!a.canceled){var r=!1;for(t=0;t<totalTunes;++t)if(o[t]!=n[t]){r=!0;break}if(r){var l=FindPreTuneHeader(gTheABC.value);for(t=0;t<totalTunes;++t){var s=getTuneByIndex(parseInt(o[t]));s=s.trim(),s+="\n\n",l+=s}gTheABC.value=l,RenderAsync(!0,null,function(){gTheABC.selectionStart=0,gTheABC.selectionEnd=0,gTheABC.focus(),MakeTuneVisible(!0)}),gIsDirty=!0}}});let c=document.getElementById("sortable-tune-list"),d=null;c.addEventListener("click",function(t){var n=t.target;n.classList&&n.classList.contains("draggable_tune")&&(d=n,ChangeTuneOrderCurrent&&ChangeTuneOrderCurrent.classList.remove("draggable_tune_selected"),ChangeTuneOrderCurrent=d,d.classList.add("draggable_tune_selected"))}),c.addEventListener("dragstart",function(t){d=t.target,t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",d.innerHTML),ChangeTuneOrderCurrent&&ChangeTuneOrderCurrent.classList.remove("draggable_tune_selected"),ChangeTuneOrderCurrent=d,d.classList.add("draggable_tune_selected")}),c.addEventListener("dragover",function(t){t.preventDefault();let n=t.target;if(n&&n!==d&&n.classList.contains("draggable_tune")){let a=n.getBoundingClientRect(),r=(t.clientY-a.top)/(a.bottom-a.top)>.5;c.insertBefore(d,r?n.nextElementSibling:n);let l=document.querySelectorAll("#sortable-tune-list .draggable_tune");o=Array.from(l).map(t=>t.getAttribute("data_tune_index"))}}),c.addEventListener("dragend",function(){d=null})}function CullTunesUpdateKeepList(){CullTunesKeepList=[];let t=document.querySelectorAll("#cullable-tune-list .cullable_tune");Array.from(t).map(t=>{t.classList.contains("cull_selected")?CullTunesKeepList.push(0):CullTunesKeepList.push(1)})}function CullToggleSelection(t){t.classList.toggle("cull_selected"),CullTunesUpdateKeepList()}function CullSelectAll(){let t=document.querySelectorAll("#cullable-tune-list .cullable_tune");Array.from(t).map(t=>t.classList.add("cull_selected")),CullTunesUpdateKeepList()}function CullClearSelection(){let t=document.querySelectorAll("#cullable-tune-list .cullable_tune");Array.from(t).map(t=>t.classList.remove("cull_selected")),CullTunesUpdateKeepList()}var CullTunesKeepList=[];function CullTunes(){CullTunesKeepList=[],totalTunes=CountTunes();var t,n=GetTunebookIndexTitles(),o=n.length;if(0==o){var a="No tunes to delete.";a=makeCenteredPromptString(a),DayPilot.Modal.alert(a,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});return}var r=window.innerHeight-340;isMobileBrowser()&&(r=window.innerHeight-375);var l='<div id="cullable-tune-list" style="overflow:auto;height:'+r+'px;margin-top:18px">';for(t=0;t<o;++t)l+='<div class="cullable_tune" onclick="CullToggleSelection(this)">'+n[t]+"</div>";var s=[{html:'<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">Delete Selected Tunes&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/app/userguide.html#delete_selected_tunes" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:l+="</div>"},{html:'<p style="text-align:center;margin-top:36px;"><input id="cull_select_all" class="advancedcontrols btn btn-injectcontrols-headers" onclick="CullSelectAll();" type="button" value="Select All" title="Selects all the tunes for deletion"><input id="cull_clear_selection" class="advancedcontrols btn btn-injectcontrols-headers" onclick="CullClearSelection();" type="button" value="Clear Selection" title="Unselects all the tunes for deletion"></p>'}];DayPilot.Modal.form(s,{},{theme:"modal_flat",top:25,width:650,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1,okText:"Delete"}).then(function(n){if(!n.canceled){var o=CullTunesKeepList.length,a=0;for(t=0;t<o;++t)0==CullTunesKeepList[t]&&(bGotChange=!0,a++);if(a){var r="Are you sure you want to delete "+a;1==a?r+=" tune from your tunebook?":r+=" tunes from your tunebook?",r=makeCenteredPromptString(r),DayPilot.Modal.confirm(r,{top:200,theme:"modal_flat",scrollWithPage:AllowDialogsToScroll()}).then(function(n){if(!n.canceled){var o=FindPreTuneHeader(gTheABC.value);for(t=0;t<totalTunes;++t)if(1==CullTunesKeepList[t]){var a=getTuneByIndex(t);a=a.trim(),a+="\n\n",o+=a}gTheABC.value=o,RenderAsync(!0,null,function(){gTheABC.selectionStart=0,gTheABC.selectionEnd=0,gTheABC.focus(),MakeTuneVisible(!0)}),gIsDirty=!0}})}}})}var gAddABCOKButton=null;function Configure_AddABC_UI(){var t=gFeaturesShowSearch,n=gFeaturesShowExamples,o=gFeaturesShowTemplates;let a={showsearch:gFeaturesShowSearch,showexampletunes:gFeaturesShowExamples,showexampletemplates:gFeaturesShowTemplates};DayPilot.Modal.form([{html:'<p style="text-align:center;font-size:14pt;font-family:helvetica;margin-left:15px;">Select Add ABC Feature Options</p>'},{name:"          Show Search and Add Tunes",id:"showsearch",type:"checkbox",cssClass:"configure_ui_options_form_text"},{name:"          Show Example Tunes",id:"showexampletunes",type:"checkbox",cssClass:"configure_ui_options_form_text"},{name:"          Show Example Templates",id:"showexampletemplates",type:"checkbox",cssClass:"configure_ui_options_form_text"},],a,{theme:"modal_flat",top:100,width:500,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(a){!a.canceled&&(gFeaturesShowSearch=a.result.showsearch,gFeaturesShowExamples=a.result.showexampletunes,gFeaturesShowTemplates=a.result.showexampletemplates,(gFeaturesShowSearch!=t||gFeaturesShowExamples!=n||gFeaturesShowTemplates!=o)&&(SaveConfigurationSettings(),gAddABCOKButton.click(),setTimeout(function(){AddABC()},250)))})}function AddABCCallback(){gAddABCOKButton&&gAddABCOKButton.click()}function AddABC(){sendGoogleAnalytics("dialog","AddABC");var t='<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">Add ABC Tunes, Templates, and PDF Features&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/app/userguide.html#add_templates_dialog" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span><img id="moreaddabcsettings" class="moreaddabcsettings moresettingsbutton" src="img/settings.png" title="Add ABC Settings" onclick="Configure_AddABC_UI()"></img></p>';t+='<div id="add-new-tune-dialog">',t+='<p style="text-align:center;margin-top:28px;font-size:18px;">Add Your Own Tunes from an ABC, MusicXML, BWW, or MIDI File</p>',t+='<p style="text-align:center;margin-top:16px;">',t+='<label class="abcuploaddialog btn btn-top" for="addabcfilebutton" title="Adds tunes from an existing ABC, MusicXML, BWW, or MIDI file to the end of the ABC">Choose File to Add <input type="file" id="addabcfilebutton" accept=".abc,.txt,.ABC,.TXT,.xml,.XML,.musicxml,.mxl,.MXL,.mid,.MID,.midi,.MIDI,.bww,.BWW" hidden/></label>',t+='<input class="dialogrestorebutton btn btn-restorebutton" id="dialogrestorebutton" onclick="RestoreSnapshot(event,false,true);" type="button" value="Restore from Snapshot" title="Replaces the contents of the ABC editor with a Snapshot saved in browser storage.&nbsp;&nbsp;Click for Snapshot #1, Shift-click for Snapshot #2, Alt-click for Snapshot #3, Shift-Alt-click for Snapshot #4." style="display:none;">',t+='<input class="dialogrestoreautobutton btn btn-restorebutton" id="dialogrestoreautobutton" onclick="RestoreSnapshot(event,true,true);" type="button" value="Restore from Auto-Snapshot" title="Replaces the contents of the ABC editor with an Auto-Snapshot saved in browser storage" style="display:none;">',t+="</p>",gFeaturesShowSearch&&(t+='<p style="text-align:center;font-size:18px;margin-top:24px;">Search and Add Tunes</p>',t+='<p style="text-align:center;margin-top:16px;">',t+='<input id="searchandaddtunes" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AddFromSearch(null,AddABCCallback);" type="button" value="Search and Add Tunes" title="Search for tunes to add to your tunebook">'),t+='<p style="text-align:center;font-size:18px;margin-top:24px;">Change the Order or Delete Tunes</p>',t+='<p style="text-align:center;margin-top:16px;">',isDesktopBrowser()?t+='<input id="changetuneorder" class="advancedcontrols btn btn-injectcontrols-headers" onclick="ChangeTuneOrder();" type="button" value="Change the Order of the Tunes" title="Change the order of the tunes">':t+='<input id="changetuneorder" class="advancedcontrols btn btn-injectcontrols-headers" onclick="ChangeTuneOrderMobile();" type="button" value="Change the Order of the Tunes" title="Change the order of the tunes">',t+='<input id="culltunes" class="advancedcontrols btn btn-injectcontrols-headers" onclick="CullTunes();" type="button" value="Delete Tunes from the Tunebook" title="Delete selected tunes from the tunebook">',t+="</p>",gFeaturesShowExamples&&(t+='<p style="text-align:center;font-size:18px;margin-top:24px;">Add an Example ABC Tune</p>',t+='<p style="text-align:center;margin-top:16px;">',t+='<input id="addnewreel" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AppendSampleReel();" type="button" value="Add an Example Reel" title="Adds an example reel (Cooley\'s) to the end of the ABC">',t+='<input id="addnewjig" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AppendSampleJig();" type="button" value="Add an Example Jig" title="Adds an example jig (The Kesh) to the end of the ABC">',t+='<input id="addnewhornpipe" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AppendSampleHornpipe();" type="button" value="Add an Example Hornpipe" title="Adds an example Hornpipe (Alexander\'s) to the end of the ABC">',t+="</p>",t+='<p style="text-align:center;margin-top:16px;">',t+='<input id="addjsbach" class="advancedcontrols btn btn-injectcontrols-headers" style="margin-right:24px;" onclick="AppendJSBach();" type="button" value="Add J.S. Bach Two-Part Invention #1" title="Adds the J.S. Bach 2-Part Invention #1 to the end of the ABC">',t+='<input id="addjsbach" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AppendJSBach2();" type="button" value="Add J.S. Bach BWV570 Fantasia" title="Adds the J.S. Bach BWV570 Fantasia for Pipe Organ to the end of the ABC">',t+="</p>"),gFeaturesShowTemplates&&(t+='<p style="text-align:center;margin-top:24px;font-size:18px;">Add an ABC Template</p>',t+='<p style="text-align:center;margin-top:16px;">',t+='<input id="addnewtunetemplate" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AppendTuneTempate();" type="button" value="Add a Tune Template" title="Adds a tune template to the end of the ABC">',t+='<input id="addsongtemplate" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AppendSongTemplate();" type="button" value="Add a Song Template" title="Adds a minimal song template to the end of the ABC">',t+='<input id="addnewsong" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AppendSampleSong();" type="button" value="Add an Example Song" title="Adds an example song to the end of the ABC">',t+="</p>",t+='<p style="text-align:center;margin-top:16px;">',t+='<input id="addbodhrantemplate" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AddBodhranTemplate();" type="button" value="Add Bodhran Backing Track Template" title="Opens a dialog where you can choose a bodhran backing track template of common tune styles to add to the end of the ABC">',t+='<input id="adddatabasetemplate" class="advancedcontrols btn btn-injectcontrols-headers" style="margin-right:24px;" onclick="AppendDatabaseTemplate();" type="button" value="Add Offline Notes Database Loader Templates" title="Adds a template that makes it easy to load a full set of instrument notes and reverb settings into the database">',t+="</p>"),t+='<p style="text-align:center;margin-top:24px;font-size:18px;">Inject PDF Tunebook Features</p>',t+='<p style="text-align:center;margin-top:16px;"><input id="tunebookbuilder_add" class="advancedcontrols btn btn-injectcontrols-tunebookbuilder" onclick="PDFTunebookBuilder();" type="button" value="Inject PDF Tunebook Features" title="Inject commands at the top of your PDF tunebook for adding a Title Page, Table of Contents, Index, Page Headers, Page Footers, Playback Links, and Custom QR Code"></p>',t+='<p style="text-align:center;margin-top:24px;">',t+="</p>",t+="</div>",setTimeout(function(){idleAddABC()},25),DayPilot.Modal.alert(t,{theme:"modal_flat",top:25,width:730,scrollWithPage:AllowDialogsToScroll()}).then(function(){})}function AddBodhranTemplate(){var t='<p style="text-align:center;margin-bottom:36px;font-size:16pt;font-family:helvetica;margin-left:15px;">Add Bodhran Backing Track Tune Template&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/app/userguide.html#bodhran_map" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>';t+='<p style="text-align:center;">',t+='<input id="bodhranreel" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AddBodhranReelTemplate()" type="button" value="Add Reel Template" title="Adds a reel bodhran template to the end of the ABC">',t+='<input id="bodhranjig" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AddBodhranJigTemplate()" type="button" value="Add Jig Template" title="Adds a jig bodhran template to the end of the ABC">',t+="</p>",t+='<p style="text-align:center;margin-top:24px;">',t+='<input id="bodhranslipjig" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AddBodhranSlipJigTemplate()" type="button" value="Add Slip Jig Template" title="Adds a slip jig bodhran template to the end of the ABC">',t+='<input id="bodhranslide" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AddBodhranSlideTemplate()" type="button" value="Add Slide Template" title="Adds a slide bodhran template to the end of the ABC">',t+="</p>",t+='<p style="text-align:center;margin-top:24px;">',t+='<input id="bodhranhornpipe" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AddBodhranHornpipeTemplate()" type="button" value="Add Hornpipe Template" title="Adds a hornpipe bodhran template to the end of the ABC">',t+='<input id="bodhranpolka" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AddBodhranPolkaTemplate()" type="button" value="Add Polka Template" title="Adds a polka bodhran template to the end of the ABC">',t+="</p>",DayPilot.Modal.alert(t,{theme:"modal_flat",top:200,width:650,scrollWithPage:AllowDialogsToScroll()})}function AddBodhranReelTemplate(){sendGoogleAnalytics("action","AddBodhranReelTemplate");var t="";CountTunes()>0&&(t+="\n"),t+="X:1\n",t+="T:Reel Bodhran Template\n",t+="R:Reel\n",t+="M:4/4\n",t+="L:1/8\n",t+="Q:1/2=90\n",t+="% Change this to match the key of the tune:\n",t+="K:C\n",t+="%%staffsep 50\n",t+="%abcjs_soundfont fatboy\n",t+="%swing 0.15\n",t+="%\n",t+="% This template uses two voices:\n",t+="% Voice 1 - Melody\n",t+="% Voice 2 - Bodhran backing track\n",t+="%\n",t+="% Melody voice definition:\n",t+="%\n",t+="V:1\n",t+="%%MIDI program 0\n",t+="%\n",t+="% Bodhran voice definition:\n",t+="%\n",t+="V:2 transpose=-24\n",t+="%%MIDI program 117\n",t+="%\n",t+="% Set the Bodhran tuning\n",t+="% Valid values are:\n",t+="% C, C#, Db, D, D#, Eb, E, F, F#, Gb, G, G#, Ab, A, A#, Bb, or B.\n",t+="%\n",t+="%bodhran_tuning A\n",t+="%\n",t+="% Voice 1 - Replace this with your Reel melody:\n",t+="%\n",t+="V:1\n",t+="|: z8 | z8 | z8 | z8 |\n",t+="   z8 | z8 | z8 | z8 :|\n",t+="|: z8 | z8 | z8 | z8 |\n",t+="   z8 | z8 | z8 | z8 :|\n",t+="|: z8 | z8 | z8 | z8 |\n",t+="   z8 | z8 | z8 | z8 :|\n",t+="|: z8 | z8 | z8 | z8 |\n",t+="   z8 | z8 | z8 | z8 :|\n",t+="%\n",t+="% Voice 2 - Bodhran backing patterns:\n",t+="%\n",t+="V:2\n",t+="|: =C,C,=F,C,  C,C,F,C, | =C,C,=F,C, C,C,F,C, | =C,C,=F,C, C,C,F,C, | =C,C,=F,C, C,C,F,C, |\n",t+="   =C,C,=F,C,  C,C,F,C, | =C,C,=F,C, C,C,F,C, | =C,C,=F,C, C,C,F,C, | =C,C,!>!=F,/E,/D, !>!F,4 :|\n",t+="|: ^d2AA ^F=G^GA | ^A2=AA ^A2=AA | ^A=CCC CCA2 | ^A=CCC ^A2=AA |\n",t+="   ^d2AA ^F=G^GA | ^A2=AA ^A2=AA | ^A=CCC CCA2 | ^A=CCC ^A2=AA :|\n",t+="|: ^d2AA B2AA | ^A=C=FC ACFC | =G/G/G GA ^G2^AA | ^d^A=AA =G2AA |\n",t+="   ^d2AA B2AA | ^A=C=FC ACFC | =G/G/G GA ^G2^AA | ^d^A=AA =G2AA :| \n",t+="|: ^d=CCe DD=f^D | ^A=C=FC ^A2=AA | A3d =c2AA | =G^GAA e2GG |\n",ProcessAddTune(t+="   ^d=CCe DD=f^D | ^A=C=FC ^A2=AA | A3d =c2AA | =G^GAA e2GG :|\n")}function AddBodhranJigTemplate(){sendGoogleAnalytics("action","AddBodhranJigTemplate");var t="";CountTunes()>0&&(t+="\n"),t+="X:1\n",t+="T:Jig Bodhran Template\n",t+="R:Jig\n",t+="M:6/8\n",t+="L:1/8\n",t+="Q:3/8=120\n",t+="% Change this to match the key of the tune:\n",t+="K:C\n",t+="%%staffsep 50\n",t+="%abcjs_soundfont fatboy\n",t+="%swing 0.25\n",t+="%\n",t+="% This template uses two voices:\n",t+="% Voice 1 - Melody\n",t+="% Voice 2 - Bodhran backing track\n",t+="%\n",t+="% Melody voice definition:\n",t+="%\n",t+="V:1\n",t+="%%MIDI program 0\n",t+="%\n",t+="% Bodhran voice definition:\n",t+="%\n",t+="V:2 transpose=-24\n",t+="%%MIDI program 117\n",t+="%\n",t+="% Set the Bodhran tuning\n",t+="% Valid values are:\n",t+="% C, C#, Db, D, D#, Eb, E, F, F#, Gb, G, G#, Ab, A, A#, Bb, or B.\n",t+="%\n",t+="%bodhran_tuning A\n",t+="%\n",t+="% Voice 1 - Replace this with your Jig melody:\n",t+="%\n",t+="V:1\n",t+="|: z6 | z6 | z6 | z6 |\n",t+="   z6 | z6 | z6 | z6 :|\n",t+="|: z6 | z6 | z6 | z6 |\n",t+="   z6 | z6 | z6 | z6 :|\n",t+="|: z6 | z6 | z6 | z6 |\n",t+="   z6 | z6 | z6 | z6 :|\n",t+="%\n",t+="% Voice 2 - Bodhran backing patterns:\n",t+="%\n",t+="V:2\n",t+="|: =F,zD, F,=C,C, | =F,zD, F,=C,C, | =F,zD, F,=C,C, | =F,zD, F,=C,C, |\n",t+="   =F,zD, F,=C,C, | =F,zD, F,=C,C, | =F,zD, F,=C,C, | =F,=C,C, !>!F,3 :|\n",t+="|: ^d=CC =FCC | ^d2=C AEA | ^A2=C =FCC|^d=CC AEA |\n",t+="   ^d=CC =FCC | ^d2=C AEA | ^A2=C =FCC|^d=CC AEA :|\n",t+="|: ^d=CC =F/F/FC | ^A2d =F=C=A | d=c/=B/^A ^d=C=F | AEE d3 |\n",ProcessAddTune(t+="   ^d=CC =F/F/FC | ^A2d =F=C=A | d=c/=B/^A ^d=C=F | AEE d3 :| \n")}function AddBodhranSlipJigTemplate(){sendGoogleAnalytics("action","AddBodhranSlipJigTemplate");var t="";CountTunes()>0&&(t+="\n"),t+="X:1\n",t+="T:Slip Jig Bodhran Template\n",t+="R:Slip Jig\n",t+="M:9/8\n",t+="L:1/8\n",t+="Q:3/8=120\n",t+="% Change this to match the key of the tune:\n",t+="K:C\n",t+="%%staffsep 50\n",t+="%abcjs_soundfont fatboy\n",t+="%swing 0.25\n",t+="%\n",t+="% This template uses two voices:\n",t+="% Voice 1 - Melody\n",t+="% Voice 2 - Bodhran backing track\n",t+="%\n",t+="% Melody voice definition:\n",t+="%\n",t+="V:1\n",t+="%%MIDI program 0\n",t+="%\n",t+="% Bodhran voice definition:\n",t+="%\n",t+="V:2 transpose=-24\n",t+="%%MIDI program 117\n",t+="%\n",t+="% Set the Bodhran tuning\n",t+="% Valid values are:\n",t+="% C, C#, Db, D, D#, Eb, E, F, F#, Gb, G, G#, Ab, A, A#, Bb, or B.\n",t+="%\n",t+="%bodhran_tuning A\n",t+="%\n",t+="% Voice 1 - Replace this with your Slip Jig melody:\n",t+="%\n",t+="V:1\n",t+="|: z9 | z9 | z9 | z9 |\n",t+="   z9 | z9 | z9 | z9 :|\n",t+="|: z9 | z9 | z9 | z9 |\n",t+="   z9 | z9 | z9 | z9 :|\n",t+="%\n",t+="% Voice 2 - Bodhran backing patterns:\n",t+="%\n",t+="V:2\n",t+="|: =F,zD, F,=C,C, !>!=F,3 | =F,zD, F,=C,C, F,C,C, | =F,zD, F,=C,C, !>!F,3 | =F,zD, F,=C,C, F,C,C, |\n",t+="   =F,zD, F,=C,C, !>!=F,3 | =F,zD, F,=C,C, F,C,C, | =F,zD, F,=C,C, !>!F,3 | =F,zD, F,=C,C, F,C,C, :|\n",t+="|: ^d=CC =FCC FCC | ^d2=C =FCC AEA | ^A2=C =FCC A2A | ^d=CC =FCF A3 |\n",ProcessAddTune(t+="   ^d=CC =FCC FCC | ^d2=C =FCC AEA | ^A2=C =FCC A2A | ^d=CC =FCF A3 :|\n")}function AddBodhranSlideTemplate(){sendGoogleAnalytics("action","AddBodhranSlideTemplate");var t="";CountTunes()>0&&(t+="\n"),t+="X:1\n",t+="T:Slide Bodhran Template\n",t+="R:Slide\n",t+="M:12/8\n",t+="L:1/8\n",t+="Q:3/8=130\n",t+="% Change this to match the key of the tune:\n",t+="K:C\n",t+="%%staffsep 50\n",t+="%abcjs_soundfont fatboy\n",t+="%swing 0.25\n",t+="%\n",t+="% This template uses two voices:\n",t+="% Voice 1 - Melody\n",t+="% Voice 2 - Bodhran backing track\n",t+="%\n",t+="% Melody voice definition:\n",t+="%\n",t+="V:1\n",t+="%%MIDI program 0\n",t+="%\n",t+="% Bodhran voice definition:\n",t+="%\n",t+="V:2 transpose=-24\n",t+="%%MIDI program 117\n",t+="%\n",t+="% Set the Bodhran tuning\n",t+="% Valid values are:\n",t+="% C, C#, Db, D, D#, Eb, E, F, F#, Gb, G, G#, Ab, A, A#, Bb, or B.\n",t+="%\n",t+="%bodhran_tuning A\n",t+="%\n",t+="% Voice 1 - Replace this with your Slide melody:\n",t+="%\n",t+="V:1\n",t+="|: z12 | z12 |\n",t+="   z12 | z12 :|\n",t+="|: z12 | z12 |\n",t+="   z12 | z12 :|\n",t+="%\n",t+="% Voice 2 - Bodhran backing patterns:\n",t+="%\n",t+="V:2\n",t+="|: =F,zD, F,=C,C, F,C,C, !>!F,3 | =F,zD, F,=C,C, F,C,C, !>!F,3 |\n",t+="   =F,zD, F,=C,C, F,C,C, !>!F,3 | =F,zD, F,=C,C, F,C,C, !>!F,3 :|\n",t+="|: ^A2=F ^dF^A =d2=A ^c2^G | ^A2=F ^dF^A =B3 B2^F |\n",ProcessAddTune(t+="   ^A2=F ^dF^A =d2=A ^c2^G | ^A=C=F ^dF^A F3 ^A3 :|\n")}function AddBodhranPolkaTemplate(){sendGoogleAnalytics("action","AddBodhranPolkaTemplate");var t="";CountTunes()>0&&(t+="\n"),t+="X:1\n",t+="T:Polka Bodhran Template\n",t+="R:Polka\n",t+="M:2/4\n",t+="L:1/8\n",t+="Q:1/4=130\n",t+="% Change this to match the key of the tune:\n",t+="K:C\n",t+="%%staffsep 50\n",t+="%abcjs_soundfont fatboy\n",t+="%\n",t+="% This template uses two voices:\n",t+="% Voice 1 - Melody\n",t+="% Voice 2 - Bodhran backing track\n",t+="%\n",t+="% Melody voice definition:\n",t+="%\n",t+="V:1\n",t+="%%MIDI program 0\n",t+="%\n",t+="% Bodhran voice definition:\n",t+="%\n",t+="V:2 transpose=-24\n",t+="%%MIDI program 117\n",t+="%\n",t+="% Set the Bodhran tuning\n",t+="% Valid values are:\n",t+="% C, C#, Db, D, D#, Eb, E, F, F#, Gb, G, G#, Ab, A, A#, Bb, or B.\n",t+="%\n",t+="%bodhran_tuning A\n",t+="%\n",t+="% Voice 1 - Replace this with your Polka melody:\n",t+="%\n",t+="V:1\n",t+="|: z4 | z4 | z4 | z4 |\n",t+="   z4 | z4 | z4 | z4 :|\n",t+="|: z4 | z4 | z4 | z4 |\n",t+="   z4 | z4 | z4 | z4 :|\n",t+="%\n",t+="% Voice 2 - Bodhran backing patterns:\n",t+="%\n",t+="V:2\n",t+="|: =C,2 C,=F, | =C,=F, C,F, | =C,=F, C,F, | =C,2 =F,2 |\n",t+="   =C,2 C,=F, | =C,=F, C,F, | =C,=F, C,F, | =C,2 =F,2 :|\n",t+="|: ^A/A/A =C^A | ^F^A =CA | ^A=A/A/ =FA | ^A2E^c |\n",ProcessAddTune(t+="   ^A/A/A =C^A | ^F^A =CA | ^A=A/A/ =FA | ^A2E^c :|\n")}function AddBodhranHornpipeTemplate(){sendGoogleAnalytics("action","AddBodhranHornpipeTemplate");var t="";CountTunes()>0&&(t+="\n"),t+="X:1\n",t+="T:Hornpipe Bodhran Template\n",t+="R:Hornpipe\n",t+="M:4/4\n",t+="L:1/8\n",t+="Q:1/2=80\n",t+="% Change this to match the key of the tune:\n",t+="K:C\n",t+="%%staffsep 50\n",t+="%abcjs_soundfont fatboy\n",t+="%swing 0.25\n",t+="%\n",t+="% This template uses two voices:\n",t+="% Voice 1 - Melody\n",t+="% Voice 2 - Bodhran backing track\n",t+="%\n",t+="% Melody voice definition:\n",t+="%\n",t+="V:1\n",t+="%%MIDI program 0\n",t+="%\n",t+="% Bodhran voice definition:\n",t+="%\n",t+="V:2 transpose=-24\n",t+="%%MIDI program 117\n",t+="%\n",t+="% Set the Bodhran tuning\n",t+="% Valid values are:\n",t+="% C, C#, Db, D, D#, Eb, E, F, F#, Gb, G, G#, Ab, A, A#, Bb, or B.\n",t+="%\n",t+="%bodhran_tuning A\n",t+="%\n",t+="% Voice 1 - Replace this with your Hornpipe melody:\n",t+="%\n",t+="V:1\n",t+="|: z8 | z8 | z8 | z8 |\n",t+="   z8 | z8 | z8 | z8 :|\n",t+="|: z8 | z8 | z8 | z8 |\n",t+="   z8 | z8 | z8 | z8 :|\n",t+="%\n",t+="% Voice 2 - Bodhran backing patterns:\n",t+="%\n",t+="V:2\n",t+="|: =F,=C, F,C, F,C, F,C, | =F,=C, (3!>!F,C,C, !>!F,z F,C, | =F,=C, F,C, F,C, F,C, |=F,=C, (3F,C,C, !>!F,z F,C, |\n",t+="   =F,=C, F,C, F,C, F,C, | =F,=C, (3!>!F,C,C, !>!F,z F,C, | =F,=C, F,C, F,C, F,C, | =F,=C, (3F,C,C, !>!F,z F,C, :|\n",t+="|: =F,=C, F,C, F,C, F,C, | =F,=C, F,C, F,C, F,C, | =F,=C, F,C, F,C, F,C, | =F,=C, (3!>!F,C,C, !>!F,z F,C, |\n",ProcessAddTune(t+="   =F,=C, F,C, F,C, F,C, | =F,=C, F,C, F,C, F,C, | =F,=C, F,C, F,C, F,C, | =F,=C, (3!>!F,C,C, !>!F,z F,C, :|\n")}function AppendSampleReel(){sendGoogleAnalytics("action","AppendSampleReel");var t="";CountTunes()>0&&(t+="\n"),t+="X: 1\n",t+="T: Cooley's\n",t+="C: Traditional\n",t+="R: Reel\n",t+="M: 4/4\n",t+="L: 1/8\n",t+="Q: 1/2=90\n",t+="K: Edor\n",t+="%abcjs_soundfont fluid\n",t+="%\n",t+="% Use an Acoustic Grand Piano sound for the melody:\n",t+="%%MIDI program 0\n",t+="%\n",t+="% Use an Acoustic Grand Piano sound for the chords:\n",t+="%%MIDI chordprog 0\n",t+="%\n",t+="% Use an Synth Bass sound for the bass:\n",t+="%%MIDI bassprog 38\n",t+="%\n",t+="% Set a specific amount of swing:\n",t+="%swing 0.15\n",t+="%\n",t+='|:"Em"EBBA B2 EB|B2 AB dBAG|"D"F/E/D AD BDAD|F/E/D AD BAGF|\n',t+='"Em"EBBA B2 EB|B2 AB defg|"D"afge dBAF|1 DEFD "Em"E3D:|2 DEFD "Em"E2gf||\n',t+='|:"Em"eB (3BBB eBgf|eBB2 gedB|"D"A/A/A FA DAFA|A/A/A FA defg|\n',ProcessAddTune(t+='"Em"eB (3BBB eBgf|eBBB defg|"D"afge dBAF|1 DEFD "Em"E2gf:|2 DEFD "Em"E4|]\n')}function AppendSampleJig(){sendGoogleAnalytics("action","AppendSampleJig");var t="";CountTunes()>0&&(t+="\n"),t+="X: 1\n",t+="T: The Kesh\n",t+="C: Traditional\n",t+="R: Jig\n",t+="M: 6/8\n",t+="L: 1/8\n",t+="Q: 3/8=120\n",t+="K: Gmaj\n",t+="%abcjs_soundfont fluid\n",t+="%\n",t+="% Use an Acoustic Grand Piano sound for the melody:\n",t+="%%MIDI program 0\n",t+="%\n",t+="% Use an Acoustic Grand Piano for the chords:\n",t+="%%MIDI chordprog 0\n",t+="%\n",t+="% Use an Synth Bass sound for the bass:\n",t+="%%MIDI bassprog 38\n",t+="%\n",t+="% Set a specific amount of swing:\n",t+="%swing 0.25\n",t+="%\n",t+='|:"G"GAG GAB|"D"ABA ABd|"G"edd gdd|"C"edB "D"dBA|\n',t+='"G"GAG GAB|"D"ABA ABd|"G"edd gdB|"D"AGF "G"G3:|\n',t+='|:"G"BAB dBd|"C"ege "D"dBA|"G"BAB dBG|"D"ABA AGA|\n',ProcessAddTune(t+='"G"BAB dBd|"C"ege "G"dBd|"C"gfg "D"aga|"G"bgf g3:|\n')}function AppendSampleHornpipe(){sendGoogleAnalytics("action","AppendSampleHornpipe");var t="";CountTunes()>0&&(t+="\n"),t+="X: 1\n",t+="T: Alexander's\n",t+="C: Traditional\n",t+="R: Hornpipe\n",t+="M: 4/4\n",t+="L: 1/8\n",t+="Q: 1/2=80\n",t+="K: Dmaj\n",t+="%abcjs_soundfont fluid\n",t+="%\n",t+="% Use an Acoustic Grand Piano sound for the melody:\n",t+="%%MIDI program 0\n",t+="%\n",t+="% Use an Acoustic Grand Piano for the chords:\n",t+="%%MIDI chordprog 0\n",t+="%\n",t+="% Use an Synth Bass sound for the bass:\n",t+="%%MIDI bassprog 38\n",t+="%\n",t+="% Set a specific amount of swing:\n",t+="%swing 0.25\n",t+="%\n",t+='|:(3gfe|"D"dAFA DFAd|fdcd Adef|"G"g2 ge "D"fdcd|"A"(3efe (3dcB A2 (3gfe|\n',t+='"D"dAFA DFAd|fdcd Adef|"G"g2 ge "D"fdcd|"A"(3efe dc"D"d2:|\n',t+='|:AG|"D"FAdA FAdA|"G"GBdB GBdB|"A"Acec Acec|"D"dfaf "A"(3gfe (3dAG|\n',ProcessAddTune(t+='"D"FAdA FAdA|"G"GBdB GBdB|"A"Acef gecd|(3efe dc"D"d2:|\n')}function AppendTuneTempate(){sendGoogleAnalytics("action","AppendTuneTemplate");var t="";CountTunes()>0&&(t+="\n"),t+="X: 1\n",t+="T: Tune Title\n",t+="C: Composer\n",t+="R: Tune style (Reel, Jig, Hornpipe, etc.)\n",t+="%\n",t+="% Meter:\n",t+="M: 4/4\n",t+="%\n",t+="% Beat unit:\n",t+="L: 1/8\n",t+="%\n",t+="% Tempo:\n",t+="Q: 120\n",t+="%\n",t+="% Key:\n",t+="K: C\n",t+="%\n",t+="% Soundfont\n",t+="% fluid, fluidhq, musyng, fatboy, canvas, mscore, arachno:\n",t+="%abcjs_soundfont fluid\n",t+="%\n",t+="% Use an Acoustic Grand Piano sound for the melody:\n",t+="%%MIDI program 0\n",t+="%\n",t+="% Use an Acoustic Grand Piano for the chords:\n",t+="%%MIDI chordprog 0\n",t+="%\n",t+="% Use an Synth Bass sound for the bass:\n",t+="%%MIDI bassprog 38\n",t+="%\n",t+="% Add your tune's ABC below:\n",ProcessAddTune(t+='"C"C2 D2 E2 F2| G2 A2 B2 c2|]\n')}function AppendSongTemplate(){sendGoogleAnalytics("action","AppendSongTemplate");var t="";CountTunes()>0&&(t+="\n"),t+="% Stripped-down self-documenting song in ABC, by Linda Eskin\n",t+="% Replace the WORDS IN UPPER-CASE with your own information.\n",t+="% You can remove all these comments with single % signs.\n",t+="%\n",t+="X: 1\n",t+="%\n",t+="% *** THIS HEADER CONVEYS INFORMATION ABOUT THE SONG ***\n",t+="%\n",t+="% These text elements appear above the music:\n",t+="T: TITLE OF THE SONG\n",t+="T: ALTERNATE TITLE\n",t+="C: COMPOSER/SONGWRITER\n",t+="O: ORIGIN/GEOGRAPHIC\n",t+="%%text GENERAL PURPOSE TEXT\n",t+="%\n",t+="% These appear below the music and lyrics:\n",t+="S: SOURCE OF THE SONG\n",t+="D: DISCOGRAPHY - CD, LP, ETC.\n",t+="N: NOTES (TEXT)\n",t+="Z: TRANSCRIBER, COPYRIGHT, PERMISSIONS\n",t+="H: HISTORY OF THE SONG\n",t+="H: This self-documenting ABC song template was created by Linda Eskin.\n",t+="%\n",t+="% This appears in your ABC file only, for reference.\n",t+="F: FILE URL - WHERE TO FIND THIS ONLINE\n",t+="%\n",t+="% These appear above the music AND control how it is played:\n",t+="R: RHYTHM, E.G. JIG, WALTZ\n",t+="M: 4/4\n",t+="L: 1/4\n",t+="Q: 1/4=120\n",t+="K: C\n",t+="% The K (key) tag should be the last thing in the header.\n",t+="%\n",t+="% *** THE SONG ITSELF STARTS HERE - REPLACE THIS WITH YOUR SONG ***\n",t+="%\n",t+="P: PART - VERSE, CHORUS, ETC.\n",t+='"C"C D2 E|"F"F G3|"Am"A B2 c|"E7"d e3|\n',t+="w: The words to the act-u-al tune go here\n",t+="w: You can put more ver-ses here is you like\n",t+="%\n",t+='"C"C D2 E|"F"F G3|"Am"A B2 c|"E7"d e3|]\n',t+="w: This tune is a scale. See how the notes work!\n",t+="w: This line is for the se-cond verse. Ta-da!\n",t+="%\n",t+="% *** YOU CAN PUT MORE LYRICS AFTER THE TUNE, TOO. ***\n",t+="%\n",t+="W: Write your extra verses here, verses here, verses here.\n",t+="W: Write your extra verses here, or the whole song if you like.\n",t+="W:\n",t+="W: --- This is where the chorus goes, chorus goes, chorus goes.\n",t+="W: --- Indent it with dashes if you like, but spaces will not work.\n",t+="W:\n",t+="W: Here we have another verse, another verse, another verse.\n",t+="W: Now we have reached the end - this is the last verse of this song.\n",t+="%\n",ProcessAddTune(t+="% That should get you started. Go play!\n")}function AppendSampleSong(){sendGoogleAnalytics("action","AppendSampleSong");var t="";CountTunes()>0&&(t+="\n"),t+="% A simple, self-documenting song in ABC, by Linda Eskin\n",t+="%\n",t+="% ABC is a plain-text format for conveying musical information.\n",t+="% Use this as an example to learn how ABC is written.\n",t+="% You can use it as a template to create your own ABC song.\n",t+="% Examples are in UPPER-CASE so you can see and replace them easily.\n",t+="%\n",t+="% Comments (like this one) start with a single percent symbol.\n",t+="%\n",t+="X: 1 \n",t+="% Each tune must start with an X: tag, and a number.\n",t+="%\n",t+="% *** THIS IS THE HEADER - INFO ABOUT THE TUNE/SONG ***\n",t+="%\n",t+="% These text elements appear above the music:\n",t+="%\n",t+="T: TITLE OF THE SONG\n",t+="T: ALTERNATE TITLE\n",t+="%\n",t+="C: COMPOSER\n",t+='% Songwriter, source, "Traditional", "Child Ballad," etc.\n',t+="%\n",t+="O: ORIGIN\n",t+="% Where is the tune from? Country, culture, ...\n",t+="%\n",t+="%%text GENERAL PURPOSE TEXT\n",t+="% There are many more options that use the double percentage symbols.\n",t+="% Note that lines starting with %% are *not* comments.\n",t+="%\n",t+="% These text elements appear below the music and lyrics:\n",t+="%\n",t+="% For S:, D:, H:, N:, and Z: the first line with the tag adds a label.\n",t+="% Additional lines with the same tag do not.\n",t+="%\n",t+="% S:, D:, H:, N:, and Z: lines do not word wrap.\n",t+="% Add more lines if you have more than will fit across the page.\n",t+="%\n",t+="S: SOURCE\n",t+='% "Learned from Morgan at Folk Festival," "Child Ballad," etc.\n',t+="%\n",t+="D: DISCOGRAPHY\n",t+="% On which CD/LP? Appears at the bottom of the page.\n",t+="%\n",t+="N: THESE NOTES APPEAR NEAR THE BOTTOM OF THE PAGE.\n",t+="%\n",t+="Z: TRANSCRIBER, COPYRIGHT, PERMISSIONS.\n",t+="% Transcriber info appears at the bottom, right below the Notes.\n",t+="%\n",t+="H: HISTORY OF THE SONG\n",t+="H: This self-documenting ABC example song was created by Linda Eskin.\n",t+="% Real-life event? Written for a movie? Appears at the bottom of the page.\n",t+="%\n",t+="F: FILE URL\n",t+="% If you want people to find your file online, put the URL here.\n",t+="%\n",t+="% These appear above the music AND control how it is played:\n",t+="%\n",t+="R: RHYTHM\n",t+="% Reel, Waltz, Jig, Hornpipe, etc.\n",t+="%\n",t+="M: 4/4\n",t+="% Meter, such as 3/4, 4/4, 9/8. Appears in the key signature.\n",t+="%\n",t+="L: 1/4\n",t+="% Length of base note unit. Here a 1/4 note = 1.\n",t+="% Use multiplier numbers to get longer notes: C2, a3, F4\n",t+="%\n",t+="Q: 1/4=120\n",t+="% Tempo. e.g. 120 beats per minute (BPM). (Mnemonic: Q=Quickness.)\n",t+="%\n",t+="%%staffsep 80\n",t+="% Sets the spacing between the staffs. Bigger numbers = more space.\n",t+="%\n",t+="K: C\n",t+="% Key signature - G, D, Edor, Amix, etc.\n",t+="% The K (key) tag should be the last thing in the header.\n",t+="%\n",t+="% *** THE TUNE ITSELF STARTS HERE ***\n",t+="%\n",t+="P: PART GOES HERE\n",t+="% Intro, Verse, Chorus, Refrain, etc.\n",t+="%\n",t+="% This is the actual music and words.\n",t+="% ABC apps *play* the music you write. Don't just make stuff up!\n",t+="% Follow the ABC standard so your tune and chords play correctly:\n",t+="% http://abcnotation.com/wiki/abc:standard:v2.1\n",t+="%\n",t+='"C"C D2 E|"F"F G3|"Am"A B2 c|"E7"d e3|\n',t+="w: The words to the act-u-al tune go here\n",t+="w: You can put more ver-ses here is you like\n",t+="%\n",t+='"C"C D2 E|"F"F G3|"Am"A B2 c|"E7"d e3|]\n',t+="w: This tune is a scale. See how the notes work!\n",t+="w: This line is for the se-cond verse. Ta-da!\n",t+="%\n",t+="% Chord names, in quotes, appear above the black-dots notation.\n",t+="%\n",t+="% The other letters are the notes. Lower-case for higher octave.\n",t+='% The base unit note length ("L", above) is assumed to equal 1.\n',t+="% For longer notes use a multiplier: G3, e2, C4 etc.\n",t+="%\n",t+='% w (lower-case "w") = words, or inline lyrics - the lyrics that appear right in the sheet music, below the black-dots notation.\n',t+="%\n",t+="% *** YOU CAN PUT MORE LYRICS AFTER THE TUNE, TOO. ***\n",t+="%\n",t+="% W = Words. More lyrics, if you want them.\n",t+='% Note upper-case "W:" used below:\n',t+="%\n",t+="W: Write your extra verses here, verses here, verses here.\n",t+="W: Write your extra verses here, or the whole song if you like.\n",t+="W:\n",t+='% You can leave a "W" line blank, to leave some space.\n',t+="W: --- This is where the chorus goes, chorus goes, chorus goes.\n",t+="W: --- Indent it with dashes if you like, but spaces won't work.\n",t+="W:\n",t+="W: Here we have another verse, another verse, another verse.\n",t+="W: Now we have reached the end - this is the last verse of this song.\n",t+="%\n",ProcessAddTune(t+="% That should get you started. Go play!\n")}function AppendDatabaseTemplate(){sendGoogleAnalytics("action","AppendDatabaseTemplate");var t="";CountTunes()>0&&(t+="\n"),t+="X:1\n",t+="T: Single Soundfont Instrument Notes + Reverb Setting Database Loader\n",t+="M: 4/4\n",t+="L: 1/8\n",t+="K: C\n",t+="Q: 1/4=400\n",t+="%\n",t+="% 1) Select the soundfont:\n",t+="%\n",t+="% Available soundfonts are:\n",t+="% fluid, musyng, fatboy, canvas, mscore, arachno, and fluidhq\n",t+="%\n",t+="%abcjs_soundfont fluid\n",t+="%\n",t+="% 2) Select the MIDI instrument program you want to use\n",t+="% in the soundfont and have all the notes stored in the database:\n",t+="%\n",t+="% Example: Acoustic Grand Piano\n",t+="%%MIDI program 0\n",t+="%\n",t+="% 3) Select the reverb environment you want to have stored in the database\n",t+="%\n",t+="% Available reverb environments are:\n",t+="% off, room1, room2, room3, chamber1, chamber2, chamber3,\n",t+="% hall1, hall2, hall3, church1,\n",t+="% room (same as room3), chamber (same as chamber2),\n",t+="% hall (same as hall2), and church (same as church1)\n",t+="%\n",t+="% chamber is the default reverb, so probably already stored:\n",t+="%\n",t+="%reverb chamber 0.9 0.1\n",t+="%\n",t+='% 4) While online, click "Play" to load the ABC into the player.\n',t+="%\n",t+="% You do not need to actually play the tune, just loading the template\n",t+="% into the player is enough to save the notes and reverb setting in\n",t+="% the instrument notes and reverb database.\n",t+="%\n",t+="[|C,,,4 ^C,,,4 D,,,4 ^D,,,4 E,,,4 F,,,4 ^F,,,4 G,,,4 ^G,,,4 A,,,4 ^A,,,4 B,,,4 |\n",t+="C,,4 ^C,,4 D,,4 ^D,,4 E,,4 F,,4 ^F,,4 G,,4 ^G,,4 A,,4 ^A,,4 B,,4 |\n",t+="C,4 ^C,4 D,4, ^D,4 E,4 F,4 ^F,4 G,4 ^G,4 A,4 ^A,4 B,4 |\n",t+="C4 ^C4 D4 ^D4 E4 F4 ^F4 G4 ^G4 A4 ^A4 B4 |\n",t+="c4 ^c4 d4 ^d4 e4 f4 ^f4 g4 ^g4 a4 ^a4 b4 |\n",t+="c'4 ^c'4 d'4 ^d'4 e'4 f'4 ^f'4 g'4 ^g'4 a'4 ^a'4 b'4|\n",t+="c''4 ^c''4 d''4 ^d''4 e''4 f''4 ^f''4 g''4 ^g''4 a''4 ^a''4 b''4|]\n\n",t+="X: 2\n",t+="T: All Soundfont Instruments Notes Database Primer Loader\n",t+="M: 4/4\n",t+="L: 1/8\n",t+="K: C\n",t+="Q: 400\n",t+="%\n",t+="% Loads one note for each MIDI instrument in an entire soundfont\n",t+="% into the instrument notes database to allow you to easily\n",t+="% load the rest of the notes for all the instruments.\n",t+="%\n",t+="% 1) Select the soundfont you want to load:\n",t+="%\n",t+="% Available soundfonts are:\n",t+="% fluid, musyng, fatboy, canvas, mscore, arachno, and fluidhq\n",t+="%\n",t+="%abcjs_soundfont fluid\n",t+="%\n",t+='% 2) While online, click "Play" to load the ABC into the player.\n',t+="%\n",t+="% You don't need to actually play the file, just loading the template\n",t+="% into the player is enough to create single note placeholder\n",t+="% entries in the instrument notes database.\n",t+="%\n",t+="% 3) Once the player load is complete, you can close the player.\n",t+="%\n",t+='% 4) Open "Settings"/"Manage Notes, Reverb, and Tune Search Databases"\n',t+="%\n",t+='% 5) Click "Instrument Notes Database"\n',t+="%\n",t+='% 6) Click "Load All Notes for All Instruments"\n',t+="%\n",t+="% 7) The tool will download all the notes for all the instruments.\n",t+="%\n",t+="% This is a very aggressive use of the database loader feature.\n",t+="%\n",t+="% While I do not expect there to be any issues, use at your own risk.\n",t+="%\n",t+='[I:MIDI= program 0] "_0" G4 |[I:MIDI= program 1] "_1" G4 |[I:MIDI= program 2] "_2" G4 |[I:MIDI= program 3] "_3" G4 |[I:MIDI= program 4] "_4" G4 |[I:MIDI= program 5] "_5" G4 |[I:MIDI= program 6] "_6" G4 |[I:MIDI= program 7] "_7" G4 |\n',t+='[I:MIDI= program 8] "_8" G4 |[I:MIDI= program 9] "_9" G4 |[I:MIDI= program 10] "_10" G4 |[I:MIDI= program 11] "_11" G4 |[I:MIDI= program 12] "_12" G4 |[I:MIDI= program 13] "_13" G4 |[I:MIDI= program 14] "_14" G4 |[I:MIDI= program 15] "_15" G4 |\n',t+='[I:MIDI= program 16] "_16" G4 |[I:MIDI= program 17] "_17" G4 |[I:MIDI= program 18] "_18" G4 |[I:MIDI= program 19] "_19" G4 |[I:MIDI= program 20] "_20" G4 |[I:MIDI= program 21] "_21" G4 |[I:MIDI= program 22] "_22" G4 |[I:MIDI= program 23] "_23" G4 |\n',t+='[I:MIDI= program 24] "_24" G4 |[I:MIDI= program 25] "_25" G4 |[I:MIDI= program 26] "_26" G4 |[I:MIDI= program 27] "_27" G4 |[I:MIDI= program 28] "_28" G4 |[I:MIDI= program 29] "_29" G4 |[I:MIDI= program 30] "_30" G4 |[I:MIDI= program 31] "_31" G4 |\n',t+='[I:MIDI= program 32] "_32" G4 |[I:MIDI= program 33] "_33" G4 |[I:MIDI= program 34] "_34" G4 |[I:MIDI= program 35] "_35" G4 |[I:MIDI= program 36] "_36" G4 |[I:MIDI= program 37] "_37" G4 |[I:MIDI= program 38] "_38" G4 |[I:MIDI= program 39] "_39" G4 |\n',t+='[I:MIDI= program 40] "_40" G4 |[I:MIDI= program 41] "_41" G4 |[I:MIDI= program 42] "_42" G4 |[I:MIDI= program 43] "_43" G4 |[I:MIDI= program 44] "_44" G4 |[I:MIDI= program 45] "_45" G4 |[I:MIDI= program 46] "_46" G4 |[I:MIDI= program 47] "_47" G4 |\n',t+='[I:MIDI= program 48] "_48" G4 |[I:MIDI= program 49] "_49" G4 |[I:MIDI= program 50] "_50" G4 |[I:MIDI= program 51] "_51" G4 |[I:MIDI= program 52] "_52" G4 |[I:MIDI= program 53] "_53" G4 |[I:MIDI= program 54] "_54" G4 |[I:MIDI= program 55] "_55" G4 |\n',t+='[I:MIDI= program 56] "_56" G4 |[I:MIDI= program 57] "_57" G4 |[I:MIDI= program 58] "_58" G4 |[I:MIDI= program 59] "_59" G4 |[I:MIDI= program 60] "_60" G4 |[I:MIDI= program 61] "_61" G4 |[I:MIDI= program 62] "_62" G4 |[I:MIDI= program 63] "_63" G4 |\n',t+='[I:MIDI= program 64] "_64" G4 |[I:MIDI= program 65] "_65" G4 |[I:MIDI= program 66] "_66" G4 |[I:MIDI= program 67] "_67" G4 |[I:MIDI= program 68] "_68" G4 |[I:MIDI= program 69] "_69" G4 |[I:MIDI= program 70] "_70" G4 |[I:MIDI= program 71] "_71" G4 |\n',t+='[I:MIDI= program 72] "_72" G4 |[I:MIDI= program 73] "_73" G4 |[I:MIDI= program 74] "_74" G4 |[I:MIDI= program 75] "_75" G4 |[I:MIDI= program 76] "_76" G4 |[I:MIDI= program 77] "_77" G4 |[I:MIDI= program 78] "_78" G4 |[I:MIDI= program 79] "_79" G4 |\n',t+='[I:MIDI= program 80] "_80" G4 |[I:MIDI= program 81] "_81" G4 |[I:MIDI= program 82] "_82" G4 |[I:MIDI= program 83] "_83" G4 |[I:MIDI= program 84] "_84" G4 |[I:MIDI= program 85] "_85" G4 |[I:MIDI= program 86] "_86" G4 |[I:MIDI= program 87] "_87" G4 |\n',t+='[I:MIDI= program 88] "_88" G4 |[I:MIDI= program 89] "_89" G4 |[I:MIDI= program 90] "_90" G4 |[I:MIDI= program 91] "_91" G4 |[I:MIDI= program 92] "_92" G4 |[I:MIDI= program 93] "_93" G4 |[I:MIDI= program 94] "_94" G4 |[I:MIDI= program 95] "_95" G4 |\n',t+='[I:MIDI= program 96] "_96" G4 |[I:MIDI= program 97] "_97" G4 |[I:MIDI= program 98] "_98" G4 |[I:MIDI= program 99] "_99" G4 |[I:MIDI= program 100] "_100" G4 |[I:MIDI= program 101] "_101" G4 |[I:MIDI= program 102] "_102" G4 |[I:MIDI= program 103] "_103" G4 |\n',t+='[I:MIDI= program 104] "_104" G4 |[I:MIDI= program 105] "_105" G4 |[I:MIDI= program 106] "_106" G4 |[I:MIDI= program 107] "_107" G4 |[I:MIDI= program 108] "_108" G4 |[I:MIDI= program 109] "_109" G4 |[I:MIDI= program 110] "_110" G4 |[I:MIDI= program 111] "_111" G4 |\n',t+='[I:MIDI= program 112] "_112" G4 |[I:MIDI= program 113] "_113" G4 |[I:MIDI= program 114] "_114" G4 |[I:MIDI= program 115] "_115" G4 |[I:MIDI= program 116] "_116" G4 |[I:MIDI= program 117] "_117" G4 |[I:MIDI= program 118] "_118" G4 |[I:MIDI= program 119] "_119" G4 |\n',t+='[I:MIDI= program 120] "_120" G4 |[I:MIDI= program 121] "_121" G4 |[I:MIDI= program 122] "_122" G4 |[I:MIDI= program 123] "_123" G4 |[I:MIDI= program 124] "_124" G4 |[I:MIDI= program 125] "_125" G4 |[I:MIDI= program 126] "_126" G4 |[I:MIDI= program 127] "_127" G4 |\n',t+='[I:MIDI= program 128] "_128" G4 |[I:MIDI= program 129] "_129" G4 |[I:MIDI= program 130] "_130" G4 |[I:MIDI= program 131] "_131" G4 |[I:MIDI= program 132] "_132" G4 |[I:MIDI= program 133] "_133" G4 |[I:MIDI= program 134] "_134" G4 |[I:MIDI= program 135] "_135" G4 |\n',ProcessAddTune(t+='[I:MIDI= program 136] "_136" G4 |[I:MIDI= program 137] "_137" G4 |[I:MIDI= program 138] "_138" G4 |[I:MIDI= program 139] "_139" G4 |[I:MIDI= program 140] "_140" G4 |[I:MIDI= program 141] "_141" G4 |[I:MIDI= program 142] "_142" G4 |[I:MIDI= program 143] "_143" G4 |[I:MIDI= program 144] "_144" G4 |]\n')}function AppendJSBach(){sendGoogleAnalytics("action","AppendJSBach");var t="";CountTunes()>0&&(t+="\n"),t+="X:1\n",t+="%\n",t+="% Example J.S. Bach transcription originally imported from MusicXML\n",t+="%\n",t+='% Click "Play" to play\n',t+="%\n",t+="T:Two-Part Invention #1\n",t+="C:J.S. Bach\n",t+="L:1/16\n",t+="Q:1/4=84\n",t+="M:4/4\n",t+="K:C\n",t+="%\n",t+="% Try changing the abcjs_soundfont value to\n",t+="% fluid, fluidhq, musyng, fatboy, canvas, mscore, or arachno:\n",t+="%\n",t+="%abcjs_soundfont fluid\n",t+="%\n",t+="%%staffsep 40\n",t+="%%stretchlast true\n",t+="%\n",t+="% Try changing these to %%MIDI program mute\n",t+="% to isolate individual voices:\n",t+="%\n",t+="V:1 treble\n",t+="%%MIDI program 6\n",t+="V:2 bass\n",t+="%%MIDI program 6\n",t+="V:1\n",t+="[Q:84]\n",t+="z CDE FDEC G2c2 B/A/Bc2 | dGAB cABG d2g2 f/e/fg2 |\n",t+="eagf egfa gfed cedf | edcB AcBd cBAG ^FAGB |\n",t+="A2D2 c/B/c2d BAG^F EGFA | GBAc Bdce dB/c/dg B/c/BAG |\n",t+=".G4 z4 z GAB cABG | .^F4 z4 z ABc dBcA |\n",t+=".B4 z4 z dcB AcBd | .c4 z4 z edc Bd^ce |\n",t+="d2^c2d2e2 f2A2B2c2 | d2^F2^G2A2 B2c2 d4 |\n",t+="z E^F^G AFGE edce dcBd | ca^gb aefd ^Gfed c/d/cBA |\n",t+="Aagf egfa g8- | gefg afge f8 |\n",t+="z gfe dfeg f8- | fdef gefd e8- |\n",t+="ecde fdec defg afge | fgab c'abg [Q:78]c'2g2 [Q:70]e/f/edc|\n",t+="c_BAG [Q:62]FAGB [Q:54]A=BcE [Q:46]Dc[Q:28]FB | [EGc]16|]\n",t+="V:2\n",t+="[Q:84]\n",t+="z8 z C,D,E, F,D,E,C, | G,2G,,2 z4 z G,A,B, CA,B,G, |\n",t+="C2B,2C2D2 E2G,2A,2B,2 | C2E,2^F,2G,2 A,2B,2 C4- |\n",t+="CD,E,^F, G,E,F,D, G,2B,,2C,2D,2 | E,2^F,2G,2E,2 B,,2>C,2 D,2D,,2 |\n",t+="z G,,A,,B,, C,A,,B,,G,, D,2G,2^F,2G,2 | A,D,E,^F, G,E,F,D, A,2D2C2D2 |\n",t+="G,GFE DFEG F2E2F2D2 | EAGF EGFA G2F2G2E2 |\n",t+="F_BAG FAGB AGFE DFEG | FEDC B,DCE DCB,A, ^G,B,A,C |\n",t+="B,2E,2D/C/.D3 CB,A,G, ^F,A,^G,B, | A,CB,D CEDF E2A,2E2E,2 |\n",t+="A,2A,,2 z4 z EDC B,D^CE | D8- DA,B,C DB,CA, |\n",t+="B,8- B,DCB, A,CB,D | C8- CG,A,_B, CA,B,G, |\n",t+="A,2_B,2A,2G,2 F,2D2C2B,2 | A,2F2E2D2 ED,E,F, G,E,F,D, |\n",ProcessAddTune(t+="E,2C,2D,2E,2 F,D,E,F, [Q:46]G,2[Q:28]G,,2 | [C,,C,]16 |]\n")}function AppendJSBach2(){sendGoogleAnalytics("action","AppendJSBach2");var t="";CountTunes()>0&&(t+="\n"),t+="X:1\n",t+="%\n",t+="% Example J.S. Bach transcription originally imported from MusicXML\n",t+="%\n",t+='% Click "Play" to play\n',t+="%\n",t+="T:Fantasia\n",t+="T:BWV570\n",t+="T:Johann Sebastian Bach (1685-1750)\n",t+="%%score { 1 | 2 | 3 | 4 }\n",t+="L:1/16\n",t+="M:4/4\n",t+="K:C\n",t+="%\n",t+="% Try changing the abcjs_soundfont value to\n",t+="% fluid, fluidhq, musyng, fatboy, canvas, mscore, or arachno:\n",t+="%\n",t+="%abcjs_soundfont fluid\n",t+="%\n",t+="%%stretchlast true\n",t+="%%staffsep 40\n",t+="Q:100\n",t+="%\n",t+="% Try changing these to %%MIDI program mute\n",t+="% to isolate individual voices:\n",t+="%\n",t+="V:1 treble\n",t+="%%MIDI program 19\n",t+="V:2 treble\n",t+="%%MIDI program 19\n",t+="V:3 bass\n",t+="%%MIDI program 19\n",t+="V:4 bass\n",t+="%%MIDI program 19\n",t+="V:1\n",t+="G4 c6 d2 B4 | e6 f2 d6 e2 | c8- c2e2d2c2 | B2A2 B4 z2 e2g2e2 |\n",t+="c2e2G2c2 A2c2d2e2 | f2e2d2c2 B2G2 c4- | c2dcB2cB A8- | A2Bc d6 efB2cd |\n",t+="^G6 AB A2Bcd2cd | B6 cB A6 B^G | c8- c2dc_B2cA | _B8- B2>G2A2GA |\n",t+="F6 EF G2A_B A4- | A2Bc d6 Bcd2ef | e8- e2dc d4- | d2ef e6 fg f4- |\n",t+="f2ga g6 ag f4- | f2gf e6 fe d4 | d8d8- | d2cB c6 dc B4 |\n",t+="c4 z12 | z4 d8 c4- | c8 B4 _B4 | A4 B4 G8 |\n",t+="A4 c4 B8 | c8c8 | f8 e8- | e6e6 d4- |\n",t+="d4 d2ef g2agf2gf | e4 g6 ag f4- | f2gfe2fe d8 | g2agf2gf e6 fe |\n",t+="d6 ed c6 dc | B4 c4 d4 e4- | e2fe d6 ef e4- | e2fe d6 efg2ab |\n",t+="c2Bcd2ef B4 c4- | cdBd cdBd cedf egfa | gGAB c4- cede fdef | B2cd2<c2B c8- |\n",t+="c8c8 | c16 |]\n",t+="V:2\n",t+="G8G8- | G2G2 c6 c2 B4- | B2B2 A6A6- | A4 G4 z8 |\n",t+="z16 | z16 | z4 G4 E8 | F8F8- |\n",t+="F2ED C4 E8- | E8E8- | E8 D8- | D2E^F G6 E2- E4- |\n",t+="E2D^C D4 E6 ^FG | ^F6 EF G8- | G2AB c4 A6 Bc | B6 cd c6 de |\n",t+="d6 ef e6 dc | d6 cB c6 BA | B8B8 | G6 FE F6 ED |\n",t+="E6 FG A6 Bc | B8- B6 A^G | A8 G8 | F8 E6 FE |\n",t+="D6 ED D4 G4 | G4 A6A6 | d8- d2cB c4- | c2dc c6 dc c4- |\n",t+="c2BA B6 c4 B2 | c4 d4 c6 dc | B4 c6 BA B4 | c4 B6 cB A4- |\n",t+="A2BA G6 AG ^F4 | G8 B4 c4- | c6 BA B6 cd | c6 BA B8 |\n",t+="A8 G8- | G8G8- | G8G8- | G6G6 F4 |\n",t+="G4 F6 GF EFDF | E16 |]\n",t+="V:3\n",t+="E8 D8- | D4 C4 D4 G4 | E8 D8- | D8 C8- |\n",t+="C8 C8 | D6D6 E2FE | D8 ^C8 | D4 A,2B,C B,8- |\n",t+="B,4 A,8 ^G,4- | G,2A,B, C6 B,A, B,4- | B,2A,^G,A,2E,=G, ^F,8 | G,6 A,_B,- B,4 A,4- |\n",t+="A,8 _B,4 E,4 | A,8 G,8- | G,6 E,C, ^F,6 D,2 | G,8G,8- |\n",t+="G,8G,8- | G,8G,8- | G,2G,A,B,2CD G,2A,B,D,2E,F, | E,4 A,4 D,4 G,4- |\n",t+="G,2A,B, C6 DE F4- | F8 E8- | E4 D8 C4- | C4 D6 CB, C4- |\n",t+="C2B,C A,4 B,4 E4- | E8 F8- | F4 G6G6 | A8A8 |\n",t+="G4 G2F2 E4 D4 | C2DCB,2CB, A,4 D4- | D4 E2C2 G6 FG | E2FED2ED C6 DC |\n",t+="B,6 CB, A,2B,2 C4 | D4 E4 G8 | A4 D4 G8- | G8G8 |\n",t+="E4 D8 E4- | E2D2E2D2 E2B,2C2D2 | E4- EEDC D8- | D4 F4 E4 C4|\n",t+="z2 C_B,A,2G,F, G,6 F,2 | G,16 |]\n",t+="V:4\n",t+="C,2D,2E,2C,2 G,8- | G,8G,8 | A,6 G,2 ^F,8 | G,6 F,2 E,8- |\n",t+="E,8 F,8- | F,4 ^F,4 G,8- | G,8- G,2A,_B,A,2G,A, | F,8 D,8 |\n",t+="E,8E,8- | E,8E,8 | A,,8 D,8- | D,8 ^C,8 |\n",t+="D,6D,6 ^C,4 | C,8 B,,8 | C,8 ^F,,8 | G,,8G,,8- |\n",t+="G,,8G,,8- | G,,8G,,8- | G,,4 z12 | z16 |\n",t+="C,6 D,E, F,6 G,A, | D,2E,F,B,,2C,D, ^G,,2E,,2 A,,4- | A,,2A,G,^F,2E,D, G,2D,=F,E,2D,C, | F,2C,E,D,2C,B,, E,8 |\n",t+="F,4 ^F,4 G,2G,=F,E,2E,D, | C,2C,B,,A,,2A,,G,, F,,2A,,G,,F,,2F,,E,, | D,,2D,C,B,,2A,,G,, C,6 D,E, | A,,6 B,,C, F,,4 ^F,,2E,,F,, |\n",t+="G,,4 z8 x4 | z16 | G,8G,8- | G,8G,8- |\n",t+="G,8G,8- | G,2G,F,E,2D,C, B,,2A,,G,,F,,2E,,D,, | F,,4 F,4 G,8- | G,8G,8- |\n",t+="G,4 F,6 G,F,E,2D,C, | G,8G,8- | G,8G,8- | G,8 C,2C_B,A,2G,F, |\n",ProcessAddTune(t+="E,4 F,4 C,8 | C,16 |]\n")}function ProcessAddTune(t){gTheABC.value.length,gTheABC.value=gTheABC.value+t,gIsDirty=!0,"No ABC file selected"!=gDisplayedName&&-1==gDisplayedName.indexOf("+ added tunes")&&(gDisplayedName+=" + added tunes"),RenderAsync(!0,null,function(){UpdateNotationTopPosition();var t=CountTunes();isMobileBrowser()&&(gCurrentTune=t-1);var n=getTuneByIndex(t-1),o=gTheABC.value.length-n.length;if(!gIsMaximized){if(ScrollABCTextIntoView(gTheABC,o,o,10),isMobileBrowser())return;gTheABC.blur(),gTheABC.focus()}MakeTuneVisible(!0)})}function ScrollABCTextIntoView(t,n,o,a){let r=t.value;t.value=r.substring(0,o);let l=t.scrollHeight;t.value=r;let s=l,g=t.clientHeight;s>g?s-=g/a:s=0,t.scrollTop=s,t.setSelectionRange(n,o)}function RenderDivClickHandler(t){if(!gRenderingPDF&&!gDisableNotationRendering){var n=this.id;if(n&&""!=n&&0==n.indexOf("notation")){var o=this.id.replace("notation","");if(""!=o){var a=parseInt(o);if(a==gLastClickedTune)return;gLastClickedTune=a;var r=findTuneOffsetByIndex(a);if(gIsMaximized)gGotRenderDivClick=!0,gRenderDivClickOffset=r;else{if(ScrollABCTextIntoView(gTheABC,r,r,10),isMobileBrowser())return;gTheABC.blur(),gTheABC.focus()}}}}}function GenerateRenderingDivs(t){if(!gDisableNotationRendering){var n=gTheNotation;n.innerHTML="";for(var o=0;o<t;++o){var a=document.createElement("div");a.id="notation"+o,a.classList.add("tunespacer"),a.classList.add("pagebreak"),isDesktopBrowser()&&(a.onclick=RenderDivClickHandler),n.appendChild(a)}}}function getUrlWithoutParams(){return"https://michaeleskin.com/abctools/abctools.html"}function FillUrlBoxWithAbcInLZW(t,n){var o="";o=t||gTheABC.value;var a=LZString.compressToEncodedURIComponent(o),r=GetRadioValue("notenodertab"),l=gCapo,s=gStaffSpacing-STAFFSPACEOFFSET,g=getUrlWithoutParams()+"?lzw="+a+"&format="+r+"&ssp="+s,c="";switch(r){case"noten":case"notenames":case"whistle":break;case"mandolin":case"gdad":case"cgda":case"cgdae":case"dgdae":case"guitare":case"guitard":case"uke":c="&capo="+l,gShowTabNames?c+="&stn=true":c+="&stn=false"}if(g+=c,t)return g;var d=CountTunes(),u=getDescriptiveFileName(d,!1);if(g+="&name="+u,document.getElementById("qrcode").style.display="none",gAllowURLSave=!1,gAllowQRCodeSave=!1,g.length<8100&&(gAllowURLSave=!0,g.length<MAXQRCODEURLLENGTH&&(gAllowQRCodeSave=!0)),n){var p=document.getElementById("urltextbox");gAllowURLSave?(document.getElementById("testurl").classList.remove("urlcontrolsdisabled"),document.getElementById("testurl").classList.add("urlcontrols"),document.getElementById("saveurl").classList.remove("urlcontrolsdisabled"),document.getElementById("saveurl").classList.add("urlcontrols"),document.getElementById("copyurl").classList.remove("urlcontrolsdisabled"),document.getElementById("copyurl").classList.add("urlcontrols"),document.getElementById("shortenurl").classList.remove("urlcontrolsdisabled"),document.getElementById("shortenurl").classList.add("urlcontrols"),gAllowQRCodeSave?(document.getElementById("generateqrcode").classList.remove("urlcontrolsdisabled"),document.getElementById("generateqrcode").classList.add("urlcontrols")):(document.getElementById("generateqrcode").classList.remove("urlcontrols"),document.getElementById("generateqrcode").classList.add("urlcontrolsdisabled"))):(g=" *** The URL link would be too long to share. Please try sharing fewer tunes. ***",document.getElementById("generateqrcode").classList.remove("urlcontrols"),document.getElementById("generateqrcode").classList.add("urlcontrolsdisabled"),document.getElementById("shortenurl").classList.remove("urlcontrols"),document.getElementById("shortenurl").classList.add("urlcontrolsdisabled"),document.getElementById("testurl").classList.remove("urlcontrols"),document.getElementById("testurl").classList.add("urlcontrolsdisabled"),document.getElementById("copyurl").classList.remove("urlcontrols"),document.getElementById("copyurl").classList.add("urlcontrolsdisabled"),document.getElementById("saveurl").classList.remove("urlcontrols"),document.getElementById("saveurl").classList.add("urlcontrolsdisabled")),p.value=g}return g}function CreateURLfromHTML(){FillUrlBoxWithAbcInLZW(null,!0),(urltextbox=document.getElementById("urltextbox")).focus(),urltextbox.setSelectionRange(0,0),clearQRCode()}function clearQRCode(){gTheQRCode&&gTheQRCode.clear()}function GenerateQRCode(t){sendGoogleAnalytics("sharing","generate_qr_code");var n=!1,o=document.getElementById("urltextbox").value;if(t.shiftKey){if(o.length>MAXQRCODEURLLENGTH){DayPilot.Modal.alert('<p style="text-align:center;font-family:helvetica;font-size:14pt;">Share URL is too long to generate a QR Code</p>',{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});return}n=!0}else if(!gAllowQRCodeSave)return;null==gTheQRCode?gTheQRCode=new QRCode(document.getElementById("qrcode"),{text:o,width:548,height:548,colorDark:"#000000",colorLight:"#ffffff",border:16,correctLevel:QRCode.CorrectLevel.M}):(gTheQRCode.clear(),gTheQRCode.makeCode(o)),document.getElementById("qrcode").style.display="inline-block";var a="Custom QR Code",r="custom_qr_code";if((theQRCodeImage=document.querySelectorAll('div[id="qrcode"] > img'))&&theQRCodeImage.length>0){if(!n){a=GetAllTuneTitles();var l=GetRadioValue("notenodertab"),s="";switch(l){case"noten":s="<br/><br/>(Standard Notation)";break;case"notenames":s="<br/><br/>(Note Names Tab)";break;case"mandolin":s="<br/><br/>(Mandolin Tab",0!=gCapo&&(s+=" - Capo on "+gCapo),s+=")";break;case"gdad":s="<br/><br/>(Bouzouki GDAD Tab",0!=gCapo&&(s+=" - Capo on "+gCapo),s+=")";break;case"cgda":s="<br/><br/>(Mandola CGDA Tab",0!=gCapo&&(s+=" - Capo on "+gCapo),s+=")";break;case"cgdae":s="<br/><br/>(CGDAE Tab",0!=gCapo&&(s+=" - Capo on "+gCapo),s+=")";break;case"dgdae":s="<br/><br/>(DGDAE Tab",0!=gCapo&&(s+=" - Capo on "+gCapo),s+=")";break;case"guitare":s="<br/><br/>(Standard Guitar Tab",0!=gCapo&&(s+=" - Capo on "+gCapo),s+=")";break;case"guitard":s="<br/><br/>(DADGAD Guitar Tab",0!=gCapo&&(s+=" - Capo on "+gCapo),s+=")";break;case"uke":s="<br/><br/>(Ukulele Tab",0!=gCapo&&(s+=" - Capo on "+gCapo),s+=")";break;case"whistle":s="<br/><br/>(Whistle Tab)"}a+=s;var g=CountTunes();r=getDescriptiveFileName(g,!0)}theQRCodeImage=theQRCodeImage[0];var c=window.open("");setTimeout(function(){var t=theQRCodeImage.src,n=theQRCodeImage.outerHTML.replace("display: block;",""),o='<div style="text-align:center;padding:24px;margin-top:0px;margin-bottom:0px;">';o+=n,o+='<p style="font-family:times;font-size:15pt;margin-top:18px;margin-bottom:0px;">'+a+"</p>",o+='<p style="font-family:times;font-size:16pt;margin-top:32px;margin-bottom:0px;"><strong>Get Your QR Code</strong></p>',o+='<p style="font-family:times;font-size:16pt;margin-top:32px;margin-bottom:0px;"><a href="'+t+'" download="'+r+'.png" style="text-decoration:none;color:darkblue">Click here to download&nbsp;'+r+".png&nbsp;to your system.</a></p>",o+='<p style="font-family:times;font-size:16pt;margin-top:32px;margin-bottom:0px;"><strong>Use Your QR Code</strong></p>',o+='<p style="font-family:times;font-size:15pt;margin-top:30px;margin-bottom:0px;">Share QR Codes on social media or email them to friends like any other photo.</p>',o+='<p style="font-family:times;font-size:15pt;margin-top:24px;margin-bottom:0px;">Scanning the code with the Camera app on any iOS or Android phone will load the</p>',o+='<p style="font-family:times;font-size:15pt;margin-top:6px;margin-bottom:0px;">ABC Transcription Tool with your tune set into the browser on the device.</p>',o+="</div>",c.document.write(o),setTimeout(function(){c.document.title="ABC Tools Tune Sharing QR Code"},100)},1e3)}}function SaveABCAsMusicXML(t,n){if(!navigator.onLine){var o="Save as MusicXML not available while offline.";o=makeCenteredPromptString(o),DayPilot.Modal.alert(o,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});return}fetch("https://seisiuneer.pythonanywhere.com/abc2xml",{method:"POST",body:t}).then(t=>t.text()).then(t=>{var o=document.createElement("a");document.body.appendChild(o),o.style="display: none";var a=new Blob([t],{type:"text/plain"}),r=window.URL.createObjectURL(a);o.href=r,o.download=n,o.click(),document.body.removeChild(o),setTimeout(function(){window.URL.revokeObjectURL(r)},1e3),gDisplayedName=n,gABCFromFile=!0,document.getElementById("abc-selected").innerText=n,gIsDirty=!1}).catch(t=>{var n="There was an issue converting the ABC to MusicXML.";n=makeCenteredPromptString(n),DayPilot.Modal.alert(n,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})})}function saveABCFile(t,n,o){DayPilot.Modal.prompt(t,n,{theme:"modal_flat",top:200,autoFocus:!1,scrollWithPage:AllowDialogsToScroll()}).then(function(t){var n=t.result;if(null==n||0==(n=n.replace(/[^a-zA-Z0-9_\-. ]+/ig,"")).length)return null;if(n.endsWith(".xml")||n.endsWith(".XML")){sendGoogleAnalytics("export","SaveXML");var a=getTuneByIndex(0);SaveABCAsMusicXML(a,n);return}sendGoogleAnalytics("export","SaveABC"),isDesktopBrowser()?n.endsWith(".abc")||n.endsWith(".txt")||n.endsWith(".ABC")||n.endsWith(".TXT")||(n=n.replace(/\..+$/,""),n+=".abc"):(n=n.replace(/\..+$/,""),n+=".txt");var r=document.createElement("a");document.body.appendChild(r),r.style="display: none";var l=new Blob([o],{type:"text/plain"}),s=window.URL.createObjectURL(l);r.href=s,r.download=n,r.click(),document.body.removeChild(r),setTimeout(function(){window.URL.revokeObjectURL(s)},1e3),gDisplayedName=n,gABCFromFile=!0,document.getElementById("abc-selected").innerText=n,gIsDirty=!1})}function saveTextFile(t,n,o){DayPilot.Modal.prompt(t,n,{theme:"modal_flat",top:200,autoFocus:!1,scrollWithPage:AllowDialogsToScroll()}).then(function(t){var n=t.result;if(null==n||0==(n=n.replace(/[^a-zA-Z0-9_\-. ]+/ig,"")).length)return null;isDesktopBrowser()&&(n.endsWith(".txt")||n.endsWith(".TXT"))||(n=n.replace(/\..+$/,""),n+=".txt");var a=document.createElement("a");document.body.appendChild(a),a.style="display: none";var r=new Blob([o],{type:"text/plain"}),l=window.URL.createObjectURL(r);a.href=l,a.download=n,a.click(),document.body.removeChild(a),setTimeout(function(){window.URL.revokeObjectURL(l)},1e3)})}function saveTextFileDeveloper(t,n,o){DayPilot.Modal.prompt(t,n,{theme:"modal_flat",top:200,autoFocus:!1,scrollWithPage:AllowDialogsToScroll()}).then(function(t){var n=t.result;if(null==n||0==(n=n.replace(/[^a-zA-Z0-9_\-. ]+/ig,"")).length)return null;isDesktopBrowser()||(n=n.replace(/\..+$/,""),n+=".txt");var a=document.createElement("a");document.body.appendChild(a),a.style="display: none";var r=new Blob([o],{type:"text/plain"}),l=window.URL.createObjectURL(r);a.href=l,a.download=n,a.click(),document.body.removeChild(a),setTimeout(function(){window.URL.revokeObjectURL(l)},1e3)})}function CopyToClipboard(t){try{if(navigator.clipboard&&window.isSecureContext)return navigator.clipboard.writeText(t);{let n=document.createElement("textarea");return n.value=t,n.style.position="fixed",n.style.left="-999999px",n.style.top="-999999px",document.body.appendChild(n),n.focus(),n.select(),new Promise((t,o)=>{document.execCommand("copy")?t():o(),n.remove()})}}catch(o){console.log("CopyToClipboard error: "+o)}}function OverrideOneTuneMIDIParams(t,n,o,a,r,l,s){var g=t,c=gTheActiveSoundFont;m=/%abcjs_soundfont .+\s*/gm;var d=t.match(m);if(d&&d.length>0){var u="fluid";-1!=n.indexOf("FluidR3_GM")?u="fluid":-1!=n.indexOf("Musyng")?u="musyng":-1!=n.indexOf("fatboy")?u="fatboy":-1!=n.indexOf("canvas")?u="canvas":-1!=n.indexOf("mscore")?u="mscore":-1!=n.indexOf("arachno")?u="arachno":-1!=n.indexOf("fluidhq")&&(u="fluidhq");for(var p=0;p<d.length;++p)g=g.replace(d[p].trim(),"%abcjs_soundfont "+u),c!=n&&(gTheActiveSoundFont=n,gSoundsCacheABCJS={})}var m=/%%MIDI program \d+\s*/gm,h=t.match(m);if(h&&h.length>0)for(var p=0;p<h.length;++p)g=g.replace(h[p].trim(),"%%MIDI program "+o);m=/%%MIDI bassprog \d+\s*/gm;var f=t.match(m);if(f&&f.length>0)for(var p=0;p<f.length;++p)g=g.replace(f[p].trim(),"%%MIDI bassprog "+a);m=/%%MIDI chordprog \d+\s*/gm;var A=t.match(m);if(A&&A.length>0)for(var p=0;p<A.length;++p)g=g.replace(A[p].trim(),"%%MIDI chordprog "+r);m=/%%MIDI bassvol \d+\s*/gm;var b=t.match(m);if(b&&b.length>0)for(var p=0;p<b.length;++p)g=g.replace(b[p].trim(),"%%MIDI bassvol "+l);m=/%%MIDI chordvol \d+\s*/gm;var T=t.match(m);if(T&&T.length>0)for(var p=0;p<T.length;++p)g=g.replace(T[p].trim(),"%%MIDI chordvol "+s);return g}function FindPreTuneHeader(t){var n,o=t.search(/^X:.*[\r\n]*/m);return -1==o||0==o?"":n=t.substring(0,o)}function InjectRepeatsAndClickTrackAll(){sendGoogleAnalytics("dialog","InjectRepeatsAndClickTrackAll");var t=CountTunes();0!=t&&DayPilot.Modal.form([{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Inject Repeats and Two-Bar Silence and/or Click Intros&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/app/userguide.html#injectrepeatsandtwobarclickintros" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="margin-top:24px;margin-bottom:24px;font-size:12pt;line-height:18pt;font-family:helvetica">This will inject repeats into each tune in the ABC area by  appending the entire ABC for each tune to itself multiple times.</p>'},{html:'<p style="margin-top:24px;margin-bottom:24px;font-size:12pt;line-height:18pt;font-family:helvetica">You may also optionally inject two bars of silence and/or a click intro before each tune.</p>'},{name:"How many times through each tune:",id:"configure_repeats",type:"number",cssClass:"configure_repeats_form_text"},{name:"Before each tune:",id:"configure_before_each_tune",type:"select",options:[{name:"Do nothing",id:0},{name:"Inject two bars of silence",id:1},{name:"Inject a two-bar style-appropriate click intro",id:2},{name:"Inject both two bars of silence and click intro",id:3}],cssClass:"configure_mp3_before_tune_select"},{html:'<p style="margin-top:16px;font-size:12pt;line-height:18pt;font-family:helvetica"><strong>To append two-bars of silence and/or a click intro before each tune:</strong></p>'},{html:'<p style="margin-top:16px;font-size:12pt;line-height:18pt;font-family:helvetica">1) Set <strong>How many times through each tune:</strong> to 1</p>'},{html:'<p style="margin-top:16px;font-size:12pt;line-height:18pt;font-family:helvetica">2) Select your option for silence and/or click intro from the <strong>Before each tune:</strong> dropdown.</p>'},{html:'<p style="margin-top:16px;font-size:12pt;line-height:18pt;font-family:helvetica">3) Click <strong>OK</strong>.</p>'},{html:'<p style="margin-top:16px;font-size:12pt;line-height:18pt;font-family:helvetica"><strong>For best results when repeating tunes:<strong></p>'},{html:'<p style="margin-top:16px;font-size:12pt;line-height:18pt;font-family:helvetica">For clean repeats, your tunes must not have extraneous pickup or trailing notes and must have proper and complete timing.</p>'},{html:'<p style="margin-top:16px;font-size:12pt;line-height:18pt;font-family:helvetica">If there is a repeat at the end of the first part of a tune, either standalone or in a first ending, there must be a matching |: bar at the start of the tune for the tune repeats to work properly.</p>'},],{configure_repeats:1,configure_before_each_tune:0},{theme:"modal_flat",top:100,width:760,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(n){if(!n.canceled){var o=n.result.configure_repeats;if(null!=o){if(repeatCount=parseInt(o),!(isNaN(repeatCount)||void 0==repeatCount||repeatCount<1)){var a=n.result.configure_before_each_tune,r=!1,l=!1;switch(a){case 0:r=!1,l=!1;break;case 1:r=!1,l=!0;break;case 2:r=!0,l=!1;break;case 3:r=!0,l=!0}for(var s=FindPreTuneHeader(gTheABC.value),g=0;g<t;++g){var c=getTuneByIndex(g),d=getTuneRhythmType(c);c=AddDuplicatesForMp3(c,d,repeatCount,r,l),s+=c,s+="\n\n"}gTheABC.value=s,gIsDirty=!0,RenderAsync(!0,null,function(){gTheABC.selectionStart=0,gTheABC.selectionEnd=0,FocusAfterOperation()})}}}})}function InjectStringAboveTuneHeaderConditional(t,n){return -1==t.indexOf(n)?InjectStringAboveTuneHeader(t,n):t}function InjectStringAboveTuneHeader(t,n){var o=escape(t).split("%0A"),a="",r="";for(i=0;i<o.length;++i){var l=(r=unescape(o[i])).split("");"|"!=l[0]&&"["!=l[0]&&":"==l[1]?(a+=r+"\n","X"==l[0]&&(a+=n+"\n")):(a+=r,i!=o.length-1&&(a+="\n"))}return a}function InjectStringBelowTuneHeaderConditional(t,n){return -1==t.indexOf(n)?InjectStringBelowTuneHeader(t,n):t}function InjectStringBelowTuneHeader(t,n){if(isSectionHeader(t))return t;for(var o,a=t,r=removeABCTuneHeaders(t=t.trim()),l=(r=r.trim()).split("\n"),s=l.length,g=!1,c=0;c<s;++c)if(0!=(o=l[c]).indexOf("%")){g=!0;var d=r.indexOf(o);r=r.substring(d);break}if(!g)return a;var u=t.indexOf(o);return t=t.substring(0,u),t+=n,t+="\n"+r+"\n\n"}function InjectOneTuneStaffWidth(t,n){return InjectStringBelowTuneHeader(t,"%%staffwidth "+n)}function InjectOneTuneLargePrint(t,n){return InjectStringBelowTuneHeader(t,"%\n% Adjust these values to produce the desired results:\n%\n%%noexpandtowidest\n%%leftmargin 0\n%%rightmargin 0\n%%staffwidth "+n+"\n%")}function InjectOneTuneSoundfont(t,n){return InjectStringBelowTuneHeader(t,"% Soundfont: "+n+"\n%abcjs_soundfont "+n)}function InjectSectionHeader(){!gRenderingPDF&&(sendGoogleAnalytics("dialog","InjectSectionHeader"),DayPilot.Modal.form([{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Inject PDF Tunebook Section Header&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/app/userguide.html#pdf_section_headers" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="margin-top:36px;font-size:12pt;line-height:18pt;font-family:helvetica">This will inject a PDF section header placeholder tune into the ABC.</p>'},{html:'<p style="font-size:12pt;line-height:18pt;font-family:helvetica">The section header will be displayed on its own line in the PDF Table of Contents and Index.</p>'},{html:'<p style="font-size:12pt;line-height:18pt;font-family:helvetica">Clicking on the section header in the PDF Table of Contents or Index will jump to the section.</p>'},{html:'<p style="margin-bottom:36px;font-size:12pt;line-height:18pt;font-family:helvetica">The * at the start of the injected tune title marks the tune as a PDF section header.</p>'},{name:"Section name to inject",id:"configure_sectionheader",type:"text",cssClass:"configure_sectionheader_form_text"},],{configure_sectionheader:"Section Name"},{theme:"modal_flat",top:100,width:760,scrollWithPage:AllowDialogsToScroll(),autoFocus:!0}).then(function(t){if(!t.canceled){var n=t.result.configure_sectionheader;if(null!=n){var o=gTheABC.selectionStart,a=gTheABC.value.substring(0,o),r=gTheABC.value.substring(o);gTheABC.value=a+"\nX:1\nT:*"+n+"\n"+r,gIsDirty=!0,RenderAsync(!0,null,function(){gTheABC.selectionStart=o,gTheABC.selectionEnd=o,FocusAfterOperation()})}}}))}var gIdleHeaderInjectValue="";function idleHeaderInject(){gIdleHeaderInjectValue=document.getElementById("headers_to_inject").value}function keydownHeaderInject(t){t.stopPropagation()}function InjectHeaderString(){if(!gRenderingPDF){var t=findSelectedTuneIndex();gIdleHeaderInjectValue="",DayPilot.Modal.form([{html:'<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">Inject ABC Header Text&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/app/userguide.html#advanced_injectabcheader" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="margin-top:24px;margin-bottom:36px;font-size:12pt;line-height:18pt;font-family:helvetica;text-align:center">Clicking "OK" will inject the text into the header of your ABC tune(s).</p>'},{name:"Header inject location:",id:"injectlocation",type:"select",options:[{name:"  Top",id:0},{name:"  Bottom",id:1}],cssClass:"configure_injectheaderstring_select"},{html:'<p style="font-size:12pt;line-height:18pt;font-family:helvetica;">Header text to inject:</p><textarea id="headers_to_inject" style="font-family:Courier;font-size:13pt;line-height:16pt;width:578px;height:340px;padding:6px" placeholder="Enter header text to inject here" spellcheck="false" autocorrect="off" autocapitalize="none" oninput="idleHeaderInject()" onkeydown="keydownHeaderInject(event)"></textarea>'},{name:"          Inject all tunes",id:"injectalltunes",type:"checkbox",cssClass:"configure_injectheaderstring_form_text"},],{injectlocation:1,injectalltunes:!0},{theme:"modal_flat",top:100,width:650,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(n){if(sendGoogleAnalytics("action","InjectHeaderString"),!n.canceled){var o=n.result.injectlocation,a=n.result.injectalltunes,r=gIdleHeaderInjectValue;if(""!=(r=r.trim())){if(a){for(var l=CountTunes(),s=gTheABC.value,g=s.split(/^X:/gm),c=FindPreTuneHeader(s),d=1;d<=l;++d){var u="X:"+g[d];0==o?c+=InjectStringAboveTuneHeader(u,r):c+=InjectStringBelowTuneHeader(u,r)}gTheABC.value=c,gIsDirty=!0,RenderAsync(!0,null,function(){gTheABC.selectionStart=0,gTheABC.selectionEnd=0,FocusAfterOperation()})}else{var p=findSelectedTune();if(""==p)return;var m=p;m=(m=0==o?InjectStringAboveTuneHeader(m,r):InjectStringBelowTuneHeader(m,r)).replace("\n\n","");var h=gTheABC.selectionStart,f=gTheABC.value;f=f.replace(p,m),gTheABC.value=f,gIsDirty=!0,RenderAsync(!1,t,function(){gTheABC.selectionStart=h,gTheABC.selectionEnd=h,FocusAfterOperation()})}}}})}}var gLastInjectedStaffWidth=556;function InjectStaffWidth(){if(gRenderingPDF)return;sendGoogleAnalytics("dialog","InjectStaffWidth");let t={configure_staffwidth:gLastInjectedStaffWidth,configure_inject_all:!0};DayPilot.Modal.form([{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Inject Staff Width Directive&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/app/userguide.html#pdf_tunebook_spacing_overrides" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="margin-top:36px;margin-bottom:36px;font-size:12pt;line-height:18pt;font-family:helvetica">This will inject a %%staffwidth directive into the ABC. </p>'},{html:'<p style="margin-top:36px;margin-bottom:36px;font-size:12pt;line-height:18pt;font-family:helvetica">Larger numbers make the notation less tall. </p>'},{name:"%%staffwidth value to inject?",id:"configure_staffwidth",type:"number",cssClass:"configure_staffwidth_form_text"},{name:"            Inject all tunes",id:"configure_inject_all",type:"checkbox",cssClass:"configure_staffwidth_form_text"},],t,{theme:"modal_flat",top:100,width:600,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(t){if(!t.canceled){var n=t.result.configure_staffwidth;if(null!=n){var o=parseInt(n);if(!isNaN(o)&&void 0!=o){if(gLastInjectedStaffWidth=o,t.result.configure_inject_all){for(var a=CountTunes(),r=gTheABC.value,l=r.split(/^X:/gm),s=FindPreTuneHeader(r),g=1;g<=a;++g)l[g]="X:"+l[g],s+=InjectOneTuneStaffWidth(l[g],o);gTheABC.value=s,gIsDirty=!0,RenderAsync(!0,null,function(){gTheABC.selectionStart=0,gTheABC.selectionEnd=0,FocusAfterOperation()})}else{var c=gTheABC.selectionStart,d=gTheABC.value.substring(0,c),u=gTheABC.value.substring(c);gTheABC.value=d+"%%staffwidth "+o+"\n"+u,gIsDirty=!0,RenderAsync(!0,null,function(){gTheABC.selectionStart=c,gTheABC.selectionEnd=c,FocusAfterOperation()})}}}}})}const gTheFontInjectData={configure_injectall:!0,configure_titlefont:!1,configure_subtitlefont:!1,configure_infofont:!1,configure_partsfont:!1,configure_tempofont:!1,configure_textfont:!1,configure_composerfont:!1,configure_annotationfont:!1,configure_gchordfont:!1,configure_vocalfont:!1,configure_wordsfont:!1,configure_tablabelfont:!1,configure_tabnumberfont:!1,configure_tabgracefont:!1,configure_historyfont:!1,configure_voicefont:!1};function InjectFontSettings(){if(!gRenderingPDF){var t=findSelectedTuneIndex(),n=[{html:'<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">Inject Font Settings&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/app/userguide.html#advanced_inject_font_settings" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="margin-top:24px;margin-bottom:24px;font-size:12pt;line-height:18pt;font-family:helvetica;text-align:center">Click "OK" to inject the checked fonts below from your Font Settings into the tunes.</p>'},{name:"Title font: "+gRenderingFonts.titlefont,id:"configure_titlefont",type:"checkbox",cssClass:"configure_injectfontstring_form_text"},{name:"Subtitle font: "+gRenderingFonts.subtitlefont,id:"configure_subtitlefont",type:"checkbox",cssClass:"configure_injectfontstring_form_text"},{name:"Info font: "+gRenderingFonts.infofont,id:"configure_infofont",type:"checkbox",cssClass:"configure_injectfontstring_form_text"},{name:"Parts font: "+gRenderingFonts.partsfont,id:"configure_partsfont",type:"checkbox",cssClass:"configure_injectfontstring_form_text"},{name:"Tempo font: "+gRenderingFonts.tempofont,id:"configure_tempofont",type:"checkbox",cssClass:"configure_injectfontstring_form_text"},{name:"Text font: "+gRenderingFonts.textfont,id:"configure_textfont",type:"checkbox",cssClass:"configure_injectfontstring_form_text"},{name:"Composer font: "+gRenderingFonts.composerfont,id:"configure_composerfont",type:"checkbox",cssClass:"configure_injectfontstring_form_text"},{name:"Annotation font: "+gRenderingFonts.annotationfont,id:"configure_annotationfont",type:"checkbox",cssClass:"configure_injectfontstring_form_text"},{name:"Guitar chord font: "+gRenderingFonts.gchordfont,id:"configure_gchordfont",type:"checkbox",cssClass:"configure_injectfontstring_form_text"},{name:"Vocal font: "+gRenderingFonts.vocalfont,id:"configure_vocalfont",type:"checkbox",cssClass:"configure_injectfontstring_form_text"},{name:"Words font: "+gRenderingFonts.wordsfont,id:"configure_wordsfont",type:"checkbox",cssClass:"configure_injectfontstring_form_text"},{name:"Tab label font: "+gRenderingFonts.tablabelfont,id:"configure_tablabelfont",type:"checkbox",cssClass:"configure_injectfontstring_form_text"},{name:"Tab number font: "+gRenderingFonts.tabnumberfont,id:"configure_tabnumberfont",type:"checkbox",cssClass:"configure_injectfontstring_form_text"},{name:"Tab grace font: "+gRenderingFonts.tabgracefont,id:"configure_tabgracefont",type:"checkbox",cssClass:"configure_injectfontstring_form_text"},{name:"History font: "+gRenderingFonts.historyfont,id:"configure_historyfont",type:"checkbox",cssClass:"configure_injectfontstring_form_text"},{name:"Voice font: "+gRenderingFonts.voicefont,id:"configure_voicefont",type:"checkbox",cssClass:"configure_injectfontstring_form_text"},{html:'<p style="margin-top:0px;font-size:12pt;line-height:18pt;font-family:helvetica;text-align:center">&nbsp;</p>'},{name:"Inject all tunes ",id:"configure_injectall",type:"checkbox",cssClass:"configure_injectfontstring_form_text"},];DayPilot.Modal.form(n,gTheFontInjectData,{theme:"modal_flat",top:75,width:675,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(n){if(sendGoogleAnalytics("action","InjectFontSettings"),!n.canceled){gTheFontInjectData.configure_injectall=!1,gTheFontInjectData.configure_titlefont=!1,gTheFontInjectData.configure_subtitlefont=!1,gTheFontInjectData.configure_infofont=!1,gTheFontInjectData.configure_partsfont=!1,gTheFontInjectData.configure_tempofont=!1,gTheFontInjectData.configure_textfont=!1,gTheFontInjectData.configure_composerfont=!1,gTheFontInjectData.configure_annotationfont=!1,gTheFontInjectData.configure_gchordfont=!1,gTheFontInjectData.configure_vocalfont=!1,gTheFontInjectData.configure_wordsfont=!1,gTheFontInjectData.configure_tablabelfont=!1,gTheFontInjectData.configure_tabnumberfont=!1,gTheFontInjectData.configure_tabgracefont=!1,gTheFontInjectData.configure_historyfont=!1,gTheFontInjectData.configure_voicefont=!1;var o=n.result.configure_injectall;o&&(gTheFontInjectData.configure_injectall=!0);var a="";if(n.result.configure_titlefont&&(gTheFontInjectData.configure_titlefont=!0,a+="%%titlefont "+gRenderingFonts.titlefont+"\n"),n.result.configure_subtitlefont&&(gTheFontInjectData.configure_subtitlefont=!0,a+="%%subtitlefont "+gRenderingFonts.subtitlefont+"\n"),n.result.configure_infofont&&(gTheFontInjectData.configure_infofont=!0,a+="%%infofont "+gRenderingFonts.infofont+"\n"),n.result.configure_partsfont&&(gTheFontInjectData.configure_partsfont=!0,a+="%%partsfont "+gRenderingFonts.partsfont+"\n"),n.result.configure_tempofont&&(gTheFontInjectData.configure_tempofont=!0,a+="%%tempofont "+gRenderingFonts.tempofont+"\n"),n.result.configure_textfont&&(gTheFontInjectData.configure_textfont=!0,a+="%%textfont "+gRenderingFonts.textfont+"\n"),n.result.configure_composerfont&&(gTheFontInjectData.configure_composerfont=!0,a+="%%composerfont "+gRenderingFonts.composerfont+"\n"),n.result.configure_annotationfont&&(gTheFontInjectData.configure_annotationfont=!0,a+="%%annotationfont "+gRenderingFonts.annotationfont+"\n"),n.result.configure_gchordfont&&(gTheFontInjectData.configure_gchordfont=!0,a+="%%gchordfont "+gRenderingFonts.gchordfont+"\n"),n.result.configure_vocalfont&&(gTheFontInjectData.configure_vocalfont=!0,a+="%%vocalfont "+gRenderingFonts.vocalfont+"\n"),n.result.configure_wordsfont&&(gTheFontInjectData.configure_wordsfont=!0,a+="%%wordsfont "+gRenderingFonts.wordsfont+"\n"),n.result.configure_tablabelfont&&(gTheFontInjectData.configure_tablabelfont=!0,a+="%%tablabelfont "+gRenderingFonts.tablabelfont+"\n"),n.result.configure_tabnumberfont&&(gTheFontInjectData.configure_tabnumberfont=!0,a+="%%tabnumberfont "+gRenderingFonts.tabnumberfont+"\n"),n.result.configure_tabgracefont&&(gTheFontInjectData.configure_tabgracefont=!0,a+="%%tabgracefont "+gRenderingFonts.tabgracefont+"\n"),n.result.configure_historyfont&&(gTheFontInjectData.configure_historyfont=!0,a+="%%historyfont "+gRenderingFonts.historyfont+"\n"),n.result.configure_voicefont&&(gTheFontInjectData.configure_voicefont=!0,a+="%%voicefont "+gRenderingFonts.voicefont+"\n"),""!=a){if(o){a+="\n";for(var r=CountTunes(),l=gTheABC.value,s=l.split(/^X:/gm),g=FindPreTuneHeader(l),c=1;c<=r;++c){var d="X:"+s[c];d=(d=InjectStringAboveTuneHeader(d,a)).replace("\n\n",""),g+=d}gTheABC.value=g,gIsDirty=!0,RenderAsync(!0,null,function(){gTheABC.selectionStart=0,gTheABC.selectionEnd=0,FocusAfterOperation()})}else{var u=findSelectedTune();if(""==u)return;a+="\n";var p=u;p=(p=InjectStringAboveTuneHeader(p,a)).replace("\n\n","");var m=gTheABC.selectionStart,h=gTheABC.value;h=h.replace(u,p),gTheABC.value=h,gIsDirty=!0,RenderAsync(!1,t,function(){gTheABC.selectionStart=m,gTheABC.selectionEnd=m,FocusAfterOperation()})}}}})}}var gNotationSpacingLeftMargin=15,gNotationSpacingRightMargin=15,gNotationSpacingStaffWidth=556,gNotationSpacingStaffSep=0,gNotationSpacingNoExpand=!1,gNotationCallback=null;function testSpacingChange(){var t;isNaN(t=document.getElementById("layout_left_margin").value)||(gNotationSpacingLeftMargin=t),isNaN(t=document.getElementById("layout_right_margin").value)||(gNotationSpacingRightMargin=t),isNaN(t=document.getElementById("layout_staff_width").value)||(gNotationSpacingStaffWidth=t),isNaN(t=document.getElementById("layout_staff_sep").value)||(gNotationSpacingStaffSep=t),gNotationSpacingNoExpand=document.getElementById("layout_inject_noexpand").checked,gNotationCallback&&gNotationCallback()}function NotationSpacingInject(){if(document.getElementById("layout_inject_all").checked){for(var t=CountTunes(),n=gTheABC.value,o=n.split(/^X:/gm),a=FindPreTuneHeader(n),r=1;r<=t;++r)a+=InjectOneTuneSpacingHeader("X:"+o[r],gNotationSpacingStaffSep,gNotationSpacingLeftMargin,gNotationSpacingRightMargin,gNotationSpacingStaffWidth,gNotationSpacingNoExpand);gTheABC.value=a,gIsDirty=!0,RenderAsync(!0,null,function(){DayPilot.Modal.alert('<p style="text-align:center;font-size:14pt;font-family:helvetica;">Spacing Injection Complete!</p>',{theme:"modal_flat",top:300,width:500,scrollWithPage:AllowDialogsToScroll()}).then(function(){gTheABC.selectionStart=0,gTheABC.selectionEnd=0,FocusAfterOperation()})})}else{var l=findSelectedTune();if(""==l)return;var s=findSelectedTuneIndex(),g=l;g=(g=InjectOneTuneSpacingHeader(g,gNotationSpacingStaffSep,gNotationSpacingLeftMargin,gNotationSpacingRightMargin,gNotationSpacingStaffWidth,gNotationSpacingNoExpand)).replace("\n\n","");var c=gTheABC.selectionStart,d=gTheABC.value;d=d.replace(l,g),gTheABC.value=d,gIsDirty=!0,RenderAsync(!1,s,function(){DayPilot.Modal.alert('<p style="text-align:center;font-size:14pt;font-family:helvetica;">Spacing Injection Complete!</p>',{theme:"modal_flat",top:300,width:500,scrollWithPage:AllowDialogsToScroll()}).then(function(){gTheABC.selectionStart=c,gTheABC.selectionEnd=c,FocusAfterOperation()})})}}function InjectOneTuneSpacingHeader(t,n,o,a,r,l){var s="%%staffsep "+n+"\n%%leftmargin "+o+"\n%%rightmargin "+a+"\n%%staffwidth "+r+"\n%";return l&&(s="%%noexpandtowidest\n"+s),InjectStringBelowTuneHeader(t,s="%\n% Spacing values injected by the Notation Spacing Explorer:\n%\n"+s)}function NotationSpacingExplorer(){if(gAllowCopy&&!gRenderingPDF){sendGoogleAnalytics("dialog","NotationSpacingExplorer");var t,n=findSelectedTune();if(""!=n){var o=GetRadioValue("notenodertab"),a=GetABCJSParams(o);a.oneSvgPerLine=!1,modal_msg='<div id="notationspacingexplorerholder" style="height:'+(window.innerHeight-340)+'px;overflow-y:auto;margin-bottom:15px;padding:4px;">',modal_msg+='<div id="notationspacingexplorer-paper"></div>',modal_msg+="</div>",modal_msg+='<p class="configure_layout_text" style="text-align:center;margin:0px;margin-top:20px">',modal_msg+='<span>Staff Separation:</span> <input style="width:70px;margin-right:14px;" id="layout_staff_sep" type="number" min="-100" step="1" max="1000" title="Staff separation" autocomplete="off" onchange="testSpacingChange();"/>',modal_msg+='<span>Left Margin:</span> <input style="width:70px;margin-right:14px;" id="layout_left_margin" type="number" min="0" step="1" max="1000" title="Left margin" autocomplete="off" onchange="testSpacingChange();"/>',modal_msg+='<span>Right Margin:</span> <input style="width:70px;margin-right:14px;" id="layout_right_margin" type="number" min="0" step="1" max="1000" title="Right margin" autocomplete="off" onchange="testSpacingChange();"/>',modal_msg+='<span>Staff Width:</span> <input style="width:80px;margin-right:0px;" id="layout_staff_width" type="number" min="0" step="1" max="2000" title="Staff width" autocomplete="off" onchange="testSpacingChange();"/>',modal_msg+="</p>",modal_msg+='<p class="configure_layout_text" style="text-align:center;margin:0px;margin-top:20px">',modal_msg+='<span style="font-size:12pt;font-family:helvetica;">Add %%noexpandtowidest:</span><input style="width:16px;margin-left:8px;margin-right:24px;" id="layout_inject_noexpand" type="checkbox" onchange="testSpacingChange();"/>',modal_msg+='<input id="notationspacingexplorertest" style="margin-right:36px;" class="notationspacingexplorerinject button btn btn-notationspacingexplorertest" onclick="testSpacingChange();" type="button" value="Test Values" title="Tests the spacing changes ABC">',modal_msg+='<span style="font-size:12pt;font-family:helvetica;">Inject all tunes:</span><input style="width:16px;margin-left:8px;margin-right:24px;" id="layout_inject_all" type="checkbox"/>',modal_msg+='<input id="notationspacingexplorerinject" class="notationspacingexplorerinject button btn btn-notationspacingexplorerinject" onclick="NotationSpacingInject();" type="button" style="margin-right:0px;" value="Inject Spacing into the ABC" title="Injects the spacing values into the ABC">',modal_msg+="</p>",modal_msg+='<a id="notationspacingexplorer_help" href="https://michaeleskin.com/app/userguide.html#advanced_notationspacingexplorer" target="_blank" style="text-decoration:none;" title="Learn more about the Notation Spacing Explorer" class="dialogcornerbutton">?</a>';var r=window.innerWidth;isDesktopBrowser()?(t=.45*r)<850&&(t=850):t=800;var l=/^X:.*$/gm,s=n=n.replace(l,"X:1\n%%staffsep "+gStaffSpacing);DayPilot.Modal.alert(modal_msg,{theme:"modal_flat",top:40,width:t,okText:"Close",scrollWithPage:isMobileBrowser()}),gNotationSpacingLeftMargin=15;var l=/^%%leftmargin.*$/m,g=n.match(l);if(g&&g.length>0){var c=g[0].replace("%%leftmargin",""),d=parseInt(c=c.trim());isNaN(d)||(gNotationSpacingLeftMargin=d)}if(gNotationSpacingRightMargin=15,l=/^%%rightmargin.*$/gm,(g=n.match(l))&&g.length>0){var c=g[g.length-1].replace("%%rightmargin",""),d=parseInt(c=c.trim());isNaN(d)||(gNotationSpacingRightMargin=d)}if(gNotationSpacingStaffWidth=556,l=/^%%staffwidth.*$/gm,(g=n.match(l))&&g.length>0){var c=g[g.length-1].replace("%%staffwidth",""),d=parseInt(c=c.trim());isNaN(d)||(gNotationSpacingStaffWidth=d)}if(gNotationSpacingStaffSep=gStaffSpacing,l=/^%%staffsep.*$/gm,(g=n.match(l))&&g.length>0){var c=g[g.length-1].replace("%%staffsep",""),d=parseInt(c=c.trim());isNaN(d)||(gNotationSpacingStaffSep=d)}gNotationSpacingNoExpand=!1,l=/^%%noexpandtowidest.*$/m,(g=n.match(l))&&g.length>0&&(gNotationSpacingNoExpand=!0),document.getElementById("layout_left_margin").value=gNotationSpacingLeftMargin,document.getElementById("layout_right_margin").value=gNotationSpacingRightMargin,document.getElementById("layout_staff_width").value=gNotationSpacingStaffWidth,document.getElementById("layout_staff_sep").value=gNotationSpacingStaffSep,document.getElementById("layout_inject_noexpand").checked=gNotationSpacingNoExpand,gNotationCallback=function(){n=InjectOneTuneSpacingHeader(s,gNotationSpacingStaffSep,gNotationSpacingLeftMargin,gNotationSpacingRightMargin,gNotationSpacingStaffWidth,gNotationSpacingNoExpand);var t=ABCJS.renderAbc("notationspacingexplorer-paper",n,a)[0];postProcessTab([t],"notationspacingexplorer-paper",o,!0),document.querySelectorAll('div[id="notationspacingexplorer-paper"] > svg')[0].style.boxShadow="inset 0px 0px 0px 1px #b8b8b8"};var u=ABCJS.renderAbc("notationspacingexplorer-paper",n,a)[0];postProcessTab([u],"notationspacingexplorer-paper",o,!0),document.querySelectorAll('div[id="notationspacingexplorer-paper"] > svg')[0].style.boxShadow="inset 0px 0px 0px 1px #b8b8b8"}}}function InjectOneTuneMIDIProgram(t,n){var o,a,r="";return InjectStringBelowTuneHeader(t,r="% Melody program: "+(o="mute"==n?"Mute":generalMIDISoundNames[n+1])+"\n%%MIDI program "+n)}function InjectOneTuneMIDIBassProgramAndVolumes(t,n,o){var a,r="";return r="% Bass program: "+(a="mute"==n?"Mute":generalMIDISoundNames[n+1])+"\n%%MIDI bassprog "+n,InjectStringBelowTuneHeader(t,r+="\n%%MIDI bassvol "+o)}function InjectOneTuneMIDIChordProgramAndVolumes(t,n,o){var a,r="";return r="% Chords program: "+(a="mute"==n?"Mute":generalMIDISoundNames[n+1])+"\n%%MIDI chordprog "+n,InjectStringBelowTuneHeader(t,r+="\n%%MIDI chordvol "+o)}function InjectOneTuneMIDIProgramAboveTune(t,n,o,a){var r;return o?InjectStringAboveTuneHeader(t,"%%MIDI bassprog "+n):a?InjectStringAboveTuneHeader(t,"%%MIDI chordprog "+n):InjectStringAboveTuneHeader(t,"%%MIDI program "+n)}function InjectOneTuneMIDIVolume(t,n,o){var a;return o?InjectStringBelowTuneHeader(t,"%%MIDI chordvol "+n):InjectStringBelowTuneHeader(t,"%%MIDI bassvol "+n)}function InjectOneTuneMIDIVolumeAboveTune(t,n,o){var a;return o?InjectStringAboveTuneHeader(t,"%%MIDI chordvol "+n):InjectStringAboveTuneHeader(t,"%%MIDI bassvol "+n)}function InjectReverbAboveTune(t,n){var o;return InjectStringAboveTuneHeader(t,"%reverb "+n)}const soundfontNames=["Fluid","Musyng Kite","FatBoy","Canvas","MScore","Arachno","FluidHQ"],generalMIDISoundNames=["Mute","Acoustic Grand Piano","Bright Acoustic Piano","Electric Grand Piano","Honky-tonk Piano","Electric Piano 1","Electric Piano 2","Harpsichord","Clavi","Celesta","Glockenspiel","Music Box","Vibraphone","Marimba","Xylophone","Tubular Bells","Dulcimer","Drawbar Organ","Percussive Organ","Rock Organ","Church Organ","Reed Organ","Accordion","Harmonica","Tango Accordion","Acoustic Guitar (nylon)","Acoustic Guitar (steel)","Electric Guitar (jazz)","Electric Guitar (clean)","Electric Guitar (muted)","Overdriven Guitar","Distortion Guitar","Guitar Harmonics","Acoustic Bass","Electric Bass (finger)","Electric Bass (pick)","Fretless Bass","Slap Bass 1","Slap Bass 2","Synth Bass 1","Synth Bass 2","Violin","Viola","Cello","Contrabass","Tremolo Strings","Pizzicato Strings","Orchestral Harp","Timpani","String Ensemble 1","String Ensemble 2","SynthStrings 1","SynthStrings 2","Choir Aahs","Voice Oohs","Synth Voice","Orchestra Hit","Trumpet","Trombone","Tuba","Muted Trumpet","French Horn","Brass Section","SynthBrass 1","SynthBrass 2","Soprano Sax","Alto Sax","Tenor Sax","Baritone Sax","Oboe","English Horn","Bassoon","Clarinet","Piccolo","Flute","Recorder","Pan Flute","Blown Bottle","Shakuhachi","Whistle","Ocarina","Lead 1 (square)","Lead 2 (sawtooth)","Lead 3 (calliope)","Lead 4 (chiff)","Lead 5 (charang)","Lead 6 (voice)","Lead 7 (fifths)","Lead 8 (bass + lead)","Pad 1 (new age)","Pad 2 (warm)","Pad 3 (polysynth)","Pad 4 (choir)","Pad 5 (bowed)","Pad 6 (metallic)","Pad 7 (halo)","Pad 8 (sweep)","FX 1 (rain)","FX 2 (soundtrack)","FX 3 (crystal)","FX 4 (atmosphere)","FX 5 (brightness)","FX 6 (goblins)","FX 7 (echoes)","FX 8 (sci-fi)","Sitar","Banjo","Shamisen","Koto","Kalimba","Bagpipe","Fiddle","Shanai","Tinkle Bell","Agogo","Steel Drums","Woodblock","Taiko Drum","Bodhran","Synth Drum","Reverse Cymbal","Guitar Fret Noise","Breath Noise","Seashore","Bird Tweet","Telephone Ring","Helicopter","Applause","Gunshot","abcjs Percussion","Uilleann Pipes","Smallpipes (D)","Smallpipes (A)","S\xe4ckpipa","Concertina","Melodica","Cajun Accordion","Solf\xe8ge","Chorused Guitar (nylon)","Chorused Guitar (steel)","Irish Bouzouki","Irish Bouzouki 2","Mandolin","Marching Drums","Border Pipes","Silence"];var MIDI_PATCH_COUNT=144,gLastInjectedSoundfont=null,gLastInjectedProgram=1,gLastInjectedBassProgram=1,gLastInjectedChordsProgram=1,gLastInjectedChordVolume=64,gLastInjectedBassVolume=64;function InjectAllMIDIParams(){if(gRenderingPDF)return;sendGoogleAnalytics("dialog","InjectAllMIDIParams");for(var t=[],n=0;n<=MIDI_PATCH_COUNT;++n)t.push({name:"  "+generalMIDISoundNames[n],id:n});null==gLastInjectedSoundfont&&(-1!=gDefaultSoundFont.indexOf("FluidR3_GM")?gLastInjectedSoundfont="0":-1!=gDefaultSoundFont.indexOf("Musyng")?gLastInjectedSoundfont="1":-1!=gDefaultSoundFont.indexOf("fatboy")?gLastInjectedSoundfont="2":-1!=gDefaultSoundFont.indexOf("canvas")?gLastInjectedSoundfont="3":-1!=gDefaultSoundFont.indexOf("mscore")?gLastInjectedSoundfont="4":-1!=gDefaultSoundFont.indexOf("arachno")?gLastInjectedSoundfont="5":-1!=gDefaultSoundFont.indexOf("fluidhq")&&(gLastInjectedSoundfont="6"));let o={configure_soundfont:gLastInjectedSoundfont,configure_inject_soundfont:!1,configure_program:gLastInjectedProgram,configure_inject_melody_program:!1,configure_bassprogram:gLastInjectedBassProgram,configure_chordprogram:gLastInjectedChordsProgram,configure_bassvolume:gLastInjectedBassVolume,configure_chordvolume:gLastInjectedChordVolume,configure_inject_chord_program:!1,configure_inject_bass_program:!1,configure_inject_all:!0};DayPilot.Modal.form([{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Inject MIDI Soundfont, Melody, Bass, and Chords&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/app/userguide.html#selecting_the_instruments_for_playback" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="margin-top:24px;margin-bottom:24px;font-size:12pt;line-height:18pt;font-family:helvetica">This will inject a %abcjs_soundfont directive into the ABC:</p>'},{name:"            Inject abcjs Soundfont",id:"configure_inject_soundfont",type:"checkbox",cssClass:"configure_midi_program_form_text"},{name:"%abcjs_soundfont value to inject:",id:"configure_soundfont",type:"select",options:[{name:"  Fluid",id:"0"},{name:"  Musyng Kite",id:"1"},{name:"  FatBoy",id:"2"},{name:"  Canvas",id:"3"},{name:"  MScore",id:"4"},{name:"  Arachno",id:"5"},{name:"  FluidHQ",id:"6"},],cssClass:"configure_soundfont_select"},{html:'<p style="margin-top:24px;margin-bottom:24px;font-size:12pt;line-height:18pt;font-family:helvetica">This will inject a %%MIDI program directive into the ABC:</p>'},{name:"            Inject MIDI Melody program",id:"configure_inject_melody_program",type:"checkbox",cssClass:"configure_midi_program_form_text"},{name:"MIDI Melody program to inject:",id:"configure_program",type:"select",options:t,cssClass:"configure_midi_program_select"},{html:'<p style="margin-top:24px;margin-bottom:24px;font-size:12pt;line-height:18pt;font-family:helvetica">This will inject %%MIDI bassprog and %%MIDI bassvol directives into the ABC:</p>'},{name:"            Inject MIDI Bass program and volumes",id:"configure_inject_bass_program",type:"checkbox",cssClass:"configure_midi_program_form_text"},{name:"MIDI Bass program to inject:",id:"configure_bassprogram",type:"select",options:t,cssClass:"configure_midi_program_select"},{name:"MIDI Bass volume (0-127):",id:"configure_bassvolume",type:"text",cssClass:"configure_midi_program_form_number_input"},{html:'<p style="margin-top:24px;margin-bottom:24px;font-size:12pt;line-height:18pt;font-family:helvetica">This will inject %%MIDI chordprog and %%MIDI chordvol directives into the ABC:</p>'},{name:"            Inject MIDI Chord program and volumes",id:"configure_inject_chord_program",type:"checkbox",cssClass:"configure_midi_program_form_text"},{name:"MIDI Chord program to inject:",id:"configure_chordprogram",type:"select",options:t,cssClass:"configure_midi_program_select"},{name:"MIDI Chord volume (0-127):",id:"configure_chordvolume",type:"text",cssClass:"configure_midi_program_form_number_input"},{html:'<p style="font-size:14pt;line-height:19pt;font-family:helvetica;margin-bottom:30px;text-align:center;"><a href="https://michaeleskin.com/documents/general_midi_extended_v6.pdf" target="_blank">General MIDI Instrument Program Numbers</a></p>'},{name:"            Inject all tunes",id:"configure_inject_all",type:"checkbox",cssClass:"configure_midi_program_form_text"},],o,{theme:"modal_flat",top:20,width:760,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(t){if(!t.canceled){var n=t.result.configure_inject_soundfont,o=t.result.configure_inject_melody_program,a=t.result.configure_inject_bass_program,r=t.result.configure_inject_chord_program;if(n||o||a||r){var l=t.result.configure_soundfont;gLastInjectedSoundfont=l;var s="fluid";switch(l){case"0":s="fluid";break;case"1":s="musyng";break;case"2":s="fatboy";break;case"3":s="canvas";break;case"4":s="mscore";break;case"5":s="arachno";break;case"6":s="fluidhq"}var g=t.result.configure_program;gLastInjectedProgram=g,0==g?g="mute":((g-=1)<0||g>MIDI_PATCH_COUNT)&&(g=0);var c=t.result.configure_bassprogram,d=t.result.configure_chordprogram;if(gLastInjectedBassProgram=c,gLastInjectedChordsProgram=d,gLastInjectedBassVolume=t.result.configure_bassvolume,gLastInjectedChordVolume=t.result.configure_chordvolume,isNaN(parseInt(gLastInjectedBassVolume))&&(gLastInjectedBassVolume=0),gLastInjectedBassVolume<0&&(gLastInjectedBassVolume=0),gLastInjectedBassVolume>127&&(gLastInjectedBassVolume=127),isNaN(parseInt(gLastInjectedChordVolume))&&(gLastInjectedChordVolume=0),gLastInjectedChordVolume<0&&(gLastInjectedChordVolume=0),gLastInjectedChordVolume>127&&(gLastInjectedChordVolume=127),0==c?c="mute":((c-=1)<0||c>MIDI_PATCH_COUNT)&&(c=0),0==d?d="mute":((d-=1)<0||d>MIDI_PATCH_COUNT)&&(d=0),t.result.configure_inject_all){if(n){for(var u=CountTunes(),p=gTheABC.value,m=p.split(/^X:/gm),h=FindPreTuneHeader(p),f=1;f<=u;++f)m[f]="X:"+m[f],h+=InjectOneTuneSoundfont(m[f],s);gTheABC.value=h,gIsDirty=!0}if(o){for(var u=CountTunes(),p=gTheABC.value,m=p.split(/^X:/gm),h=FindPreTuneHeader(p),f=1;f<=u;++f)m[f]="X:"+m[f],h+=InjectOneTuneMIDIProgram(m[f],g);gTheABC.value=h,gIsDirty=!0}if(a){for(var u=CountTunes(),p=gTheABC.value,m=p.split(/^X:/gm),h=FindPreTuneHeader(p),f=1;f<=u;++f)m[f]="X:"+m[f],h+=InjectOneTuneMIDIBassProgramAndVolumes(m[f],c,gLastInjectedBassVolume);gTheABC.value=h,gIsDirty=!0}if(r){for(var u=CountTunes(),p=gTheABC.value,m=p.split(/^X:/gm),h=FindPreTuneHeader(p),f=1;f<=u;++f)m[f]="X:"+m[f],h+=InjectOneTuneMIDIChordProgramAndVolumes(m[f],d,gLastInjectedChordVolume);gTheABC.value=h,gIsDirty=!0}gRawMode?RenderAsync(!0,null,function(){gTheABC.selectionStart=0,gTheABC.selectionEnd=0,FocusAfterOperation()}):(gTheABC.selectionStart=0,gTheABC.selectionEnd=0,FocusAfterOperation())}else{var A=gTheABC.selectionStart;if(a){b="mute"==c?"Mute":generalMIDISoundNames[c+1];var b,T=gTheABC.value.substring(0,A),y=gTheABC.value.substring(A),I="% Bass instrument: "+b+"\n%%MIDI bassprog "+c;I+="\n%%MIDI bassvol "+gLastInjectedBassVolume,I+="\n",gTheABC.value=T+I+y,gIsDirty=!0}if(r){b="mute"==d?"Mute":generalMIDISoundNames[d+1];var b,T=gTheABC.value.substring(0,A),y=gTheABC.value.substring(A),I="% Chord instrument: "+b+"\n%%MIDI chordprog "+d;I+="\n%%MIDI chordvol "+gLastInjectedChordVolume,I+="\n",gTheABC.value=T+I+y,gIsDirty=!0}if(o){b="mute"==g?"Mute":generalMIDISoundNames[g+1];var b,T=gTheABC.value.substring(0,A),y=gTheABC.value.substring(A);gTheABC.value=T+"% Melody instrument: "+b+"\n%%MIDI program "+g+"\n"+y,gIsDirty=!0}if(n){var T=gTheABC.value.substring(0,A),y=gTheABC.value.substring(A);gTheABC.value=T+"% Soundfont: "+s+"\n%abcjs_soundfont "+s+"\n"+y,gIsDirty=!0}gRawMode?RenderAsync(!0,null,function(){gTheABC.selectionStart=A,gTheABC.selectionEnd=A,FocusAfterOperation()}):(gTheABC.selectionStart=A,gTheABC.selectionEnd=A,FocusAfterOperation())}}}})}const metronome_list=[{name:"C|",pattern:"dd 76 77 32 32"},{name:"C",pattern:"dddd 76 77 77 77 32 32 32 32"},{name:"2/2",pattern:"dd 76 77 32 32"},{name:"3/2",pattern:"ddd 76 77 77 32 32 32"},{name:"2/4",pattern:"dd 76 77 32 32"},{name:"3/4",pattern:"ddd 76 77 77 32 32 32"},{name:"4/4",pattern:"dddd 76 77 77 77 32 32 32 32"},{name:"5/4",pattern:"ddddd 76 77 77 77 77 32 32 32 32 32"},{name:"6/4",pattern:"dddddd 76 77 77 77 77 77 32 32 32 32 32"},{name:"7/4",pattern:"ddddddd 76 77 77 77 77 77 77 32 32 32 32 32 32"},{name:"2/8",pattern:"dz 76 32"},{name:"3/8",pattern:"dzz 76 32"},{name:"5/8",pattern:"dzzdz 76 76 32 32"},{name:"6/8",pattern:"dzzdzz 76 76 32 32"},{name:"7/8",pattern:"dzdzdzz 76 76 76 32 32 32"},{name:"9/8",pattern:"dzzdzzdzz 76 76 76 32 32 32"},{name:"10/8",pattern:"dzzdzzdzdz 76 76 76 76 32 32 32 32"},{name:"11/8",pattern:"dzzdzzdzdzz 76 76 76 76 32 32 32 32"},{name:"12/8",pattern:"dzzdzzdzzdzz 76 76 76 76 32 32 32 32"}];var gMetronomeVolume=48;function inject_one_metronome(t,n){var o,a=t.split("\n"),r="",l="";for(o=0;o<a.length;++o){r=a[o],searchRegExp=/^M:.*[\r\n]*/m;var s=r.match(searchRegExp);s&&s.length>0&&""==l&&(l=(l=s[0].replace("M:","")).trim())}if(""==l){if(n){var g="No meter found in the ABC.";g=makeCenteredPromptString(g),DayPilot.Modal.alert(g,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})}return null}var c="";for(o=0;o<metronome_list.length;++o)if(l==metronome_list[o].name){c="%\n% Metronome sounds and volumes\n%\n%%MIDI drum "+metronome_list[o].pattern.replaceAll("32",gMetronomeVolume)+"\n%%MIDI drumon\n%";break}if(""==c){if(n){var g="No metronome pattern available for meter: "+l;g=makeCenteredPromptString(g),DayPilot.Modal.alert(g,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})}return null}return t=(t=InjectStringBelowTuneHeader(t,c)).trim()}function InjectMetronome(){if(!gRenderingPDF){sendGoogleAnalytics("dialog","InjectMetronome");var t=findSelectedTuneIndex();DayPilot.Modal.form([{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Inject Metronome&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/app/userguide.html#adding_a_metronome" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="margin-top:36px;margin-bottom:36px;font-size:12pt;line-height:18pt;font-family:helvetica">This injects a metronome into the ABC using %%MIDI drum and %%MIDI drumon directives.</p>'},{name:"            Inject metronome into all tunes",id:"configure_inject_all",type:"checkbox",cssClass:"configure_metronome_form_text"},],{configure_inject_all:!1},{theme:"modal_flat",top:200,width:760,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(n){if(!n.canceled){if(n.result.configure_inject_all){for(var o=CountTunes(),a=1==o,r="",l=0;l<o;++l){var s=getTuneByIndex(l),g=inject_one_metronome(s,a);g?(r+=g,r+="\n\n"):r+=s}gTheABC.value=r,gIsDirty=!0,RenderAsync(!0,null,function(){gTheABC.selectionStart=0,gTheABC.selectionEnd=0,FocusAfterOperation()})}else{var c=findSelectedTune();if(""==c)return;var d=inject_one_metronome(c,!0);if(!d)return;var u=gTheABC.selectionStart,p=gTheABC.value;p=p.replace(c,d),gTheABC.value=p,gIsDirty=!0,RenderAsync(!1,t,function(){gTheABC.selectionStart=u,gTheABC.selectionEnd=u,FocusAfterOperation()})}}})}}function CopyABC(){gAllowCopy&&(CopyToClipboard(gTheABC.value),document.getElementById("copybutton").value="Copied!",setTimeout(function(){document.getElementById("copybutton").value="Copy All"},750))}function ShortenURLFallback(){gAllowURLSave&&(CopyToClipboard(document.getElementById("urltextbox").value),document.getElementById("shortenurl").value="Share URL Copied!",setTimeout(function(){document.getElementById("shortenurl").value="Launching TinyURL",setTimeout(function(){window.open("https://tinyurl.com"),document.getElementById("shortenurl").value="Shorten URL"},1e3)},2e3))}function ShortenURL(t){if(gAllowURLSave){if(!navigator.onLine){var n="URL shortening not available while offline.";n=makeCenteredPromptString(n),DayPilot.Modal.alert(n,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});return}var o=!1;t&&t.shiftKey&&t.altKey&&(o=!0),sendGoogleAnalytics("sharing","shorten_share_url");var a=document.getElementById("urltextbox").value,r=gTinyURLAPIKey;gDoTinyURLAPIKeyOverride&&(r="Bearer "+gTinyURLAPIKeyOverride),fetch("https://api.tinyurl.com/create",{method:"POST",headers:{accept:"application/json",authorization:r,"content-type":"application/json"},body:JSON.stringify({url:a})}).then(t=>{if(200!=t.status){ShortenURLFallback();return}return t.json()}).then(t=>{CopyToClipboard(t.data.tiny_url);var n='<p style="text-align:center;font-size:16pt;font-family:helvetica">Shortened URL Copied to the Clipboard</p>';if(n+='<p style="text-align:center;font-size:14pt;line-height:19pt;font-family:helvetica">Short URL:</p>',n+='<p style="text-align:center;font-size:14pt;line-height:19pt;font-family:helvetica"><a href="'+t.data.tiny_url+'" target="_blank">'+t.data.tiny_url+"</a></p>",DayPilot.Modal.alert(n,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()}),o){for(var a=CountTunes(),r=gTheABC.value,l=r.split(/^X:/gm),s=FindPreTuneHeader(r),g=1;g<=a;++g)s+=InjectStringBelowTuneHeader("X:"+l[g],"%hyperlink "+t.data.tiny_url);gTheABC.value=s,gIsDirty=!0,RenderAsync(!0,null,function(){gTheABC.selectionStart=0,gTheABC.selectionEnd=0,FocusAfterOperation()})}gDoTinyURLAPIKeyOverride||(gTinyURLCount++,gLocalStorageAvailable&&(localStorage.TinyURLCount=gTinyURLCount),(5==gTinyURLCount||10==gTinyURLCount)&&TinyURLReminderDialog())}).catch(t=>{ShortenURLFallback()})}}function CopyShareURL(){gAllowURLSave&&(sendGoogleAnalytics("sharing","copy_share_url"),CopyToClipboard(document.getElementById("urltextbox").value),document.getElementById("copyurl").value="Share URL Copied!",setTimeout(function(){document.getElementById("copyurl").value="Copy Share URL"},750))}function SaveABC(){if(gAllowSave){var t=gTheABC.value;if(0!=t.length){var n=CountTunes(),o=getDescriptiveFileName(n,!1);isDesktopBrowser()?saveABCFile("Please enter a filename for your ABC file:  ",o+=".abc",t):saveABCFile("Please enter a filename for your ABC file:  ",o+=".txt",t)}}}function SaveShareURL(){if(gAllowURLSave){sendGoogleAnalytics("sharing","save_share_url");var t=urltextbox.value;if(0!=t.length){var n=CountTunes(),o=getDescriptiveFileName(n,!1);saveTextFile("Please enter a filename for your Share URL file:",o+"_Share_URL.txt",t)}}}function TestShareURL(){if(gAllowURLSave){sendGoogleAnalytics("sharing","test_share_url");var t=document.getElementById("urltextbox").value;window.open(t)}}function SetAbcText(t){gTheABC.value=t}function ShowAllControls(){document.getElementById("notenrechts").style.display="inline-block",gShowAllControls=!0,UpdateNotationTopPosition(),gIsOneColumn&&MakeTuneVisible(!0)}function HideAllControls(){document.getElementById("notenrechts").style.display="none",gShowAllControls=!1,UpdateNotationTopPosition(),gIsOneColumn&&MakeTuneVisible(!0)}function ShowMaximizeButton(){document.getElementById("zoombutton").style.display="block"}function HideMaximizeButton(){document.getElementById("zoombutton").style.display="none"}function HideHelpButton(){document.getElementById("helpbutton").style.display="none"}function ShowHelpButton(){document.getElementById("helpbutton").style.display="block"}function ShowPlayButton(){document.getElementById("playbuttonicon").style.display="block"}function HidePlayButton(){document.getElementById("playbuttonicon").style.display="none"}function ShowPDFButton(){document.getElementById("pdfbuttonicon").style.display="block"}function HidePDFButton(){document.getElementById("pdfbuttonicon").style.display="none"}function DoMaximize(){document.getElementById("noscroller").style.display="none",document.getElementById("notation-spacer").style.display="none",gTheNotation.style.display="flex",gTheNotation.style.float="none",gIsMaximized=!0,gPlayABCGotMaximizedPlay=!1,HandleWindowResize(),isDesktopBrowser()?(gGotRenderDivClick=!1,gRenderDivClickOffset=-1,gNotationLeftMarginBeforeMaximize=gTheNotation.style.marginLeft,gTheNotation.style.marginLeft="auto"):(ShowPDFButton(),ShowPlayButton())}function DoMinimize(){if(document.getElementById("noscroller").style.display="block",document.getElementById("notation-spacer").style.display="block",document.getElementById("zoombutton").src="img/zoomout.png",isDesktopBrowser()||(HidePlayButton(),HidePDFButton()),isDesktopBrowser()&&(gTheNotation.style.display="inline",gTheNotation.style.float="left",gTheNotation.style.marginLeft=gNotationLeftMarginBeforeMaximize),gIsMaximized=!1,gPlayABCGotMaximizedPlay=!1,HandleWindowResize(),isDesktopBrowser()){if(gForceInitialTextBoxRecalc){gInitialTextBoxWidth=gTheABC.offsetWidth;var t=document.getElementById("notenlinks");gInitialTextBoxContainerWidth=t.offsetWidth,gInitialTextBoxContainerLeft=(t=document.getElementById("noscroller")).offsetLeft,ResizeTextBox(),gForceInitialTextBoxRecalc=!1}if(gGotWindowResizeWhileMaximized){gTheABC.style.width=gInitialTextBoxWidth+"px",gTheABC.style.marginLeft="0px";var t=document.getElementById("notenlinks");gInitialTextBoxContainerWidth=t.offsetWidth,gInitialTextBoxContainerLeft=(t=document.getElementById("noscroller")).offsetLeft,gTheNotation.style.marginLeft="auto",gGotWindowResizeWhileMaximized=!1}if(gGotRenderDivClick){if(-1!=gRenderDivClickOffset){if(gTheABC.selectionEnd=gTheABC.selectionStart=gRenderDivClickOffset,isMobileBrowser())return;gTheABC.blur(),gTheABC.focus()}gGotRenderDivClick=!1,gRenderDivClickOffset=-1}}}function ToggleMaximize(){if(gIsMaximized)DoMinimize(),isDesktopBrowser()?gTheNotation.style.width="850px":gTheNotation.style.width="820px";else if(DoMaximize(),document.getElementById("zoombutton").src="img/zoomin.png",isDesktopBrowser()){var t=window.innerWidth;t*gFullScreenScaling/100>850&&(gTheNotation.style.width=gFullScreenScaling+"%")}else{var t=window.innerWidth;t*gFullScreenScaling/100>820&&(gTheNotation.style.width=gFullScreenScaling+"%")}}function IdleAllowShowTabNames(){var t=GetRadioValue("notenodertab"),n=!1;switch(t){case"noten":case"notenames":case"whistle":break;case"mandolin":case"gdad":case"cgda":case"cgdae":case"dgdae":case"guitare":case"guitard":case"uke":n=!0}gAllowShowTabNames=!!n}function utf8tob64(t){var n;try{n=btoa(escape(t))}catch(o){n=""}return n}function b64toutf8(t){var n;try{n=unescape(atob(t))}catch(o){n=""}return n}function isLandscapeOrientation(){if(window.matchMedia("(orientation: portrait)").matches);else if(window.matchMedia("(orientation: landscape)").matches)return!0;return!1}function processShareLink(){var t=!1;gDisableEditFromPlayLink=!1;let n=new URLSearchParams(window.location.search);if(n.has("lzw")){var o=n.get("lzw");abcInLZW=LZString.decompressFromEncodedURIComponent(o);let a=abcInLZW;a.length>0?(SetAbcText(a),RestoreDefaults(),t=!0,gIsDirty=!0):o.length>2e3?ShowAcrobatHyperlinkLengthWarning():ShowHyperlinkBadDecodeAlert()}if(n.has("format")){var r=n.get("format");("bc"==r||"cd"==r||"bass"==r||"mandola"==r)&&(r="noten"),"cgda"==r&&setupCGDA(),"gdad"==r&&setupGDAD(),"dgdae"==r&&setupDGDAE(),"cgdae"==r&&setupCGDAE(),SetRadioValue("notenodertab",r),"whistle"==r&&PrepareWhistleFont(),gCurrentTab=r}if(n.has("capo")){var l=parseInt(n.get("capo"));gCapo=isNaN(l)?0:l}if(n.has("ssp")){var s=parseInt(n.get("ssp"));gStaffSpacing=isNaN(s)?STAFFSPACEOFFSET+STAFFSPACEDEFAULT:STAFFSPACEOFFSET+s}else gStaffSpacing=STAFFSPACEOFFSET+STAFFSPACEDEFAULT;n.has("stn")&&(gShowTabNames="true"==n.get("stn"));var g=!1;n.has("dx")&&"1"==n.get("dx")&&(g=!0),g&&(gDisableEditFromPlayLink=!0),gPlayABCTuneIndex=0;var c=!1;n.has("play")&&"1"==n.get("play")&&(c=!0);var d=!1;!g&&n.has("editor")&&"1"==n.get("editor")&&(d=!0,c=!1);var u=!1;if(c&&n.has("index")&&(gPlayABCTuneIndex=tuneIndex=parseInt(n.get("index")),u=!0),t){var p="";if(n.has("name"))p=n.get("name");else{var m=CountTunes();p=getDescriptiveFileName(m,!1)}if(gABCFromFile=!0,gDisplayedName=p,document.getElementById("notenrechts").style.display="none",UpdateNotationTopPosition(),gShowAllControls=!1,FocusABC(),RenderAsync(!0,null,function(){if(c){if(isMobileBrowser()&&isLandscapeOrientation()){var t="The ABC Transcription Tools tune Player is best used in Portrait mode.<br/>Please rotate your device and click the play button to play the tune.";t=makeCenteredPromptString(t),DayPilot.Modal.alert(t,{theme:"modal_flat",top:25,scrollWithPage:AllowDialogsToScroll()});return}sendGoogleAnalytics("show_player","from_share"),gPlayABCTuneCount=CountTunes(),gPlayABCGotMaximizedPlay=!0;var n=gTheABC.value;n=u?getTuneByIndex(gPlayABCTuneIndex):getTuneByIndex(0);var o=PreProcessPlayABC(n);PlayABCDialog(o,null,null,null,!1)}else d&&(sendGoogleAnalytics("action","open_in_editor"),ToggleMaximize())}),isDesktopBrowser()){var h=window.innerWidth;h*gFullScreenScaling/100>850&&(gTheNotation.style.width=gFullScreenScaling+"%")}else{var h=window.innerWidth;h*gFullScreenScaling/100>820&&(gTheNotation.style.width=gFullScreenScaling+"%")}return!0}return!1}function TextBoxResizeHandler(){UpdateNotationTopPosition(),gIsOneColumn&&MakeTuneVisible(!0)}function findSelectedTuneIndex(){var t=gTheABC.value,n=t.split(/^X:/gm),o=CountTunes();if(o<2)return 0;var a=gTheABC.selectionStart;if(0==a&&(a=t.indexOf("X:")+2),0==a)return -1;var r=0;r=n[0].length;for(var l=1;l<=o;++l)if(a<(r+=n[l].length+2))return l-1;return -1}function MakeTuneVisible(t){if(gAllowCopy){var n=findSelectedTuneIndex();if(gCurrentTune=n,!(!t&&isMobileBrowser())&&!gDisableNotationRendering&&-1!=n){var o=document.getElementById("notation"+n),a=o.offsetTop,r=o.offsetHeight,l=document.getElementById("notation-spacer").offsetHeight;gIsOneColumn?a+=l:l=0;var s=window.innerHeight,g=window.scrollY,c=s-l,d=a-g-l,u=d+r;if(n!=gLastAutoScrolledTune||t){var p=a-l;window.scrollTo(0,p),gLastAutoScrolledTune=n}else if(!(d>=0&&d<c||u>0&&u<c||d<0&&d+r>c)){var p=a-l;window.scrollTo(0,p),gLastAutoScrolledTune=n}}}}function debounce(t,n){let o;return(...a)=>{clearTimeout(o),o=setTimeout(function(){t.apply(this,a)},n)}}function OnABCTextChange(){var t=gTotalTunes,n=CountTunes();t!=n?RenderAsync(!0,null):gRawMode?RenderAsync(!0,null,function(){fireSelectionChanged()}):Render(!1,gCurrentTune)}function PrepareWhistleFont(){if(!gWhistleFontPrepared){var t=document.querySelectorAll('div[id="fontholder"] > svg > style');t[0].innerHTML+="@font-face { font-family: 'TinWhistleFingering'; src: url(data:font/truetype;charset=utf-8;base64,AAEAAAAOAIAAAwBgRkZUTXBCeEYAACXQAAAAHEdERUYASAAGAAAlsAAAACBPUy8yYmFjVAAAAWgAAABWY21hcGbEMvAAAAIAAAABkmN2dCAARAURAAADlAAAAARnYXNw//8AAwAAJagAAAAIZ2x5ZjcPuw8AAAPQAAAfFGhlYWQFzCAtAAAA7AAAADZoaGVhCdYA8gAAASQAAAAkaG10eAuFBggAAAHAAAAAPmxvY2FW+F8kAAADmAAAADhtYXhwAHIA1QAAAUgAAAAgbmFtZccVWP0AACLkAAACGXBvc3RkEEUZAAAlAAAAAKgAAQAAAAEAAC+9UnlfDzz1AAsIAAAAAADSAmq7AAAAANICarsARP8CAmQGuAAAAAgAAgAAAAAAAAABAAAGuP8CALgB6wAAAAACZAABAAAAAAAAAAAAAAAAAAAABAABAAAAGwCkABUAAAAAAAIAAAABAAEAAABAAC4AAAAAAAEB6wH0AAUACAUzBZkAAAEeBTMFmQAAA9cAZgISAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAQABBAG0Gzf7NALgGuAD+AAAAAQAAAAAAAAHrAEQAAAAAAesAAAHrAHsAewB7AHsAewB7AHsAewB7AHsAewB7AHsAewB7AHsAewB7AHsAewB7AHsAewB7AAAAAAADAAAAAwAAABwAAQAAAAAAjAADAAEAAAAcAAQAcAAAAAwACAACAAQAAABHAE0AZwBt//8AAAAAAEEASQBhAGn//wAAAAAAAAAAAAAAAQAAAAoAFgAeACoAAAAWABgAGQAPABEAEgAUABcAGgAQABMAFQAKAAwADQADAAUABgAIAAsADgAEAAcACQAAAQYAAAEAAAAAAAAAAQIAAAACAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFhgZDxESFAAXGhATFQAAAAAAAAAAAAAAAAAAAAAAAAAKDA0DBQYIAAsOBAcJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABEBREAAAAsACwALACSAQQBfAIAAooDJgPOBHwFNgX2BqQHdgf+CH4JBgmYCjIK3guUDFINGg3qDqgPigACAEQAAAJkBVUAAwAHAC6xAQAvPLIHBADtMrEGBdw8sgMCAO0yALEDAC88sgUEAO0ysgcGAfw8sgECAO0yMxEhESUhESFEAiD+JAGY/mgFVfqrRATNAAAABwB7/1QBcQa4AAAADAAYACQAMAA8AEgAABcRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiZ7SzA0R0swNEdLMDRHSzA0R0swNEdLMDRHSzA0R0swNEdLMDRHSzA0R0swNEdLMDRHrAEnNEdLMDRHSwFXNEdLMDRHSwFXNEdLMDRHSwFXNEZKMDRHSwFXNEZKMDRHSwFWNEdLMDRGSgAACQB7/1QBcQa4AAAADAATABQAIAAsADgARABQAAAXETQ2MzIWFRQGIyImNxQWMzI2NSMRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiZ7SzA0R0swNEcdPCIlOdlLMDRHSzA0R0swNEdLMDRHSzA0R0swNEdLMDRHSzA0R0swNEdLMDRHrAEnNEdLMDRHSzAlOTwiASc0R0swNEdLAVc0R0swNEdLAVc0RkowNEdLAVc0RkowNEdLAVY0R0swNEZKAAAACQB7/1QBcQa4AAAADAAYABkAJQAxAD0ASQBVAAAXETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGBxE0NjMyFhUUBiMiJhE0NjMyFhUUBiMiJhE0NjMyFhUUBiMiJhE0NjMyFhUUBiMiJhE0NjMyFhUUBiMiJntLMDRHSzA0Rx08IiU5PCIlOR1LMDRHSzA0R0swNEdLMDRHSzA0R0swNEdLMDRHSzA0R0swNEdLMDRHrAEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSwFXNEdLMDRHSwFXNEZKMDRHSwFXNEZKMDRHSwFWNEdLMDRGSgAACwB7/1QBcQa4AAAADAAYABkAJQAsAC0AOQBFAFEAXQAAFxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiY3FBYzMjY1IxE0NjMyFhUUBiMiJhE0NjMyFhUUBiMiJhE0NjMyFhUUBiMiJhE0NjMyFhUUBiMiJntLMDRHSzA0Rx08IiU5PCIlOR1LMDRHSzA0Rx08IiU52UswNEdLMDRHSzA0R0swNEdLMDRHSzA0R0swNEdLMDRHrAEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSzAlOTwiASc0R0swNEdLAVc0RkowNEdLAVc0RkowNEdLAVY0R0swNEZKAAAACwB7/1QBcQa4AAAADAAYABkAJQAxADIAPgBKAFYAYgAAFxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHETQ2MzIWFRQGIyImETQ2MzIWFRQGIyImETQ2MzIWFRQGIyImETQ2MzIWFRQGIyIme0swNEdLMDRHHTwiJTk8IiU5HUswNEdLMDRHHTwiJTk8IiU5HUswNEdLMDRHSzA0R0swNEdLMDRHSzA0R0swNEdLMDRHrAEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSwFXNEZKMDRHSwFXNEZKMDRHSwFWNEdLMDRGSgAADQB7/1QBcQa4AAAADAAYABkAJQAxADIAPgBKAEsAVwBjAG8AABcRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGBxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiZ7SzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEdLMDRHSzA0R0swNEdLMDRHrAEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSzAlOj0iJTk8IgEnNEZKMDRHSwFXNEZKMDRHSwFWNEdLMDRGSgAADwB7/1QBcQa4AAAADAAYABkAJQAxADIAPgBKAEsAVwBeAF8AawB3AAAXETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGBxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHETQ2MzIWFRQGIyImNxQWMzI2NSMRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiZ7SzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOdlLMDRHSzA0R0swNEdLMDRHrAEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSzAlOj0iJTk8IgEnNEZKMDRHSzAlOj0iASc0RkowNEdLAVY0R0swNEZKAAAADwB7/1QBcQa4AAAADAAYABkAJQAxADIAPgBKAEsAVwBjAGQAcAB8AAAXETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGBxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGBxE0NjMyFhUUBiMiJhE0NjMyFhUUBiMiJntLMDRHSzA0Rx08IiU5PCIlOR1LMDRHSzA0Rx08IiU5PCIlOR1LMDRHSzA0Rx08IiU5PCIlOR1LMDRHSzA0Rx08IiU5PCIlOR1LMDRHSzA0R0swNEdLMDRHrAEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSzAlOj0iJTk8IgEnNEZKMDRHSzAlOj0iJTk8IgEnNEZKMDRHSwFWNEdLMDRGSgAAEQB7/1QBcQa4AAAADAAYABkAJQAxADIAPgBKAEsAVwBjAGQAcAB3AHgAhAAAFxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGBxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiY3FBYzMjY1IxE0NjMyFhUUBiMiJntLMDRHSzA0Rx08IiU5PCIlOR1LMDRHSzA0Rx08IiU5PCIlOR1LMDRHSzA0Rx08IiU5PCIlOR1LMDRHSzA0Rx08IiU5PCIlOR1LMDRHSzA0Rx08IiU52UswNEdLMDRHrAEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSzAlOj0iJTk8IgEnNEZKMDRHSzAlOj0iJTk8IgEnNEZKMDRHSzAlOj0iASY0R0swNEZKAAAAEQB7/1QBcQa4AAAADAAYABkAJQAxADIAPgBKAEsAVwBjAGQAcAB8AH0AiQAAFxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGBxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHETQ2MzIWFRQGIyIme0swNEdLMDRHHTwiJTk8IiU5HUswNEdLMDRHHTwiJTk8IiU5HUswNEdLMDRHHTwiJTk8IiU5HUswNEdLMDRHHTwiJTk8IiU5HUswNEdLMDRHHTwiJTk8IiU5HUswNEdLMDRHrAEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSzAlOj0iJTk8IgEnNEZKMDRHSzAlOj0iJTk8IgEnNEZKMDRHSzAlOj0iJTk8IgEmNEdLMDRGSgAADwB7/1QBcQa4AAAADAAYABkAJQAxADIAPgBKAEsAVwBjAG8AewB8AAAXETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGBxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHETQ2MzIWFRQGIyImETQ2MzIWFRQGIyImETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGB3tLMDRHSzA0Rx08IiU5PCIlOR1LMDRHSzA0Rx08IiU5PCIlOR1LMDRHSzA0Rx08IiU5PCIlOR1LMDRHSzA0R0swNEdLMDRHSzA0R0swNEcdPCIlOTwiJTkdrAEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSzAlOj0iJTk8IgEnNEZKMDRHSwFXNEZKMDRHSwFWNEdLMDRGSjAlOTwiJTo9IgAAEwB7/1QBcQa4AAAADAAYABkAJQAxADIAPgBKAEsAVwBjAGQAcAB8AH0AiQCVAJYAABcRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGBxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGBxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgd7SzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdrAEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSzAlOj0iJTk8IgEnNEZKMDRHSzAlOj0iJTk8IgEnNEZKMDRHSzAlOj0iJTk8IgEmNEdLMDRGSjAlOTwiJTo9IgAACwB7/wIBcQa4AAAADAANABkAJQAxAD0ASQBVAGEAYgAAFzMVIzUjNTM1MxUzFSMRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHe5k9UlI9UutLMDRHSzA0R0swNEdLMDRHSzA0R0swNEdLMDRHSzA0R0swNEdLMDRHSzA0R0swNEcdPCIlOTwiJTkdrFJSPVJSPQEnNEdLMDRHSwFXNEdLMDRHSwFXNEdLMDRHSwFXNEZKMDRHSwFXNEZKMDRHSwFWNEdLMDRGSjAlOTwiJTo9IgAAAAALAHv/AgFxBrgAAAAMAA0AGQAgACEALQA5AEUAUQBdAAAXMxUjNSM1MzUzFTMVIxE0NjMyFhUUBiMiJjcUFjMyNjUjETQ2MzIWFRQGIyImETQ2MzIWFRQGIyImETQ2MzIWFRQGIyImETQ2MzIWFRQGIyImETQ2MzIWFRQGIyIme5k9UlI9UutLMDRHSzA0Rx08IiU52UswNEdLMDRHSzA0R0swNEdLMDRHSzA0R0swNEdLMDRHSzA0R0swNEesUlI9UlI9ASc0R0swNEdLMCU5PCIBJzRHSzA0R0sBVzRHSzA0R0sBVzRGSjA0R0sBVzRGSjA0R0sBVjRHSzA0RkoACwB7/wIBcQa4AAAADAANABkAJQAmADIAPgBKAFYAYgAAFzMVIzUjNTM1MxUzFSMRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHETQ2MzIWFRQGIyImETQ2MzIWFRQGIyImETQ2MzIWFRQGIyImETQ2MzIWFRQGIyImETQ2MzIWFRQGIyIme5k9UlI9UutLMDRHSzA0Rx08IiU5PCIlOR1LMDRHSzA0R0swNEdLMDRHSzA0R0swNEdLMDRHSzA0R0swNEdLMDRHrFJSPVJSPQEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSwFXNEdLMDRHSwFXNEZKMDRHSwFXNEZKMDRHSwFWNEdLMDRGSgAAAAANAHv/AgFxBrgAAAAMAA0AGQAlACYAMgA5ADoARgBSAF4AagAAFzMVIzUjNTM1MxUzFSMRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHETQ2MzIWFRQGIyImNxQWMzI2NSMRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiZ7mT1SUj1S60swNEdLMDRHHTwiJTk8IiU5HUswNEdLMDRHHTwiJTnZSzA0R0swNEdLMDRHSzA0R0swNEdLMDRHSzA0R0swNEesUlI9UlI9ASc0R0swNEdLMCU5PCIlOTwiASc0R0swNEdLMCU5PCIBJzRHSzA0R0sBVzRGSjA0R0sBVzRGSjA0R0sBVjRHSzA0RkoADQB7/wIBcQa4AAAADAANABkAJQAmADIAPgA/AEsAVwBjAG8AABczFSM1IzUzNTMVMxUjETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGBxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiZ7mT1SUj1S60swNEdLMDRHHTwiJTk8IiU5HUswNEdLMDRHHTwiJTk8IiU5HUswNEdLMDRHSzA0R0swNEdLMDRHSzA0R0swNEdLMDRHrFJSPVJSPQEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSwFXNEZKMDRHSwFXNEZKMDRHSwFWNEdLMDRGSgAAAAAPAHv/AgFxBrgAAAAMAA0AGQAlACYAMgA+AD8ASwBXAFgAZABwAHwAABczFSM1IzUzNTMVMxUjETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGBxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHETQ2MzIWFRQGIyImETQ2MzIWFRQGIyImETQ2MzIWFRQGIyIme5k9UlI9UutLMDRHSzA0Rx08IiU5PCIlOR1LMDRHSzA0Rx08IiU5PCIlOR1LMDRHSzA0Rx08IiU5PCIlOR1LMDRHSzA0R0swNEdLMDRHSzA0R0swNEesUlI9UlI9ASc0R0swNEdLMCU5PCIlOTwiASc0R0swNEdLMCU5PCIlOTwiASc0R0swNEdLMCU6PSIlOTwiASc0RkowNEdLAVc0RkowNEdLAVY0R0swNEZKAAAAABEAe/8CAXEGuAAAAAwADQAZACUAJgAyAD4APwBLAFcAWABkAGsAbAB4AIQAABczFSM1IzUzNTMVMxUjETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGBxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHETQ2MzIWFRQGIyImNxQWMzI2NSMRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiZ7mT1SUj1S60swNEdLMDRHHTwiJTk8IiU5HUswNEdLMDRHHTwiJTk8IiU5HUswNEdLMDRHHTwiJTk8IiU5HUswNEdLMDRHHTwiJTnZSzA0R0swNEdLMDRHSzA0R6xSUj1SUj0BJzRHSzA0R0swJTk8IiU5PCIBJzRHSzA0R0swJTk8IiU5PCIBJzRHSzA0R0swJTo9IiU5PCIBJzRGSjA0R0swJTo9IgEnNEZKMDRHSwFWNEdLMDRGSgARAHv/AgFxBrgAAAAMAA0AGQAlACYAMgA+AD8ASwBXAFgAZABwAHEAfQCJAAAXMxUjNSM1MzUzFTMVIxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGBxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiZ7mT1SUj1S60swNEdLMDRHHTwiJTk8IiU5HUswNEdLMDRHHTwiJTk8IiU5HUswNEdLMDRHHTwiJTk8IiU5HUswNEdLMDRHHTwiJTk8IiU5HUswNEdLMDRHSzA0R0swNEesUlI9UlI9ASc0R0swNEdLMCU5PCIlOTwiASc0R0swNEdLMCU5PCIlOTwiASc0R0swNEdLMCU6PSIlOTwiASc0RkowNEdLMCU6PSIlOTwiASc0RkowNEdLAVY0R0swNEZKAAAAABMAe/8CAXEGuAAAAAwADQAZACUAJgAyAD4APwBLAFcAWABkAHAAcQB9AIQAhQCRAAAXMxUjNSM1MzUzFTMVIxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGBxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiY3FBYzMjY1IxE0NjMyFhUUBiMiJnuZPVJSPVLrSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOdlLMDRHSzA0R6xSUj1SUj0BJzRHSzA0R0swJTk8IiU5PCIBJzRHSzA0R0swJTk8IiU5PCIBJzRHSzA0R0swJTo9IiU5PCIBJzRGSjA0R0swJTo9IiU5PCIBJzRGSjA0R0swJTo9IgEmNEdLMDRGSgATAHv/AgFxBrgAAAAMAA0AGQAlACYAMgA+AD8ASwBXAFgAZABwAHEAfQCJAIoAlgAAFzMVIzUjNTM1MxUzFSMRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGBxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGBxE0NjMyFhUUBiMiJnuZPVJSPVLrSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEesUlI9UlI9ASc0R0swNEdLMCU5PCIlOTwiASc0R0swNEdLMCU5PCIlOTwiASc0R0swNEdLMCU6PSIlOTwiASc0RkowNEdLMCU6PSIlOTwiASc0RkowNEdLMCU6PSIlOTwiASY0R0swNEZKAAAAABEAe/8CAXEGuAAAAAwADQAZACUAJgAyAD4APwBLAFcAWABkAHAAfACIAIkAABczFSM1IzUzNTMVMxUjETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGBxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHETQ2MzIWFRQGIyImETQ2MzIWFRQGIyImETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGB3uZPVJSPVLrSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEdLMDRHSzA0R0swNEdLMDRHHTwiJTk8IiU5HaxSUj1SUj0BJzRHSzA0R0swJTk8IiU5PCIBJzRHSzA0R0swJTk8IiU5PCIBJzRHSzA0R0swJTo9IiU5PCIBJzRGSjA0R0sBVzRGSjA0R0sBVjRHSzA0RkowJTk8IiU6PSIAAAAAFQB7/wIBcQa4AAAADAANABkAJQAmADIAPgA/AEsAVwBYAGQAcABxAH0AiQCKAJYAogCjAAAXMxUjNSM1MzUzFTMVIxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGBxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGB3uZPVJSPVLrSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdrFJSPVJSPQEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSzAlOj0iJTk8IgEnNEZKMDRHSzAlOj0iJTk8IgEnNEZKMDRHSzAlOj0iJTk8IgEmNEdLMDRGSjAlOTwiJTo9IgAAAAAAAAwAlgABAAAAAAABABUALAABAAAAAAACAAYAUAABAAAAAAADAC8AtwABAAAAAAAEABMBDwABAAAAAAAFAAsBOwABAAAAAAAGABMBbwADAAEECQABACoAAAADAAEECQACAAwAQgADAAEECQADAF4AVwADAAEECQAEACYA5wADAAEECQAFABYBIwADAAEECQAGACYBRwBUAGkAbgAgAFcAaABpAHMAdABsAGUAIABGAGkAbgBnAGUAcgBpAG4AZwAAVGluIFdoaXN0bGUgRmluZ2VyaW5nAABNAGUAZABpAHUAbQAATWVkaXVtAABGAG8AbgB0AEYAbwByAGcAZQAgADIALgAwACAAOgAgAFQAaQBuAFcAaABpAHMAdABsAGUARgBpAG4AZwBlAHIAaQBuAGcAIAA6ACAAMgA1AC0AOAAtADIAMAAxADUAAEZvbnRGb3JnZSAyLjAgOiBUaW5XaGlzdGxlRmluZ2VyaW5nIDogMjUtOC0yMDE1AABUAGkAbgBXAGgAaQBzAHQAbABlAEYAaQBuAGcAZQByAGkAbgBnAABUaW5XaGlzdGxlRmluZ2VyaW5nAABWAGUAcgBzAGkAbwBuACAAMQAuADAAAFZlcnNpb24gMS4wAABUAGkAbgBXAGgAaQBzAHQAbABlAEYAaQBuAGcAZQByAGkAbgBnAABUaW5XaGlzdGxlRmluZ2VyaW5nAAAAAAACAAAAAAAA/2cAZgAAAAEAAAAAAAAAAAAAAAAAAAAAABsAAAABAAIARwECAEgASQEDAEoBBABEAQUARQBGAQYAJwEHACgAKQEIACoBCQAkAQoAJQAmAQsHZC1zaGFycAdmLXNoYXJwB2ctc2hhcnAHYS1zaGFycAdjLXNoYXJwB0Qtc2hhcnAHRi1zaGFycAdHLXNoYXJwB0Etc2hhcnAHQy1zaGFycAAAAAH//wACAAEAAAAOAAAAGAAAAAAAAgABAAMAGgABAAQAAAACAAAAAAABAAAAAMw9os8AAAAA0gJquwAAAADSAmq7) format('truetype'); font-weight: normal; font-style: normal; }",gWhistleFontPrepared=!0}}function DoCeoltasTransform(t){t?sendGoogleAnalytics("tablature","DoCeoltasTransform_Inverse"):sendGoogleAnalytics("tablature","DoCeoltasTransform"),gTheABC.value=ceoltasABCTransformer(gTheABC.value,t,!1),gIsDirty=!0,RenderAsync(!0,null),IdleAdvancedControls(!0),IdleAllowShowTabNames()}function complianceABCTransformer(t,n){var o=["%pdfquality","%pdf_between_tune_space","%pdfname","%pdffont","%addtitle","%addsubtitle","%urladdtitle","%urladdsubtitle","%addtoc","%addsortedtoc","%addlinkbacktotoc","%tocheader","%toctopoffset","%toctitleoffset","%toctitlefontsize","%tocfontsize","%toclinespacing","%addindex","%addsortedindex","%addlinkbacktoindex","%indexheader","%indextopoffset","%indextitleoffset","%indextitlefontsize","%indexfontsize","%indexlinespacing","%no_toc_or_index_links","%toc_no_page_numbers","%index_no_page_numbers","%pageheader","%pagefooter","%urlpageheader","%urlpagefooter","%add_all_links_to_thesession","%add_all_playback_links","%add_all_playback_volumes","%playback_links_are_complete_tunebook","%add_all_fonts","%swing_all_hornpipes","%noswing_all_hornpipes","%no_edit_allowed","%qrcode","%qrcode","%caption_for_qrcode","%abcjs_soundfont","%hyperlink","%add_link_to_thesession","%add_playback_link","%swing","%noswing","%bodhran_tuning","%bodhran_pitch","%banjo_style","%grace_duration_ms","%roll_2_params","%roll_3_params","%use_original_abcjs_roll_solution","%abcjs_release_decay_time","%use_custom_gm_sounds","%disable_play_highlight","%play_highlight_v1_only","%irish_rolls_on","%irish_rolls_off","%voice_tuning_cents","%tab_first_voice_only","%tab_first_voice_exclude","%reverb","%links_open_in_editor"];if(n)t=t.replaceAll("%%abctt:","%");else{var a,r,l=o.length;for(a=0;a<l;++a)r="%%abctt:"+o[a].substring(1),t=t.replaceAll(o[a],r)}return t}function DoComplianceTransform(t){t?sendGoogleAnalytics("action","DoComplianceTransform_Inverse"):sendGoogleAnalytics("action","DoComplianceTransform"),gTheABC.value=complianceABCTransformer(gTheABC.value,t),gIsDirty=!0,RenderAsync(!0,null),IdleAdvancedControls(!0),IdleAllowShowTabNames()}function InjectOneBagpipeDrones(t,n,o,a,r,l){function s(t,n,o){return t.replace(/"[^"]*"|[^"]/g,t=>t.startsWith('"')?t:t.replace(RegExp(n,"g"),o))}function g(t){let n=t.lastIndexOf("-");return -1===n?t:t.slice(0,n)+t.slice(n+1)}function c(t,n){return t.replace(/([A-Ga-gzZ][',]?[\d*\/]?[',\/>]?)(\d*)/g,(t,o,a)=>{var r=function t(n){let o=n.match(/(\d+)/);return o?o[0]:""}(t);return -1!=t.indexOf("/")&&(r+="/"),-1!=t.indexOf(">")&&(r+=">"),`${n}${a||""}${r}-`})}var d,u,p="",m=!1,h="A";n>=6&&19!=n&&(h="D");var f=-1==t.indexOf("% Converted to ABC using bww2abc"),A=0;switch(l&&(A=function t(n){var o=getTuneRootKey(n);switch(o){case"B#":case"C":return 300;case"C#":case"Db":return 400;case"D":return 500;case"D#":case"Eb":return 600;case"E":case"Fb":return -500;case"E#":case"F":return -400;case"F#":case"Gb":return -300;case"G":return -200;case"G#":case"Ab":return -100;case"A":default:return 0;case"A#":case"Bb":return 100;case"B":case"Cb":return 200}}(t)),n){case 0:u="[A,,,, A,,,]",f?(m=a,A=148+A,p=a?" stems=auto transpose=0\n%%MIDI program 143\n%voice_tuning_cents 148 "+A:" stems=auto transpose=0\n%%MIDI program 109\n%voice_tuning_cents 148 "+A):p=" transpose=0\n%%MIDI program 109";break;case 1:u="[A,,,, A,,,]",A=100+A,f?(m=a,p=a?" stems=auto transpose=0\n%%MIDI program 143\n%voice_tuning_cents 100 "+A:" stems=auto transpose=0\n%%MIDI program 109\n%voice_tuning_cents 100 "+A):(t=t.replaceAll("%voice_tuning_cents 48 148","%voice_tuning_cents 0 100"),p=" transpose=0\n%%MIDI program 109");break;case 19:u="[A,,,, A,,,]",f?(m=a,A=54+A,p=a?" stems=auto transpose=0\n%%MIDI program 143\n%voice_tuning_cents 54 "+A:" stems=auto transpose=0\n%%MIDI program 109\n%voice_tuning_cents 54 "+A):(t=(t=t.replaceAll("transpose=1","transpose=0")).replaceAll("%voice_tuning_cents 48 148","%voice_tuning_cents 54 54"),p=" transpose=0\n%%MIDI program 109");break;case 2:u="[A,,,, A,,,]",f?(m=a,p=a?" stems=auto transpose=0\n%%MIDI program 143\n%voice_tuning_cents 0 "+A:" stems=auto transpose=0\n%%MIDI program 109\n%voice_tuning_cents 0 "+A):(t=(t=t.replaceAll("transpose=1","transpose=0")).replaceAll("%voice_tuning_cents 48 148","%voice_tuning_cents 0 0"),p=" transpose=0\n%%MIDI program 109");break;case 3:u="[A,,,, A,,,]",f?(m=a,A=500+A,p=a?" stems=auto transpose=0\n%%MIDI program 143\n%voice_tuning_cents -700 "+A:" stems=auto transpose=0\n%%MIDI program 109\n%voice_tuning_cents -700 "+A):(t=(t=t.replaceAll("transpose=1","transpose=0")).replaceAll("%voice_tuning_cents 48 148","%voice_tuning_cents -700 500"),p=" transpose=0\n%%MIDI program 109");break;case 4:u="D,,",f?(m=a,A<0&&(A+=1200),p=" stems=auto transpose=-7\n%%MIDI program 131\n%voice_tuning_cents 0 "+A):t=(t=(t=t.replaceAll("%%MIDI program 109","%%MIDI program 131")).replaceAll("transpose=1","transpose=-7")).replaceAll("%voice_tuning_cents 48 148","%voice_tuning_cents 0 0");break;case 5:u="D,,",f?(m=a,A<0&&(A+=1200),p=" stems=auto transpose=-7\n%%MIDI program 130\n%voice_tuning_cents 0 "+A):t=(t=(t=t.replaceAll("%%MIDI program 109","%%MIDI program 130")).replaceAll("transpose=1","transpose=-7")).replaceAll("%voice_tuning_cents 48 148","%voice_tuning_cents 0 0");break;case 6:u="D,,",l&&(A+=700)>500&&(A-=1200),f?(m=a,p=" stems=auto transpose=0\n%%MIDI program 132\n%voice_tuning_cents 0 "+A):t=(t=(t=t.replaceAll("%%MIDI program 109","%%MIDI program 132")).replaceAll("transpose=1","transpose=-7")).replaceAll("%voice_tuning_cents 48 148","%voice_tuning_cents 0 0");break;case 7:u="D,",l&&(A+=700)>500&&(A-=1200),f?p=" stems=auto transpose=0\n%%MIDI program 129\n%voice_tuning_cents 0 "+A:t=(t=(t=t.replaceAll("%%MIDI program 109","%%MIDI program 129")).replaceAll("transpose=1","transpose=-7")).replaceAll("%voice_tuning_cents 48 148","%voice_tuning_cents 0 0");break;case 8:u="E,",l&&(A+=700)>500&&(A-=1200),f?p=" stems=auto transpose=0\n%%MIDI program 129\n%voice_tuning_cents 0 "+A:t=(t=(t=t.replaceAll("%%MIDI program 109","%%MIDI program 129")).replaceAll("transpose=1","transpose=-7")).replaceAll("%voice_tuning_cents 48 148","%voice_tuning_cents 0 0");break;case 9:u="D,",A-=100,l&&(A+=700)>500&&(A-=1200),f?p=" stems=auto transpose=0\n%%MIDI program 129\n%voice_tuning_cents -100 "+A:t=(t=(t=t.replaceAll("%%MIDI program 109","%%MIDI program 129")).replaceAll("transpose=1","transpose=-7")).replaceAll("%voice_tuning_cents 48 148","%voice_tuning_cents -100 -100");break;case 10:u="E,",A-=100,l&&(A+=700)>500&&(A-=1200),f?p=" stems=auto transpose=0\n%%MIDI program 129\n%voice_tuning_cents -100 "+A:t=(t=(t=t.replaceAll("%%MIDI program 109","%%MIDI program 129")).replaceAll("transpose=1","transpose=-7")).replaceAll("%voice_tuning_cents 48 148","%voice_tuning_cents -100 -100");break;case 11:u="D,",A-=200,l&&(A+=700)>500&&(A-=1200),f?p=" stems=auto transpose=0\n%%MIDI program 129\n%voice_tuning_cents -200 "+A:t=(t=(t=t.replaceAll("%%MIDI program 109","%%MIDI program 129")).replaceAll("transpose=1","transpose=-7")).replaceAll("%voice_tuning_cents 48 148","%voice_tuning_cents -200 -200");break;case 12:u="E,",A-=200,l&&(A+=700)>500&&(A-=1200),f?p=" stems=auto transpose=0\n%%MIDI program 129\n%voice_tuning_cents -200 "+A:t=(t=(t=t.replaceAll("%%MIDI program 109","%%MIDI program 129")).replaceAll("transpose=1","transpose=-7")).replaceAll("%voice_tuning_cents 48 148","%voice_tuning_cents -200 -200");break;case 13:u="D,",A-=300,l&&(A+=700)>500&&(A-=1200),f?p=" stems=auto transpose=0\n%%MIDI program 129\n%voice_tuning_cents -300 "+A:t=(t=(t=t.replaceAll("%%MIDI program 109","%%MIDI program 129")).replaceAll("transpose=1","transpose=-7")).replaceAll("%voice_tuning_cents 48 148","%voice_tuning_cents -300 -300");break;case 14:u="E,",A-=300,l&&(A+=700)>500&&(A-=1200),f?p=" stems=auto transpose=0\n%%MIDI program 129\n%voice_tuning_cents -300 "+A:t=(t=(t=t.replaceAll("%%MIDI program 109","%%MIDI program 129")).replaceAll("transpose=1","transpose=-7")).replaceAll("%voice_tuning_cents 48 148","%voice_tuning_cents -300 -300");break;case 15:u="D,",A-=400,l&&(A+=700)>500&&(A-=1200),f?p=" stems=auto transpose=0\n%%MIDI program 129\n%voice_tuning_cents -400 "+A:t=(t=(t=t.replaceAll("%%MIDI program 109","%%MIDI program 129")).replaceAll("transpose=1","transpose=-7")).replaceAll("%voice_tuning_cents 48 148","%voice_tuning_cents -400 -400");break;case 16:u="E,",A-=400,l&&(A+=700)>500&&(A-=1200),f?p=" stems=auto transpose=0\n%%MIDI program 129\n%voice_tuning_cents -400 "+A:t=(t=(t=t.replaceAll("%%MIDI program 109","%%MIDI program 129")).replaceAll("transpose=1","transpose=-7")).replaceAll("%voice_tuning_cents 48 148","%voice_tuning_cents -400 -400");break;case 17:u="D,",A-=500,l&&(A+=700)>500&&(A-=1200),f?p=" stems=auto transpose=0\n%%MIDI program 129\n%voice_tuning_cents -500 "+A:t=(t=(t=t.replaceAll("%%MIDI program 109","%%MIDI program 129")).replaceAll("transpose=1","transpose=-7")).replaceAll("%voice_tuning_cents 48 148","%voice_tuning_cents -500 -500");break;case 18:u="E,",A-=500,l&&(A+=700)>500&&(A-=1200),f?p=" stems=auto transpose=0\n%%MIDI program 129\n%voice_tuning_cents -500 "+A:t=(t=(t=t.replaceAll("%%MIDI program 109","%%MIDI program 129")).replaceAll("transpose=1","transpose=-7")).replaceAll("%voice_tuning_cents 48 148","%voice_tuning_cents -500 -500")}if(d=(d=(d=o?InjectStringBelowTuneHeader(t,"%\n%%score (1 2)\n%\n%play_highlight_v1_only\n%\nV:1"+p):InjectStringBelowTuneHeader(t,"%\n%%score 1 2\n%\n%play_highlight_v1_only\n%\nV:1"+p)).replace(/^\s*[\r\n]/gm,"")).trim(),m&&(d=function t(n,o){for(var a,r=n,l=JustTheNotes(n),g=l.split("\n"),c=g.length,d=!1,u="",p=0;p<c;++p){if(0!=(a=g[p]).indexOf("%")&&-1==a.indexOf("V:"))switch(d=!0,o){case"A":a=s(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=a.replaceAll("C,,","c")).replaceAll("D,,","d")).replaceAll("E,,","e")).replaceAll("F,,","f")).replaceAll("G,,","G")).replaceAll("A,,","A")).replaceAll("B,,","B")).replaceAll("C,","c")).replaceAll("D,","d")).replaceAll("E,","e")).replaceAll("F,","f")).replaceAll("G,","G")).replaceAll("A,","A")).replaceAll("B,","B"),"C","c"),a=s(a,"D","d"),a=s(a,"E","e"),a=(a=(a=(a=(a=(a=(a=(a=(a=s(a,"F","f")).replaceAll("b","B")).replaceAll("c'","c")).replaceAll("d'","d")).replaceAll("e'","e")).replaceAll("f'","f")).replaceAll("g'","g")).replaceAll("a'","a")).replaceAll("b'","b");break;case"D":a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=a.replaceAll("C,,","C")).replaceAll("D,,","D")).replaceAll("E,,","E")).replaceAll("F,,","F")).replaceAll("G,,","G")).replaceAll("A,,","A")).replaceAll("B,,","B")).replaceAll("C,","C")).replaceAll("D,","D")).replaceAll("E,","E")).replaceAll("F,","F")).replaceAll("G,","G")).replaceAll("A,","A")).replaceAll("B,","B")).replaceAll("e","E")).replaceAll("f","F")).replaceAll("g","G")).replaceAll("a","A")).replaceAll("b","B")).replaceAll("c'","C")).replaceAll("d'","D")}u+=a+"\n"}return d?(u=u.trim(),r.replace(l,u)):r}(d,h)),r){d+="\n%\n% Injected drones\n%\n";var b,T=JustTheNotes(t);T=StripTabOne(T=StripChordsOne(T=StripTextAnnotationsOne(T=(b=T).split("\n").filter(t=>!t.trim().startsWith("%")).join("\n"))));var y=(T=StripOrnamentsOne(T,!1)).split("\n"),I=y.length,v="",C="!mf! ";switch(n){case 0:case 1:case 2:case 3:case 19:o?v+="V:2 stems=down octave=4 transpose=-48\n%%MIDI program 109\n%%MIDI transpose -48\n%%voicecolor transparent\n":v+="V:2 stems=down octave=4 transpose=-48\n%%MIDI program 109\n%%MIDI transpose -48\n";break;case 4:o?v+="V:2 stems=down octave=3 transpose=-36\n%%MIDI program 131\n%%MIDI transpose -36\n%%voicecolor transparent\n":v+="V:2 stems=down octave=3 transpose=-36\n%%MIDI program 131\n%%MIDI transpose -36\n",C="!pp! ";break;case 5:o?v+="V:2 stems=down octave=3 transpose=-36\n%%MIDI program 130\n%%MIDI transpose -36\n%%voicecolor transparent\n":v+="V:2 stems=down octave=3 transpose=-36\n%%MIDI program 130\n%%MIDI transpose -36\n",C="!pp! ";break;case 6:o?v+="V:2 stems=down octave=3 transpose=-36\n%%MIDI program 132\n%%MIDI transpose -36\n%%voicecolor transparent\n":v+="V:2 stems=down octave=3 transpose=-36\n%%MIDI program 132\n%%MIDI transpose -36\n",C="!pp! ";break;case 7:case 9:case 11:case 13:case 15:case 17:o?v+="V:2 stems=down octave=2 transpose=-24\n%%MIDI program 129\n%%MIDI transpose -24\n%%voicecolor transparent\n":v+="V:2 stems=down octave=2 transpose=-24\n%%MIDI program 129\n%%MIDI transpose -24\n",C="!p! ";break;case 8:case 10:case 12:case 14:case 16:case 18:o?v+="V:2 stems=down octave=2 transpose=-24\n%%MIDI program 129\n%%MIDI transpose -24\n%%voicecolor transparent\n":v+="V:2 stems=down octave=2 transpose=-24\n%%MIDI program 129\n%%MIDI transpose -24\n",C="!mp! "}for(var S=!1,_=0;_<I;++_){var B=y[_];""==(B=c(B,u))||S||(B=C+B,S=!0),v+=B,v+="\n"}d+=v}return d.trim()}var gLastInjectedBagpipeSound=0;function InjectBagpipeSounds(){if(gRenderingPDF)return;findSelectedTuneIndex();let t={hidedronevoice:!0,injectalltunes:!0,dronestyle:gLastInjectedBagpipeSound,transposemelody:!1,foldnotes:!0,injectdronevoice:!0,matchtunekey:!1};DayPilot.Modal.form([{html:'<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">Inject Bagpipe Sounds<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/app/userguide.html#advanced_injectbagpipesounds" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="margin-top:18px;margin-bottom:18px;font-size:12pt;line-height:16pt;font-family:helvetica;">Clicking "OK" will change the melody sound to the selected bagpipe instrument and optionally inject drones as a second voice of the tune(s).</p>'},{html:'<p style="margin-top:18px;margin-bottom:18px;font-size:12pt;line-height:16pt;font-family:helvetica;">Bagpipe tunes imported from a BWW files assume the drones are consonant with the note A in the ABC notation for all styles of injected bagpipes.</p>'},{html:'<p style="margin-top:18px;margin-bottom:18px;font-size:12pt;line-height:16pt;font-family:helvetica;">For all other tunes, the Great Highland Bagpipe, Border Pipes, and Smallpipes drones are consonant with the note A in the ABC notation and the S\xe4ckpipa, and Uilleann Pipes drones are consonant with the note D in the ABC notation.</p>'},{html:'<p style="margin-top:18px;margin-bottom:18px;font-size:12pt;line-height:16pt;font-family:helvetica;">In these cases, you may need to transpose your tunes before using this feature to sound best with the drones, for example transposing a D Mixolydian tune to A Mixolydian or the inverse.</p>'},{html:'<p style="margin-top:18px;margin-bottom:18px;font-size:12pt;line-height:16pt;font-family:helvetica;">Tunes previously injected with drones will be skipped.</p>'},{name:"Bagpipe style to inject:",id:"dronestyle",type:"select",options:[{name:"  Great Highland Bagpipe - A=480 Hz (Pipe band high pitch)",id:0},{name:"  Great Highland Bagpipe - A=466 Hz (Standard B-flat)",id:1},{name:"  Great Highland Bagpipe - A=454 Hz (Practice chanter)",id:19},{name:"  Border Pipes in A - A=440 Hz",id:2},{name:"  Border Pipes in D",id:3},{name:"  Smallpipes in A",id:4},{name:"  Smallpipes in D",id:5},{name:"  Swedish S\xe4ckpipa in D",id:6},{name:"  Uilleann Pipes in D (Crowley-style drones)",id:7},{name:"  Uilleann Pipes in D (Lynch-style drones)",id:8},{name:"  Uilleann Pipes Flat Set in C# (Crowley-style drones)",id:9},{name:"  Uilleann Pipes Flat Set in C# (Lynch-style drones)",id:10},{name:"  Uilleann Pipes Flat Set in C (Crowley-style drones)",id:11},{name:"  Uilleann Pipes Flat Set in C (Lynch-style drones)",id:12},{name:"  Uilleann Pipes Flat Set in B (Crowley-style drones)",id:13},{name:"  Uilleann Pipes Flat Set in B (Lynch-style drones)",id:14},{name:"  Uilleann Pipes Flat Set in Bb (Crowley-style drones)",id:15},{name:"  Uilleann Pipes Flat Set in Bb (Lynch-style drones)",id:16},{name:"  Uilleann Pipes Flat Set in A (Crowley-style drones)",id:17},{name:"  Uilleann Pipes Flat Set in A (Lynch-style drones)",id:18}],cssClass:"configure_drones_select"},{name:"          Fold the displayed and played notes into the chanter range",id:"foldnotes",type:"checkbox",cssClass:"configure_injectdrones_form_text"},{html:'<p style="margin-top:18px;margin-bottom:12px;font-size:12pt;line-height:12pt;font-family:helvetica;">Note: Smallpipes and S\xe4ckpipa always fold played notes into the chanter range.</p>'},{name:"          Inject drones",id:"injectdronevoice",type:"checkbox",cssClass:"configure_injectdrones_form_text"},{name:"          Shift drone pitch to match tune key (non-BWW imported tunes only)",id:"matchtunekey",type:"checkbox",cssClass:"configure_injectdrones_form_text"},{name:"          Hide drone voice",id:"hidedronevoice",type:"checkbox",cssClass:"configure_injectdrones_form_text"},{name:"          Inject all tunes",id:"injectalltunes",type:"checkbox",cssClass:"configure_injectdrones_form_text"},],t,{theme:"modal_flat",top:75,width:685,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(t){if(sendGoogleAnalytics("action","InjectBagpipeSounds"),!t.canceled){var n=t.result.injectalltunes;gLastInjectedBagpipeSound=t.result.dronestyle;var o=!1,a=0;if(n){for(var r=CountTunes(),l=FindPreTuneHeader(gTheABC.value),s=0;s<r;++s){var g=getTuneByIndex(s);-1!=g.indexOf("% Injected drones")||isSectionHeader(g)||isMultiVoiceTune(g)||(g=InjectOneBagpipeDrones(g,t.result.dronestyle,t.result.hidedronevoice,t.result.foldnotes,t.result.injectdronevoice,t.result.matchtunekey),o=!0),l+=(g=g.trim())+"\n\n"}if(o)gTheABC.value=l,gIsDirty=!0,RenderAsync(!0,null,function(){gRawLastIndex=-1,DayPilot.Modal.alert('<p style="text-align:center;font-size:14pt;font-family:helvetica;">Inject Bagpipe Sounds Complete!</p>',{theme:"modal_flat",top:300,width:500,scrollWithPage:AllowDialogsToScroll()}).then(function(){gCurrentTune=0,gTheABC.selectionStart=0,gTheABC.selectionEnd=0,FocusAfterOperation()})});else{var c='<p style="text-align:center;font-size:14pt;font-family:helvetica;">Inject Bagpipe Sounds Complete!</p>';DayPilot.Modal.alert(c,{theme:"modal_flat",top:300,width:500,scrollWithPage:AllowDialogsToScroll()})}}else{a=findSelectedTuneIndex();var d=findSelectedTune();if(""==d)return;var u=d;if(-1!=u.indexOf("% Injected drones")||isSectionHeader(u)||isMultiVoiceTune(u)||(u=InjectOneBagpipeDrones(u,t.result.dronestyle,t.result.hidedronevoice,t.result.foldnotes,t.result.injectdronevoice,t.result.matchtunekey),o=!0),o){u=u.trim();var p=gTheABC.value;p=p.replace(d,u),gTheABC.value=p,gIsDirty=!0,RenderAsync(!0,a,function(){gRawLastIndex=-1,DayPilot.Modal.alert('<p style="text-align:center;font-size:14pt;font-family:helvetica;">Inject Bagpipe Sounds Complete!</p>',{theme:"modal_flat",top:300,width:500,scrollWithPage:AllowDialogsToScroll()}).then(function(){var t=gTheABC.selectionStart;gCurrentTune=a,gTheABC.selectionStart=t,gTheABC.selectionEnd=t,FocusAfterOperation()})})}else{var c='<p style="text-align:center;font-size:14pt;font-family:helvetica;">Inject Bagpipe Sounds Complete!</p>';DayPilot.Modal.alert(c,{theme:"modal_flat",top:300,width:500,scrollWithPage:AllowDialogsToScroll()})}}}})}function DoComplianceTransformDialog(){var t='<p style="text-align:center;margin-bottom:36px;font-size:16pt;font-family:helvetica;margin-left:15px;">ABC Directive Compliance Transform&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/app/userguide.html#advanced_compliance" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>';t+='<p style="text-align:center;"><input id="compliancedialog" class="advancedcontrols btn btn-injectcontrols" onclick="DoComplianceTransform(false)" type="button" value="Private Directives to ABC Compliant" title="Transforms private tool directives to %%abctt: ABC standard application-specific private directives">',t+='<input id="compliancedialoginverse" class="advancedcontrols btn btn-injectcontrols" onclick="DoComplianceTransform(true)" type="button" value="ABC Compliant to Private Directives" title="Transforms ABC standard application-specific private %%abctt: directives to private tool directives"></p>',DayPilot.Modal.alert(t,{theme:"modal_flat",top:200,width:650,scrollWithPage:AllowDialogsToScroll()})}function DoCeoltasTransformDialog(){var t='<p style="text-align:center;margin-bottom:36px;font-size:16pt;font-family:helvetica;margin-left:15px;">Comhaltas ABC Transform&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/app/userguide.html#advanced_comhaltas" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>';t+='<p style="text-align:center;"><input id="ceoltasdialog" class="advancedcontrols btn btn-injectcontrols" onclick="DoCeoltasTransform(false)" type="button" value="Standard ABC to Comhaltas ABC" title="Transforms the standard ABC format to Comhaltas format">',t+='<input id="ceoltasdialoginverse" class="advancedcontrols btn btn-injectcontrols" onclick="DoCeoltasTransform(true)" type="button" value="Comhaltas ABC to Standard ABC" title="Transforms the Comhaltas format to standard ABC format"></p>',DayPilot.Modal.alert(t,{theme:"modal_flat",top:200,width:650,scrollWithPage:AllowDialogsToScroll()})}function TuneTitlesNumbersDialog(){var t='<p style="text-align:center;margin-bottom:36px;font-size:16pt;font-family:helvetica;margin-left:15px;">Add/Remove Tune Title Numbers&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/app/userguide.html#advanced_injecttunetitlenumbers" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>';t+='<p style="text-align:center;"><input id="addtunetitlenumbers" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AddTuneTitleNumbers()" type="button" value="Add Numbers to Tune Titles" title="Adds incrementing numbers to the tune titles">',t+='<input id="removetunetitlenumbers" class="advancedcontrols btn btn-injectcontrols" onclick="RemoveTuneTitleNumbers(true)" type="button" value="Remove Tune Title Numbers" title="Removes any tune title numbers that were added"></p>',DayPilot.Modal.alert(t,{theme:"modal_flat",top:200,width:650,scrollWithPage:AllowDialogsToScroll()})}var gIncipitsBuilderBars=3,gIncipitsBuilderWidth=400,gIncipitsBuilderLeftJustify=!0,gIncipitsBuilderInjectNumbers=!0;function IncipitsBuilderDialog(){let t={IncipitsBuilderBars:gIncipitsBuilderBars,IncipitsBuilderWidth:gIncipitsBuilderWidth,IncipitsBuilderLeftJustify:gIncipitsBuilderLeftJustify,IncipitsBuilderInjectNumbers:gIncipitsBuilderInjectNumbers};DayPilot.Modal.form([{html:'<p style="text-align:center;font-size:16pt;font-family:helvetica;margin-bottom:24px;margin-left:15px;">Incipits Builder&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/app/userguide.html#incipits_builder" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="font-size:12pt;line-height:18pt;font-family:helvetica;">Clicking OK will extensively reformat the ABC, so you may want to grab a Snapshot or save the ABC before using this feature.</p>'},{html:'<p style="font-size:12pt;line-height:18pt;font-family:helvetica;margin-bottom:24px;">The reformatted ABC can be exported as first-line Notes Incipits from the Export PDF dialog.</p>'},{name:"Number of bars: (Default is 3)",id:"IncipitsBuilderBars",type:"number",cssClass:"incipits_builder_form_text"},{name:"Staff width: (Default is 400, full width is 556)",id:"IncipitsBuilderWidth",type:"number",cssClass:"incipits_builder_form_text"},{name:"    Left justify incipits titles. Requires manual reset after in the Settings.",id:"IncipitsBuilderLeftJustify",type:"checkbox",cssClass:"incipits_builder_form_text_checkbox"},{name:"    Add numbers before titles",id:"IncipitsBuilderInjectNumbers",type:"checkbox",cssClass:"incipits_builder_form_text_checkbox"},],t,{theme:"modal_flat",top:200,width:600,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(t){if(!t.canceled){sendGoogleAnalytics("action","IncipitsBuilder");var n,o=parseInt(gIncipitsBuilderBars=t.result.IncipitsBuilderBars);isNaN(o)&&(o=3,gIncipitsBuilderBars=3);var a=parseInt(gIncipitsBuilderWidth=t.result.IncipitsBuilderWidth);isNaN(a)&&(a=400,gIncipitsBuilderWidth=400),gIncipitsBuilderLeftJustify=t.result.IncipitsBuilderLeftJustify,gIncipitsBuilderInjectNumbers=t.result.IncipitsBuilderInjectNumbers;var r=CountTunes();if(0==r){var l="No tunes for incipits building.";l=makeCenteredPromptString(l),DayPilot.Modal.alert(l,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});return}for(var s=gTheABC.value,g=s.split(/^X:/gm),c=FindPreTuneHeader(s),d=1;d<=r;++d){c+=InjectStringBelowTuneHeader("X:"+g[d],"%incipits_inject_start\n%%noexpandtowidest\n%%barsperstaff "+o+"\n%%staffwidth "+a+"\n%incipits_inject_end")}if(gTheABC.value=c,gIncipitsBuilderLeftJustify&&(gForceLeftJustifyTitles=!0),gIncipitsBuilderInjectNumbers){var s=RemoveTuneTitleNumbers(!1);gTheABC.value=s;var u=processTuneTitleNumbers(r,s);gTheABC.value=u}RenderAsync(!0,null)}})}function cleanTitleNumber(t){return t.replace(/^[0-9.]+/,"")}function processTuneTitleNumbers(t,n){var o,a=FindPreTuneHeader(n);""!=a&&(a+="\n");var r=0;for(o=0;o<t;++o){var l=getTuneByIndex(o);if(isSectionHeader(l)){a+="\n",a+=l,a+="\n";continue}r++;let s=l.split("\n");var g=!1,c="";for(let d=0;d<s.length;d++){let u=s[d];!g&&(u.startsWith("T: ")&&(u="T: "+r+". "+(u=(u=u.replace("T:","")).trim()),g=!0),!g&&u.startsWith("T:")&&(u="T:"+r+". "+(u=(u=u.replace("T:","")).trim()),g=!0)),c+=u,c+="\n"}a+=c}return a.replaceAll("\n\n","\n")}function AddTuneTitleNumbers(){var t=CountTunes();if(0==t){var n="No tunes to add tune title numbers.";n=makeCenteredPromptString(n),DayPilot.Modal.alert(n,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});return}sendGoogleAnalytics("action","AddTuneTitleNumbers");var o=RemoveTuneTitleNumbers(!1);gTheABC.value=o,result=processTuneTitleNumbers(t,o),gTheABC.value=result,gIsDirty=!0;var a=document.getElementById("addtunetitlenumbers");a&&(a.value="Adding Tune Title Numbers"),RenderAsync(!0,null,function(){var t=document.getElementById("addtunetitlenumbers");t&&(t.value="Tune Title Numbers Added",setTimeout(function(){var t=document.getElementById("addtunetitlenumbers");t&&(t.value="Add Numbers to Tune Titles")},750))})}function RemoveTuneTitleNumbers(t){var n,o=gTheABC.value,a=CountTunes();if(t){if(0==a){var r="No tunes with title numbers to remove.";r=makeCenteredPromptString(r),DayPilot.Modal.alert(r,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});return}sendGoogleAnalytics("action","RemoveTuneTitleNumbers")}var l=FindPreTuneHeader(o);""!=l&&(l+="\n");var s=!1;for(n=0;n<a;++n){var g=getTuneByIndex(n);if(isSectionHeader(g)){l+="\n",l+=g,l+="\n";continue}let c=g.split("\n");var d=!1,u="";for(let p=0;p<c.length;p++){let m=c[p];if(!d){if(m.startsWith("T: ")){var h=m;m="T: "+(m=(m=cleanTitleNumber(m=(m=m.replace("T:","")).trim())).trim()),d=!0,h!=m&&(s=!0)}if(!d&&m.startsWith("T:")){var h=m;m="T:"+(m=(m=cleanTitleNumber(m=(m=m.replace("T:","")).trim())).trim()),d=!0,h!=m&&(s=!0)}}u+=m,u+="\n"}l+=u}if(l=l.replaceAll("\n\n","\n"),!t)return l;if(s){gTheABC.value=l,gIsDirty=!0;var f=document.getElementById("removetunetitlenumbers");f&&(f.value="Removing Tune Title Numbers"),RenderAsync(!0,null,function(){var t=document.getElementById("removetunetitlenumbers");t&&(t.value="Tune Title Numbers Removed",setTimeout(function(){var t=document.getElementById("removetunetitlenumbers");t&&(t.value="Remove Added Tune Title Numbers")},750))})}}function DoInjectTablature_BC(){sendGoogleAnalytics("tablature","Inject_BC"),SetRadioValue("notenodertab","noten"),gCurrentTab="noten",gInjectTab_BoxStyle="0",gTheABC.value=boxTabGenerator(gTheABC.value),gIsDirty=!0,gStripTab=!1,RenderAsync(!0,null),IdleAdvancedControls(!0),IdleAllowShowTabNames()}function DoInjectTablature_CsD(){sendGoogleAnalytics("tablature","Inject_CsD"),SetRadioValue("notenodertab","noten"),gCurrentTab="noten",gInjectTab_BoxStyle="1",gTheABC.value=boxTabGenerator(gTheABC.value),gIsDirty=!0,gStripTab=!1,RenderAsync(!0,null),IdleAdvancedControls(!0),IdleAllowShowTabNames()}function DoInjectTablature_Anglo(){sendGoogleAnalytics("tablature","Inject_Anglo"),SetRadioValue("notenodertab","noten"),gCurrentTab="noten",angloFingeringsGenerator(gTheABC.value,function t(n,o,a){o?DayPilot.Modal.alert(a,{theme:"modal_flat",top:100,scrollWithPage:!0}).then(function(){gTheABC.value=n,gIsDirty=!0,gStripTab=!1,RenderAsync(!0,null),IdleAdvancedControls(!0),IdleAllowShowTabNames()}):(gTheABC.value=n,gIsDirty=!0,gStripTab=!1,RenderAsync(!0,null),IdleAdvancedControls(!0),IdleAllowShowTabNames())})}function DoInjectTablature_Bamboo_Flute(){sendGoogleAnalytics("tablature","Inject_Bamboo_Flute");let t={configure_bamboo_flute_key:gBambooFluteKey};DayPilot.Modal.form([{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Inject Bamboo Flute Tablature&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://en.m.wikipedia.org/wiki/Numbered_musical_notation" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="margin-top:36px;margin-bottom:36px;font-size:12pt;line-height:18pt;font-family:helvetica">This will inject numeric notation tablature for a bamboo flute in the key selected below into all of the tunes in the ABC text area:</p>'},{name:"Bamboo flute key:",id:"configure_bamboo_flute_key",type:"select",options:[{name:"  C",id:"0"},{name:"  D",id:"1"},{name:"  G",id:"2"},{name:"  A",id:"3"},],cssClass:"configure_box_settings_select"},{html:'<p style="margin-top:24px;font-size:12pt;line-height:18pt;font-family:helvetica">&nbsp;</p>'},],t,{theme:"modal_flat",top:200,width:500,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(t){t.canceled||(gBambooFluteKey=t.result.configure_bamboo_flute_key,SaveConfigurationSettings(),SetRadioValue("notenodertab","noten"),gCurrentTab="noten",gTheABC.value=bambooFluteTabGenerator(gTheABC.value),gIsDirty=!0,gStripTab=!1,RenderAsync(!0,null),IdleAdvancedControls(!0),IdleAllowShowTabNames())})}function DoInjectTablature_Fiddle_Fingerings_Dialog(){var t='<p style="text-align:center;margin-bottom:36px;font-size:16pt;font-family:helvetica;margin-left:15px;">Inject Fiddle Fingerings&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/app/userguide.html#tab_fiddle" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>';t+='<p style="text-align:center;"><input id="fiddlefingeringsdialog" class="advancedcontrols btn btn-injectcontrols" onclick="DoInjectTablature_Fiddle_Fingerings(0)" type="button" value="Finger Number Only" title="Injects finger number (0, 1, 2, 3, 4) only.&nbsp;&nbsp;0 is an open string."></p>',t+='<p style="text-align:center;"><input id="fiddlefingeringsdialog2" class="advancedcontrols btn btn-injectcontrols" onclick="DoInjectTablature_Fiddle_Fingerings(1)" type="button" value="String Name + Finger Number (Inline)" title="Injects string name (G, D, A, E) + finger number (0, 1, 2, 3, 4) together on one line.&nbsp;&nbsp;0 is an open string."></p>',t+='<p style="text-align:center;"><input id="fiddlefingeringsdialog3" class="advancedcontrols btn btn-injectcontrols" onclick="DoInjectTablature_Fiddle_Fingerings(2)" type="button" value="String Name + Finger Number (Name over Number)" title="Injects string name (G, D, A, E) + finger number (0, 1, 2, 3, 4) stacked vertically Name over Number.&nbsp;&nbsp;0 is an open string."></p>',t+='<p style="text-align:center;"><input id="fiddlefingeringsdialog4" class="advancedcontrols btn btn-injectcontrols" onclick="DoInjectTablature_Fiddle_Fingerings(3)" type="button" value="String Name + Finger Number (Number over Name)" title="Injects string name (G, D, A, E) + finger number (0, 1, 2, 3, 4) stacked vertically Number over Name.&nbsp;&nbsp;0 is an open string."></p>',DayPilot.Modal.alert(t,{theme:"modal_flat",top:200,width:650,scrollWithPage:AllowDialogsToScroll()})}function DoInjectTablature_Fiddle_Fingerings(t){sendGoogleAnalytics("tablature","Inject_Fiddle_Fingerings"),SetRadioValue("notenodertab","noten"),gCurrentTab="noten",gTheABC.value=fiddleFingeringsGenerator(gTheABC.value,t),gIsDirty=!0,gStripTab=!1,RenderAsync(!0,null),IdleAdvancedControls(!0),IdleAllowShowTabNames()}function ShowMDTabWarningDialog(){sendGoogleAnalytics("dialog","ShowMDTabWarningDialog");var t='<p style="text-align:center;font-size:18pt;font-family:helvetica;">Some Tunes Did Not Have Complete Tab Solutions</p>';t+='<p style="font-size:12pt;line-height:18pt;margin-top:36px;">During the tablature generation the following tunes did not have complete tablature solutions and as requested were excluded from the result:</p>';var n=gExcludedFromMDSolution.length;t+='<p style="font-size:12pt;line-height:18pt;">';for(var o=0;o<n-1;++o)t+=gExcludedFromMDSolution[o]+", ";t+=gExcludedFromMDSolution[n-1],t+="</p>",DayPilot.Modal.alert(t,{theme:"modal_flat",top:75,width:630,scrollWithPage:AllowDialogsToScroll()}).then(function(){gExcludedFromMDSolution=[]})}var gExcludedFromMDSolution=[];function DoInjectTablature_MD(){sendGoogleAnalytics("tablature","Inject_MD");let t={configure_dulcimer_style:gMDulcimerStyle,open_string_symbol:gMDulcimerUseDashForOpenString,strip_bad_tunes:gMDulcimerStripBadTunes};DayPilot.Modal.form([{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Inject Mountain Dulcimer Tablature&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/app/userguide.html#tab_dulcimer" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="margin-top:36px;margin-bottom:36px;font-size:12pt;line-height:18pt;font-family:helvetica">This will inject tablature for a DAD, DGD, or DAA-tuned Mountain Dulcimer in the style selected below into all of the tunes in the ABC text area:</p>'},{name:"Style:",id:"configure_dulcimer_style",type:"select",options:[{name:"  DAD - Along High-D String",id:"0"},{name:"  DAD - Cross-String",id:"1"},{name:"  DGD - Along High-D String",id:"2"},{name:"  DGD - Cross-String",id:"3"},{name:"  DAA - Along A String",id:"4"},{name:"  Blank Tablature",id:"5"},],cssClass:"configure_md_settings_select"},{name:"          Use - for open strings (default is leave blank using a space)",id:"open_string_symbol",type:"checkbox",cssClass:"configure_md_settings_form_text"},{name:"          Strip tunes from the result that have no complete tablature solution",id:"strip_bad_tunes",type:"checkbox",cssClass:"configure_md_settings_form_text"},{html:'<p style="margin-top:24px;font-size:12pt;line-height:18pt;font-family:helvetica">&nbsp;</p>'},],t,{theme:"modal_flat",top:200,width:600,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(t){t.canceled||(gMDulcimerStyle=t.result.configure_dulcimer_style,gMDulcimerUseDashForOpenString=t.result.open_string_symbol,gMDulcimerStripBadTunes=t.result.strip_bad_tunes,SaveConfigurationSettings(),SetRadioValue("notenodertab","noten"),gCurrentTab="noten",gExcludedFromMDSolution=[],gTheABC.value=MDTablatureGenerator(gTheABC.value),gIsDirty=!0,gStripTab=!1,RenderAsync(!0,null,function(){gExcludedFromMDSolution.length>0&&ShowMDTabWarningDialog(),IdleAdvancedControls(!0),IdleAllowShowTabNames()}))})}var gShapeNoteStyle=0;function DoInjectTablature_ShapeNotes(){let t={shape_note_style:gShapeNoteStyle};DayPilot.Modal.form([{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Inject Shape Note/Solf\xe8ge&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/app/userguide.html#advanced_shapenoteshapes" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="margin-top:36px;margin-bottom:24px;font-size:12pt;line-height:18pt;font-family:helvetica">This will inject Shape Note shapes and/or Solf\xe8ge note names into all the tunes in the ABC text area.</p>'},{name:"Shape Note/Solf\xe8ge style:",id:"shape_note_style",type:"select",options:[{name:"  4-Shape",id:"0"},{name:"  4-Shape - Include fa/sol/la note names below",id:"1"},{name:"  4-Shape - No shapes, only fa/sol/la note names below",id:"2"},{name:"  7-Shape",id:"3"},{name:"  7-Shape - Include do/re/mi note names below",id:"4"},{name:"  7-Shape - No shapes, only do/re/mi note names below",id:"5"},{name:"  Pitch Names",id:"6"},{name:"  Fixed (Do=C) Solf\xe8ge - No chromatics",id:"7"},{name:"  Fixed (Do=C) Solf\xe8ge - Include chromatics",id:"8"},{name:"  Movable Solf\xe8ge Do-based Minor",id:"9"},{name:"  Movable Solf\xe8ge La-based Minor",id:"10"},],cssClass:"configure_sn_settings_select"},{html:'<p style="margin-top:24px;font-size:12pt;line-height:18pt;font-family:helvetica">&nbsp;</p>'},],t,{theme:"modal_flat",top:200,width:680,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(t){t.canceled||(gShapeNoteStyle=parseInt(t.result.shape_note_style),sendGoogleAnalytics("tablature","Inject_ShapeNotes_"+gShapeNoteStyle),SaveConfigurationSettings(),SetRadioValue("notenodertab","noten"),gCurrentTab="noten",gTheABC.value=shapeNoteGenerator(gTheABC.value),gIsDirty=!0,gStripTab=!1,RenderAsync(!0,null,function(){IdleAdvancedControls(!0),IdleAllowShowTabNames()}))})}function ChangeTab(){var t=GetRadioValue("notenodertab");"whistle"==t&&PrepareWhistleFont(),t!=gCurrentTab&&(gForceTabSave=!0,sendGoogleAnalytics("ChangeTab",t),RenderAsync(!0,null)),gCurrentTab=t}function FocusAfterOperation(){isDesktopBrowser()?gTheABC.focus():gTheABC.blur()}function FocusABC(){gTheABC.focus(),gTheABC.selectionStart=0,gTheABC.selectionEnd=0,gTheABC.scrollTo(0,0)}function fadeOutAndHide(t,n){var o=setInterval(function(){t.style.opacity||(t.style.opacity=1),t.style.opacity>0?t.style.opacity-=.1:(clearInterval(o),t.style.display="none",n())},100)}function PreProcessSVGImageForDownload(){for(var t=document.querySelectorAll("#playback-paper svg .highlight"),n=0;n<t.length;n++)t[n].classList.remove("highlight");var o=document.querySelector("#playback-paper svg .abcjs-cursor");o&&(o.style.display="none")}function PostProcessSVGImageAfterDownload(){var t=document.querySelector("#playback-paper svg .abcjs-cursor");t&&(t.style.display="inline")}function dataURLtoBlob(t){for(var n=t.split(","),o=n[0].match(/:(.*?);/)[1],a=atob(n[1]),r=a.length,l=new Uint8Array(r);r--;)l[r]=a.charCodeAt(r);return new Blob([l],{type:o})}var gInDownloadSVG=!1;function DownloadSVG(t,n){if(gInDownloadSVG)return!1;t||sendGoogleAnalytics("export","DownloadSVG");var o=document.getElementById("export_width").value;o=parseInt(o),isNaN(o)&&(o=2400),!t&&(gExportWidth=o,gLocalStorageAvailable&&(localStorage.ExportWidth=o)),gInDownloadSVG=!0,PreProcessSVGImageForDownload();var a=document.querySelector("#playback-paper svg");if(!a){if(gInDownloadSVG=!1,!t)return;t(n)}var r=a.getBoundingClientRect();a=a.cloneNode(!0);var l=r.width,s=r.height,g=o,c=o*s/l;a.setAttribute("width",g+"px"),a.setAttribute("height",c+"px"),a.setAttribute("xmlns","http://www.w3.org/2000/svg");var d=a.outerHTML,u=new Blob(['<?xml version="1.0" standalone="no"?>\r\n',d],{type:"image/svg+xml;charset=utf-8"}),p=URL.createObjectURL(u),m=document.createElement("a");m.href=p,m.download=GetTuneAudioDownloadName(gPlayerABC,".svg"),document.body.appendChild(m),m.click(),window.URL.revokeObjectURL(p),document.body.removeChild(m),PostProcessSVGImageAfterDownload(),gInDownloadSVG=!1,a=null,t?t(n):(document.getElementById("abcplayer_svgbutton").value="SVG File Saved!",setTimeout(function(){document.getElementById("abcplayer_svgbutton").value="Save as SVG File"},750))}var gInDownloadJPEG=!1;function DownloadJPEG(t,n){if(gInDownloadJPEG)return!1;t||sendGoogleAnalytics("export","DownloadJPEG");var o=document.getElementById("export_width").value;o=parseInt(o),isNaN(o)&&(o=2400),!t&&(gExportWidth=o,gLocalStorageAvailable&&(localStorage.ExportWidth=o)),gInDownloadJPEG=!0,PreProcessSVGImageForDownload();var a=document.querySelector("#playback-paper svg");if(!a){if(gInDownloadJPEG=!1,!t)return;t(n)}var r=document.createElement("canvas"),l=a.getBoundingClientRect();a=a.cloneNode(!0);var s=l.width,g=l.height,c=o,d=o*g/s;r.width=c,r.height=d,r.style.width=c,r.style.height=d,a.setAttribute("width",c+"px"),a.setAttribute("height",d+"px");var u=r.getContext("2d");u.fillStyle="#ffffff",u.fillRect(0,0,r.width,r.height);var p=document.createElement("img"),m=new XMLSerializer().serializeToString(a);p.setAttribute("src","data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(m)))),p.onload=function(){u.drawImage(p,0,0);var o=r.toDataURL("image/jpeg",.75);if(isDesktopBrowser()){var l=document.createElement("a");l.download=GetTuneAudioDownloadName(gPlayerABC,".jpg"),l.href=o,document.body.appendChild(l),l.click(),window.URL.revokeObjectURL(o),document.body.removeChild(l)}else{var s=dataURLtoBlob(o),g=URL.createObjectURL(s),l=document.createElement("a");l.href=g,l.download=GetTuneAudioDownloadName(gPlayerABC,".jpg"),document.body.appendChild(l),l.click(),window.URL.revokeObjectURL(g),document.body.removeChild(l)}PostProcessSVGImageAfterDownload(),gInDownloadJPEG=!1,a=null,t?t(n):(document.getElementById("abcplayer_jpgbutton").value="JPG File Saved!",setTimeout(function(){document.getElementById("abcplayer_jpgbutton").value="Save as JPG File"},750))}}var gInDownloadPNG=!1;function DownloadPNG(t,n){if(gInDownloadPNG)return!1;t||sendGoogleAnalytics("export","DownloadPNG");var o=document.getElementById("export_width").value;o=parseInt(o),isNaN(o)&&(o=2400),!t&&(gExportWidth=o,gLocalStorageAvailable&&(localStorage.ExportWidth=o)),gInDownloadPNG=!0,PreProcessSVGImageForDownload();var a=document.querySelector("#playback-paper svg");if(!a){if(gInDownloadPNG=!1,!t)return;t(n)}var r=document.createElement("canvas"),l=a.getBoundingClientRect();a=a.cloneNode(!0);var s=l.width,g=l.height,c=o,d=o*g/s;r.width=c,r.height=d,r.style.width=c,r.style.height=d,a.setAttribute("width",c+"px"),a.setAttribute("height",d+"px");var u=r.getContext("2d");u.fillStyle="#ffffff",u.fillRect(0,0,r.width,r.height);var p=document.createElement("img"),m=new XMLSerializer().serializeToString(a);p.setAttribute("src","data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(m)))),p.onload=function(){u.drawImage(p,0,0);var o=r.toDataURL("image/png",1);if(isDesktopBrowser()){var l=document.createElement("a");l.download=GetTuneAudioDownloadName(gPlayerABC,".png"),l.href=o,document.body.appendChild(l),l.click(),window.URL.revokeObjectURL(o),document.body.removeChild(l)}else{var s=dataURLtoBlob(o),g=URL.createObjectURL(s),l=document.createElement("a");l.href=g,l.download=GetTuneAudioDownloadName(gPlayerABC,".png"),document.body.appendChild(l),l.click(),window.URL.revokeObjectURL(g),document.body.removeChild(l)}PostProcessSVGImageAfterDownload(),gInDownloadPNG=!1,a=null,t?t(n):(document.getElementById("abcplayer_pngbutton").value="PNG File Saved!",setTimeout(function(){document.getElementById("abcplayer_pngbutton").value="Save as PNG File"},750))}}function ExportAll(){if(isMobileBrowser()){var t="Batch export is not supported on iOS or Android at this time.";t=makeCenteredPromptString(t),DayPilot.Modal.alert(t,{theme:"modal_flat",top:400,scrollWithPage:AllowDialogsToScroll(),okText:"Ok"});return}var n=GetRadioValue("notenodertab"),o='<p style="text-align:center;font-size:20pt;font-family:helvetica">Export All Tunes</p>';o+='<p style="text-align:center;font-size:14pt;font-family:helvetica;margin-top:32px;">Export All Tunes as Audio</p>',o+='<p style="text-align:center;font-size:20pt;font-family:helvetica;">',o+='<input id="exportall_mp3button" class="exportall_mp3button btn btn-allmp3download" onclick="BatchMP3Export();" type="button" value="Export all as MP3 Audio" title="Saves the audio for all the tunes as .MP3 files">',o+="</p>","whistle"!=n&&(o+='<p style="text-align:center;font-size:14pt;font-family:helvetica;margin-top:32px;">Export All Tunes as Images</p>',o+='<p style="text-align:center;font-size:20pt;font-family:helvetica;">',o+='<input id="exportall_jpegbutton" class="exportall_jpegbutton btn btn-alljpegdownload" onclick="BatchJPEGExport();" type="button" value="Export all as JPEG" title="Saves the images for all the tunes as bitmap JPEG files">',o+='<input id="exportall_pngbutton" class="exportall_pngbutton btn btn-allpngdownload" onclick="BatchPNGExport();" type="button" value="Export all as PNG" title="Saves the images for all the tunes as bitmap PNG files">',o+='<input id="exportall_svgbutton" class="exportall_svgbutton btn btn-allsvgdownload" onclick="BatchSVGExport();" type="button" value="Export all as SVG" title="Saves the images for all the tunes as vector format SVG files">',o+="</p>",o+='<p class="export_all_text">',o+='Image width to export: <input id="export_width" type="number" min="0" step="1" max="4096" title="Image width to export" autocomplete="off"/>',o+="</p>",o+='<p style="text-align:center;font-size:14pt;font-family:helvetica;margin-top:32px;">Export All Tunes as MusicXML</p>',o+='<p style="text-align:center;font-size:20pt;font-family:helvetica;">',o+='<input id="exportall_musicxmlbutton" class="exportall_musicxmlbutton btn btn-allmusicxmldownload" onclick="BatchMusicXMLExport();" type="button" value="Export all Tunes as MusicXML" title="Saves each tune in its own MusicXML file">',o+='<p style="text-align:center;font-size:14pt;font-family:helvetica;margin-top:32px;">Developer Share URL Batch Export Tools</p>',o+='<p style="text-align:center;font-size:20pt;font-family:helvetica;">',o+='<input id="exportall_jsonbutton" class="exportall_jsonbutton btn btn-alljsondownload" onclick="BatchJSONExport();" type="button" value="Export all Share URLs as JSON" title="Saves the Share URLs for all the tunes as a JSON file">',o+='<input id="exportall_csvbutton" class="exportall_csvbutton btn btn-allcsvdownload" onclick="BatchCSVExport();" type="button" value="Export all Share URLs as CSV" title="Saves the Share URLs for all the tunes as a CSV file">',o+='<p style="text-align:center;font-size:14pt;font-family:helvetica;margin-top:32px;">SmartDraw Set List Builder</p>',o+='<p style="text-align:center;font-size:20pt;font-family:helvetica;">',o+='<input id="export_smartdrawbutton" class="export_smartdrawbutton btn btn-smartdraw" onclick="SmartDrawExport();" type="button" value="SmartDraw Set List Builder" title="Build a SmartDraw set list using drag and drop">',o+="</p>"),o+='<a id="exportall_help" href="https://michaeleskin.com/app/userguide.html#export_all" target="_blank" style="text-decoration:none;" title="Learn more about the audio and image exporter" class="dialogcornerbutton">?</a>',DayPilot.Modal.alert(o,{theme:"modal_flat",top:50,scrollWithPage:AllowDialogsToScroll()}),"whistle"!=n&&(document.getElementById("export_width").value=gExportWidthAll)}var gBatchImageExportCancelRequested=!1,gTheBatchImageExportOKButton=null,gTheBatchImageExportStatusText=null,gExportWidth=2400,gExportWidthAll=2400,gBatchExportDelayMS=200;function BatchJPEGExport(){sendGoogleAnalytics("dialog","BatchJPEGExport"),DoBatchImageExport("JPEG")}function BatchPNGExport(){sendGoogleAnalytics("dialog","BatchPNGExport"),DoBatchImageExport("PNG")}function BatchSVGExport(){sendGoogleAnalytics("dialog","BatchSVGExport"),DoBatchImageExport("SVG")}function DoBatchImageExport(t){function n(n){r--,n.click(),gBatchImageExportCancelRequested||(0!=r?setTimeout(function(){var n=getTuneByIndex(++l),r=getTuneTitle(n);gTheBatchImageExportStatusText.innerText="Exporting "+t+" for tune "+(l+1)+" of "+a+": "+r,ExportImageDialog(n,o,l,null,!1)},gBatchExportDelayMS):(gTheBatchImageExportOKButton.click(),gBatchImageExportCancelRequested=!1))}function o(o,a){switch(t){case"JPEG":DownloadJPEG(n,a);break;case"PNG":DownloadPNG(n,a);break;case"SVG":DownloadSVG(n,a)}}gExportWidthAll=parseInt(gExportWidthAll=document.getElementById("export_width").value),isNaN(gExportWidthAll)&&(gExportWidthAll=2400),gLocalStorageAvailable&&(localStorage.ExportWidthAll=gExportWidthAll);var a,r=CountTunes();if(0!=r){a=r;var l=0;gBatchImageExportCancelRequested=!1,gTheBatchImageExportOKButton=null,gTheBatchImageExportStatusText=null;var s="Exporting "+t+" for tune "+(l+1)+" of "+a;s=makeCenteredPromptString(s),DayPilot.Modal.alert(s,{theme:"modal_flat",top:290,scrollWithPage:AllowDialogsToScroll(),okText:"Cancel"}).then(function(t){gBatchImageExportCancelRequested=!0});var g=document.getElementsByClassName("modal_flat_main");g[g.length-1].style.zIndex=100001;for(var c=document.getElementsByClassName("modal_flat_ok"),d=null,u=0;u<c.length;++u)if("Cancel"==(d=c[u]).innerText){gTheBatchImageExportOKButton=d;break}var p=document.getElementsByClassName("modal_flat_content");(gTheBatchImageExportStatusText=p[p.length-1]).style.textAlign="center";var m=getTuneByIndex(l),h=getTuneTitle(m);return gTheBatchImageExportStatusText.innerText="Exporting "+t+" for tune "+(l+1)+" of "+a+": "+h,ExportImageDialog(m,o,l,null,!1),!0}}function ExportImageDialog(t,n,o,a,r){gTheOKButton=null,gPlayerABC=t;var l=GetRadioValue("notenodertab"),s=GetABCJSParams(l);s.oneSvgPerLine=!1,!function a(){modal_msg='<div id="playerholder" style="height:'+(window.innerHeight-340)+'px;overflow-y:auto;margin-bottom:15px;">',modal_msg+='<div id="abcplayer">',modal_msg+='<div id="playback-paper"></div>',modal_msg+="</div>",modal_msg+="</div>",modal_msg+="</p>";var r,l=window.innerWidth,g=GetRadioValue("notenodertab");isDesktopBrowser()?(r=.45*l)<850&&(r=850):r=800,DayPilot.Modal.alert(modal_msg,{theme:"modal_flat",top:40,width:r,okText:"Close",scrollWithPage:isMobileBrowser()});for(var c=document.getElementsByClassName("modal_flat_ok"),d=null,u=0;u<c.length;++u)if("Close"==(d=c[u]).innerText){gTheOKButton=d;break}var p=ABCJS.renderAbc("playback-paper",t,s)[0];postProcessTab([p],"playback-paper",g,!0),n&&setTimeout(function(){n(o,gTheOKButton)},10)}()}function BatchMusicXMLExport(){function t(){o--,gBatchImageExportCancelRequested||(0!=o?setTimeout(function(){var o=getTuneByIndex(++a),r=getTuneTitle(o);gTheBatchImageExportStatusText.innerText="Exporting MusicXML for tune "+(a+1)+" of "+n+": "+r;var l=GetTuneAudioDownloadName(o,".xml");ExportMusicXML(o,l,t,null)},1e3):(gTheBatchImageExportOKButton.click(),gBatchImageExportCancelRequested=!1))}sendGoogleAnalytics("dialog","BatchMusicXMLExport");var n,o=CountTunes();if(0!=o){n=o;var a=0;gBatchImageExportCancelRequested=!1,gTheBatchImageExportOKButton=null,gTheBatchImageExportStatusText=null;var r="Exporting MusicXML for tune "+(a+1)+" of "+n;r=makeCenteredPromptString(r),DayPilot.Modal.alert(r,{theme:"modal_flat",top:290,scrollWithPage:AllowDialogsToScroll(),okText:"Cancel"}).then(function(t){gBatchImageExportCancelRequested=!0});var l=document.getElementsByClassName("modal_flat_main");l[l.length-1].style.zIndex=100001;for(var s=document.getElementsByClassName("modal_flat_ok"),g=null,c=0;c<s.length;++c)if("Cancel"==(g=s[c]).innerText){gTheBatchImageExportOKButton=g;break}var d=document.getElementsByClassName("modal_flat_content");(gTheBatchImageExportStatusText=d[d.length-1]).style.textAlign="center";var u=getTuneByIndex(a),p=getTuneTitle(u);gTheBatchImageExportStatusText.innerText="Exporting MusicXML for tune "+(a+1)+" of "+n+": "+p;var m=GetTuneAudioDownloadName(u,".xml");return ExportMusicXML(u,m,t,null),!0}}function ExportMusicXML(t,n,o,a){fetch("https://seisiuneer.pythonanywhere.com/abc2xml",{method:"POST",body:t}).then(t=>t.text()).then(t=>{var a=document.createElement("a");document.body.appendChild(a),a.style="display: none";var r=new Blob([t],{type:"text/plain"}),l=window.URL.createObjectURL(r);a.href=l,a.download=n,a.click(),document.body.removeChild(a),setTimeout(function(){window.URL.revokeObjectURL(l)},1e3),o()}).catch(t=>{console.log("ExportMusicXML - MusicXML conversion failed on "+n),a?a():o()})}function BatchJSONExport(){var t=CountTunes();if(0!=t){sendGoogleAnalytics("dialog","BatchJSONExport");for(var n=[],o=0;o<t;++o){var a=getTuneByIndex(o),r=GetTuneAudioDownloadName(a,""),l=FillUrlBoxWithAbcInLZW(a,!1);l+="&name="+r+"&play=1",n.push({Name:r,URL:l})}saveTextFileDeveloper("Please enter a filename for your batch Share URL JSON file:","All_Share_URLs_JSON.txt",JSON.stringify(n))}}function BatchCSVExport(){var t=CountTunes();if(0!=t){sendGoogleAnalytics("dialog","BatchCSVExport");for(var n="Name,URL\n",o=0;o<t;++o){var a=getTuneByIndex(o),r=GetTuneAudioDownloadName(a,""),l=FillUrlBoxWithAbcInLZW(a,!1);l+="&name="+r+"&play=1",n+=r,n+=",",n+=l,n+="\n"}saveTextFileDeveloper("Please enter a filename for your batch Share URL CSV file:","All_Share_URLs_CSV.txt",n)}}var gMIDIbuffer=null,gPlayerABC=null,gPlayerABCMetronome=null,gTheOKButton=null,gTheMuteHandle=null,gPlayMetronome=!1,gUseWidePlayer=!1;function GetTuneAudioDownloadName(t,n){var o=escape(t),a=o.split("%0D%0A");a=o.split("%0A");for(var r=0;r<a.length;++r){a[r]=unescape(a[r]);var l=a[r].split("");if("T"==l[0]&&":"==l[1]){var s=a[r].slice(2);return(s=(s=(s=s.trim()).replace(/[ ]+/ig,"_")).replace(/[^a-zA-Z0-9_\-.]+/ig,""))+n}}return"output"+n}function isJigWithNoTiming(t,n){var o=escape(t),a=o.split("%0D%0A");a=o.split("%0A");for(var r=!1,l=!1,s=!1,g=!1,c=n,d=0;d<a.length;++d){a[d]=unescape(a[d]);var u=a[d].split("");if("Q"==u[0]&&":"==u[1]&&(r=!0),"M"==u[0]&&":"==u[1]){var p=a[d].replace("M:","");-1!=(p=p.trim()).indexOf("12/8")&&(g=!0,c=2e3),-1!=p.indexOf("6/8")&&(l=!0,c=1e3),-1!=p.indexOf("9/8")&&(s=!0,c=1500)}}return(l||s||g)&&!r?c:n}function DownloadWave(){sendGoogleAnalytics("export","DownloadWave"),gMIDIbuffer.millisecondsPerMeasure=isJigWithNoTiming(gPlayerABC,gMIDIbuffer.millisecondsPerMeasure),t=gMIDIbuffer.millisecondsPerMeasure,gSynthControl&&gSynthControl.warp&&(gMIDIbuffer.millisecondsPerMeasure*=100/gSynthControl.warp);var t,n=computeFade(gPlayerABC);gMIDIbuffer.fadeLength=n,gMIDIbuffer.prime().then(function(n){var o=gMIDIbuffer.download();gMIDIbuffer.millisecondsPerMeasure=t;var a=document.createElement("a");document.body.appendChild(a),a.setAttribute("style","display: none;"),a.href=o,a.download=GetTuneAudioDownloadName(gPlayerABC,".wav"),a.click(),window.URL.revokeObjectURL(o),document.body.removeChild(a)}).catch(function(t){var n="A problem occured when exporting the .wav file.";n=makeCenteredPromptString(n),DayPilot.Modal.alert(n,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})})}var gBatchMP3ExportCancelRequested=!1,gTheBatchMP3ExportOKButton=null,gTheBatchMP3ExportStatusText=null;function AddDuplicatesForMp3(t,n,o,a,r){if(1==o&&!a&&!r)return t;var l=removeABCTuneHeaders(t=t.trim()),s=(l=l.trim()).split("\n"),g=s.length;if(0==g)return t;var c=0;if(-1!=s[0].indexOf("%")){l=l.replace(s[c]+"\n",""),c=1;for(var d=1;d<g&&-1!=s[d].indexOf("%");++d)l=l.replace(s[c]+"\n",""),c++}var u=s[c],p=t.indexOf(u);if(t=t.substring(0,p),r)switch(n){case"reel":default:t+="V:1\nV:2\nz8|z8|\nV:1\nz8|z8|\n";break;case"jig":case"waltz":t+="V:1\nV:2\nz6|z6|\nV:1\nz6|z6|\n";break;case"slide":t+="V:1\nV:2\nz12|\nV:1\nz12|\n";break;case"slipjig":t+="V:1\nV:2\nz9|z9|\nV:1\nz9|z9|\n";break;case"polka":t+="V:1\nV:2\nz4|z4|\nV:1\nz4|z4|\n"}if(a)switch(n){case"reel":default:t+="V:1\nV:2\n%%MIDI program 128\n^Cz3 ^Cz3|^Cz3 ^Cz3|\nV:1\nz8|z8|\n";break;case"jig":t+="V:1\nV:2\n%%MIDI program 128\n^Cz2 ^Cz2|^Cz2 ^Cz2|\nV:1\nz6|z6|\n";break;case"slide":t+="V:1\nV:2\n%%MIDI program 128\n^Cz2 ^Cz2 ^Cz2 ^Cz2|\nV:1\nz12|\n";break;case"slipjig":t+="V:1\nV:2\n%%MIDI program 128\n^Cz2 ^Cz2 ^Cz2|^Cz2 ^Cz2 ^Cz2|\nV:1\nz9|z9|\n";break;case"polka":t+="V:1\nV:2\n%%MIDI program 128\n^Cz ^Cz|^Cz ^Cz|\nV:1\nz4|z4|\n";break;case"waltz":t+="V:1\nV:2\n%%MIDI program 128\n^Cz ^Cz ^Cz|^Cz ^Cz ^Cz|\nV:1\nz6|z6|\n"}t+=l;for(var d=0;d<o-1;++d)t+="\n",t+=l;return t}function getTuneRhythmType(t){var n=escape(t),o=n.split("%0D%0A");o=n.split("%0A");for(var a=!1,r=!1,l=!1,s=!1,g=!1,c=!1,d=!1,u=0;u<o.length;++u){o[u]=unescape(o[u]);var p=o[u].split("");if("M"==p[0]&&":"==p[1]){var m=o[u].replace("M:","");-1!=(m=m.trim()).indexOf("3/8")&&(d=!0),-1!=m.indexOf("6/8")&&(a=!0),-1!=m.indexOf("9/8")&&(r=!0),-1!=m.indexOf("12/8")&&(l=!0),-1!=m.indexOf("2/4")&&(s=!0),-1!=m.indexOf("4/4")&&(g=!0),-1!=m.indexOf("3/4")&&(c=!0),-1!=m.indexOf("C")&&(g=!0)}}return a||l?"jig":r?"slipjig":d?"oddjig":s?"polka":g?"reel":c?"waltz":"reel"}var gBatchMP3ExportDelayMS=250;function BatchMP3Export(){sendGoogleAnalytics("dialog","BatchMP3Export"),DayPilot.Modal.form([{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Export All Tunes as MP3&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/app/userguide.html#export_all_as_mp3" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="margin-top:24px;margin-bottom:24px;font-size:12pt;line-height:18pt;font-family:helvetica">This will export all the tunes in the ABC area as .MP3 files with one or more repeats.</p>'},{html:'<p style="margin-top:24px;margin-bottom:24px;font-size:12pt;line-height:18pt;font-family:helvetica">You may optionally set the playback speed as a percentage of the original.</p>'},{html:'<p style="margin-top:24px;margin-bottom:24px;font-size:12pt;line-height:18pt;font-family:helvetica">You may also optionally inject two bars of silence and/or a click intro before each tune.</p>'},{name:"Playback speed (percentage, default is 100):",id:"configure_percent_speed",type:"number",cssClass:"configure_repeats_form_text"},{name:"How many times to repeat each tune in the .MP3:",id:"configure_repeats",type:"number",cssClass:"configure_repeats_form_text"},{name:"         Include reverb effects in the .MP3",id:"configure_include_reverb",type:"checkbox",cssClass:"configure_repeats_form_text"},{name:"Before each tune:",id:"configure_before_each_tune",type:"select",options:[{name:"Do nothing",id:0},{name:"Inject two bars of silence",id:1},{name:"Inject a two-bar style-appropriate click intro",id:2},{name:"Inject both two bars of silence and click intro",id:3}],cssClass:"configure_mp3_before_tune_select"},{html:'<p style="margin-top:16px;font-size:12pt;line-height:18pt;font-family:helvetica"><strong>To append two-bars of silence and/or a click intro before each tune:</strong></p>'},{html:'<p style="margin-top:16px;font-size:12pt;line-height:18pt;font-family:helvetica">Select your option for silence and/or click intro from the <strong>Before each tune:</strong> dropdown.</p>'},{html:'<p style="margin-top:16px;font-size:12pt;line-height:18pt;font-family:helvetica"><strong>For best results with repeated tunes:</strong></p>'},{html:'<p style="margin-top:16px;font-size:12pt;line-height:18pt;font-family:helvetica">For clean repeats, your tunes must not have extraneous pickup or trailing notes and must have proper and complete timing.</p>'},{html:'<p style="margin-top:16px;font-size:12pt;line-height:18pt;font-family:helvetica">If there is a repeat at the end of the first part of a tune, either standalone or in a first ending, there must be a matching |: bar at the start of the tune for the tune repeats to work properly.</p>'},],{configure_repeats:1,configure_before_each_tune:0,configure_include_reverb:!0,configure_percent_speed:100},{theme:"modal_flat",top:100,width:760,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(t){if(!t.canceled){var n=t.result.configure_repeats;if(null!=n){if(repeatCount=parseInt(n),!(isNaN(repeatCount)||void 0==repeatCount||repeatCount<1)){var o=t.result.configure_before_each_tune,a=!1,r=!1;switch(o){case 0:a=!1,r=!1;break;case 1:a=!1,r=!0;break;case 2:a=!0,r=!1;break;case 3:a=!0,r=!0}var l=t.result.configure_include_reverb,s=t.result.configure_percent_speed,g=100;if(null!=s){var g=parseInt(s=s.replace("%",""));(isNaN(g)||void 0==g)&&(g=100),g<=5&&(g=5),g>400&&(g=400)}DoBatchMP3Export(repeatCount,a,r,l,g)}}}})}function DoBatchMP3Export(t,n,o,a,r){function l(a){c--,a.click(),gBatchMP3ExportCancelRequested||(0!=c?setTimeout(function(){var a=getTuneByIndex(++d),r=getTuneRhythmType(a);a=AddDuplicatesForMp3(a,r,t,n,o),a=PreProcessPlayABC(a);var l=getTuneTitle(a);gTheBatchMP3ExportStatusText.innerText="Exporting .MP3 for tune "+(d+1)+" of "+g+": "+l,PlayABCDialog(a,s,d,null,!1)},gBatchMP3ExportDelayMS):(gTheBatchMP3ExportOKButton.click(),gBatchMP3ExportCancelRequested=!1))}function s(t,n){gSynthControl.warp=r,a?DownloadMP3WithReverb(l,n):DownloadMP3(l,n)}var g,c=CountTunes();if(0!=c){g=c;var d=0;gBatchMP3ExportCancelRequested=!1,gTheBatchMP3ExportOKButton=null,gTheBatchMP3ExportStatusText=null;var u="Exporting .MP3 for tune "+(d+1)+" of "+g;u=makeCenteredPromptString(u),DayPilot.Modal.alert(u,{theme:"modal_flat",top:290,scrollWithPage:AllowDialogsToScroll(),okText:"Cancel"}).then(function(t){gBatchMP3ExportCancelRequested=!0});var p=document.getElementsByClassName("modal_flat_main");p[p.length-1].style.zIndex=100001;for(var m=document.getElementsByClassName("modal_flat_ok"),h=null,f=0;f<m.length;++f)if("Cancel"==(h=m[f]).innerText){gTheBatchMP3ExportOKButton=h;break}var A=document.getElementsByClassName("modal_flat_content");(gTheBatchMP3ExportStatusText=A[A.length-1]).style.textAlign="center";var b=getTuneByIndex(d),T=getTuneRhythmType(b);b=AddDuplicatesForMp3(b,T,t,n,o),b=PreProcessPlayABC(b);var y=getTuneTitle(b);return gTheBatchMP3ExportStatusText.innerText="Exporting .MP3 for tune "+(d+1)+" of "+g+": "+y,PlayABCDialog(b,s,d,null,!1),!0}}var gInDownloadMP3=!1;function DownloadMP3(t,n){if(gInDownloadMP3)return!1;sendGoogleAnalytics("export","DownloadMP3"),gInDownloadMP3=!0,gMIDIbuffer.millisecondsPerMeasure=isJigWithNoTiming(gPlayerABC,gMIDIbuffer.millisecondsPerMeasure),o=gMIDIbuffer.millisecondsPerMeasure,gSynthControl&&gSynthControl.warp&&(gMIDIbuffer.millisecondsPerMeasure*=100/gSynthControl.warp);var o,a=computeFade(gPlayerABC);gMIDIbuffer.fadeLength=a,gMIDIbuffer.prime().then(function(a){if(!t){var r=document.getElementById("abcplayer_mp3button");r&&(r.value="Encoding .MP3")}document.getElementById("loading-bar-spinner").style.display="block",setTimeout(async function(){var a=await fetch(gMIDIbuffer.download()).then(t=>t.blob());gMIDIbuffer.millisecondsPerMeasure=o;var r=new FileReader;r.onload=function(o){var a=function t(n){var o,a=function t(n){function o(t,o){for(var a=0,r=0;o;)a+=n[t]<<r,r+=8,t++,o--;return a}return{sampleRate:o(24,4),bitsPerSample:o(34,2),samples:n.subarray(44)}}(new Uint8Array(n)),r=a.samples.length,l=r/4,s=a.sampleRate,g=new lamejs.Mp3Encoder(2,s,gMP3Bitrate),c=[],d=new Int16Array(a.samples.buffer);for(let u=0;u<882;u++)d[u]=0;let p=Math.ceil(r/2);var m=new Int16Array(p),h=new Int16Array(r-p);for(let f=0;f<2*l;f++)f%2==0?m[f/2]=d[f]:h[(f-1)/2]=d[f];for(var A=0;A<l;A+=1152){var b=m.subarray(A,A+1152),T=h.subarray(A,A+1152),y=g.encodeBuffer(b,T);y.length>0&&c.push(y)}var y=g.flush();return y.length>0&&c.push(y),c}(o.target.result),r=new Blob(a,{type:"audio/mp3"}),l=window.URL.createObjectURL(r),s=document.createElement("a");if(document.body.appendChild(s),s.setAttribute("style","display: none;"),s.href=l,s.download=GetTuneAudioDownloadName(gPlayerABC,".mp3"),s.click(),window.URL.revokeObjectURL(l),document.body.removeChild(s),!t){var g=document.getElementById("abcplayer_mp3button");g&&(g.value="Save as .MP3")}document.getElementById("loading-bar-spinner").style.display="none",gInDownloadMP3=!1,t&&t(n)},r.readAsArrayBuffer(a)},100)}).catch(function(n){var o="A problem occured when exporting the .mp3 file.";if(o=makeCenteredPromptString(o),DayPilot.Modal.alert(o,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()}),!t){var a=document.getElementById("abcplayer_mp3button");a&&(a.value="Save as .MP3")}document.getElementById("loading-bar-spinner").style.display="none",gInDownloadMP3=!1})}function DownloadMIDI(){sendGoogleAnalytics("export","DownloadMIDI");var t=ABCJS.synth.getMidiFile(gPlayerABC,{midiOutputType:"link"})[0];t=t.replace("<a download",'<a id="downloadmidilink" download');var n=document.createElement("div");n.innerHTML=t,n.setAttribute("style","display: none;"),document.body.appendChild(n),document.getElementById("downloadmidilink").click(),document.body.removeChild(n)}function ExportAudioOrImage(){var t="",n=GetRadioValue("notenodertab");t="whistle"!=n?'<p style="text-align:center;font-size:20pt;font-family:helvetica">Export Audio or Image</p>':'<p style="text-align:center;font-size:20pt;font-family:helvetica">Export Audio</p>',t+='<p style="text-align:center;font-size:14pt;font-family:helvetica;margin-top:32px;">Export Tune Audio</p>',t+='<p style="text-align:center;font-size:20pt;font-family:helvetica;">',t+='<input id="abcplayer_wavbutton" class="abcplayer_wavbutton btn btn-wavedownload" onclick="DownloadWave();" type="button" value="Save as WAV File" title="Saves the audio for the current tune as a .WAV file">',t+='<input id="abcplayer_mp3button" class="abcplayer_mp3button btn btn-mp3download" onclick="DownloadMP3();" type="button" value="Save as MP3 File" title="Saves the audio for the current tune as a .MP3 file">',t+='<input id="abcplayer_midibutton" class="abcplayer_midibutton btn btn-mididownload" onclick="DownloadMIDI();" type="button" value="Save as MIDI File" title="Saves the current tune note events as a MIDI file">',t+="</p>",t+='<p style="text-align:center;font-size:20pt;font-family:helvetica;">',t+='<input id="abcplayer_wavreverbbutton" class="abcplayer_wavreverbbutton btn btn-wavereverbdownload" onclick="DownloadWaveWithReverb();" type="button" value="Save as WAV File with Reverb" title="Saves the audio for the current tune as a .WAV file including reverb"><input id="abcplayer_mp3reverbbutton" class="abcplayer_mp3reverbbutton btn btn-mp3reverbdownload" onclick="DownloadMP3WithReverb();" type="button" value="Save as MP3 File with Reverb" title="Saves the audio for the current tune as a .MP3 file including reverb">',t+="</p>","whistle"!=n&&(t+='<p style="text-align:center;font-size:14pt;font-family:helvetica;margin-top:24px;">Export Tune Image</p>',t+='<p style="text-align:center;font-size:20pt;font-family:helvetica"><input id="abcplayer_jpgbutton" class="abcplayer_jpgbutton btn btn-jpgdownload" onclick="DownloadJPEG();" type="button" value="Save as JPEG File" title="Saves the current tune image as a JPEG file">',t+='<input id="abcplayer_pngbutton" class="abcplayer_pngbutton btn btn-pngdownload" onclick="DownloadPNG();" type="button" value="Save as PNG File" title="Saves the current tune image as a PNG file">',t+='<input id="abcplayer_svgbutton" class="abcplayer_svgbutton btn btn-svgdownload" onclick="DownloadSVG();" type="button" value="Save as SVG File" title="Saves the current tune image as a SVG file">',t+="</p>",t+='<p class="export_single_text">',t+='Image width to export: <input id="export_width" type="number" min="0" step="1" max="4096" title="Image width to export" autocomplete="off"/>',t+="</p>"),t+='<a id="exportaudioimage_help" href="https://michaeleskin.com/app/userguide.html#export_audio_image" target="_blank" style="text-decoration:none;" title="Learn more about the audio and image exporter" class="dialogcornerbutton">?</a>',DayPilot.Modal.alert(t,{theme:"modal_flat",top:150,scrollWithPage:AllowDialogsToScroll()}),"whistle"!=n&&(document.getElementById("export_width").value=gExportWidth)}function computeFade(t){var n=200,o=/^%%MIDI program.*[\r\n]*/gm,a=t.match(o);if(a&&a.length>0){var r=a[a.length-1].replace("%%MIDI program",""),l=(r=r.trim()).split(" ");if(l&&l.length>0){var s=l[0],g=gUseCustomGMSounds;if(gOverrideCustomGMSounds&&(g=gCustomGMSoundsOverride),g)switch(s){case"15":n=4e3;break;case"21":case"73":case"78":case"105":case"109":case"110":case"117":case"129":case"130":case"131":case"132":case"133":case"134":case"135":case"136":case"142":case"143":case"144":case"mute":n=100;break;case"137":case"138":case"139":case"141":n=200;break;case"140":n=125}else switch(s){case"129":case"130":case"131":case"132":case"133":case"134":case"135":case"136":case"142":case"143":case"144":case"mute":n=100;break;case"137":case"138":case"139":case"141":n=200;break;case"140":n=125}}}o=/^%%MIDI chordprog.*[\r\n]*/gm;var c=t.match(o);if(c&&c.length>0){var r=c[c.length-1].replace("%%MIDI chordprog",""),l=(r=r.trim()).split(" ");if(l&&l.length>0){var s=l[0],g=gUseCustomGMSounds;gOverrideCustomGMSounds&&(g=gCustomGMSoundsOverride),g&&"15"===s&&(n=4e3)}}o=/^%abcjs_release_decay_time.*[\r\n]*/gm;var d=t.match(o);if(d&&d.length>0){var n=d[d.length-1].replace("%abcjs_release_decay_time",""),u=parseInt(n=n.trim());isNaN(u)||(n=u)}return n}function postProcessTab(t,n,o,a){function r(){o=a?document.querySelectorAll('div[id="'+n+'"] > svg > g > g > [class="abcjs-top-line"]'):document.querySelectorAll('div[id="'+n+'"] > div > svg > g > g > [class="abcjs-top-line"]');var o,r=t.length;if(0!=r){var l=0;if(r>1){var l=n.replace("notation","");if(l=parseInt(l),isNaN(l))return}var s=t[l],g=s.lines.length;if(0!=g){for(var c=[],d=0;d<g;++d)s.lines[d].staff&&c.push(s.lines[d]);var u=c.length;if(0!=u){for(var p=[],d=0;d<u;++d){var m=c[d].staff.length,h=m/2;for(j=0;j<m;++j)j<h?p.push(!1):p.push(!0)}for(var f=0;f<o.length;f++)if(p[f]){o[f].setAttribute("class","hiddentabline");for(var A=getNextSiblings(o[f]),b=0;b<A.length;b++)A[b].setAttribute("class","hiddentabline")}}}}}if(t){if("whistle"==o){var l;for(r(),l=a?document.querySelectorAll('div[id="'+n+'"] > svg > g > g[data-name="tabNumber"] > text > tspan'):document.querySelectorAll('div[id="'+n+'"] > div > svg > g > g[data-name="tabNumber"] > text > tspan'),x=0;x<l.length;x++)l[x].setAttribute("class","whistle"),l[x].setAttribute("dy","-7"),"0"==l[x].innerHTML?l[x].innerHTML="g":"1"==l[x].innerHTML?l[x].innerHTML="m":"2"==l[x].innerHTML?l[x].innerHTML="a":"3"==l[x].innerHTML?l[x].innerHTML="i":"4"==l[x].innerHTML?l[x].innerHTML="b":"5"==l[x].innerHTML?l[x].innerHTML="c":"6"==l[x].innerHTML?l[x].innerHTML="j":"7"==l[x].innerHTML?l[x].innerHTML="d":"8"==l[x].innerHTML?l[x].innerHTML="k":"9"==l[x].innerHTML?l[x].innerHTML="e":"10"==l[x].innerHTML?l[x].innerHTML="f":"11"==l[x].innerHTML?l[x].innerHTML="l":"12"==l[x].innerHTML?l[x].innerHTML="g":"13"==l[x].innerHTML?l[x].innerHTML="m":"14"==l[x].innerHTML?l[x].innerHTML="a":"15"==l[x].innerHTML?l[x].innerHTML="i":"16"==l[x].innerHTML?l[x].innerHTML="b":"17"==l[x].innerHTML?l[x].innerHTML="c":"18"==l[x].innerHTML?l[x].innerHTML="j":"19"==l[x].innerHTML?l[x].innerHTML="D":"20"==l[x].innerHTML?l[x].innerHTML="K":"21"==l[x].innerHTML?l[x].innerHTML="E":"22"==l[x].innerHTML?l[x].innerHTML="F":"23"==l[x].innerHTML?l[x].innerHTML="L":"24"==l[x].innerHTML?l[x].innerHTML="G":"25"==l[x].innerHTML?l[x].innerHTML="M":"26"==l[x].innerHTML?l[x].innerHTML="A":"27"==l[x].innerHTML?l[x].innerHTML="I":"28"==l[x].innerHTML?l[x].innerHTML="B":"29"==l[x].innerHTML?l[x].innerHTML="C":"30"==l[x].innerHTML?l[x].innerHTML="J":"31"==l[x].innerHTML?l[x].innerHTML="D":"32"==l[x].innerHTML?l[x].innerHTML="K":"33"==l[x].innerHTML?l[x].innerHTML="E":"34"==l[x].innerHTML?l[x].innerHTML="F":"35"==l[x].innerHTML?l[x].innerHTML="L":"36"==l[x].innerHTML?l[x].innerHTML="G":"37"==l[x].innerHTML?l[x].innerHTML="M":"38"==l[x].innerHTML?l[x].innerHTML="A":(l[x].setAttribute("class","whistle_small"),l[x].setAttribute("dy","-23"),l[x].innerHTML="x")}if("notenames"==o){var s=!0;r(),Svgs=a?document.querySelectorAll('div[id="'+n+'"] > svg'):document.querySelectorAll('div[id="'+n+'"] > div > svg');var g=1;if(a&&(g=0),Svgs&&Svgs.length>g)for(var c=g;c<Svgs.length;++c){s=!0;var d=Svgs[c],u=d.querySelectorAll('g[data-name="staff-extra key-signature"]');u&&u.length>=1&&-1!=u[0].innerHTML.indexOf("accidentals.flat")&&(s=!1);var l=d.querySelectorAll('g[data-name="tabNumber"] > text > tspan');if(gUseComhaltasABC){if(s)for(x=0;x<l.length;x++)"0"==l[x].innerHTML?l[x].innerHTML="G,":"1"==l[x].innerHTML?l[x].innerHTML="G,":"2"==l[x].innerHTML?l[x].innerHTML="A,":"3"==l[x].innerHTML?l[x].innerHTML="A,":"4"==l[x].innerHTML?l[x].innerHTML="B,":"5"==l[x].innerHTML?l[x].innerHTML="C,":"6"==l[x].innerHTML?l[x].innerHTML="C,":"7"==l[x].innerHTML?l[x].innerHTML="D":"8"==l[x].innerHTML?l[x].innerHTML="D":"9"==l[x].innerHTML?l[x].innerHTML="E":"10"==l[x].innerHTML?l[x].innerHTML="F":"11"==l[x].innerHTML?l[x].innerHTML="F":"12"==l[x].innerHTML?l[x].innerHTML="G":"13"==l[x].innerHTML?l[x].innerHTML="G":"14"==l[x].innerHTML?l[x].innerHTML="A":"15"==l[x].innerHTML?l[x].innerHTML="A":"16"==l[x].innerHTML?l[x].innerHTML="B":"17"==l[x].innerHTML?l[x].innerHTML="C":"18"==l[x].innerHTML?l[x].innerHTML="C":"19"==l[x].innerHTML?l[x].innerHTML="D'":"20"==l[x].innerHTML?l[x].innerHTML="D'":"21"==l[x].innerHTML?l[x].innerHTML="E'":"22"==l[x].innerHTML?l[x].innerHTML="F'":"23"==l[x].innerHTML?l[x].innerHTML="F'":"24"==l[x].innerHTML?l[x].innerHTML="G'":"25"==l[x].innerHTML?l[x].innerHTML="G'":"26"==l[x].innerHTML?l[x].innerHTML="A'":"27"==l[x].innerHTML?l[x].innerHTML="A'":"28"==l[x].innerHTML?l[x].innerHTML="B'":"29"==l[x].innerHTML?l[x].innerHTML="C'":"30"==l[x].innerHTML?l[x].innerHTML="C'":"31"==l[x].innerHTML?l[x].innerHTML="D''":"32"==l[x].innerHTML?l[x].innerHTML="D''":"33"==l[x].innerHTML?l[x].innerHTML="E''":"34"==l[x].innerHTML?l[x].innerHTML="F''":"35"==l[x].innerHTML?l[x].innerHTML="F''":"36"==l[x].innerHTML?l[x].innerHTML="G''":"37"==l[x].innerHTML?l[x].innerHTML="G''":"38"==l[x].innerHTML?l[x].innerHTML="A''":"39"==l[x].innerHTML?l[x].innerHTML="A''":"40"==l[x].innerHTML?l[x].innerHTML="B''":l[x].innerHTML="?";else for(x=0;x<l.length;x++)"0"==l[x].innerHTML?l[x].innerHTML="G,":"1"==l[x].innerHTML?l[x].innerHTML="A,":"2"==l[x].innerHTML?l[x].innerHTML="A,":"3"==l[x].innerHTML?l[x].innerHTML="B,":"4"==l[x].innerHTML?l[x].innerHTML="B,":"5"==l[x].innerHTML?l[x].innerHTML="C,":"6"==l[x].innerHTML?l[x].innerHTML="D":"7"==l[x].innerHTML?l[x].innerHTML="D":"8"==l[x].innerHTML?l[x].innerHTML="E":"9"==l[x].innerHTML?l[x].innerHTML="E":"10"==l[x].innerHTML?l[x].innerHTML="F":"11"==l[x].innerHTML?l[x].innerHTML="G":"12"==l[x].innerHTML?l[x].innerHTML="G":"13"==l[x].innerHTML?l[x].innerHTML="A":"14"==l[x].innerHTML?l[x].innerHTML="A":"15"==l[x].innerHTML?l[x].innerHTML="B":"16"==l[x].innerHTML?l[x].innerHTML="B":"17"==l[x].innerHTML?l[x].innerHTML="C":"18"==l[x].innerHTML?l[x].innerHTML="D'":"19"==l[x].innerHTML?l[x].innerHTML="D'":"20"==l[x].innerHTML?l[x].innerHTML="E'":"21"==l[x].innerHTML?l[x].innerHTML="E'":"22"==l[x].innerHTML?l[x].innerHTML="F'":"23"==l[x].innerHTML?l[x].innerHTML="G'":"24"==l[x].innerHTML?l[x].innerHTML="G'":"25"==l[x].innerHTML?l[x].innerHTML="A'":"26"==l[x].innerHTML?l[x].innerHTML="A'":"27"==l[x].innerHTML?l[x].innerHTML="B'":"28"==l[x].innerHTML?l[x].innerHTML="B'":"29"==l[x].innerHTML?l[x].innerHTML="C'":"30"==l[x].innerHTML?l[x].innerHTML="D''":"31"==l[x].innerHTML?l[x].innerHTML="D''":"32"==l[x].innerHTML?l[x].innerHTML="E''":"33"==l[x].innerHTML?l[x].innerHTML="E''":"34"==l[x].innerHTML?l[x].innerHTML="F''":"35"==l[x].innerHTML?l[x].innerHTML="G''":"36"==l[x].innerHTML?l[x].innerHTML="G''":"37"==l[x].innerHTML?l[x].innerHTML="A''":"38"==l[x].innerHTML?l[x].innerHTML="A''":"39"==l[x].innerHTML?l[x].innerHTML="B''":"40"==l[x].innerHTML?l[x].innerHTML="B''":l[x].innerHTML="?"}else if(s)for(x=0;x<l.length;x++)"0"==l[x].innerHTML?l[x].innerHTML="G,":"1"==l[x].innerHTML?l[x].innerHTML="G,":"2"==l[x].innerHTML?l[x].innerHTML="A,":"3"==l[x].innerHTML?l[x].innerHTML="A,":"4"==l[x].innerHTML?l[x].innerHTML="B,":"5"==l[x].innerHTML?l[x].innerHTML="C":"6"==l[x].innerHTML?l[x].innerHTML="C":"7"==l[x].innerHTML?l[x].innerHTML="D":"8"==l[x].innerHTML?l[x].innerHTML="D":"9"==l[x].innerHTML?l[x].innerHTML="E":"10"==l[x].innerHTML?l[x].innerHTML="F":"11"==l[x].innerHTML?l[x].innerHTML="F":"12"==l[x].innerHTML?l[x].innerHTML="G":"13"==l[x].innerHTML?l[x].innerHTML="G":"14"==l[x].innerHTML?l[x].innerHTML="A":"15"==l[x].innerHTML?l[x].innerHTML="A":"16"==l[x].innerHTML?l[x].innerHTML="B":"17"==l[x].innerHTML?l[x].innerHTML="c":"18"==l[x].innerHTML?l[x].innerHTML="c":"19"==l[x].innerHTML?l[x].innerHTML="d":"20"==l[x].innerHTML?l[x].innerHTML="d":"21"==l[x].innerHTML?l[x].innerHTML="e":"22"==l[x].innerHTML?l[x].innerHTML="f":"23"==l[x].innerHTML?l[x].innerHTML="f":"24"==l[x].innerHTML?l[x].innerHTML="g":"25"==l[x].innerHTML?l[x].innerHTML="g":"26"==l[x].innerHTML?l[x].innerHTML="a":"27"==l[x].innerHTML?l[x].innerHTML="a":"28"==l[x].innerHTML?l[x].innerHTML="b":"29"==l[x].innerHTML?l[x].innerHTML="c'":"30"==l[x].innerHTML?l[x].innerHTML="c'":"31"==l[x].innerHTML?l[x].innerHTML="d'":"32"==l[x].innerHTML?l[x].innerHTML="d'":"33"==l[x].innerHTML?l[x].innerHTML="e'":"34"==l[x].innerHTML?l[x].innerHTML="f'":"35"==l[x].innerHTML?l[x].innerHTML="f'":"36"==l[x].innerHTML?l[x].innerHTML="g'":"37"==l[x].innerHTML?l[x].innerHTML="g'":"38"==l[x].innerHTML?l[x].innerHTML="a'":"39"==l[x].innerHTML?l[x].innerHTML="a'":"40"==l[x].innerHTML?l[x].innerHTML="b'":l[x].innerHTML="?";else for(x=0;x<l.length;x++)"0"==l[x].innerHTML?l[x].innerHTML="G,":"1"==l[x].innerHTML?l[x].innerHTML="A,":"2"==l[x].innerHTML?l[x].innerHTML="A,":"3"==l[x].innerHTML?l[x].innerHTML="B,":"4"==l[x].innerHTML?l[x].innerHTML="B,":"5"==l[x].innerHTML?l[x].innerHTML="C":"6"==l[x].innerHTML?l[x].innerHTML="D":"7"==l[x].innerHTML?l[x].innerHTML="D":"8"==l[x].innerHTML?l[x].innerHTML="E":"9"==l[x].innerHTML?l[x].innerHTML="E":"10"==l[x].innerHTML?l[x].innerHTML="F":"11"==l[x].innerHTML?l[x].innerHTML="G":"12"==l[x].innerHTML?l[x].innerHTML="G":"13"==l[x].innerHTML?l[x].innerHTML="A":"14"==l[x].innerHTML?l[x].innerHTML="A":"15"==l[x].innerHTML?l[x].innerHTML="B":"16"==l[x].innerHTML?l[x].innerHTML="B":"17"==l[x].innerHTML?l[x].innerHTML="c":"18"==l[x].innerHTML?l[x].innerHTML="d":"19"==l[x].innerHTML?l[x].innerHTML="d":"20"==l[x].innerHTML?l[x].innerHTML="e":"21"==l[x].innerHTML?l[x].innerHTML="e":"22"==l[x].innerHTML?l[x].innerHTML="f":"23"==l[x].innerHTML?l[x].innerHTML="g":"24"==l[x].innerHTML?l[x].innerHTML="g":"25"==l[x].innerHTML?l[x].innerHTML="a":"26"==l[x].innerHTML?l[x].innerHTML="a":"27"==l[x].innerHTML?l[x].innerHTML="b":"28"==l[x].innerHTML?l[x].innerHTML="b":"29"==l[x].innerHTML?l[x].innerHTML="c'":"30"==l[x].innerHTML?l[x].innerHTML="d'":"31"==l[x].innerHTML?l[x].innerHTML="d'":"32"==l[x].innerHTML?l[x].innerHTML="e'":"33"==l[x].innerHTML?l[x].innerHTML="e'":"34"==l[x].innerHTML?l[x].innerHTML="f'":"35"==l[x].innerHTML?l[x].innerHTML="g'":"36"==l[x].innerHTML?l[x].innerHTML="g'":"37"==l[x].innerHTML?l[x].innerHTML="a'":"38"==l[x].innerHTML?l[x].innerHTML="a'":"39"==l[x].innerHTML?l[x].innerHTML="b'":"40"==l[x].innerHTML?l[x].innerHTML="b'":l[x].innerHTML="?"}}}}function ToggleMetronome(){gPlayMetronome=!gPlayMetronome,gTheOKButton.click(),setTimeout(function(){if(gPlayMetronome){if(!gPlayerABCMetronome&&!(gPlayerABCMetronome=inject_one_metronome(gPlayerABC,!1))){gPlayMetronome=!1;var t='<p style="text-align:center;font-size:20pt;font-family:helvetica">Metronome Not Available for this Meter</p>';t+='<p style="font-size:14pt;line-height:20pt;font-family:helvetica;">No metronome pattern is available for the meter of this tune.</p>',t+='<p style="font-size:14pt;line-height:20pt;font-family:helvetica;">Only the original version can be played.</p>',DayPilot.Modal.alert(t,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()}).then(function(){PlayABCDialog(gPlayerABC,null,null,gUseWidePlayer)});return}PlayABCDialog(gPlayerABCMetronome,null,null,!0,gUseWidePlayer)}else PlayABCDialog(gPlayerABC,null,null,!1,gUseWidePlayer)},250)}function ShowPlayerSettings(){ConfigurePlayerSettings(function t(n){if(n){gTheOKButton.click();var o=getTuneByIndex(gPlayABCTuneIndex);""!=o&&(o=PreProcessPlayABC(o),setTimeout(function(){PlayABCDialog(o,null,null,!1,gUseWidePlayer)},250))}})}function ToggleWidePlayer(){gUseWidePlayer=!gUseWidePlayer,gTheOKButton.click(),setTimeout(function(){PlayABCDialog(gPlayerABC,null,null,!1,gUseWidePlayer)},250)}var gPlayerContainerRect=null,gPlayerHolder=null;function CursorControl(){var t=this;t.onReady=function(){},t.onStart=function(){var t=document.querySelector("#playback-paper svg"),n=document.createElementNS("http://www.w3.org/2000/svg","line");n.setAttribute("class","abcjs-cursor"),n.setAttributeNS(null,"x1",0),n.setAttributeNS(null,"y1",0),n.setAttributeNS(null,"x2",0),n.setAttributeNS(null,"y2",0),t.appendChild(n)},t.beatSubdivisions=2,t.onBeat=function(t,n,o){},t.onEvent=function(t){if(!t.measureStart||null!==t.left){if(!gDisablePlayHighlight){for(var n=document.querySelectorAll("#playback-paper svg .highlight"),o=0;o<n.length;o++)n[o].classList.remove("highlight");for(var a=0;a<t.elements.length;a++)for(var r=t.elements[a],l=0;l<r.length;l++)gOnlyHighlightV1?r[l].classList.contains("abcjs-v0")&&r[l].classList.add("highlight"):r[l].classList.add("highlight")}var s=document.querySelector("#playback-paper svg .abcjs-cursor");if(s&&(s.setAttribute("x1",t.left-2),s.setAttribute("x2",t.left-2),s.setAttribute("y1",t.top),s.setAttribute("y2",t.top+t.height),gAutoscrollPlayer)){let g=s.getBoundingClientRect();var c,d=gPlayerContainerRect.bottom-gPlayerContainerRect.top;(c=gUseWidePlayer?2*d/3:3*d/4,g.top<gPlayerContainerRect.top)?gPlayerHolder.scrollTop+=g.top-gPlayerContainerRect.top:g.bottom>c&&(g.bottom-g.top<=c?gPlayerHolder.scrollTop+=g.bottom-c:gPlayerHolder.scrollTop+=g.top-gPlayerContainerRect.top)}}},t.onFinished=function(){for(var t=document.querySelectorAll("svg .highlight"),n=0;n<t.length;n++)t[n].classList.remove("highlight");var o=document.querySelector("#playback-paper svg .abcjs-cursor");o&&(o.setAttribute("x1",0),o.setAttribute("x2",0),o.setAttribute("y1",0),o.setAttribute("y2",0))}}function findLargestRectangle(t,n,o){for(var a={width:0,height:0},r=1;r<=t;r++){var l=r/o;l<=n&&(a.width=r,a.height=l)}return a}function calc_wide_play_width(t){var n=getTuneRangeForTranspose().start,o=document.getElementById("notation"+n);if(o){var a,r=o.getElementsByTagName("div");if(r&&r.length>0){var l=(a=r.length>1?r[1]:r[0]).getElementsByTagName("svg");if(l&&l.length>0){var s=l[0].getBoundingClientRect(),g=s.width,c=3*s.height,d=.9*window.innerWidth;return findLargestRectangle(d,(window.innerHeight-t)*.9,g/c).width}}}var d=window.innerWidth;return .75*d}function PlayPrevious(t){if(gPlayABCTuneIndex>0){t.shiftKey?gPlayABCTuneIndex=0:gPlayABCTuneIndex--;var n=getTuneByIndex(gPlayABCTuneIndex);""!=n&&(gTheOKButton.click(),n=PreProcessPlayABC(n),PlayABCDialog(n,null,null,null,gUseWidePlayer=!1))}}function PlayNext(t){if(gPlayABCTuneIndex<gPlayABCTuneCount-1){t.shiftKey?gPlayABCTuneIndex=gPlayABCTuneCount-1:gPlayABCTuneIndex++;var n=getTuneByIndex(gPlayABCTuneIndex);""!=n&&(gTheOKButton.click(),n=PreProcessPlayABC(n),PlayABCDialog(n,null,null,null,gUseWidePlayer=!1))}}function PlaySelectedTune(){var t=document.getElementById("playertunelist").value;if(t=parseInt(t),!isNaN(t)){var n=getTuneByIndex(gPlayABCTuneIndex=t);""!=n&&(gTheOKButton.click(),n=PreProcessPlayABC(n),PlayABCDialog(n,null,null,null,gUseWidePlayer=!1))}}function JustTheNotes(t){if(isSectionHeader(t))return t;for(var n,o=removeABCTuneHeaders(t),a=o.split("\n"),r=a.length,l=!1,s=0;s<r;++s)if(0!=(n=a[s]).indexOf("%")){l=!0;var g=o.indexOf(n);o=o.substring(g);break}return l?o:t}function ProcessSelectRegionForPlay(t){if(gDisableSelectedPlay||gIsMaximized)return t;var n=gTheABC.selectionStart,o=gTheABC.selectionEnd;if(n==o||-1!=t.indexOf("V:"))return t;var a=findTuneOffsetByIndex(gPlayABCTuneIndex),r=t.length,l=JustTheNotes(t);n<a&&(n=a),o>a+r&&(o=a+r),n-=a,o-=a;var s=t.indexOf(l);if(-1==s||n<s&&o<s)return t;n<s&&(n=s),n-=s,o-=s;var g=l.substring(n,o);return 0==(g=g.trim()).indexOf("\n")&&(g=(g=g.substring(1,g.length)).trim()),t.substring(0,s)+g}function PlayABC(t){if(gAllowCopy){var n;if(gIsMaximized){if(gPlayABCGotMaximizedPlay){if(""==(n=getTuneByIndex(gPlayABCTuneIndex)))return}else{var n=findSelectedTune();if(""==n)return;gPlayABCTuneIndex=findSelectedTuneIndex(),gPlayABCTuneCount=CountTunes(),gPlayABCGotMaximizedPlay=!0}}else{if(t&&t.shiftKey){TuneTrainer(!1);return}if(t&&t.altKey){if(gPlayABCTuneIndex=Math.floor(Math.random()*(gPlayABCTuneCount=CountTunes())),""==(n=getTuneByIndex(gPlayABCTuneIndex)))return}else{if(""==(n=findSelectedTune()))return;gPlayABCTuneIndex=findSelectedTuneIndex(),gPlayABCTuneCount=CountTunes(),-1==gPlayABCTuneIndex&&(n=getTuneByIndex(gPlayABCTuneIndex=0))}gPlayABCGotMaximizedPlay=!1}n=ProcessSelectRegionForPlay(n),n=PreProcessPlayABC(n),PlayABCDialog(n,null,null,null,gUseWidePlayer=!1)}}function TransformABCCompliantDirectives(t){return t=t.replaceAll("%%abctt:","%")}function PlayerSetupCommon(t){var n=ScanTuneForSoundFont(t);if(n){var o=gTheActiveSoundFont;switch(n){case"fluid":gTheActiveSoundFont="https://paulrosen.github.io/midi-js-soundfonts/FluidR3_GM/";break;case"musyng":gTheActiveSoundFont="https://paulrosen.github.io/midi-js-soundfonts/MusyngKite/";break;case"fatboy":gTheActiveSoundFont="https://michaeleskin.com/abctools/soundfonts/fatboy_4/";break;case"canvas":gTheActiveSoundFont="https://michaeleskin.com/abctools/soundfonts/canvas/";break;case"mscore":gTheActiveSoundFont="https://michaeleskin.com/abctools/soundfonts/mscore_2/";break;case"arachno":gTheActiveSoundFont="https://michaeleskin.com/abctools/soundfonts/arachno_3/";break;case"fluidhq":gTheActiveSoundFont="https://michaeleskin.com/abctools/soundfonts/fluidhq_1/"}gTheActiveSoundFont!=o&&(gSoundsCacheABCJS={})}else gTheActiveSoundFont!=gDefaultSoundFont&&(gTheActiveSoundFont=gDefaultSoundFont,gSoundsCacheABCJS={});ScanTuneForGMOverride(t);var a=ScanTuneForBodhranPitch(t);if(a){var r=gTheActiveBodhranPitch;(gTheActiveBodhranPitch=a)!=r&&(gSoundsCacheABCJS={})}else gTheActiveBodhranPitch!=gDefaultBodhranPitch&&(gTheActiveBodhranPitch=gDefaultBodhranPitch,gSoundsCacheABCJS={});var l=ScanTuneForBanjoStyle(t);if(l){var s=gTheActiveBanjoStyle;gTheActiveBanjoStyle=l,l!=s&&(gSoundsCacheABCJS={})}else gTheActiveBanjoStyle!=gDefaultBanjoStyle&&(gTheActiveBanjoStyle=gDefaultBanjoStyle,gSoundsCacheABCJS={});gOnlyHighlightV1=!1,gOnlyHighlightV1=ScanTuneForV1OnlyHighlight(t),gDisablePlayHighlight=!1,gDisablePlayHighlight=ScanTuneForDisablePlayHighlight(t),gForceRollUseRollForIrishRoll=!1,gForceRollUseRollForIrishRoll=ScanTuneForForceIrishRoll(t),gForceRollUseRollForIrishRollDisable=!1,gForceRollUseRollForIrishRollDisable=ScanTuneForForceIrishRollDisable(t),gDisablePlayHighlight&&(gOnlyHighlightV1=!1),gVoiceTuning=null,gSequenceCallback=null,(gVoiceTuning=ScanTuneForVoiceTuning(t))&&gVoiceTuning.length>0&&(gSequenceCallback=VoiceTuningCallback);var g=GetRadioValue("notenodertab");return gTabFirstStaffOnly=ScanTuneForTabFirstStaffOnly(t,g),gTabSecondStaffOnly=!1,gTabFirstStaffOnly||(gTabSecondStaffOnly=ScanTuneForTabSecondStaffOnly(t,g)),ScanTuneForReverb(t),!0}function VoiceTuningCallback(t,n){var o,a,r=t.length,l=gVoiceTuning.length;for(l<r&&(r=l),o=0;o<r;++o){var s=gVoiceTuning[o],g=t[o],c=g.length;for(a=0;a<c;++a)g[a].cents=s}}var gPlayABCTuneIndex=0,gPlayABCTuneCount=0,gPlayABCGotMaximizedPlay=!1;function PlayABCDialog(t,n,o,a,r){if(sendGoogleAnalytics("dialog","PlayABCDialog"),gMIDIbuffer=null,gTheOKButton=null,gPlayMetronome=!1,a?gPlayMetronome=a:(gPlayerABC=t,gPlayMetronome=!1,gPlayerABCMetronome=null),t=TransformABCCompliantDirectives(t),PlayerSetupCommon(t)){ScanTuneForCustomTimingInjection(t);var l,s=GetRadioValue("notenodertab"),g=GetABCJSParams(s);g.oneSvgPerLine=!1,"noten"!=s&&g.tablature&&g.tablature.length>0&&(g.tablature[0].label="");var c=new CursorControl;if(gIsIOS){var d=ABCJS.synth.activeAudioContext();gTheMuteHandle=null,d&&(gTheMuteHandle=unmute(d,!1,!1))}!function d(){if(gLoopCallback=null,gStartPlayCallback=null,gPreStartPlayCallback=null,gPlayerInPause=!1,modal_msg='<div id="playerholder" style="height:'+(window.innerHeight-340)+'px;overflow-y:auto;margin-bottom:15px;">',gLargePlayerControls?modal_msg+='<div id="abcplayer" class="abcjs-large">':modal_msg+='<div id="abcplayer">',modal_msg+='<div id="playback-paper"></div>',modal_msg+="</div>",modal_msg+="</div>",gLargePlayerControls?modal_msg+='<div id="playback-audio" class="abcjs-large"></div>':modal_msg+='<div id="playback-audio"></div>',modal_msg+='<p style="text-align:center;margin:0px;margin-top:10px">',modal_msg+='<input id="abcplayer_trainer" class="btn btn-looper abcplayer_trainer" onclick="TuneTrainerLaunchFromPlayer()" type="button" value="Start Tune Trainer" title="Opens the Tune Trainer for practicing tunes with increasing tempos">',modal_msg+='<input id="abcplayer_metronomebutton" class="abcplayer_metronome button btn btn-metronome" onclick="ToggleMetronome();" type="button" value="Enable Metronome" title="Enables/disables the metronome">',isDesktopBrowser()&&(modal_msg+='<input id="abcplayer_wideplayerbutton" class="abcplayer_wideplayerbutton button btn btn-wide-player" onclick="ToggleWidePlayer();" type="button" value="Wide View" title="Toggles the player between normal and wide views">'),modal_msg+='<input id="abcplayer_exportbutton" class="abcplayer_exportbutton btn btn-exportaudiomidi" onclick="ExportAudioOrImage();" type="button" value="Export Audio or Image" title="Brings up a dialog where you can save the tune in various audio and image formats">',modal_msg+='<input id="abcplayer_settingsbutton" class="abcplayer_settingsbutton btn btn-configuresettingsfromhelp" onclick="ShowPlayerSettings();" type="button" value="Settings" title="Brings up the Player Instrument Settings dialog where you can select the default abcjs soundfont, MIDI instruments, and MIDI volumes to use when playing tunes">',modal_msg+="</p>",modal_msg+='<p style="text-align:center;font-size:0pt;font-family:helvetica">&nbsp;</p>',modal_msg+='<a id="abcplayer_help" href="https://michaeleskin.com/app/userguide.html#playing_your_tunes" target="_blank" style="text-decoration:none;" title="Learn more about the Player" class="dialogcornerbutton">?</a>',gPlayABCTuneCount>1){gPlayerStatusOnLeft?modal_msg+='<p id="playerstatus_left" class="playerstatus_left">':modal_msg+='<p id="playerstatus" class="playerstatus">',modal_msg+='<input id="abcplayer_previousbutton" class="abcplayer_previousbutton btn btn-playerprevious" onclick="PlayPrevious(event);" type="button" value="&nbsp;&nbsp;" title="Play the previous tune.&nbsp;&nbsp;Shift-click to jump to the first tune.">Tune '+(gPlayABCTuneIndex+1)+" of "+gPlayABCTuneCount+'<input id="abcplayer_nextbutton" class="abcplayer_nextbutton btn btn-playernext" onclick="PlayNext(event);" type="button" value="&nbsp;&nbsp;" title="Play the next tune.&nbsp;&nbsp;Shift-click to jump to the last tune.">',modal_msg+='<br/><select id="playertunelist" onchange="PlaySelectedTune();" title="Select a tune to play from the list">',totalTunes=CountTunes();for(var p,m,h,f,A,b=GetTunebookIndexTitles(),T=b.length,y=0;y<T;++y)modal_msg+='<option value="'+y+'">'+b[y]+"</option>";modal_msg+="</select></p>"}var I=window.innerWidth;if(GetRadioValue("notenodertab"),isDesktopBrowser()?(m=calc_wide_play_width(200),(p=r?m:.45*I)<850&&(p=850)):p=800,DayPilot.Modal.alert(modal_msg,{theme:"modal_flat",top:40,width:p,okText:"Close",scrollWithPage:isMobileBrowser()}),gPlayABCTuneCount>1){var v=document.getElementById("abcplayer_previousbutton");gPlayABCTuneIndex>0?(v.disabled=!1,v.style.opacity=1):(v.disabled=!0,v.style.opacity=.25),v=document.getElementById("abcplayer_nextbutton"),gPlayABCTuneIndex<gPlayABCTuneCount-1?(v.disabled=!1,v.style.opacity=1):(v.disabled=!0,v.style.opacity=.25),document.getElementById("playertunelist").value=gPlayABCTuneIndex}if("whistle"==GetRadioValue("notenodertab")&&(document.getElementById("abcplayer_exportbutton").value="Export Audio",document.getElementById("abcplayer_exportbutton").title="Brings up a dialog where you can save the tune in various audio formats"),a&&!0==a){var v=document.getElementById("abcplayer_metronomebutton");v.value="Disable Metronome"}if(isDesktopBrowser()){if(!r&&m<=p)document.getElementById("abcplayer_wideplayerbutton").style.display="none";else if(r&&!0==r){var v=document.getElementById("abcplayer_wideplayerbutton");v.value="Normal View"}}for(var C=document.getElementsByClassName("modal_flat_ok"),S=null,y=0;y<C.length;++y)if("Close"==(S=C[y]).innerText){gTheOKButton=S;var _=S.onclick;S.onclick=function(){_(),u(),FocusAfterOperation(),gIsIOS&&gTheMuteHandle&&(gTheMuteHandle.dispose(),gTheMuteHandle=null)};break}ABCJS.synth.supportsAudio()?(l=new ABCJS.synth.SynthController(t)).load("#playback-audio",c,{displayLoop:!0,displayRestart:!0,displayPlay:!0,displayProgress:!0,displayWarp:!0}):document.querySelector("#playback-audio").innerHTML="<div class='audio-error'>Audio is not supported in this browser.</div>",h=!1,l.disable(!0),f=ABCJS.renderAbc("playback-paper",t,g)[0],postProcessTab([f],"playback-paper",s,!0),gMIDIbuffer=A=new ABCJS.synth.CreateSynth(t),gMIDIInitStillWaiting=!1,A.init({visualObj:f}).then(function(a){if(console.log(a),l){var r=computeFade(t);l.setTune(f,h,{fadeLength:r}).then(function(t){if(console.log("Audio successfully loaded."),gSynthControl=l,n&&n(o,gTheOKButton),gTrainerTouchControls){var a=document.getElementsByClassName("abcjs-midi-clock"),r=document.getElementsByClassName("abcjs-midi-current-tempo-wrapper");if(a&&r&&a.length>0&&r.length>0){var s=a[0];s.onclick=DecrementTempo,(s=r[0]).onclick=IncrementTempo}}}).catch(function(t){document.getElementById("loading-bar-spinner").style.display="none",gMIDIInitStillWaiting=!1,console.log("Problem loading audio for this tune")})}}).catch(function(t){document.getElementById("loading-bar-spinner").style.display="none",gMIDIInitStillWaiting=!1,console.log("Problem loading audio for this tune")}),gPlayerContainerRect=(gPlayerHolder=document.getElementById("playerholder")).getBoundingClientRect()}()}function u(){gSynthControl=null,l&&(l.destroy(),l=null)}}function PreProcessPlayABC(t){t=processAllStripping(t);var n=!1;if(gOverridePlayMIDIParams&&(t=OverrideOneTuneMIDIParams(t,gDefaultSoundFont,gTheMelodyProgram,gTheBassProgram,gTheChordProgram,gTheBassVolume,gTheChordVolume),n=!0),gAlwaysInjectPrograms){var o=/^%%MIDI chordprog.*$/m,a=t.match(o),r=!1;a&&a.length>0||(r=!0,t=InjectOneTuneMIDIProgramAboveTune(t,gTheChordProgram,!1,!0));var o=/^%%MIDI bassprog.*$/m,l=t.match(o);if(!(l&&l.length>0)){if(n)t=InjectOneTuneMIDIProgramAboveTune(t,gTheBassProgram,!0,!1);else if(r)t=InjectOneTuneMIDIProgramAboveTune(t,gTheBassProgram,!0,!1);else{var s=a[0].replace("%%MIDI chordprog","");theBassProgam=s.trim(),t=InjectOneTuneMIDIProgramAboveTune(t,s,!0,!1)}}o=/^%%MIDI program.*$/m;var g=t.match(o);g&&g.length>0||(t=InjectOneTuneMIDIProgramAboveTune(t,gTheMelodyProgram,!1,!1))}if(gAlwaysInjectVolumes){var o=/^%%MIDI bassvol.*$/m,c=t.match(o);c&&c.length>0||(t=InjectOneTuneMIDIVolumeAboveTune(t,gTheBassVolume,!1));var o=/^%%MIDI chordvol.*$/m,d=t.match(o);d&&d.length>0||(t=InjectOneTuneMIDIVolumeAboveTune(t,gTheChordVolume,!0))}if(gReverbString&&""!=gReverbString){var o=/^%reverb.*$/m,u=t.match(o);u&&u.length>0||(t=InjectReverbAboveTune(t,gReverbString))}var p=t.indexOf("%incipits_inject_start");if(-1!=p){var m=t.substring(0,p),h="%incipits_inject_end",f=t.indexOf(h);f+=h.length+1,m+=t.substring(f,t.length),t=m}gUseGChord=!1;var o=/%%MIDI gchord\b/,A=o.test(t);if(A&&(gUseGChord=!0),!gUseGChord){var o=/\[I:\s*MIDI[\s=]+gchord\s.*\]/,A=o.test(t);A&&(gUseGChord=!0)}return t}function tuneIsHornpipe(t){var n=/^R:Hornpipe.*$/gm,o=t.match(n);return!!o&&o.length>0||(n=/^R: Hornpipe.*$/gm,!!(o=t.match(n))&&o.length>0||(n=/^R:hornpipe.*$/gm,!!(o=t.match(n))&&o.length>0||(n=/^R: hornpipe.*$/gm,!!(o=t.match(n))&&!!(o.length>0))))}function validate_roll_2_params(t,n){var o=t.split(" ");if(o&&8!=o.length)return!1;var a=o[0],r=o[1],l=o[2],s=o[3],g=o[4],c=o[5],d=o[6],u=o[7];return a=parseFloat(a),r=parseFloat(r),l=parseFloat(l),s=parseFloat(s),g=parseFloat(g),c=parseFloat(c),d=parseFloat(d),u=parseFloat(u),!isNaN(a)&&!isNaN(r)&&!isNaN(l)&&!isNaN(s)&&!isNaN(g)&&!isNaN(c)&&!isNaN(d)&&!isNaN(u)&&a>=0&&r>=0&&l>=0&&l<=1&&s>=0&&s<=1&&g>=0&&g<=1&&c>=0&&c<=2&&d>=0&&d<=2&&u>=0&&u<=2&&a+r<3&&(n&&(gRoll2Duration1=a,gRoll2Duration2=r,gRoll2Fraction1=l,gRoll2Fraction2=s,gRoll2Fraction3=g,gRoll2Volume1=c,gRoll2Volume2=d,gRoll2Volume3=u),!0)}function validate_roll_3_params(t,n){var o=t.split(" ");if(o&&8!=o.length)return!1;var a=o[0],r=o[1],l=o[2],s=o[3],g=o[4],c=o[5],d=o[6],u=o[7];return(a=parseFloat(a),r=parseFloat(r),l=parseFloat(l),s=parseFloat(s),g=parseFloat(g),c=parseFloat(c),d=parseFloat(d),u=parseFloat(u),isNaN(a)||isNaN(r)||isNaN(l)||isNaN(s)||isNaN(g)||isNaN(c)||isNaN(d)||isNaN(u))?(console.log("roll3 validation fail2"),!1):a>=0&&r>=0&&l>=0&&l<=1&&s>=0&&s<=1&&g>=0&&g<=1&&c>=0&&c<=2&&d>=0&&d<=2&&u>=0&&u<=2&&a+r<3&&(n&&(gRoll3Duration1=a,gRoll3Duration2=r,gRoll3Fraction1=l,gRoll3Fraction2=s,gRoll3Fraction3=g,gRoll3Volume1=c,gRoll3Volume2=d,gRoll3Volume3=u),!0)}function ScanTuneForCustomTimingInjection(t){if(gAddSwing=!1,gAddABCJSSwing=!1,gSwingFactor=gAutoSwingFactor,gAutoSwingHornpipes&&(gAddSwing=tuneIsHornpipe(t)),n=/^%swing.*$/gm,(o=t.match(n))&&o.length>0){gAddSwing=!0;var n,o,a=o[0].replace("%swing",""),r=(a=a.trim()).split(" ");if(r.length>=1){var l=parseFloat(r[0]);isNaN(l)||(gSwingFactor=l)}}n=/^%noswing.*$/gm,(o=t.match(n))&&o.length>0&&(gAddSwing=!1),n=/^%grace_duration_ms.*$/gm;var s=t.match(n);if(gGraceDuration=.045,s&&s.length>0){var a=s[0].replace("%grace_duration_ms",""),r=(a=a.trim()).split(" ");if(r.length>=1){var g=parseInt(r[0]);!isNaN(g)&&g>=0&&g<=150&&(gGraceDuration=g/1e3)}}gGraceMissingTempo=!0,n=/^Q:.*$/gm;var c=t.match(n);c&&c.length>0&&(gGraceMissingTempo=!1),gGraceTuneType=getTuneRhythmType(t),validate_roll_2_params(gRoll2DefaultParams,!0)||(gRoll2Duration1=.95,gRoll2Duration2=.8,gRoll2Fraction1=1,gRoll2Fraction2=.75,gRoll2Fraction3=.9,gRoll2Volume1=1,gRoll2Volume2=.75,gRoll2Volume3=1),n=/^%roll_2_params.*$/gm;var d=t.match(n);if(d&&d.length>0){var a=d[0].replace("%roll_2_params","");validate_roll_2_params(a=a.trim(),!0)}validate_roll_3_params(gRoll3DefaultParams,!0)||(gRoll3Duration1=1.45,gRoll3Duration2=.6,gRoll3Fraction1=1,gRoll3Fraction2=.75,gRoll3Fraction3=.9,gRoll3Volume1=1,gRoll3Volume2=.75,gRoll3Volume3=1),n=/^%roll_3_params.*$/gm;var u=t.match(n);if(u&&u.length>0){var a=u[0].replace("%roll_3_params","");validate_roll_3_params(a=a.trim(),!0)}gRollUseOriginalRollSolution=!1,n=/^%use_original_abcjs_roll_solution.*$/gm;var p=t.match(n);p&&p.length>0&&(gRollUseOriginalRollSolution=!0)}function ScanTuneForSoundFont(t){var n=null,o=t.match(/^%abcjs_soundfont.*$/gm);return o&&o.length>0&&(n=(n=(n=o[o.length-1].replace("%abcjs_soundfont","")).trim()).toLowerCase()),n}function ScanTuneForGMOverride(t){var n=gOverrideCustomGMSounds,o=gCustomGMSoundsOverride;gOverrideCustomGMSounds=!1,gCustomGMSoundsOverride=!1;var a=null,r=t.match(/^%use_custom_gm_sounds.*$/gm);r&&r.length>0&&("true"==(a=(a=(a=r[r.length-1].replace("%use_custom_gm_sounds","")).trim()).toLowerCase())&&(gOverrideCustomGMSounds=!0,gCustomGMSoundsOverride=!0),"false"==a&&(gOverrideCustomGMSounds=!0,gCustomGMSoundsOverride=!1)),(gOverrideCustomGMSounds!=n||o!=gCustomGMSoundsOverride)&&(gSoundsCacheABCJS={})}function ScanTuneForBodhranPitch(t){var n=null,o=/^%bodhran_tuning.*$/gm,a=t.match(o);return a&&a.length>0&&(n=(n=(n=a[a.length-1].replace("%bodhran_tuning","")).trim()).toLowerCase()),!n&&(o=/^%bodhran_pitch.*$/gm,(a=t.match(o))&&a.length>0&&(n=(n=(n=a[a.length-1].replace("%bodhran_pitch","")).trim()).toLowerCase())),n}function ScanTuneForBanjoStyle(t){var n=null,o=t.match(/^%banjo_style.*$/gm);switch(o&&o.length>0&&(n=(n=o[o.length-1].replace("%banjo_style","")).trim()),n){case"0":case"1":case"2":case"3":case"4":break;default:return null}return n}function ScanTuneForV1OnlyHighlight(t){var n=t.match(/^%play_highlight_v1_only.*$/gm);return!!n&&!!(n.length>0)}function ScanTuneForDisablePlayHighlight(t){var n=t.match(/^%disable_play_highlight.*$/gm);return!!n&&!!(n.length>0)}function ScanTuneForForceIrishRoll(t){var n=t.match(/^%irish_rolls_on.*$/gm);return!!n&&!!(n.length>0)}function ScanTuneForForceIrishRollDisable(t){var n=t.match(/^%irish_rolls_off.*$/gm);return!!n&&!!(n.length>0)}function ScanTuneForVoiceTuning(t){var n=t.match(/^%voice_tuning_cents.*$/gm);if(n&&n.length>0){var o=n[0].replace("%voice_tuning_cents",""),a=(o=o.match(/(?:^|\s)(-?\d+(?:\.\d+)?)(?=\s|$)/g)).length;if(a>0){var r,l,s=[];for(r=0;r<a;++r)l=parseFloat(o[r]),isNaN(l)?s.push(0):s.push(l);return s}}return null}function ScanTuneForTabFirstStaffOnly(t,n){if("whistle"==n||"notenames"==n)return!1;var o=t.match(/^%tab_first_voice_only.*$/gm);return!!o&&!!(o.length>0)}function ScanTuneForTabSecondStaffOnly(t,n){if("whistle"==n||"notenames"==n)return!1;var o=t.match(/^%tab_first_voice_exclude.*$/gm);return!!o&&!!(o.length>0)}function ScanTuneForReverb(t){if(gSamplesOnline||gAllowOfflineInstruments){var n=["room","room1","room2","room3","chamber","chamber1","chamber2","chamber3","hall","hall1","hall2","hall3","church","church1","custom"];gEnableReverb=!1;var o=t.match(/^%reverb.*$/gm);if(o&&o.length>0){var a,r,l,s=!1,g=!1,c=!1,d=o[0].replace("%reverb",""),u=(d=d.trim()).match(/[a-zA-Z0-9.]+/g);if(u&&u.length>0){if(u.length>=1){a=(a=u[0]).trim();for(var p=0;p<n.length;++p)if(a==n[p]){s=!0;break}}if(u.length>=2&&(r=parseFloat(r=(r=u[1]).trim()),!isNaN(r)&&r>=0&&(g=!0)),u.length>=3&&(l=parseFloat(l=(l=u[2]).trim()),!isNaN(l)&&l>=0&&(c=!0)),s&&g&&c){var m=gReverbStyle;gEnableReverb=!0,gReverbStyle=a,gReverbDry=r,gReverbWet=l,gReverbStyle!=m&&(gSoundsCacheABCJS={})}}}}}function SwingExplorer(){if(gAllowCopy){var t=findSelectedTune();if(""!=t){var n=PreProcessPlayABC(t);SwingExplorerDialog(t,n,!1)}}}function SwingExplorerRegenerate(){var t=!1,n=document.getElementById("swing_explorer_factor").value;n=parseFloat(n),!isNaN(n)&&n>=-.9&&n<=.9&&(gSwingFactor=n,t=!0),t&&(gTheOKButton.click(),setTimeout(function(){SwingExplorerDialog(gPlayerABCSwingExplorerOriginal,gPlayerABCSwingExplorerProcessed,!0)},250))}function ScanTuneForSwingExplorer(t){if(gAddSwing=!0,gSwingFactor=0,gAutoSwingHornpipes&&tuneIsHornpipe(t)&&(gSwingFactor=gAutoSwingFactor),n=/^%swing.*$/gm,(o=t.match(n))&&o.length>0){var n,o,a=o[0].replace("%swing",""),r=(a=a.trim()).split(" ");if(r.length>=1){var l=parseFloat(r[0]);isNaN(l)||(gSwingFactor=l)}}}function SwingExplorerInject(){var t=!1,n=document.getElementById("swing_explorer_factor").value;if(n=parseFloat(n),!isNaN(n)&&n>=-.9&&n<=.9&&(t=!0),t){var o="%swing "+n,a=/^%swing.*[\r\n]*/gm,r=gPlayerABCSwingExplorerOriginal.replaceAll(a,""),l=InjectStringBelowTuneHeader(r,o);l=l.replace("\n\n","");var s=gTheABC.selectionStart,g=gTheABC.value;g=g.replace(gPlayerABCSwingExplorerOriginal,l),gTheABC.value=g,gIsDirty=!0,gPlayerABCSwingExplorerOriginal=l,gRawMode?RenderAsync(!0,null,function(){DayPilot.Modal.alert('<p style="text-align:center;font-size:14pt;font-family:helvetica;">Swing Injection Complete!</p>',{theme:"modal_flat",top:300,width:500,scrollWithPage:AllowDialogsToScroll()}).then(function(){gTheABC.selectionStart=s,gTheABC.selectionEnd=s,FocusAfterOperation()})}):DayPilot.Modal.alert('<p style="text-align:center;font-size:14pt;font-family:helvetica;">Swing Injection Complete!</p>',{theme:"modal_flat",top:300,width:500,scrollWithPage:AllowDialogsToScroll()}).then(function(){gTheABC.selectionStart=s,gTheABC.selectionEnd=s,FocusAfterOperation()})}}var gPlayerABCSwingExplorerOriginal=null,gPlayerABCSwingExplorerProcessed=null;function SwingExplorerDialog(t,n,o){if(sendGoogleAnalytics("dialog","SwingExplorerDialog"),gMIDIbuffer=null,gTheOKButton=null,gUseWidePlayer=!1,o||(gPlayerABCSwingExplorerOriginal=t,gPlayerABCSwingExplorerProcessed=n),n=TransformABCCompliantDirectives(n),PlayerSetupCommon(n)){o||(ScanTuneForCustomTimingInjection(n),ScanTuneForSwingExplorer(n));var a,r=GetRadioValue("notenodertab"),l=GetABCJSParams(r);l.oneSvgPerLine=!1,"noten"!=r&&l.tablature&&l.tablature.length>0&&(l.tablature[0].label="");var s=new CursorControl;if(gIsIOS){var g=ABCJS.synth.activeAudioContext();gTheMuteHandle=null,g&&(gTheMuteHandle=unmute(g,!1,!1))}!function t(){gLoopCallback=null,gStartPlayCallback=null,gPreStartPlayCallback=null,gPlayerInPause=!1,modal_msg='<div id="playerholder" style="height:'+(window.innerHeight-400)+'px;overflow-y:auto;margin-bottom:15px;">',gLargePlayerControls?modal_msg+='<div id="abcplayer" class="abcjs-large">':modal_msg+='<div id="abcplayer">',modal_msg+='<div id="playback-paper"></div>',modal_msg+="</div>",modal_msg+="</div>",gLargePlayerControls?modal_msg+='<div id="playback-audio" class="abcjs-large"></div>':modal_msg+='<div id="playback-audio"></div>',isMobileBrowser()?(modal_msg+='<p class="configure_swingexplorer_text_mobile" style="text-align:center;margin:0px;margin-top:22px">',modal_msg+='Swing factor: <input style="width:80px;" id="swing_explorer_factor" type="number" min="-0.9" step="0.05" max=".9" title="Swing factor, range is -0.9 to 0.9" autocomplete="off"/>',modal_msg+="</p>",modal_msg+='<p class="configure_swingexplorer_text_mobile" style="text-align:center;margin:0px;margin-top:22px">',modal_msg+='<input id="swingexplorertest" class="swingexplorertest button btn btn-swingexplorertest" onclick="SwingExplorerRegenerate();" type="button" value="Reload Tune with Changed Swing Setting" title="Reloads the tune into the player with the entered swing factor">',modal_msg+='<input id="swingexplorerinject" class="swingexplorerinject button btn btn-swingexplorerinject" onclick="SwingExplorerInject();" type="button" style="margin-right:0px;" value="Inject Swing into the ABC" title="Injects the current swing factor into the tune ABC">',modal_msg+="</p>",modal_msg+='<a id="swingexplorerhelp" href="https://michaeleskin.com/app/userguide.html#swing_explorer" target="_blank" style="text-decoration:none;" title="Learn more about the Swing Explorer" class="dialogcornerbutton">?</a>'):(modal_msg+='<p class="configure_swingexplorer_text" style="text-align:center;margin:0px;margin-top:22px">',modal_msg+='Swing factor (range is -0.9 to 0.9): <input style="width:90px;" id="swing_explorer_factor" type="number" min="-0.9" step="0.05" max=".9" title="Swing factor, range is -0.9 to 0.9" autocomplete="off"/>',modal_msg+="</p>",modal_msg+='<p class="configure_swingexplorer_text" style="text-align:center;margin:0px;margin-top:22px">',modal_msg+='<input id="swingexplorertest" class="swingexplorertest button btn btn-swingexplorertest" onclick="SwingExplorerRegenerate();" type="button" value="Reload Tune with Changed Swing Setting" title="Reloads the tune into the player with the entered swing factor">',modal_msg+='<input id="swingexplorerinject" class="swingexplorerinject button btn btn-swingexplorerinject" onclick="SwingExplorerInject();" type="button" style="margin-right:0px;" value="Inject Swing into the ABC" title="Injects the current swing factor into the tune ABC">',modal_msg+="</p>",modal_msg+='<a id="swingexplorerhelp" href="https://michaeleskin.com/app/userguide.html#swing_explorer" target="_blank" style="text-decoration:none;" title="Learn more about the Swing Explorer" class="dialogcornerbutton">?</a>');var o,g,d,u=window.innerWidth;GetRadioValue("notenodertab");var p=.45*u;isDesktopBrowser()?p<850&&(p=850):p=800,DayPilot.Modal.alert(modal_msg,{theme:"modal_flat",top:50,width:p,okText:"Close",scrollWithPage:isMobileBrowser()}),document.getElementById("swing_explorer_factor").value=gSwingFactor;for(var m=document.getElementsByClassName("modal_flat_ok"),h=null,f=0;f<m.length;++f)if("Close"==(h=m[f]).innerText){gTheOKButton=h;var A=h.onclick;h.onclick=function(){A(),c(),FocusAfterOperation(),gIsIOS&&gTheMuteHandle&&(gTheMuteHandle.dispose(),gTheMuteHandle=null)};break}ABCJS.synth.supportsAudio()?(a=new ABCJS.synth.SynthController(n)).load("#playback-audio",s,{displayLoop:!0,displayRestart:!0,displayPlay:!0,displayProgress:!0,displayWarp:!0}):document.querySelector("#playback-audio").innerHTML="<div class='audio-error'>Audio is not supported in this browser.</div>",o=!1,a.disable(!0),g=ABCJS.renderAbc("playback-paper",n,l)[0],postProcessTab([g],"playback-paper",r,!0),gMIDIbuffer=d=new ABCJS.synth.CreateSynth(n),gMIDIInitStillWaiting=!1,d.init({visualObj:g}).then(function(t){if(console.log(t),a){var r=computeFade(n);a.setTune(g,o,{fadeLength:r}).then(function(t){if(console.log("Audio successfully loaded."),gSynthControl=a,gTrainerTouchControls){var n=document.getElementsByClassName("abcjs-midi-clock"),o=document.getElementsByClassName("abcjs-midi-current-tempo-wrapper");if(n&&o&&n.length>0&&o.length>0){var r=n[0];r.onclick=DecrementTempo,(r=o[0]).onclick=IncrementTempo}}}).catch(function(t){document.getElementById("loading-bar-spinner").style.display="none",gMIDIInitStillWaiting=!1,console.log("Problem loading audio for this tune")})}}).catch(function(t){document.getElementById("loading-bar-spinner").style.display="none",gMIDIInitStillWaiting=!1,console.log("Problem loading audio for this tune")}),gPlayerContainerRect=(gPlayerHolder=document.getElementById("playerholder")).getBoundingClientRect()}()}function c(){gSynthControl=null,a&&(a.destroy(),a=null)}}function ReverbExplorer(){if(gAllowCopy){var t=findSelectedTune();if(""!=t){var n=PreProcessPlayABC(t);ReverbExplorerDialog(t,n,!1)}}}function ReverbExplorerRegenerate(){gReverbExplorerStyle=document.getElementById("reverb_explorer_settings").value,gReverbExplorerDry=document.getElementById("reverb_explorer_dry").value,gReverbExplorerWet=document.getElementById("reverb_explorer_wet").value,gTheOKButton.click(),setTimeout(function(){ReverbExplorerDialog(gPlayerReverbExplorerOriginal,gPlayerReverbExplorerProcessed,!0)},250)}function ScanTuneForReverbExplorer(t){var n=["off","room","room1","room2","room3","chamber","chamber1","chamber2","chamber3","hall","hall1","hall2","hall3","church","church1","custom"],o=t.match(/^%reverb.*$/gm);if(gReverbExplorerDry=1,gReverbExplorerWet=0,gReverbExplorerStyle=0,o&&o.length>0){var a,r,l,s=!1,g=!1,c=!1,d=!1,u=o[0].replace("%reverb",""),p=(u=u.trim()).match(/[a-zA-Z0-9.]+/g);if(p&&p.length>0){if(p.length>=1){a=(a=p[0]).trim();for(var m=0;m<n.length;++m)if(a==n[m]){s=!0;break}}if(p.length>=2&&(r=parseFloat(r=(r=p[1]).trim()),!isNaN(r)&&r>=0&&(g=!0)),p.length>=3&&(l=parseFloat(l=(l=p[2]).trim()),!isNaN(l)&&l>=0&&(c=!0)),"off"==a&&(d=!0,r=1,l=0),d||s&&g&&c)switch(gReverbExplorerDry=r,gReverbExplorerWet=l,a){case"off":default:gReverbExplorerStyle=0;break;case"room":gReverbExplorerStyle=1;break;case"room1":gReverbExplorerStyle=2;break;case"room2":gReverbExplorerStyle=3;break;case"room3":gReverbExplorerStyle=4;break;case"chamber":gReverbExplorerStyle=5;break;case"chamber1":gReverbExplorerStyle=6;break;case"chamber2":gReverbExplorerStyle=7;break;case"chamber3":gReverbExplorerStyle=8;break;case"hall":gReverbExplorerStyle=9;break;case"hall1":gReverbExplorerStyle=10;break;case"hall2":gReverbExplorerStyle=11;break;case"hall3":gReverbExplorerStyle=12;break;case"church":gReverbExplorerStyle=13;break;case"church1":gReverbExplorerStyle=14;break;case"custom":gReverbExplorerStyle=15}}}}function ReverbExplorerInject(){var t=document.getElementById("reverb_explorer_settings").value;t=(t=(t=reverbSettingsNames[t]).replace(" ","")).toLowerCase();var n=!1;"off"==t&&(n=!0);var o=!1,a=document.getElementById("reverb_explorer_dry").value;a=parseFloat(a),!isNaN(a)&&a>=0&&a<=10&&(o=!0);var r=!1,l=document.getElementById("reverb_explorer_wet").value;if(l=parseFloat(l),!isNaN(l)&&l>=0&&l<=10&&(r=!0),n||o&&r){s=n?"%reverb off":"%reverb "+t+" "+a+" "+l;var s,g=/^%reverb.*[\r\n]*/gm,c=gPlayerReverbExplorerOriginal.replaceAll(g,""),d=InjectStringBelowTuneHeader(c,s);d=d.replace("\n\n","");var u=gTheABC.selectionStart,p=gTheABC.value;p=p.replace(gPlayerReverbExplorerOriginal,d),gTheABC.value=p,gIsDirty=!0,gPlayerReverbExplorerOriginal=d,gRawMode?RenderAsync(!0,null,function(){DayPilot.Modal.alert('<p style="text-align:center;font-size:14pt;font-family:helvetica;">Reverb Injection Complete!</p>',{theme:"modal_flat",top:300,width:500,scrollWithPage:AllowDialogsToScroll()}).then(function(){gTheABC.selectionStart=u,gTheABC.selectionEnd=u,FocusAfterOperation()})}):DayPilot.Modal.alert('<p style="text-align:center;font-size:14pt;font-family:helvetica;">Reverb Injection Complete!</p>',{theme:"modal_flat",top:300,width:500,scrollWithPage:AllowDialogsToScroll()}).then(function(){gTheABC.selectionStart=u,gTheABC.selectionEnd=u,FocusAfterOperation()})}}function ReverbExplorerDialogInjectThisTune(t){var n=!1,o=reverbSettingsNames[gReverbExplorerStyle];return"off"==(o=(o=o.replace(" ","")).toLowerCase())&&(n=!0),theInjectString=n?"%reverb off":"%reverb "+o+" "+gReverbExplorerDry+" "+gReverbExplorerWet,t=(t=InjectStringBelowTuneHeader(t=t.replaceAll(/^%reverb.*[\r\n]*/gm,""),theInjectString)).replace("\n\n","")}var gReverbExplorerStyle=0,gReverbExplorerDry=0,gReverbExplorerWet=0,gPlayerReverbExplorerOriginal=null,gPlayerReverbExplorerProcessed=null,gReverbExplorerSettings=null;const reverbSettingsNames=["Off","Room","Room 1","Room 2","Room 3","Chamber","Chamber 1","Chamber 2","Chamber 3","Hall","Hall 1","Hall 2","Hall 3","Church","Church 1","Custom"];function idleReverbExplorer(){idleAdvancedSettings()}function ReverbExplorerDialog(t,n,o){if(sendGoogleAnalytics("dialog","ReverbExplorerDialog"),gMIDIbuffer=null,gTheOKButton=null,gUseWidePlayer=!1,o||(gPlayerReverbExplorerOriginal=t,gPlayerReverbExplorerProcessed=n),n=TransformABCCompliantDirectives(n),PlayerSetupCommon(n)){o||(ScanTuneForCustomTimingInjection(n),ScanTuneForReverbExplorer(n)),gReverbExplorerSettings||(gReverbExplorerSettings=InstrumentExplorerBuildDropdown("reverb_explorer_settings",reverbSettingsNames)),ScanTuneForReverb(n=ReverbExplorerDialogInjectThisTune(gPlayerReverbExplorerProcessed));var a,r=GetRadioValue("notenodertab"),l=GetABCJSParams(r);l.oneSvgPerLine=!1,"noten"!=r&&l.tablature&&l.tablature.length>0&&(l.tablature[0].label="");var s=new CursorControl;if(gIsIOS){var g=ABCJS.synth.activeAudioContext();gTheMuteHandle=null,g&&(gTheMuteHandle=unmute(g,!1,!1))}!function t(){gLoopCallback=null,gStartPlayCallback=null,gPreStartPlayCallback=null,gPlayerInPause=!1,modal_msg='<div id="playerholder" style="height:'+(window.innerHeight-400)+'px;overflow-y:auto;margin-bottom:15px;">',gLargePlayerControls?modal_msg+='<div id="abcplayer" class="abcjs-large">':modal_msg+='<div id="abcplayer">',modal_msg+='<div id="playback-paper"></div>',modal_msg+="</div>",modal_msg+="</div>",gLargePlayerControls?modal_msg+='<div id="playback-audio" class="abcjs-large"></div>':modal_msg+='<div id="playback-audio"></div>',isMobileBrowser()?(modal_msg+='<p class="configure_reverbexplorer_text_mobile" style="text-align:center;margin:0px;margin-top:22px">',modal_msg+="Reverb style:"+gReverbExplorerSettings,modal_msg+='&nbsp;&nbsp;&nbsp;Dry signal fraction: <input style="width:80px;" id="reverb_explorer_dry" type="number" min="0" step="0.05" max="5" title="How much of the original sound gets mixed in" autocomplete="off"/>',modal_msg+='Wet signal fraction: <input style="width:80px;" id="reverb_explorer_wet" type="number" min="0" step="0.05" max="5" title="How much of the reverb gets mixed in" autocomplete="off"/>',modal_msg+="</p>",modal_msg+='<p class="configure_reverbexplorer_text_mobile" style="text-align:center;margin:0px;margin-top:22px">',modal_msg+='<input id="reverbexplorertest" class="reverbexplorertest button btn btn-reverbexplorertest" onclick="ReverbExplorerRegenerate();" type="button" value="Reload with Changed Reverb Settings" title="Reloads the tune into the player with the entered reverb settings">',modal_msg+='<input id="reverbexplorerinject" class="reverbexplorerinject button btn btn-reverbexplorerinject" onclick="ReverbExplorerInject();" type="button" style="margin-right:24px;" value="Inject Reverb into the ABC" title="Injects the current reverb settings into the tune ABC">',modal_msg+='<label class="loadimpulsebutton btn btn-reverbexplorerinject" for="loadimpulsebutton" title="Load a custom reverb convolution impulse .wav file">Load Custom Reverb Impulse <input type="file" id="loadimpulsebutton"  accept=".wav,.WAV" hidden/></label>',modal_msg+="</p>",modal_msg+='<a id="reverbexplorerhelp" href="https://michaeleskin.com/app/userguide.html#reverb_explorer" target="_blank" style="text-decoration:none;" title="Learn more about the Reverb Explorer" class="dialogcornerbutton">?</a>'):(modal_msg+='<p class="configure_reverbexplorer_text" style="text-align:center;margin:0px;margin-top:22px">',modal_msg+="Reverb style:"+gReverbExplorerSettings,modal_msg+='&nbsp;&nbsp;&nbsp;Dry signal fraction: <input style="width:80px;" id="reverb_explorer_dry" type="number" min="0" step="0.05" max="5" title="How much of the original sound gets mixed in" autocomplete="off"/>',modal_msg+='Wet signal fraction: <input style="width:80px;" id="reverb_explorer_wet" type="number" min="0" step="0.05" max="5" title="How much of the reverb gets mixed in" autocomplete="off"/>',modal_msg+="</p>",modal_msg+='<p class="configure_reverbexplorer_text" style="text-align:center;margin:0px;margin-top:22px">',modal_msg+='<input id="reverbexplorertest" class="reverbexplorertest button btn btn-reverbexplorertest" onclick="ReverbExplorerRegenerate();" type="button" value="Reload Tune with Changed Reverb Settings" title="Reloads the tune into the player with the entered reverb settings">',modal_msg+='<input id="reverbexplorerinject" class="reverbexplorerinject button btn btn-reverbexplorerinject" onclick="ReverbExplorerInject();" type="button" style="margin-right:24px;" value="Inject Reverb into the ABC" title="Injects the current reverb settings into the tune ABC">',modal_msg+='<label class="loadimpulsebutton btn btn-reverbexplorerinject" for="loadimpulsebutton" title="Load a custom reverb convolution impulse .wav file">Load Custom Reverb Impulse <input type="file" id="loadimpulsebutton"  accept=".wav,.WAV" hidden/></label>',modal_msg+="</p>",modal_msg+='<a id="reverbexplorerhelp" href="https://michaeleskin.com/app/userguide.html#reverb_explorer" target="_blank" style="text-decoration:none;" title="Learn more about the Swing Explorer" class="dialogcornerbutton">?</a>');var o,g,d,u=window.innerWidth;GetRadioValue("notenodertab");var p=.45*u;isDesktopBrowser()?p<850&&(p=850):p=800,DayPilot.Modal.alert(modal_msg,{theme:"modal_flat",top:50,width:p,okText:"Close",scrollWithPage:isMobileBrowser()}),setTimeout(function(){idleReverbExplorer()},100),document.getElementById("reverb_explorer_dry").value=gReverbExplorerDry,document.getElementById("reverb_explorer_wet").value=gReverbExplorerWet,document.getElementById("reverb_explorer_settings").value=gReverbExplorerStyle;for(var m=document.getElementsByClassName("modal_flat_ok"),h=null,f=0;f<m.length;++f)if("Close"==(h=m[f]).innerText){gTheOKButton=h;var A=h.onclick;h.onclick=function(){A(),c(),FocusAfterOperation(),gIsIOS&&gTheMuteHandle&&(gTheMuteHandle.dispose(),gTheMuteHandle=null)};break}ABCJS.synth.supportsAudio()?(a=new ABCJS.synth.SynthController(n)).load("#playback-audio",s,{displayLoop:!0,displayRestart:!0,displayPlay:!0,displayProgress:!0,displayWarp:!0}):document.querySelector("#playback-audio").innerHTML="<div class='audio-error'>Audio is not supported in this browser.</div>",o=!1,a.disable(!0),g=ABCJS.renderAbc("playback-paper",n,l)[0],postProcessTab([g],"playback-paper",r,!0),gMIDIbuffer=d=new ABCJS.synth.CreateSynth(n),gMIDIInitStillWaiting=!1,d.init({visualObj:g}).then(function(t){if(console.log(t),a){var r=computeFade(n);a.setTune(g,o,{fadeLength:r}).then(function(t){if(console.log("Audio successfully loaded."),gSynthControl=a,gTrainerTouchControls){var n=document.getElementsByClassName("abcjs-midi-clock"),o=document.getElementsByClassName("abcjs-midi-current-tempo-wrapper");if(n&&o&&n.length>0&&o.length>0){var r=n[0];r.onclick=DecrementTempo,(r=o[0]).onclick=IncrementTempo}}}).catch(function(t){document.getElementById("loading-bar-spinner").style.display="none",gMIDIInitStillWaiting=!1,console.log("Problem loading audio for this tune")})}}).catch(function(t){document.getElementById("loading-bar-spinner").style.display="none",gMIDIInitStillWaiting=!1,console.log("Problem loading audio for this tune")}),gPlayerContainerRect=(gPlayerHolder=document.getElementById("playerholder")).getBoundingClientRect()}()}function c(){gSynthControl=null,a&&(a.destroy(),a=null)}}var gInstrumentExplorerMelodyInstruments=null,gInstrumentExplorerBassInstruments=null,gInstrumentExplorerChordInstruments=null,gInstrumentExplorerSoundfonts=null;function InstrumentExplorer(){if(gAllowCopy){var t=findSelectedTune();if(""!=t){gPlayerABCInstrumentExplorerOriginal=null,gPlayerABCInstrumentExplorerProcessed=null,gPlayerABCInstrumentExplorerInjected=null,gInstrumentExplorerSoundfonts||(gInstrumentExplorerSoundfonts=(gInstrumentExplorerSoundfonts=InstrumentExplorerBuildDropdown("instrument_explorer_soundfont",soundfontNames)).replace("<select ",'<select style="width:130px;" ')),gInstrumentExplorerMelodyInstruments||(gInstrumentExplorerMelodyInstruments=InstrumentExplorerBuildDropdown("instrument_explorer_melody_program",generalMIDISoundNames)),gInstrumentExplorerBassInstruments||(gInstrumentExplorerBassInstruments=InstrumentExplorerBuildDropdown("instrument_explorer_bass_program",generalMIDISoundNames)),gInstrumentExplorerChordInstruments||(gInstrumentExplorerChordInstruments=InstrumentExplorerBuildDropdown("instrument_explorer_chord_program",generalMIDISoundNames)),ScanTuneForCustomTimingInjection(t),ScanTuneForInstrumentExplorer(t);var n=PreProcessTuneInstrumentExplorer(t);InstrumentExplorerDialog(t,n,!1)}}}function InstrumentExplorerBuildDropdown(t,n){for(var o='<select id="'+t+'" name="'+t+'">\n',a=n.length,r=0;r<a;++r)o+='<option value="'+r+'"> '+n[r]+"</option>";return o+"</select>"}function PreProcessTuneInstrumentExplorer(t){var n=/^%abcjs_soundfont.*[\r\n]*/gm;return t=t.replaceAll(n,""),n=/^%%MIDI program.*[\r\n]*/gm,t=t.replaceAll(n,""),n=/^%%MIDI bassprog.*[\r\n]*/gm,t=t.replaceAll(n,""),n=/^%%MIDI chordprog.*[\r\n]*/gm,t=t.replaceAll(n,""),n=/^%%MIDI bassvol.*[\r\n]*/gm,t=t.replaceAll(n,""),n=/^%%MIDI chordvol.*[\r\n]*/gm,t=t.replaceAll(n,"")}function InstrumentExplorerRegenerate(){gInstrumentExplorerSoundfont=document.getElementById("instrument_explorer_soundfont").value,gInstrumentExplorerMelodyInstrument=document.getElementById("instrument_explorer_melody_program").value,gInstrumentExplorerBassInstrument=document.getElementById("instrument_explorer_bass_program").value,gInstrumentExplorerChordInstrument=document.getElementById("instrument_explorer_chord_program").value;var t=document.getElementById("instrument_explorer_bass_volume").value;t=parseInt(t),isNaN(t)||(gInstrumentExplorerBassVolume=t);var n=document.getElementById("instrument_explorer_chord_volume").value;n=parseInt(n),isNaN(n)||(gInstrumentExplorerChordVolume=n),gTheOKButton.click(),setTimeout(function(){InstrumentExplorerDialog(gPlayerABCInstrumentExplorerOriginal,gPlayerABCInstrumentExplorerProcessed,!0)},250)}function ScanTuneForInstrumentExplorer(t){switch(gDefaultSoundFont){case"https://paulrosen.github.io/midi-js-soundfonts/FluidR3_GM/":default:gInstrumentExplorerSoundfont="0";break;case"https://paulrosen.github.io/midi-js-soundfonts/MusyngKite/":gInstrumentExplorerSoundfont="1";break;case"https://michaeleskin.com/abctools/soundfonts/fatboy_4/":gInstrumentExplorerSoundfont="2";break;case"https://michaeleskin.com/abctools/soundfonts/canvas/":gInstrumentExplorerSoundfont="3";break;case"https://michaeleskin.com/abctools/soundfonts/mscore_2/":gInstrumentExplorerSoundfont="4";break;case"https://michaeleskin.com/abctools/soundfonts/arachno_3/":gInstrumentExplorerSoundfont="5";break;case"https://michaeleskin.com/abctools/soundfonts/fluidhq_1/":gInstrumentExplorerSoundfont="6"}if(gInstrumentExplorerMelodyInstrument=""+(gInstrumentExplorerMelodyInstrument="144"==gTheMelodyProgram?0:parseInt(gTheMelodyProgram)+1),gInstrumentExplorerChordInstrument=""+(gInstrumentExplorerChordInstrument="144"==gTheChordProgram?0:parseInt(gTheChordProgram)+1),gInstrumentExplorerBassInstrument=""+(gInstrumentExplorerBassInstrument="144"==gTheBassProgram?0:parseInt(gTheBassProgram)+1),gInstrumentExplorerBassVolume=gTheBassVolume,gInstrumentExplorerChordVolume=gTheChordVolume,n=/^%abcjs_soundfont.*$/gm,(o=t.match(n))&&o.length>0){var n,o,a=o[o.length-1].replace("%abcjs_soundfont","");if(""!=(a=a.trim()))switch(a){case"fluid":gInstrumentExplorerSoundfont="0";break;case"musyng":gInstrumentExplorerSoundfont="1";break;case"fatboy":gInstrumentExplorerSoundfont="2";break;case"canvas":gInstrumentExplorerSoundfont="3";break;case"mscore":gInstrumentExplorerSoundfont="4";break;case"arachno":gInstrumentExplorerSoundfont="5";break;case"fluidhq":gInstrumentExplorerSoundfont="6"}}if(n=/^%%MIDI program.*$/gm,(o=t.match(n))&&o.length>0){var a=o[0].replace("%%MIDI program","");if(""!=(a=a.trim())){if("mute"==a.toLowerCase())gInstrumentExplorerMelodyInstrument="0";else{var r=parseInt(a);isNaN(r)||(gInstrumentExplorerMelodyInstrument=""+(r+1))}}}if(n=/^%%MIDI bassprog.*$/gm,(o=t.match(n))&&o.length>0){var a=o[0].replace("%%MIDI bassprog","");if(""!=(a=a.trim())){if("mute"==a.toLowerCase())gInstrumentExplorerBassInstrument="0";else{var r=parseInt(a);isNaN(r)||(gInstrumentExplorerBassInstrument=""+(r+1))}}}if(n=/^%%MIDI chordprog.*$/gm,(o=t.match(n))&&o.length>0){var a=o[0].replace("%%MIDI chordprog","");if(""!=(a=a.trim())){if("mute"==a.toLowerCase())gInstrumentExplorerChordInstrument="0";else{var r=parseInt(a);isNaN(r)||(gInstrumentExplorerChordInstrument=""+(r+1))}}}if(n=/^%%MIDI bassvol.*$/gm,(o=t.match(n))&&o.length>0){var a=o[0].replace("%%MIDI bassvol","");if(""!=(a=a.trim())){var r=parseInt(a);isNaN(r)||(gInstrumentExplorerBassVolume=r)}}if(n=/^%%MIDI chordvol.*$/gm,(o=t.match(n))&&o.length>0){var a=o[0].replace("%%MIDI chordvol","");if(""!=(a=a.trim())){var r=parseInt(a);isNaN(r)||(gInstrumentExplorerChordVolume=r)}}}function InstrumentExplorerInject(){var t=document.getElementById("instrumentexplorer_inject_all").checked;gInstrumentExplorerSoundfont=document.getElementById("instrument_explorer_soundfont").value,gInstrumentExplorerMelodyInstrument=document.getElementById("instrument_explorer_melody_program").value,gInstrumentExplorerBassInstrument=document.getElementById("instrument_explorer_bass_program").value,gInstrumentExplorerChordInstrument=document.getElementById("instrument_explorer_chord_program").value;var n=document.getElementById("instrument_explorer_bass_volume").value;n=parseInt(n),isNaN(n)||(gInstrumentExplorerBassVolume=n);var o=document.getElementById("instrument_explorer_chord_volume").value;if(o=parseInt(o),isNaN(o)||(gInstrumentExplorerChordVolume=o),t){for(var a=CountTunes(),r=gTheABC.value,l=r.split(/^X:/gm),s=FindPreTuneHeader(r),g=1;g<=a;++g)l[g]="X:"+l[g],s+=InstrumentExplorerDialogInjectThisTune(l[g]),s+="\n\n";if(gTheABC.value=s,gIsDirty=!0,gRawMode)RenderAsync(!0,null,function(){DayPilot.Modal.alert('<p style="text-align:center;font-size:14pt;font-family:helvetica;">Instrument Injection Complete!</p>',{theme:"modal_flat",top:300,width:500,scrollWithPage:AllowDialogsToScroll()}).then(function(){gTheABC.selectionStart=0,gTheABC.selectionEnd=0,FocusAfterOperation()})});else{var c='<p style="text-align:center;font-size:14pt;font-family:helvetica;">Instrument Injection Complete!</p>';DayPilot.Modal.alert(c,{theme:"modal_flat",top:300,width:500,scrollWithPage:AllowDialogsToScroll()}).then(function(){gTheABC.selectionStart=0,gTheABC.selectionEnd=0,FocusAfterOperation()})}}else{gPlayerABCInstrumentExplorerInjected=InstrumentExplorerDialogInjectThisTune(gPlayerABCInstrumentExplorerProcessed);var d=gTheABC.selectionStart,u=gTheABC.value;if(u=u.replace(gPlayerABCInstrumentExplorerOriginal,gPlayerABCInstrumentExplorerInjected),gTheABC.value=u,gIsDirty=!0,gPlayerABCInstrumentExplorerOriginal=gPlayerABCInstrumentExplorerInjected,gRawMode)RenderAsync(!0,null,function(){DayPilot.Modal.alert('<p style="text-align:center;font-size:14pt;font-family:helvetica;">Instrument Injection Complete!</p>',{theme:"modal_flat",top:300,width:500,scrollWithPage:AllowDialogsToScroll()}).then(function(){gTheABC.selectionStart=d,gTheABC.selectionEnd=d,FocusAfterOperation()})});else{var c='<p style="text-align:center;font-size:14pt;font-family:helvetica;">Instrument Injection Complete!</p>';DayPilot.Modal.alert(c,{theme:"modal_flat",top:300,width:500,scrollWithPage:AllowDialogsToScroll()}).then(function(){gTheABC.selectionStart=d,gTheABC.selectionEnd=d,FocusAfterOperation()})}}}function InstrumentExplorerDialogInjectThisTune(t){switch(gInstrumentExplorerSoundfont){case"0":default:t=InjectStringBelowTuneHeader(t,"%abcjs_soundfont fluid");break;case"1":t=InjectStringBelowTuneHeader(t,"%abcjs_soundfont musyng");break;case"2":t=InjectStringBelowTuneHeader(t,"%abcjs_soundfont fatboy");break;case"3":t=InjectStringBelowTuneHeader(t,"%abcjs_soundfont canvas");break;case"4":t=InjectStringBelowTuneHeader(t,"%abcjs_soundfont mscore");break;case"5":t=InjectStringBelowTuneHeader(t,"%abcjs_soundfont arachno");break;case"6":t=InjectStringBelowTuneHeader(t,"%abcjs_soundfont fluidhq")}if("0"==gInstrumentExplorerMelodyInstrument)t=InjectStringBelowTuneHeader(t,"%%MIDI program mute");else{var n=parseInt(gInstrumentExplorerMelodyInstrument)-1;t=InjectStringBelowTuneHeader(t,"%%MIDI program "+n)}if("0"==gInstrumentExplorerBassInstrument)t=InjectStringBelowTuneHeader(t,"%%MIDI bassprog mute");else{var n=parseInt(gInstrumentExplorerBassInstrument)-1;t=InjectStringBelowTuneHeader(t,"%%MIDI bassprog "+n)}if("0"==gInstrumentExplorerChordInstrument)t=InjectStringBelowTuneHeader(t,"%%MIDI chordprog mute");else{var n=parseInt(gInstrumentExplorerChordInstrument)-1;t=InjectStringBelowTuneHeader(t,"%%MIDI chordprog "+n)}return t=InjectStringBelowTuneHeader(t,"%%MIDI bassvol "+gInstrumentExplorerBassVolume),t=(t=InjectStringBelowTuneHeader(t,"%%MIDI chordvol "+gInstrumentExplorerChordVolume)).replace("\n\n","")}var gInstrumentExplorerSoundfont="0",gInstrumentExplorerMelodyInstrument="0",gInstrumentExplorerBassInstrument="0",gInstrumentExplorerChordInstrument="0",gInstrumentExplorerBassVolume=0,gInstrumentExplorerChordVolume=0,gPlayerABCInstrumentExplorerOriginal=null,gPlayerABCInstrumentExplorerProcessed=null,gPlayerABCInstrumentExplorerInjected=null;function InstrumentExplorerDialog(t,n,o){if(sendGoogleAnalytics("dialog","InstrumentExplorerDialog"),gMIDIbuffer=null,gTheOKButton=null,gUseWidePlayer=!1,o||(gPlayerABCInstrumentExplorerOriginal=t,gPlayerABCInstrumentExplorerProcessed=n),gPlayerABCInstrumentExplorerInjected=n=InstrumentExplorerDialogInjectThisTune(gPlayerABCInstrumentExplorerProcessed),n=TransformABCCompliantDirectives(n),gReverbString&&""!=gReverbString){var a,r=n.match(/^%reverb.*$/m);r&&r.length>0||(n=InjectReverbAboveTune(n,gReverbString))}if(PlayerSetupCommon(n)){var l=GetRadioValue("notenodertab"),s=GetABCJSParams(l);s.oneSvgPerLine=!1,"noten"!=l&&s.tablature&&s.tablature.length>0&&(s.tablature[0].label="");var g=new CursorControl;if(gIsIOS){var c=ABCJS.synth.activeAudioContext();gTheMuteHandle=null,c&&(gTheMuteHandle=unmute(c,!1,!1))}!function t(){gLoopCallback=null,gStartPlayCallback=null,gPreStartPlayCallback=null,gPlayerInPause=!1,modal_msg='<div id="playerholder" style="height:'+(window.innerHeight-515)+'px;overflow-y:auto;margin-bottom:15px;">',gLargePlayerControls?modal_msg+='<div id="abcplayer" class="abcjs-large">':modal_msg+='<div id="abcplayer">',modal_msg+='<div id="playback-paper"></div>',modal_msg+="</div>",modal_msg+="</div>",gLargePlayerControls?modal_msg+='<div id="playback-audio" class="abcjs-large"></div>':modal_msg+='<div id="playback-audio"></div>',modal_msg+='<div class="configure_instrumentexplorer_text" style="text-align:center;margin:0px;margin-top:36px">',modal_msg+='<p class="configure_instrumentexplorer_text">',modal_msg+="Sound font:"+gInstrumentExplorerSoundfonts+"&nbsp;&nbsp;&nbsp;Melody:"+gInstrumentExplorerMelodyInstruments,modal_msg+="</p>",modal_msg+='<p class="configure_instrumentexplorer_text">',modal_msg+="Bass:"+gInstrumentExplorerBassInstruments+"&nbsp;&nbsp;&nbsp;Chords:"+gInstrumentExplorerChordInstruments,modal_msg+="</p>",modal_msg+='<p class="configure_instrumentexplorer_text">',modal_msg+='Bass Volume (0-127):&nbsp;&nbsp;<input style="width:90px;" id="instrument_explorer_bass_volume" type="number" min="0" step="1" max="127" title="Bass volume, range is 0-127"  autocomplete="off"/>',modal_msg+='Chord Volume (0-127):&nbsp;&nbsp;<input style="width:90px;" id="instrument_explorer_chord_volume" type="number" min="0" step="1" max="127" title="Chord volume, range is 0-127" autocomplete="off"/>',modal_msg+='<span style="font-size:12pt;font-family:helvetica;">Inject all tunes:</span><input style="width:16px;margin-left:8px;margin-right:24px;" id="instrumentexplorer_inject_all" type="checkbox"/>',modal_msg+="</p>",modal_msg+='<p class="configure_instrumentexplorer_text">',modal_msg+='<input id="instrumentexplorertest" class="instrumentexplorertest button btn btn-instrumentexplorertest" onclick="InstrumentExplorerRegenerate();" type="button" value="Reload Tune with Changed Instruments and Volumes" title="Reloads the tune into the player with the selected MIDI soundfont, melody instrument, bass instrument, bass volumes, chord instrument, and chord volumes">',modal_msg+='<input id="instrumentexplorerinject" class="instrumentexplorerinject button btn btn-instrumentexplorerinject" onclick="InstrumentExplorerInject();" style="margin-right:0px;" type="button" value="Inject Instruments and Volumes into the ABC" title="Injects the current soundfont, melody instrument, bass instrument, bass volume, chord instrument, and chord volumes into the tune ABC">',modal_msg+="</p>",modal_msg+="</div>",modal_msg+='<a id="instrumentexplorerhelp" href="https://michaeleskin.com/app/userguide.html#midi_instrument_explorer" target="_blank" style="text-decoration:none;" title="Learn more about the MIDI Instrument Explorer" class="dialogcornerbutton">?</a>';var o,r,c,u=window.innerWidth;GetRadioValue("notenodertab");var p=.45*u;isDesktopBrowser()?p<850&&(p=850):p=800,DayPilot.Modal.alert(modal_msg,{theme:"modal_flat",top:50,width:p,okText:"Close",scrollWithPage:isMobileBrowser()}),document.getElementById("instrument_explorer_soundfont").value=gInstrumentExplorerSoundfont,document.getElementById("instrument_explorer_melody_program").value=gInstrumentExplorerMelodyInstrument,document.getElementById("instrument_explorer_bass_program").value=gInstrumentExplorerBassInstrument,document.getElementById("instrument_explorer_chord_program").value=gInstrumentExplorerChordInstrument,document.getElementById("instrument_explorer_bass_volume").value=gInstrumentExplorerBassVolume,document.getElementById("instrument_explorer_chord_volume").value=gInstrumentExplorerChordVolume;for(var m=document.getElementsByClassName("modal_flat_ok"),h=null,f=0;f<m.length;++f)if("Close"==(h=m[f]).innerText){gTheOKButton=h;var A=h.onclick;h.onclick=function(){A(),d(),FocusAfterOperation(),gIsIOS&&gTheMuteHandle&&(gTheMuteHandle.dispose(),gTheMuteHandle=null)};break}ABCJS.synth.supportsAudio()?(a=new ABCJS.synth.SynthController(n)).load("#playback-audio",g,{displayLoop:!0,displayRestart:!0,displayPlay:!0,displayProgress:!0,displayWarp:!0}):document.querySelector("#playback-audio").innerHTML="<div class='audio-error'>Audio is not supported in this browser.</div>",o=!1,a.disable(!0),r=ABCJS.renderAbc("playback-paper",n,s)[0],postProcessTab([r],"playback-paper",l,!0),gMIDIbuffer=c=new ABCJS.synth.CreateSynth(n),gMIDIInitStillWaiting=!1,c.init({visualObj:r}).then(function(t){if(console.log(t),a){var l=computeFade(n);a.setTune(r,o,{fadeLength:l}).then(function(t){if(console.log("Audio successfully loaded."),gSynthControl=a,gTrainerTouchControls){var n=document.getElementsByClassName("abcjs-midi-clock"),o=document.getElementsByClassName("abcjs-midi-current-tempo-wrapper");if(n&&o&&n.length>0&&o.length>0){var r=n[0];r.onclick=DecrementTempo,(r=o[0]).onclick=IncrementTempo}}}).catch(function(t){document.getElementById("loading-bar-spinner").style.display="none",gMIDIInitStillWaiting=!1,console.log("Problem loading audio for this tune")})}}).catch(function(t){document.getElementById("loading-bar-spinner").style.display="none",gMIDIInitStillWaiting=!1,console.log("Problem loading audio for this tune")}),gPlayerContainerRect=(gPlayerHolder=document.getElementById("playerholder")).getBoundingClientRect()}()}function d(){gSynthControl=null,a&&(a.destroy(),a=null)}}function GraceExplorer(){if(gAllowCopy){var t=findSelectedTune();if(""!=t){ScanTuneForCustomTimingInjection(t);var n=PreProcessPlayABC(t);GraceExplorerDialog(t,n,!1)}}}function GraceExplorerRegenerate(){var t=!1,n=document.getElementById("grace_explorer_duration").value;n=parseFloat(n),!isNaN(n)&&n>=0&&n<=150&&(gGraceDuration=n/1e3,t=!0),t&&(gTheOKButton.click(),setTimeout(function(){GraceExplorerDialog(gPlayerABCGraceExplorerOriginal,gPlayerABCGraceExplorerProcessed,!0)},250))}function ScanTuneForGraceExplorer(t){if(gGraceDuration=.045,n=/^%grace_duration_ms.*$/gm,(o=t.match(n))&&o.length>0){var n,o,a=o[0].replace("%grace_duration_ms",""),r=(a=a.trim()).split(" ");if(r.length>=1){var l=parseFloat(r[0]);!isNaN(l)&&l>=0&&l<=150&&(gGraceDuration=l/1e3)}}}function GraceExplorerInject(){var t=document.getElementById("grace_explorer_inject_all").checked,n=!1,o=document.getElementById("grace_explorer_duration").value;if(o=parseFloat(o),!isNaN(o)&&o>=0&&o<=150&&(n=!0),n){var a="%grace_duration_ms "+o,r=/^%grace_duration_ms.*[\r\n]*/gm;if(t){for(var l=CountTunes(),s=gTheABC.value,g=s.split(/^X:/gm),c=FindPreTuneHeader(s),d=1;d<=l;++d){g[d]="X:"+g[d];var u=g[d].replaceAll(r,""),p=InjectStringBelowTuneHeader(u,a);c+=p=p.replace("\n\n",""),c+="\n\n"}if(gTheABC.value=c,gIsDirty=!0,gRawMode)RenderAsync(!0,null,function(){DayPilot.Modal.alert('<p style="text-align:center;font-size:14pt;font-family:helvetica;">Grace Duration Injection Complete!</p>',{theme:"modal_flat",top:300,width:500,scrollWithPage:AllowDialogsToScroll()}).then(function(){gTheABC.selectionStart=0,gTheABC.selectionEnd=0,FocusAfterOperation()})});else{var m='<p style="text-align:center;font-size:14pt;font-family:helvetica;">Grace Duration Injection Complete!</p>';DayPilot.Modal.alert(m,{theme:"modal_flat",top:300,width:500,scrollWithPage:AllowDialogsToScroll()}).then(function(){gTheABC.selectionStart=0,gTheABC.selectionEnd=0,FocusAfterOperation()})}}else{var u=gPlayerABCGraceExplorerOriginal.replaceAll(r,""),p=InjectStringBelowTuneHeader(u,a);p=p.replace("\n\n","");var h=gTheABC.selectionStart,f=gTheABC.value;if(f=f.replace(gPlayerABCGraceExplorerOriginal,p),gTheABC.value=f,gIsDirty=!0,gPlayerABCGraceExplorerOriginal=p,gRawMode)RenderAsync(!0,null,function(){DayPilot.Modal.alert('<p style="text-align:center;font-size:14pt;font-family:helvetica;">Grace Duration Injection Complete!</p>',{theme:"modal_flat",top:300,width:500,scrollWithPage:AllowDialogsToScroll()}).then(function(){gTheABC.selectionStart=h,gTheABC.selectionEnd=h,FocusAfterOperation()})});else{var m='<p style="text-align:center;font-size:14pt;font-family:helvetica;">Grace Duration Injection Complete!</p>';DayPilot.Modal.alert(m,{theme:"modal_flat",top:300,width:500,scrollWithPage:AllowDialogsToScroll()}).then(function(){gTheABC.selectionStart=h,gTheABC.selectionEnd=h,FocusAfterOperation()})}}}}var gPlayerABCGraceExplorerOriginal=null,gPlayerABCGraceExplorerProcessed=null;function GraceExplorerDialog(t,n,o){if(sendGoogleAnalytics("dialog","GraceExplorerDialog"),gMIDIbuffer=null,gTheOKButton=null,gUseWidePlayer=!1,o||(gPlayerABCGraceExplorerOriginal=t,gPlayerABCGraceExplorerProcessed=n),n=TransformABCCompliantDirectives(n),PlayerSetupCommon(n)){o||ScanTuneForGraceExplorer(n);var a,r=GetRadioValue("notenodertab"),l=GetABCJSParams(r);l.oneSvgPerLine=!1,"noten"!=r&&l.tablature&&l.tablature.length>0&&(l.tablature[0].label="");var s=new CursorControl;if(gIsIOS){var g=ABCJS.synth.activeAudioContext();gTheMuteHandle=null,g&&(gTheMuteHandle=unmute(g,!1,!1))}!function t(){gLoopCallback=null,gStartPlayCallback=null,gPreStartPlayCallback=null,gPlayerInPause=!1,modal_msg='<div id="playerholder" style="height:'+(window.innerHeight-400)+'px;overflow-y:auto;margin-bottom:15px;">',gLargePlayerControls?modal_msg+='<div id="abcplayer" class="abcjs-large">':modal_msg+='<div id="abcplayer">',modal_msg+='<div id="playback-paper"></div>',modal_msg+="</div>",modal_msg+="</div>",gLargePlayerControls?modal_msg+='<div id="playback-audio" class="abcjs-large"></div>':modal_msg+='<div id="playback-audio"></div>',modal_msg+='<p class="configure_graceexplorer_text" style="text-align:center;margin:0px;margin-top:22px">',modal_msg+='Grace duration in milliseconds (range is 1-150): <input style="width:90px;" id="grace_explorer_duration" type="number" min="0" step="1" max="150" title="Grace duration in milliseconds, range is 1 to 150, 0 disables the custom grace duration feature and uses original abcjs default behavior" autocomplete="off"/>',modal_msg+='<span style="font-size:12pt;font-family:helvetica;">Inject all tunes:</span><input style="width:16px;margin-left:8px;margin-right:24px;" id="grace_explorer_inject_all" type="checkbox"/>',modal_msg+="</p>",modal_msg+='<p class="configure_graceexplorer_text" style="text-align:center;margin:0px;margin-top:22px">',modal_msg+='<input id="graceexplorertest" class="graceexplorertest button btn btn-graceexplorertest" onclick="GraceExplorerRegenerate();" type="button" value="Reload Tune with Changed Grace Duration" title="Reloads the tune into the player with the entered grace duration">',modal_msg+='<input id="graceexplorerinject" class="graceexplorerinject button btn btn-graceexplorerinject" onclick="GraceExplorerInject();" type="button" style="margin-right:0px;" value="Inject Grace Duration into the ABC" title="Injects the current grace duration into the tune ABC">',modal_msg+="</p>",modal_msg+='<a id="graceexplorerhelp" href="https://michaeleskin.com/app/userguide.html#grace_duration_explorer" target="_blank" style="text-decoration:none;" title="Learn more about the Grace Duration Explorer" class="dialogcornerbutton">?</a>';var o,g,d,u=window.innerWidth;GetRadioValue("notenodertab");var p=.45*u;isDesktopBrowser()?p<850&&(p=850):p=800,DayPilot.Modal.alert(modal_msg,{theme:"modal_flat",top:50,width:p,okText:"Close",scrollWithPage:isMobileBrowser()}),document.getElementById("grace_explorer_duration").value=gGraceDuration/.001;for(var m=document.getElementsByClassName("modal_flat_ok"),h=null,f=0;f<m.length;++f)if("Close"==(h=m[f]).innerText){gTheOKButton=h;var A=h.onclick;h.onclick=function(){A(),c(),FocusAfterOperation(),gIsIOS&&gTheMuteHandle&&(gTheMuteHandle.dispose(),gTheMuteHandle=null)};break}ABCJS.synth.supportsAudio()?(a=new ABCJS.synth.SynthController(n)).load("#playback-audio",s,{displayLoop:!0,displayRestart:!0,displayPlay:!0,displayProgress:!0,displayWarp:!0}):document.querySelector("#playback-audio").innerHTML="<div class='audio-error'>Audio is not supported in this browser.</div>",o=!1,a.disable(!0),g=ABCJS.renderAbc("playback-paper",n,l)[0],postProcessTab([g],"playback-paper",r,!0),gMIDIbuffer=d=new ABCJS.synth.CreateSynth(n),gMIDIInitStillWaiting=!1,d.init({visualObj:g}).then(function(t){if(console.log(t),a){var r=computeFade(n);a.setTune(g,o,{fadeLength:r}).then(function(t){if(console.log("Audio successfully loaded."),gSynthControl=a,gTrainerTouchControls){var n=document.getElementsByClassName("abcjs-midi-clock"),o=document.getElementsByClassName("abcjs-midi-current-tempo-wrapper");if(n&&o&&n.length>0&&o.length>0){var r=n[0];r.onclick=DecrementTempo,(r=o[0]).onclick=IncrementTempo}}}).catch(function(t){document.getElementById("loading-bar-spinner").style.display="none",gMIDIInitStillWaiting=!1,console.log("Problem loading audio for this tune")})}}).catch(function(t){document.getElementById("loading-bar-spinner").style.display="none",gMIDIInitStillWaiting=!1,console.log("Problem loading audio for this tune")}),gPlayerContainerRect=(gPlayerHolder=document.getElementById("playerholder")).getBoundingClientRect()}()}function c(){gSynthControl=null,a&&(a.destroy(),a=null)}}function RollExplorer(){if(gAllowCopy){var t=findSelectedTune();if(""!=t){ScanTuneForCustomTimingInjection(t);var n=PreProcessPlayABC(t);gRollExplorerTransformed=!1,RollExplorerDialog(t,n,!1)}}}function RollParameterIssueAlert(t){var n='<p style="text-align:center;font-size:18pt;font-family:helvetica;">Please Check the Roll Parameters</p>';n+='<p style="font-size:12pt;line-height:18pt;margin-top:36px;text-align:center;">There is an issue with the roll parameters</p>',n+='<p style="font-size:12pt;line-height:18pt;margin-top:20px;text-align:center;">All values must be positive</p>',n+='<p style="font-size:12pt;line-height:18pt;margin-top:20px;text-align:center;">The total of the slot sizes for each of the roll styles must be less than 3</p>',n+='<p style="font-size:12pt;line-height:18pt;margin-top:20px;text-align:center;">The fractions must be between 0 and 1</p>',n+='<p style="font-size:12pt;line-height:18pt;margin-top:20px;text-align:center;">The volumes must be between 0 and 2</p>',DayPilot.Modal.alert(n,{theme:"modal_flat",top:100,width:700,scrollWithPage:AllowDialogsToScroll()}).then(function(){t&&t()})}function makeRollString(t){var n,o="",a=t.length;for(n=0;n<a;++n)n!=a-1?o+=t[n]+" ":o+=t[n];return o}function RollExplorerValidate(){var t=document.getElementById("roll_2_slot_1").value,n=document.getElementById("roll_2_slot_2").value,o=document.getElementById("roll_2_fraction_1").value,a=document.getElementById("roll_2_fraction_2").value,r=document.getElementById("roll_2_fraction_3").value,l=document.getElementById("roll_2_volume_1").value,s=document.getElementById("roll_2_volume_2").value,g=document.getElementById("roll_2_volume_3").value,c=document.getElementById("roll_3_slot_1").value,d=document.getElementById("roll_3_slot_2").value,u=document.getElementById("roll_3_fraction_1").value,p=document.getElementById("roll_3_fraction_2").value,m=document.getElementById("roll_3_fraction_3").value,h=document.getElementById("roll_3_volume_1").value,f=document.getElementById("roll_3_volume_2").value,A=document.getElementById("roll_3_volume_3").value,b=makeRollString([t,n,o,a,r,l,s,g]),T=makeRollString([c,d,u,p,m,h,f,A]),y=validate_roll_2_params(b,!1),I=validate_roll_3_params(T,!1);return!!y&&!!I&&(y=validate_roll_2_params(b,!0),I=validate_roll_3_params(T,!0),!0)}function RollExplorerTransformReel(t){function n(t){return t.replace(/(~[a-zA-Z])3/g,function(t,n){return n.charAt(1)+n+"2"})}function o(t){return t.replace(/(~[a-zA-Z])3/g,function(t,n){return n+"2"+n.charAt(1)})}gRollExplorerTransformed=!0,t?(gPlayerABCRollExplorerTransformed=o(gPlayerABCRollExplorerOriginal),gPlayerABCRollExplorerProcessed=o(gPlayerABCRollExplorerProcessed)):(gPlayerABCRollExplorerTransformed=n(gPlayerABCRollExplorerOriginal),gPlayerABCRollExplorerProcessed=n(gPlayerABCRollExplorerProcessed)),gTheOKButton.click(),setTimeout(function(){RollExplorerDialog(gPlayerABCRollExplorerTransformed,gPlayerABCRollExplorerProcessed,!0)},250)}function RollExplorerRegenerate(){var t=!1;(t=RollExplorerValidate())?(gTheOKButton.click(),setTimeout(function(){gPlayerABCRollExplorerTransformed?RollExplorerDialog(gPlayerABCRollExplorerTransformed,gPlayerABCRollExplorerProcessed,!0):RollExplorerDialog(gPlayerABCRollExplorerOriginal,gPlayerABCRollExplorerProcessed,!0)},250)):RollParameterIssueAlert(null)}function RollExplorerInject(){if(RollExplorerValidate()){var t,n="%roll_2_params "+gRoll2Duration1+" "+gRoll2Duration2+" "+gRoll2Fraction1+" "+gRoll2Fraction2+" "+gRoll2Fraction3+" "+gRoll2Volume1+" "+gRoll2Volume2+" "+gRoll2Volume3+"\n%roll_3_params "+gRoll3Duration1+" "+gRoll3Duration2+" "+gRoll3Fraction1+" "+gRoll3Fraction2+" "+gRoll3Fraction3+" "+gRoll3Volume1+" "+gRoll3Volume2+" "+gRoll3Volume3,o=/^%roll_2_params.*[\r\n]*/gm;t=gPlayerABCRollExplorerTransformed?gPlayerABCRollExplorerTransformed.replaceAll(o,""):gPlayerABCRollExplorerOriginal.replaceAll(o,""),o=/^%roll_3_params.*[\r\n]*/gm;var a=InjectStringBelowTuneHeader(t=t.replaceAll(o,""),n);a=a.replace("\n\n","");var r=gTheABC.selectionStart,l=gTheABC.value;l=l.replace(gPlayerABCRollExplorerOriginal,a),gTheABC.value=l,gIsDirty=!0,gPlayerABCRollExplorerOriginal=a,gRawMode||gRollExplorerTransformed?RenderAsync(!0,null,function(){DayPilot.Modal.alert('<p style="text-align:center;font-size:14pt;font-family:helvetica;">Roll Parameter Injection Complete!</p>',{theme:"modal_flat",top:300,width:500,scrollWithPage:AllowDialogsToScroll()}).then(function(){gTheABC.selectionStart=r,gTheABC.selectionEnd=r,FocusAfterOperation()})}):DayPilot.Modal.alert('<p style="text-align:center;font-size:14pt;font-family:helvetica;">Roll Parameter Injection Complete!</p>',{theme:"modal_flat",top:300,width:500,scrollWithPage:AllowDialogsToScroll()}).then(function(){gTheABC.selectionStart=r,gTheABC.selectionEnd=r,FocusAfterOperation()})}else RollParameterIssueAlert(null)}function idleRollExplorer(){document.getElementById("roll_2_slot_1").value=gRoll2Duration1,document.getElementById("roll_2_slot_2").value=gRoll2Duration2,document.getElementById("roll_2_fraction_1").value=gRoll2Fraction1,document.getElementById("roll_2_fraction_2").value=gRoll2Fraction2,document.getElementById("roll_2_fraction_3").value=gRoll2Fraction3,document.getElementById("roll_2_volume_1").value=gRoll2Volume1,document.getElementById("roll_2_volume_2").value=gRoll2Volume2,document.getElementById("roll_2_volume_3").value=gRoll2Volume3,document.getElementById("roll_3_slot_1").value=gRoll3Duration1,document.getElementById("roll_3_slot_2").value=gRoll3Duration2,document.getElementById("roll_3_fraction_1").value=gRoll3Fraction1,document.getElementById("roll_3_fraction_2").value=gRoll3Fraction2,document.getElementById("roll_3_fraction_3").value=gRoll3Fraction3,document.getElementById("roll_3_volume_1").value=gRoll3Volume1,document.getElementById("roll_3_volume_2").value=gRoll3Volume2,document.getElementById("roll_3_volume_3").value=gRoll3Volume3}function RollExplorerResetRoll2(){var t=gRoll2DefaultParams;validate_roll_2_params(t,!0),idleRollExplorer(),RollExplorerRegenerate()}function RollExplorerResetRoll3(){var t=gRoll3DefaultParams;validate_roll_3_params(t,!0),idleRollExplorer(),RollExplorerRegenerate()}function RollExplorerDefaultRoll2(){var t,n=document.getElementById("roll_2_slot_1").value,o=document.getElementById("roll_2_slot_2").value,a=document.getElementById("roll_2_fraction_1").value,r=document.getElementById("roll_2_fraction_2").value,l=document.getElementById("roll_2_fraction_3").value,s=document.getElementById("roll_2_volume_1").value,g=makeRollString([n,o,a,r,l,s,document.getElementById("roll_2_volume_2").value,document.getElementById("roll_2_volume_3").value]),c=validate_roll_2_params(g,!1);if(c){c=validate_roll_2_params(g,!0),gRoll2DefaultParams=g,SaveConfigurationSettings();var d='<p style="text-align:center;font-size:14pt;font-family:helvetica;">Quarter Note Roll Parameters Set as Tool Default</p>';d+='<p style="font-size:12pt;line-height:18pt;margin-top:36px;text-align:center;">You can edit the values in the Advanced Settings dialog.</p>',DayPilot.Modal.alert(d,{theme:"modal_flat",top:200,width:700,scrollWithPage:AllowDialogsToScroll()}).then(function(){RollExplorerRegenerate()})}else RollParameterIssueAlert(null)}function RollExplorerDefaultRoll3(){var t,n=document.getElementById("roll_3_slot_1").value,o=document.getElementById("roll_3_slot_2").value,a=document.getElementById("roll_3_fraction_1").value,r=document.getElementById("roll_3_fraction_2").value,l=document.getElementById("roll_3_fraction_3").value,s=document.getElementById("roll_3_volume_1").value,g=makeRollString([n,o,a,r,l,s,document.getElementById("roll_3_volume_2").value,document.getElementById("roll_3_volume_3").value]),c=validate_roll_3_params(g,!1);if(c){c=validate_roll_3_params(g,!0),gRoll3DefaultParams=g,SaveConfigurationSettings();var d='<p style="text-align:center;font-size:14pt;font-family:helvetica;">Dotted Quarter Note Roll Parameters Set as Tool Default</p>';d+='<p style="font-size:12pt;line-height:18pt;margin-top:36px;text-align:center;">You can edit the values in the Advanced Settings dialog.</p>',DayPilot.Modal.alert(d,{theme:"modal_flat",top:200,width:700,scrollWithPage:AllowDialogsToScroll()}).then(function(){RollExplorerRegenerate()})}else RollParameterIssueAlert(null)}var gPlayerABCRollExplorerOriginal=null,gPlayerABCRollExplorerProcessed=null,gPlayerABCRollExplorerTransformed=null,gRollExplorerTransformed=!1;function RollExplorerDialog(t,n,o){if(sendGoogleAnalytics("dialog","RollExplorerDialog"),gMIDIbuffer=null,gTheOKButton=null,gUseWidePlayer=!1,o||(gPlayerABCRollExplorerOriginal=t,gPlayerABCRollExplorerProcessed=n,gPlayerABCRollExplorerTransformed=null),n=TransformABCCompliantDirectives(n),PlayerSetupCommon(n)){o||ScanTuneForCustomTimingInjection(n);var a,r=GetRadioValue("notenodertab"),l=GetABCJSParams(r);l.oneSvgPerLine=!1,"noten"!=r&&l.tablature&&l.tablature.length>0&&(l.tablature[0].label="");var s=new CursorControl;if(gIsIOS){var g=ABCJS.synth.activeAudioContext();gTheMuteHandle=null,g&&(gTheMuteHandle=unmute(g,!1,!1))}!function t(){gLoopCallback=null,gStartPlayCallback=null,gPreStartPlayCallback=null,gPlayerInPause=!1,modal_msg='<div id="playerholder" style="height:'+(window.innerHeight-650)+'px;overflow-y:auto;margin-bottom:15px;">',gLargePlayerControls?modal_msg+='<div id="abcplayer" class="abcjs-large">':modal_msg+='<div id="abcplayer">',modal_msg+='<div id="playback-paper"></div>',modal_msg+="</div>",modal_msg+="</div>",gLargePlayerControls?modal_msg+='<div id="playback-audio" class="abcjs-large"></div>':modal_msg+='<div id="playback-audio"></div>',modal_msg+='<p class="configure_rollexplorer_text" style="font-size:14pt;text-align:center;margin:0px;margin-top:15px;margin-left:224px">Quarter Note Roll Parameters<input id="reset_roll_explorer_2" class="button btn btn-reset_roll_explorer_2" onclick="RollExplorerResetRoll2();" type="button" value="Reset" title="Reset quarter note roll parameters to the current tool defaults"><input id="default_roll_explorer_2" class="button btn btn-default_roll_explorer_2" onclick="RollExplorerDefaultRoll2();" type="button" value="Set as Tool Default" title="Makes the current quarter note roll parameters the default for the tool"></p>',modal_msg+='<p class="configure_rollexplorer_text" style="text-align:center;margin:0px;margin-top:8px">',modal_msg+='Slot 1: <input style="width:85px;" id="roll_2_slot_1" title="Quarter note slot 1 time" autocomplete="off" type="number" min="0" step="0.05" max="2.95"/>',modal_msg+='Slot 2: <input style="width:85px;" id="roll_2_slot_2" title="Quarter note slot 2 time" autocomplete="off"  type="number" min="0" step="0.05" max="2.95"/>',modal_msg+="</p>",modal_msg+='<p class="configure_rollexplorer_text" style="text-align:center;margin:0px;margin-top:8px">',modal_msg+='Fraction 1: <input style="width:85px;" id="roll_2_fraction_1" title="Quarter note fraction 1" autocomplete="off" type="number" min="0" step="0.05" max="1"/>',modal_msg+='Fraction 2: <input style="width:85px;" id="roll_2_fraction_2" title="Quarter note fraction 2" autocomplete="off" type="number" min="0" step="0.05" max="1"/>',modal_msg+='Fraction 3: <input style="width:85px;" id="roll_2_fraction_3" title="Quarter note fraction 3" autocomplete="off" type="number" min="0" step="0.05" max="1"/>',modal_msg+="</p>",modal_msg+='<p class="configure_rollexplorer_text" style="text-align:center;margin:0px;margin-top:8px">',modal_msg+='Volume 1: <input style="width:85px;" id="roll_2_volume_1" title="Quarter note volume 1" autocomplete="off" type="number" min="0" step="0.05" max="2"/>',modal_msg+='Volume 2: <input style="width:85px;" id="roll_2_volume_2" title="Quarter note volume 2" autocomplete="off" type="number" min="0" step="0.05" max="2"/>',modal_msg+='Volume 3: <input style="width:85px;" id="roll_2_volume_3" title="Quarter note volume 3" autocomplete="off" type="number" min="0" step="0.05" max="2"/>',modal_msg+="</p>",modal_msg+='<p class="configure_rollexplorer_text" style="font-size:14pt;text-align:center;margin:0px;margin-top:10px;margin-left:162px">Dotted Quarter Note Roll Parameters<input id="reset_roll_explorer_3" class="reset_roll_explorer_3 button btn btn-reset_roll_explorer_3" onclick="RollExplorerResetRoll3();" type="button" value="Reset" title="Reset dotted quarter note roll parameters to the current tool defaults"><input id="default_roll_explorer_3" class="button btn btn-default_roll_explorer_3" onclick="RollExplorerDefaultRoll3();" type="button" value="Set as Tool Default" title="Makes the current dotted quarter note roll parameters the default for the tool"></p>',modal_msg+='<p class="configure_rollexplorer_text" style="text-align:center;margin:0px;margin-top:8px">',modal_msg+='Slot 1: <input style="width:85px;" id="roll_3_slot_1" title="Dotted quarter note slot 1 time" autocomplete="off" type="number" min="0" step="0.05" max="2.95"/>',modal_msg+='Slot 2: <input style="width:85px;" id="roll_3_slot_2" title="Dotted quarter note slot 2 time" autocomplete="off" type="number" min="0" step="0.05" max="2.95"/>',modal_msg+="</p>",modal_msg+='<p class="configure_rollexplorer_text" style="text-align:center;margin:0px;margin-top:8px">',modal_msg+='Fraction 1: <input style="width:85px;" id="roll_3_fraction_1" title="Dotted quarter note fraction 1" autocomplete="off" type="number" min="0" step="0.05" max="1"/>',modal_msg+='Fraction 2: <input style="width:85px;" id="roll_3_fraction_2" title="Dotted quarter note fraction 2" autocomplete="off" type="number" min="0" step="0.05" max="1"/>',modal_msg+='Fraction 3: <input style="width:85px;" id="roll_3_fraction_3" title="Dotted quarter note fraction 3" autocomplete="off" type="number" min="0" step="0.05" max="1"/>',modal_msg+="</p>",modal_msg+='<p class="configure_rollexplorer_text" style="text-align:center;margin:0px;margin-top:8px">',modal_msg+='Volume 1: <input style="width:85px;" id="roll_3_volume_1" title="Dotted quarter note volume 1" autocomplete="off" type="number" min="0" step="0.05" max="2"/>',modal_msg+='Volume 2: <input style="width:85px;" id="roll_3_volume_2" title="Dotted quarter note volume 2" autocomplete="off" type="number" min="0" step="0.05" max="2"/>',modal_msg+='Volume 3: <input style="width:85px;" id="roll_3_volume_3" title="Dotted quarter note volume 3" autocomplete="off" type="number" min="0" step="0.05" max="2"/>',modal_msg+="</p>",modal_msg+='<p class="configure_rollexplorer_text" style="text-align:center;margin:0px;margin-top:24px">',modal_msg+='<input id="rollexplorertest" class="rollexplorertest button btn btn-rollexplorertest" onclick="RollExplorerRegenerate();" type="button" value="Reload Tune with Parameters" title="Reloads the tune into the player with the entered roll parameters">',modal_msg+='<input id="rollexplorerinject" class="rollexplorerinject button btn btn-rollexplorerinject" onclick="RollExplorerInject();" type="button" value="Inject Parameters into ABC" title="Injects the current roll parameters and roll transformations into the tune ABC">',modal_msg+='<input id="rollexplorertransform" class="rollexplorertransform button btn btn-rollexplorertransform" onclick="RollExplorerTransformReel(false);" type="button" value="~G3  G~G2" title="Transforms ~G3 style rolls to G~G2 style, may be useful for creating a better sounding roll for reels">',modal_msg+='<input id="rollexplorertransform2" style="margin-right:0px" class="rollexplorertransform2 button btn btn-rollexplorertransform" onclick="RollExplorerTransformReel(true);" type="button" value="~G3  ~G2G" title="Transforms ~G3 style rolls to ~G2G style, may be useful for creating a better sounding roll for reels">',modal_msg+="</p>",modal_msg+='<a id="rollexplorerhelp" href="https://michaeleskin.com/app/userguide.html#roll_explorer" target="_blank" style="text-decoration:none;" title="Learn more about the Roll Explorer" class="dialogcornerbutton">?</a>';var o,g,d,u=window.innerWidth;GetRadioValue("notenodertab");var p=.45*u;isDesktopBrowser()?p<850&&(p=850):p=800,DayPilot.Modal.alert(modal_msg,{theme:"modal_flat",top:20,width:p,okText:"Close",scrollWithPage:isMobileBrowser()}),idleRollExplorer();for(var m=document.getElementsByClassName("modal_flat_ok"),h=null,f=0;f<m.length;++f)if("Close"==(h=m[f]).innerText){gTheOKButton=h;var A=h.onclick;h.onclick=function(){A(),c(),FocusAfterOperation(),gIsIOS&&gTheMuteHandle&&(gTheMuteHandle.dispose(),gTheMuteHandle=null)};break}ABCJS.synth.supportsAudio()?(a=new ABCJS.synth.SynthController(n)).load("#playback-audio",s,{displayLoop:!0,displayRestart:!0,displayPlay:!0,displayProgress:!0,displayWarp:!0}):document.querySelector("#playback-audio").innerHTML="<div class='audio-error'>Audio is not supported in this browser.</div>",o=!1,a.disable(!0),g=ABCJS.renderAbc("playback-paper",n,l)[0],postProcessTab([g],"playback-paper",r,!0),gMIDIbuffer=d=new ABCJS.synth.CreateSynth(n),gMIDIInitStillWaiting=!1,d.init({visualObj:g}).then(function(t){if(console.log(t),a){var r=computeFade(n);a.setTune(g,o,{fadeLength:r}).then(function(t){if(console.log("Audio successfully loaded."),gSynthControl=a,gTrainerTouchControls){var n=document.getElementsByClassName("abcjs-midi-clock"),o=document.getElementsByClassName("abcjs-midi-current-tempo-wrapper");if(n&&o&&n.length>0&&o.length>0){var r=n[0];r.onclick=DecrementTempo,(r=o[0]).onclick=IncrementTempo}}}).catch(function(t){document.getElementById("loading-bar-spinner").style.display="none",gMIDIInitStillWaiting=!1,console.log("Problem loading audio for this tune")})}}).catch(function(t){document.getElementById("loading-bar-spinner").style.display="none",gMIDIInitStillWaiting=!1,console.log("Problem loading audio for this tune")}),gPlayerContainerRect=(gPlayerHolder=document.getElementById("playerholder")).getBoundingClientRect()}()}function c(){gSynthControl=null,a&&(a.destroy(),a=null)}}function TuneTrainerLaunchFromPlayer(){gTheOKButton.click(),setTimeout(function(){TuneTrainer(!0)},250)}function TuneTrainer(t){if(gAllowCopy&&""!=(n=t?getTuneByIndex(gPlayABCTuneIndex):findSelectedTune())){gPlayerABCMetronome=null,gUseWidePlayer=!1,ScanTuneForCustomTimingInjection(n),n=ProcessSelectRegionForPlay(n=n.trim());var n,o=PreProcessPlayABC(n);TuneTrainerDialog(n,o,!1,gUseWidePlayer)}}function TuneTrainerReset(){var t=!1,n=document.getElementById("looper_start_percent").value,o=document.getElementById("looper_end_percent").value,a=document.getElementById("looper_increment").value,r=document.getElementById("looper_count").value;n=parseFloat(n),o=parseFloat(o),a=parseFloat(a),r=parseFloat(r),!isNaN(n)&&!isNaN(o)&&!isNaN(a)&&!isNaN(r)&&n<=o&&n>=0&&o<=400&&a>=0&&r>0&&(gLooperSpeedStart=n,gLooperSpeedEnd=o,gLooperSpeedIncrement=a,gLooperCount=r,gLooperCurrent=gLooperSpeedStart,gLooperLoopCount=gLooperCount,t=!0),t?(gLoopCallback=null,gStartPlayCallback=null,gPreStartPlayCallback=null,gPlayerInPause=!1,gPlayMetronome=!1,gLooperMetronomeState=!1,gPlayerABCMetronome=null,gTheOKButton.click(),setTimeout(function(){TuneTrainerDialog(gPlayerLooperOriginal,gPlayerLooperProcessed,!0,gUseWidePlayer)},250)):DayPilot.Modal.alert('<p style="font-family:helvetica;font-size:14pt;text-align:center"><strong>Invalid Tune Trainer Values Entered</strong></p><p style="font-family:helvetica;font-size:14pt;margin-top:36px;">All values must be numbers.</p><p style="font-family:helvetica;font-size:14pt;">Starting tempo must be less than the ending tempo.</p><p style="font-family:helvetica;font-size:14pt;">Tempo increment must be greater than zero.</p><p style="font-family:helvetica;font-size:14pt;">Loop count must be greater than zero.</p><p style="font-family:helvetica;font-size:14pt;">Please fix and try again.</p>',{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})}function ToggleTuneTrainerMetronome(){gPlayMetronome=!gPlayMetronome,gTheOKButton.click(),setTimeout(function(){if(gPlayMetronome){if(!gPlayerABCMetronome&&!(gPlayerABCMetronome=inject_one_metronome(gPlayerLooperProcessed,!1))){gLooperMetronomeState=!1,gPlayMetronome=!1;var t='<p style="text-align:center;font-size:20pt;font-family:helvetica">Metronome Not Available for this Meter</p>';t+='<p style="font-size:14pt;line-height:20pt;font-family:helvetica;">No metronome pattern is available for the meter of this tune.</p>',t+='<p style="font-size:14pt;line-height:20pt;font-family:helvetica;">Only the original version can be played.</p>',DayPilot.Modal.alert(t,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()}).then(function(){TuneTrainerDialog(gPlayerLooperOriginal,gPlayerLooperProcessed,!0,gUseWidePlayer)});return}gLooperMetronomeState=!0,TuneTrainerDialog(gPlayerLooperOriginal,gPlayerABCMetronome,!0,gUseWidePlayer)}else gLooperMetronomeState=!1,gPlayerABCMetronome=null,TuneTrainerDialog(gPlayerLooperOriginal,gPlayerLooperProcessed,!0,gUseWidePlayer)},250)}function ToggleTuneTrainerWidePlayer(){gUseWidePlayer=!gUseWidePlayer,gTheOKButton.click(),setTimeout(function(){TuneTrainerDialog(gPlayerLooperOriginal,gPlayerLooperProcessed,!0,gUseWidePlayer)},250)}function ToggleLoopCountdown(){gLooperDoCountdown=document.getElementById("looper_docountdown").checked,gLocalStorageAvailable&&(localStorage.LooperDoCountdown=gLooperDoCountdown)}function SaveLoopCountdown(){gLooperCountdown=parseInt(gLooperCountdown=document.getElementById("looper_countdown").value),isNaN(gLooperCountdown)&&(gLooperCountdown=5),gLooperCountdown<1&&(gLooperCountdown=5),gLocalStorageAvailable&&(localStorage.LooperCountdown=gLooperCountdown)}var gLooperSpeedStart=50,gLooperSpeedEnd=100,gLooperSpeedIncrement=10,gLooperCount=1,gLooperCurrent=gLooperSpeedStart,gLooperLoopCount=gLooperCount,gPlayerLooperOriginal=null,gPlayerLooperProcessed=null,gLooperMetronomeState=!1,gTouchIncrementFive=!1,gLooperDoCountdown=!0,gLooperCountdown=5;function TuneTrainerDialog(t,n,o,a){sendGoogleAnalytics("dialog","TuneTrainer");var r,l=0,s=0;if(gMIDIbuffer=null,gTheOKButton=null,o||(gPlayerLooperOriginal=t,gPlayerLooperProcessed=n,gPlayMetronome=!1,gLooperMetronomeState=!1,gPlayerABCMetronome=null),gLooperCurrent=gLooperSpeedStart,gLooperLoopCount=gLooperCount,gLocalStorageAvailable&&(localStorage.LooperSpeedStart=gLooperSpeedStart,localStorage.LooperSpeedEnd=gLooperSpeedEnd,localStorage.LooperSpeedIncrement=gLooperSpeedIncrement,localStorage.LooperCount=gLooperCount),n=TransformABCCompliantDirectives(n),PlayerSetupCommon(n)){var g=GetRadioValue("notenodertab"),c=GetABCJSParams(g);c.oneSvgPerLine=!1,"noten"!=g&&c.tablature&&c.tablature.length>0&&(c.tablature[0].label="");var d=new CursorControl;if(gIsIOS){var u=ABCJS.synth.activeAudioContext();gTheMuteHandle=null,u&&(gTheMuteHandle=unmute(u,!1,!1))}!function t(){gLoopCallback=null,gStartPlayCallback=null,gPreStartPlayCallback=null,gPlayerInPause=!1,modal_msg='<div id="playerholder" style="height:'+(window.innerHeight-450)+'px;overflow-y:auto;margin-bottom:15px;">',gLargePlayerControls?modal_msg+='<div id="abcplayer" class="abcjs-large">':modal_msg+='<div id="abcplayer">',modal_msg+='<div id="playback-paper"></div>',modal_msg+="</div>",modal_msg+="</div>",gLargePlayerControls?modal_msg+='<div id="playback-audio" class="abcjs-large"></div>':modal_msg+='<div id="playback-audio"></div>',modal_msg+='<p class="configure_looper_text" style="text-align:center;margin:0px;margin-top:20px">',modal_msg+='<span id="looper_text_1">Starting tempo:</span> <input style="width:75px;margin-right:4px;" id="looper_start_percent" type="number" min="1" step="1" max="400" title="Tune tempo start percentage" autocomplete="off"/><span id="looper_percent_span_1">%&nbsp;&nbsp;&nbsp;&nbsp;</span>',modal_msg+='<span id="looper_text_2">Ending tempo:</span> <input style="width:75px;margin-right:4px;" id="looper_end_percent" type="number" min="1" step="1" max="400" title="Tune tempo end percentage" autocomplete="off"/><span id="looper_percent_span_2">%&nbsp;&nbsp;&nbsp;&nbsp;</span>',modal_msg+='<span id="looper_text_3">Tempo increment:</span> <input style="width:75px;margin-right:4px;" id="looper_increment" type="number" min="0" step="1" max="400" title="Tempo increment percentage" autocomplete="off"/><span id="looper_percent_span_3">%</span>',modal_msg+="</p>",modal_msg+='<p class="configure_looper_text" style="text-align:center;margin:0px;margin-top:20px">',modal_msg+='<span id="looper_text_4">Increment tempo after how many loops:</span> <input style="width:60px;margin-right:14px;" id="looper_count" type="number" min="1" step="1" max="100" title="Increment tempo after this many times through the tune" autocomplete="off"/><span id="looper_text_5">Countdown?</span><input style="width:18px;margin-left:8px;margin-right:14px;" id="looper_docountdown" type="checkbox" onchange="ToggleLoopCountdown();"/><span id="looper_text_6">Countdown secs:</span><input style="width:60px;margin-left:8px;" id="looper_countdown" type="number" min="1" step="1" max="30" title="Countdown secs" autocomplete="off" onchange="SaveLoopCountdown();"/>',modal_msg+="</p>",modal_msg+='<p class="configure_looper_text" style="text-align:center;margin:0px;margin-top:20px">',modal_msg+='<input id="looperreset" class="looperreset button btn btn-looperreset" onclick="TuneTrainerReset();" type="button" value="Apply Tune Trainer Settings and Reload the Player" title="Applies the entered tune trainer settings and reloads the player">',modal_msg+='<input id="looper_metronomebutton" class="looper_metronome button btn btn-metronome" onclick="ToggleTuneTrainerMetronome();" type="button" value="Enable Metronome" title="Enables/disables the metronome">',isDesktopBrowser()&&(modal_msg+='<input id="abcplayer_widetrainerbutton" class="abcplayer_widetrainerbutton button btn btn-wide-trainer" onclick="ToggleTuneTrainerWidePlayer();" type="button" value="Wide View" title="Toggles the trainer between normal and wide views">'),modal_msg+="</p>",modal_msg+='<a id="looperhelp" href="https://michaeleskin.com/app/userguide.html#tune_trainer" target="_blank" style="text-decoration:none;" title="Learn more about the Tune Trainer" class="dialogcornerbutton">?</a>',modal_msg+='<p id="looperstatus"></p>',modal_msg+='<div id="looperstatusbar"></div>',modal_msg+='<div id="looperstatusbaroverlay"></div>',modal_msg+='<div id="loopercountdown" class="looper-modal"><div class="looper-modal-content"><div class="looper-modal-text" id="loopercountdowntext"></div></div></div>';var o,s,u,m,y,I=window.innerWidth;if(GetRadioValue("notenodertab"),isDesktopBrowser()?(s=calc_wide_play_width(250),(o=a?s:.45*I)<850&&(o=850)):o=800,DayPilot.Modal.alert(modal_msg,{theme:"modal_flat",top:45,width:o,okText:"Close",scrollWithPage:isMobileBrowser()}),document.getElementById("looper_start_percent").value=gLooperSpeedStart,document.getElementById("looper_end_percent").value=gLooperSpeedEnd,document.getElementById("looper_increment").value=gLooperSpeedIncrement,document.getElementById("looper_count").value=gLooperCount,document.getElementById("looper_docountdown").checked=gLooperDoCountdown,document.getElementById("looper_countdown").value=gLooperCountdown,gTrainerTouchControls&&(document.getElementById("looper_text_1").onclick=b,document.getElementById("looper_text_2").onclick=b,document.getElementById("looper_text_3").onclick=b,document.getElementById("looper_text_4").onclick=b,document.getElementById("looper_percent_span_1").onclick=T,document.getElementById("looper_percent_span_2").onclick=T,document.getElementById("looper_percent_span_3").onclick=T),l=function t(){if(gLooperSpeedStart==gLooperSpeedEnd||0==gLooperSpeedIncrement)return 1;for(var n=0,o=gLooperSpeedEnd,a=gLooperSpeedIncrement,r=gLooperCount,l=gLooperSpeedStart;l<o;)n+=r,l+=a;return n}(),gLooperMetronomeState){var v=document.getElementById("looper_metronomebutton");v.value="Disable Metronome"}else{var v=document.getElementById("looper_metronomebutton");v.value="Enable Metronome"}if(isDesktopBrowser()){if(!a&&s<=o)document.getElementById("abcplayer_widetrainerbutton").style.display="none";else if(a&&!0==a){var v=document.getElementById("abcplayer_widetrainerbutton");v.value="Normal View"}}for(var C=document.getElementsByClassName("modal_flat_ok"),S=null,_=0;_<C.length;++_)if("Close"==(S=C[_]).innerText){gTheOKButton=S;var B=S.onclick;S.onclick=function(){B(),p(),FocusAfterOperation(),gIsIOS&&gTheMuteHandle&&(gTheMuteHandle.dispose(),gTheMuteHandle=null)};break}ABCJS.synth.supportsAudio()?(r=new ABCJS.synth.SynthController(n)).load("#playback-audio",d,{displayLoop:!1,displayRestart:!0,displayPlay:!0,displayProgress:!0,displayWarp:!0}):document.querySelector("#playback-audio").innerHTML="<div class='audio-error'>Audio is not supported in this browser.</div>",u=!1,r.disable(!0),m=ABCJS.renderAbc("playback-paper",n,c)[0],postProcessTab([m],"playback-paper",g,!0),gMIDIbuffer=y=new ABCJS.synth.CreateSynth(n),gMIDIInitStillWaiting=!1,y.init({visualObj:m}).then(function(t){if(console.log(t),r){var o=computeFade(n);r.setTune(m,u,{fadeLength:o}).then(function(t){if(console.log("Audio successfully loaded."),r.forceWarp(gLooperCurrent),r.isLooping=!0,gLoopCallback=h,gStartPlayCallback=f,gPreStartPlayCallback=A,gSynthControl=r,gTrainerTouchControls){var n=document.getElementsByClassName("abcjs-midi-clock"),o=document.getElementsByClassName("abcjs-midi-current-tempo-wrapper");if(n&&o&&n.length>0&&o.length>0){var a=n[0];a.onclick=DecrementTempo,(a=o[0]).onclick=IncrementTempo}}}).catch(function(t){document.getElementById("loading-bar-spinner").style.display="none",gMIDIInitStillWaiting=!1,console.log("Problem loading audio for this tune")})}}).catch(function(t){document.getElementById("loading-bar-spinner").style.display="none",gMIDIInitStillWaiting=!1,console.log("Problem loading audio for this tune")}),gPlayerContainerRect=(gPlayerHolder=document.getElementById("playerholder")).getBoundingClientRect()}()}function p(){gSynthControl=null,r&&(r.destroy(),r=null)}function m(){if(!(s>l)){if(gLooperSpeedStart==gLooperSpeedEnd||0==gLooperSpeedIncrement){var t=document.getElementById("looperstatusbaroverlay");t.style.display="block",(t=document.getElementById("looperstatusbar")).style.display="block",t.style.width="212px";return}setTimeout(function(){var t=212,n=document.getElementById("looperstatusbaroverlay");n.style.display="block",(n=document.getElementById("looperstatusbar")).style.display="block",t=212*(s/l),n.style.width=t+"px"},10)}}function h(){if(gPlayerInPause)gPlayerInPause=!1;else if(isNaN(gLooperSpeedEnd)||isNaN(gLooperSpeedIncrement)||isNaN(gLooperCount))gPlayerInPause=!1;else{s++;var t=!1;if(gLooperCurrent==gLooperSpeedEnd&&(t=!0),0!=gLooperSpeedIncrement){0==--gLooperLoopCount&&(gLooperLoopCount=gLooperCount,gLooperCurrent!=gLooperSpeedEnd?((gLooperCurrent+=gLooperSpeedIncrement)>=gLooperSpeedEnd&&(gLooperCurrent=gLooperSpeedEnd,t=!0),r.pause(),r.forceWarp(gLooperCurrent)):t=!0);var n=document.getElementById("looperstatus");t?n.innerHTML="Tempo:&nbsp;"+gLooperCurrent+"%":gLooperSpeedStart!=gLooperSpeedEnd&&0!=gLooperSpeedIncrement?n.innerHTML="Tempo:&nbsp;"+gLooperCurrent+"%&nbsp;&nbsp;-&nbsp;&nbsp;Loop "+(gLooperCount-gLooperLoopCount+1)+" of "+gLooperCount:n.innerHTML="Tempo:&nbsp;"+gLooperCurrent+"%",m()}}}function f(){var t=document.getElementById("looperstatus");if(gLooperSpeedStart!=gLooperSpeedEnd&&0!=gLooperSpeedIncrement)t.innerHTML="Tempo:&nbsp;"+gLooperCurrent+"%&nbsp;&nbsp;-&nbsp;&nbsp;Loop 1 of "+gLooperCount;else{var t=document.getElementById("looperstatus");t.innerHTML="Tempo:&nbsp;"+gLooperCurrent+"%"}m()}function A(t){if(gLooperDoCountdown=document.getElementById("looper_docountdown").checked,gLooperCountdown=parseInt(gLooperCountdown=document.getElementById("looper_countdown").value),isNaN(gLooperCountdown)&&(gLooperCountdown=5),gLooperCountdown<1&&(gLooperCountdown=5),gLocalStorageAvailable&&(localStorage.LooperDoCountdown=gLooperDoCountdown,localStorage.LooperCountdown=gLooperCountdown),gLooperDoCountdown){var n=document.getElementById("loopercountdown");n.style.display="block";var o=gLooperCountdown,a=document.getElementById("loopercountdowntext");a.textContent=o;var r=setInterval(function(){o--,a.textContent=o,o<=0&&(clearInterval(r),n.style.display="none",setTimeout(function(){t()},1e3))},1e3)}else t()}function b(t){var n=this.innerHTML,o=null,a=0;0==n.indexOf("Starting")?(o=document.getElementById("looper_start_percent"),a=0):0==n.indexOf("Ending")?(o=document.getElementById("looper_end_percent"),a=1):0==n.indexOf("Tempo")?(o=document.getElementById("looper_increment"),a=2):0==n.indexOf("Increment")&&(o=document.getElementById("looper_count"),a=3);let r=this.getBoundingClientRect();var l=t.clientX,s=!0,g=1;l-r.left>r.width/2&&(s=!1),3!=a&&gTouchIncrementFive&&(g=5);var c=o.value;switch(a){case 0:case 1:c=parseFloat(c),s?(c-=g)<1&&(c=1):(c+=g)>400&&(c=400);break;case 2:c=parseFloat(c),s?(c-=g)<0&&(c=0):(c+=g)>400&&(c=400);break;case 3:c=parseInt(c),s?(c-=g)<1&&(c=1):(c+=g)>100&&(c=100)}o.value=c}function T(){gTouchIncrementFive=!gTouchIncrementFive}}var gSynthControl=null;function DecrementTempo(){var t=document.getElementsByClassName("abcjs-midi-tempo");if(t&&t.length>0){var n=t[0],o=n.value;o=parseInt(o),!isNaN(o)&&o>5&&(o-=5,n.value=o,gSynthControl.pause(),gSynthControl.forceWarp(o))}}function IncrementTempo(){var t=document.getElementsByClassName("abcjs-midi-tempo");if(t&&t.length>0){var n=t[0],o=n.value;o=parseInt(o),isNaN(o)||(o+=5,n.value=o,gSynthControl.pause(),gSynthControl.forceWarp(o))}}function setupDGDAE(){var t=document.getElementById("b5");t.value="dgdae",(t=document.getElementById("b5label")).title="Shows DGDAE 5-string Bouzouki tablature",t.innerHTML="DGDAE"}function setupCGDAE(){var t=document.getElementById("b5");t.value="cgdae",(t=document.getElementById("b5label")).title="Shows CGDAE 5-string Fiddle tablature",t.innerHTML="CGDAE"}function setupCGDA(){var t=document.getElementById("b4");t.value="cgda",(t=document.getElementById("b4label")).title="Shows CGDA Mandola/Mandocello tablature",t.innerHTML="CGDA"}function setupGDAD(){var t=document.getElementById("b4");t.value="gdad",(t=document.getElementById("b4label")).title="Shows GDAD Bouzouki tablature",t.innerHTML="GDAD"}var gAlwaysInjectPrograms=!0,gTheMelodyProgram=0,gTheBassProgram=0,gTheChordProgram=0,gAlwaysInjectVolumes=!0,gTheBassVolume=64,gTheChordVolume=64,gOverridePlayMIDIParams=!1,gInjectTab_StripChords=!0,gInjectTab_FontFamily="Palatino",gInjectTab_TabFontSize=11,gInjectTab_StaffSep=80,gInjectTab_MusicSpace=10,gInjectTab_TabLocation=1,gInjectTab_ConcertinaStyle=0,gInjectTab_ConcertinaFingering=0,gInjectTab_GaryCoover=!1,gInjectTab_PushGlyph="",gInjectTab_DrawGlyph="",gInjectTab_UseBarForDraw=!1,gLargePlayerControls=!1,gTrainerTouchControls=!1,gBambooFluteKey=1,gMDulcimerStyle=0,gMDulcimerStripBadTunes=!1,gMDulcimerUseDashForOpenString=!1;function GetInitialConfigurationSettings(){var t=localStorage.AlwaysInjectPrograms;gAlwaysInjectPrograms=!t||"true"==t,gTheMelodyProgram=(t=localStorage.TheMelodyProgram)?t:0,gTheBassProgram=(t=localStorage.TheBassProgram)?t:0,gTheChordProgram=(t=localStorage.TheChordProgram)?t:0,gAlwaysInjectVolumes=!(t=localStorage.AlwaysInjectVolumes)||"true"==t,gTheBassVolume=(t=localStorage.TheBassVolume)?t:64,gTheChordVolume=(t=localStorage.TheChordVolume)?t:64,gOverridePlayMIDIParams=!!(t=localStorage.OverridePlayMIDIParams)&&"true"==t,gInjectTab_FontFamily=(t=localStorage.InjectTab_FontFamily)?t:"Palatino",gInjectTab_TabFontSize=(t=localStorage.InjectTab_TabFontSize)?t:10,gInjectTab_StaffSep=(t=localStorage.InjectTab_StaffSep)?t:80,gInjectTab_MusicSpace=(t=localStorage.InjectTab_MusicSpace)?t:10,gInjectTab_TabLocation=(t=localStorage.InjectTab_TabLocation)?t:1,gInjectTab_ConcertinaStyle=(t=localStorage.InjectTab_ConcertinaStyle)?t:0,gInjectTab_ConcertinaFingering=(t=localStorage.InjectTab_ConcertinaFingering)?t:1,gInjectTab_GaryCoover=!!(t=localStorage.InjectTab_GaryCoover)&&"true"==t,gInjectTab_StripChords=!(t=localStorage.InjectTab_StripChords)||"true"==t,gInjectTab_PushGlyph=(t=localStorage.InjectTab_PushGlyph)?t:"",gInjectTab_DrawGlyph=(t=localStorage.InjectTab_DrawGlyph)?t:"",gInjectTab_UseBarForDraw=!!(t=localStorage.InjectTab_UseBarForDraw)&&"true"==t,gFullScreenScaling=(t=localStorage.FullScreenScaling)?t:50;var n=localStorage.angloButtonNames;n?gAngloButtonNames=JSON.parse(n):resetAngloButtonNames();var o=localStorage.musicXMLImportOptionsV6;o?gMusicXMLImportOptions=JSON.parse(o):resetMusicXMLImportOptions(),gLargePlayerControls=(t=localStorage.LargePlayerControls)?"true"==t:!!gIsIPhone||!!gIsAndroid,gTrainerTouchControls=(t=localStorage.TrainerTouchControls)?"true"==t:!!gIsIPhone||!!gIsAndroid||!!gIsIPad,gBambooFluteKey=(t=localStorage.BambooFluteKey)?t:1,gMDulcimerStyle=(t=localStorage.MDulcimerStyle)?t:0,gMDulcimerStripBadTunes=!!(t=localStorage.MDulcimerStripBadTunes)&&"true"==t,gMDulcimerUseDashForOpenString=!!(t=localStorage.MDulcimerUseDashForOpenString)&&"true"==t;var a=localStorage.RenderingFonts;if(a)try{(gRenderingFonts=JSON.parse(a)).tablabelfont||(gRenderingFonts.tablabelfont="Trebuchet MS 14"),gRenderingFonts.tabgracefont||(gRenderingFonts.tabgracefont="Arial 8")}catch(r){resetABCRenderingFonts()}else resetABCRenderingFonts();var l=localStorage.abcShowTabNames;if(gShowTabNames=!l||"true"==l,gCapo=(t=localStorage.abcCapo)?t:0,gMP3Bitrate=(t=localStorage.MP3Bitrate)?t:224,(t=localStorage.theSoundFont4)?(gDefaultSoundFont=t,gTheActiveSoundFont=t):gTheActiveSoundFont=gDefaultSoundFont="https://paulrosen.github.io/midi-js-soundfonts/FluidR3_GM/",gAutoscrollPlayer=!(t=localStorage.AutoscrollPlayer)||"true"==t,gAutoSwingHornpipes=!(t=localStorage.AutoSwingHornpipes)||"true"==t,t=localStorage.AutoSwingFactor){var s=parseFloat(t);isNaN(s)||(gAutoSwingFactor=s)}else gAutoSwingFactor=.25;gUseCustomGMSounds=!(t=localStorage.UseCustomGMSounds)||"true"==t,gTipJarCount=(t=localStorage.TipJarCount)?t:0,(t=localStorage.SavedSnapshot)||(localStorage.SavedSnapshot=""),(t=localStorage.SavedSnapshot2)||(localStorage.SavedSnapshot2=""),(t=localStorage.SavedSnapshot3)||(localStorage.SavedSnapshot3=""),(t=localStorage.SavedSnapshot4)||(localStorage.SavedSnapshot4=""),gSaveLastAutoSnapShot=!!(t=localStorage.SaveLastAutoSnapShot)&&"true"==t,(t=localStorage.LastAutoSnapShot)||(localStorage.LastAutoSnapShot=""),(t=localStorage.PDFFont)&&(gPDFFont=t),(t=localStorage.PDFFontStyle)&&(gPDFFontStyle=t),(t=localStorage.PDFOrientation)&&(gPDFOrientation=t),(t=localStorage.UseComhaltasABC)&&(gUseComhaltasABC="true"==t),(t=localStorage.AllowMIDIInput)&&(gAllowMIDIInput="true"==t),(t=localStorage.MIDIChromatic)&&(gMIDIChromatic="true"==t);var g=localStorage.PDFTunebookConfig;if(g?((void 0==(gPDFTunebookConfig=JSON.parse(g)).bAdd_add_full_tunebook||null==gPDFTunebookConfig.bAdd_add_full_tunebook)&&(gPDFTunebookConfig.bAdd_add_full_tunebook=!1),(void 0==gPDFTunebookConfig.bAdd_add_fonts||null==gPDFTunebookConfig.bAdd_add_fonts)&&(gPDFTunebookConfig.bAdd_add_fonts=!1)):resetPDFTunebookConfig(),(t=localStorage.LooperSpeedStart)?(gLooperSpeedStart=parseFloat(t),isNaN(gLooperSpeedStart)&&(gLooperSpeedStart=50)):gLooperSpeedStart=50,(t=localStorage.LooperSpeedEnd)?(gLooperSpeedEnd=parseFloat(t),isNaN(gLooperSpeedEnd)&&(gLooperSpeedEnd=100)):gLooperSpeedEnd=100,(t=localStorage.LooperSpeedIncrement)?(gLooperSpeedIncrement=parseFloat(t),isNaN(gLooperSpeedIncrement)&&(gLooperSpeedIncrement=10)):gLooperSpeedIncrement=10,(t=localStorage.LooperCount)?(gLooperCount=parseInt(t),isNaN(gLooperCount)&&(gLooperCount=1)):gLooperCount=1,gLooperDoCountdown=!(t=localStorage.LooperDoCountdown)||"true"==t,(t=localStorage.LooperCountdown)?(gLooperCountdown=parseInt(t),isNaN(gLooperCountdown)&&(gLooperCountdown=5)):gLooperCountdown=5,t=localStorage.abcStaffSpacing){var s=parseInt(t);gStaffSpacing=isNaN(s)?STAFFSPACEOFFSET+STAFFSPACEDEFAULT:STAFFSPACEOFFSET+s}else{var c=(gStaffSpacing=STAFFSPACEOFFSET+STAFFSPACEDEFAULT)-STAFFSPACEOFFSET;localStorage.abcStaffSpacing=c}if((t=localStorage.BatchExportDelayMS)?(gBatchExportDelayMS=parseInt(t),(isNaN(gBatchExportDelayMS)||gBatchExportDelayMS<0)&&(gBatchExportDelayMS=200)):gBatchExportDelayMS=200,(t=localStorage.BatchMP3ExportDelayMS)?(gBatchMP3ExportDelayMS=parseInt(t),(isNaN(gBatchMP3ExportDelayMS)||gBatchMP3ExportDelayMS<0)&&(gBatchMP3ExportDelayMS=250)):gBatchMP3ExportDelayMS=250,(t=localStorage.ExportWidth)?(gExportWidth=parseInt(t),(isNaN(gExportWidth)||gExportWidth<0)&&(gExportWidth=2400)):gExportWidth=2400,(t=localStorage.ExportWidthAll)?(gExportWidthAll=parseInt(t),(isNaN(gExportWidthAll)||gExportWidthAll<0)&&(gExportWidthAll=2400)):gExportWidthAll=2400,(t=localStorage.MetronomeVolume)?(gMetronomeVolume=parseInt(t),(isNaN(gMetronomeVolume)||gMetronomeVolume<0||gMetronomeVolume>127)&&(gMetronomeVolume=48)):gMetronomeVolume=48,gRawFirstTime=!0,(t=localStorage.RawFirstTime)&&(gRawFirstTime="true"==t),gRawHighlightColor="#F00000",(t=localStorage.RawHighlightColor)&&(gRawHighlightColor=t),gForceLeftJustifyTitles=!1,(t=localStorage.ForceLeftJustifyTitles)&&(gForceLeftJustifyTitles="true"==t),gPlayerStatusOnLeft=!1,(t=localStorage.PlayerStatusOnLeft)&&(gPlayerStatusOnLeft="true"==t),gDisableSelectedPlay=!1,(t=localStorage.DisableSelectedPlay)&&(gDisableSelectedPlay="true"==t),gRollUseRollForIrishRoll=!1,(t=localStorage.RollUseRollForIrishRoll)&&(gRollUseRollForIrishRoll="true"==t),gRoll2DefaultParams="0.95 0.8 1.0 0.75 0.9 1.0 0.75 1.0",t=localStorage.Roll2DefaultParams){var d=validate_roll_2_params(t,!1);d&&(gRoll2DefaultParams=t,d=validate_roll_2_params(t,!0))}if(gRoll3DefaultParams="1.45 0.6 1.0 0.75 0.9 1.0 0.75 1.0",t=localStorage.Roll3DefaultParams){var d=validate_roll_3_params(t,!1);d&&(gRoll3DefaultParams=t,d=validate_roll_3_params(t,!0))}gDefaultTuneDatabase=0,(t=localStorage.DefaultTuneDatabase)&&(gDefaultTuneDatabase=parseInt(t)),gTuneDatabaseRetryTimeMS=3e3,(t=localStorage.TuneDatabaseRetryTimeMS)&&(gTuneDatabaseRetryTimeMS=parseInt(t)),gTuneDatabaseRetryCount=10,(t=localStorage.TuneDatabaseRetryCount)&&(gTuneDatabaseRetryCount=parseInt(t)),gShapeNoteStyle=0,(t=localStorage.ShapeNoteStyle)&&(gShapeNoteStyle=t),gFeaturesShowSearch=!0,(t=localStorage.FeaturesShowSearch)&&(gFeaturesShowSearch="true"==t),gFeaturesShowExamples=!0,(t=localStorage.FeaturesShowExamples)&&(gFeaturesShowExamples="true"==t),gFeaturesShowTemplates=!0,(t=localStorage.FeaturesShowTemplates)&&(gFeaturesShowTemplates="true"==t),gFeaturesShowTablatures=!0,(t=localStorage.FeaturesShowTablatures)&&(gFeaturesShowTablatures="true"==t),gFeaturesShowExplorers=!0,(t=localStorage.FeaturesShowExplorers)&&(gFeaturesShowExplorers="true"==t),gFeaturesShowExport=!0,(t=localStorage.FeaturesShowExport)&&(gFeaturesShowExport="true"==t),gFeaturesShowCompliance=!1,(t=localStorage.FeaturesShowCompliance)&&(gFeaturesShowCompliance="true"==t),gFeaturesShowBagpipeDrones=!0,(t=localStorage.FeaturesShowBagpipeDrones)&&(gFeaturesShowBagpipeDrones="true"==t),gFeaturesShowTabButtons=!0,(t=localStorage.FeaturesShowTabButtons)&&(gFeaturesShowTabButtons="true"==t),(t=localStorage.ABCEditorFontSize)?(gABCEditorFontsize=parseInt(t),isNaN(gABCEditorFontsize)&&(gABCEditorFontsize=13)):gABCEditorFontsize=13,gShowDiagnostics=!1,(t=localStorage.ShowDiagnostics)&&(gShowDiagnostics="true"==t),gReverbString="chamber 0.95 0.05",(t=localStorage.ReverbString2)&&(gReverbString=t),gDoTinyURLAPIKeyOverride=!1,gTinyURLAPIKeyOverride="",(t=localStorage.TinyURLAPIKeyOverride)&&""!=t&&(gDoTinyURLAPIKeyOverride=!0,gTinyURLAPIKeyOverride=t),gTinyURLCount=0,(t=localStorage.TinyURLCount)&&(gTinyURLCount=t),gMIDIImportWarned=!1,(t=localStorage.MIDIImportWarned)&&(gMIDIImportWarned="true"==t),gShowDGDAETab=!1,(t=localStorage.ShowDGDAETab)&&(gShowDGDAETab="true"==t)&&setupDGDAE(),gShowCGDATab=!1,(t=localStorage.ShowCGDATab)&&(gShowCGDATab="true"==t)&&setupCGDA(),gConfirmClear=!0,(t=localStorage.ConfirmClear)&&(gConfirmClear="true"==t),gAllowOfflineInstruments=!1,(t=localStorage.AllowOfflineInstruments)&&(gAllowOfflineInstruments="true"==t),SaveConfigurationSettings()}function SaveConfigurationSettings(){gLocalStorageAvailable&&(localStorage.AlwaysInjectPrograms=gAlwaysInjectPrograms,localStorage.TheMelodyProgram=gTheMelodyProgram,localStorage.TheBassProgram=gTheBassProgram,localStorage.TheChordProgram=gTheChordProgram,localStorage.AlwaysInjectVolumes=gAlwaysInjectVolumes,localStorage.TheBassVolume=gTheBassVolume,localStorage.TheChordVolume=gTheChordVolume,localStorage.OverridePlayMIDIParams=gOverridePlayMIDIParams,localStorage.InjectTab_StripChords=gInjectTab_StripChords,localStorage.InjectTab_FontFamily=gInjectTab_FontFamily,localStorage.InjectTab_TabFontSize=gInjectTab_TabFontSize,localStorage.InjectTab_StaffSep=gInjectTab_StaffSep,localStorage.InjectTab_MusicSpace=gInjectTab_MusicSpace,localStorage.InjectTab_TabLocation=gInjectTab_TabLocation,localStorage.InjectTab_ConcertinaStyle=gInjectTab_ConcertinaStyle,localStorage.InjectTab_ConcertinaFingering=gInjectTab_ConcertinaFingering,localStorage.InjectTab_GaryCoover=gInjectTab_GaryCoover,localStorage.InjectTab_PushGlyph=gInjectTab_PushGlyph,localStorage.InjectTab_DrawGlyph=gInjectTab_DrawGlyph,localStorage.InjectTab_UseBarForDraw=gInjectTab_UseBarForDraw,localStorage.FullScreenScaling=gFullScreenScaling,localStorage.angloButtonNames=JSON.stringify(gAngloButtonNames),localStorage.musicXMLImportOptionsV6=JSON.stringify(gMusicXMLImportOptions),localStorage.LargePlayerControls=gLargePlayerControls,localStorage.TrainerTouchControls=gTrainerTouchControls,localStorage.BambooFluteKey=gBambooFluteKey,localStorage.MDulcimerStyle=gMDulcimerStyle,localStorage.MDulcimerStripBadTunes=gMDulcimerStripBadTunes,localStorage.MDulcimerUseDashForOpenString=gMDulcimerUseDashForOpenString,localStorage.RenderingFonts=JSON.stringify(gRenderingFonts),gShowTabNames?localStorage.abcShowTabNames="true":localStorage.abcShowTabNames="false",localStorage.abcCapo=gCapo,localStorage.MP3Bitrate=gMP3Bitrate,localStorage.theSoundFont4=gDefaultSoundFont,localStorage.AutoscrollPlayer=gAutoscrollPlayer,localStorage.AutoSwingHornpipes=gAutoSwingHornpipes,localStorage.AutoSwingFactor=gAutoSwingFactor,localStorage.UseCustomGMSounds=gUseCustomGMSounds,localStorage.TipJarCount=gTipJarCount,localStorage.SaveLastAutoSnapShot=gSaveLastAutoSnapShot,localStorage.PDFFont=gPDFFont,localStorage.PDFFontStyle=gPDFFontStyle,localStorage.UseComhaltasABC=gUseComhaltasABC,localStorage.AllowMIDIInput=gAllowMIDIInput,localStorage.MIDIChromatic=gMIDIChromatic,localStorage.PDFTunebookConfig=JSON.stringify(gPDFTunebookConfig),localStorage.LooperSpeedStart=gLooperSpeedStart,localStorage.LooperSpeedEnd=gLooperSpeedEnd,localStorage.LooperSpeedIncrement=gLooperSpeedIncrement,localStorage.LooperCount=gLooperCount,localStorage.LooperDoCountdown=gLooperDoCountdown,localStorage.LooperCountdown=gLooperCountdown,localStorage.BatchExportDelayMS=gBatchExportDelayMS,localStorage.BatchMP3ExportDelayMS=gBatchMP3ExportDelayMS,localStorage.ExportWidth=gExportWidth,localStorage.ExportWidthAll=gExportWidthAll,localStorage.MetronomeVolume=gMetronomeVolume,localStorage.RawFirstTime=gRawFirstTime,localStorage.RawHighlightColor=gRawHighlightColor,localStorage.ForceLeftJustifyTitles=gForceLeftJustifyTitles,localStorage.PlayerStatusOnLeft=gPlayerStatusOnLeft,localStorage.RollUseRollForIrishRoll=gRollUseRollForIrishRoll,localStorage.Roll2DefaultParams=gRoll2DefaultParams,localStorage.Roll3DefaultParams=gRoll3DefaultParams,localStorage.DefaultTuneDatabase=gDefaultTuneDatabase,localStorage.TuneDatabaseRetryTimeMS=gTuneDatabaseRetryTimeMS,localStorage.TuneDatabaseRetryCount=gTuneDatabaseRetryCount,localStorage.ShapeNoteStyle=gShapeNoteStyle,localStorage.DisableSelectedPlay=gDisableSelectedPlay,localStorage.FeaturesShowSearch=gFeaturesShowSearch,localStorage.FeaturesShowExamples=gFeaturesShowExamples,localStorage.FeaturesShowTemplates=gFeaturesShowTemplates,localStorage.FeaturesShowTablatures=gFeaturesShowTablatures,localStorage.FeaturesShowExplorers=gFeaturesShowExplorers,localStorage.FeaturesShowExport=gFeaturesShowExport,localStorage.FeaturesShowCompliance=gFeaturesShowCompliance,localStorage.FeaturesShowTabButtons=gFeaturesShowTabButtons,localStorage.FeaturesShowBagpipeDrones=gFeaturesShowBagpipeDrones,localStorage.ABCEditorFontSize=gABCEditorFontsize,localStorage.ShowDiagnostics=gShowDiagnostics,localStorage.ReverbString2=gReverbString,localStorage.TinyURLAPIKeyOverride=gTinyURLAPIKeyOverride,localStorage.TinyURLCount=gTinyURLCount,localStorage.ShowDGDAETab=gShowDGDAETab,localStorage.ShowCGDATab=gShowCGDATab,localStorage.ConfirmClear=gConfirmClear,localStorage.AllowOfflineInstruments=gAllowOfflineInstruments)}var gMusicXMLImportOptions={};function resetMusicXMLImportOptions(){gMusicXMLImportOptions={b:4,n:0,c:0,v:0,d:4,x:0,noped:0,p:"",v1:0,stm:0,s:0,t:0,u:0,v:0,v1:0,mnum:-1,m:1,addq:1,q:100,addstavenum:0}}function setMusicXMLOptions(){gMusicXMLImportOptions.x=$("#musicxml_nlb").prop("checked")?1:0,0==gMusicXMLImportOptions.x?(gMusicXMLImportOptions.addstavenum=0,$("#musicxml_addstavenum").prop("checked",!1)):gMusicXMLImportOptions.addstavenum=$("#musicxml_addstavenum").prop("checked")?1:0,gMusicXMLImportOptions.u=$("#musicxml_unfld").prop("checked")?1:0,gMusicXMLImportOptions.b=parseInt($("#musicxml_bpl").val()||4),gMusicXMLImportOptions.n=parseInt($("#musicxml_cpl").val()||0),gMusicXMLImportOptions.c=parseInt($("#musicxml_crf").val()||0),gMusicXMLImportOptions.d=parseInt($("#musicxml_den").val()||4),gMusicXMLImportOptions.m=parseInt($("#musicxml_midi").val()||0),gMusicXMLImportOptions.noped=$("#musicxml_noped").prop("checked")?1:0,gMusicXMLImportOptions.v1=$("#musicxml_v1").prop("checked")?1:0,gMusicXMLImportOptions.stm=$("#musicxml_stems").prop("checked")?1:0,gMusicXMLImportOptions.mnum=parseInt($("#musicxml_mnum").val()||-1),gMusicXMLImportOptions.addq=$("#musicxml_addq").prop("checked")?1:0,gMusicXMLImportOptions.q=parseInt($("#musicxml_q").val()||100)}function idleXMLImport(){0==gMusicXMLImportOptions.x&&(gMusicXMLImportOptions.addstavenum=0),$("#musicxml_unfld").prop("checked",1==gMusicXMLImportOptions.u),$("#musicxml_bpl").val(gMusicXMLImportOptions.b),$("#musicxml_cpl").val(gMusicXMLImportOptions.n),$("#musicxml_crf").val(gMusicXMLImportOptions.c),$("#musicxml_den").val(gMusicXMLImportOptions.d),$("#musicxml_midi").val(gMusicXMLImportOptions.m),$("#musicxml_nlb").prop("checked",1==gMusicXMLImportOptions.x),$("#musicxml_noped").prop("checked",1==gMusicXMLImportOptions.noped),$("#musicxml_v1").prop("checked",1==gMusicXMLImportOptions.v1),$("#musicxml_stems").prop("checked",1==gMusicXMLImportOptions.stm),$("#musicxml_mnum").val(gMusicXMLImportOptions.mnum),$("#musicxml_addq").prop("checked",1==gMusicXMLImportOptions.addq),$("#musicxml_q").val(gMusicXMLImportOptions.q),$("#musicxml_addstavenum").prop("checked",1==gMusicXMLImportOptions.addstavenum)}function defaultMusicXMLSettings(){sendGoogleAnalytics("action","defaultMusicXMLSettings");var t="Are you sure you want to reset the MusicXML/MIDI Import Settings to their default values?";t=makeCenteredPromptString(t),DayPilot.Modal.confirm(t,{top:180,theme:"modal_flat",scrollWithPage:AllowDialogsToScroll()}).then(function(t){t.canceled||(resetMusicXMLImportOptions(),idleXMLImport())})}function ConfigureMusicXMLImport(){sendGoogleAnalytics("dialog","ConfigureMusicXMLImport");var t=JSON.parse(JSON.stringify(gMusicXMLImportOptions)),n='<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">MusicXML/MIDI Import Settings&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/app/userguide.html#musicxml" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></p>';n+='<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">Bars-per-line:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" style="width:60px;" id="musicxml_bpl" type="text" pattern="d+" title="Default: 3"/></div>\n',n+='<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">Characters-per-line:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" style="width:60px;" id="musicxml_cpl" type="text" pattern="d+" title="Default: 0 - ignore"/></div>\n',n+='<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">Measure numbers:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" style="width:60px;" id="musicxml_mnum" type="text" pattern="d+" title="-1: No measure numbers, 1..n: Number every n-th measure, 0: Number every system"/></div>\n',n+='<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">Include measure numbers at end of staves:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" id="musicxml_addstavenum" type="checkbox"/></div>\n',n+='<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">Unfold repeats:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" id="musicxml_unfld" type="checkbox"/></div>\n',n+='<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">Credit text filter (level 0-6):&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" style="width:60px;" id="musicxml_crf" type="text" pattern="[0123456]" title="0 (Default), 1, 2, 3, 4, 5, 6"/></div>\n',n+='<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">Denominator unit length for L: tags:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" style="width:60px;" id="musicxml_den" type="text" pattern="dd?" title="0 (Automatic), 1, 2, 4, 8, 16, or 32"/></div>\n',n+='<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">%%MIDI options:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" style="width:60px;" id="musicxml_midi" type="text" pattern="[012]" title="0: No MIDI, 1: Only program, 2: All MIDI"/></div>\n',n+='<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">No score line breaks:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" id="musicxml_nlb" type="checkbox"/></div>\n',n+='<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">No pedal directions:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" id="musicxml_noped" type="checkbox"/></div>\n',n+='<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">All directions to first voice:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" id="musicxml_v1" type="checkbox"/></div>\n',n+='<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">Translate stem directions:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" id="musicxml_stems" type="checkbox"/></div>\n',n+='<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">Inject Q: tag if not present:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" id="musicxml_addq" type="checkbox"/></div>\n',n+='<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">Q: tag value to inject:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" style="width:60px;" id="musicxml_q" type="text" pattern="d+" title="Default: 100"/></div>\n',n+='<p style="text-align:center;margin-top:22px;"><input id="default_musicxml_settings" class="btn btn-clearbutton default_musicxml_settings" onclick="defaultMusicXMLSettings()" type="button" value="Reset to Default" title="Reset the MusicXML/MIDI import settings to their default values"></p>\n';let o=[{html:n}];setTimeout(function(){idleXMLImport()},150),DayPilot.Modal.form(o,{},{theme:"modal_flat",top:50,width:500,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(n){n.canceled?gMusicXMLImportOptions=t:gLocalStorageAvailable&&(localStorage.musicXMLImportOptionsV6=JSON.stringify(gMusicXMLImportOptions))})}function resetAngloButtonNames(){gAngloButtonNames=["L1a","L2a","L3a","L4a","L5a","R1a","R2a","R3a","R4a","R5a","L1","L2","L3","L4","L5","R1","R2","R3","R4","R5","L6","L7","L8","L9","L10","R6","R7","R8","R9","R10"]}function defaultAngloButtonNames(){sendGoogleAnalytics("action","defaultAngloButtonNames");var t="Are you sure you want to reset the Anglo Concertina button names to their default values?";t=makeCenteredPromptString(t),DayPilot.Modal.confirm(t,{top:180,theme:"modal_flat",scrollWithPage:AllowDialogsToScroll()}).then(function(t){if(!t.canceled){var n;for(resetAngloButtonNames(),n=0;n<10;++n){var o="r1c"+(n+1);document.getElementById(o).value=gAngloButtonNames[n]}for(n=0;n<10;++n){var o="r2c"+(n+1);document.getElementById(o).value=gAngloButtonNames[n+10]}for(n=0;n<10;++n){var o="r3c"+(n+1);document.getElementById(o).value=gAngloButtonNames[n+20]}}})}function initAngloButtonNames(){var t;for(t=0;t<10;++t){var n="r1c"+(t+1);document.getElementById(n).value=gAngloButtonNames[t]}for(t=0;t<10;++t){var n="r2c"+(t+1);document.getElementById(n).value=gAngloButtonNames[t+10]}for(t=0;t<10;++t){var n="r3c"+(t+1);document.getElementById(n).value=gAngloButtonNames[t+20]}}function angloFingeringsChangeHandler(){var t;for(t=0;t<10;++t){var n="r1c"+(t+1);gAngloButtonNames[t]=document.getElementById(n).value}for(t=0;t<10;++t){var n="r2c"+(t+1);gAngloButtonNames[t+10]=document.getElementById(n).value}for(t=0;t<10;++t){var n="r3c"+(t+1);gAngloButtonNames[t+20]=document.getElementById(n).value}for(t=0;t<30;++t)""==gAngloButtonNames[t]&&(gAngloButtonNames[t]=" ")}function ConfigureAngloFingerings(){sendGoogleAnalytics("dialog","ConfigureAngloFingerings");var t=gAngloButtonNames.slice(),n='<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">Configure Anglo Concertina Tablature Button Names&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/app/userguide.html#injecting_box_or_anglo_concertina_tablature" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>';n+='<div id="anglo-button-names-dialog">',n+='<table style="margin-bottom:24px;text-align:center;">\n',n+="<tr>\n",n+='<td><input class="anglobuttonnames" type="text" id="r1c1" onchange="angloFingeringsChangeHandler()"></td>\n',n+='<td><input class="anglobuttonnames" type="text" id="r1c2" onchange="angloFingeringsChangeHandler()"></td>\n',n+='<td><input class="anglobuttonnames" type="text" id="r1c3" onchange="angloFingeringsChangeHandler()"></td>\n',n+='<td><input class="anglobuttonnames" type="text" id="r1c4" onchange="angloFingeringsChangeHandler()"></td>\n',n+='<td><input class="anglobuttonnames" type="text" id="r1c5" onchange="angloFingeringsChangeHandler()"></td>\n',n+='<td><input class="anglobuttonnames" type="text" id="r1c6" style="margin-left:36px" onchange="angloFingeringsChangeHandler()"></td>\n',n+='<td><input class="anglobuttonnames" type="text" id="r1c7" onchange="angloFingeringsChangeHandler()"></td>\n',n+='<td><input class="anglobuttonnames" type="text" id="r1c8" onchange="angloFingeringsChangeHandler()"></td>\n',n+='<td><input class="anglobuttonnames" type="text" id="r1c9" onchange="angloFingeringsChangeHandler()"></td>\n',n+='<td><input class="anglobuttonnames" type="text" id="r1c10" onchange="angloFingeringsChangeHandler()"></td>\n',n+="</tr>\n",n+="<tr>\n",n+='<td><input class="anglobuttonnames" type="text" id="r2c1" onchange="angloFingeringsChangeHandler()"></td>\n',n+='<td><input class="anglobuttonnames" type="text" id="r2c2" onchange="angloFingeringsChangeHandler()"></td>\n',n+='<td><input class="anglobuttonnames" type="text" id="r2c3" onchange="angloFingeringsChangeHandler()"></td>\n',n+='<td><input class="anglobuttonnames" type="text" id="r2c4" onchange="angloFingeringsChangeHandler()"></td>\n',n+='<td><input class="anglobuttonnames" type="text" id="r2c5" onchange="angloFingeringsChangeHandler()"></td>\n',n+='<td><input class="anglobuttonnames" type="text" id="r2c6" style="margin-left:36px" onchange="angloFingeringsChangeHandler()"></td>\n',n+='<td><input class="anglobuttonnames" type="text" id="r2c7" onchange="angloFingeringsChangeHandler()"></td>\n',n+='<td><input class="anglobuttonnames" type="text" id="r2c8" onchange="angloFingeringsChangeHandler()"></td>\n',n+='<td><input class="anglobuttonnames" type="text" id="r2c9" onchange="angloFingeringsChangeHandler()"></td>\n',n+='<td><input class="anglobuttonnames" type="text" id="r2c10" onchange="angloFingeringsChangeHandler()"></td>\n',n+="</tr>\n",n+="<tr>\n",n+='<td><input class="anglobuttonnames" type="text" id="r3c1" onchange="angloFingeringsChangeHandler()"></td>\n',n+='<td><input class="anglobuttonnames" type="text" id="r3c2" onchange="angloFingeringsChangeHandler()"></td>\n',n+='<td><input class="anglobuttonnames" type="text" id="r3c3" onchange="angloFingeringsChangeHandler()"></td>\n',n+='<td><input class="anglobuttonnames" type="text" id="r3c4" onchange="angloFingeringsChangeHandler()"></td>\n',n+='<td><input class="anglobuttonnames" type="text" id="r3c5" onchange="angloFingeringsChangeHandler()"></td>\n',n+='<td><input class="anglobuttonnames" type="text" id="r3c6" style="margin-left:36px" onchange="angloFingeringsChangeHandler()"></td>\n',n+='<td><input class="anglobuttonnames" type="text" id="r3c7" onchange="angloFingeringsChangeHandler()"></td>\n',n+='<td><input class="anglobuttonnames" type="text" id="r3c8" onchange="angloFingeringsChangeHandler()"></td>\n',n+='<td><input class="anglobuttonnames" type="text" id="r3c9" onchange="angloFingeringsChangeHandler()"></td>\n',n+='<td><input class="anglobuttonnames" type="text" id="r3c10" onchange="angloFingeringsChangeHandler()"></td>\n',n+="</tr>\n",n+="</table>\n",n+="</div>\n",n+='<p style="text-align:center;margin-top:22px;"><input id="default_anglo_fingerings" class="btn btn-clearbutton default_anglo_fingerings" onclick="defaultAngloButtonNames()" type="button" value="Reset to Default" title="Reset the Anglo Concertina button names to their default values"></p>\n';let o=[{html:n}];setTimeout(function(){initAngloButtonNames()},150),DayPilot.Modal.form(o,{},{theme:"modal_flat",top:160,width:800,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(n){n.canceled?gAngloButtonNames=t:gLocalStorageAvailable&&(localStorage.angloButtonNames=JSON.stringify(gAngloButtonNames))})}function ConfigureTablatureSettings(){sendGoogleAnalytics("dialog","ConfigureTablatureSettings");let t={configure_font_family:gInjectTab_FontFamily,configure_tab_font_size:gInjectTab_TabFontSize,configure_staffsep:gInjectTab_StaffSep,configure_musicspace:gInjectTab_MusicSpace,configure_tab_location:parseInt(gInjectTab_TabLocation),configure_concertina_style:parseInt(gInjectTab_ConcertinaStyle),configure_concertina_fingering:parseInt(gInjectTab_ConcertinaFingering),configure_strip_chords:gInjectTab_StripChords,configure_pushglyph:gInjectTab_PushGlyph,configure_drawglyph:gInjectTab_DrawGlyph,configure_use_bar_for_draw:gInjectTab_UseBarForDraw,configure_gary_coover:gInjectTab_GaryCoover};DayPilot.Modal.form([{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Tablature/Solf\xe8ge Injection Settings&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/app/userguide.html#injecting_tablature" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="margin-top:18px;font-size:12pt;line-height:14pt;font-family:helvetica"><strong>Tablature/Solf\xe8ge Font Settings:</strong></p>'},{name:"Font family (Recommended: Palatino):",id:"configure_font_family",type:"text",cssClass:"configure_tab_settings_form_text_wide"},{name:"Tablature/Solf\xe8ge font size (Recommended: 10):",id:"configure_tab_font_size",type:"text",cssClass:"configure_tab_settings_form_text"},{name:"%%staffsep value (Recommended: 80):",id:"configure_staffsep",type:"text",cssClass:"configure_tab_settings_form_text"},{name:"%%musicspace value (Recommended: 10):",id:"configure_musicspace",type:"text",cssClass:"configure_tab_settings_form_text"},{name:"Character(s) for Push indication (Clearing this field will reset to  ):",id:"configure_pushglyph",type:"text",cssClass:"configure_tab_settings_form_text"},{name:"Character(s) for Draw indication (Clearing this field will reset to  ):",id:"configure_drawglyph",type:"text",cssClass:"configure_tab_settings_form_text"},{name:"    Use a bar over button name to indicate Draw (overrides Push and Draw characters)",id:"configure_use_bar_for_draw",type:"checkbox",cssClass:"configure_tab_settings_form_text"},{name:"Tab location relative to notation:",id:"configure_tab_location",type:"select",options:[{name:"  Above",id:"0"},{name:"  Below",id:"1"},],cssClass:"configure_tab_settings_select"},{name:"    Strip all chords and tab before injecting tab (Tab below only. Tab above always strips.)",id:"configure_strip_chords",type:"checkbox",cssClass:"configure_tab_settings_form_text"},{html:'<p style="margin-top:20px;font-size:12pt;line-height:12pt;font-family:helvetica"><strong>Anglo Concertina Tablature Settings:</strong></p>'},{name:"Concertina style:",id:"configure_concertina_style",type:"select",options:[{name:"  Jeffries",id:"0"},{name:"  Wheatstone",id:"1"},],cssClass:"configure_tab_settings_select"},{name:"Preferred fingerings:",id:"configure_concertina_fingering",type:"select",options:[{name:"  On-Row",id:"0"},{name:"  Cross-Row",id:"1"},],cssClass:"configure_tab_settings_select"},{html:'<p style="margin-top:16px;font-size:12pt;line-height:12pt;font-family:helvetica">On-Row: Favors D5 and E5 on right-side C-row.</p>'},{html:'<p style="margin-top:12px;font-size:12pt;line-height:12pt;font-family:helvetica">Cross-Row: Favors D5 and E5 on the left-side G-row.</p>'},{html:'<p style="margin-top:12px;font-size:12pt;line-height:12pt;font-family:helvetica">Favors C5 on the left-side G-row draw, B4 on the right-side C-row draw.</p>'},{name:"    Gary Coover style tab (single notes only, overrides button name and direction settings)",id:"configure_gary_coover",type:"checkbox",cssClass:"configure_tab_settings_form_text"},{html:'<p style="text-align:center;margin-top:22px;"><input id="configure_anglo_fingerings" class="btn btn-subdialog configure_anglo_fingerings" onclick="ConfigureAngloFingerings()" type="button" value="Configure Anglo Concertina Tablature Button Names" title="Configure the Anglo Concertina tablature button names"></p>'},],t,{theme:"modal_flat",top:10,width:720,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(t){t.canceled||(gInjectTab_FontFamily=t.result.configure_font_family,gInjectTab_TabFontSize=t.result.configure_tab_font_size,gInjectTab_StaffSep=t.result.configure_staffsep,gInjectTab_MusicSpace=t.result.configure_musicspace,gInjectTab_TabLocation=t.result.configure_tab_location,gInjectTab_ConcertinaStyle=t.result.configure_concertina_style,gInjectTab_ConcertinaFingering=t.result.configure_concertina_fingering,gInjectTab_StripChords=t.result.configure_strip_chords,gInjectTab_GaryCoover=t.result.configure_gary_coover,""==(gInjectTab_PushGlyph=t.result.configure_pushglyph)&&(gInjectTab_PushGlyph=""),""==(gInjectTab_DrawGlyph=t.result.configure_drawglyph)&&(gInjectTab_DrawGlyph=""),gInjectTab_UseBarForDraw=t.result.configure_use_bar_for_draw,SaveConfigurationSettings())})}function idleOpenFonts(){gIsIOS&&document.getElementById("load_rendering_fonts_fs").removeAttribute("accept"),document.getElementById("load_rendering_fonts_fs").onchange=()=>{let t=document.getElementById("load_rendering_fonts_fs");if(0===t.files.length){var n="Please select a font settings file";n=makeCenteredPromptString(n),DayPilot.Modal.alert(n,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});return}loadFontSettings(t.files[0]),t.value=""}}function loadFontSettings(t){sendGoogleAnalytics("action","loadFontSettings");let n=new FileReader;n.addEventListener("load",t=>{var n=JSON.parse(t.target.result);if(!n.titlefont||!n.voicefont){var o="This is not a valid font settings file.";o=makeCenteredPromptString(o),DayPilot.Modal.alert(o,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});return}(gDialogRenderingFonts=n).tablabelfont||(gDialogRenderingFonts.tablabelfont="Trebuchet MS 14"),gDialogRenderingFonts.tabgracefont||(gDialogRenderingFonts.tabgracefont="Arial 8"),idleFontsDialog()}),n.readAsText(t)}function saveFontSettings(){sendGoogleAnalytics("action","saveFontSettings"),saveTextFile("Please enter a filename for your font settings:","abc_tool_fonts.txt",JSON.stringify({titlefont:$('[name="configure_titlefont"]').val(),subtitlefont:$('[name="configure_subtitlefont"]').val(),infofont:$('[name="configure_infofont"]').val(),partsfont:$('[name="configure_partsfont"]').val(),tempofont:$('[name="configure_tempofont"]').val(),textfont:$('[name="configure_textfont"]').val(),composerfont:$('[name="configure_composerfont"]').val(),annotationfont:$('[name="configure_annotationfont"]').val(),gchordfont:$('[name="configure_gchordfont"]').val(),vocalfont:$('[name="configure_vocalfont"]').val(),wordsfont:$('[name="configure_wordsfont"]').val(),tablabelfont:$('[name="configure_tablabelfont"]').val(),tabnumberfont:$('[name="configure_tabnumberfont"]').val(),tabgracefont:$('[name="configure_tabgracefont"]').val(),historyfont:$('[name="configure_historyfont"]').val(),voicefont:$('[name="configure_voicefont"]').val()}))}function idleFontsDialog(){$('[name="configure_titlefont"]').val(gDialogRenderingFonts.titlefont),$('[name="configure_subtitlefont"]').val(gDialogRenderingFonts.subtitlefont),$('[name="configure_infofont"]').val(gDialogRenderingFonts.infofont),$('[name="configure_partsfont"]').val(gDialogRenderingFonts.partsfont),$('[name="configure_tempofont"]').val(gDialogRenderingFonts.tempofont),$('[name="configure_textfont"]').val(gDialogRenderingFonts.textfont),$('[name="configure_composerfont"]').val(gDialogRenderingFonts.composerfont),$('[name="configure_annotationfont"]').val(gDialogRenderingFonts.annotationfont),$('[name="configure_gchordfont"]').val(gDialogRenderingFonts.gchordfont),$('[name="configure_vocalfont"]').val(gDialogRenderingFonts.vocalfont),$('[name="configure_wordsfont"]').val(gDialogRenderingFonts.wordsfont),$('[name="configure_tablabelfont"]').val(gDialogRenderingFonts.tablabelfont),$('[name="configure_tabnumberfont"]').val(gDialogRenderingFonts.tabnumberfont),$('[name="configure_tabgracefont"]').val(gDialogRenderingFonts.tabgracefont),$('[name="configure_historyfont"]').val(gDialogRenderingFonts.historyfont),$('[name="configure_voicefont"]').val(gDialogRenderingFonts.voicefont)}function resetABCRenderingFonts(){gDialogRenderingFonts={titlefont:"Palatino 18",subtitlefont:"Palatino 13",infofont:"Palatino 13",partsfont:"Palatino 13",tempofont:"Palatino 13",textfont:"Palatino 13",composerfont:"Palatino 13",annotationfont:"Palatino 13",gchordfont:"Verdana 12",vocalfont:"Palatino 13",wordsfont:"Palatino 13",tablabelfont:"Trebuchet MS 14",tabnumberfont:"Arial 12",tabgracefont:"Arial 8",historyfont:"Times New Roman 14",voicefont:"Times New Roman 13"}}function defaultFontSettings(){sendGoogleAnalytics("action","defaultFontSettings");var t="Are you sure you want to reset the ABC rendering fonts to their default values?";t=makeCenteredPromptString(t),DayPilot.Modal.confirm(t,{top:180,theme:"modal_flat",scrollWithPage:AllowDialogsToScroll()}).then(function(t){t.canceled||(resetABCRenderingFonts(),SaveConfigurationSettings(),idleFontsDialog())})}function loadFontSettingsClickHandler(){document.getElementById("load_rendering_fonts_fs").click()}function ConfigureFonts(){sendGoogleAnalytics("dialog","ConfigureFonts");let t={configure_titlefont:gRenderingFonts.titlefont,configure_subtitlefont:gRenderingFonts.subtitlefont,configure_infofont:gRenderingFonts.infofont,configure_partsfont:gRenderingFonts.partsfont,configure_tempofont:gRenderingFonts.tempofont,configure_textfont:gRenderingFonts.textfont,configure_composerfont:gRenderingFonts.composerfont,configure_annotationfont:gRenderingFonts.annotationfont,configure_gchordfont:gRenderingFonts.gchordfont,configure_vocalfont:gRenderingFonts.vocalfont,configure_wordsfont:gRenderingFonts.wordsfont,configure_tablabelfont:gRenderingFonts.tablabelfont,configure_tabnumberfont:gRenderingFonts.tabnumberfont,configure_tabgracefont:gRenderingFonts.tabgracefont,configure_historyfont:gRenderingFonts.historyfont,configure_voicefont:gRenderingFonts.voicefont};setTimeout(function(){idleOpenFonts()},150),DayPilot.Modal.form([{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Configure ABC Rendering Fonts&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/app/userguide.html#configure_fonts" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{name:"Title font (Default: Palatino 18):",id:"configure_titlefont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Subtitle font (Default: Palatino 13):",id:"configure_subtitlefont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Info font (Default: Palatino 13):",id:"configure_infofont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Composer font (Default: Palatino 13):",id:"configure_composerfont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Tempo font (Default: Palatino 13):",id:"configure_tempofont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Guitar chord font (Default: Verdana 12):",id:"configure_gchordfont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Tab label font (Default: Trebuchet MS 14):",id:"configure_tablabelfont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Tab number font (Default: Arial 12):",id:"configure_tabnumberfont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Tab grace font (Default: Arial 8):",id:"configure_tabgracefont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"History font (Default: Times New Roman 14):",id:"configure_historyfont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Text font (Default: Palatino 13):",id:"configure_textfont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Annotation font (Default: Palatino 13):",id:"configure_annotationfont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Voice font (Default: Times New Roman 13):",id:"configure_voicefont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Parts font (Default: Palatino 13):",id:"configure_partsfont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Vocal font (Default: Palatino 13):",id:"configure_vocalfont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Words font (Default: Palatino 13):",id:"configure_wordsfont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{html:'<p style="text-align:center;margin-top:22px;"><input id="save_rendering_fonts" class="btn btn-top save_rendering_fonts" onclick="saveFontSettings()" type="button" value="Save to File" title="Saves the ABC rendering font settings to a file"><input type="file" id="load_rendering_fonts_fs" accept=".txt,.TXT" hidden/><input class="btn btn-top load_rendering_fonts" type="button" id="load_rendering_fonts" title="Loads the ABC rendering font settings from a file" value="Load from File" onclick="loadFontSettingsClickHandler()"/><input id="default_rendering_fonts" class="btn btn-clearbutton default_rendering_fonts" onclick="defaultFontSettings()" type="button" value="Reset to Default" title="Reset the ABC rendering fonts to their default values"></p>'}],t,{theme:"modal_flat",top:10,width:600,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(t){t.canceled||(gRenderingFonts.titlefont=t.result.configure_titlefont,gRenderingFonts.subtitlefont=t.result.configure_subtitlefont,gRenderingFonts.infofont=t.result.configure_infofont,gRenderingFonts.partsfont=t.result.configure_partsfont,gRenderingFonts.tempofont=t.result.configure_tempofont,gRenderingFonts.textfont=t.result.configure_textfont,gRenderingFonts.composerfont=t.result.configure_composerfont,gRenderingFonts.annotationfont=t.result.configure_annotationfont,gRenderingFonts.gchordfont=t.result.configure_gchordfont,gRenderingFonts.vocalfont=t.result.configure_vocalfont,gRenderingFonts.wordsfont=t.result.configure_wordsfont,gRenderingFonts.tablabelfont=t.result.configure_tablabelfont,gRenderingFonts.tabnumberfont=t.result.configure_tabnumberfont,gRenderingFonts.tabgracefont=t.result.configure_tabgracefont,gRenderingFonts.historyfont=t.result.configure_historyfont,gRenderingFonts.voicefont=t.result.configure_voicefont,SaveConfigurationSettings(),RenderAsync(!0,null))})}function AddAutoPlay(){var t=urltextbox.value;-1==t.indexOf("&play=1")&&(t+="&play=1"),urltextbox.value=t,document.getElementById("addautoplay").value="Auto-Play Added!",setTimeout(function(){var t=document.getElementById("addautoplay");t&&(t.value="Add Auto-Play")},1500)}function AddDisableEditing(){var t=urltextbox.value;-1==t.indexOf("&dx=1")&&(t+="&dx=1"),urltextbox.value=t,document.getElementById("adddisableediting").value="Disable Editing Added!",setTimeout(function(){var t=document.getElementById("adddisableediting");t&&(t.value="Add Disable Editing")},1500)}function AddOpenInEditor(){var t=urltextbox.value;-1==t.indexOf("&editor=1")&&(t+="&editor=1"),urltextbox.value=t,document.getElementById("addopenineditor").value="Open in Editor Added!",setTimeout(function(){var t=document.getElementById("addopenineditor");t&&(t.value="Add Open in Editor")},1500)}function SharingControlsDialog(){sendGoogleAnalytics("dialog","SharingControlsDialog");var t='<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">Sharing Controls&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/app/userguide.html#sharing_controls" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>';t+='<div id="sharing-controls-dialog">',t+='<p style="margin-top:28px;">',t+='<input id="testurl" class="urlcontrols btn btn-urlcontrols" onclick="TestShareURL()" type="button" value="Test Share URL" title="Opens the Share URL in a new tab">',t+='<input id="copyurl" class="urlcontrols btn btn-urlcontrols" onclick="CopyShareURL()" type="button" value="Copy Share URL" title="Copies the Share URL to the clipboard">',t+='<input id="saveurl" class="urlcontrols btn btn-urlcontrols" onclick="SaveShareURL()" type="button" value="Save Share URL" title="Saves the Share URL to a file">',t+='<input id="shortenurl" class="urlcontrols btn btn-urlcontrols" onclick="ShortenURL(event)" type="button" value="Shorten URL" title="Shortens the Share URL and copies it to the clipboard">',t+='<input id="generateqrcode" class="urlcontrolslast btn btn-urlcontrols" onclick="GenerateQRCode(event)" type="button" value="Generate QR Code" title="Generates a QR Code for the Share URL.&nbsp;&nbsp;Even if this button is greyed-out, Shift-click attempts to generate a QR code from the text in the Share URL box.">',t+="</p>",t+='<p style="margin-top:24px;">',t+='<textarea id="urltextbox" rows="10" cols="80" spellcheck="false" autocorrect="off" autocapitalize="off" placeholder="URL for sharing will appear here" >',t+="</textarea>",t+="</p>",t+='<p id="shareurlcaption">Share URL</p>',t+='<p style="text-align:center;margin-top:36px;"><input id="addautoplay" class="urlcontrols btn btn-urlcontrols" onclick="AddAutoPlay()" type="button" value="Add Auto-Play" title="Adds &play=1 to the ShareURL.&nbsp;&nbsp;Tune will open in the player."><input id="addopenineditor" class="urlcontrols btn btn-urlcontrols" onclick="AddOpenInEditor()" type="button" value="Add Open in Editor" title="Adds &editor=1 to the ShareURL.&nbsp;&nbsp;Share links will load in the editor.&nbsp;&nbsp;This setting overrides Add Auto-Play."><input id="adddisableediting" class="urlcontrolslast btn btn-urlcontrols" onclick="AddDisableEditing()" type="button" value="Add Disable Editing" title="Adds &dx=1 to the ShareURL.&nbsp;&nbsp;Entering the editor from the full screen tune view will be disabled.&nbsp;&nbsp;Also overrides Add Open in Editor."></p>',t+="</div>",setTimeout(function(){CreateURLfromHTML()},200),DayPilot.Modal.alert(t,{theme:"modal_flat",top:100,width:800,scrollWithPage:AllowDialogsToScroll()}).then(function(){})}function idlePDFExportDialog(){function t(t){if("incipits"!=t){var n=document.getElementsByName("configure_incipitscolumns");n&&0!=n.length&&(n[0].disabled=!0,n[0].style.opacity=.4)}else{var n=document.getElementsByName("configure_incipitscolumns");n&&0!=n.length&&(n[0].disabled=!1,n[0].style.opacity=1)}}var n=document.getElementsByName("configure_tunelayout");n&&0!=n.length&&(t(n[0].value),n[0].onchange=function(){t(this.value)})}function PDFExportDialog(){if(gRenderingPDF)return;var t,n=!0;gIsMaximized&&(n=!1),n?sendGoogleAnalytics("dialog","PDFExportDialog"):sendGoogleAnalytics("dialog","PDFExportDialogFS");let o=[{name:"  Letter",id:"letter"},{name:"  A4",id:"a4"},],a=[{name:"  Portrait",id:"portrait"},{name:"  Landscape",id:"landscape"},],r=[{name:"  One Tune per Page",id:"one"},{name:"  Multiple Tunes per Page",id:"multi"},{name:"  Notes Incipits",id:"incipits"},{name:"  ABC Text Incipits",id:"incipits_abc"},{name:"  ABC Text Incipits Sorted",id:"incipits_abc_sort"},{name:"  ABC Text Complete Tunes",id:"incipits_abc_full"},{name:"  ABC Text Complete Tunes - Comhaltas ABC",id:"incipits_abc_full_cce"},{name:"  QR Code for Each Tune",id:"all_qr_codes"},{name:"  Notation + QR Code for Each Tune",id:"mixed_notation_qr"},],l=[{name:"  One Column",id:1},{name:"  Two Columns",id:2},],s=[{name:"  None",id:"none"},{name:"  Top Left",id:"tl"},{name:"  Top Center",id:"tc"},{name:"  Top Right",id:"tr"},{name:"  Bottom Left",id:"bl"},{name:"  Bottom Center",id:"bc"},{name:"  Bottom Right",id:"br"},{name:"  Alternating Top Left/Right",id:"tlr"},{name:"  Alternating Top Right/Left",id:"trl"},{name:"  Alternating Bottom Left/Right",id:"blr"},{name:"  Alternating Bottom Right/Left",id:"brl"},],g=[{name:"  Times",id:"Times"},{name:"  Helvetica",id:"Helvetica"},{name:"  Courier",id:"Courier"},],c=[{name:"  Normal",id:"Normal"},{name:"  Bold",id:"Bold"},{name:"  Oblique",id:"Oblique"},{name:"  Bold Oblique",id:"BoldOblique"},];var d="letter",u=getPDFFormat();-1!=u.indexOf("a4")&&(d="a4",u=u.replace("_a4",""));var p=getPageNumbers(),m=getFirstPage(),h=gPDFFont,f=h.toLowerCase();"times"!=f&&"helvetica"!=f&&"courier"!=f&&(h="Times");var A=gPDFFontStyle;if(""==A)A="Normal";else{var b=A.toLowerCase();"Times"==h&&("italic"==b&&(A="Oblique"),"bolditalic"==b&&(A="BoldOblique")),"normal"!=(b=A.toLowerCase())&&"bold"!=b&&"oblique"!=b&&"boldoblique"!=b&&(A="Normal")}let T={configure_papersize:d,configure_tunelayout:u,configure_orientation:gPDFOrientation,configure_incipitscolumns:gIncipitsColumns,configure_pagenumber:p,configure_pagenumberonfirstpage:"yes"==m,configure_fontname:h,configure_fontstyle:A};t=n?[{html:'<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">Export PDF Tunebook&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/app/userguide.html#export_pdf_tunebook" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="text-align:center;margin-top:24px;"><input id="tunebookbuilder" class="advancedcontrols btn btn-injectcontrols-tunebookbuilder" onclick="PDFTunebookBuilder();" type="button" value="Inject PDF Tunebook Features" title="Inject commands at the top of your PDF tunebook for adding a Title Page, Table of Contents, Index, Page Headers, Page Footers, Playback Links, and Custom QR Code"><input id="pdfinjectlargeprint" class="advancedcontrols btn btn-injectcontrols-headers-pdf" onclick="NotationSpacingExplorer()" type="button" value="Notation Spacing Explorer" title="Find the right spacing and scale values for your notation"></p>'},{name:"Paper Size:",id:"configure_papersize",type:"select",options:o,cssClass:"configure_pdf_papersize_select"},{name:"Orientation:",id:"configure_orientation",type:"select",options:a,cssClass:"configure_pdf_orientation_select"},{name:"Tune Layout:",id:"configure_tunelayout",type:"select",options:r,cssClass:"configure_pdf_tunelayout_select"},{name:"Notes Incipits Columns:",id:"configure_incipitscolumns",type:"select",options:l,cssClass:"configure_pdf_incipitscolumns_select"},{name:"Page Number Location:",id:"configure_pagenumber",type:"select",options:s,cssClass:"configure_pdf_pagenumber_select"},{name:"            Page Number on First Page",id:"configure_pagenumberonfirstpage",type:"checkbox",cssClass:"configure_pdf_settings_form_text"},{html:'<p style="margin-top:36px;font-size:12pt;line-height:18px;font-family:helvetica;">Font for Title Page, Table of Contents, Index, Page Headers/Footers, Page Numbers, Text Incipits:</strong></p>'},{name:"Font:",id:"configure_fontname",type:"select",options:g,cssClass:"configure_pdf_fontname_select"},{name:"Font Style:",id:"configure_fontstyle",type:"select",options:c,cssClass:"configure_pdf_fontstyle_select"},{html:'<p style="font-size:3pt;">&nbsp;</p>'}]:[{html:'<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">Export PDF Tunebook&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/app/userguide.html#export_pdf_tunebook" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{name:"Paper Size:",id:"configure_papersize",type:"select",options:o,cssClass:"configure_pdf_papersize_select"},{name:"Orientation:",id:"configure_orientation",type:"select",options:a,cssClass:"configure_pdf_orientation_select"},{name:"Tune Layout:",id:"configure_tunelayout",type:"select",options:r,cssClass:"configure_pdf_tunelayout_select"},{name:"Notes Incipits Columns:",id:"configure_incipitscolumns",type:"select",options:l,cssClass:"configure_pdf_incipitscolumns_select"},{name:"Page Number Location:",id:"configure_pagenumber",type:"select",options:s,cssClass:"configure_pdf_pagenumber_select"},{name:"            Page Number on First Page",id:"configure_pagenumberonfirstpage",type:"checkbox",cssClass:"configure_pdf_settings_form_text"},{html:'<p style="margin-top:36px;font-size:12pt;line-height:18px;font-family:helvetica;">Font for Title Page, Table of Contents, Index, Page Headers/Footers, Page Numbers, Text Incipits:</strong></p>'},{name:"Font:",id:"configure_fontname",type:"select",options:g,cssClass:"configure_pdf_fontname_select"},{name:"Font Style:",id:"configure_fontstyle",type:"select",options:c,cssClass:"configure_pdf_fontstyle_select"},{html:'<p style="font-size:3pt;">&nbsp;</p>'}],setTimeout(function(){idlePDFExportDialog()},150),DayPilot.Modal.form(t,T,{theme:"modal_flat",top:100,width:760,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(t){if(!t.canceled){gIncipitsColumns=t.result.configure_incipitscolumns;var n=t.result.configure_papersize;gPDFPaperSize=n;var o=t.result.configure_tunelayout;"a4"==n&&("incipits_abc"==o?o="incipits_a4_abc":"incipits_abc_sort"==o?o="incipits_a4_abc_sort":"incipits_abc_full"==o?o="incipits_a4_abc_full":"incipits_abc_full_cce"==o?o="incipits_a4_abc_full_cce":"all_qr_codes"==o?o="all_qr_codes_a4":"mixed_notation_qr"==o?o="mixed_notation_qr_a4":o+="_a4"),sendGoogleAnalytics("pdf_orientation",gPDFOrientation=t.result.configure_orientation),"portrait"==gPDFOrientation?(gRenderPixelRatio=2,"letter"==n?(gPageWidth=535,gTPTOPOFFSET=435,gINDEXTOPOFFSET=330,gTOCTOPOFFSET=330,gPAGENUMBERTOP=296,gTEXTINCIPITTOPOFFSET=330,gTEXTINCIPITLEFTMARGIN=45,gTEXTINCIPITRIGHTMARGIN=200):(gPageWidth=535,gTPTOPOFFSET=455,gINDEXTOPOFFSET=350,gTOCTOPOFFSET=350,gPAGENUMBERTOP=313,gTEXTINCIPITTOPOFFSET=350,gTEXTINCIPITLEFTMARGIN=45,gTEXTINCIPITRIGHTMARGIN=195)):(gRenderPixelRatio=3,"letter"==n?(gPageWidth=718,gTPTOPOFFSET=330,gINDEXTOPOFFSET=265,gTOCTOPOFFSET=265,gPAGENUMBERTOP=232,gTEXTINCIPITTOPOFFSET=265,gTEXTINCIPITLEFTMARGIN=100,gTEXTINCIPITRIGHTMARGIN=250):(gPageWidth=785,gTPTOPOFFSET=350,gINDEXTOPOFFSET=255,gTOCTOPOFFSET=255,gPAGENUMBERTOP=232,gTEXTINCIPITTOPOFFSET=255,gTEXTINCIPITLEFTMARGIN=105,gTEXTINCIPITRIGHTMARGIN=281)),setPDFFormat(o),setPageNumbers(t.result.configure_pagenumber),t.result.configure_pagenumberonfirstpage?setFirstPage("yes"):setFirstPage("no");var a=t.result.configure_fontname;gPDFFont=a;var r=t.result.configure_fontstyle;"Normal"==r?r="":"Times"===a&&("oblique"==r.toLowerCase()?r="Italic":"boldoblique"==r.toLowerCase()&&(r="BoldItalic")),gPDFFontStyle=r,SavePDFSettings(),gTheABC.value=TransformABCCompliantDirectives(gTheABC.value),ExportPDF()}})}var gMoreABCToolsOKButton=null;function Configure_AdvancedControlsDialog_UI(){var t=gFeaturesShowTablatures,n=gFeaturesShowExplorers,o=gFeaturesShowExport,a=gFeaturesShowCompliance,r=gFeaturesShowBagpipeDrones;let l={showtablatures:gFeaturesShowTablatures,showexplorers:gFeaturesShowExplorers,showexport:gFeaturesShowExport,showcompliance:gFeaturesShowCompliance,showbagpipedrones:gFeaturesShowBagpipeDrones};var s=[{html:'<p style="text-align:center;font-size:14pt;font-family:helvetica;margin-left:15px;">More ABC Tools Feature Options</p>'},{name:"          Show Tablature Injectors",id:"showtablatures",type:"checkbox",cssClass:"configure_ui_options_form_text"},{name:"          Show MIDI, Swing, Grace, Roll, and Reverb Explorers",id:"showexplorers",type:"checkbox",cssClass:"configure_ui_options_form_text"},];isDesktopBrowser()?s.push({name:"          Show Export, Sort, and Incipits features",id:"showexport",type:"checkbox",cssClass:"configure_ui_options_form_text"}):s.push({name:"          Show Sort and Incipits features",id:"showexport",type:"checkbox",cssClass:"configure_ui_options_form_text"}),s.push({name:"          Show ABC Private Directive Compliance Tools",id:"showcompliance",type:"checkbox",cssClass:"configure_ui_options_form_text"}),s.push({name:"          Show Transpose to Key and Inject Bagpipe Sounds",id:"showbagpipedrones",type:"checkbox",cssClass:"configure_ui_options_form_text"}),DayPilot.Modal.form(s,l,{theme:"modal_flat",top:100,width:500,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(l){!l.canceled&&(gFeaturesShowTablatures=l.result.showtablatures,gFeaturesShowExplorers=l.result.showexplorers,gFeaturesShowExport=l.result.showexport,gFeaturesShowCompliance=l.result.showcompliance,gFeaturesShowBagpipeDrones=l.result.showbagpipedrones,(gFeaturesShowTablatures!=t||gFeaturesShowExplorers!=n||gFeaturesShowExport!=o||gFeaturesShowCompliance!=a||gFeaturesShowBagpipeDrones!=r)&&(SaveConfigurationSettings(),gMoreABCToolsOKButton.click(),setTimeout(function(){AdvancedControlsDialog()},250)))})}function IdleMoreABCTools(){for(var t=document.getElementsByClassName("modal_flat_ok"),n=null,o=0;o<t.length;++o)if("OK"==(n=t[o]).innerText){gMoreABCToolsOKButton=n;break}}function AdvancedControlsDialog(){sendGoogleAnalytics("dialog","AdvancedControlsDialog");var t='<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">More ABC Tools&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/app/userguide.html#more_tools" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span><img id="moreabctoolssettings" class="moreabctoolssettings moresettingsbutton" src="img/settings.png" title="More ABC Tools Settings" onclick="Configure_AdvancedControlsDialog_UI();"</img></p>';t+='<div id="advanced-controls-dialog">',t+='<p style="text-align:center;font-size:14pt;font-family:helvetica;margin-top:22px;">Show/Hide ABC Features</p>',t+='<p style="text-align:center;">',t+='<input id="toggleannotations" class="advancedcontrolsdisabled btn btn-advancedcontrols" onclick="ToggleAnnotations(false)" type="button" value="Hide Annotations" title="Hides/Shows all common annotations in the ABC">',t+='<input id="toggletext" class="advancedcontrolsdisabled btn btn-advancedcontrols" onclick="ToggleTextAnnotations(false)" type="button" value="Hide Text" title="Hides/Shows all text in the ABC">',t+='<input id="togglechords" class="advancedcontrolsdisabled btn btn-advancedcontrols" onclick="ToggleChords(false)" type="button" value="Hide Chords" title="Hides/Shows all chords in the ABC">',t+='<input id="toggletab" class="advancedcontrolsdisabled btn btn-advancedcontrols" onclick="ToggleTab(false)" type="button" value="Hide Injected Tab" title="Hides/Shows all injected tablature in the ABC">',t+='<input id="toggleornaments" class="advancedcontrolsdisabled btn btn-advancedcontrols" onclick="ToggleOrnaments(false)" type="button" value="Hide Ornaments" title="Hides/Shows all ~ and {} style ornaments in the ABC">',t+="</p>",t+='<p style="text-align:center;font-size:14pt;font-family:helvetica;margin-top:22px;">Strip ABC Features</p>',t+='<p style="text-align:center;">',t+='<input id="stripannotations" class="advancedcontrolsdisabled btn btn-injectcontrols" onclick="ToggleAnnotations(true)" type="button" value="Strip Annotations" title="Strips all common annotations from the ABC">',t+='<input id="striptext" class="advancedcontrolsdisabled btn btn-injectcontrols" onclick="ToggleTextAnnotations(true)" type="button" value="Strip Text" title="Strips all text from the ABC">',t+='<input id="stripchords" class="advancedcontrolsdisabled btn btn-injectcontrols" onclick="ToggleChords(true)" type="button" value="Strip Chords" title="Strips all chords from the ABC">',t+='<input id="striptab" class="advancedcontrolsdisabled btn btn-injectcontrols" onclick="ToggleTab(true)" type="button" value="Strip Injected Tab" title="Strips all injected tablature from the ABC">',t+='<input id="stripornaments" class="advancedcontrolsdisabled btn btn-injectcontrols" onclick="ToggleOrnaments(true)" type="button" value="Strip Ornaments" title="Strips all injected ~ and {} style ornaments from the ABC">',t+="</p>",t+='<p style="text-align:center;font-size:14pt;font-family:helvetica;margin-top:22px;">ABC Injection Features</p>',t+='<p style="text-align:center;">',t+='<input id="injecttunenumbers" class="advancedcontrols btn btn-injectcontrols-headers" onclick="TuneTitlesNumbersDialog()" type="button" value="Inject Tune Title Numbers" title="Opens a dialog where you can add or remove numbers on the tune titles">',t+='<input id="injectsectionheader" class="advancedcontrols btn btn-injectcontrols-headers" onclick="InjectSectionHeader()" type="button" value="Inject PDF Section Header" title="Injects a PDF section header placeholder tune at the cursor insertion point">',t+='<input id="injectfontsettings" class="advancedcontrols btn btn-injectcontrols-headers" onclick="InjectFontSettings()" type="button" value="Inject Font Settings" title="Injects all ABC font directives at the top of the current or all tunes from the current font settings">',t+="</p>",t+='<p style="text-align:center;margin-top:22px;">',t+='<input id="injectallmidiparams" class="advancedcontrols btn btn-injectcontrols-headers" onclick="InjectAllMIDIParams()" type="button" value="Inject MIDI Programs and Volumes" title="Injects MIDI Soundfont, Melody program, Bass program, Chord program, and volume annotations into one or all tunes">',t+='<input id="injectmetronome" class="advancedcontrols btn btn-injectcontrols-headers" onclick="InjectMetronome()" type="button" value="Inject Metronome" title="Injects ABC for a metronome into one or all tunes">',t+='<input id="injectclicktrackall" class="advancedcontrols btn btn-injectcontrols-headers" onclick="InjectRepeatsAndClickTrackAll()" type="button" value="Inject Repeats + Intros" title="Injects repeated copies of tunes and optional style-adaptive two-bar click intros into every tune">',t+="</p>",t+='<p style="text-align:center;margin-top:22px;">',t+='<input id="injectheaderstring" class="advancedcontrols btn btn-injectcontrols-headers" onclick="InjectHeaderString()" type="button" value="Inject ABC Header Text" title="Injects text at the top or bottom of the ABC header for one or all tunes">',t+='<input id="injectstaffwidth" class="advancedcontrols btn btn-injectcontrols-headers" onclick="InjectStaffWidth()" type="button" value="Inject %%staffwidth" title="Injects a %%staffwidth annotation into one or all tunes">',t+='<input id="injectlargeprint" class="advancedcontrols btn btn-injectcontrols-headers" onclick="NotationSpacingExplorer()" type="button" value="Notation Spacing Explorer" title="Find the right spacing and scale values for your notation">',t+="</p>",gFeaturesShowTablatures&&(t+='<p style="text-align:center;margin-top:22px;">',t+='<input id="injectbctab" class="advancedcontrols btn btn-injectcontrols" onclick="DoInjectTablature_BC()" type="button" value="Inject B/C Box Tab" title="Injects B/C box tablature into the ABC">',t+='<input id="injectcdtab" class="advancedcontrols btn btn-injectcontrols" onclick="DoInjectTablature_CsD()" type="button" value="Inject C#/D Box Tab" title="Injects C#/D box tablature into the ABC">',t+='<input id="injectanglotab" class="advancedcontrols btn btn-injectcontrols" onclick="DoInjectTablature_Anglo()" type="button" value="Inject Anglo Concertina Tab" title="Injects Anglo Concertina tablature into the ABC">',t+="</p>",t+='<p style="text-align:center;margin-top:22px;">',t+='<input id="injectfiddlefingerings" class="advancedcontrols btn btn-injectcontrols" onclick="DoInjectTablature_Fiddle_Fingerings_Dialog()" type="button" value="Inject Fiddle Fingerings" title="Injects Fiddle fingerings tablature with either finger numbers or string names and finger numbers into the ABC">',t+='<input id="injectmd" class="advancedcontrols btn btn-injectcontrols" onclick="DoInjectTablature_MD()" type="button" value="Inject Dulcimer Tab" title="Injects Mountain Dulcimer tablature into the ABC">',t+='<input id="injectbambooflute" class="advancedcontrols btn btn-injectcontrols" onclick="DoInjectTablature_Bamboo_Flute()" type="button" value="Inject Bamboo Flute Tab" title="Injects Bamboo flute tablature into the ABC">',t+="</p>",t+='<p style="text-align:center;margin-top:22px;"><input id="ceoltastransform" class="advancedcontrols btn btn-injectcontrols" onclick="DoCeoltasTransformDialog()" type="button" value="Comhaltas Transform" title="Brings up a dialog where you can transform the ABC to/from Comhaltas format"><input id="injectshapenotes" class="advancedcontrols btn btn-injectcontrols" onclick="DoInjectTablature_ShapeNotes()" type="button" value="Inject Shape Note/Solf\xe8ge" title="Injects Shape Note shapes and/or Solf\xe8ge note names into the ABC"><input id="configure_box_advanced" class="btn btn-subdialog configure_box_advanced " onclick="ConfigureTablatureSettings()" type="button" value="Tablature Injection Settings" title="Configure the tablature injection settings"></p>'),gFeaturesShowExplorers&&(t+='<p style="text-align:center;margin-top:22px;"><input id="configure_instrument_explorer" class="configure_instrument_explorer button btn btn-instrumentexplorer" onclick="InstrumentExplorer();" type="button" value="MIDI Instrument Explorer" title="Brings up a tune player where you can experiment playing the current tune with different MIDI soundfonts and melody/chord instruments"><input id="configure_swing_explorer" class="btn btn-swingexplorer configure_swing_explorer " onclick="SwingExplorer()" type="button" value="Swing Explorer" title="Brings up a tune player where you can experiment with different swing factor settings"><input id="configure_grace_explorer" class="btn btn-graceexplorer configure_grace_explorer " onclick="GraceExplorer()" type="button" value="Grace Duration Explorer" title="Brings up a tune player where you can experiment with different grace note duration settings"><input id="configure_roll_explorer" class="btn btn-rollexplorer configure_roll_explorer " onclick="RollExplorer()" type="button" value="Roll Explorer" title="Brings up a tune player where you can experiment with different roll parameters"></p>'),gFeaturesShowExport&&gFeaturesShowExplorers?t+='<p style="text-align:center;margin-top:22px;"><input id="configure_reverb_explorer" class="btn btn-reverbexplorer configure_reverb_explorer " onclick="ReverbExplorer()" type="button" value="Reverb Explorer" title="Brings up a tune player where you can experiment with different reverb parameters"><input id="configure_batch_mp3_export" class="btn btn-batchmp3export configure_batch_mp3_export " onclick="ExportAll()" type="button" value="Export All Tunes" title="Exports all the tunes in the ABC text area as audio, image, MusicXML, and other formats"><input class="sortbutton btn btn-sortbutton" id="sortbutton" onclick="SortDialog()" type="button" value="Sort by Tag" title="Brings up the Sort by Specific Tag dialog"><input class="incipitsbuilder btn btn-incipitsbuilder" id="incipitsbuilder" onclick="IncipitsBuilderDialog()" type="button" value="Incipits Builder" title="Formats the ABC for notation incipits PDF export"></p>':!gFeaturesShowExport&&gFeaturesShowExplorers?t+='<p style="text-align:center;margin-top:22px;"><input id="configure_reverb_explorer" class="btn btn-reverbexplorer configure_reverb_explorer " style="margin-right:0px" onclick="ReverbExplorer()" type="button" value="Reverb Explorer" title="Brings up a tune player where you can experiment with different reverb parameters"></p>':gFeaturesShowExport&&!gFeaturesShowExplorers&&(t+='<p style="text-align:center;margin-top:22px;"><input id="configure_batch_mp3_export" class="btn btn-batchmp3export configure_batch_mp3_export " onclick="ExportAll()" type="button" value="Export All Tunes" title="Exports all the tunes in the ABC text area as audio, image, MusicXML, and other formats"><input class="sortbutton btn btn-sortbutton" id="sortbutton" onclick="SortDialog()" type="button" value="Sort by Tag" title="Brings up the Sort by Specific Tag dialog"><input class="incipitsbuilder btn btn-incipitsbuilder" id="incipitsbuilder" onclick="IncipitsBuilderDialog()" type="button" value="Incipits Builder" title="Formats the ABC for notation incipits PDF export"></p>'),gFeaturesShowCompliance&&gFeaturesShowBagpipeDrones&&(t+='<p style="text-align:center;margin-top:22px;"><input id="compliancetransform" class="advancedcontrols btn btn-injectcontrols" style="margin-right:24px;" onclick="DoComplianceTransformDialog()" type="button" value="ABC Compliance Transform" title="Brings up a dialog where you can transforms any private tool-specific directives to/from ABC 2.1 compliant tool-specific directive interchange format"><input class="transposetokey btn btn-transposetokey" id="transposetokey" onclick="TransposeToKeyDialog()" type="button" value="Transpose to Key" title="Transposes one or all the tunes to a specific key"><input id="injectbagpipedrones" class="advancedcontrols btn btn-injectcontrols" onclick="InjectBagpipeSounds()" type="button" value="Inject Bagpipe Sounds" title="Changes the melody sound to one of several bagpipe instruments and inject drones as a second voice of the tune(s)"></p>'),!gFeaturesShowCompliance&&gFeaturesShowBagpipeDrones&&(t+='<p style="text-align:center;margin-top:22px;"><input class="transposetokey btn btn-transposetokey" id="transposetokey" onclick="TransposeToKeyDialog()" type="button" value="Transpose to Key" title="Transposes one or all the tunes to a specific key"><input id="injectbagpipedrones" class="advancedcontrols btn btn-injectcontrols" onclick="InjectBagpipeSounds()" type="button" value="Inject Bagpipe Sounds" title="Changes the melody sound to one of several bagpipe instruments and inject drones as a second voice of the tune(s)"></p>'),gFeaturesShowCompliance&&!gFeaturesShowBagpipeDrones&&(t+='<p style="text-align:center;margin-top:22px;"><p style="text-align:center;margin-top:22px;"><input id="compliancetransform" class="advancedcontrols btn btn-injectcontrols" onclick="DoComplianceTransformDialog()" type="button" value="ABC Compliance Transform" title="Brings up a dialog where you can transforms any private tool-specific directives to/from ABC 2.1 compliant tool-specific directive interchange format"></p>'),t+="</div>";var n=GetRadioValue("notenodertab");setTimeout(function(){IdleMoreABCTools()},25),setTimeout(function(){IdleAdvancedControls(!0),IdleAllowShowTabNames()},50),DayPilot.Modal.alert(t,{theme:"modal_flat",top:20,width:740,scrollWithPage:AllowDialogsToScroll()}).then(function(){}),document.getElementById("configure_batch_mp3_export")&&(isMobileBrowser()?document.getElementById("configure_batch_mp3_export").style.display="none":"whistle"==n&&(document.getElementById("configure_batch_mp3_export").value="Export All Audio",document.getElementById("configure_batch_mp3_export").title="Exports all the tunes in the ABC text area as audio files"))}function ResetRollDefaultParams(){$('[name="configure_roll2_default"]').val("0.95 0.8 1.0 0.75 0.9 1.0 0.75 1.0"),$('[name="configure_roll3_default"]').val("1.45 0.6 1.0 0.75 0.9 1.0 0.75 1.0")}function readWavFile(t){return new Promise((n,o)=>{let a=new FileReader;a.onload=()=>{n(a.result)},a.onerror=o,a.readAsArrayBuffer(t)})}function idleAdvancedSettings(){gIsIOS&&document.getElementById("loadimpulsebutton").removeAttribute("accept"),document.getElementById("loadimpulsebutton").onchange=async()=>{let t=document.getElementById("loadimpulsebutton");if(0===t.files.length){var n="Please select an custom reverb impulse .wav file";n=makeCenteredPromptString(n),DayPilot.Modal.alert(n,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});return}let o=t.files[0];if(o)try{let a=await readWavFile(o);saveImpulse_DB("custom",a);var r,n="Custom reverb impulse file load successful!",l=[],s=gReverbKernels.length;for(r=0;r<s;++r){var g=gReverbKernels[r];"custom"!=g.style&&l.push(g)}gReverbKernels=l,n=makeCenteredPromptString(n),DayPilot.Modal.alert(n,{theme:"modal_flat",top:300,scrollWithPage:AllowDialogsToScroll()}),gSoundsCacheABCJS={}}catch(c){var n="There was an issue reading the custom reverb impulse file.";n=makeCenteredPromptString(n),DayPilot.Modal.alert(n,{theme:"modal_flat",top:300,scrollWithPage:AllowDialogsToScroll()});return}t.value=""}}function AdvancedSettings(){sendGoogleAnalytics("dialog","AdvancedSettings");var t=gRawHighlightColor,n=gShowDiagnostics;let o={configure_fullscreen_scaling:gFullScreenScaling,configure_highlight_color:gRawHighlightColor,configure_player_status_on_left:gPlayerStatusOnLeft,configure_large_player_controls:gLargePlayerControls,configure_autoscrollplayer:gAutoscrollPlayer,configure_trainer_touch_controls:gTrainerTouchControls,configure_metronome_volume:gMetronomeVolume,configure_mp3_bitrate:gMP3Bitrate,configure_export_delayms:gBatchExportDelayMS,configure_mp3export_delayms:gBatchMP3ExportDelayMS,configure_roll2_default:gRoll2DefaultParams,configure_roll3_default:gRoll3DefaultParams,configure_TuneDatabaseRetryTimeMS:gTuneDatabaseRetryTimeMS,configure_TuneDatabaseRetryCount:gTuneDatabaseRetryCount,configure_DisableRendering:gDisableNotationRendering,configure_disable_selected_play:gDisableSelectedPlay,configure_show_diagnostics:gShowDiagnostics,configure_reverb:gReverbString,configure_tinyurl:gTinyURLAPIKeyOverride,configure_confirm_clear:gConfirmClear,configure_show_render_progress:gShowABCJSRenderProgress};var a=[{html:'<p style="text-align:center;font-size:16pt;font-family:helvetica;margin-bottom:24px;margin-left:15px;">Advanced Settings&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/app/userguide.html#advanced_settings" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p style="font-size:12pt;line-height:12px;font-family:helvetica;"><strong>Only change these values if you know what you are doing!</strong></p>'},{name:"          Always confirm before deletion when clicking Clear",id:"configure_confirm_clear",type:"checkbox",cssClass:"advanced_settings2_form_text_checkbox"},{name:"          Show ABC syntax validation panel",id:"configure_show_diagnostics",type:"checkbox",cssClass:"advanced_settings2_form_text_checkbox"},{name:"          Show tune rendering progress in Javascript console",id:"configure_show_render_progress",type:"checkbox",cssClass:"advanced_settings2_form_text_checkbox"},{name:"    Disable abcjs notation rendering",id:"configure_DisableRendering",type:"checkbox",cssClass:"advanced_settings2_form_text_checkbox"},{name:"    Autoscroll player when playing",id:"configure_autoscrollplayer",type:"checkbox",cssClass:"advanced_settings2_form_text_checkbox"},{name:"    Player/Tune Trainer always plays full tune even if there is a selection region",id:"configure_disable_selected_play",type:"checkbox",cssClass:"advanced_settings2_form_text_checkbox"},{name:"    Player uses large controls (easier to touch on phone/tablet)",id:"configure_large_player_controls",type:"checkbox",cssClass:"advanced_settings2_form_text_checkbox"},{name:"    Player tunebook navigation controls on left side",id:"configure_player_status_on_left",type:"checkbox",cssClass:"advanced_settings2_form_text_checkbox"},{name:"    Player/Tune Trainer uses label L/R side click to decrement/increment values",id:"configure_trainer_touch_controls",type:"checkbox",cssClass:"advanced_settings2_form_text_checkbox"},{name:"Full screen tune display width scaling (percentage) (default is 50):",id:"configure_fullscreen_scaling",type:"number",cssClass:"advanced_settings2_form_text"},];isDesktopBrowser()&&(a=a.concat([{name:"Highlighting color (HTML format) (default is #F00000):",id:"configure_highlight_color",type:"text",cssClass:"advanced_settings2_form_text"}])),a=a.concat([{name:"Default %reverb annotation (blank = no reverb):",id:"configure_reverb",type:"text",cssClass:"advanced_settings2_reverb_text"},{name:"Metronome volume (default is 48):",id:"configure_metronome_volume",type:"text",cssClass:"advanced_settings2_reverb_text"},{name:"MP3 audio export bitrate (kbit/sec) (default is 224):",id:"configure_mp3_bitrate",type:"number",cssClass:"advanced_settings2_form_text"},]),isDesktopBrowser()&&(a=a.concat([{name:"Image Batch Export Delay in milliseconds (default is 200):",id:"configure_export_delayms",type:"text",cssClass:"advanced_settings2_form_text"},{name:"MP3 Batch Export Delay in milliseconds (default is 250):",id:"configure_mp3export_delayms",type:"text",cssClass:"advanced_settings2_form_text"},])),a=a.concat([{name:"Tune search fetch retry delay in milliseconds (default is 3000):",id:"configure_TuneDatabaseRetryTimeMS",type:"text",cssClass:"advanced_settings2_form_text"},{name:"Tune search fetch retry maximum count (default is 10):",id:"configure_TuneDatabaseRetryCount",type:"text",cssClass:"advanced_settings2_form_text"},{name:"Default %roll_2_params:",id:"configure_roll2_default",type:"text",cssClass:"advanced_settings2_roll_text"},{name:"Default %roll_3_params:",id:"configure_roll3_default",type:"text",cssClass:"advanced_settings2_roll_text"},{name:"Private TinyURL API Token:",id:"configure_tinyurl",type:"text",cssClass:"advanced_settings2_tinyurl_text"},{html:'<p style="text-align:center;margin-top:18px;margin-bottom:6px"><input id="reset_roll_parameters" class="btn btn-subdialog reset_roll_parameters" onclick="ResetRollDefaultParams()" type="button" value="Reset Roll Parameter Strings to Defaults" title="Resets the roll parameter strings to known good default values"><label class="loadimpulsebutton btn btn-subdialog " for="loadimpulsebutton" title="Load a custom reverb convolution impulse .wav file">Load Custom Reverb Impulse <input type="file" id="loadimpulsebutton"  accept=".wav,.WAV" hidden/></label><input id="resetsettings" class="btn btn-resetsettings resetsettings" onclick="ResetSettingsDialog()" type="button" value="Reset Settings" title="Opens a dialog where you can reset all tool settings to the default, clear the instrument notes, reverb settings, and tune search engine collection databases, and/or force an update of the tool to the latest code"></p><p style="font-size:10pt;font-family:helvetica;color:grey;position:absolute;left:20px;bottom:22px;margin:0px;">Version: '+gVersionNumber+"</p>"},]),setTimeout(function(){idleAdvancedSettings()},25),DayPilot.Modal.form(a,o,{theme:"modal_flat",top:10,width:800,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(o){if(!o.canceled){if(gConfirmClear=o.result.configure_confirm_clear,gShowDiagnostics=o.result.configure_show_diagnostics,updateDiagnostics(),gDisableNotationRendering=o.result.configure_DisableRendering){sendGoogleAnalytics("action","RenderDisable"),gTheNotation.innerHTML="";var a=document.getElementById("rawmodebutton");gRawLastIndex=-1,a.value="Highlighting Off",a.classList.add("btn-rawmode-off"),a.classList.remove("btn-rawmode-on"),gTheABC.style.backgroundColor="white",gRawMode=!1}gShowABCJSRenderProgress=o.result.configure_show_render_progress,gFullScreenScaling=(gFullScreenScaling=o.result.configure_fullscreen_scaling).replace("%",""),(gFullScreenScaling=isNaN(parseInt(gFullScreenScaling))?50:parseInt(gFullScreenScaling))<25&&(gFullScreenScaling=25),gFullScreenScaling>100&&(gFullScreenScaling=100),gPlayerStatusOnLeft=o.result.configure_player_status_on_left,gLargePlayerControls=o.result.configure_large_player_controls,gAutoscrollPlayer=o.result.configure_autoscrollplayer,gTrainerTouchControls=o.result.configure_trainer_touch_controls,gDisableSelectedPlay=o.result.configure_disable_selected_play,gReverbString=o.result.configure_reverb;var r=o.result.configure_metronome_volume;r=parseInt(r),!isNaN(r)&&r>=0&&r<128&&(gMetronomeVolume=r);var l=parseInt(o.result.configure_mp3_bitrate);!isNaN(l)&&((gMP3Bitrate=l)<96&&(gMP3Bitrate=96),gMP3Bitrate>384&&(gMP3Bitrate=384));var s=o.result.configure_TuneDatabaseRetryTimeMS;s=parseInt(s),!isNaN(s)&&s>0&&s<=1e4&&(gTuneDatabaseRetryTimeMS=s);var g=o.result.configure_TuneDatabaseRetryCount;g=parseInt(g),!isNaN(g)&&g>0&&s<=100&&(gTuneDatabaseRetryCount=g);var c=o.result.configure_roll2_default;c=c.trim();var d=o.result.configure_roll3_default;d=d.trim();var u=validate_roll_2_params(c,!1),p=validate_roll_3_params(d,!1);u&&p?(u=validate_roll_2_params(c,!0),p=validate_roll_3_params(d,!0),gRoll2DefaultParams=c,gRoll3DefaultParams=d):RollParameterIssueAlert(function(){setTimeout(function(){AdvancedSettings()},250)});var m=o.result.configure_tinyurl;m&&(m=m.trim()),m&&""!=m?(gDoTinyURLAPIKeyOverride||sendGoogleAnalytics("sharing","custom_tinyurl_token_entered"),gTinyURLAPIKeyOverride=m,gDoTinyURLAPIKeyOverride=!0):(gTinyURLAPIKeyOverride="",gDoTinyURLAPIKeyOverride=!1),IdleAllowShowTabNames(),isDesktopBrowser()&&(gRawHighlightColor=o.result.configure_highlight_color,r=parseInt(r=o.result.configure_export_delayms),!isNaN(r)&&r>=0&&(gBatchExportDelayMS=r),r=parseInt(r=o.result.configure_mp3export_delayms),!isNaN(r)&&r>=0&&(gBatchMP3ExportDelayMS=r),gRawMode&&gRawHighlightColor!=t&&RenderAsync(!0,null)),n!=gShowDiagnostics&&HandleWindowResize(),SaveConfigurationSettings()}})}function ConfigurePlayerSettings(t){sendGoogleAnalytics("dialog","ConfigurePlayerSettings");for(var n,o,a,r=[],l=0;l<=MIDI_PATCH_COUNT;++l)r.push({name:"  "+generalMIDISoundNames[l],id:l});var s=gDefaultSoundFont,g=gTheMelodyProgram;n="mute"==g?0:parseInt(g)+1;var c=gTheChordProgram;o="mute"==c?0:parseInt(c)+1;var d=gTheBassProgram;a="mute"==d?0:parseInt(d)+1;var u=gTheBassVolume,p=gTheChordVolume,m=gOverridePlayMIDIParams;let h={configure_soundfont:gDefaultSoundFont,configure_melody_program:n,configure_bass_program:a,configure_chord_program:o,configure_bass_volume:u,configure_chord_volume:p,configure_override_play_midi_params:m};DayPilot.Modal.form([{html:'<p style="text-align:center;font-size:16pt;font-family:helvetica;margin-left:15px;">Player Instrument Settings&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/app/userguide.html#default_player_settings" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{html:'<p class="configure_settings_form_text_fs">The following values are used as the instrument and volume defaults if not already specified in a tune:</p>'},{name:"Default abcjs soundfont:",id:"configure_soundfont",type:"select",options:[{name:"  Fluid",id:"https://paulrosen.github.io/midi-js-soundfonts/FluidR3_GM/"},{name:"  Musyng Kite",id:"https://paulrosen.github.io/midi-js-soundfonts/MusyngKite/"},{name:"  FatBoy",id:"https://michaeleskin.com/abctools/soundfonts/fatboy_4/"},{name:"  Canvas",id:"https://michaeleskin.com/abctools/soundfonts/canvas/"},{name:"  MScore",id:"https://michaeleskin.com/abctools/soundfonts/mscore_2/"},{name:"  Arachno",id:"https://michaeleskin.com/abctools/soundfonts/arachno_3/"},{name:"  FluidHQ",id:"https://michaeleskin.com/abctools/soundfonts/fluidhq_1/"},],cssClass:"configure_settings_select_fs"},{name:"Default Melody MIDI program:",id:"configure_melody_program",type:"select",options:r,cssClass:"configure_midi_program_form_select"},{name:"Default Bass MIDI program:",id:"configure_bass_program",type:"select",options:r,cssClass:"configure_midi_program_form_select"},{name:"Default Chords MIDI program:",id:"configure_chord_program",type:"select",options:r,cssClass:"configure_midi_program_form_select"},{name:"Default Bass MIDI volume (0-127):",id:"configure_bass_volume",type:"number",cssClass:"configure_settings_form_text_fs"},{name:"Default Chords MIDI volume (0-127):",id:"configure_chord_volume",type:"number",cssClass:"configure_settings_form_text_fs"},{html:'<p class="configure_settings_form_text_fs">Check the following box if you want the above values to override any instruments or volumes already specified in a tune when playing.</p>'},{name:"            Override all MIDI programs and volumes in the ABC with the defaults when playing tunes",id:"configure_override_play_midi_params",type:"checkbox",cssClass:"configure_settings_form_text_checkbox_fs"},],h,{theme:"modal_flat",top:100,width:790,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(n){if(n.canceled)FocusAfterOperation(),t&&t(!1);else{if(s!=(gDefaultSoundFont=n.result.configure_soundfont)&&(gTheActiveSoundFont=gDefaultSoundFont,gSoundsCacheABCJS={}),gTheMelodyProgram=n.result.configure_melody_program,gTheBassProgram=n.result.configure_bass_program,gTheChordProgram=n.result.configure_chord_program,0==gTheMelodyProgram?gTheMelodyProgram="mute":gTheMelodyProgram--,"mute"!=gTheMelodyProgram&&(isNaN(parseInt(gTheMelodyProgram))&&(gTheMelodyProgram=0),gTheMelodyProgram<0&&(gTheMelodyProgram=0),gTheMelodyProgram>MIDI_PATCH_COUNT&&(gTheMelodyProgram=MIDI_PATCH_COUNT)),0==gTheBassProgram?gTheBassProgram="mute":gTheBassProgram--,"mute"!=gTheBassProgram&&(isNaN(parseInt(gTheBassProgram))&&(gTheBassProgram=0),gTheBassProgram<0&&(gTheBassProgram=0),gTheBassProgram>MIDI_PATCH_COUNT&&(gTheBassProgram=MIDI_PATCH_COUNT)),0==gTheChordProgram?gTheChordProgram="mute":gTheChordProgram--,"mute"!=gTheChordProgram&&(isNaN(parseInt(gTheChordProgram))&&(gTheChordProgram=0),gTheChordProgram<0&&(gTheChordProgram=0),gTheChordProgram>MIDI_PATCH_COUNT&&(gTheChordProgram=MIDI_PATCH_COUNT)),gUseCustomGMSounds&&(gAlwaysInjectPrograms||gOverridePlayMIDIParams)&&("15"==gTheMelodyProgram||"15"==gTheBassProgram||"15"==gTheChordProgram)){var o='<p style="text-align:center;font-size:16pt;font-family:helvetica">Special Note on the Dulcimer (15) Instrument</p>';o+='<p style="font-size:12pt;line-height:18pt;font-family:helvetica">Selecting the Dulcimer (15) program for either the melody, bass, or chords automatically sets all note release decay times to 4 seconds to allow the notes to ring.</p>',o+='<p style="font-size:12pt;line-height:18pt;font-family:helvetica">This can be useful for tunes using solo melody instruments with long release times like Orchestral Harp (46) or Koto (107).</p>',o+='<p style="font-size:12pt;line-height:18pt;font-family:helvetica">For those instruments played solo, set the melody instrument program as desired and the chord instrument program to Dulcimer (15).</p>',o+='<p style="font-size:12pt;line-height:18pt;font-family:helvetica">In this case, you may not want to include any chords in the ABC, as they will be played using the Dulcimer (15) instrument.</p>',DayPilot.Modal.alert(o,{theme:"modal_flat",top:100,width:600,scrollWithPage:AllowDialogsToScroll()}).then(function(){FocusAfterOperation()})}gTheBassVolume=n.result.configure_bass_volume,gTheChordVolume=n.result.configure_chord_volume,isNaN(parseInt(gTheBassVolume))&&(gTheBassVolume=0),gTheBassVolume<0&&(gTheBassVolume=0),gTheBassVolume>127&&(gTheBassVolume=127),isNaN(parseInt(gTheChordVolume))&&(gTheChordVolume=0),gTheChordVolume<0&&(gTheChordVolume=0),gTheChordVolume>127&&(gTheChordVolume=127),gOverridePlayMIDIParams=n.result.configure_override_play_midi_params,SaveConfigurationSettings(),t&&t(!0)}})}function ConfigureToolSettings(){sendGoogleAnalytics("dialog","ConfigureToolSettings");var t=gSaveLastAutoSnapShot,n=gStaffSpacing-STAFFSPACEOFFSET,o=gForceLeftJustifyTitles,a=gShowTabNames,r=gCapo,l=gUseCustomGMSounds,s=gAllowMIDIInput,g=gFeaturesShowTabButtons,c=gAlwaysInjectPrograms,d=gAlwaysInjectVolumes,u=gUseComhaltasABC;let p={configure_save_exit_snapshot:gSaveLastAutoSnapShot,configure_editor_fontsize:gABCEditorFontsize,configure_staff_spacing:n,configure_left_justify_titles:gForceLeftJustifyTitles,configure_capo:gCapo,configure_show_tab_names:gShowTabNames,configure_use_custom_gm_sounds:gUseCustomGMSounds,configure_inject_programs:c,configure_inject_volumes:d,configure_auto_swing_hornpipes:gAutoSwingHornpipes,configure_auto_swing_factor:gAutoSwingFactor,configure_allow_midi_input:gAllowMIDIInput,configure_midi_chromatic:gMIDIChromatic,configure_show_tab_buttons:gFeaturesShowTabButtons,configure_show_dgdae:gShowDGDAETab,configure_show_cgda:gShowCGDATab,configure_comhaltas:gUseComhaltasABC,configure_RollUseRollForIrishRoll:gRollUseRollForIrishRoll,configure_allow_offline_instruments:gAllowOfflineInstruments};var m=[{html:'<p style="text-align:center;font-size:16pt;font-family:helvetica;margin-left:15px;">ABC Transcription Tools Settings&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/app/userguide.html#settings_dialog" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px" class="dialogcornerbutton">?</a></span></p>'},{name:"          Show instrument tablature button bar below ABC editor",id:"configure_show_tab_buttons",type:"checkbox",cssClass:"configure_settings_form_text_checkbox"},];isDesktopBrowser()&&(m.push({name:"   Save an Auto-Snapshot on browser tab close or reload (Restore it from the Add dialog)",id:"configure_save_exit_snapshot",type:"checkbox",cssClass:"configure_settings_form_text_checkbox"}),m.push({name:"ABC Editor Font Size (default is 13):",id:"configure_editor_fontsize",type:"number",cssClass:"configure_settings_form_text"})),m=m.concat([{name:"Space between the staves (default is 10, minimum is -40):",id:"configure_staff_spacing",type:"number",cssClass:"configure_settings_form_text"},{name:"          Left-justify all titles and subtitles",id:"configure_left_justify_titles",type:"checkbox",cssClass:"configure_settings_form_text_checkbox"},{name:"    Note name tablature uses Comhaltas style ABC (D' E' F' instead of d e f for octave notes)",id:"configure_comhaltas",type:"checkbox",cssClass:"configure_settings_form_text_checkbox"},{name:"          Show CGDA as a 4-string tab option (default is GDAD)",id:"configure_show_cgda",type:"checkbox",cssClass:"configure_settings_form_text_checkbox"},{name:"          Show DGDAE as a 5-string tab option (default is CGDAE)",id:"configure_show_dgdae",type:"checkbox",cssClass:"configure_settings_form_text_checkbox"},{name:"Stringed instrument capo fret position:",id:"configure_capo",type:"number",cssClass:"configure_settings_form_text"},{name:"    Show stringed instrument names on tablature (single-voice tunes only, not shown in the Player)",id:"configure_show_tab_names",type:"checkbox",cssClass:"configure_settings_form_text_checkbox"},{html:'<p style="text-align:center;"><input id="abcplayer_settingsbutton" style="margin-left:0px" class="abcplayer_settingsbutton btn btn-configuresettingsfromhelp" onclick="ConfigurePlayerSettings(null);" type="button" value="Select Default Player Instruments and Volumes" title="Brings up the Player Instrument Settings dialog where you can select the default abcjs soundfont, MIDI instruments, and MIDI volumes to use when playing tunes"><input id="managedatabases" class="btn btn-managedatabases managedatabases" onclick="ManageDatabasesDialog()" type="button" value="Manage Notes, Reverb, and Tune Search Databases" title="Opens a dialog where you can manage the instrument notes, reverb settings, and tune search engine collection databases"></p>'},{name:"    Allow instrument notes and reverb settings database to be used offline",id:"configure_allow_offline_instruments",type:"checkbox",cssClass:"configure_settings_form_text_checkbox"},{name:"    Use custom sounds for Dulcimer, Accordion, Flute, Whistle, Banjo, Bagpipe, Fiddle, and Bodhran",id:"configure_use_custom_gm_sounds",type:"checkbox",cssClass:"configure_settings_form_text_checkbox"},{name:"            Use Default Melody and Bass/Chord programs when playing tunes",id:"configure_inject_programs",type:"checkbox",cssClass:"configure_settings_form_text_checkbox"},{name:"            Use Default Bass/Chord volumes when playing tunes",id:"configure_inject_volumes",type:"checkbox",cssClass:"configure_settings_form_text_checkbox"},{name:"            Automatically swing Hornpipes when playing (enabled if R:Hornpipe is found in the tune)",id:"configure_auto_swing_hornpipes",type:"checkbox",cssClass:"configure_settings_form_text_checkbox"},{name:"Auto-swing scale factor (range is -0.9 to 0.9, default for Hornpipes is 0.25):",id:"configure_auto_swing_factor",type:"number",cssClass:"configure_settings_form_text"},{name:"    Rolls indicated in the ABC with ~ use the custom abcjs roll playback solution",id:"configure_RollUseRollForIrishRoll",type:"checkbox",cssClass:"configure_settings_form_text_checkbox"},]),browserSupportsMIDI()&&(m.push({name:"    Allow MIDI input for ABC text entry",id:"configure_allow_midi_input",type:"checkbox",cssClass:"configure_settings_form_text_checkbox"}),m.push({name:"    MIDI input is key and mode aware (if unchecked, enters note names with no accidentals)",id:"configure_midi_chromatic",type:"checkbox",cssClass:"configure_settings_form_text_checkbox"})),m.push({html:'<p style="text-align:center;"><input id="configure_fonts" class="btn btn-subdialog configure_fonts" onclick="ConfigureFonts()" type="button" value="Font Settings" title="Configure the fonts used for rendering the ABC"><input id="configure_box" class="btn btn-subdialog configure_box" onclick="ConfigureTablatureSettings()" type="button" value="Tablature Injection Settings" title="Configure the tablature injection settings"><input id="configure_musicxml_import" class="btn btn-subdialog configure_musicxml_import" onclick="ConfigureMusicXMLImport()" type="button" value="MusicXML/MIDI Settings" title="Configure MusicXML/MIDI import parameters"><input id="configure_developer_settings" class="btn btn-subdialog configure_developer_settings" onclick="AdvancedSettings()" type="button" value="Advanced Settings" title="Configure low level tool settings"></p>'}),DayPilot.Modal.form(m,p,{theme:"modal_flat",top:10,width:790,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(c){if(c.canceled)FocusAfterOperation();else{isDesktopBrowser()?(gSaveLastAutoSnapShot=c.result.configure_save_exit_snapshot)?t!=gSaveLastAutoSnapShot&&AddTabCloseListener():(gLocalStorageAvailable&&(localStorage.LastAutoSnapShot=""),t!=gSaveLastAutoSnapShot&&RemoveTabCloseListener()):gSaveLastAutoSnapShot=!1,gAllowOfflineInstruments=c.result.configure_allow_offline_instruments,gFeaturesShowTabButtons=c.result.configure_show_tab_buttons,!0==g&&!1==gFeaturesShowTabButtons&&sendGoogleAnalytics("action","HidingTabButtonBar"),!1==g&&!0==gFeaturesShowTabButtons&&sendGoogleAnalytics("action","ShowingTabButtonBar");var d=c.result.configure_staff_spacing;d=parseInt(d),isNaN(d)||void 0==d?d=gStaffSpacing-STAFFSPACEOFFSET:d<-1*STAFFSPACEOFFSET&&(d=-1*STAFFSPACEOFFSET),isNaN(d)||d==n||(gStaffSpacing=d+STAFFSPACEOFFSET),gForceLeftJustifyTitles=c.result.configure_left_justify_titles;var p=c.result.configure_capo;if(!isNaN(parseInt(p))){var m=parseInt(p);m>=0&&m<=12&&(gCapo=parseInt(p))}if(gShowTabNames=c.result.configure_show_tab_names,(gUseCustomGMSounds=c.result.configure_use_custom_gm_sounds)!=l&&(gSoundsCacheABCJS={}),gAlwaysInjectPrograms=c.result.configure_inject_programs,gUseCustomGMSounds&&(gAlwaysInjectPrograms||gOverridePlayMIDIParams)&&("15"==gTheMelodyProgram||"15"==gTheBassProgram||"15"==gTheChordProgram)){var h='<p style="text-align:center;font-size:16pt;font-family:helvetica">Special Note on the Dulcimer (15) Instrument</p>';h+='<p style="font-size:12pt;line-height:18pt;font-family:helvetica">Selecting the Dulcimer (15) program for either the melody, bass, or chords automatically sets all note release decay times to 4 seconds to allow the notes to ring.</p>',h+='<p style="font-size:12pt;line-height:18pt;font-family:helvetica">This can be useful for tunes using solo melody instruments with long release times like Orchestral Harp (46) or Koto (107).</p>',h+='<p style="font-size:12pt;line-height:18pt;font-family:helvetica">For those instruments played solo, set the melody instrument program as desired and the chord instrument program to Dulcimer (15).</p>',h+='<p style="font-size:12pt;line-height:18pt;font-family:helvetica">In this case, you may not want to include any chords in the ABC, as they will be played using the Dulcimer (15) instrument.</p>',DayPilot.Modal.alert(h,{theme:"modal_flat",top:100,width:600,scrollWithPage:AllowDialogsToScroll()}).then(function(){FocusAfterOperation()})}gAlwaysInjectVolumes=c.result.configure_inject_volumes,gAutoSwingHornpipes=c.result.configure_auto_swing_hornpipes;var f=c.result.configure_auto_swing_factor;if(!isNaN(parseFloat(f))){var A=parseFloat(f);A>=-.9&&A<=.9&&(gAutoSwingFactor=A)}browserSupportsMIDI()&&(gAllowMIDIInput=c.result.configure_allow_midi_input,gMIDIChromatic=c.result.configure_midi_chromatic,s!=gAllowMIDIInput&&gAllowMIDIInput&&(sendGoogleAnalytics("action","enable_MIDI"),initMIDI()));var b=gShowCGDATab;(gShowCGDATab=c.result.configure_show_cgda)?setupCGDA():setupGDAD();var T=gShowDGDAETab;(gShowDGDAETab=c.result.configure_show_dgdae)?setupDGDAE():setupCGDAE(),gUseComhaltasABC=c.result.configure_comhaltas,gRollUseRollForIrishRoll=c.result.configure_RollUseRollForIrishRoll;var y=GetRadioValue("notenodertab"),I=gIsFromShare&&("gdad"==y||"cgda"==y||"dgdae"==y||"cgdae"==y);if(IdleAllowShowTabNames(),isDesktopBrowser()){var v=c.result.configure_editor_fontsize;v=parseInt(v),!isNaN(v)&&v>=6&&v<=36&&(gABCEditorFontsize=v,updateABCEditorFont(),HandleWindowResize())}gLocalStorageAvailable&&(localStorage.abcStaffSpacing=d),SaveConfigurationSettings(),ShowHideTabButtons();var C=GetRadioValue("notenodertab");(d!=n||a!=gShowTabNames||gAllowShowTabNames&&gCapo!=r||gForceLeftJustifyTitles!=o||b!=gShowCGDATab||T!=gShowDGDAETab||I||"notenames"==C&&gUseComhaltasABC!=u)&&RenderAsync(!0,null,function(){FocusAfterOperation()})}})}function isXML(t){return -1!=t.slice(0,100).indexOf("<?xml")}function isBWWFile(t){var n=t.slice(0,100);return 0==(n=n.trim()).indexOf("Bagpipe Reader")||0==n.indexOf("Bagpipe Music Writer")}function InjectQTag(t,n){for(var o=t.split("\n"),a=o.length,r=0;r<a;++r)if(0==o[r].trim().indexOf("Q:"))return t;for(var l="",s=!1,r=0;r<a;++r)if(0==(l=o[r]).trim().indexOf("M:")){s=!0,r<a-1&&(l=o[r+1]);break}if(s){var g=t.indexOf(l),c=t.substring(0,g),d=t.substring(g);t=c+"Q:"+n+"\n"+d}else{for(var u="",p=!1,r=0;r<a;++r)if(0==(u=o[r]).trim().indexOf("K:")){p=!0;break}if(p){var m=t.indexOf(u),c=t.substring(0,m),d=t.substring(m);t=c+"Q:"+n+"\n"+d}}return t}function doTitleCaps(t){var n="(a|an|and|as|at|but|by|en|for|if|in|of|on|or|the|to|v[.]?|via|vs[.]?)",o="([!\"#$%&'()*+,./:;<=>?@[\\\\\\]^_`{|}~-]*)";function a(t){return t.toLowerCase()}function r(t){return t.substr(0,1).toUpperCase()+t.substr(1)}return function t(l){for(var s=[],g=/[:.;?!] |(?: |^)["]/g,c=0;;){var d=g.exec(l);if(s.push(l.substring(c,d?d.index:l.length).replace(/\b([A-Za-z][a-z.']*)\b/g,function(t){return/[A-Za-z]\.[A-Za-z]/.test(t)?t:r(t)}).replace(RegExp("\\b"+n+"\\b","ig"),a).replace(RegExp("^"+o+n+"\\b","ig"),function(t,n,o){return n+r(o)}).replace(RegExp("\\b"+n+o+"$","ig"),r)),c=g.lastIndex,d)s.push(d[0]);else break}return s.join("").replace(/ V(s?)\. /ig," v$1. ").replace(/(['])S\b/ig,"$1s").replace(/\b(AT&T|Q&A)\b/ig,function(t){return t.toUpperCase()})}(t)}function isTagLine(t){for(let n of["X:","T:","M:","K:","L:","Q:","W:","Z:","R:","C:","A:","O:","P:","N:","G:","H:","B:","D:","F:","S:","I:","V:","%"])if(t.startsWith(n))return!0;return!1}function splitTextAtLineBreak(t,n){let o=t.split(n),a=[];for(let r of o){let l=r.trim();l&&a.push(l)}return a}function replaceLineBreaks(t,n){let o=t.split("\n"),a=[],r="";var l=!1;for(let s of o)if(!/^(X:|T:|M:|K:|L:|Q:|W:|Z:|R:|C:|A:|O:|P:|N:|G:|H:|B:|D:|F:|S:|I:|V:|w:|%)/.test(s)&&-1!=s.indexOf(n)){l=!0;break}if(!l)return t;for(let g of o)/^(X:|T:|M:|K:|L:|Q:|W:|Z:|R:|C:|A:|O:|P:|N:|G:|H:|B:|D:|F:|S:|I:|V:|w:|%)/.test(g)?(r&&(a.push(r),r=""),a.push(g)):r+=(r?" ":"")+g;r&&a.push(r);var c=[];return a.map(t=>{if(isTagLine(t))return c.push(t);for(var o=splitTextAtLineBreak(t,n),a=o.length,r=0;r<a;++r){var l=o[r];""!=(l=l.trim())&&c.push(l)}}),c.join("\n")}function removeLinesStartingWithILinebreak(t){let n=t.split("\n");return(n=n.filter(t=>!t.startsWith("I:linebreak"))).join("\n")}function importMusicXML(t,n){var o=$.parseXML(t),a=!1;0==gMusicXMLImportOptions.x&&1==gMusicXMLImportOptions.addstavenum&&(a=!0,gMusicXMLImportOptions.addstavenum=0);var r=vertaal(o,gMusicXMLImportOptions);a&&(gMusicXMLImportOptions.addstavenum=1);var l=r[0];l=(l=(l=(l=(l=(l=(l=l.replaceAll("[K:treble]","")).replaceAll("[K:alto]","")).replaceAll("[K:alto1]","")).replaceAll("[K:alto2]","")).replaceAll("[K:tenor]","")).replaceAll("[K:bass]","")).replaceAll("[K:bass3]",""),1==gMusicXMLImportOptions.addq&&(l=InjectQTag(l,gMusicXMLImportOptions.q)),-1!=l.indexOf("T:Title")&&(n=doTitleCaps(n=(n=(n=(n=(n=(n=(n=(n=(n=n.replace(".mxl","")).replace(".xml","")).replace(".musicxml","")).replace(".MXL","")).replace(".XML","")).replace(".MUSICXML","")).replaceAll("_"," ")).replaceAll("-"," ")).replaceAll("  "," ")),l=l.replace("T:Title","T:"+n));var s=!1,g=l.match(/^I:linebreak.*$/m),c="";return g&&g.length>0&&(c=(c=g[0].replace("I:linebreak","")).trim()).length>0&&("!"==c||"$"==c)&&(s=!0,c=c[0]),s&&(l=replaceLineBreaks(l,c)),l=removeLinesStartingWithILinebreak(l)}function DoReadCommon(t,n){if(n){if(CountTunes()>0){var o=gTheABC.value.length;"\n"!=gTheABC.value.substring(o-1)&&(gTheABC.value+="\n"),gTheABC.value+="\n"}gTheABC.value+=t,gIsDirty=!0,CleanSmartQuotes()}else gTheABC.value=t,CleanSmartQuotes();FocusABC(),setTimeout(function(){RestoreDefaults(),window.scrollTo({top:0}),gABCFromFile=!0,n||(gIsFromShare=!1,RestoreSavedStaffSpacing(),gIsDirty=!1),RenderAsync(!0,null,function(){if(UpdateNotationTopPosition(),n){var t=CountTunes(),o=getTuneByIndex(t-1),a=gTheABC.value.length-o.length;if(!gIsMaximized){if(ScrollABCTextIntoView(gTheABC,a,a,10),isMobileBrowser())return;gTheABC.blur(),gTheABC.focus()}MakeTuneVisible(!0)}})},100)}function DoFileRead(t,n){var o=null;if(ensureABCFile(t.name)){var a=-1!=t.name.toLowerCase().indexOf(".mid"),r=-1!=t.name.toLowerCase().indexOf(".mxl");if(n||(gTheABC.value="",Render(!0,null)),document.getElementById("abc-selected").innerText="Loading: "+t.name,gDisplayedName=t.name,r){new JSZip().loadAsync(t).then(function(t){t.files["META-INF/container.xml"].async("string").then(function(o){var a=$.parseXML(o).getElementsByTagName("rootfile")[0].getAttribute("full-path");t.files[a].async("string").then(function(t){if(isXML(t))sendGoogleAnalytics("action","DoFileRead_MXL"),t=importMusicXML(t,gDisplayedName);else{var o="This is not a valid MXL file.";o=makeCenteredPromptString(o),DayPilot.Modal.alert(o,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});return}DoReadCommon(t,n)})},function(){var t="This is not a valid MXL file.";t=makeCenteredPromptString(t),DayPilot.Modal.alert(t,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})})},function(){var t="This is not a valid MXL file.";t=makeCenteredPromptString(t),DayPilot.Modal.alert(t,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})});return}if(a){if(!navigator.onLine){var l="MIDI import not available while offline.";l=makeCenteredPromptString(l),DayPilot.Modal.alert(l,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});return}if(gMIDIImportWarned)g();else{var s='<p style="text-align:center;font-size:16pt;font-family:helvetica">First Time Use Notes on MIDI Import</p>';s+='<p style="font-size:12pt;line-height:18pt;font-family:helvetica">MIDI Import is an experimental feature that depends on an external service.</p>',s+='<p style="font-size:12pt;line-height:18pt;font-family:helvetica">It may sometimes produce complete garbage, odd results, fail, or even crash or lock up the tool.</p>',s+='<p style="font-size:12pt;line-height:18pt;font-family:helvetica">If the tool crashes during notation rendering after MIDI import is complete, reload the page to restart.</p>',s+='<p style="font-size:12pt;line-height:18pt;font-family:helvetica">Imported notes are quantized to sixteenth note durations.</p>',s+='<p style="font-size:12pt;line-height:18pt;font-family:helvetica">MIDI Import is limited to a maximum file length of 30 KBytes.</p>',gMIDIImportWarned=!0,gLocalStorageAvailable&&(localStorage.MIDIImportWarned=!0),DayPilot.Modal.alert(s,{theme:"modal_flat",top:100,scrollWithPage:AllowDialogsToScroll()}).then(function(t){g()})}function g(){var a="Importing "+t.name;a=makeCenteredPromptString(a),DayPilot.Modal.alert(a,{theme:"modal_flat",top:100,scrollWithPage:AllowDialogsToScroll()});for(var r=document.getElementsByClassName("modal_flat_ok"),l=null,s=0;s<r.length;++s)if("OK"==(l=r[s]).innerText){o=l;break}document.getElementById("loading-bar-spinner").style.display="block";let g=new FileReader;g.onload=function(a){let r=a.target.result;if(r.byteLength>40960){document.getElementById("loading-bar-spinner").style.display="none";try{o.click()}catch(l){}var s,g,c,d="MIDI file import is limited to a maximum file size of 40 KBytes.";d=makeCenteredPromptString(d),DayPilot.Modal.alert(d,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});return}sendGoogleAnalytics("action","DoFileRead_MIDI"),s=r,g=new Blob([s]),(c=new FormData).append("array_buffer",g,"midi.mid"),fetch("https://seisiuneer.pythonanywhere.com/midi2xml",{method:"POST",body:c}).then(t=>{if(!t.ok&&!t.ok)throw Error("Failed to upload MIDI file");return t.text()}).then(a=>{document.getElementById("loading-bar-spinner").style.display="none";try{o.click()}catch(r){}var l,s=t.name.replace(".midi","");s=doTitleCaps(s=(s=(s=(s=(s=(s=s.replace(".MIDI","")).replace(".mid","")).replace(".MID","")).replaceAll("_"," ")).replaceAll("-"," ")).replaceAll("  "," ")),a=(a=a.replaceAll("Music21 Fragment",s)).replaceAll("Music21",""),DoReadCommon(importMusicXML(a,gDisplayedName),n)}).catch(t=>{document.getElementById("loading-bar-spinner").style.display="none";try{o.click()}catch(n){}var a="There was an issue converting the MIDI file.";a=makeCenteredPromptString(a),DayPilot.Modal.alert(a,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})})},g.onerror=function(){document.getElementById("loading-bar-spinner").style.display="none";try{o.click()}catch(t){}var n="There was an issue converting the MIDI file.";n=makeCenteredPromptString(n),DayPilot.Modal.alert(n,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})},g.readAsArrayBuffer(t)}return}let c=new FileReader;c.addEventListener("load",t=>{var o=t.target.result;isXML(o)?(sendGoogleAnalytics("action","DoFileRead_XML"),o=importMusicXML(o,gDisplayedName)):isBWWFile(o)?(sendGoogleAnalytics("action","DoFileRead_BWW"),o=convert_bww_to_abc(o)):sendGoogleAnalytics("action","DoFileRead_ABC"),DoReadCommon(o,n)}),c.readAsText(t)}}function ShowTopBar(){var t=document.getElementById("topbar");t.style.display="block",t.style.opacity=1,gTopBarShowing=!0;var t=document.getElementById("abc-selected");t.style.marginTop="15px",t.style.marginBottom="1px",(t=document.getElementById("toggletopbar")).value="",gAllowControlToggle&&ShowAllControls()}function HideTopBar(){var t=document.getElementById("topbar");t.style.display="none",gTopBarShowing=!1;var t=document.getElementById("abc-selected");gIsIPhone||gIsAndroid?(t.style.marginTop="18px",t.style.marginBottom="38px"):t.style.marginTop="4px",(t=document.getElementById("toggletopbar")).value="",gAllowControlToggle&&HideAllControls()}function ToggleTopBar(){if(e.shiftKey){MaximizeEditor();return}gTopBarShowing?HideTopBar():ShowTopBar(),UpdateNotationTopPosition(),gIsOneColumn&&MakeTuneVisible(!0),UpdateLocalStorage()}function isFirstRun(){return!!gLocalStorageAvailable&&!localStorage.abcTab&&!localStorage.abcTunesPerPage&&!localStorage.abcPageNumberLocation&&!localStorage.abcPageNumberOnPageOne&&!localStorage.abcStaffSpacing&&!localStorage.abcHideTopBar}function restoreStateFromLocalStorage(){var t=localStorage.abcTab;t&&(SetRadioValue("notenodertab",t),"whistle"==t&&PrepareWhistleFont(),gCurrentTab=t);var n=localStorage.abcTunesPerPage;n&&setPDFFormat(n);var o=localStorage.abcPageNumberLocation;o&&setPageNumbers(o);var a=localStorage.abcPageNumberOnPageOne;a&&setFirstPage(a);var r=localStorage.abcCapo;if(r){var l=parseInt(r);gCapo=isNaN(l)?0:l}var s=localStorage.abcStaffSpacing;if(s){var g=parseInt(s);gStaffSpacing=isNaN(g)?STAFFSPACEOFFSET+STAFFSPACEDEFAULT:STAFFSPACEOFFSET+g}var c=localStorage.abcHideTopBar;c&&"true"==c&&HideTopBar(),gIsFirstRun&&(UpdateLocalStorage(),showWelcomeScreen())}function restorePDFStateFromLocalStorage(){var t=localStorage.abcTunesPerPage;t&&setPDFFormat(t);var n=localStorage.abcPageNumberLocation;n&&setPageNumbers(n);var o=localStorage.abcPageNumberOnPageOne;o&&setFirstPage(o)}function DoDrop(t){t.stopPropagation(),t.preventDefault(),gIsDirty=!0;DoFileRead(t.dataTransfer.files[0],!0)}function HideZoomBanner(){document.getElementById("zoombanner").style.display="none",gZoomBannerHidden=!0,UpdateNotationTopPosition()}function HandleWindowResize(){if(isDesktopBrowser()){if(gIsMaximized){var t=document.getElementById("app-container");t.style.marginLeft="0px"}else{var n=window.innerWidth;if(n<1798){var o=(n-850)/2,t=document.getElementById("app-container");t.style.marginLeft=o+"px",gTheABC.rows=12,gIsOneColumn=!0,gZoomBannerHidden||(document.getElementById("zoombanner").style.display="block"),(t=document.getElementById("notation-placeholder-text")).style.marginTop="64px"}else{var t=document.getElementById("app-container"),o=(n-1700)/2;t.style.marginLeft=o+"px";var a=window.innerHeight;a-=375,gShowDiagnostics&&(a-=90),t=document.getElementById("abc");let r=getComputedStyle(t),l=parseFloat(r.fontSize),s=parseFloat(r.lineHeight)||1.2*l,g=Math.floor(a/s);g<12&&(g=12),gTheABC.rows=g,gIsOneColumn=!1,document.getElementById("zoombanner").style.display="none",(t=document.getElementById("notation-placeholder-text")).style.marginTop="136px"}}}}function getMIDI_note_name(t){return({24:" ",25:"BACKSPACE",26:"|",27:"/",28:"2",29:"3",30:"4",31:"(3",32:"|:",33:":|",34:"||",35:"|]",36:"C,,",37:"C,,",38:"D,,",39:"D,,",40:"E,,",41:"F,,",42:"F,,",43:"G,,",44:"G,,",45:"A,,",46:"A,,",47:"B,,",48:"C,",49:"C,",50:"D,",51:"D,",52:"E,",53:"F,",54:"F,",55:"G,",56:"G,",57:"A,",58:"A,",59:"B,",60:"C",61:"C",62:"D",63:"D",64:"E",65:"F",66:"F",67:"G",68:"G",69:"A",70:"A",71:"B",72:"c",73:"c",74:"d",75:"d",76:"e",77:"f",78:"f",79:"g",80:"g",81:"a",82:"a",83:"b",84:"c'",85:"c'",86:"d'",87:"d'",88:"e'",89:"f'",90:"f'",91:"g'",92:"g'",93:"a'",94:"a'",95:"b'",96:"c''"})[""+t]}const sharpNotes=["c","^c","d","^d","e","f","^f","g","^g","a","^a","b"],flatNotes=["c","_d","d","_e","e","f","_g","g","_a","a","_b","b"],sharps=[6,1,8,3,10,5],flats=[10,3,8,1,6,11];function midiFindKeySignature(t){var n,o,a=null,r=t.match(/^K: *([A-G])([b#])? *(.*?)$/m);if(null==r||r.length<3)return null;if(n=void 0==r[2]?r[1]:r[1]+r[2],null==(a=""==(o=(o=(o=r[3].toLowerCase()).replace(/%.*/,"")).trim())||-1!=o.search("maj")||-1!=o.search("ion")?midiKeySignatureMap(n,0):-1!=o.search("mix")?midiKeySignatureMap(n,1):-1!=o.search("dor")?midiKeySignatureMap(n,2):-1!=o.search("m")&&-1==o.search("mix")||-1!=o.search("min")||-1!=o.search("aeo")?midiKeySignatureMap(n,3):-1!=o.search("phr")?midiKeySignatureMap(n,4):-1!=o.search("loc")?midiKeySignatureMap(n,5):-1!=o.search("lyd")?midiKeySignatureMap(n,-1):-1!=o.search("exp")?midiKeySignatureMap("C",0):null))return a;var l=o.match(/_./g),s=o.match(/\^./g);for(note in l)a.flats+=l[note][1].toUpperCase();for(note in s)a.sharps+=s[note][1].toUpperCase();return a}function midiKeySignatureMap(t,n){var o="FCGDAEB",a={sharps:"",flats:""},r=o.indexOf(t[0])-1;if(-2==r)return null;"b"==t.slice(1)?r-=7:"#"==t.slice(1)&&(r+=7);var l=r-n;return l>7?null:l<-7?null:(l>0?a.sharps=o.slice(0,l):l<0&&(a.flats=o.slice(l)),a.accidentalSharps="",a.accidentalFlats="",a.accidentalNaturals="",a)}function lookupAbcNote(t,n){var o=t%12,a=Math.floor(t/12),r=n?flatNotes[o]:sharpNotes[o];return a<5?(r=r.toUpperCase(),r+=",".repeat(4-a)):r+="'".repeat(a-5),r}function getMIDI_note_name_chromatic(t){if(t<24){console.log("out of range");return}if(t>=24&&t<=35)return({24:" ",25:"BACKSPACE",26:"|",27:"/",28:"2",29:"3",30:"4",31:"(3",32:"|:",33:":|",34:"||",35:"|]"})[t];var n=findSelectedTuneIndex(),o=getTuneByIndex(n),a=midiFindKeySignature(o);null==a&&(a={sharps:"",flats:""});var r=parseInt(t)-12,l=r%12,s=0,g="",c=!0,d=!1;if(""!=a.flats&&(c=!1,d=!0),c){var u=a.sharps.length,p=sharps.slice(0,u);p.includes(l)?s--:p.includes(l+1)&&(g="=")}else{var m=a.flats.length,h=flats.slice(0,m);-1!=h.indexOf(l)?s++:h.includes(l-1)&&(g="=")}return g+lookupAbcNote(r+s,d)}var gMIDIAccess=null;function MIDI_NoteOn(t){var n;if(n=gMIDIChromatic?getMIDI_note_name_chromatic(t):getMIDI_note_name(t)){var o=gTheABC.selectionStart,a=gTheABC.selectionEnd;if("BACKSPACE"!=n){var r=gTheABC.value.substring(0,o),l=gTheABC.value.substring(a);gTheABC.value=r+n+l,gIsDirty=!0,gTheABC.selectionStart=o+n.length,gTheABC.selectionEnd=gTheABC.selectionStart,OnABCTextChange()}else if(0!=o){var r=gTheABC.value.substring(0,o-1),l=gTheABC.value.substring(a);gTheABC.value=r+l,gIsDirty=!0,gTheABC.selectionStart=o-1,gTheABC.selectionEnd=gTheABC.selectionStart,OnABCTextChange()}}}function MIDI_Receive(t){if(gAllowMIDIInput){var n=t.data[0],o=t.data[1],a=t.data[2];(240&n)==144&&0!=a&&MIDI_NoteOn(o)}}function midiOnStateChange(t){console.log("midiOnStateChange");for(var n=gMIDIAccess.inputs.values(),o=n.next();o&&!o.done;o=n.next())o.value.onmidimessage=MIDI_Receive}function onMIDIInit(t){console.log("onMIDIInit");for(var n=(gMIDIAccess=t).inputs.values(),o=n.next();o&&!o.done;o=n.next())o.value.onmidimessage=MIDI_Receive;t.onstatechange=midiOnStateChange}function onMIDIReject(t){sendGoogleAnalytics("action","onMIDIReject");var n="The MIDI input system failed to start. MIDI input will be disabled.";n=makeCenteredPromptString(n),DayPilot.Modal.alert(n,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()}),localStorage&&(gAllowMIDIInput=!1,localStorage.AllowMIDIInput=!1)}function browserSupportsMIDI(){return!!navigator.requestMIDIAccess}function initMIDI(){if(browserSupportsMIDI()&&null==gMIDIAccess){if(navigator.requestMIDIAccess)navigator.requestMIDIAccess({sysex:!1}).then(onMIDIInit,onMIDIReject);else{var t="This browser does not support MIDI input.";t=makeCenteredPromptString(t),DayPilot.Modal.alert(t,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()}),localStorage&&(gAllowMIDIInput=!1,localStorage.AllowMIDIInput=!1)}}}function showWelcomeScreen(){sendGoogleAnalytics("dialog","showWelcomeScreen");var t='<p style="text-align:center;font-size:18pt;font-family:helvetica">Welcome to My ABC Transcription Tools!</p>';t+='<p style="font-size:13pt;line-height:17pt;font-family:helvetica"><strong>Please visit my <a href="userguide.html" target="_blank" title="ABC Transcription Tools User Guide">User Guide</a> page for complete instructions and demo videos on how to use the tools.</strong></p>',t+='<p style="font-size:13pt;line-height:17pt;font-family:helvetica">To begin, type or paste tunes in ABC format into the text area.</p>',t+='<p style="font-size:13pt;line-height:17pt;font-family:helvetica">Each ABC tune <strong>must</strong> begin with an X: tag.</p>',t+='<p style="font-size:13pt;line-height:17pt;font-family:helvetica">Notation updates instantly as you make changes to the ABC.</p>',t+='<p style="font-size:13pt;line-height:17pt;font-family:helvetica">Click "Open" to open an ABC, MusicXML, BWW, or MIDI file from your system.</p>',t+='<p style="font-size:13pt;line-height:17pt;font-family:helvetica">Click "Add" to add a new ABC tune or tune template.</p>',isDesktopBrowser()&&(t+='<p style="font-size:13pt;line-height:17pt;font-family:helvetica">You may also drag-and-drop a single ABC or MusicXML file on the editor area to add it.</p>'),t+='<p style="font-size:13pt;line-height:17pt;font-family:helvetica">Click "Search for Tunes" to find tunes by name.</p>',t+='<p style="font-size:13pt;line-height:17pt;font-family:helvetica">Click "Settings" to set common tools settings and select the default instrument sounds and volumes to use when playing tunes.</p>',t+='<p style="font-size:13pt;line-height:17pt;font-family:helvetica"><strong>Once ABC has been entered and notation is displayed:</strong></p>',t+='<p style="font-size:13pt;line-height:17pt;font-family:helvetica"> Click the Zoom-Out arrows at the top-right to view the notation full screen.</p>',t+='<p style="font-size:13pt;line-height:17pt;font-family:helvetica"> Click "Save" to save all the ABC text to an ABC text file.</p>',t+='<p style="font-size:13pt;line-height:17pt;font-family:helvetica"> Click "Export PDF" to export your tunebook in PDF format.</p>',t+='<p style="font-size:13pt;line-height:17pt;font-family:helvetica"> Click "Play" to play or train on the tune currently being edited.</p>',DayPilot.Modal.alert(t,{theme:"modal_flat",top:25,scrollWithPage:AllowDialogsToScroll()})}function showZoomInstructionsScreen(){sendGoogleAnalytics("dialog","showZoomInstructionsScreen");var t='<p style="text-align:center;font-size:18pt;font-family:helvetica">Welcome to My ABC Transcription Tools!</p>';t+='<p style="font-size:14pt;line-height:18pt;font-family:helvetica">Since this is your first time using the tools, here is some useful information to help you get started:</p>',t+='<p style="font-size:14pt;line-height:18pt;font-family:helvetica">In this view, you may scroll through the tune notation.</p>',t+='<p style="font-size:14pt;line-height:18pt;font-family:helvetica">Click the Play button at the bottom-right to play or train on the current tune.</p>',t+='<p style="font-size:14pt;line-height:18pt;font-family:helvetica">From the Player you can also export the tune image or audio in multiple formats.</p>',t+='<p style="font-size:14pt;line-height:18pt;font-family:helvetica">Click the PDF button at the bottom-left to export the tunes in PDF format.</p>',gDisableEditFromPlayLink||(t+='<p style="font-size:14pt;line-height:18pt;font-family:helvetica">If you would like to edit the ABC for these tunes:</p>',t+='<p style="font-size:14pt;line-height:18pt;font-family:helvetica">Click the Zoom-In arrows at the top-right to close the full screen notation view and open the ABC editor.</p>',t+='<p style="font-size:14pt;line-height:18pt;font-family:helvetica">The ABC for all the tunes will be loaded in the editor.</p>',t+='<p style="font-size:14pt;line-height:18pt;font-family:helvetica">In the ABC editor, click the Zoom-Out arrows at the top-right to view notation full screen.</p>'),t+='<p style="font-size:14pt;line-height:18pt;font-family:helvetica">Please visit my <a href="userguide.html" target="_blank" title="ABC Transcription Tools User Guide">User Guide</a> page for complete instructions and demo videos on how to use the tools.</p>',DayPilot.Modal.alert(t,{theme:"modal_flat",top:50,scrollWithPage:AllowDialogsToScroll()})}function TipJarReminderDialog(){sendGoogleAnalytics("dialog","TipJarReminderDialog");var t='<p style="text-align:center;font-size:22pt;font-family:helvetica">Thank You!</p>';t+='<p style="font-size:14pt;line-height:18pt;font-family:helvetica;text-align:center;">I hope my ABC Transcription Tools have been useful to you!</p>',t+='<p style="font-size:14pt;line-height:18pt;font-family:helvetica;text-align:center;margin-top:36px;">If so, please consider dropping something in one of my </p>',t+='<p style="font-size:14pt;line-height:18pt;font-family:helvetica;text-align:center;"><strong><a href="tipjars.html" target="_blank" title="My Virtual Tip Jars">Virtual Tip Jars</a></strong></p>',t+='<p style="font-size:14pt;line-height:18pt;font-family:helvetica;text-align:center;margin-top:36px;">Cheers and thanks!</p>',t+='<div style="text-align:center"><img style="width:150px;" src="img/michael.jpg"/></div>',t+='<p style="font-size:14pt;line-height:18pt;font-family:helvetica;text-align:center;">Michael Eskin</p>',DayPilot.Modal.alert(t,{theme:"modal_flat",top:75,scrollWithPage:AllowDialogsToScroll()})}function TinyURLReminderDialog(){sendGoogleAnalytics("dialog","TinyURLReminderDialog");var t='<p style="text-align:center;font-size:18pt;font-family:helvetica">TinyURL Use Request</p>';t+='<p style="font-size:12pt;line-height:14pt;font-family:helvetica;text-align:center;margin-top:32px;">I get a limited number of free shortened URLs from TinyURL each month.</p>',t+='<p style="font-size:12pt;line-height:18pt;font-family:helvetica;text-align:center;">If you plan on creating many shortened URLs, please sign up<br/>for your own free or paid TinyURL account at:</p>',t+='<p style="font-size:12pt;line-height:14pt;font-family:helvetica;text-align:center;"><strong><a href="https://tinyurl.com" target="_blank" title="TinyURL">TinyURL</a></strong></p>',t+='<p style="font-size:12pt;line-height:14pt;font-family:helvetica;text-align:center;">After signing up, you can obtain a private API token from:</p>',t+='<p style="font-size:12pt;line-height:14pt;font-family:helvetica;text-align:center;"><strong><a href="https://tinyurl.com/app/settings/api" target="_blank" title="TinyURL API">TinyURL API Settings</a></strong></p>',t+='<p style="font-size:12pt;line-height:14pt;font-family:helvetica;text-align:center;">And then enter it on the <strong>Advanced Settings</strong> dialog.</p>',t+='<p style="font-size:12pt;line-height:14pt;font-family:helvetica;text-align:center;">More details here:</p>',t+='<p style="font-size:12pt;line-height:14pt;font-family:helvetica;text-align:center;"><strong><a href="https://michaeleskin.com/app/userguide.html#private_tinyurl_token" target="_blank" title="Private TinyURL Token">Using a Private TinyURL API Token</a></strong></p>',t+='<p style="font-size:12pt;line-height:14pt;font-family:helvetica;text-align:center;margin-top:36px;">Cheers and thanks!</p>',t+='<div style="text-align:center"><img style="width:150px;" src="img/michael.jpg"/></div>',t+='<p style="font-size:12pt;line-height:14pt;font-family:helvetica;text-align:center;">Michael Eskin</p>',DayPilot.Modal.alert(t,{theme:"modal_flat",top:25,scrollWithPage:AllowDialogsToScroll()})}function ShowHelp(){if(sendGoogleAnalytics("dialog","ShowHelp"),gIsMaximized){var t='<p style="text-align:center;font-size:16pt;font-family:helvetica">About the Full Screen Notation View</p>';t+='<p style="font-size:12pt;line-height:16pt;font-family:helvetica">In this view, you may scroll through the tune notation.</p>',t+='<p style="font-size:12pt;line-height:16pt;font-family:helvetica">Click the Play button at the bottom-right to play or train on the current tune.</p>',t+='<p style="font-size:12pt;line-height:16pt;font-family:helvetica">From the Player you can also export the tune image or audio in multiple formats.</p>',t+='<p style="font-size:12pt;line-height:16pt;font-family:helvetica">Click the PDF button at the bottom-left to export the tunes in PDF format.</p>',gDisableEditFromPlayLink||(t+='<p style="font-size:12pt;line-height:16pt;font-family:helvetica">If you would like to edit the ABC for these tunes:</p>',t+='<p style="font-size:12pt;line-height:16pt;font-family:helvetica">Click the Zoom-In arrows at the top-right to close the full screen notation view and open the tunes in the ABC editor.</p>',t+='<p style="font-size:12pt;line-height:16pt;font-family:helvetica">The ABC for all the tunes will be loaded in the editor.</p>',t+='<p style="font-size:12pt;line-height:16pt;font-family:helvetica">In the ABC editor, click the Zoom-Out arrows at the top-right to view the notation full screen.</p>'),t+='<p style="font-size:12pt;line-height:16pt;font-family:helvetica">Please visit the <a href="userguide.html" target="_blank" title="ABC Transcription Tools User Guide">User Guide</a> page for complete instructions and demo videos on how to use the tools.</p>',DayPilot.Modal.alert(t,{theme:"modal_flat",top:50,scrollWithPage:AllowDialogsToScroll()})}else window.open("https://michaeleskin.com/app/userguide.html")}var RESIZETEXTBOX_DEBOUNCEMS=20,gLastResizeTextboxTime=0;function ResizeTextBox(){if(!gIsMaximized){var t=Date.now();if(t-gLastResizeTextboxTime>RESIZETEXTBOX_DEBOUNCEMS){gLastResizeTextboxTime=t;var n=gTheABC.offsetWidth,o=(gInitialTextBoxContainerWidth-gInitialTextBoxWidth)/2;if(n>gInitialTextBoxContainerWidth){var a=(n-gInitialTextBoxWidth)/2-o;if(a<=gInitialTextBoxContainerLeft&&(gTheABC.style.marginLeft=-a+"px",!gIsOneColumn)){var r=document.getElementById("app-container"),l=r.style.marginLeft;l&&(theAppContainerMarginFloat=parseFloat(l=r.style.marginLeft.replace("px","")),!isNaN(theAppContainerMarginFloat)&&a<(theAppContainerMarginFloat-=48)&&(gTheNotation.style.marginLeft=a+"px"))}}else gTheABC.style.marginLeft="0px",gTheNotation.style.marginLeft=a+"px"}}}function AllowDialogsToScroll(){return!!isMobileBrowser()||window.innerHeight<950}function CleanSmartQuotes(){var t=gTheABC.value;t=(t=(t=(t=t.replaceAll("",'"')).replaceAll("",'"')).replaceAll("","'")).replaceAll("","'"),gTheABC.value=t,(elem=document.getElementById("diagnostics")).innerHTML=""}function updateABCEditorFont(){13==gABCEditorFontsize?(gTheABC.style.fontSize="13pt",gTheABC.style.lineHeight="16pt"):(gTheABC.style.fontSize=gABCEditorFontsize+"pt",gTheABC.style.lineHeight=gABCEditorFontsize+.23*gABCEditorFontsize+"pt")}function updateDiagnostics(){var t=document.getElementById("diagnostics");gShowDiagnostics?t.style.display="block":t.style.display="none"}function FixIOS17(){var t=navigator.userAgent;if(-1!=t.indexOf("Version/17")||-1!=t.indexOf("OS 17")||-1!=t.indexOf("FxiOS")){var n=gTheABC.value;try{n=decodeURI(n);try{n=decodeURI(n)}catch(o){}}catch(a){}n=(n=n.replaceAll("%3A",":")).replaceAll("x:","X:"),gTheABC.value=n}}function theTabCloseListener(t){DoSaveLastAutoSnapShot()}function AddTabCloseListener(){isDesktopBrowser()&&window.addEventListener("beforeunload",theTabCloseListener)}function fileOpenIntercept(t){var n=document.getElementById("selectabcfile");if(gIsDirty){var o='<p style="font-size:18pt;line-height:20pt;text-align:center;">You Have Unsaved Changes</p><p style="font-size:13pt;line-height:16pt;text-align:center;margin-top:30px;">Click "OK" to abandon your work and open a new file.<br/><br/>Click "Cancel" to go back.</p>';o=makeCenteredPromptString(o),DayPilot.Modal.confirm(o,{top:200,theme:"modal_flat",scrollWithPage:AllowDialogsToScroll()}).then(function(t){t.canceled||setTimeout(function(){n.click()},100)})}else n.click()}function RemoveTabCloseListener(){isDesktopBrowser()&&window.removeEventListener("beforeunload",theTabCloseListener)}function ShowHideTabButtons(){var t=document.getElementById("tabs-selection");gFeaturesShowTabButtons?(t.style.display="flex",(t=document.getElementById("transpose-controls")).style.marginTop="18px"):(t.style.display="none",(t=document.getElementById("transpose-controls")).style.marginTop="0px"),UpdateNotationTopPosition()}function isDesktopBrowser(){return!(gIsIOS||gIsAndroid)}function isMobileBrowser(){return gIsIOS||gIsAndroid}function makeCenteredPromptString(t){return'<p style="font-size:12pt;line-height:18pt;font-family:helvetica;text-align:center">'+t+"</p>"}function sendGoogleAnalytics(t,n,o){navigator.onLine&&!gIsIOS&&"undefined"!=typeof gtag&&gtag&&gtag instanceof Function&&(o||(o="none"),gtag("event","o_abc_"+t+"_"+n,{event_category:t,event_action:n,event_label:o}))}function isIOS(){return!!/iPad|iPhone|iPod/.test(navigator.platform)||navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform)}function isIPhone(){return!!/iPad|iPhone|iPod/.test(navigator.platform)}function isIPad(){return navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform)}function isAndroid(){return!!/Android/i.test(navigator.userAgent)}function isSafari(){return!!(/Safari/i.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor))}function isChrome(){return!!/chrome|chromium|crios/i.test(navigator.userAgent)}function MaximizeEditor(){!(!gAllowCopy||isMobileBrowser())&&!gIsOneColumn&&(gTheABC.style.width=window.innerWidth-gTheNotation.offsetWidth-125+"px",setTimeout(function(){var t=gTheABC.offsetWidth,n=(gInitialTextBoxContainerWidth-gInitialTextBoxWidth)/2;if(t>gInitialTextBoxContainerWidth){var o=(t-gInitialTextBoxWidth)/2-n;if(o<=gInitialTextBoxContainerLeft&&(gTheABC.style.marginLeft=-o+"px",!gIsOneColumn)){var a=document.getElementById("app-container"),r=a.style.marginLeft;r&&(theAppContainerMarginFloat=parseFloat(r=a.style.marginLeft.replace("px","")),!isNaN(theAppContainerMarginFloat)&&o<(theAppContainerMarginFloat-=48)&&(gTheNotation.style.marginLeft=o+"px"))}}},100))}function DoStartup(){if(gShowAdvancedControls=!1,gShowShareControls=!1,gStripAnnotations=!1,gStripTextAnnotations=!1,gStripChords=!1,gStripTab=!1,gStripOrnaments=!1,gRenderingPDF=!1,gAllowSave=!1,gAllowURLSave=!1,gShowAllControls=!1,gAllowControlToggle=!1,gAllowFilterAnnotations=!1,gAllowFilterText=!1,gAllowFilterChords=!1,gAllowFilterTab=!1,gAllowFilterOrnaments=!1,gIsMaximized=!1,gCapo=0,gABCFromFile=!1,gAllowCopy=!1,gAllowPDF=!1,gShowTabNames=!0,gAllowShowTabNames=!1,gLastAutoScrolledTune=-1,gLastClickedTune=-1,gTopBarShowing=!0,gCurrentTune=0,gTotalTunes=0,gCurrentTab="noten",gForceFullRender=!1,gIsOneColumn=!0,gLocalStorageAvailable=!1,gPDFQuality=.75,gIncludePageLinks=!0,gDoForcePDFFilename=!1,gForcePDFFilename="",gFullScreenScaling=50,gIsDirty=!1,doOnlineCheck(),HideMaximizeButton(),DoMaximize(),gIsChrome=!1,gIsSafari=!1,isChrome()&&(gIsChrome=!0),gIsIOS=!1,isIOS()&&(gIsIOS=!0),gIsIPad=!1,isIPad()&&(gIsIPad=!0),gIsIPhone=!1,isIPhone()&&(gIsIPhone=!0),gIsAndroid=!1,isAndroid()&&(gIsAndroid=!0),gIsIOS&&document.getElementById("selectabcfile").removeAttribute("accept"),isMobileBrowser()){var t=document.getElementById("toolpagetitle");(t.size=4,t.style.fontFamily="Helvetica",(t=document.getElementById("notenlinks")).style.paddingTop="20px",t=gTheABC,gIsIPhone||gIsAndroid)?(gIsIPhone?t.cols=60:t.cols=58,t.style.fontSize="16pt",t.style.lineHeight="18pt",document.querySelector("meta[name=viewport]").setAttribute("content","width=860,maximum-scale=1.0,user-scalable=0")):(t.cols=73,t.style.fontSize="13pt",t.style.lineHeight="15pt"),(t=document.getElementById("app-container")).style.width="860px",t.style.display="block",t.style.marginLeft="0px",(t=document.getElementById("notation-placeholder")).style.width="860px",t.style.display="none",(t=document.getElementById("noscroller")).style.width="860px",t.style.display="none",(t=gTheNotation).style.width="820px",t.style.display="block",t.style.marginLeft="20px",t.style.marginRight="0px",t.style.overflow="hidden",(t=document.getElementById("notation-spacer")).style.width="860px",t.style.display="block",t.style.marginRight="0px",(t=document.getElementById("uioverlay")).style.width="860px",t.style.display="block",(t=document.getElementById("diagnostics")).style.width="836px",t.style.display="block",(t=document.getElementById("loading-bar-spinner")).style.top="25%"}(gIsIPhone||gIsAndroid)&&(document.getElementById("zoombutton").style.right="21px",document.getElementById("helpbutton").style.left="21px",document.getElementById("playbuttonicon").style.right="21px",document.getElementById("pdfbuttonicon").style.left="21px"),gIsIPad&&(document.getElementById("zoombutton").style.width="36px",document.getElementById("zoombutton").style.height="36px",document.getElementById("zoombutton").style.top="8px",document.getElementById("zoombutton").style.right="8px",document.getElementById("helpbutton").style.width="36px",document.getElementById("helpbutton").style.height="36px",document.getElementById("helpbutton").style.top="8px",document.getElementById("helpbutton").style.left="8px",document.getElementById("playbuttonicon").style.width="36px",document.getElementById("playbuttonicon").style.height="36px",document.getElementById("playbuttonicon").style.bottom="8px",document.getElementById("playbuttonicon").style.right="8px",document.getElementById("pdfbuttonicon").style.width="36px",document.getElementById("pdfbuttonicon").style.height="36px",document.getElementById("pdfbuttonicon").style.bottom="8px",document.getElementById("pdfbuttonicon").style.left="8px"),document.getElementById("abc").oninput=debounce(()=>{gIsDirty=!0,gForceFullRender?RenderAsync(!0,null):OnABCTextChange(),gForceFullRender=!1},DEBOUNCEMS),document.getElementById("abc").onpaste=function(t){var n=!1,o=t.clipboardData||window.clipboardData;if(o){var a=o.getData("text");a&&-1!=a.indexOf("X:")&&(n=!0)}setTimeout(function(){CleanSmartQuotes(),gIsDirty=!0,gIsIOS?FixIOS17():n&&setTimeout(function(){RenderAsync(!0,null)},250)},0)},document.getElementById("abc").onclick=debounce(()=>{MakeTuneVisible(!1),fireSelectionChanged()},AUTOSCROLLDEBOUNCEMS),document.getElementById("selectabcfile").onchange=()=>{let t=document.getElementById("selectabcfile");if(0===t.files.length){var n="Please select an ABC, MusicXML, or MIDI file";n=makeCenteredPromptString(n),DayPilot.Modal.alert(n,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});return}DoFileRead(t.files[0],!1)},window.localStorage&&(gLocalStorageAvailable=!0),gIsFirstRun=isFirstRun(),SetRadioValue("notenodertab","noten"),setPDFFormat("one"),setPageNumbers("none"),setFirstPage("yes"),document.getElementById("zoombutton").onclick=function(){ToggleMaximize()},document.getElementById("helpbutton").onclick=function(){ShowHelp()},document.getElementById("playbuttonicon").onclick=function(){PlayABC(null)},document.getElementById("pdfbuttonicon").onclick=function(){PDFExportDialog()},gStaffSpacing=STAFFSPACEOFFSET+STAFFSPACEDEFAULT,ClearNoRender(),resetAngloButtonNames(),resetMusicXMLImportOptions(),gLocalStorageAvailable&&GetInitialConfigurationSettings(),isDesktopBrowser()&&gSaveLastAutoSnapShot&&AddTabCloseListener(),gForceInitialTextBoxRecalc=!1;var n=processShareLink();if(gIsFromShare=n,gForceInitialTextBoxRecalc=n,n?(ShowPlayButton(),ShowPDFButton(),gIsFirstRun&&showZoomInstructionsScreen(),restorePDFStateFromLocalStorage(),UpdateLocalStorage(),sendGoogleAnalytics("start","from_share")):(DoMinimize(),document.getElementById("notation-placeholder").style.display="block",restoreStateFromLocalStorage(),sendGoogleAnalytics("start","no_share")),ShowHideTabButtons(),new ResizeObserver(TextBoxResizeHandler).observe(gTheABC),isDesktopBrowser()){gInitialTextBoxWidth=gTheABC.offsetWidth;var t=document.getElementById("notenlinks");gInitialTextBoxContainerWidth=t.offsetWidth,gInitialTextBoxContainerLeft=(t=document.getElementById("noscroller")).offsetLeft,new ResizeObserver(ResizeTextBox).observe(gTheABC),window.onresize=function(){if(HandleWindowResize(),gIsMaximized)gGotWindowResizeWhileMaximized=!0;else{gTheABC.style.marginLeft="0px",gTheABC.style.width=gInitialTextBoxWidth+"px";var t=document.getElementById("notenlinks");gInitialTextBoxContainerWidth=t.offsetWidth,gInitialTextBoxContainerLeft=(t=document.getElementById("noscroller")).offsetLeft,gTheNotation.style.marginLeft="auto",ResizeTextBox(),gGotWindowResizeWhileMaximized=!1}},updateABCEditorFont()}updateDiagnostics(),HandleWindowResize(),ShowAllControls(),n||(document.getElementById("notenrechts").style.display="none",gAllowControlToggle=!1),isDesktopBrowser()?($.event.props.push("dataTransfer"),$("#abc").on("drop",function(t){$(this).toggleClass("indrag",!1),DoDrop(t)}),$("#abc").on("dragover",function(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy"}),$("#abc").on("dragenter dragleave",function(){$(this).toggleClass("indrag")}),$("#abc").on("dragstart",function(t){t.preventDefault()})):(gTheABC.placeholder="Enter the ABC for your tunes here",document.getElementById("desktop_use_message").style.display="none",$("#abc").on("dragstart",function(t){t.preventDefault()})),isDesktopBrowser()&&(gTheABC.onmousedown=function(t){gRawMode&&setTimeout(function(){gRawIsDragging=!0,fireSelectionChanged()},0)},gTheABC.onmouseup=function(t){gRawMode&&(gRawIsDragging=!1,fireSelectionChanged())},gTheABC.onmousemove=function(t){gRawMode&&gRawIsDragging&&fireSelectionChanged()},gAllowRawMode=!0),!n&&(gTipJarCount++,gLocalStorageAvailable&&(localStorage.TipJarCount=gTipJarCount)),(25==gTipJarCount||75==gTipJarCount||150==gTipJarCount||300==gTipJarCount)&&TipJarReminderDialog(),gAllowMIDIInput&&initMIDI(),ShowHelpButton(),SetupRawModeUI(),initImpulseDB(),initTuneDB(),initSamplesDB(),window.addEventListener("online",doOnlineCheck),window.addEventListener("offline",doOnlineCheck),gTheABC.focus()}function WaitForReady(t){if("loading"!==document.readyState){t();return}document.addEventListener("DOMContentLoaded",t)}WaitForReady(DoStartup);